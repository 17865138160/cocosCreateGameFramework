System.register([],(function(e,t){"use strict";return{execute:function(){e({A:void 0,B:void 0,C:void 0,E:void 0,F:void 0,H:void 0,I:void 0,J:void 0,K:void 0,L:void 0,M:void 0,N:void 0,O:void 0,Q:void 0,U:void 0,V:void 0,W:void 0,X:void 0,Y:void 0,aN:void 0,aR:Nr,aS:Or,aT:Mr,aU:Lr,aV:Fr,b:void 0,bB:w,bC:v,bE:function(e,t=Go.R32F,n=0,i=e.byteLength-n,o=0,a=[]){const r=Pr[t];o||(o=r.size);const s=`get${kb(r)}`,c=r.size/r.count,l=Math.floor(i/o),_=U_.isLittleEndian;for(let t=0;t<l;++t){const i=n+o*t;for(let n=0;n<r.count;++n){const o=i+c*n;a[r.count*t+n]=e[s](o,_)}}return a},bG:function(e,t,n=Go.R32F,i=0,o=0){const a=Pr[n];o||(o=a.size);const r=`set${kb(a)}`,s=a.size/a.count,c=Math.floor(t.length/a.count),l=U_.isLittleEndian;for(let n=0;n<c;++n){const c=i+o*n;for(let i=0;i<a.count;++i){const o=c+s*i;e[r](o,t[a.count*n+i],l)}}},bJ:SP,bK:Ub,bM:ke,bO:Yc,bP:Pc,bR:vl,bf:lN,bg:function(e,t){return e instanceof t},bp:void 0,br:R,bs:y,bt:g,bu:Cn,bw:void 0,bx:void 0,c:void 0,c0:Tc,c1:function(){},c2:void 0,c5:void 0,c7:void 0,cK:void 0,cL:void 0,cO:Gn,cT:ne,cU:Ie,cW:cn,cX:fe,ce:Hc,cj:Hn,cl:void 0,cp:function(e,t,n){for(Ei.identity(n);e!==t;)Ei.fromRTS(Sk,e.rotation,e.position,e.scale),Ei.multiply(n,Sk,n),e=e.parent;return n},cs:void 0,cu:vk,cv:Ak,cw:mk,cx:void 0,d$:Yn,d0:void 0,d2:je,dD:Vn,dF:Ze,dH:void 0,dL:jn,dN:void 0,dT:Wn,dW:function(){const e=new Gh;return e.assignSorted([[0,{interpolationMode:El.CUBIC,value:1}],[1,{interpolationMode:El.CUBIC,value:1}]]),e},dX:void 0,dY:$n,dZ:Qn,df:void 0,dg:void 0,dk:et,dl:he,dm:T,dn:M,dr:void 0,dt:void 0,du:void 0,dv:N,dw:void 0,e0:Xn,e1:yn,e3:ei,e6:gu,e7:bj,e8:sj,e9:function(e){const t=(e=e||{}).widthSegments||1,n=e.heightSegments||1,i=e.lengthSegments||1,o=(e.width||1)/2,a=(e.height||1)/2,r=(e.length||1)/2,s=[_i.set(hj,-o,-a,r),_i.set(fj,o,-a,r),_i.set(pj,o,a,r),_i.set(dj,-o,a,r),_i.set(mj,o,-a,-r),_i.set(Aj,-o,-a,-r),_i.set(vj,-o,a,-r),_i.set(gj,o,a,-r)],c=[[2,3,1],[4,5,7],[7,6,2],[1,0,4],[1,4,2],[5,0,6]],l=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],_=[[-1,0,0,1],[-1,0,0,1],[-1,0,0,1],[-1,0,0,1],[0,0,-1,1],[0,0,1,1]],u=[],h=[],f=[],p=[],d=[],m=new _i(-o,-a,-r),A=new _i(o,a,r),v=Math.sqrt(o*o+a*a+r*r);function g(e,t,n){let i,o,a,r;const m=u.length/3,A=c[e],v=l[e],g=_[e];for(r=0;r<=n;r++)for(a=0;a<=t;a++)if(i=a/t,o=r/n,_i.lerp(cj,s[A[0]],s[A[1]],i),_i.lerp(lj,s[A[0]],s[A[2]],o),_i.subtract(_j,lj,s[A[0]]),_i.add(uj,cj,_j),u.push(uj.x,uj.y,uj.z),h.push(v[0],v[1],v[2]),f.push(i,o),p.push(g[0],g[1],g[2],g[3]),a<t&&r<n){const e=t+1,n=a+r*e,i=a+(r+1)*e,o=a+1+(r+1)*e,s=a+1+r*e;d.push(m+n,m+s,m+i),d.push(m+i,m+s,m+o)}}return g(0,t,n),g(4,i,n),g(1,t,n),g(5,i,n),g(3,t,i),g(2,t,i),{positions:u,normals:h,uvs:f,tangents:p,indices:d,minPos:m,maxPos:A,boundingRadius:v}},eB:fn,eD:void 0,eE:A,eF:wi,eQ:Bt,eS:void 0,ea:function(e){const t=function(e){return(e=sj(e)).width=e.width||10,e.length=e.length||10,e.widthSegments=e.widthSegments||10,e.lengthSegments=e.lengthSegments||10,e}(e),{width:n,length:i,widthSegments:o,lengthSegments:a}=t,r=.5*n,s=.5*i,c=[],l=[],_=[],u=new _i(-r,0,-s),h=new _i(r,0,s),f=Math.sqrt(n*n+i*i);_i.set(Pj,-r,0,s),_i.set(wj,r,0,s),_i.set(Ij,-r,0,-s);for(let e=0;e<=a;e++)for(let n=0;n<=o;n++){const i=n/o,r=e/a;if(_i.lerp(Sj,Pj,wj,i),_i.lerp(Cj,Pj,Ij,r),_i.subtract(Ej,Cj,Pj),_i.add(Tj,Sj,Ej),c.push(Tj.x,Tj.y,Tj.z),t.includeUV&&l.push(i,r),n<o&&e<a){const t=o+1,i=n+e*t,a=n+(e+1)*t,r=n+1+(e+1)*t,s=n+1+e*t;_.push(i,s,a),_.push(s,r,a)}}const p={positions:c,indices:_,minPos:u,maxPos:h,boundingRadius:f};if(t.includeNormal){const e=(a+1)*(o+1),t=new Array(3*e);p.normals=t;for(let n=0;n<e;++n)t[3*n+0]=0,t[3*n+1]=1,t[3*n+2]=0}return t.includeUV&&(p.uvs=l),p},eb:function(e=.5,t=.5,n=2,i={}){const o=n-e-t,a=i.sides||32,r=i.heightSegments||32,s=t/n,c=o/n,l=e/n,_=Math.floor(r*s),u=Math.floor(r*l),h=Math.floor(r*c),f=o+t-n/2,p=t-n/2,d=t-n/2,m=i.arc||2*Math.PI,A=[],v=[],g=[],x=[],y=Math.max(e,t),b=new _i(-y,-n/2,-y),S=new _i(y,n/2,y),C=n/2;let E=0;const T=[];return function(){for(let e=0;e<=_;++e){const n=e*Math.PI/_/2,i=Math.sin(n),o=-Math.cos(n);for(let n=0;n<=a;++n){const s=2*n*Math.PI/a-Math.PI/2,c=Math.sin(s)*i,l=o,u=Math.cos(s)*i,h=n/a,f=e/r;if(A.push(c*t,l*t+d,u*t),v.push(c,l,u),g.push(h,f),e<_&&n<a){const t=a+1,i=t*e+n,o=t*(e+1)+n,r=t*(e+1)+n+1,s=t*e+n+1;x.push(i,s,o),x.push(s,r,o)}++E}}}(),function(){const n=(e-t)/o;for(let i=0;i<=h;i++){const r=[],l=i/h,_=l*(e-t)+t;for(let e=0;e<=a;++e){const t=e/a,i=l*c+s,u=t*m-m/4,h=Math.sin(u),f=Math.cos(u);A.push(_*h),A.push(l*o+p),A.push(_*f),_i.normalize(Rj,_i.set(Dj,h,-n,f)),v.push(Rj.x),v.push(Rj.y),v.push(Rj.z),g.push(t,i),r.push(E),++E}T.push(r)}for(let e=0;e<h;++e)for(let t=0;t<a;++t){const n=T[e][t],i=T[e+1][t],o=T[e+1][t+1],a=T[e][t+1];x.push(n),x.push(a),x.push(i),x.push(a),x.push(o),x.push(i)}}(),function(){for(let t=0;t<=u;++t){const n=t*Math.PI/u/2+Math.PI/2,i=Math.sin(n),o=-Math.cos(n);for(let n=0;n<=a;++n){const s=2*n*Math.PI/a-Math.PI/2,c=Math.sin(s)*i,_=o,p=Math.cos(s)*i,d=n/a,m=t/r+(1-l);if(A.push(c*e,_*e+f,p*e),v.push(c,_,p),g.push(d,m),t<u&&n<a){const e=a+1,i=e*t+n+T[h][a]+1,o=e*(t+1)+n+T[h][a]+1,r=e*(t+1)+n+1+T[h][a]+1,s=e*t+n+1+T[h][a]+1;x.push(i,s,o),x.push(s,r,o)}}}}(),{positions:A,normals:v,uvs:g,indices:x,minPos:b,maxPos:S,boundingRadius:C}},ee:void 0,ef:void 0,eg:U,eh:void 0,ej:Oj,ek:ni,el:ii,eo:OU,eq:NU,er:G,es:qt,ex:tt,ey:nt,f:void 0,f0:Rt,f2:Ee,f7:Ni,f8:fi,f9:Mi,fA:fu,fC:function(e){return e[Wc]},fP:x,fQ:z,fR:L,fS:void 0,fZ:fw,fa:Si,fd:Fi,fe:ki,ff:si,fh:kn,fi:Un,fj:Zn,fk:Jn,fl:Kn,fm:ti,fn:oi,fq:Fe,fw:function(e){e>0&&(On=e)},fx:Tb,fy:Pb,g:void 0,gA:mz,gC:function(e,t){let n=e,i="";for(;null!==n&&n!==t;)i=`${n.name}/${i}`,n=n.parent;return i.slice(0,-1)},gD:void 0,gE:void 0,gF:void 0,gH:void 0,gq:Nk,gr:Ok,gs:Mk,gu:rf,gv:ff,gz:dz,h:void 0,h7:void 0,hj:function(){return(()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const e=new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0]));if(e instanceof WebAssembly.Module)new WebAssembly.Instance(e),WebAssembly.Instance}}catch(e){return!1}})(),Promise.resolve().then((()=>_q)).then((e=>{if("string"==typeof e){console.info("[Physics][Bullet]: Using wasm Bullet libs.");const t=e=>{console.info(e)},n=e=>{console.error(e)},i=new WebAssembly.Memory({initial:250}),o={cc:lq,wasi_snapshot_preview1:{fd_close:t,fd_seek:t,fd_write:t},env:{memory:i}};return new Promise((t=>{fetch(e).then((e=>{e.arrayBuffer().then((e=>{!function(e){WebAssembly.instantiate(e,o).then((e=>{const n=e.instance.exports;Object.assign(uq,n),t()}),n)}(e)}),n)}),n)}))}{console.info("[Physics][Bullet]: Using asmjs Bullet libs.");const t=lq,n={};n.buffer=new ArrayBuffer(16384e3),t.memory=n;const i=e(t,n);return Object.assign(uq,i),new Promise((e=>{e()}))}}))},i:void 0,j:void 0,k:void 0,l:void 0,m:Xr,n:void 0,o:void 0,p:void 0,q:void 0,r:void 0,s:void 0,t:void 0,u:void 0,v:void 0,w:void 0,x:void 0,y:void 0,z:void 0});const n=e("by",!1),i=e("bA",!1),o=e("dK",!1),a=e("dI",!1),r=e("dJ",!0),s="undefined"==typeof window?global:window,c=e("bD",{_global:s});c.internal={},s.CC_BUILD=!0,s.CC_TEST=!1,s.CC_EDITOR=i,s.CC_PREVIEW=!1,s.CC_DEV=!1,s.CC_DEBUG=!1,s.CC_JSB=r,s.CC_BYTEDANCE=!1,s.CC_WECHAT=n,s.CC_ALIPAY=!1,s.CC_XIAOMI=!1,s.CC_BAIDU=!1,s.CC_COCOSPLAY=!1,s.CC_HUAWEI=!1,s.CC_OPPO=!1,s.CC_VIVO=!1,s.CC_MINIGAME=a,s.CC_RUNTIME_BASED=o,s.CC_SUPPORT_JIT=!0;const l=e("eH","3.4.2");s.CocosEngine=c.ENGINE_VERSION=l,s.cc=c;let _=null,u=console.log.bind(console),h=u,f=u,p=(e,t,...n)=>{e||console.log(`ASSERT: ${m(t,...n)}`)},d=u;function m(e,...t){return c.js.formatStr.apply(null,[e].concat(t))}function A(e,...t){return u(e,...t)}function v(e,...t){return h(e,...t)}function g(e,...t){return f(e,...t)}function x(e,t,...n){return p(e,t,...n)}function y(...e){return d(...e)}function b(e){if(u=h=f=p=d=()=>{},e!==O.NONE){if(e>O.ERROR){const t=e=>{if(c.game.canvas){if(!_){const e=document.createElement("Div");e.setAttribute("id","logInfoDiv"),e.setAttribute("width","200"),e.setAttribute("height",c.game.canvas.height);const t=e.style;t.zIndex="99999",t.position="absolute",t.top=t.left="0",_=document.createElement("textarea"),_.setAttribute("rows","20"),_.setAttribute("cols","30"),_.setAttribute("disabled","true");const n=_.style;n.backgroundColor="transparent",n.borderBottom="1px solid #cccccc",n.borderTopWidth=n.borderLeftWidth=n.borderRightWidth="0px",n.borderTopStyle=n.borderLeftStyle=n.borderRightStyle="none",n.padding="0px",n.margin="0px",e.appendChild(_),c.game.canvas.parentNode.appendChild(e)}_.value=`${_.value+e}\r\n`,_.scrollTop=_.scrollHeight}};f=(e,...n)=>{t(`ERROR :  ${m(e,...n)}`)},p=(e,n,...i)=>{e||t(`ASSERT: ${m(n,...i)}`)},e!==O.ERROR_FOR_WEB_PAGE&&(h=(e,...n)=>{t(`WARN :  ${m(e,...n)}`)}),e===O.INFO_FOR_WEB_PAGE&&(u=(e,...n)=>{t(m(e,...n))})}else console&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),f=console.error.bind?console.error.bind(console):console.error,p=(e,t,...n)=>{if(!e){const e=m(t,...n);throw new Error(e)}});if(e!==O.ERROR&&(h=console.warn.bind?console.warn.bind(console):console.warn),e<=O.INFO&&(u="JavaScriptCore"===scriptEngineType?(e,...t)=>console.log.apply(console,[e,...t]):console.log),e<=O.VERBOSE&&"function"==typeof console.debug){const e=console.debug.bind(console);d=(...t)=>e(...t)}}}function S(e){{const t=e.stack;return void g(t?`${e}\n${t}`:e)}}function C(e){return(t,...n)=>{const i=`${e} ${t}, please go to https://github.com/cocos-creator/engine/blob/develop/EngineErrorMap.md#${t} to see details.`;return 0===n.length?i:`${i} Arguments: ${n.join(", ")}`}}const E=C("Log");function T(e,...t){A(E(e,...t))}const P=C("Warning");function w(e,...t){v(P(e,...t))}const I=C("Error");function R(e,...t){g(I(e,...t))}const D=C("Assert");function N(e,t,...n){e||x(!1,D(t,...n))}let O;function M(e,...t){return I(e,...t)}function z(){return!!c.profiler&&c.profiler.isShowingStats()}function L(e){c.profiler&&(e?c.profiler.showStats():c.profiler.hideStats(),c.game.config.showFPS=!!e)}!function(e){e[e.NONE=0]="NONE",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.INFO_FOR_WEB_PAGE=5]="INFO_FOR_WEB_PAGE",e[e.WARN_FOR_WEB_PAGE=6]="WARN_FOR_WEB_PAGE",e[e.ERROR_FOR_WEB_PAGE=7]="ERROR_FOR_WEB_PAGE"}(O||(O=e("fS",{})));var F=Object.freeze({__proto__:null,log:A,warn:v,error:g,assert:x,debug:y,_resetDebugSetting:b,_throw:S,logID:T,warnID:w,errorID:R,assertID:N,get DebugMode(){return O},getError:M,isDisplayStats:z,setDisplayStats:L});class B{constructor(e){this.i=0,this.array=e}get length(){return this.array.length}set length(e){this.array.length=e,this.i>=e&&(this.i=e-1)}remove(e){const t=this.array.indexOf(e);t>=0&&this.removeAt(t)}removeAt(e){this.array.splice(e,1),e<=this.i&&--this.i}fastRemove(e){const t=this.array.indexOf(e);t>=0&&this.fastRemoveAt(t)}fastRemoveAt(e){const t=this.array;t[e]=t[t.length-1],--t.length,e<=this.i&&--this.i}push(e){this.array.push(e)}}function k(e,t){e.splice(t,1)}function U(e,t){const n=e.length;t<0||t>=n||(e[t]=e[n-1],e.length=n-1)}function G(e,t){const n=e.indexOf(t);return n>=0&&(k(e,n),!0)}function j(e,t){const n=e.findIndex(t);if(n>=0){const t=e[n];return k(e,n),t}}function V(e,t){return e.indexOf(t)>=0}var H=Object.freeze({__proto__:null,removeAt:k,fastRemoveAt:U,remove:G,fastRemove:function(e,t){const n=e.indexOf(t);n>=0&&(e[n]=e[e.length-1],--e.length)},removeIf:j,verifyType:function(e,t){if(e&&e.length>0)for(const n of e)if(!(n instanceof t))return T(1300),!1;return!0},removeArray:function(e,t){for(let n=0,i=t.length;n<i;n++)G(e,t[n])},appendObjectsAt:function(e,t,n){return e.splice.apply(e,[n,0,...t]),e},contains:V,copy:function(e){const t=e.length,n=new Array(t);for(let i=0;i<t;i+=1)n[i]=e[i];return n},MutableForwardIterator:B});class W{constructor(e){this.id=void 0,this.prefix=void 0,this.id=0|998*Math.random(),this.prefix=e?e+".":""}getNewId(){return this.prefix+ ++this.id}}W.global=new W("global");const q=new W("TmpCId."),Y="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]"),X="__cid__";function Q(e){return"number"==typeof e||e instanceof Number}function Z(e){return"string"==typeof e||e instanceof String}function J(e){for(const t in e)return!1;return!0}const K=(()=>{const e={value:void 0,enumerable:!1,writable:!1,configurable:!0};return(t,n,i,o,a)=>{e.value=i,e.writable=o,e.enumerable=a,Object.defineProperty(t,n,e),e.value=void 0}})(),$=(()=>{const e={get:void 0,set:void 0,enumerable:!1};return(t,n,i,o,a=!1,r=!1)=>{"boolean"==typeof o&&(a=o,o=void 0),e.get=i,e.set=o,e.enumerable=a,e.configurable=r,Object.defineProperty(t,n,e),e.get=void 0,e.set=void 0}})(),ee=(()=>{const e={get:void 0,enumerable:!1,configurable:!1};return(t,n,i,o,a)=>{e.get=i,e.enumerable=o,e.configurable=a,Object.defineProperty(t,n,e),e.get=void 0}})(),te=(()=>{const e={set:void 0,enumerable:!1,configurable:!1};return(t,n,i,o,a)=>{e.set=i,e.enumerable=o,e.configurable=a,Object.defineProperty(t,n,e),e.set=void 0}})();function ne(e){const t=Object.create(null);if(e){const e=".",n="/";t[e]=1,t[n]=1,delete t[e],delete t[n]}return t}function ie(e){if("function"==typeof e){const t=e.prototype;if(t&&t.hasOwnProperty("__classname__")&&t.__classname__)return t.__classname__;let n="";if(e.name&&(n=e.name),e.toString){let t;const i=e.toString();t="["===i.charAt(0)?i.match(/\[\w+\s*(\w+)\]/):i.match(/function\s*(\w+)/),t&&2===t.length&&(n=t[1])}return"Object"!==n?n:""}return e&&e.constructor?ie(e.constructor):""}function oe(e,t,n,i){const o=/([^.]+)$/,a=o.exec(t)[0],r=o.exec(n)[0];function s(){return this[r]}i?$(e,a,s,(function(e){this[r]=e})):ee(e,a,s)}function ae(e,t,n,i){for(const o in n)oe(e,`${t}.${o}`,n[o],i)}const re=/(%d)|(%s)/,se=/%s/;function ce(e,...t){if(0===arguments.length)return"";if(0===t.length)return`${e}`;const n="string"==typeof e&&re.test(e);if(n)for(const n of t){const t="number"==typeof n?re:se;if(t.test(e)){const i=`${n}`;e=e.replace(t,i)}else e+=` ${n}`}else for(const n of t)e+=` ${n}`;return e}function le(){const e=arguments.length-1,t=new Array(e);for(let n=0;n<e;++n)t[n]=arguments[n+1];return t}function _e(e,t){for(;e;){const n=Object.getOwnPropertyDescriptor(e,t);if(n)return n;e=Object.getPrototypeOf(e)}return null}function ue(e,t,n){const i=_e(t,e);i&&Object.defineProperty(n,e,i)}function he(e,...t){e=e||{};for(const n of t)if(n){if("object"!=typeof n){R(5402,n);continue}for(const t in n)t in e||ue(t,n,e)}return e}function fe(e,...t){e=e||{};for(const n of t)if(n){if("object"!=typeof n){R(5403,n);continue}for(const t in n)ue(t,n,e)}return e}function pe(e,t){for(const n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e.prototype=Object.create(t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),e}function de(e){const t=e.prototype,n=t&&Object.getPrototypeOf(t);return n&&n.constructor}function me(e,t){if(e&&t){if("function"!=typeof e)return!1;if("function"!=typeof t)return!1;if(e===t)return!0;for(;;){if(!(e=de(e)))return!1;if(e===t)return!0}}return!1}function Ae(e){for(const t of Object.keys(e))delete e[t]}function ve(e){return"string"!=typeof e||e.startsWith(q.prefix)}const ge=ne(!0),xe=ne(!0);function ye(e,t){return function(n,i){if(i.prototype.hasOwnProperty(e)&&delete t[i.prototype[e]],K(i.prototype,e,n),n){const o=t[n];o&&o!==i?g(`A Class already exists with the same ${e} : "${n}".`):t[n]=i}}}const be=ye("__cid__",ge),Se=ye("__classname__",xe);function Ce(e,t){if(Se(e,t),!t.prototype.hasOwnProperty(X)){const n=e||q.getNewId();n&&be(n,t)}}function Ee(e,t){const n=xe[t],i=ge[t];let o=!0;if(n&&n!==e&&(g(`"${t}" has already been set as name or alias of another class.`),o=!1),i&&i!==e&&(g(`"${t}" has already been set as id or alias of another class.`),o=!1),o){let n=e[Y];n||(n=[],e[Y]=n),n.push(t),xe[t]=e,ge[t]=e}}function Te(...e){for(const t of e){const e=t.prototype,n=e.__cid__;n&&delete ge[n];const i=e.__classname__;i&&delete xe[i];const o=e[Y];if(o)for(let e=0;e<o.length;++e){const t=o[e];delete xe[t],delete ge[t]}}}function Pe(e){return ge[e]}function we(e){return xe[e]}function Ie(e,t){let n;if(t=void 0===t||t,"function"==typeof e&&e.prototype.hasOwnProperty(X))return n=e.prototype.__cid__,!t&&i&&ve(n)?"":n;if(e&&e.constructor){const o=e.constructor.prototype;if(o&&o.hasOwnProperty(X))return n=e.__cid__,!t&&i&&ve(n)?"":n}return""}class Re{get(){return this._get()}constructor(e,t){this.count=void 0,this._pool=void 0,this._cleanup=void 0;const n=void 0===t?e:t,i=void 0===t?null:e;this.count=0,this._pool=new Array(n),this._cleanup=i}_get(){if(this.count>0){--this.count;const e=this._pool[this.count];return this._pool[this.count]=null,e}return null}put(e){const t=this._pool;if(this.count<t.length){if(this._cleanup&&!1===this._cleanup(e))return;t[this.count]=e,++this.count}}resize(e){e>=0&&(this._pool.length=e,this.count>e&&(this.count=e))}}e("cY",Re);const De=e("dR",H),Ne=e("c6",{IDGenerator:W,Pool:Re,array:H,isNumber:Q,isString:Z,isEmptyObject:J,getPropertyDescriptor:_e,addon:he,mixin:fe,extend:pe,getSuper:de,isChildClassOf:me,clear:Ae,value:K,getset:$,get:ee,set:te,unregisterClass:Te,getClassName:ie,setClassName:Ce,setClassAlias:Ee,getClassByName:we,get _registeredClassNames(){return{...xe}},set _registeredClassNames(e){Ae(xe),Object.assign(xe,e)},get _registeredClassIds(){return{...ge}},set _registeredClassIds(e){Ae(ge),Object.assign(ge,e)},_getClassId:Ie,_setClassId:be,_getClassById:Pe,obsolete:oe,obsoletes:ae,formatStr:ce,shiftArguments:le,createMap:ne});c.js=Ne,e("fs",Object.freeze({__proto__:null,array:De,js:Ne,IDGenerator:W,Pool:Re,isNumber:Q,isString:Z,isEmptyObject:J,value:K,getset:$,get:ee,set:te,createMap:ne,getClassName:ie,obsolete:oe,obsoletes:ae,formatStr:ce,shiftArguments:le,getPropertyDescriptor:_e,addon:he,mixin:fe,extend:pe,getSuper:de,isChildClassOf:me,clear:Ae,_idToClass:ge,_nameToClass:xe,_setClassId:be,setClassName:Ce,setClassAlias:Ee,unregisterClass:Te,_getClassById:Pe,getClassByName:we,_getClassId:Ie}));const Oe=new class{constructor(){this._pools=[],this._lastShrinkPassed=0,this.shrinkTimeSpan=5}addContainer(e){-1===e._poolHandle&&(e._poolHandle=this._pools.length,this._pools.push(e))}removeContainer(e){-1!==e._poolHandle&&(this._pools[this._pools.length-1]._poolHandle=e._poolHandle,Ne.array.fastRemoveAt(this._pools,e._poolHandle),e._poolHandle=-1)}tryShrink(){for(let e=0;e<this._pools.length;e++)this._pools[e].tryShrink()}update(e){this._lastShrinkPassed+=e,this._lastShrinkPassed>this.shrinkTimeSpan&&(this.tryShrink(),this._lastShrinkPassed-=this.shrinkTimeSpan)}};class Me{constructor(){this._poolHandle=-1,Oe.addContainer(this)}destroy(){Oe.removeContainer(this)}}e("S",Me);class ze extends Me{constructor(e,t,n){super(),this._ctor=void 0,this._elementsPerBatch=void 0,this._nextAvail=void 0,this._freepool=[],this._dtor=void 0,this._ctor=e,this._dtor=n||null,this._elementsPerBatch=Math.max(t,1),this._nextAvail=this._elementsPerBatch-1;for(let t=0;t<this._elementsPerBatch;++t)this._freepool.push(e())}alloc(){if(this._nextAvail<0){this._freepool.length=this._elementsPerBatch;for(let e=0;e<this._elementsPerBatch;e++)this._freepool[e]=this._ctor();this._nextAvail=this._elementsPerBatch-1}return this._freepool[this._nextAvail--]}free(e){this._freepool[++this._nextAvail]=e}freeArray(e){this._freepool.length=this._nextAvail+1,Array.prototype.push.apply(this._freepool,e),this._nextAvail+=e.length}tryShrink(){if(this._nextAvail>>1>this._elementsPerBatch){if(this._dtor)for(let e=this._nextAvail>>1;e<=this._nextAvail;e++)this._dtor(this._freepool[e]);this._freepool.length=this._nextAvail>>1,this._nextAvail=this._freepool.length-1}}destroy(){const e=arguments.length>0?arguments[0]:null;e&&w(14100);const t=e||this._dtor;if(t)for(let e=0;e<=this._nextAvail;e++)t(this._freepool[e]);this._freepool.length=0,this._nextAvail=-1,super.destroy()}}e("P",ze);class Le extends Me{constructor(e,t,n){super(),this._fn=void 0,this._dtor=null,this._count=0,this._data=void 0,this._initSize=0,this._fn=e,this._dtor=n||null,this._data=new Array(t),this._initSize=t;for(let n=0;n<t;++n)this._data[n]=e()}get length(){return this._count}get data(){return this._data}reset(){this._count=0}resize(e){if(e>this._data.length)for(let t=this._data.length;t<e;++t)this._data[t]=this._fn()}add(){return this._count>=this._data.length&&this.resize(this._data.length<<1),this._data[this._count++]}destroy(){if(this._dtor)for(let e=0;e<this._data.length;e++)this._dtor(this._data[e]);this._data.length=0,this._count=0,super.destroy()}tryShrink(){if(this._data.length>>2>this._count){const e=Math.max(this._initSize,this._data.length>>1);if(this._dtor)for(let t=e;t<this._data.length;t++)this._dtor(this._data[t]);this._data.length=e}}removeAt(e){if(e>=this._count)return;const t=this._count-1,n=this._data[e];this._data[e]=this._data[t],this._data[t]=n,this._count-=1}}function Fe(e){if("__bitmask__"in e)return e;K(e,"__bitmask__",null,!0);let t=-1;const n=Object.keys(e);for(let i=0;i<n.length;i++){const o=n[i];let a=e[o];if(-1===a)a=++t,e[o]=a;else if("number"==typeof a)t=a;else if("string"==typeof a&&Number.isInteger(parseFloat(o)))continue;const r=`${a}`;o!==r&&K(e,r,o)}return e}function Be(e,t){t>=0&&e.length,e.length}function ke(e){return"__enums__"in e?e:(K(e,"__enums__",null,!0),ke.update(e))}function Ue(e){e.hasOwnProperty("__enums__")}function Ge(e){Ue(e);const t=e.__enums__||[];t.length=0;for(const n in e){const i=e[n];Number.isInteger(i)&&t.push({name:n,value:i})}return t.sort(((e,t)=>e.value-t.value)),e.__enums__=t,t}function je(e){"__enums__"in e||K(e,"__enums__",null,!0)}e("R",Le),Fe.isBitMask=e=>e&&e.hasOwnProperty("__bitmask__"),Fe.getList=e=>{if(e.__bitmask__)return e.__bitmask__;const t=e.__bitmask__=[];for(const n in e){const i=e[n];Number.isInteger(i)&&t.push({name:n,value:i})}return t.sort(((e,t)=>e.value-t.value)),t},c.BitMask=Fe,ke.update=e=>{let t=-1;const n=Object.keys(e);for(let i=0;i<n.length;i++){const o=n[i];let a=e[o];if(-1===a)a=++t,e[o]=a;else if("number"==typeof a)t=a;else if("string"==typeof a&&Number.isInteger(parseFloat(o)))continue;const r=`${a}`;o!==r&&K(e,r,o)}return Array.isArray(e.__enums__)&&Ge(e),e},ke||(ke=e("bM",{})),ke.isEnum=e=>e&&e.hasOwnProperty("__enums__"),ke.getList=e=>(Ue(e),e.__enums__?e.__enums__:Ge(e)),c.Enum=ke;class Ve{clone(){return R(100,`${ie(this)}.clone`),this}equals(e){return!1}set(e){R(100,`${ie(this)}.set`)}toString(){return`${{}}`}}e("fr",Ve),Ce("cc.ValueType",Ve),c.ValueType=Ve;const He=e("bz",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,ENABLE_ANTIALIAS_FXAA:!1,ENABLE_BLOOM:!1,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20,ENABLE_WEBGL_HIGHP_STRUCT_VALUES:!1,BATCHER2D_MEM_INCREMENT:144});c.macro=He;const We=/^(?:cc|dragonBones|sp|ccsg)\..+/,qe=new Array(123);for(let e=0;e<123;++e)qe[e]=64;for(let e=0;e<64;++e)qe["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(e)]=e;const Ye=qe;function Xe(e,t,n){function i(e,t,n,i){const o=Object.getOwnPropertyDescriptor(e,t);if(o)o.get&&(e[n]=o.get),o.set&&i&&(e[i]=o.set);else{const o=e[n];$(e,t,o,e[i])}}let o;const a=e.prototype;for(let e=0;e<t.length;e++){o=t[e];const n=o[0].toUpperCase()+o.slice(1);i(a,o,`get${n}`,`set${n}`)}for(o in n){const e=n[o];i(a,o,e[0],e[1])}}function Qe(e,t,n,i){const o=e[t];o?Array.isArray(o)?i?(o.push(o[0]),o[0]=n):o.push(n):e[t]=i?[n,o]:[o,n]:e[t]=n}function Ze(e,t){if("function"==typeof e.contains)return e.contains(t);if("function"==typeof e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));{let n=t.parentNode;if(n)do{if(n===e)return!0;n=n.parentNode}while(null!==n);return!1}}function Je(e){return"object"==typeof window&&"function"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName}function Ke(e,t,n){e&&setTimeout((()=>{e(t,n)}),0)}function $e(e){return!(!e||e.constructor!==Object)&&J(e)}function et(e,t,n){if(t>n){const e=t;t=n,n=e}return e<t?t:e<n?e:n}function tt(e){return e*He.RAD}function nt(e){return e*He.DEG}c.misc={BUILTIN_CLASSID_RE:We,BASE64_VALUES:Ye,propertyDefine:Xe,pushToMap:Qe,contains:Ze,isDomNode:Je,callInNextTick:Ke,isPlainEmptyObj_DEV:$e,clampf:et,degreesToRadians:tt,radiansToDegrees:nt},e("ft",Object.freeze({__proto__:null,BUILTIN_CLASSID_RE:We,BASE64_VALUES:Ye,propertyDefine:Xe,pushToMap:Qe,contains:Ze,isDomNode:Je,callInNextTick:Ke,tryCatchFunctor_EDITOR:function(e){return Function("target",`try {\n  target.${e}();\n}\ncatch (e) {\n  cc._throw(e);\n}`)},isPlainEmptyObj_DEV:$e,clampf:et,degreesToRadians:tt,radiansToDegrees:nt}));const it="$_$";function ot(e,t){const n=t?Object.create(t):{};return K(e,"__attrs__",n),n}function at(e){if("function"!=typeof e)return ot(e,st(e.constructor));let t;const n=c.Class.getInheritanceChain(e);for(let e=n.length-1;e>=0;e--){const i=n[e];i.hasOwnProperty("__attrs__")&&i.__attrs__||(t=n[e+1],ot(i,t&&t.__attrs__))}return t=n[0],ot(e,t&&t.__attrs__),e.__attrs__}function rt(e,t){const n=st(e),i=t+it,o={};for(const e in n)e.startsWith(i)&&(o[e.slice(i.length)]=n[e]);return o}function st(e){return e.hasOwnProperty("__attrs__")&&e.__attrs__||at(e)}function ct(e,t,n,i){st(e)[t+it+n]=i}class lt{constructor(e,t){this.name=void 0,this.default=void 0,this.name=e,this.default=t}toString(){return this.name}}const _t=e("e_",new lt("Integer",0));c.Integer=_t,c.CCInteger=_t;const ut=e("eO",new lt("Float",0));c.Float=ut,c.CCFloat=ut;const ht=e("eN",new lt("Boolean",!1));c.Boolean=ht,c.CCBoolean=ht;const ft=e("cG",new lt("String",""));function pt(e,t){return function(n,i){const o=`"${ie(n)}.${i}"`,a=rt(n,i);let r=a.type;if(r===_t||r===ut?r="Number":r!==ft&&r!==ht||(r=`${r}`),r!==e)return void w(3604,o);if(!a.hasOwnProperty("default"))return;const s=a.default;if(void 0===s)return;if(Array.isArray(s)||$e(s))return;const c=typeof s,l=e.toLowerCase();if(c===l)if("object"===l){if(!s||s instanceof a.ctor)return;w(3605,o,ie(a.ctor))}else"Number"!==e&&w(3606,t,o,e);else{if("function"===c)return;e===ft.default&&null==s?w(3607,o):w(3611,t,o,c)}delete a.type}}c.String=ft,c.CCString=ft;var dt=Object.freeze({__proto__:null,DELIMETER:it,createAttrsSingle:ot,createAttrs:at,attr:rt,getClassAttrs:st,setClassAttr:ct,PrimitiveType:lt,CCInteger:_t,CCFloat:ut,CCBoolean:ht,CCString:ft,getTypeChecker_ET:pt,getObjTypeChecker_ET:function(e){return function(t,n){pt("Object","type")(t,n);const i=st(t)[`${n+it}default`],o=c.Class.getDefault(i);if(!Array.isArray(o)&&me(e,c.ValueType)){const o=ie(e),a=ce('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',ie(t),n,o);i?A(a):w(3612,a,o,ie(t),n,o)}}}});const mt={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function At(e,t,n,i){if(!e.get&&!e.set&&e.hasOwnProperty("default")){const o=`_N$${t}`;e.get=function(){return this[o]},e.set=function(e){const t=this[o];this[o]=e,n.call(this,t)};const a={};i[o]=a;for(const t in mt){const n=mt[t];e.hasOwnProperty(t)&&(a[t]=e[t],n.canUsedInGet||delete e[t])}}}function vt(e,t,n,i){if(Array.isArray(t)){if(!(t.length>0))return R(5508,n,i);e.type=t=t[0]}"function"==typeof t&&(t===String?e.type=c.String:t===Boolean?e.type=c.Boolean:t===Number&&(e.type=c.Float))}function gt(e,t,n){const i=e?{_short:!0}:{_short:!0,default:t};return n&&(i.type=n),i}function xt(e,t){if(!e||e.constructor!==Object){if(Array.isArray(e)&&e.length>0)return gt(t,[],e);if("function"==typeof e){const n=e;return gt(t,me(n,c.ValueType)?new n:null,n)}return gt(t,e instanceof lt?e.default:e)}return null}let yt=[];function bt(){return yt[yt.length-1]}c._RF={push:function(e,t,n,i){void 0===n&&(n=t,t=""),yt.push({uuid:t,script:n,module:e,exports:e.exports,beh:null,importMeta:i})},pop:function(){const e=yt.pop(),t=e.module;let n=t.exports;if(n===e.exports){for(const e in n)return;t.exports=n=e.cls}},peek:bt};const St=it,Ct={datas:null,push(e){if(this.datas)this.datas.push(e);else{this.datas=[e];const t=this;setTimeout((()=>{t.init()}),0)}},init(){const e=this.datas;if(e){for(let t=0;t<e.length;++t){const n=e[t],i=n.cls;let o=n.props;"function"==typeof o&&(o=o());const a=ie(i);o?It(i,a,o,i.$super,n.mixins):R(3633,a)}this.datas=null}}};function Et(e,t,n,i){!function(e,t){!function(e,t){e.indexOf(t)<0&&e.push(t)}(e.__props__,t)}(e,n),Nt(e,i,t,n)}function Tt(e,t,n,i){const o=i.get;i.set,o&&(Nt(e,i,t,n),ct(e,n,"serializable",!1))}function Pt(e){return"function"==typeof e?e():e}function wt(e,t,n){for(const i in t)e.hasOwnProperty(i)||n&&!n(i)||Object.defineProperty(e,i,_e(t,i))}function It(e,t,n,i,o){if(e.__props__=[],i&&i.__props__&&(e.__props__=i.__props__.slice()),o)for(let t=0;t<o.length;++t){const n=o[t];n.__props__&&(e.__props__=e.__props__.concat(n.__props__.filter((t=>e.__props__.indexOf(t)<0))))}if(n){!function(e,t){for(const n in e){let i=e[n];const o=xt(i,!1);if(o&&(i=e[n]=o),i){const o=i.notify;o&&At(i,n,o,e),"type"in i&&vt(i,i.type,t,n)}}}(n,t);for(const i in n){const o=n[i];o.get||o.set?Tt(e,t,i,o):Et(e,t,i,o)}}const a=st(e);e.__values__=e.__props__.filter((e=>!1!==a[`${e+St}serializable`]))}function Rt(e){let t=e.name;const n=e.extends,i=e.mixins,o=function(e,t,n,i){const o=c.Component,a=bt();if(a&&me(t,o)){if(me(a.cls,o))return R(3615),null;e=e||a.script}const r=function(e,t,n,i){const o=i.ctor,a=[o],r=o;K(r,"__ctors__",a.length>0?a:null,!0);const s=r.prototype;if(t&&(r.$super=t),n){for(let e=n.length-1;e>=0;e--){const t=n[e];wt(s,t.prototype),Rt._isCCClass(t)&&wt(st(r),st(t))}s.constructor=r}return Ce(e,r),r}(e,t,n,i);if(a)if(me(t,o)){const e=a.uuid;e&&be(e,r),a.cls=r}else me(a.cls,o)||(a.cls=r);return r}(t,n,i,e);t||(t=c.js.getClassName(o)),o._sealed=!0,n&&(n._sealed=!1);const a=e.properties;"function"==typeof a||n&&null===n.__props__||i&&i.some((e=>null===e.__props__))?(Ct.push({cls:o,props:a,mixins:i}),o.__props__=o.__values__=null):It(o,t,a,n,e.mixins);const r=e.editor;return r&&me(n,c.Component)&&c.Component._registerEditorProps(o,r),o}Rt._isCCClass=function(e){var t;return null==e||null===(t=e.hasOwnProperty)||void 0===t?void 0:t.call(e,"__ctors__")},Rt.fastDefine=function(e,t,n){Ce(e,t);const i=t.__props__=t.__values__=Object.keys(n),o=st(t);for(let e=0;e<i.length;e++){const t=i[e];o[`${t+St}visible`]=!1,o[`${t+St}default`]=n[t]}},Rt.Attr=dt,Rt.attr=rt,Rt.getInheritanceChain=function(e){const t=[];for(;e=de(e);)e!==Object&&t.push(e);return t};const Dt={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function Nt(e,t,n,i){let o=null,a="";function r(){return a=i+St,o=st(e)}"type"in t&&void 0===t.type&&w(3660,i,n);const s=t.type;s&&(Dt[s]?(o||r())[`${a}type`]=s:"Object"===s||("object"==typeof s?ke.isEnum(s)?((o||r())[`${a}type`]="Enum",o[`${a}enumList`]=ke.getList(s)):Fe.isBitMask(s)&&((o||r())[`${a}type`]="BitMask",o[`${a}bitmaskList`]=Fe.getList(s)):"function"==typeof s&&((o||r())[`${a}type`]="Object",o[`${a}ctor`]=s))),"default"in t&&((o||r())[`${a}default`]=t.default);const c=(e,n)=>{if(e in t){const i=t[e];typeof i===n&&((o||r())[a+e]=i)}};var l;t.editorOnly&&((o||r())[`${a}editorOnly`]=!0),t.__noImplicit?(o||r())[`${a}serializable`]=null!==(l=t.serializable)&&void 0!==l&&l:!1===t.serializable&&((o||r())[`${a}serializable`]=!1),c("formerlySerializedAs","string");const _=t.range;_&&Array.isArray(_)&&_.length>=2&&((o||r())[`${a}min`]=_[0],o[`${a}max`]=_[1],_.length>2&&(o[`${a}step`]=_[2])),c("min","number"),c("max","number"),c("step","number")}Rt.isArray=function(e){return e=Pt(e),Array.isArray(e)},Rt.getDefault=Pt,Rt.escapeForJS=function(e){return JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},Rt.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,Rt.getNewValueTypeCode=function(e){const t=ie(e),n=e.constructor;let i=`new ${t}(`;for(let t=0;t<n.__props__.length;t++)i+=e[n.__props__[t]],t<n.__props__.length-1&&(i+=",");return`${i})`},c.Class=Rt;const Ot=e("fE","__editorExtras__"),Mt=1<<22,zt=[];class Lt{static _deferredDestroy(){const e=zt.length;for(let t=0;t<e;++t){const e=zt[t];1&e._objFlags||e._destroyImmediate()}e===zt.length?zt.length=0:zt.splice(0,e)}constructor(e=""){this._objFlags=void 0,this._name=void 0,this._name=e,this._objFlags=0}get name(){return this._name}set name(e){this._name=e}set hideFlags(e){const t=e&Lt.Flags.AllHideMasks;this._objFlags=this._objFlags&~Lt.Flags.AllHideMasks|t}get hideFlags(){return this._objFlags&Lt.Flags.AllHideMasks}set replicated(e){e?this._objFlags|=Mt:this._objFlags&=-4194305}get replicated(){return!!(this._objFlags&Mt)}get isValid(){return!(1&this._objFlags)}destroy(){return 1&this._objFlags?(w(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,zt.push(this),0))}_destruct(){const e=this.constructor;let t=e.__destruct__;t||(t=function(e,t){const n=e instanceof c._BaseNode||e instanceof c.Component,i=n?"_id":null;let o;const a={};for(o in e)if(e.hasOwnProperty(o)){if(o===i)continue;switch(typeof e[o]){case"string":a[o]="";break;case"object":case"function":a[o]=null}}if(Rt._isCCClass(t)){const e=c.Class.Attr.getClassAttrs(t),i=t.__props__;for(let t=0;t<i.length;t++){o=i[t];const r=`${o+c.Class.Attr.DELIMETER}default`;if(r in e){if(n&&"_id"===o)continue;switch(typeof e[r]){case"string":a[o]="";break;case"object":case"function":a[o]=null;break;case"undefined":a[o]=void 0}}}}{let e="";for(o in a){let t;t=Rt.IDENTIFIER_RE.test(o)?`o.${o}=`:`o[${Rt.escapeForJS(o)}]=`;let n=a[o];""===n&&(n='""'),e+=`${t+n};\n`}return Function("o",e)}}(this,e),K(e,"__destruct__",t,!0)),t(this)}_destroyImmediate(){1&this._objFlags?R(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)}}e("d9",Lt);const Ft=Lt.prototype;function Bt(e,t){return"object"==typeof e?!(!e||e._objFlags&(t?5:1)):void 0!==e}Ft._deserialize=null,Ft._onPreDestroy=null,Rt.fastDefine("cc.Object",Lt,{_name:"",_objFlags:0,[Ot]:{}}),Rt.Attr.setClassAttr(Lt,Ot,"editorOnly",!0),Rt.Attr.setClassAttr(Lt,"replicated","visible",!1),K(Lt,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,AllHideMasks:1560,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20}),c.isValid=Bt,c.Object=Lt;const kt=De.fastRemoveAt;function Ut(){}class Gt{constructor(){this.callback=Ut,this.target=void 0,this.once=!1}set(e,t,n){this.callback=e||Ut,this.target=t,this.once=!!n}reset(){this.target=void 0,this.callback=Ut,this.once=!1}check(){return!(this.target instanceof Lt&&!Bt(this.target,!0))}}const jt=new ze((()=>new Gt),32);class Vt{constructor(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}removeByCallback(e){for(let t=0;t<this.callbackInfos.length;++t){const n=this.callbackInfos[t];n&&n.callback===e&&(n.reset(),jt.free(n),kt(this.callbackInfos,t),--t)}}removeByTarget(e){for(let t=0;t<this.callbackInfos.length;++t){const n=this.callbackInfos[t];n&&n.target===e&&(n.reset(),jt.free(n),kt(this.callbackInfos,t),--t)}}cancel(e){const t=this.callbackInfos[e];t&&(t.reset(),this.isInvoking?this.callbackInfos[e]=null:kt(this.callbackInfos,e),jt.free(t)),this.containCanceled=!0}cancelAll(){for(let e=0;e<this.callbackInfos.length;e++){const t=this.callbackInfos[e];t&&(t.reset(),jt.free(t),this.callbackInfos[e]=null)}this.containCanceled=!0}purgeCanceled(){for(let e=this.callbackInfos.length-1;e>=0;--e)this.callbackInfos[e]||kt(this.callbackInfos,e);this.containCanceled=!1}clear(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1}}const Ht=new ze((()=>new Vt),16);class Wt{constructor(){this._callbackTable=ne(!0),this._offCallback=void 0}on(e,t,n,i){if(!this.hasEventListener(e,t,n)){let o=this._callbackTable[e];o||(o=this._callbackTable[e]=Ht.alloc());const a=jt.alloc();a.set(t,n,i),o.callbackInfos.push(a)}return t}hasEventListener(e,t,n){const i=this._callbackTable&&this._callbackTable[e];if(!i)return!1;const o=i.callbackInfos;if(!t){if(i.isInvoking){for(let e=0;e<o.length;++e)if(o[e])return!0;return!1}return o.length>0}for(let e=0;e<o.length;++e){const i=o[e];if(i&&i.check()&&i.callback===t&&i.target===n)return!0}return!1}removeAll(e){const t=typeof e;if("string"===t||"number"===t){const t=this._callbackTable&&this._callbackTable[e];t&&(t.isInvoking?t.cancelAll():(t.clear(),Ht.free(t),delete this._callbackTable[e]))}else if(e)for(const t in this._callbackTable){const n=this._callbackTable[t];if(n.isInvoking){const t=n.callbackInfos;for(let i=0;i<t.length;++i){const o=t[i];o&&o.target===e&&n.cancel(i)}}else n.removeByTarget(e)}}off(e,t,n){var i;const o=this._callbackTable&&this._callbackTable[e];if(o){const i=o.callbackInfos;if(t)for(let e=0;e<i.length;++e){const a=i[e];if(a&&a.callback===t&&a.target===n){o.cancel(e);break}}else this.removeAll(e)}null===(i=this._offCallback)||void 0===i||i.call(this)}emit(e,t,n,i,o,a){const r=this._callbackTable&&this._callbackTable[e];if(r){const s=!r.isInvoking;r.isInvoking=!0;const c=r.callbackInfos;for(let r=0,s=c.length;r<s;++r){const s=c[r];if(s){const r=s.callback,c=s.target;s.once&&this.off(e,r,c),s.check()?c?r.call(c,t,n,i,o,a):r(t,n,i,o,a):this.off(e,r,c)}}s&&(r.isInvoking=!1,r.containCanceled&&r.purgeCanceled())}}clear(){for(const e in this._callbackTable){const t=this._callbackTable[e];t&&(t.clear(),Ht.free(t),delete this._callbackTable[e])}}_registerOffCallback(e){this._offCallback=e}}function qt(e){class t extends e{constructor(...e){super(...e),this._callbackTable=ne(!0)}once(e,t,n){return this.on(e,t,n,!0)}targetOff(e){this.removeAll(e)}}const n=Wt.prototype,i=Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n));for(let e=0;e<i.length;++e){const o=i[e];if(!(o in t.prototype)){const e=Object.getOwnPropertyDescriptor(n,o);e&&Object.defineProperty(t.prototype,o,e)}}return t}const Yt=e("eC",qt(class{}));let Xt,Qt,Zt,Jt,Kt,$t;c.EventTarget=Yt,function(e){e.UNKNOWN="unknown",e.WECHAT="wechat",e.ANDROID="androidbrowser",e.IE="ie",e.EDGE="edge",e.QQ="qqbrowser",e.MOBILE_QQ="mqqbrowser",e.UC="ucbrowser",e.UCBS="ucbs",e.BROWSER_360="360browser",e.BAIDU_APP="baiduboxapp",e.BAIDU="baidubrowser",e.MAXTHON="maxthon",e.OPERA="opera",e.OUPENG="oupeng",e.MIUI="miuibrowser",e.FIREFOX="firefox",e.SAFARI="safari",e.CHROME="chrome",e.LIEBAO="liebao",e.QZONE="qzone",e.SOUGOU="sogou",e.HUAWEI="huawei"}(Xt||(Xt=e("bx",{}))),function(e){e.UNKNOWN="unknown",e.ENGLISH="en",e.CHINESE="zh",e.FRENCH="fr",e.ITALIAN="it",e.GERMAN="de",e.SPANISH="es",e.DUTCH="du",e.RUSSIAN="ru",e.KOREAN="ko",e.JAPANESE="ja",e.HUNGARIAN="hu",e.PORTUGUESE="pt",e.ARABIC="ar",e.NORWEGIAN="no",e.POLISH="pl",e.TURKISH="tr",e.UKRAINIAN="uk",e.ROMANIAN="ro",e.BULGARIAN="bg"}(Qt||(Qt={})),function(e){e[e.NONE=0]="NONE",e[e.LAN=1]="LAN",e[e.WWAN=2]="WWAN"}(Zt||(Zt={})),function(e){e.UNKNOWN="Unknown",e.IOS="iOS",e.ANDROID="Android",e.WINDOWS="Windows",e.LINUX="Linux",e.OSX="OS X",e.OHOS="OHOS"}(Jt||(Jt=e("bw",{}))),function(e){e.UNKNOWN="UNKNOWN",e.EDITOR_PAGE="EDITOR_PAGE",e.EDITOR_CORE="EDITOR_CORE",e.MOBILE_BROWSER="MOBILE_BROWSER",e.DESKTOP_BROWSER="DESKTOP_BROWSER",e.WIN32="WIN32",e.ANDROID="ANDROID",e.IOS="IOS",e.MACOS="MACOS",e.OHOS="OHOS",e.WECHAT_GAME="WECHAT_GAME",e.BAIDU_MINI_GAME="BAIDU_MINI_GAME",e.XIAOMI_QUICK_GAME="XIAOMI_QUICK_GAME",e.ALIPAY_MINI_GAME="ALIPAY_MINI_GAME",e.BYTEDANCE_MINI_GAME="BYTEDANCE_MINI_GAME",e.OPPO_MINI_GAME="OPPO_MINI_GAME",e.VIVO_MINI_GAME="VIVO_MINI_GAME",e.HUAWEI_QUICK_GAME="HUAWEI_QUICK_GAME",e.COCOSPLAY="COCOSPLAY",e.LINKSURE_MINI_GAME="LINKSURE_MINI_GAME",e.QTT_MINI_GAME="QTT_MINI_GAME"}(Kt||(Kt=e("eD",{}))),function(e){e.WEBP="WEBP",e.IMAGE_BITMAP="IMAGE_BITMAP",e.WEB_VIEW="WEB_VIEW",e.VIDEO_PLAYER="VIDEO_PLAYER",e.SAFE_AREA="SAFE_AREA",e.INPUT_TOUCH="INPUT_TOUCH",e.EVENT_KEYBOARD="EVENT_KEYBOARD",e.EVENT_MOUSE="EVENT_MOUSE",e.EVENT_TOUCH="EVENT_TOUCH",e.EVENT_ACCELEROMETER="EVENT_ACCELEROMETER"}($t||($t={}));const en={0:Zt.NONE,1:Zt.LAN,2:Zt.WWAN},tn={0:Kt.WIN32,2:Kt.MACOS,3:Kt.ANDROID,4:Kt.IOS,5:Kt.IOS,6:Kt.OHOS},nn=e("bv",new class extends Yt{get networkType(){return en[jsb.device.getNetworkType()]}constructor(){super(),this.isNative=void 0,this.isBrowser=void 0,this.isMobile=void 0,this.isLittleEndian=void 0,this.platform=void 0,this.language=void 0,this.nativeLanguage=void 0,this.os=void 0,this.osVersion=void 0,this.osMainVersion=void 0,this.browserType=void 0,this.browserVersion=void 0,this._featureMap=void 0,this.isNative=!0,this.isBrowser=!1,this.platform=tn[__getPlatform()],this.isMobile=this.platform===Kt.ANDROID||this.platform===Kt.IOS||this.platform===Kt.OHOS,this.isLittleEndian=(()=>{const e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]})();const e=__getCurrentLanguageCode();this.nativeLanguage=e?e.toLowerCase():Qt.UNKNOWN,this.language=__getCurrentLanguage(),this.os=__getOS(),this.osVersion=__getOSVersion(),this.osMainVersion=parseInt(this.osVersion),this.browserType=Xt.UNKNOWN,this.browserVersion="",this._featureMap={[$t.WEBP]:!0,[$t.IMAGE_BITMAP]:!1,[$t.WEB_VIEW]:this.isMobile,[$t.VIDEO_PLAYER]:this.isMobile,[$t.SAFE_AREA]:this.isMobile,[$t.INPUT_TOUCH]:this.isMobile,[$t.EVENT_KEYBOARD]:!0,[$t.EVENT_MOUSE]:!this.isMobile,[$t.EVENT_TOUCH]:!0,[$t.EVENT_ACCELEROMETER]:this.isMobile},this._registerEvent()}_registerEvent(){jsb.onPause=()=>{this.emit("hide"),c.internal.SplashScreen.instance.pauseRendering()},jsb.onResume=()=>{this.emit("show"),c.internal.SplashScreen.instance.resumeRendering()},jsb.onClose=()=>{this.emit("close")}}hasFeature(e){return this._featureMap[e]}getBatteryLevel(){return jsb.device.getBatteryLevel()}triggerGC(){jsb.garbageCollect()}openURL(e){jsb.openURL(e)}now(){return Date.now?Date.now():+new Date}restartJSVM(){__restartVM()}close(){__close()}}),on=/(\.[^\.\/\?\\]*)(\?.*)?$/,an=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,rn=/[^\.\/]+\/\.\.\//;function sn(...e){let t="";for(const n of e)t=(t+(""===t?"":"/")+n).replace(/(\/|\\\\)$/,"");return t}function cn(e){const t=on.exec(e);return t?t[1]:""}function ln(e){if(e){const t=e.lastIndexOf(".");if(-1!==t)return e.substring(0,t)}return e}function _n(e,t){const n=e.indexOf("?");n>0&&(e=e.substring(0,n));const i=/(\/|\\)([^\/\\]+)$/g.exec(e.replace(/(\/|\\)$/,""));if(!i)return e;const o=i[2];return t&&e.substring(e.length-t.length).toLowerCase()===t.toLowerCase()?o.substring(0,o.length-t.length):o}function un(e){const t=an.exec(e);return t?t[2]:""}function hn(e,t){t=t||"";let n=e.indexOf("?"),i="";return n>0&&(i=e.substring(n),e=e.substring(0,n)),n=e.lastIndexOf("."),n<0?e+t+i:e.substring(0,n)+t+i}function fn(e,t,n){if(0===t.indexOf("."))return hn(e,t);let i=e.indexOf("?"),o="";const a=n?cn(e):"";return i>0&&(o=e.substring(i),e=e.substring(0,i)),i=e.lastIndexOf("/"),i=i<=0?0:i+1,e.substring(0,i)+t+a+o}function pn(e){let t=e=String(e);do{t=e,e=e.replace(rn,"")}while(t.length!==e.length);return e}function dn(e){return e.replace(/[\/\\]$/,"")}function mn(){return nn.os===Jt.WINDOWS?"\\":"/"}e("fu",Object.freeze({__proto__:null,join:sn,extname:cn,mainFileName:ln,basename:_n,dirname:un,changeExtname:hn,changeBasename:fn,_normalize:pn,stripSep:dn,getSeperator:mn})),c.log=A,c.warn=v,c.error=g,c.assert=x,c._throw=S,c.logID=T,c.warnID=w,c.errorID=R,c.assertID=N,c.debug=F,c.path={join:sn,extname:cn,mainFileName:ln,basename:_n,dirname:un,changeExtname:hn,changeBasename:fn,_normalize:pn,stripSep:dn,get sep(){return mn()}};let An=0;const vn={};var gn={addStage(e){if(void 0!==vn[e])return;const t=1<<An;vn[e]=t,An+=1},stageID(e){const t=vn[e];return void 0===t?-1:t},stageIDs(e){let t=0;for(const n of e){const e=vn[n];void 0!==e&&(t|=e)}return t}};const xn=e("e4",2147483647);function yn(e){return(e>0)-(e<0)}function bn(e){let t,n;return t=(e>65535)<<4,n=((e>>>=t)>255)<<3,t|=n,n=((e>>>=n)>15)<<2,t|=n,n=((e>>>=n)>3)<<1,t|=n,t|(e>>>=n)>>1}function Sn(e){let t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}function Cn(e){return--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)}const En=new Array(256);(e=>{for(let t=0;t<256;++t){let n=t,i=t,o=7;for(n>>>=1;n;n>>>=1)i<<=1,i|=1&n,--o;e[t]=i<<o&255}})(En);var Tn=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:xn,INT_MIN:-2147483648,sign:yn,abs:function(e){const t=e>>31;return(e^t)-t},min:function(e,t){return t^(e^t)&-(e<t)},max:function(e,t){return e^(e^t)&-(e<t)},isPow2:function(e){return!(e&e-1||!e)},log2:bn,log10:function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},popCount:function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},countTrailingZeros:Sn,nextPow2:Cn,prevPow2:function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},parity:function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1},reverse:function(e){return En[255&e]<<24|En[e>>>8&255]<<16|En[e>>>16&255]<<8|En[e>>>24&255]},interleave2:function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},deinterleave2:function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},interleave3:function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},deinterleave3:function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},nextCombination:function(e){const t=e|e-1;return t+1|(~t&-~t)-1>>>Sn(e)+1}});e("f6",Tn);let Pn,wn,In,Rn,Dn,Nn,On=10,Mn=0;const zn=new Map;Rn=(e,t,n,i,o,a,r)=>{const s=zn.get(a);s&&s.logTimes>s.count&&(o(`'%s' is deprecated, please use '%s' instead. ${r}`,`${e}.${t}`,`${n}.${i}`),s.count++)},Pn=e("cl",((e,t,n)=>{null!=e&&n.forEach((n=>{const i=Mn++;zn.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:On});const o=null!=n.target?n.target:e,a=null!=n.newName?n.newName:n.name,r=null!=n.targetName?n.targetName:t,s=o===e,c=n.suggest?`(${n.suggest})`:"";if(null!=n.customFunction)e[n.name]=function(){return Rn(t,n.name,r,a,v,i,c),n.customFunction.call(this,...arguments)};else if(null!=n.customSetter||null!=n.customGetter){const o=null!=n.customSetter,s=null!=n.customGetter;o&&s?Object.defineProperty(e,n.name,{get(){return Rn(t,n.name,r,a,v,i,c),n.customGetter.call(this)},set(e){Rn(t,n.name,r,a,v,i,c),n.customSetter.call(this,e)},enumerable:!1}):o?Object.defineProperty(e,n.name,{set(e){Rn(t,n.name,r,a,v,i,c),n.customSetter.call(this,e)},enumerable:!1}):s&&Object.defineProperty(e,n.name,{get(){return Rn(t,n.name,r,a,v,i,c),n.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(e,n.name,{get(){return Rn(t,n.name,r,a,v,i,c),s?this[a]:o[a]},set(e){Rn(t,n.name,r,a,v,i,c),s?this[a]=e:o[a]=e},enumerable:!1})}))})),Nn=(e,t,n,i,o)=>{const a=zn.get(i);a&&a.logTimes>a.count&&(n(`'%s' has been removed. ${o}`,`${e}.${t}`),a.count++)},wn=e("c5",((e,t,n)=>{null!=e&&n.forEach((n=>{const i=Mn++;zn.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:On});const o=n.suggest?`(${n.suggest})`:"";Object.defineProperty(e,n.name,{get:()=>Nn(t,n.name,g,i,o),set(){Nn(t,n.name,g,i,o)},enumerable:!1})}))})),Dn=(e,t,n,i,o)=>{const a=zn.get(i);a&&a.logTimes>a.count&&(n(`'%s' is deprecated. ${o}`,`${e}.${t}`),a.count++)},In=e("df",((e,t,n)=>{if(null==e)return;const i=(t,n,i,o,a,r)=>{if(t.get){const e=t.get;t.get=function(){return Dn(n,i,o,a,r),e.call(this)}}if(t.set){const e=t.set;t.set=function(t){Dn(n,i,o,a,r),e.call(this,t)}}Object.defineProperty(e,i,t)};n.forEach((n=>{const o=n.name,a=Object.getOwnPropertyDescriptor(e,o);if(!a||!a.configurable)return;const r=Mn++;zn.set(r,{id:r,count:0,logTimes:void 0!==n.logTimes?n.logTimes:On});const s=n.suggest?`(${n.suggest})`:"";if(void 0!==a.value)if("function"==typeof a.value){const n=a.value;e[o]=function(){return Dn(t,o,v,r,s),n.call(this,...arguments)}}else{let n=a.value;Object.defineProperty(e,o,{configurable:!0,get:()=>(Dn(t,o,v,r,s),n)}),a.writable&&Object.defineProperty(e,o,{set(e){Dn(t,o,v,r,s),n=e}})}else i(a,t,o,v,r,s);Object.defineProperty(e,o,{enumerable:!1})}))}));const Ln=Math.PI/180,Fn=180/Math.PI,Bn=e("fg",1e-6);function kn(e,t){return Math.abs(e-t)<=Bn*Math.max(1,Math.abs(e),Math.abs(t))}function Un(e,t,n){return n=n||Bn,Math.abs(e-t)<=n}function Gn(e,t,n){if(t>n){const e=t;t=n,n=e}return e<t?t:e>n?n:e}function jn(e){return e<0?0:e>1?1:e}function Vn(e,t,n){return e+(t-e)*n}function Hn(e){return e*Ln}function Wn(e){return e*Fn}const qn=e("d_",Math.random);function Yn(e,t){return Math.random()*(t-e)+e}function Xn(e,t){return Math.floor(Yn(e,t))}function Qn(e){return(e=(9301*e+49297)%233280)/233280}function Zn(e,t,n){return Qn(e)*(n-t)+t}function Jn(e,t,n){return Math.floor(Zn(e,t,n))}function Kn(e){return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function $n(e,t){return e-Math.floor(e/t)*t}function ei(e,t){return e=$n(e,2*t),t-Math.abs(e-t)}function ti(e,t,n){return(n-e)/(t-e)}function ni(e){return Math.abs(e.x)>Math.abs(e.y)?Math.abs(e.x)>Math.abs(e.z)?e.x:e.z:Math.abs(e.y)>Math.abs(e.z)?e.y:e.z}function ii(e,t){return Math.abs(e)>Math.abs(t)?e:t}function oi(e,t){t.forEach((t=>{Object.defineProperty(e,t,{enumerable:!0})}))}const ai=1/255;class ri extends Ve{static clone(e){const t=new ri;return e._val?t._val=e._val:t._val=(e.a<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,t}static copy(e,t){return e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,e}static set(e,t,n,i,o){return e.r=t,e.g=n,e.b=i,e.a=o,e}static fromHEX(e,t){t=0===t.indexOf("#")?t.substring(1):t,e.r=parseInt(t.substr(0,2),16)||0,e.g=parseInt(t.substr(2,2),16)||0,e.b=parseInt(t.substr(4,2),16)||0;const n=parseInt(t.substr(6,2),16);return e.a=Number.isNaN(n)?255:n,e._val=(e.a<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,e}static add(e,t,n){return e.r=t.r+n.r,e.g=t.g+n.g,e.b=t.b+n.b,e.a=t.a+n.a,e}static subtract(e,t,n){return e.r=t.r-n.r,e.g=t.g-n.g,e.b=t.b-n.b,e.a=t.a-n.a,e}static multiply(e,t,n){return e.r=t.r*n.r,e.g=t.g*n.g,e.b=t.b*n.b,e.a=t.a*n.a,e}static divide(e,t,n){return e.r=t.r/n.r,e.g=t.g/n.g,e.b=t.b/n.b,e.a=t.a/n.a,e}static scale(e,t,n){return e.r=t.r*n,e.g=t.g*n,e.b=t.b*n,e.a=t.a*n,e}static lerp(e,t,n,i){let o=t.r,a=t.g,r=t.b,s=t.a;return o+=(n.r-o)*i,a+=(n.g-a)*i,r+=(n.b-r)*i,s+=(n.a-s)*i,e._val=Math.floor((s<<24>>>0)+(r<<16)+(a<<8)+o),e}static toArray(e,t,n=0){const i=t instanceof ri||t.a>1?1/255:1;return e[n+0]=t.r*i,e[n+1]=t.g*i,e[n+2]=t.b*i,e[n+3]=t.a*i,e}static fromArray(e,t,n=0){return t.r=255*e[n+0],t.g=255*e[n+1],t.b=255*e[n+2],t.a=255*e[n+3],t}static strictEquals(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}static equals(e,t,n=Bn){return Math.abs(e.r-t.r)<=n*Math.max(1,Math.abs(e.r),Math.abs(t.r))&&Math.abs(e.g-t.g)<=n*Math.max(1,Math.abs(e.g),Math.abs(t.g))&&Math.abs(e.b-t.b)<=n*Math.max(1,Math.abs(e.b),Math.abs(t.b))&&Math.abs(e.a-t.a)<=n*Math.max(1,Math.abs(e.a),Math.abs(t.a))}static hex(e){return(255*e.r<<24|255*e.g<<16|255*e.b<<8|255*e.a)>>>0}get r(){return 255&this._val}set r(e){e=~~Gn(e,0,255),this._val=(4294967040&this._val|e)>>>0}get g(){return(65280&this._val)>>8}set g(e){e=~~Gn(e,0,255),this._val=(4294902015&this._val|e<<8)>>>0}get b(){return(16711680&this._val)>>16}set b(e){e=~~Gn(e,0,255),this._val=(4278255615&this._val|e<<16)>>>0}get a(){return(4278190080&this._val)>>>24}set a(e){e=~~Gn(e,0,255),this._val=(16777215&this._val|e<<24)>>>0}get x(){return this.r*ai}set x(e){this.r=255*e}get y(){return this.g*ai}set y(e){this.g=255*e}get z(){return this.b*ai}set z(e){this.b=255*e}get w(){return this.a*ai}set w(e){this.a=255*e}constructor(e,t,n,i){super(),this._val=0,"string"==typeof e?this.fromHEX(e):void 0!==t?this.set(e,t,n,i):this.set(e)}clone(){const e=new ri;return e._val=this._val,e}equals(e){return e&&this._val===e._val}lerp(e,t){let n=this.r,i=this.g,o=this.b,a=this.a;return n+=(e.r-n)*t,i+=(e.g-i)*t,o+=(e.b-o)*t,a+=(e.a-a)*t,this._val=Math.floor((a<<24>>>0)+(o<<16)+(i<<8)+n),this}toString(){return`rgba(${this.r.toFixed()}, ${this.g.toFixed()}, ${this.b.toFixed()}, ${this.a.toFixed()})`}toCSS(e="rgba"){return"rgba"===e?`rgba(${this.r},${this.g},${this.b},${(this.a*ai).toFixed(2)})`:"rgb"===e?`rgb(${this.r},${this.g},${this.b})`:`#${this.toHEX(e)}`}fromHEX(e){e=0===e.indexOf("#")?e.substring(1):e;const t=parseInt(e.substr(0,2),16)||0,n=parseInt(e.substr(2,2),16)||0,i=parseInt(e.substr(4,2),16)||0;let o=parseInt(e.substr(6,2),16);return o=Number.isNaN(o)?255:o,this._val=(o<<24>>>0)+(i<<16)+(n<<8)+(0|t),this}toHEX(e="#rrggbb"){const t="0",n=[(this.r<16?t:"")+this.r.toString(16),(this.g<16?t:"")+this.g.toString(16),(this.b<16?t:"")+this.b.toString(16)];return"#rgb"===e?(n[0]=n[0][0],n[1]=n[1][0],n[2]=n[2][0]):"#rrggbbaa"===e&&n.push((this.a<16?t:"")+this.a.toString(16)),n.join("")}toRGBValue(){return 16777215&this._val}fromHSV(e,t,n){let i=0,o=0,a=0;if(0===t)i=o=a=n;else if(0===n)i=o=a=0;else{1===e&&(e=0),e*=6;const r=Math.floor(e),s=e-r,c=n*(1-t),l=n*(1-t*s),_=n*(1-t*(1-s));switch(r){case 0:i=n,o=_,a=c;break;case 1:i=l,o=n,a=c;break;case 2:i=c,o=n,a=_;break;case 3:i=c,o=l,a=n;break;case 4:i=_,o=c,a=n;break;case 5:i=n,o=c,a=l}}return i*=255,o*=255,a*=255,this._val=(this.a<<24>>>0)+(a<<16)+(o<<8)+(0|i),this}toHSV(){const e=this.r*ai,t=this.g*ai,n=this.b*ai,i={h:0,s:0,v:0},o=Math.max(e,t,n),a=Math.min(e,t,n);let r=0;return i.v=o,i.s=o?(o-a)/o:0,i.s?(r=o-a,i.h=e===o?(t-n)/r:t===o?2+(n-e)/r:4+(e-t)/r,i.h/=6,i.h<0&&(i.h+=1)):i.h=0,i}set(e,t,n,i){return"object"==typeof e?null!=e._val?this._val=e._val:(t=e.g||0,n=e.b||0,i="number"==typeof e.a?e.a:255,e=e.r||0,this._val=(i<<24>>>0)+(n<<16)+(t<<8)+(0|e)):(e=e||0,t=t||0,n=n||0,i="number"==typeof i?i:255,this._val=(i<<24>>>0)+(n<<16)+(t<<8)+(0|e)),this}multiply(e){const t=(255&this._val)*e.r>>8,n=(65280&this._val)*e.g>>8,i=(16711680&this._val)*e.b>>8,o=((4278190080&this._val)>>>8)*e.a;return this._val=4278190080&o|16711680&i|65280&n|255&t,this}_set_r_unsafe(e){return this._val=(4294967040&this._val|e)>>>0,this}_set_g_unsafe(e){return this._val=(4294902015&this._val|e<<8)>>>0,this}_set_b_unsafe(e){return this._val=(4278255615&this._val|e<<16)>>>0,this}_set_a_unsafe(e){return this._val=(16777215&this._val|e<<24)>>>0,this}}function si(e,t,n,i){return new ri(e,t,n,i)}e("cd",ri),ri.WHITE=Object.freeze(new ri(255,255,255,255)),ri.GRAY=Object.freeze(new ri(127,127,127,255)),ri.BLACK=Object.freeze(new ri(0,0,0,255)),ri.TRANSPARENT=Object.freeze(new ri(0,0,0,0)),ri.RED=Object.freeze(new ri(255,0,0,255)),ri.GREEN=Object.freeze(new ri(0,255,0,255)),ri.BLUE=Object.freeze(new ri(0,0,255,255)),ri.CYAN=Object.freeze(new ri(0,255,255,255)),ri.MAGENTA=Object.freeze(new ri(255,0,255,255)),ri.YELLOW=Object.freeze(new ri(255,255,0,255)),Rt.fastDefine("cc.Color",ri,{r:0,g:0,b:0,a:255}),c.Color=ri,c.color=si;const ci=e("fo",Float32Array);class li extends Ve{static createFloatArray(e){return new ci(e)}get array(){return this._array}}e("fp",li);class _i extends li{static zero(e){return e.x=0,e.y=0,e.z=0,e}static clone(e){return new _i(e.x,e.y,e.z)}static copy(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e}static set(e,t,n,i){return e.x=t,e.y=n,e.z=i,e}static add(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e}static subtract(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e}static multiply(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e}static divide(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e}static ceil(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z),e}static floor(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z),e}static min(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e}static max(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e}static round(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e.z=Math.round(t.z),e}static multiplyScalar(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e}static scaleAndAdd(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e}static distance(e,t){const n=t.x-e.x,i=t.y-e.y,o=t.z-e.z;return Math.sqrt(n*n+i*i+o*o)}static squaredDistance(e,t){const n=t.x-e.x,i=t.y-e.y,o=t.z-e.z;return n*n+i*i+o*o}static len(e){const t=e.x,n=e.y,i=e.z;return Math.sqrt(t*t+n*n+i*i)}static lengthSqr(e){const t=e.x,n=e.y,i=e.z;return t*t+n*n+i*i}static negate(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e}static invert(e,t){return e.x=1/t.x,e.y=1/t.y,e.z=1/t.z,e}static invertSafe(e,t){const n=t.x,i=t.y,o=t.z;return Math.abs(n)<Bn?e.x=0:e.x=1/n,Math.abs(i)<Bn?e.y=0:e.y=1/i,Math.abs(o)<Bn?e.z=0:e.z=1/o,e}static normalize(e,t){const n=t.x,i=t.y,o=t.z;let a=n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),e.x=n*a,e.y=i*a,e.z=o*a),e}static dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}static cross(e,t,n){const{x:i,y:o,z:a}=t,{x:r,y:s,z:c}=n;return e.x=o*c-a*s,e.y=a*r-i*c,e.z=i*s-o*r,e}static lerp(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e}static random(e,t){t=t||1;const n=2*qn()*Math.PI,i=2*qn()-1,o=Math.sqrt(1-i*i);return e.x=o*Math.cos(n)*t,e.y=o*Math.sin(n)*t,e.z=i*t,e}static transformMat4(e,t,n){const i=t.x,o=t.y,a=t.z;let r=n.m03*i+n.m07*o+n.m11*a+n.m15;return r=r?Math.abs(1/r):1,e.x=(n.m00*i+n.m04*o+n.m08*a+n.m12)*r,e.y=(n.m01*i+n.m05*o+n.m09*a+n.m13)*r,e.z=(n.m02*i+n.m06*o+n.m10*a+n.m14)*r,e}static transformMat4Normal(e,t,n){const i=t.x,o=t.y,a=t.z;let r=n.m03*i+n.m07*o+n.m11*a;return r=r?Math.abs(1/r):1,e.x=(n.m00*i+n.m04*o+n.m08*a)*r,e.y=(n.m01*i+n.m05*o+n.m09*a)*r,e.z=(n.m02*i+n.m06*o+n.m10*a)*r,e}static transformMat3(e,t,n){const i=t.x,o=t.y,a=t.z;return e.x=i*n.m00+o*n.m03+a*n.m06,e.y=i*n.m01+o*n.m04+a*n.m07,e.z=i*n.m02+o*n.m05+a*n.m08,e}static transformAffine(e,t,n){const i=t.x,o=t.y,a=t.z;return e.x=n.m00*i+n.m04*o+n.m08*a+n.m12,e.y=n.m01*i+n.m05*o+n.m09*a+n.m13,e.x=n.m02*i+n.m06*o+n.m10*a+n.m14,e}static transformQuat(e,t,n){const i=n.w*t.x+n.y*t.z-n.z*t.y,o=n.w*t.y+n.z*t.x-n.x*t.z,a=n.w*t.z+n.x*t.y-n.y*t.x,r=-n.x*t.x-n.y*t.y-n.z*t.z;return e.x=i*n.w+r*-n.x+o*-n.z-a*-n.y,e.y=o*n.w+r*-n.y+a*-n.x-i*-n.z,e.z=a*n.w+r*-n.z+i*-n.y-o*-n.x,e}static transformRTS(e,t,n,i,o){const a=t.x*o.x,r=t.y*o.y,s=t.z*o.z,c=n.w*a+n.y*s-n.z*r,l=n.w*r+n.z*a-n.x*s,_=n.w*s+n.x*r-n.y*a,u=-n.x*a-n.y*r-n.z*s;return e.x=c*n.w+u*-n.x+l*-n.z-_*-n.y+i.x,e.y=l*n.w+u*-n.y+_*-n.x-c*-n.z+i.y,e.z=_*n.w+u*-n.z+c*-n.y-l*-n.x+i.z,e}static transformInverseRTS(e,t,n,i,o){const a=t.x-i.x,r=t.y-i.y,s=t.z-i.z,c=n.w*a-n.y*s+n.z*r,l=n.w*r-n.z*a+n.x*s,_=n.w*s-n.x*r+n.y*a,u=n.x*a+n.y*r+n.z*s;return e.x=(c*n.w+u*n.x+l*n.z-_*n.y)/o.x,e.y=(l*n.w+u*n.y+_*n.x-c*n.z)/o.y,e.z=(_*n.w+u*n.z+c*n.y-l*n.x)/o.z,e}static rotateX(e,t,n,i){const o=t.x-n.x,a=t.y-n.y,r=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=o,_=a*s-r*c,u=a*c+r*s;return e.x=l+n.x,e.y=_+n.y,e.z=u+n.z,e}static rotateY(e,t,n,i){const o=t.x-n.x,a=t.y-n.y,r=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r*c+o*s,_=a,u=r*s-o*c;return e.x=l+n.x,e.y=_+n.y,e.z=u+n.z,e}static rotateZ(e,t,n,i){const o=t.x-n.x,a=t.y-n.y,r=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=o*s-a*c,_=o*c+a*s,u=r;return e.x=l+n.x,e.y=_+n.y,e.z=u+n.z,e}static toArray(e,t,n=0){return e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e}static fromArray(e,t,n=0){return e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e}static strictEquals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}static equals(e,t,n=Bn){const{x:i,y:o,z:a}=e,{x:r,y:s,z:c}=t;return Math.abs(i-r)<=n*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(o-s)<=n*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(a-c)<=n*Math.max(1,Math.abs(a),Math.abs(c))}static angle(e,t){_i.normalize(ui,e),_i.normalize(hi,t);const n=_i.dot(ui,hi);return n>1?0:n<-1?Math.PI:Math.acos(n)}static projectOnPlane(e,t,n){return _i.subtract(e,t,_i.project(e,t,n))}static project(e,t,n){const i=_i.lengthSqr(n);return i<1e-6?_i.set(e,0,0,0):_i.multiplyScalar(e,n,_i.dot(t,n)/i)}get x(){return this._array[0]}set x(e){this._array[0]=e}get y(){return this._array[1]}set y(e){this._array[1]=e}get z(){return this._array[2]}set z(e){this._array[2]=e}constructor(e,t,n){if(super(),e&&"object"==typeof e)if(ArrayBuffer.isView(e))this._array=e,this._array.fill(0);else{const t=e.array;this._array=li.createFloatArray(3),this._array[0]=t[0],this._array[1]=t[1],this._array[2]=t[2]}else this._array=li.createFloatArray(3),this._array[0]=e||0,this._array[1]=t||0,this._array[2]=n||0}clone(){return new _i(this._array[0],this._array[1],this._array[2])}set(e,t,n){return e&&"object"==typeof e?(this._array[0]=e.x,this._array[1]=e.y,this._array[2]=e.z):(this._array[0]=e||0,this._array[1]=t||0,this._array[2]=n||0),this}equals(e,t=Bn){const n=e.array;return Math.abs(this._array[0]-n[0])<=t*Math.max(1,Math.abs(this._array[0]),Math.abs(n[0]))&&Math.abs(this._array[1]-n[1])<=t*Math.max(1,Math.abs(this._array[1]),Math.abs(n[1]))&&Math.abs(this._array[2]-n[2])<=t*Math.max(1,Math.abs(this._array[2]),Math.abs(n[2]))}equals3f(e,t,n,i=Bn){return Math.abs(this._array[0]-e)<=i*Math.max(1,Math.abs(this._array[0]),Math.abs(e))&&Math.abs(this._array[1]-t)<=i*Math.max(1,Math.abs(this._array[1]),Math.abs(t))&&Math.abs(this._array[2]-n)<=i*Math.max(1,Math.abs(this._array[2]),Math.abs(n))}strictEquals(e){const t=e.array;return this._array[0]===t[0]&&this._array[1]===t[1]&&this._array[2]===t[2]}strictEquals3f(e,t,n){return this._array[0]===e&&this._array[1]===t&&this._array[2]===n}toString(){return`(${this._array[0].toFixed(2)}, ${this._array[1].toFixed(2)}, ${this._array[2].toFixed(2)})`}lerp(e,t){return this._array[0]+=t*(e.x-this._array[0]),this._array[1]+=t*(e.y-this._array[1]),this._array[2]+=t*(e.z-this._array[2]),this}add(e){const t=e.array;return this._array[0]+=t[0],this._array[1]+=t[1],this._array[2]+=t[2],this}add3f(e,t,n){return this._array[0]+=e,this._array[1]+=t,this._array[2]+=n,this}subtract(e){const t=e.array;return this._array[0]-=t[0],this._array[1]-=t[1],this._array[2]-=t[2],this}subtract3f(e,t,n){return this._array[0]-=e,this._array[1]-=t,this._array[2]-=n,this}multiplyScalar(e){return"object"==typeof e&&console.warn("should use Vec3.multiply for vector * vector operation"),this._array[0]*=e,this._array[1]*=e,this._array[2]*=e,this}multiply(e){"object"!=typeof e&&console.warn("should use Vec3.scale for vector * scalar operation");const t=e.array;return this._array[0]*=t[0],this._array[1]*=t[1],this._array[2]*=t[2],this}multiply3f(e,t,n){return this._array[0]*=e,this._array[1]*=t,this._array[2]*=n,this}divide(e){const t=e.array;return this._array[0]/=t[0],this._array[1]/=t[1],this._array[2]/=t[2],this}divide3f(e,t,n){return this._array[0]/=e,this._array[1]/=t,this._array[2]/=n,this}negative(){return this._array[0]=-this._array[0],this._array[1]=-this._array[1],this._array[2]=-this._array[2],this}clampf(e,t){const n=e.array,i=t.array;return this._array[0]=Gn(this._array[0],n[0],i[0]),this._array[1]=Gn(this._array[1],n[1],i[1]),this._array[2]=Gn(this._array[2],n[2],i[2]),this}dot(e){const t=e.array;return this._array[0]*t[0]+this._array[1]*t[1]+this._array[2]*t[2]}cross(e){const t=this._array[0],n=this._array[1],i=this._array[2],o=e.array[0],a=e.array[1],r=e.array[2];return this._array[0]=n*r-i*a,this._array[1]=i*o-t*r,this._array[2]=t*a-n*o,this}length(){return Math.sqrt(this._array[0]*this._array[0]+this._array[1]*this._array[1]+this._array[2]*this._array[2])}lengthSqr(){return this._array[0]*this._array[0]+this._array[1]*this._array[1]+this._array[2]*this._array[2]}normalize(){const e=this._array[0],t=this._array[1],n=this._array[2];let i=e*e+t*t+n*n;return i>0&&(i=1/Math.sqrt(i),this._array[0]=e*i,this._array[1]=t*i,this._array[2]=n*i),this}transformMat4(e){const t=this._array[0],n=this._array[1],i=this._array[2],o=e.array;let a=o[3]*t+o[7]*n+o[11]*i+o[15];return a=a?1/a:1,this._array[0]=(o[0]*t+o[4]*n+o[8]*i+o[12])*a,this._array[1]=(o[1]*t+o[5]*n+o[9]*i+o[13])*a,this._array[2]=(o[2]*t+o[6]*n+o[10]*i+o[14])*a,this}}e("bF",_i),_i.UNIT_X=Object.freeze(new _i(1,0,0)),_i.UNIT_Y=Object.freeze(new _i(0,1,0)),_i.UNIT_Z=Object.freeze(new _i(0,0,1)),_i.RIGHT=Object.freeze(new _i(1,0,0)),_i.UP=Object.freeze(new _i(0,1,0)),_i.FORWARD=Object.freeze(new _i(0,0,-1)),_i.ZERO=Object.freeze(new _i(0,0,0)),_i.ONE=Object.freeze(new _i(1,1,1)),_i.NEG_ONE=Object.freeze(new _i(-1,-1,-1));const ui=new _i,hi=new _i;function fi(e,t,n){return new _i(e,t,n)}oi(_i.prototype,["x","y","z"]),Rt.fastDefine("cc.Vec3",_i,{x:0,y:0,z:0}),c.Vec3=_i,c.v3=fi;class pi extends li{static clone(e){return new pi(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08)}static copy(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e}static set(e,t,n,i,o,a,r,s,c,l){return e.m00=t,e.m01=n,e.m02=i,e.m03=o,e.m04=a,e.m05=r,e.m06=s,e.m07=c,e.m08=l,e}static identity(e){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=1,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e}static transpose(e,t){if(e===t){const n=t.m01,i=t.m02,o=t.m05;e.m01=t.m03,e.m02=t.m06,e.m03=n,e.m05=t.m07,e.m06=i,e.m07=o}else e.m00=t.m00,e.m01=t.m03,e.m02=t.m06,e.m03=t.m01,e.m04=t.m04,e.m05=t.m07,e.m06=t.m02,e.m07=t.m05,e.m08=t.m08;return e}static invert(e,t){const n=t.m00,i=t.m01,o=t.m02,a=t.m03,r=t.m04,s=t.m05,c=t.m06,l=t.m07,_=t.m08,u=_*r-s*l,h=-_*a+s*c,f=l*a-r*c;let p=n*u+i*h+o*f;return 0===p?(e.m00=0,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=0,e.m06=0,e.m07=0,e.m08=0,e):(p=1/p,e.m00=u*p,e.m01=(-_*i+o*l)*p,e.m02=(s*i-o*r)*p,e.m03=h*p,e.m04=(_*n-o*c)*p,e.m05=(-s*n+o*a)*p,e.m06=f*p,e.m07=(-l*n+i*c)*p,e.m08=(r*n-i*a)*p,e)}static determinant(e){const t=e.m00,n=e.m01,i=e.m02,o=e.m03,a=e.m04,r=e.m05,s=e.m06,c=e.m07,l=e.m08;return t*(l*a-r*c)+n*(-l*o+r*s)+i*(c*o-a*s)}static multiply(e,t,n){const i=t.m00,o=t.m01,a=t.m02,r=t.m03,s=t.m04,c=t.m05,l=t.m06,_=t.m07,u=t.m08,h=n.m00,f=n.m01,p=n.m02,d=n.m03,m=n.m04,A=n.m05,v=n.m06,g=n.m07,x=n.m08;return e.m00=h*i+f*r+p*l,e.m01=h*o+f*s+p*_,e.m02=h*a+f*c+p*u,e.m03=d*i+m*r+A*l,e.m04=d*o+m*s+A*_,e.m05=d*a+m*c+A*u,e.m06=v*i+g*r+x*l,e.m07=v*o+g*s+x*_,e.m08=v*a+g*c+x*u,e}static multiplyMat4(e,t,n){const i=t.m00,o=t.m01,a=t.m02,r=t.m03,s=t.m04,c=t.m05,l=t.m06,_=t.m07,u=t.m08,h=n.m00,f=n.m01,p=n.m02,d=n.m04,m=n.m05,A=n.m06,v=n.m08,g=n.m09,x=n.m10;return e.m00=h*i+f*r+p*l,e.m01=h*o+f*s+p*_,e.m02=h*a+f*c+p*u,e.m03=d*i+m*r+A*l,e.m04=d*o+m*s+A*_,e.m05=d*a+m*c+A*u,e.m06=v*i+g*r+x*l,e.m07=v*o+g*s+x*_,e.m08=v*a+g*c+x*u,e}static transform(e,t,n){const i=t.m00,o=t.m01,a=t.m02,r=t.m03,s=t.m04,c=t.m05,l=t.m06,_=t.m07,u=t.m08,h=n.x,f=n.y;return e.m00=i,e.m01=o,e.m02=a,e.m03=r,e.m04=s,e.m05=c,e.m06=h*i+f*r+l,e.m07=h*o+f*s+_,e.m08=h*a+f*c+u,e}static scale(e,t,n){const i=n.x,o=n.y;return e.m00=i*t.m00,e.m01=i*t.m01,e.m02=i*t.m02,e.m03=o*t.m03,e.m04=o*t.m04,e.m05=o*t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e}static rotate(e,t,n){const i=t.m00,o=t.m01,a=t.m02,r=t.m03,s=t.m04,c=t.m05,l=t.m06,_=t.m07,u=t.m08,h=Math.sin(n),f=Math.cos(n);return e.m00=f*i+h*r,e.m01=f*o+h*s,e.m02=f*a+h*c,e.m03=f*r-h*i,e.m04=f*s-h*o,e.m05=f*c-h*a,e.m06=l,e.m07=_,e.m08=u,e}static fromMat4(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m04,e.m04=t.m05,e.m05=t.m06,e.m06=t.m08,e.m07=t.m09,e.m08=t.m10,e}static fromViewUp(e,t,n){return _i.lengthSqr(t)<Bn*Bn?(pi.identity(e),e):(_i.normalize(di,_i.cross(di,n||_i.UNIT_Y,t)),_i.lengthSqr(di)<Bn*Bn?(pi.identity(e),e):(_i.cross(mi,t,di),pi.set(e,di.x,di.y,di.z,mi.x,mi.y,mi.z,t.x,t.y,t.z),e))}static fromTranslation(e,t){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=1,e.m05=0,e.m06=t.x,e.m07=t.y,e.m08=1,e}static fromScaling(e,t){return e.m00=t.x,e.m01=0,e.m02=0,e.m03=0,e.m04=t.y,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e}static fromRotation(e,t){const n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=n,e.m02=0,e.m03=-n,e.m04=i,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e}static fromQuat(e,t){const n=t.x,i=t.y,o=t.z,a=t.w,r=n+n,s=i+i,c=o+o,l=n*r,_=i*r,u=i*s,h=o*r,f=o*s,p=o*c,d=a*r,m=a*s,A=a*c;return e.m00=1-u-p,e.m03=_-A,e.m06=h+m,e.m01=_+A,e.m04=1-l-p,e.m07=f-d,e.m02=h-m,e.m05=f+d,e.m08=1-l-u,e}static inverseTransposeMat4(e,t){const n=t.m00,i=t.m01,o=t.m02,a=t.m03,r=t.m04,s=t.m05,c=t.m06,l=t.m07,_=t.m08,u=t.m09,h=t.m10,f=t.m11,p=t.m12,d=t.m13,m=t.m14,A=t.m15,v=n*s-i*r,g=n*c-o*r,x=n*l-a*r,y=i*c-o*s,b=i*l-a*s,S=o*l-a*c,C=_*d-u*p,E=_*m-h*p,T=_*A-f*p,P=u*m-h*d,w=u*A-f*d,I=h*A-f*m;let R=v*I-g*w+x*P+y*T-b*E+S*C;return R?(R=1/R,e.m00=(s*I-c*w+l*P)*R,e.m01=(c*T-r*I-l*E)*R,e.m02=(r*w-s*T+l*C)*R,e.m03=(o*w-i*I-a*P)*R,e.m04=(n*I-o*T+a*E)*R,e.m05=(i*T-n*w-a*C)*R,e.m06=(d*S-m*b+A*y)*R,e.m07=(m*x-p*S-A*g)*R,e.m08=(p*b-d*x+A*v)*R,e):null}static toArray(e,t,n=0){return e[n+0]=t.m00,e[n+1]=t.m01,e[n+2]=t.m02,e[n+3]=t.m03,e[n+4]=t.m04,e[n+5]=t.m05,e[n+6]=t.m06,e[n+7]=t.m07,e[n+8]=t.m08,e}static fromArray(e,t,n=0){return e.m00=t[n+0],e.m01=t[n+1],e.m02=t[n+2],e.m03=t[n+3],e.m04=t[n+4],e.m05=t[n+5],e.m06=t[n+6],e.m07=t[n+7],e.m08=t[n+8],e}static add(e,t,n){return e.m00=t.m00+n.m00,e.m01=t.m01+n.m01,e.m02=t.m02+n.m02,e.m03=t.m03+n.m03,e.m04=t.m04+n.m04,e.m05=t.m05+n.m05,e.m06=t.m06+n.m06,e.m07=t.m07+n.m07,e.m08=t.m08+n.m08,e}static subtract(e,t,n){return e.m00=t.m00-n.m00,e.m01=t.m01-n.m01,e.m02=t.m02-n.m02,e.m03=t.m03-n.m03,e.m04=t.m04-n.m04,e.m05=t.m05-n.m05,e.m06=t.m06-n.m06,e.m07=t.m07-n.m07,e.m08=t.m08-n.m08,e}static multiplyScalar(e,t,n){return e.m00=t.m00*n,e.m01=t.m01*n,e.m02=t.m02*n,e.m03=t.m03*n,e.m04=t.m04*n,e.m05=t.m05*n,e.m06=t.m06*n,e.m07=t.m07*n,e.m08=t.m08*n,e}static multiplyScalarAndAdd(e,t,n,i){return e.m00=n.m00*i+t.m00,e.m01=n.m01*i+t.m01,e.m02=n.m02*i+t.m02,e.m03=n.m03*i+t.m03,e.m04=n.m04*i+t.m04,e.m05=n.m05*i+t.m05,e.m06=n.m06*i+t.m06,e.m07=n.m07*i+t.m07,e.m08=n.m08*i+t.m08,e}static strictEquals(e,t){return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08}static equals(e,t,n=Bn){return Math.abs(e.m00-t.m00)<=n*Math.max(1,Math.abs(e.m00),Math.abs(t.m00))&&Math.abs(e.m01-t.m01)<=n*Math.max(1,Math.abs(e.m01),Math.abs(t.m01))&&Math.abs(e.m02-t.m02)<=n*Math.max(1,Math.abs(e.m02),Math.abs(t.m02))&&Math.abs(e.m03-t.m03)<=n*Math.max(1,Math.abs(e.m03),Math.abs(t.m03))&&Math.abs(e.m04-t.m04)<=n*Math.max(1,Math.abs(e.m04),Math.abs(t.m04))&&Math.abs(e.m05-t.m05)<=n*Math.max(1,Math.abs(e.m05),Math.abs(t.m05))&&Math.abs(e.m06-t.m06)<=n*Math.max(1,Math.abs(e.m06),Math.abs(t.m06))&&Math.abs(e.m07-t.m07)<=n*Math.max(1,Math.abs(e.m07),Math.abs(t.m07))&&Math.abs(e.m08-t.m08)<=n*Math.max(1,Math.abs(e.m08),Math.abs(t.m08))}get m00(){return this._array[0]}set m00(e){this._array[0]=e}get m01(){return this._array[1]}set m01(e){this._array[1]=e}get m02(){return this._array[2]}set m02(e){this._array[2]=e}get m03(){return this._array[3]}set m03(e){this._array[3]=e}get m04(){return this._array[4]}set m04(e){this._array[4]=e}get m05(){return this._array[5]}set m05(e){this._array[5]=e}get m06(){return this._array[6]}set m06(e){this._array[6]=e}get m07(){return this._array[7]}set m07(e){this._array[7]=e}get m08(){return this._array[8]}set m08(e){this._array[8]=e}constructor(e=1,t=0,n=0,i=0,o=1,a=0,r=0,s=0,c=1){if(super(),e&&"object"==typeof e)if(ArrayBuffer.isView(e))this._array=e,this._array.set([1,0,0,0,1,0,0,0,1]);else{const t=e.array;this._array=li.createFloatArray(9),this._array[0]=t[0],this._array[1]=t[1],this._array[2]=t[2],this._array[3]=t[3],this._array[4]=t[4],this._array[5]=t[5],this._array[6]=t[6],this._array[7]=t[7],this._array[8]=t[8]}else this._array=li.createFloatArray(9),this._array[0]=e,this._array[1]=t,this._array[2]=n,this._array[3]=i,this._array[4]=o,this._array[5]=a,this._array[6]=r,this._array[7]=s,this._array[8]=c}clone(){const e=this._array;return new pi(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}set(e=1,t=0,n=0,i=0,o=1,a=0,r=0,s=0,c=1){if(e&&"object"==typeof e){const t=e.array;this._array[0]=t[0],this._array[1]=t[1],this._array[2]=t[2],this._array[3]=t[3],this._array[4]=t[4],this._array[5]=t[5],this._array[6]=t[6],this._array[7]=t[7],this._array[8]=t[8]}else this._array[0]=e,this._array[1]=t,this._array[2]=n,this._array[3]=i,this._array[4]=o,this._array[5]=a,this._array[6]=r,this._array[7]=s,this._array[8]=c;return this}equals(e,t=Bn){const n=e.array;return Math.abs(this._array[0]-n[0])<=t*Math.max(1,Math.abs(this._array[0]),Math.abs(n[0]))&&Math.abs(this._array[1]-n[1])<=t*Math.max(1,Math.abs(this._array[1]),Math.abs(n[1]))&&Math.abs(this._array[2]-n[2])<=t*Math.max(1,Math.abs(this._array[2]),Math.abs(n[2]))&&Math.abs(this._array[3]-n[3])<=t*Math.max(1,Math.abs(this._array[3]),Math.abs(n[3]))&&Math.abs(this._array[4]-n[4])<=t*Math.max(1,Math.abs(this._array[4]),Math.abs(n[4]))&&Math.abs(this._array[5]-n[5])<=t*Math.max(1,Math.abs(this._array[5]),Math.abs(n[5]))&&Math.abs(this._array[6]-n[6])<=t*Math.max(1,Math.abs(this._array[6]),Math.abs(n[6]))&&Math.abs(this._array[7]-n[7])<=t*Math.max(1,Math.abs(this._array[7]),Math.abs(n[7]))&&Math.abs(this._array[8]-n[8])<=t*Math.max(1,Math.abs(this._array[8]),Math.abs(n[8]))}strictEquals(e){const t=e.array;return this._array[0]===t[0]&&this._array[1]===t[1]&&this._array[2]===t[2]&&this._array[3]===t[3]&&this._array[4]===t[4]&&this._array[5]===t[5]&&this._array[6]===t[6]&&this._array[7]===t[7]&&this._array[8]===t[8]}toString(){return`[\n${this._array[0]}, ${this._array[1]}, ${this._array[2]},\n${this._array[3]},\n${this._array[4]}, ${this._array[5]},\n${this._array[6]}, ${this._array[7]},\n${this._array[8]}\n]`}identity(){return this._array[0]=1,this._array[1]=0,this._array[2]=0,this._array[3]=0,this._array[4]=1,this._array[5]=0,this._array[6]=0,this._array[7]=0,this._array[8]=1,this}transpose(){const e=this._array[1],t=this._array[2],n=this._array[5];return this._array[1]=this._array[3],this._array[2]=this._array[6],this._array[3]=e,this._array[5]=this._array[7],this._array[6]=t,this._array[7]=n,this}invert(){const e=this._array[0],t=this._array[1],n=this._array[2],i=this._array[3],o=this._array[4],a=this._array[5],r=this._array[6],s=this._array[7],c=this._array[8],l=c*o-a*s,_=-c*i+a*r,u=s*i-o*r;let h=e*l+t*_+n*u;return 0===h?(this.set(0,0,0,0,0,0,0,0,0),this):(h=1/h,this._array[0]=l*h,this._array[1]=(-c*t+n*s)*h,this._array[2]=(a*t-n*o)*h,this._array[3]=_*h,this._array[4]=(c*e-n*r)*h,this._array[5]=(-a*e+n*i)*h,this._array[6]=u*h,this._array[7]=(-s*e+t*r)*h,this._array[8]=(o*e-t*i)*h,this)}determinant(){const e=this._array[0],t=this._array[1],n=this._array[2],i=this._array[3],o=this._array[4],a=this._array[5],r=this._array[6],s=this._array[7],c=this._array[8];return e*(c*o-a*s)+t*(-c*i+a*r)+n*(s*i-o*r)}add(e){const t=e.array;return this._array[0]+=t[0],this._array[1]+=t[1],this._array[2]+=t[2],this._array[3]+=t[3],this._array[4]+=t[4],this._array[5]+=t[5],this._array[6]+=t[6],this._array[7]+=t[7],this._array[8]+=t[8],this}subtract(e){const t=e.array;return this._array[0]-=t[0],this._array[1]-=t[1],this._array[2]-=t[2],this._array[3]-=t[3],this._array[4]-=t[4],this._array[5]-=t[5],this._array[6]-=t[6],this._array[7]-=t[7],this._array[8]-=t[8],this}multiply(e){const t=this._array[0],n=this._array[1],i=this._array[2],o=this._array[3],a=this._array[4],r=this._array[5],s=this._array[6],c=this._array[7],l=this._array[8],_=e.array,u=_[0],h=_[1],f=_[2],p=_[3],d=_[4],m=_[5],A=_[6],v=_[7],g=_[8];return this._array[0]=u*t+h*o+f*s,this._array[1]=u*n+h*a+f*c,this._array[2]=u*i+h*r+f*l,this._array[3]=p*t+d*o+m*s,this._array[4]=p*n+d*a+m*c,this._array[5]=p*i+d*r+m*l,this._array[6]=A*t+v*o+g*s,this._array[7]=A*n+v*a+g*c,this._array[8]=A*i+v*r+g*l,this}multiplyScalar(e){return this._array[0]*=e,this._array[1]*=e,this._array[2]*=e,this._array[3]*=e,this._array[4]*=e,this._array[5]*=e,this._array[6]*=e,this._array[7]*=e,this._array[8]*=e,this}scale(e){const t=e.array[0],n=e.array[1];return this._array[0]*=t,this._array[1]*=t,this._array[2]*=t,this._array[3]*=n,this._array[4]*=n,this._array[5]*=n,this}rotate(e){const t=this._array[0],n=this._array[1],i=this._array[2],o=this._array[3],a=this._array[4],r=this._array[5],s=this._array[6],c=this._array[7],l=this._array[8],_=Math.sin(e),u=Math.cos(e);return this._array[0]=u*t+_*o,this._array[1]=u*n+_*a,this._array[2]=u*i+_*r,this._array[3]=u*o-_*t,this._array[4]=u*a-_*n,this._array[5]=u*r-_*i,this._array[6]=s,this._array[7]=c,this._array[8]=l,this}fromQuat(e){const t=e.x,n=e.y,i=e.z,o=e.w,a=t+t,r=n+n,s=i+i,c=t*a,l=n*a,_=n*r,u=i*a,h=i*r,f=i*s,p=o*a,d=o*r,m=o*s;return this._array[0]=1-_-f,this._array[3]=l-m,this._array[6]=u+d,this._array[1]=l+m,this._array[4]=1-c-f,this._array[7]=h-p,this._array[2]=u-d,this._array[5]=h+p,this._array[8]=1-c-_,this}}e("fb",pi),pi.IDENTITY=Object.freeze(new pi);const di=new _i,mi=new _i;oi(pi.prototype,["m00","m01","m02","m03","m04","m05","m06","m07","m08"]),Rt.fastDefine("cc.Mat3",pi,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),c.Mat3=pi;class Ai extends li{static clone(e){return new Ai(e.x,e.y,e.z,e.w)}static copy(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}static set(e,t,n,i,o){return e.x=t,e.y=n,e.z=i,e.w=o,e}static identity(e){return e.x=0,e.y=0,e.z=0,e.w=1,e}static rotationTo(e,t,n){const i=_i.dot(t,n);return i<-.999999?(_i.cross(xi,_i.UNIT_X,t),xi.length()<1e-6&&_i.cross(xi,_i.UNIT_Y,t),_i.normalize(xi,xi),Ai.fromAxisAngle(e,xi,Math.PI),e):i>.999999?(e.x=0,e.y=0,e.z=0,e.w=1,e):(_i.cross(xi,t,n),e.x=xi.x,e.y=xi.y,e.z=xi.z,e.w=1+i,Ai.normalize(e,e))}static getAxisAngle(e,t){const n=2*Math.acos(t.w),i=Math.sin(n/2);return 0!==i?(e.x=t.x/i,e.y=t.y/i,e.z=t.z/i):(e.x=1,e.y=0,e.z=0),n}static multiply(e,t,n){const i=t.x*n.w+t.w*n.x+t.y*n.z-t.z*n.y,o=t.y*n.w+t.w*n.y+t.z*n.x-t.x*n.z,a=t.z*n.w+t.w*n.z+t.x*n.y-t.y*n.x,r=t.w*n.w-t.x*n.x-t.y*n.y-t.z*n.z;return e.x=i,e.y=o,e.z=a,e.w=r,e}static multiplyScalar(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e}static scaleAndAdd(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e.w=t.w+n.w*i,e}static rotateX(e,t,n){n*=.5;const i=Math.sin(n),o=Math.cos(n),{x:a,y:r,z:s,w:c}=t;return e.x=a*o+c*i,e.y=r*o+s*i,e.z=s*o-r*i,e.w=c*o-a*i,e}static rotateY(e,t,n){n*=.5;const i=Math.sin(n),o=Math.cos(n),{x:a,y:r,z:s,w:c}=t;return e.x=a*o-s*i,e.y=r*o+c*i,e.z=s*o+a*i,e.w=c*o-r*i,e}static rotateZ(e,t,n){n*=.5;const i=Math.sin(n),o=Math.cos(n),{x:a,y:r,z:s,w:c}=t;return e.x=a*o+r*i,e.y=r*o-a*i,e.z=s*o+c*i,e.w=c*o-s*i,e}static rotateAround(e,t,n,i){return Ai.invert(vi,t),_i.transformQuat(xi,n,vi),Ai.fromAxisAngle(vi,xi,i),Ai.multiply(e,t,vi),e}static rotateAroundLocal(e,t,n,i){return Ai.fromAxisAngle(vi,n,i),Ai.multiply(e,t,vi),e}static calculateW(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=Math.sqrt(Math.abs(1-t.x*t.x-t.y*t.y-t.z*t.z)),e}static dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}static lerp(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e.w=t.w+i*(n.w-t.w),e}static slerp(e,t,n,i){let o=0,a=0,r=n.x,s=n.y,c=n.z,l=n.w,_=t.x*n.x+t.y*n.y+t.z*n.z+t.w*n.w;if(_<0&&(_=-_,r=-r,s=-s,c=-c,l=-l),1-_>1e-6){const e=Math.acos(_),t=Math.sin(e);o=Math.sin((1-i)*e)/t,a=Math.sin(i*e)/t}else o=1-i,a=i;return e.x=o*t.x+a*r,e.y=o*t.y+a*s,e.z=o*t.z+a*c,e.w=o*t.w+a*l,e}static sqlerp(e,t,n,i,o,a){return Ai.slerp(vi,t,o,a),Ai.slerp(gi,n,i,a),Ai.slerp(e,vi,gi,2*a*(1-a)),e}static invert(e,t){const n=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w,i=n?1/n:0;return e.x=-t.x*i,e.y=-t.y*i,e.z=-t.z*i,e.w=t.w*i,e}static conjugate(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=t.w,e}static len(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w)}static lengthSqr(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w}static normalize(e,t){let n=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w;return n>0&&(n=1/Math.sqrt(n),e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n),e}static fromAxes(e,t,n,i){return pi.set(yi,t.x,t.y,t.z,n.x,n.y,n.z,i.x,i.y,i.z),Ai.normalize(e,Ai.fromMat3(e,yi))}static fromViewUp(e,t,n){return pi.fromViewUp(yi,t,n),Ai.normalize(e,Ai.fromMat3(e,yi))}static fromAxisAngle(e,t,n){n*=.5;const i=Math.sin(n);return e.x=i*t.x,e.y=i*t.y,e.z=i*t.z,e.w=Math.cos(n),e}static fromMat3(e,t){const{m00:n,m03:i,m06:o,m01:a,m04:r,m07:s,m02:c,m05:l,m08:_}=t,u=n+r+_;if(u>0){const t=.5/Math.sqrt(u+1);e.w=.25/t,e.x=(l-s)*t,e.y=(o-c)*t,e.z=(a-i)*t}else if(n>r&&n>_){const t=2*Math.sqrt(1+n-r-_);e.w=(l-s)/t,e.x=.25*t,e.y=(i+a)/t,e.z=(o+c)/t}else if(r>_){const t=2*Math.sqrt(1+r-n-_);e.w=(o-c)/t,e.x=(i+a)/t,e.y=.25*t,e.z=(s+l)/t}else{const t=2*Math.sqrt(1+_-n-r);e.w=(a-i)/t,e.x=(o+c)/t,e.y=(s+l)/t,e.z=.25*t}return e}static fromEuler(e,t,n,i){t*=bi,n*=bi,i*=bi;const o=Math.sin(t),a=Math.cos(t),r=Math.sin(n),s=Math.cos(n),c=Math.sin(i),l=Math.cos(i);return e.x=o*s*l+a*r*c,e.y=a*r*l+o*s*c,e.z=a*s*c-o*r*l,e.w=a*s*l-o*r*c,e}static fromAngleZ(e,t){return t*=bi,e.x=e.y=0,e.z=Math.sin(t),e.w=Math.cos(t),e}static toAxisX(e,t){const n=2*t.y,i=2*t.z;return e.x=1-n*t.y-i*t.z,e.y=n*t.x+i*t.w,e.z=i*t.x+n*t.w,e}static toAxisY(e,t){const n=2*t.x,i=2*t.y,o=2*t.z;return e.x=i*t.x-o*t.w,e.y=1-n*t.x-o*t.z,e.z=o*t.y+n*t.w,e}static toAxisZ(e,t){const n=2*t.x,i=2*t.y,o=2*t.z;return e.x=o*t.x-i*t.w,e.y=o*t.y-n*t.w,e.z=1-n*t.x-i*t.y,e}static toEuler(e,t,n){const{x:i,y:o,z:a,w:r}=t;let s=0,c=0,l=0;const _=i*o+a*r;if(_>.499999)s=0,c=Wn(2*Math.atan2(i,r)),l=90;else if(_<-.499999)s=0,c=-Wn(2*Math.atan2(i,r)),l=-90;else{const e=i*i,t=o*o,u=a*a;s=Wn(Math.atan2(2*i*r-2*o*a,1-2*e-2*u)),c=Wn(Math.atan2(2*o*r-2*i*a,1-2*t-2*u)),l=Wn(Math.asin(2*_)),n&&(s=-180*Math.sign(s+1e-6)+s,c=-180*Math.sign(c+1e-6)+c,l=180*Math.sign(l+1e-6)-l)}return e.x=s,e.y=c,e.z=l,e}static toArray(e,t,n=0){return e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e[n+3]=t.w,e}static fromArray(e,t,n=0){return e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e.w=t[n+3],e}static strictEquals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}static equals(e,t,n=Bn){return Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))&&Math.abs(e.z-t.z)<=n*Math.max(1,Math.abs(e.z),Math.abs(t.z))&&Math.abs(e.w-t.w)<=n*Math.max(1,Math.abs(e.w),Math.abs(t.w))}get x(){return this._array[0]}set x(e){this._array[0]=e}get y(){return this._array[1]}set y(e){this._array[1]=e}get z(){return this._array[2]}set z(e){this._array[2]=e}get w(){return this._array[3]}set w(e){this._array[3]=e}constructor(e,t,n,i){if(super(),e&&"object"==typeof e)if(ArrayBuffer.isView(e))this._array=e,this._array.fill(0),this._array[3]=1;else{const t=e.array;this._array=li.createFloatArray(4),this._array[0]=t[0],this._array[1]=t[1],this._array[2]=t[2],this._array[3]=t[3]}else this._array=li.createFloatArray(4),this._array[0]=e||0,this._array[1]=t||0,this._array[2]=n||0,this._array[3]=null!=i?i:1}clone(){return new Ai(this._array[0],this._array[1],this._array[2],this._array[3])}set(e,t,n,i){if(e&&"object"==typeof e){const t=e.array;this._array[0]=t[0],this._array[1]=t[1],this._array[2]=t[2],this._array[3]=t[3]}else this._array[0]=e||0,this._array[1]=t||0,this._array[2]=n||0,this._array[3]=null!=i?i:1;return this}equals(e,t=Bn){const n=e.array;return Math.abs(this._array[0]-n[0])<=t*Math.max(1,Math.abs(this._array[0]),Math.abs(n[0]))&&Math.abs(this._array[1]-n[1])<=t*Math.max(1,Math.abs(this._array[1]),Math.abs(n[1]))&&Math.abs(this._array[2]-n[2])<=t*Math.max(1,Math.abs(this._array[2]),Math.abs(n[2]))&&Math.abs(this._array[3]-n[3])<=t*Math.max(1,Math.abs(this._array[3]),Math.abs(n[3]))}strictEquals(e){const t=e.array;return e&&this._array[0]===t[0]&&this._array[1]===t[1]&&this._array[2]===t[2]&&this._array[3]===t[3]}getEulerAngles(e){return Ai.toEuler(e,this)}lerp(e,t){const n=e.array;return this._array[0]+=t*(n[0]-this._array[0]),this._array[1]+=t*(n[1]-this._array[1]),this._array[2]+=t*(n[2]-this._array[2]),this._array[3]+=t*(n[3]-this._array[3]),this}slerp(e,t){return Ai.slerp(this,this,e,t)}length(){const e=this._array;return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3])}lengthSqr(){const e=this._array;return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]}}e("cm",Ai),Ai.IDENTITY=Object.freeze(new Ai),oi(Ai.prototype,["x","y","z","w"]);const vi=new Ai,gi=new Ai,xi=new _i,yi=new pi,bi=.5*Math.PI/180;function Si(e=0,t=0,n=0,i=1){return new Ai(e,t,n,i)}Rt.fastDefine("cc.Quat",Ai,{x:0,y:0,z:0,w:1}),c.Quat=Ai,c.quat=Si;const Ci=e("ew",Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])]));class Ei extends li{static clone(e){return new Ei(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08,e.m09,e.m10,e.m11,e.m12,e.m13,e.m14,e.m15)}static copy(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,e}static set(e,t,n,i,o,a,r,s,c,l,_,u,h,f,p,d,m){return e.m00=t,e.m01=n,e.m02=i,e.m03=o,e.m04=a,e.m05=r,e.m06=s,e.m07=c,e.m08=l,e.m09=_,e.m10=u,e.m11=h,e.m12=f,e.m13=p,e.m14=d,e.m15=m,e}static identity(e){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e}static transpose(e,t){if(e===t){const n=t.m01,i=t.m02,o=t.m03,a=t.m06,r=t.m07,s=t.m11;e.m01=t.m04,e.m02=t.m08,e.m03=t.m12,e.m04=n,e.m06=t.m09,e.m07=t.m13,e.m08=i,e.m09=a,e.m11=t.m14,e.m12=o,e.m13=r,e.m14=s}else e.m00=t.m00,e.m01=t.m04,e.m02=t.m08,e.m03=t.m12,e.m04=t.m01,e.m05=t.m05,e.m06=t.m09,e.m07=t.m13,e.m08=t.m02,e.m09=t.m06,e.m10=t.m10,e.m11=t.m14,e.m12=t.m03,e.m13=t.m07,e.m14=t.m11,e.m15=t.m15;return e}static invert(e,t){const n=t.m00,i=t.m01,o=t.m02,a=t.m03,r=t.m04,s=t.m05,c=t.m06,l=t.m07,_=t.m08,u=t.m09,h=t.m10,f=t.m11,p=t.m12,d=t.m13,m=t.m14,A=t.m15,v=n*s-i*r,g=n*c-o*r,x=n*l-a*r,y=i*c-o*s,b=i*l-a*s,S=o*l-a*c,C=_*d-u*p,E=_*m-h*p,T=_*A-f*p,P=u*m-h*d,w=u*A-f*d,I=h*A-f*m;let R=v*I-g*w+x*P+y*T-b*E+S*C;return 0===R?(e.m00=0,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=0,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=0,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=0,e):(R=1/R,e.m00=(s*I-c*w+l*P)*R,e.m01=(o*w-i*I-a*P)*R,e.m02=(d*S-m*b+A*y)*R,e.m03=(h*b-u*S-f*y)*R,e.m04=(c*T-r*I-l*E)*R,e.m05=(n*I-o*T+a*E)*R,e.m06=(m*x-p*S-A*g)*R,e.m07=(_*S-h*x+f*g)*R,e.m08=(r*w-s*T+l*C)*R,e.m09=(i*T-n*w-a*C)*R,e.m10=(p*b-d*x+A*v)*R,e.m11=(u*x-_*b-f*v)*R,e.m12=(s*E-r*P-c*C)*R,e.m13=(n*P-i*E+o*C)*R,e.m14=(d*g-p*y-m*v)*R,e.m15=(_*y-u*g+h*v)*R,e)}static determinant(e){const t=e.m00,n=e.m01,i=e.m02,o=e.m03,a=e.m04,r=e.m05,s=e.m06,c=e.m07,l=e.m08,_=e.m09,u=e.m10,h=e.m11,f=e.m12,p=e.m13,d=e.m14,m=e.m15;return(t*r-n*a)*(u*m-h*d)-(t*s-i*a)*(_*m-h*p)+(t*c-o*a)*(_*d-u*p)+(n*s-i*r)*(l*m-h*f)-(n*c-o*r)*(l*d-u*f)+(i*c-o*s)*(l*p-_*f)}static multiply(e,t,n){const i=t.m00,o=t.m01,a=t.m02,r=t.m03,s=t.m04,c=t.m05,l=t.m06,_=t.m07,u=t.m08,h=t.m09,f=t.m10,p=t.m11,d=t.m12,m=t.m13,A=t.m14,v=t.m15;let g=n.m00,x=n.m01,y=n.m02,b=n.m03;return e.m00=g*i+x*s+y*u+b*d,e.m01=g*o+x*c+y*h+b*m,e.m02=g*a+x*l+y*f+b*A,e.m03=g*r+x*_+y*p+b*v,g=n.m04,x=n.m05,y=n.m06,b=n.m07,e.m04=g*i+x*s+y*u+b*d,e.m05=g*o+x*c+y*h+b*m,e.m06=g*a+x*l+y*f+b*A,e.m07=g*r+x*_+y*p+b*v,g=n.m08,x=n.m09,y=n.m10,b=n.m11,e.m08=g*i+x*s+y*u+b*d,e.m09=g*o+x*c+y*h+b*m,e.m10=g*a+x*l+y*f+b*A,e.m11=g*r+x*_+y*p+b*v,g=n.m12,x=n.m13,y=n.m14,b=n.m15,e.m12=g*i+x*s+y*u+b*d,e.m13=g*o+x*c+y*h+b*m,e.m14=g*a+x*l+y*f+b*A,e.m15=g*r+x*_+y*p+b*v,e}static transform(e,t,n){const i=n.x,o=n.y,a=n.z;if(t===e)e.m12=t.m00*i+t.m04*o+t.m08*a+t.m12,e.m13=t.m01*i+t.m05*o+t.m09*a+t.m13,e.m14=t.m02*i+t.m06*o+t.m10*a+t.m14,e.m15=t.m03*i+t.m07*o+t.m11*a+t.m15;else{const n=t.m00,r=t.m01,s=t.m02,c=t.m03,l=t.m04,_=t.m05,u=t.m06,h=t.m07,f=t.m08,p=t.m09,d=t.m10,m=t.m11;t.m12,t.m13,t.m14,t.m15,e.m00=n,e.m01=r,e.m02=s,e.m03=c,e.m04=l,e.m05=_,e.m06=u,e.m07=h,e.m08=f,e.m09=p,e.m10=d,e.m11=m,e.m12=n*i+l*o+f*a+t.m12,e.m13=r*i+_*o+p*a+t.m13,e.m14=s*i+u*o+d*a+t.m14,e.m15=c*i+h*o+m*a+t.m15}return e}static translate(e,t,n){return console.warn("function changed"),t===e?(e.m12+=n.x,e.m13+=n.y,e.m14+=n.z):(e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12+=n.x,e.m13+=n.y,e.m14+=n.z,e.m15=t.m15),e}static scale(e,t,n){const i=n.x,o=n.y,a=n.z;return e.m00=t.m00*i,e.m01=t.m01*i,e.m02=t.m02*i,e.m03=t.m03*i,e.m04=t.m04*o,e.m05=t.m05*o,e.m06=t.m06*o,e.m07=t.m07*o,e.m08=t.m08*a,e.m09=t.m09*a,e.m10=t.m10*a,e.m11=t.m11*a,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,e}static rotate(e,t,n,i){let o=i.x,a=i.y,r=i.z,s=Math.sqrt(o*o+a*a+r*r);if(Math.abs(s)<Bn)return null;s=1/s,o*=s,a*=s,r*=s;const c=Math.sin(n),l=Math.cos(n),_=1-l,u=t.m00,h=t.m01,f=t.m02,p=t.m03,d=t.m04,m=t.m05,A=t.m06,v=t.m07,g=t.m08,x=t.m09,y=t.m10,b=t.m11,S=o*o*_+l,C=a*o*_+r*c,E=r*o*_-a*c,T=o*a*_-r*c,P=a*a*_+l,w=r*a*_+o*c,I=o*r*_+a*c,R=a*r*_-o*c,D=r*r*_+l;return e.m00=u*S+d*C+g*E,e.m01=h*S+m*C+x*E,e.m02=f*S+A*C+y*E,e.m03=p*S+v*C+b*E,e.m04=u*T+d*P+g*w,e.m05=h*T+m*P+x*w,e.m06=f*T+A*P+y*w,e.m07=p*T+v*P+b*w,e.m08=u*I+d*R+g*D,e.m09=h*I+m*R+x*D,e.m10=f*I+A*R+y*D,e.m11=p*I+v*R+b*D,t!==e&&(e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e}static rotateX(e,t,n){const i=Math.sin(n),o=Math.cos(n),a=t.m04,r=t.m05,s=t.m06,c=t.m07,l=t.m08,_=t.m09,u=t.m10,h=t.m11;return t!==e&&(e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m04=a*o+l*i,e.m05=r*o+_*i,e.m06=s*o+u*i,e.m07=c*o+h*i,e.m08=l*o-a*i,e.m09=_*o-r*i,e.m10=u*o-s*i,e.m11=h*o-c*i,e}static rotateY(e,t,n){const i=Math.sin(n),o=Math.cos(n),a=t.m00,r=t.m01,s=t.m02,c=t.m03,l=t.m08,_=t.m09,u=t.m10,h=t.m11;return t!==e&&(e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m00=a*o-l*i,e.m01=r*o-_*i,e.m02=s*o-u*i,e.m03=c*o-h*i,e.m08=a*i+l*o,e.m09=r*i+_*o,e.m10=s*i+u*o,e.m11=c*i+h*o,e}static rotateZ(e,t,n){const i=Math.sin(n),o=Math.cos(n),a=t.m00,r=t.m01,s=t.m02,c=t.m03,l=t.m04,_=t.m05,u=t.m06,h=t.m07;return t!==e&&(e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m00=a*o+l*i,e.m01=r*o+_*i,e.m02=s*o+u*i,e.m03=c*o+h*i,e.m04=l*o-a*i,e.m05=_*o-r*i,e.m06=u*o-s*i,e.m07=h*o-c*i,e}static fromTranslation(e,t){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=t.x,e.m13=t.y,e.m14=t.z,e.m15=1,e}static fromScaling(e,t){return e.m00=t.x,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=t.y,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=t.z,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e}static fromRotation(e,t,n){let i=n.x,o=n.y,a=n.z,r=Math.sqrt(i*i+o*o+a*a);if(Math.abs(r)<Bn)return null;r=1/r,i*=r,o*=r,a*=r;const s=Math.sin(t),c=Math.cos(t),l=1-c;return e.m00=i*i*l+c,e.m01=o*i*l+a*s,e.m02=a*i*l-o*s,e.m03=0,e.m04=i*o*l-a*s,e.m05=o*o*l+c,e.m06=a*o*l+i*s,e.m07=0,e.m08=i*a*l+o*s,e.m09=o*a*l-i*s,e.m10=a*a*l+c,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e}static fromXRotation(e,t){const n=Math.sin(t),i=Math.cos(t);return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=i,e.m06=n,e.m07=0,e.m08=0,e.m09=-n,e.m10=i,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e}static fromYRotation(e,t){const n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=0,e.m02=-n,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=n,e.m09=0,e.m10=i,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e}static fromZRotation(e,t){const n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=n,e.m02=0,e.m03=0,e.m04=-n,e.m05=i,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e}static fromRT(e,t,n){const i=t.x,o=t.y,a=t.z,r=t.w,s=i+i,c=o+o,l=a+a,_=i*s,u=i*c,h=i*l,f=o*c,p=o*l,d=a*l,m=r*s,A=r*c,v=r*l;return e.m00=1-(f+d),e.m01=u+v,e.m02=h-A,e.m03=0,e.m04=u-v,e.m05=1-(_+d),e.m06=p+m,e.m07=0,e.m08=h+A,e.m09=p-m,e.m10=1-(_+f),e.m11=0,e.m12=n.x,e.m13=n.y,e.m14=n.z,e.m15=1,e}static getTranslation(e,t){return e.x=t.m12,e.y=t.m13,e.z=t.m14,e}static getScaling(e,t){const n=Pi.m00=t.m00,i=Pi.m01=t.m01,o=Pi.m02=t.m02,a=Pi.m03=t.m04,r=Pi.m04=t.m05,s=Pi.m05=t.m06,c=Pi.m06=t.m08,l=Pi.m07=t.m09,_=Pi.m08=t.m10;return e.x=Math.sqrt(n*n+i*i+o*o),e.y=Math.sqrt(a*a+r*r+s*s),e.z=Math.sqrt(c*c+l*l+_*_),pi.determinant(Pi)<0&&(e.x*=-1),e}static getRotation(e,t){const n=t.m00+t.m05+t.m10;let i=0;return n>0?(i=2*Math.sqrt(n+1),e.w=.25*i,e.x=(t.m06-t.m09)/i,e.y=(t.m08-t.m02)/i,e.z=(t.m01-t.m04)/i):t.m00>t.m05&&t.m00>t.m10?(i=2*Math.sqrt(1+t.m00-t.m05-t.m10),e.w=(t.m06-t.m09)/i,e.x=.25*i,e.y=(t.m01+t.m04)/i,e.z=(t.m08+t.m02)/i):t.m05>t.m10?(i=2*Math.sqrt(1+t.m05-t.m00-t.m10),e.w=(t.m08-t.m02)/i,e.x=(t.m01+t.m04)/i,e.y=.25*i,e.z=(t.m06+t.m09)/i):(i=2*Math.sqrt(1+t.m10-t.m00-t.m05),e.w=(t.m01-t.m04)/i,e.x=(t.m08+t.m02)/i,e.y=(t.m06+t.m09)/i,e.z=.25*i),e}static toRTS(e,t,n,i){i.x=_i.set(Ti,e.m00,e.m01,e.m02).length(),Pi.m00=e.m00/i.x,Pi.m01=e.m01/i.x,Pi.m02=e.m02/i.x,i.y=_i.set(Ti,e.m04,e.m05,e.m06).length(),Pi.m03=e.m04/i.y,Pi.m04=e.m05/i.y,Pi.m05=e.m06/i.y,i.z=_i.set(Ti,e.m08,e.m09,e.m10).length(),Pi.m06=e.m08/i.z,Pi.m07=e.m09/i.z,Pi.m08=e.m10/i.z,pi.determinant(Pi)<0&&(i.x*=-1,Pi.m00*=-1,Pi.m01*=-1,Pi.m02*=-1),Ai.fromMat3(t,Pi),_i.set(n,e.m12,e.m13,e.m14)}static fromRTS(e,t,n,i){const o=t.x,a=t.y,r=t.z,s=t.w,c=o+o,l=a+a,_=r+r,u=o*c,h=o*l,f=o*_,p=a*l,d=a*_,m=r*_,A=s*c,v=s*l,g=s*_,x=i.x,y=i.y,b=i.z;return e.m00=(1-(p+m))*x,e.m01=(h+g)*x,e.m02=(f-v)*x,e.m03=0,e.m04=(h-g)*y,e.m05=(1-(u+m))*y,e.m06=(d+A)*y,e.m07=0,e.m08=(f+v)*b,e.m09=(d-A)*b,e.m10=(1-(u+p))*b,e.m11=0,e.m12=n.x,e.m13=n.y,e.m14=n.z,e.m15=1,e}static fromRTSOrigin(e,t,n,i,o){const a=t.x,r=t.y,s=t.z,c=t.w,l=a+a,_=r+r,u=s+s,h=a*l,f=a*_,p=a*u,d=r*_,m=r*u,A=s*u,v=c*l,g=c*_,x=c*u,y=i.x,b=i.y,S=i.z,C=o.x,E=o.y,T=o.z;return e.m00=(1-(d+A))*y,e.m01=(f+x)*y,e.m02=(p-g)*y,e.m03=0,e.m04=(f-x)*b,e.m05=(1-(h+A))*b,e.m06=(m+v)*b,e.m07=0,e.m08=(p+g)*S,e.m09=(m-v)*S,e.m10=(1-(h+d))*S,e.m11=0,e.m12=n.x+C-(e.m00*C+e.m04*E+e.m08*T),e.m13=n.y+E-(e.m01*C+e.m05*E+e.m09*T),e.m14=n.z+T-(e.m02*C+e.m06*E+e.m10*T),e.m15=1,e}static fromQuat(e,t){const n=t.x,i=t.y,o=t.z,a=t.w,r=n+n,s=i+i,c=o+o,l=n*r,_=i*r,u=i*s,h=o*r,f=o*s,p=o*c,d=a*r,m=a*s,A=a*c;return e.m00=1-u-p,e.m01=_+A,e.m02=h-m,e.m03=0,e.m04=_-A,e.m05=1-l-p,e.m06=f+d,e.m07=0,e.m08=h+m,e.m09=f-d,e.m10=1-l-u,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e}static frustum(e,t,n,i,o,a,r){const s=1/(n-t),c=1/(o-i),l=1/(a-r);return e.m00=2*a*s,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=2*a*c,e.m06=0,e.m07=0,e.m08=(n+t)*s,e.m09=(o+i)*c,e.m10=(r+a)*l,e.m11=-1,e.m12=0,e.m13=0,e.m14=r*a*2*l,e.m15=0,e}static perspective(e,t,n,i,o,a=!0,r=-1,s=1,c=0){const l=1/Math.tan(t/2),_=1/(i-o),u=a?l/n:l,h=(a?l:l*n)*s,f=Ci[c];return e.m00=u*f[0],e.m01=u*f[1],e.m02=0,e.m03=0,e.m04=h*f[2],e.m05=h*f[3],e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=(o-r*i)*_,e.m11=-1,e.m12=0,e.m13=0,e.m14=o*i*_*(1-r),e.m15=0,e}static ortho(e,t,n,i,o,a,r,s=-1,c=1,l=0){const _=1/(t-n),u=1/(i-o)*c,h=1/(a-r),f=-2*_,p=-2*u,d=(t+n)*_,m=(o+i)*u,A=Ci[l];return e.m00=f*A[0],e.m01=f*A[1],e.m02=0,e.m03=0,e.m04=p*A[2],e.m05=p*A[3],e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=h*(1-s),e.m11=0,e.m12=d*A[0]+m*A[2],e.m13=d*A[1]+m*A[3],e.m14=(a-s*r)*h,e.m15=1,e}static lookAt(e,t,n,i){const o=t.x,a=t.y,r=t.z,s=i.x,c=i.y,l=i.z;let _=o-n.x,u=a-n.y,h=r-n.z,f=1/Math.sqrt(_*_+u*u+h*h);_*=f,u*=f,h*=f;let p=c*h-l*u,d=l*_-s*h,m=s*u-c*_;f=1/Math.sqrt(p*p+d*d+m*m),p*=f,d*=f,m*=f;const A=u*m-h*d,v=h*p-_*m,g=_*d-u*p;return e.m00=p,e.m01=A,e.m02=_,e.m03=0,e.m04=d,e.m05=v,e.m06=u,e.m07=0,e.m08=m,e.m09=g,e.m10=h,e.m11=0,e.m12=-(p*o+d*a+m*r),e.m13=-(A*o+v*a+g*r),e.m14=-(_*o+u*a+h*r),e.m15=1,e}static inverseTranspose(e,t){const n=t.m00,i=t.m01,o=t.m02,a=t.m03,r=t.m04,s=t.m05,c=t.m06,l=t.m07,_=t.m08,u=t.m09,h=t.m10,f=t.m11,p=t.m12,d=t.m13,m=t.m14,A=t.m15,v=n*s-i*r,g=n*c-o*r,x=n*l-a*r,y=i*c-o*s,b=i*l-a*s,S=o*l-a*c,C=_*d-u*p,E=_*m-h*p,T=_*A-f*p,P=u*m-h*d,w=u*A-f*d,I=h*A-f*m;let R=v*I-g*w+x*P+y*T-b*E+S*C;return R?(R=1/R,e.m00=(s*I-c*w+l*P)*R,e.m01=(c*T-r*I-l*E)*R,e.m02=(r*w-s*T+l*C)*R,e.m03=0,e.m04=(o*w-i*I-a*P)*R,e.m05=(n*I-o*T+a*E)*R,e.m06=(i*T-n*w-a*C)*R,e.m07=0,e.m08=(d*S-m*b+A*y)*R,e.m09=(m*x-p*S-A*g)*R,e.m10=(p*b-d*x+A*v)*R,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e):null}static toArray(e,t,n=0){return e[n+0]=t.m00,e[n+1]=t.m01,e[n+2]=t.m02,e[n+3]=t.m03,e[n+4]=t.m04,e[n+5]=t.m05,e[n+6]=t.m06,e[n+7]=t.m07,e[n+8]=t.m08,e[n+9]=t.m09,e[n+10]=t.m10,e[n+11]=t.m11,e[n+12]=t.m12,e[n+13]=t.m13,e[n+14]=t.m14,e[n+15]=t.m15,e}static fromArray(e,t,n=0){return e.m00=t[n+0],e.m01=t[n+1],e.m02=t[n+2],e.m03=t[n+3],e.m04=t[n+4],e.m05=t[n+5],e.m06=t[n+6],e.m07=t[n+7],e.m08=t[n+8],e.m09=t[n+9],e.m10=t[n+10],e.m11=t[n+11],e.m12=t[n+12],e.m13=t[n+13],e.m14=t[n+14],e.m15=t[n+15],e}static add(e,t,n){return e.m00=t.m00+n.m00,e.m01=t.m01+n.m01,e.m02=t.m02+n.m02,e.m03=t.m03+n.m03,e.m04=t.m04+n.m04,e.m05=t.m05+n.m05,e.m06=t.m06+n.m06,e.m07=t.m07+n.m07,e.m08=t.m08+n.m08,e.m09=t.m09+n.m09,e.m10=t.m10+n.m10,e.m11=t.m11+n.m11,e.m12=t.m12+n.m12,e.m13=t.m13+n.m13,e.m14=t.m14+n.m14,e.m15=t.m15+n.m15,e}static subtract(e,t,n){return e.m00=t.m00-n.m00,e.m01=t.m01-n.m01,e.m02=t.m02-n.m02,e.m03=t.m03-n.m03,e.m04=t.m04-n.m04,e.m05=t.m05-n.m05,e.m06=t.m06-n.m06,e.m07=t.m07-n.m07,e.m08=t.m08-n.m08,e.m09=t.m09-n.m09,e.m10=t.m10-n.m10,e.m11=t.m11-n.m11,e.m12=t.m12-n.m12,e.m13=t.m13-n.m13,e.m14=t.m14-n.m14,e.m15=t.m15-n.m15,e}static multiplyScalar(e,t,n){return e.m00=t.m00*n,e.m01=t.m01*n,e.m02=t.m02*n,e.m03=t.m03*n,e.m04=t.m04*n,e.m05=t.m05*n,e.m06=t.m06*n,e.m07=t.m07*n,e.m08=t.m08*n,e.m09=t.m09*n,e.m10=t.m10*n,e.m11=t.m11*n,e.m12=t.m12*n,e.m13=t.m13*n,e.m14=t.m14*n,e.m15=t.m15*n,e}static multiplyScalarAndAdd(e,t,n,i){return e.m00=t.m00+n.m00*i,e.m01=t.m01+n.m01*i,e.m02=t.m02+n.m02*i,e.m03=t.m03+n.m03*i,e.m04=t.m04+n.m04*i,e.m05=t.m05+n.m05*i,e.m06=t.m06+n.m06*i,e.m07=t.m07+n.m07*i,e.m08=t.m08+n.m08*i,e.m09=t.m09+n.m09*i,e.m10=t.m10+n.m10*i,e.m11=t.m11+n.m11*i,e.m12=t.m12+n.m12*i,e.m13=t.m13+n.m13*i,e.m14=t.m14+n.m14*i,e.m15=t.m15+n.m15*i,e}static strictEquals(e,t){return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08&&e.m09===t.m09&&e.m10===t.m10&&e.m11===t.m11&&e.m12===t.m12&&e.m13===t.m13&&e.m14===t.m14&&e.m15===t.m15}static equals(e,t,n=Bn){return Math.abs(e.m00-t.m00)<=n*Math.max(1,Math.abs(e.m00),Math.abs(t.m00))&&Math.abs(e.m01-t.m01)<=n*Math.max(1,Math.abs(e.m01),Math.abs(t.m01))&&Math.abs(e.m02-t.m02)<=n*Math.max(1,Math.abs(e.m02),Math.abs(t.m02))&&Math.abs(e.m03-t.m03)<=n*Math.max(1,Math.abs(e.m03),Math.abs(t.m03))&&Math.abs(e.m04-t.m04)<=n*Math.max(1,Math.abs(e.m04),Math.abs(t.m04))&&Math.abs(e.m05-t.m05)<=n*Math.max(1,Math.abs(e.m05),Math.abs(t.m05))&&Math.abs(e.m06-t.m06)<=n*Math.max(1,Math.abs(e.m06),Math.abs(t.m06))&&Math.abs(e.m07-t.m07)<=n*Math.max(1,Math.abs(e.m07),Math.abs(t.m07))&&Math.abs(e.m08-t.m08)<=n*Math.max(1,Math.abs(e.m08),Math.abs(t.m08))&&Math.abs(e.m09-t.m09)<=n*Math.max(1,Math.abs(e.m09),Math.abs(t.m09))&&Math.abs(e.m10-t.m10)<=n*Math.max(1,Math.abs(e.m10),Math.abs(t.m10))&&Math.abs(e.m11-t.m11)<=n*Math.max(1,Math.abs(e.m11),Math.abs(t.m11))&&Math.abs(e.m12-t.m12)<=n*Math.max(1,Math.abs(e.m12),Math.abs(t.m12))&&Math.abs(e.m13-t.m13)<=n*Math.max(1,Math.abs(e.m13),Math.abs(t.m13))&&Math.abs(e.m14-t.m14)<=n*Math.max(1,Math.abs(e.m14),Math.abs(t.m14))&&Math.abs(e.m15-t.m15)<=n*Math.max(1,Math.abs(e.m15),Math.abs(t.m15))}get m00(){return this._array[0]}set m00(e){this._array[0]=e}get m01(){return this._array[1]}set m01(e){this._array[1]=e}get m02(){return this._array[2]}set m02(e){this._array[2]=e}get m03(){return this._array[3]}set m03(e){this._array[3]=e}get m04(){return this._array[4]}set m04(e){this._array[4]=e}get m05(){return this._array[5]}set m05(e){this._array[5]=e}get m06(){return this._array[6]}set m06(e){this._array[6]=e}get m07(){return this._array[7]}set m07(e){this._array[7]=e}get m08(){return this._array[8]}set m08(e){this._array[8]=e}get m09(){return this._array[9]}set m09(e){this._array[9]=e}get m10(){return this._array[10]}set m10(e){this._array[10]=e}get m11(){return this._array[11]}set m11(e){this._array[11]=e}get m12(){return this._array[12]}set m12(e){this._array[12]=e}get m13(){return this._array[13]}set m13(e){this._array[13]=e}get m14(){return this._array[14]}set m14(e){this._array[14]=e}get m15(){return this._array[15]}set m15(e){this._array[15]=e}constructor(e=1,t=0,n=0,i=0,o=0,a=1,r=0,s=0,c=0,l=0,_=1,u=0,h=0,f=0,p=0,d=1){if(super(),e&&"object"==typeof e)if(ArrayBuffer.isView(e))this._array=e,this._array.set([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);else{const t=e.array;this._array=li.createFloatArray(16),this._array[0]=t[0],this._array[1]=t[1],this._array[2]=t[2],this._array[3]=t[3],this._array[4]=t[4],this._array[5]=t[5],this._array[6]=t[6],this._array[7]=t[7],this._array[8]=t[8],this._array[9]=t[9],this._array[10]=t[10],this._array[11]=t[11],this._array[12]=t[12],this._array[13]=t[13],this._array[14]=t[14],this._array[15]=t[15]}else this._array=li.createFloatArray(16),this._array[0]=e,this._array[1]=t,this._array[2]=n,this._array[3]=i,this._array[4]=o,this._array[5]=a,this._array[6]=r,this._array[7]=s,this._array[8]=c,this._array[9]=l,this._array[10]=_,this._array[11]=u,this._array[12]=h,this._array[13]=f,this._array[14]=p,this._array[15]=d}clone(){const e=this._array;return new Ei(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}set(e=1,t=0,n=0,i=0,o=0,a=1,r=0,s=0,c=0,l=0,_=1,u=0,h=0,f=0,p=0,d=1){if(e&&"object"==typeof e){const t=e.array;this._array[1]=t[1],this._array[2]=t[2],this._array[3]=t[3],this._array[4]=t[4],this._array[5]=t[5],this._array[6]=t[6],this._array[7]=t[7],this._array[8]=t[8],this._array[9]=t[9],this._array[10]=t[10],this._array[11]=t[11],this._array[12]=t[12],this._array[13]=t[13],this._array[14]=t[14],this._array[15]=t[15],this._array[0]=t[0]}else this._array[1]=t,this._array[2]=n,this._array[3]=i,this._array[4]=o,this._array[5]=a,this._array[6]=r,this._array[7]=s,this._array[8]=c,this._array[9]=l,this._array[10]=_,this._array[11]=u,this._array[12]=h,this._array[13]=f,this._array[14]=p,this._array[15]=d,this._array[0]=e;return this}equals(e,t=Bn){const n=e.array;return Math.abs(this._array[0]-n[0])<=t*Math.max(1,Math.abs(this._array[0]),Math.abs(n[0]))&&Math.abs(this._array[1]-n[1])<=t*Math.max(1,Math.abs(this._array[1]),Math.abs(n[1]))&&Math.abs(this._array[2]-n[2])<=t*Math.max(1,Math.abs(this._array[2]),Math.abs(n[2]))&&Math.abs(this._array[3]-n[3])<=t*Math.max(1,Math.abs(this._array[3]),Math.abs(n[3]))&&Math.abs(this._array[4]-n[4])<=t*Math.max(1,Math.abs(this._array[4]),Math.abs(n[4]))&&Math.abs(this._array[5]-n[5])<=t*Math.max(1,Math.abs(this._array[5]),Math.abs(n[5]))&&Math.abs(this._array[6]-n[6])<=t*Math.max(1,Math.abs(this._array[6]),Math.abs(n[6]))&&Math.abs(this._array[7]-n[7])<=t*Math.max(1,Math.abs(this._array[7]),Math.abs(n[7]))&&Math.abs(this._array[8]-n[8])<=t*Math.max(1,Math.abs(this._array[8]),Math.abs(n[8]))&&Math.abs(this._array[9]-n[9])<=t*Math.max(1,Math.abs(this._array[9]),Math.abs(n[9]))&&Math.abs(this._array[10]-n[10])<=t*Math.max(1,Math.abs(this._array[10]),Math.abs(n[10]))&&Math.abs(this._array[11]-n[11])<=t*Math.max(1,Math.abs(this._array[11]),Math.abs(n[11]))&&Math.abs(this._array[12]-n[12])<=t*Math.max(1,Math.abs(this._array[12]),Math.abs(n[12]))&&Math.abs(this._array[13]-n[13])<=t*Math.max(1,Math.abs(this._array[13]),Math.abs(n[13]))&&Math.abs(this._array[14]-n[14])<=t*Math.max(1,Math.abs(this._array[14]),Math.abs(n[14]))&&Math.abs(this._array[15]-n[15])<=t*Math.max(1,Math.abs(this._array[15]),Math.abs(n[15]))}strictEquals(e){const t=e.array;return this._array[0]===e.m00&&this._array[1]===t[1]&&this._array[2]===t[2]&&this._array[3]===t[3]&&this._array[4]===t[4]&&this._array[5]===t[5]&&this._array[6]===t[6]&&this._array[7]===t[7]&&this._array[8]===t[8]&&this._array[9]===t[9]&&this._array[10]===t[10]&&this._array[11]===t[11]&&this._array[12]===t[12]&&this._array[13]===t[13]&&this._array[14]===t[14]&&this._array[15]===t[15]}toString(){return`[\n${this._array[0]}, ${this._array[1]}, ${this._array[2]}, ${this._array[3]},\n${this._array[4]}, ${this._array[5]}, ${this._array[6]}, ${this._array[7]},\n${this._array[8]}, ${this._array[9]}, ${this._array[10]}, ${this._array[11]},\n${this._array[12]}, ${this._array[13]}, ${this._array[14]}, ${this._array[15]}\n]`}identity(){return this._array[0]=1,this._array[1]=0,this._array[2]=0,this._array[3]=0,this._array[4]=0,this._array[5]=1,this._array[6]=0,this._array[7]=0,this._array[8]=0,this._array[9]=0,this._array[10]=1,this._array[11]=0,this._array[12]=0,this._array[13]=0,this._array[14]=0,this._array[15]=1,this}zero(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this}transpose(){const e=this._array[1],t=this._array[2],n=this._array[3],i=this._array[6],o=this._array[7],a=this._array[11];return this._array[1]=this._array[4],this._array[2]=this._array[8],this._array[3]=this._array[12],this._array[4]=e,this._array[6]=this._array[9],this._array[7]=this._array[13],this._array[8]=t,this._array[9]=i,this._array[11]=this._array[14],this._array[12]=n,this._array[13]=o,this._array[14]=a,this}invert(){const e=this._array[0],t=this._array[1],n=this._array[2],i=this._array[3],o=this._array[4],a=this._array[5],r=this._array[6],s=this._array[7],c=this._array[8],l=this._array[9],_=this._array[10],u=this._array[11],h=this._array[12],f=this._array[13],p=this._array[14],d=this._array[15],m=e*a-t*o,A=e*r-n*o,v=e*s-i*o,g=t*r-n*a,x=t*s-i*a,y=n*s-i*r,b=c*f-l*h,S=c*p-_*h,C=c*d-u*h,E=l*p-_*f,T=l*d-u*f,P=_*d-u*p;let w=m*P-A*T+v*E+g*C-x*S+y*b;return 0===w?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(w=1/w,this._array[0]=(a*P-r*T+s*E)*w,this._array[1]=(n*T-t*P-i*E)*w,this._array[2]=(f*y-p*x+d*g)*w,this._array[3]=(_*x-l*y-u*g)*w,this._array[4]=(r*C-o*P-s*S)*w,this._array[5]=(e*P-n*C+i*S)*w,this._array[6]=(p*v-h*y-d*A)*w,this._array[7]=(c*y-_*v+u*A)*w,this._array[8]=(o*T-a*C+s*b)*w,this._array[9]=(t*C-e*T-i*b)*w,this._array[10]=(h*x-f*v+d*m)*w,this._array[11]=(l*v-c*x-u*m)*w,this._array[12]=(a*S-o*E-r*b)*w,this._array[13]=(e*E-t*S+n*b)*w,this._array[14]=(f*A-h*g-p*m)*w,this._array[15]=(c*g-l*A+_*m)*w,this)}determinant(){const e=this._array[0],t=this._array[1],n=this._array[2],i=this._array[3],o=this._array[4],a=this._array[5],r=this._array[6],s=this._array[7],c=this._array[8],l=this._array[9],_=this._array[10],u=this._array[11],h=this._array[12],f=this._array[13],p=this._array[14],d=this._array[15];return(e*a-t*o)*(_*d-u*p)-(e*r-n*o)*(l*d-u*f)+(e*s-i*o)*(l*p-_*f)+(t*r-n*a)*(c*d-u*h)-(t*s-i*a)*(c*p-_*h)+(n*s-i*r)*(c*f-l*h)}add(e){const t=e.array;return this._array[0]+=t[0],this._array[1]+=t[1],this._array[2]+=t[2],this._array[3]+=t[3],this._array[4]+=t[4],this._array[5]+=t[5],this._array[6]+=t[6],this._array[7]+=t[7],this._array[8]+=t[8],this._array[9]+=t[9],this._array[10]+=t[10],this._array[11]+=t[11],this._array[12]+=t[12],this._array[13]+=t[13],this._array[14]+=t[14],this._array[15]+=t[15],this}subtract(e){const t=e.array;return this._array[0]-=t[0],this._array[1]-=t[1],this._array[2]-=t[2],this._array[3]-=t[3],this._array[4]-=t[4],this._array[5]-=t[5],this._array[6]-=t[6],this._array[7]-=t[7],this._array[8]-=t[8],this._array[9]-=t[9],this._array[10]-=t[10],this._array[11]-=t[11],this._array[12]-=t[12],this._array[13]-=t[13],this._array[14]-=t[14],this._array[15]-=t[15],this}multiply(e){const t=this._array[0],n=this._array[1],i=this._array[2],o=this._array[3],a=this._array[4],r=this._array[5],s=this._array[6],c=this._array[7],l=this._array[8],_=this._array[9],u=this._array[10],h=this._array[11],f=this._array[12],p=this._array[13],d=this._array[14],m=this._array[15],A=e.array;let v=A[0],g=A[1],x=A[2],y=A[3];return this._array[0]=v*t+g*a+x*l+y*f,this._array[1]=v*n+g*r+x*_+y*p,this._array[2]=v*i+g*s+x*u+y*d,this._array[3]=v*o+g*c+x*h+y*m,v=A[4],g=A[5],x=A[6],y=A[7],this._array[4]=v*t+g*a+x*l+y*f,this._array[5]=v*n+g*r+x*_+y*p,this._array[6]=v*i+g*s+x*u+y*d,this._array[7]=v*o+g*c+x*h+y*m,v=A[8],g=A[9],x=A[10],y=A[11],this._array[8]=v*t+g*a+x*l+y*f,this._array[9]=v*n+g*r+x*_+y*p,this._array[10]=v*i+g*s+x*u+y*d,this._array[11]=v*o+g*c+x*h+y*m,v=A[12],g=A[13],x=A[14],y=A[15],this._array[12]=v*t+g*a+x*l+y*f,this._array[13]=v*n+g*r+x*_+y*p,this._array[14]=v*i+g*s+x*u+y*d,this._array[15]=v*o+g*c+x*h+y*m,this}multiplyScalar(e){return this._array[0]*=e,this._array[1]*=e,this._array[2]*=e,this._array[3]*=e,this._array[4]*=e,this._array[5]*=e,this._array[6]*=e,this._array[7]*=e,this._array[8]*=e,this._array[9]*=e,this._array[10]*=e,this._array[11]*=e,this._array[12]*=e,this._array[13]*=e,this._array[14]*=e,this._array[15]*=e,this}translate(e){console.warn("function changed");const t=e.array;return this._array[12]+=t[0],this._array[13]+=t[1],this._array[14]+=t[2],this}scale(e){const t=e.array,n=t[0],i=t[1],o=t[2];return this._array[0]*=n,this._array[1]*=n,this._array[2]*=n,this._array[3]*=n,this._array[4]*=i,this._array[5]*=i,this._array[6]*=i,this._array[7]*=i,this._array[8]*=o,this._array[9]*=o,this._array[10]*=o,this._array[11]*=o,this}rotate(e,t){let n=t.x,i=t.y,o=t.z,a=Math.sqrt(n*n+i*i+o*o);if(Math.abs(a)<Bn)return null;a=1/a,n*=a,i*=a,o*=a;const r=Math.sin(e),s=Math.cos(e),c=1-s,l=this._array[0],_=this._array[1],u=this._array[2],h=this._array[3],f=this._array[4],p=this._array[5],d=this._array[6],m=this._array[7],A=this._array[8],v=this._array[9],g=this._array[10],x=this._array[11],y=n*n*c+s,b=i*n*c+o*r,S=o*n*c-i*r,C=n*i*c-o*r,E=i*i*c+s,T=o*i*c+n*r,P=n*o*c+i*r,w=i*o*c-n*r,I=o*o*c+s;return this._array[0]=l*y+f*b+A*S,this._array[1]=_*y+p*b+v*S,this._array[2]=u*y+d*b+g*S,this._array[3]=h*y+m*b+x*S,this._array[4]=l*C+f*E+A*T,this._array[5]=_*C+p*E+v*T,this._array[6]=u*C+d*E+g*T,this._array[7]=h*C+m*E+x*T,this._array[8]=l*P+f*w+A*I,this._array[9]=_*P+p*w+v*I,this._array[10]=u*P+d*w+g*I,this._array[11]=h*P+m*w+x*I,this}getTranslation(e){return e.x=this._array[12],e.y=this._array[13],e.z=this._array[14],e}getScale(e){const t=e.array,n=Pi.array,i=n[0]=this._array[0],o=n[1]=this._array[1],a=n[2]=this._array[2],r=n[3]=this._array[4],s=n[4]=this._array[5],c=n[5]=this._array[6],l=n[6]=this._array[8],_=n[7]=this._array[9],u=n[8]=this._array[10];return t[0]=Math.sqrt(i*i+o*o+a*a),t[1]=Math.sqrt(r*r+s*s+c*c),t[2]=Math.sqrt(l*l+_*_+u*u),pi.determinant(Pi)<0&&(e.x*=-1),e}getRotation(e){const t=this._array[0]+this._array[5]+this._array[10];let n=0;return t>0?(n=2*Math.sqrt(t+1),e.w=.25*n,e.x=(this._array[6]-this._array[9])/n,e.y=(this._array[8]-this._array[2])/n,e.z=(this._array[1]-this._array[4])/n):this._array[0]>this._array[5]&&this._array[0]>this._array[10]?(n=2*Math.sqrt(1+this._array[0]-this._array[5]-this._array[10]),e.w=(this._array[6]-this._array[9])/n,e.x=.25*n,e.y=(this._array[1]+this._array[4])/n,e.z=(this._array[8]+this._array[2])/n):this._array[5]>this._array[10]?(n=2*Math.sqrt(1+this._array[5]-this._array[0]-this._array[10]),e.w=(this._array[8]-this._array[2])/n,e.x=(this._array[1]+this._array[4])/n,e.y=.25*n,e.z=(this._array[6]+this._array[9])/n):(n=2*Math.sqrt(1+this._array[10]-this._array[0]-this._array[5]),e.w=(this._array[1]-this._array[4])/n,e.x=(this._array[8]+this._array[2])/n,e.y=(this._array[6]+this._array[9])/n,e.z=.25*n),e}fromRTS(e,t,n){const i=e.x,o=e.y,a=e.z,r=e.w,s=i+i,c=o+o,l=a+a,_=i*s,u=i*c,h=i*l,f=o*c,p=o*l,d=a*l,m=r*s,A=r*c,v=r*l,g=n.x,x=n.y,y=n.z;return this._array[0]=(1-(f+d))*g,this._array[1]=(u+v)*g,this._array[2]=(h-A)*g,this._array[3]=0,this._array[4]=(u-v)*x,this._array[5]=(1-(_+d))*x,this._array[6]=(p+m)*x,this._array[7]=0,this._array[8]=(h+A)*y,this._array[9]=(p-m)*y,this._array[10]=(1-(_+f))*y,this._array[11]=0,this._array[12]=t.x,this._array[13]=t.y,this._array[14]=t.z,this._array[15]=1,this}fromQuat(e){const t=e.x,n=e.y,i=e.z,o=e.w,a=t+t,r=n+n,s=i+i,c=t*a,l=n*a,_=n*r,u=i*a,h=i*r,f=i*s,p=o*a,d=o*r,m=o*s;return this._array[0]=1-_-f,this._array[1]=l+m,this._array[2]=u-d,this._array[3]=0,this._array[4]=l-m,this._array[5]=1-c-f,this._array[6]=h+p,this._array[7]=0,this._array[8]=u+d,this._array[9]=h-p,this._array[10]=1-c-_,this._array[11]=0,this._array[12]=0,this._array[13]=0,this._array[14]=0,this._array[15]=1,this}}e("c4",Ei),Ei.IDENTITY=Object.freeze(new Ei);const Ti=new _i,Pi=new pi;function wi(e,t,n,i,o,a,r,s,c,l,_,u,h,f,p,d){return new Ei(e,t,n,i,o,a,r,s,c,l,_,u,h,f,p,d)}oi(Ei.prototype,["m00","m01","m02","m03","m04","m05","m06","m07","m08","m09","m10","m11","m12","m13","m14","m15"]),Rt.fastDefine("cc.Mat4",Ei,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),c.Mat4=Ei,c.mat4=wi;class Ii extends Ve{static clone(e){return new Ii(e.x,e.y)}static copy(e,t){return e.x=t.x,e.y=t.y,e}static set(e,t,n){return e.x=t,e.y=n,e}static add(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e}static subtract(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e}static multiply(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e}static divide(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e}static ceil(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e}static floor(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e}static min(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e}static max(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e}static round(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e}static multiplyScalar(e,t,n){return e.x=t.x*n,e.y=t.y*n,e}static scaleAndAdd(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e}static distance(e,t){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}static squaredDistance(e,t){const n=t.x-e.x,i=t.y-e.y;return n*n+i*i}static len(e){const t=e.x,n=e.y;return Math.sqrt(t*t+n*n)}static lengthSqr(e){const t=e.x,n=e.y;return t*t+n*n}static negate(e,t){return e.x=-t.x,e.y=-t.y,e}static inverse(e,t){return e.x=1/t.x,e.y=1/t.y,e}static inverseSafe(e,t){const n=t.x,i=t.y;return Math.abs(n)<Bn?e.x=0:e.x=1/n,Math.abs(i)<Bn?e.y=0:e.y=1/i,e}static normalize(e,t){const n=t.x,i=t.y;let o=n*n+i*i;return o>0&&(o=1/Math.sqrt(o),e.x=n*o,e.y=i*o),e}static dot(e,t){return e.x*t.x+e.y*t.y}static cross(e,t,n){return e instanceof _i?(e.x=e.y=0,e.z=t.x*n.y-t.y*n.x,e):e.x*t.y-e.y*t.x}static lerp(e,t,n,i){const o=t.x,a=t.y;return e.x=o+i*(n.x-o),e.y=a+i*(n.y-a),e}static random(e,t){t=t||1;const n=2*qn()*Math.PI;return e.x=Math.cos(n)*t,e.y=Math.sin(n)*t,e}static transformMat3(e,t,n){const i=t.x,o=t.y;return e.x=n.m00*i+n.m03*o+n.m06,e.y=n.m01*i+n.m04*o+n.m07,e}static transformMat4(e,t,n){const i=t.x,o=t.y;return e.x=n.m00*i+n.m04*o+n.m12,e.y=n.m01*i+n.m05*o+n.m13,e}static str(e){return`Vec2(${e.x}, ${e.y})`}static toArray(e,t,n=0){return e[n+0]=t.x,e[n+1]=t.y,e}static fromArray(e,t,n=0){return e.x=t[n+0],e.y=t[n+1],e}static strictEquals(e,t){return e.x===t.x&&e.y===t.y}static equals(e,t,n=Bn){return Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))}static angle(e,t){Ii.normalize(Ri,e),Ii.normalize(Di,t);const n=Ii.dot(Ri,Di);return n>1?0:n<-1?Math.PI:Math.acos(n)}constructor(e,t){super(),e&&"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0)}clone(){return new Ii(this.x,this.y)}set(e,t){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0),this}equals(e,t=Bn){return Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))}equals2f(e,t,n=Bn){return Math.abs(this.x-e)<=n*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=n*Math.max(1,Math.abs(this.y),Math.abs(t))}strictEquals(e){return e&&this.x===e.x&&this.y===e.y}strictEquals2f(e,t){return this.x===e&&this.y===t}toString(){return`(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}lerp(e,t){const n=this.x,i=this.y;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this}clampf(e,t){return this.x=Gn(this.x,e.x,t.x),this.y=Gn(this.y,e.y,t.y),this}add(e){return this.x+=e.x,this.y+=e.y,this}add2f(e,t){return this.x+=e,this.y+=t,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}subtract2f(e,t){return this.x-=e,this.y-=t,this}multiplyScalar(e){return"object"==typeof e&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x*=e,this.y*=e,this}multiply(e){return"object"!=typeof e&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this}multiply2f(e,t){return this.x*=e,this.y*=t,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divide2f(e,t){return this.x/=e,this.y/=t,this}negative(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSqr(){return this.x*this.x+this.y*this.y}normalize(){const e=this.x,t=this.y;let n=e*e+t*t;return n>0&&(n=1/Math.sqrt(n),this.x*=n,this.y*=n),this}angle(e){const t=this.lengthSqr(),n=e.lengthSqr();if(0===t||0===n)return console.warn("Can't get angle between zero vector"),0;let i=this.dot(e)/Math.sqrt(t*n);return i=Gn(i,-1,1),Math.acos(i)}signAngle(e){const t=this.angle(e);return this.cross(e)<0?-t:t}rotate(e){const t=this.x,n=this.y,i=Math.sin(e),o=Math.cos(e);return this.x=o*t-i*n,this.y=i*t+o*n,this}project(e){const t=this.dot(e)/e.dot(e);return this.x=e.x*t,this.y=e.y*t,this}transformMat4(e){const t=this.x,n=this.y;return this.x=e.m00*t+e.m04*n+e.m12,this.y=e.m01*t+e.m05*n+e.m13,this}}e("cI",Ii),Ii.ZERO=Object.freeze(new Ii(0,0)),Ii.ONE=Object.freeze(new Ii(1,1)),Ii.NEG_ONE=Object.freeze(new Ii(-1,-1)),Ii.UNIT_X=Object.freeze(new Ii(1,0)),Ii.UNIT_Y=Object.freeze(new Ii(0,1));const Ri=new Ii,Di=new Ii;function Ni(e,t){return new Ii(e,t)}Rt.fastDefine("cc.Vec2",Ii,{x:0,y:0}),c.Vec2=Ii,c.v2=Ni;class Oi extends Ve{static clone(e){return new Oi(e.x,e.y,e.z,e.w)}static copy(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}static set(e,t,n,i,o){return e.x=t,e.y=n,e.z=i,e.w=o,e}static add(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e.w=t.w+n.w,e}static subtract(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e.w=t.w-n.w,e}static multiply(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e.w=t.w*n.w,e}static divide(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e.w=t.w/n.w,e}static ceil(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z),e.w=Math.ceil(t.w),e}static floor(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z),e.w=Math.floor(t.w),e}static min(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e.w=Math.min(t.w,n.w),e}static max(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e.w=Math.max(t.w,n.w),e}static round(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e.z=Math.round(t.z),e.w=Math.round(t.w),e}static multiplyScalar(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e}static scaleAndAdd(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e.w=t.w+n.w*i,e}static distance(e,t){const n=t.x-e.x,i=t.y-e.y,o=t.z-e.z,a=t.w-e.w;return Math.sqrt(n*n+i*i+o*o+a*a)}static squaredDistance(e,t){const n=t.x-e.x,i=t.y-e.y,o=t.z-e.z,a=t.w-e.w;return n*n+i*i+o*o+a*a}static len(e){const t=e.x,n=e.y,i=e.z,o=e.w;return Math.sqrt(t*t+n*n+i*i+o*o)}static lengthSqr(e){const t=e.x,n=e.y,i=e.z,o=e.w;return t*t+n*n+i*i+o*o}static negate(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=-t.w,e}static inverse(e,t){return e.x=1/t.x,e.y=1/t.y,e.z=1/t.z,e.w=1/t.w,e}static inverseSafe(e,t){const n=t.x,i=t.y,o=t.z,a=t.w;return Math.abs(n)<Bn?e.x=0:e.x=1/n,Math.abs(i)<Bn?e.y=0:e.y=1/i,Math.abs(o)<Bn?e.z=0:e.z=1/o,Math.abs(a)<Bn?e.w=0:e.w=1/a,e}static normalize(e,t){const n=t.x,i=t.y,o=t.z,a=t.w;let r=n*n+i*i+o*o+a*a;return r>0&&(r=1/Math.sqrt(r),e.x=n*r,e.y=i*r,e.z=o*r,e.w=a*r),e}static dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}static lerp(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e.w=t.w+i*(n.w-t.w),e}static random(e,t){t=t||1;const n=2*qn()*Math.PI,i=2*qn()-1,o=Math.sqrt(1-i*i);return e.x=o*Math.cos(n)*t,e.y=o*Math.sin(n)*t,e.z=i*t,e.w=0,e}static transformMat4(e,t,n){const i=t.x,o=t.y,a=t.z,r=t.w;return e.x=n.m00*i+n.m04*o+n.m08*a+n.m12*r,e.y=n.m01*i+n.m05*o+n.m09*a+n.m13*r,e.z=n.m02*i+n.m06*o+n.m10*a+n.m14*r,e.w=n.m03*i+n.m07*o+n.m11*a+n.m15*r,e}static transformAffine(e,t,n){const i=t.x,o=t.y,a=t.z,r=t.w;return e.x=n.m00*i+n.m01*o+n.m02*a+n.m03*r,e.y=n.m04*i+n.m05*o+n.m06*a+n.m07*r,e.x=n.m08*i+n.m09*o+n.m10*a+n.m11*r,e.w=t.w,e}static transformQuat(e,t,n){const{x:i,y:o,z:a}=t,r=n.x,s=n.y,c=n.z,l=n.w,_=l*i+s*a-c*o,u=l*o+c*i-r*a,h=l*a+r*o-s*i,f=-r*i-s*o-c*a;return e.x=_*l+f*-r+u*-c-h*-s,e.y=u*l+f*-s+h*-r-_*-c,e.z=h*l+f*-c+_*-s-u*-r,e.w=t.w,e}static toArray(e,t,n=0){return e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e[n+3]=t.w,e}static fromArray(e,t,n=0){return e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e.w=t[n+3],e}static strictEquals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}static equals(e,t,n=Bn){return Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))&&Math.abs(e.z-t.z)<=n*Math.max(1,Math.abs(e.z),Math.abs(t.z))&&Math.abs(e.w-t.w)<=n*Math.max(1,Math.abs(e.w),Math.abs(t.w))}constructor(e,t,n,i){super(),e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=i||0)}clone(){return new Oi(this.x,this.y,this.z,this.w)}set(e,t,n,i){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=i||0),this}equals(e,t=Bn){return Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))&&Math.abs(this.w-e.w)<=t*Math.max(1,Math.abs(this.w),Math.abs(e.w))}equals4f(e,t,n,i,o=Bn){return Math.abs(this.x-e)<=o*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=o*Math.max(1,Math.abs(this.y),Math.abs(t))&&Math.abs(this.z-n)<=o*Math.max(1,Math.abs(this.z),Math.abs(n))&&Math.abs(this.w-i)<=o*Math.max(1,Math.abs(this.w),Math.abs(i))}strictEquals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}strictEquals4f(e,t,n,i){return this.x===e&&this.y===t&&this.z===n&&this.w===i}lerp(e,t){const n=this.x,i=this.y,o=this.z,a=this.w;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this.z=o+t*(e.z-o),this.w=a+t*(e.w-a),this}toString(){return`(${this.x.toFixed(2)}, ${this.y.toFixed(2)}, ${this.z.toFixed(2)}, ${this.w.toFixed(2)})`}clampf(e,t){return this.x=Gn(this.x,e.x,t.x),this.y=Gn(this.y,e.y,t.y),this.z=Gn(this.z,e.z,t.z),this.w=Gn(this.w,e.w,t.w),this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}add4f(e,t,n,i){return this.x+=e,this.y+=t,this.z+=n,this.w+=i,this}subtract(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subtract4f(e,t,n,i){return this.x-=e,this.y-=t,this.z-=n,this.w-=i,this}multiplyScalar(e){return"object"==typeof e&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}multiply(e){return"object"!=typeof e&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiply4f(e,t,n,i){return this.x*=e,this.y*=t,this.z*=n,this.w*=i,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divide4f(e,t,n,i){return this.x/=e,this.y/=t,this.z/=n,this.w/=i,this}negative(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}cross(e){const{x:t,y:n,z:i}=this,{x:o,y:a,z:r}=e;return this.x=n*r-i*a,this.y=i*o-t*r,this.z=t*a-n*o,this}length(){const e=this.x,t=this.y,n=this.z,i=this.w;return Math.sqrt(e*e+t*t+n*n+i*i)}lengthSqr(){const e=this.x,t=this.y,n=this.z,i=this.w;return e*e+t*t+n*n+i*i}normalize(){const e=this.x,t=this.y,n=this.z,i=this.w;let o=e*e+t*t+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),this.x=e*o,this.y=t*o,this.z=n*o,this.w=i*o),this}transformMat4(e){const t=this.x,n=this.y,i=this.z,o=this.w;return this.x=e.m00*t+e.m04*n+e.m08*i+e.m12*o,this.y=e.m01*t+e.m05*n+e.m09*i+e.m13*o,this.z=e.m02*t+e.m06*n+e.m10*i+e.m14*o,this.w=e.m03*t+e.m07*n+e.m11*i+e.m15*o,this}}function Mi(e,t,n,i){return new Oi(e,t,n,i)}e("bV",Oi),Oi.ZERO=Object.freeze(new Oi(0,0,0,0)),Oi.ONE=Object.freeze(new Oi(1,1,1,1)),Oi.NEG_ONE=Object.freeze(new Oi(-1,-1,-1,-1)),Rt.fastDefine("cc.Vec4",Oi,{x:0,y:0,z:0,w:0}),c.Vec4=Oi,c.v4=Mi,Pn(Ii,"Vec2",[{name:"sub",newName:"subtract",target:Ii,targetName:"Vec2"},{name:"mul",newName:"multiply",target:Ii,targetName:"Vec2"},{name:"div",newName:"divide",target:Ii,targetName:"Vec2"},{name:"dist",newName:"distance",target:Ii,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:Ii,targetName:"Vec2"},{name:"mag",newName:"len",target:Ii,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:Ii,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Ii,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Ii,targetName:"Vec2"}]),Pn(Ii.prototype,"Vec2",[{name:"mag",newName:"length",target:Ii.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:Ii.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Ii.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Ii.prototype,targetName:"Vec2"}]),Pn(_i,"Vec3",[{name:"sub",newName:"subtract",target:_i,targetName:"Vec3"},{name:"mul",newName:"multiply",target:_i,targetName:"Vec3"},{name:"div",newName:"divide",target:_i,targetName:"Vec3"},{name:"dist",newName:"distance",target:_i,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:_i,targetName:"Vec3"},{name:"mag",newName:"len",target:_i,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:_i,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:_i,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:_i,targetName:"Vec3"}]),Pn(_i.prototype,"Vec3",[{name:"mag",newName:"length",target:_i.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:_i.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:_i.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:_i.prototype,targetName:"Vec3"}]),Pn(Oi,"Vec4",[{name:"sub",newName:"subtract",target:Oi,targetName:"Vec4"},{name:"mul",newName:"multiply",target:Oi,targetName:"Vec4"},{name:"div",newName:"divide",target:Oi,targetName:"Vec4"},{name:"dist",newName:"distance",target:Oi,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:Oi,targetName:"Vec4"},{name:"mag",newName:"len",target:Oi,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:Oi,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:Oi,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:Oi,targetName:"Vec4"}]),Pn(Oi.prototype,"Vec4",[{name:"mag",newName:"length",target:Oi.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:Oi.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:Oi.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:Oi.prototype,targetName:"Vec4"}]),Pn(Ai,"Quat",[{name:"mag",newName:"len",target:Ai,targetName:"Quat"},{name:"mul",newName:"multiply",target:Ai,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:Ai,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:Ai,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Ai,targetName:"Quat"}]),Pn(Ai.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:Ai.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Ai.prototype,targetName:"Quat"}]),Pn(ri,"Color",[{name:"sub",newName:"subtract",target:ri,targetName:"Color"},{name:"mul",newName:"multiply",target:ri,targetName:"Color"},{name:"div",newName:"divide",target:ri,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:ri,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction(...e){const t=e[1].toString(16);return c.Color.fromHEX(e[0],t)}}]),Pn(pi,"Mat3",[{name:"sub",newName:"subtract",target:pi,targetName:"Mat3"},{name:"mul",newName:"multiply",target:pi,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:pi,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:pi,targetName:"Mat3"}]),Pn(pi.prototype,"Mat3",[{name:"sub",newName:"subtract",target:pi.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:pi.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:pi.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:pi.prototype,targetName:"Mat3"}]),Pn(Ei,"Mat4",[{name:"sub",newName:"subtract",target:Ei,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Ei,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Ei,targetName:"Mat4"}]),Pn(Ei.prototype,"Mat4",[{name:"sub",newName:"subtract",target:Ei.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Ei.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:Ei.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Ei.prototype,targetName:"Mat4"}]);class zi{static identity(){return new zi}static clone(e){return new zi(e.a,e.b,e.c,e.d,e.tx,e.ty)}static concat(e,t,n){const i=t.a,o=t.b,a=t.c,r=t.d,s=t.tx,c=t.ty;e.a=i*n.a+o*n.c,e.b=i*n.b+o*n.d,e.c=a*n.a+r*n.c,e.d=a*n.b+r*n.d,e.tx=s*n.a+c*n.c+n.tx,e.ty=s*n.b+c*n.d+n.ty}static invert(e,t){const n=1/(t.a*t.d-t.b*t.c);e.a=n*t.d,e.b=-n*t.b,e.c=-n*t.c,e.d=n*t.a,e.tx=n*(t.c*t.ty-t.d*t.tx),e.ty=n*(t.b*t.tx-t.a*t.ty)}static fromMat4(e,t){e.a=t.m00,e.b=t.m01,e.c=t.m04,e.d=t.m05,e.tx=t.m12,e.ty=t.m13}static transformVec2(e,t,n,i){let o,a;void 0===i?(i=n,o=t.x,a=t.y):(o=t,a=n),e.x=i.a*o+i.c*a+i.tx,e.y=i.b*o+i.d*a+i.ty}static transformSize(e,t,n){e.width=n.a*t.width+n.c*t.height,e.height=n.b*t.width+n.d*t.height}static transformRect(e,t,n){const i=t.x+t.width,o=t.y+t.height,a=n.a*t.x+n.c*t.y+n.tx,r=n.b*t.x+n.d*t.y+n.ty,s=n.a*i+n.c*t.y+n.tx,c=n.b*i+n.d*t.y+n.ty,l=n.a*t.x+n.c*o+n.tx,_=n.b*t.x+n.d*o+n.ty,u=n.a*i+n.c*o+n.tx,h=n.b*i+n.d*o+n.ty,f=Math.min(a,s,l,u),p=Math.max(a,s,l,u),d=Math.min(r,c,_,h),m=Math.max(r,c,_,h);e.x=f,e.y=d,e.width=p-f,e.height=m-d}static transformObb(e,t,n,i,o,a){const r=a.a*o.x+a.c*o.y+a.tx,s=a.b*o.x+a.d*o.y+a.ty,c=a.a*o.width,l=a.b*o.width,_=a.c*o.height,u=a.d*o.height;t.x=r,t.y=s,n.x=c+r,n.y=l+s,e.x=_+r,e.y=u+s,i.x=c+_+r,i.y=l+u+s}constructor(e=1,t=0,n=0,i=1,o=0,a=0){this.a=e,this.b=t,this.c=n,this.d=i,this.tx=o,this.ty=a}}e("fc",zi),c.AffineTransform=zi;class Li extends Ve{static lerp(e,t,n,i){return e.width=t.width+(n.width-t.width)*i,e.height=t.height+(n.height-t.height)*i,e}set x(e){this.width=e}get x(){return this.width}set y(e){this.height=e}get y(){return this.height}constructor(e,t){super(),e&&"object"==typeof e?(this.width=e.width,this.height=e.height):(this.width=e||0,this.height=t||0)}clone(){return new Li(this.width,this.height)}set(e,t){return e&&"object"==typeof e?(this.height=e.height,this.width=e.width):(this.width=e||0,this.height=t||0),this}equals(e){return this.width===e.width&&this.height===e.height}lerp(e,t){return this.width+=(e.width-this.width)*t,this.height+=(e.height-this.height)*t,this}toString(){return`(${this.width.toFixed(2)}, ${this.height.toFixed(2)})`}}function Fi(e=0,t=0){return new Li(e,t)}e("cS",Li),Li.ZERO=Object.freeze(new Li(0,0)),Li.ONE=Object.freeze(new Li(1,1)),Rt.fastDefine("cc.Size",Li,{width:0,height:0}),c.size=Fi,c.Size=Li;class Bi extends Ve{static fromMinMax(e,t,n){const i=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x,n.x),r=Math.max(t.y,n.y);return e.x=i,e.y=o,e.width=a-i,e.height=r-o,e}static lerp(e,t,n,i){const o=t.x,a=t.y,r=t.width,s=t.height;return e.x=o+(n.x-o)*i,e.y=a+(n.y-a)*i,e.width=r+(n.width-r)*i,e.height=s+(n.height-s)*i,e}static intersection(e,t,n){const i=t.x,o=t.y,a=t.x+t.width,r=t.y+t.height,s=n.x,c=n.y,l=n.x+n.width,_=n.y+n.height;return e.x=Math.max(i,s),e.y=Math.max(o,c),e.width=Math.min(a,l)-e.x,e.height=Math.min(r,_)-e.y,e}static union(e,t,n){const i=t.x,o=t.y,a=t.width,r=t.height,s=n.x,c=n.y,l=n.width,_=n.height;return e.x=Math.min(i,s),e.y=Math.min(o,c),e.width=Math.max(i+a,s+l)-e.x,e.height=Math.max(o+r,c+_)-e.y,e}get xMin(){return this.x}set xMin(e){this.width+=this.x-e,this.x=e}get yMin(){return this.y}set yMin(e){this.height+=this.y-e,this.y=e}get xMax(){return this.x+this.width}set xMax(e){this.width=e-this.x}get yMax(){return this.y+this.height}set yMax(e){this.height=e-this.y}get center(){return new Ii(this.x+.5*this.width,this.y+.5*this.height)}set center(e){this.x=e.x-.5*this.width,this.y=e.y-.5*this.height}get origin(){return new Ii(this.x,this.y)}set origin(e){this.x=e.x,this.y=e.y}get size(){return new Li(this.width,this.height)}set size(e){this.width=e.width,this.height=e.height}set z(e){this.width=e}get z(){return this.width}set w(e){this.height=e}get w(){return this.height}constructor(e,t,n,i){super(),e&&"object"==typeof e?(this.y=e.y,this.width=e.width,this.height=e.height,this.x=e.x):(this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0)}clone(){return new Bi(this.x,this.y,this.width,this.height)}set(e,t,n,i){return e&&"object"==typeof e?(this.y=e.y,this.width=e.width,this.height=e.height,this.x=e.x):(this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0),this}equals(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height}lerp(e,t){const n=this.x,i=this.y,o=this.width,a=this.height;return this.x=n+(e.x-n)*t,this.y=i+(e.y-i)*t,this.width=o+(e.width-o)*t,this.height=a+(e.height-a)*t,this}toString(){return`(${this.x.toFixed(2)}, ${this.y.toFixed(2)}, ${this.width.toFixed(2)}, ${this.height.toFixed(2)})`}intersects(e){const t=this.x+this.width,n=this.y+this.height,i=e.x+e.width,o=e.y+e.height;return!(t<e.x||i<this.x||n<e.y||o<this.y)}contains(e){return this.x<=e.x&&this.x+this.width>=e.x&&this.y<=e.y&&this.y+this.height>=e.y}containsRect(e){return this.x<=e.x&&this.x+this.width>=e.x+e.width&&this.y<=e.y&&this.y+this.height>=e.y+e.height}transformMat4(e){const t=this.x,n=this.y,i=t+this.width,o=n+this.height,a=e.m00*t+e.m04*n+e.m12,r=e.m01*t+e.m05*n+e.m13,s=e.m00*i+e.m04*n+e.m12,c=e.m01*i+e.m05*n+e.m13,l=e.m00*t+e.m04*o+e.m12,_=e.m01*t+e.m05*o+e.m13,u=e.m00*i+e.m04*o+e.m12,h=e.m01*i+e.m05*o+e.m13,f=Math.min(a,s,l,u),p=Math.max(a,s,l,u),d=Math.min(r,c,_,h),m=Math.max(r,c,_,h);return this.x=f,this.y=d,this.width=p-f,this.height=m-d,this}transformMat4ToPoints(e,t,n,i,o){const a=this.x,r=this.y,s=a+this.width,c=r+this.height;t.x=e.m00*a+e.m04*r+e.m12,t.y=e.m01*a+e.m05*r+e.m13,o.x=e.m00*s+e.m04*r+e.m12,o.y=e.m01*s+e.m05*r+e.m13,n.x=e.m00*a+e.m04*c+e.m12,n.y=e.m01*a+e.m05*c+e.m13,i.x=e.m00*s+e.m04*c+e.m12,i.y=e.m01*s+e.m05*c+e.m13}}function ki(e=0,t=0,n=0,i=0){return new Bi(e,t,n,i)}e("cR",Bi),Rt.fastDefine("cc.Rect",Bi,{x:0,y:0,width:0,height:0}),c.Rect=Bi,c.rect=ki;var Ui=Object.freeze({__proto__:null,bits:Tn,Vec2:Ii,v2:Ni,Vec3:_i,v3:fi,Vec4:Oi,v4:Mi,Quat:Ai,quat:Si,Mat3:pi,Mat4:Ei,mat4:wi,AffineTransform:zi,Size:Li,size:Fi,Rect:Bi,rect:ki,Color:ri,color:si,EPSILON:Bn,equals:kn,approx:Un,clamp:Gn,clamp01:jn,lerp:Vn,toRadian:Hn,toDegree:Wn,random:qn,randomRange:Yn,randomRangeInt:Xn,pseudoRandom:Qn,pseudoRandomRange:Zn,pseudoRandomRangeInt:Jn,nextPow2:Kn,repeat:$n,pingPong:ei,inverseLerp:ti,absMaxComponent:ni,absMax:ii,enumerableProps:oi,MATH_FLOAT_ARRAY:ci,MathBase:li});e("f4",Ui);const Gi=ns.Node,ji=ns.Scene,Vi=ns.Model,Hi=e("ct",ns.SkinningModel),Wi=e("cz",ns.BakedSkinningModel),qi=ns.light,Yi=ns.DirectionalLight,Xi=ns.SpotLight,Qi=ns.SphereLight,Zi=ns.Skybox,Ji=ns.Fog,Ki=ns.Ambient,$i=ns.Shadow,eo=ns.OctreeInfo,to=ns.Camera,no=ns.RenderWindow,io=ns.RenderScene,oo=e("di",ns.DrawBatch2D),ao=ns.Pass,ro=ns.SubModel,so=ns.Root,co=ns.PipelineSharedSceneData,lo=ns.AABB;class _o{set enabled(e){this._enabled=e,this._nativeObj.enabled=e}get enabled(){return this._enabled}get skyColor(){return c.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR:this._skyColorLDR}set skyColor(e){const t=c.director.root.pipeline.pipelineSceneData.isHDR;t?this._skyColorHDR.set(e):this._skyColorLDR.set(e),this._nativeObj.skyColor=t?this._skyColorHDR:this._skyColorLDR}get skyIllum(){return c.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR}set skyIllum(e){const t=c.director.root.pipeline.pipelineSceneData.isHDR;t?this._skyIllumHDR=e:this._skyIllumLDR=e,this._nativeObj.skyIllum=t?this._skyIllumHDR:this._skyIllumLDR}get groundAlbedo(){return c.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR:this._groundAlbedoLDR}set groundAlbedo(e){const t=c.director.root.pipeline.pipelineSceneData.isHDR;t?this._groundAlbedoHDR.set(e):this._groundAlbedoLDR.set(e),this._nativeObj.groundAlbedo=t?this._groundAlbedoHDR:this._groundAlbedoLDR}get mipmapCount(){return this._mipmapCount}set mipmapCount(e){this._mipmapCount=e}get native(){return this._nativeObj}constructor(){this._groundAlbedoHDR=new Oi(.2,.2,.2,1),this._skyColorHDR=new Oi(.2,.5,.8,1),this._skyIllumHDR=0,this._groundAlbedoLDR=new Oi(.2,.2,.2,1),this._skyColorLDR=new Oi(.2,.5,.8,1),this._skyIllumLDR=0,this._mipmapCount=1,this._enabled=!1,this._nativeObj=new Ki}initialize(e){this._skyColorHDR=e.skyColorHDR,this._groundAlbedoHDR.set(e.groundAlbedoHDR),this._skyIllumHDR=e.skyIllumHDR,this._skyColorLDR=e.skyColorLDR,this._groundAlbedoLDR.set(e.groundAlbedoLDR),this._skyIllumLDR=e.skyIllumLDR,this._nativeObj.skyIllum=this.skyIllum,this._nativeObj.skyColor=this.skyColor,this._nativeObj.groundAlbedo=this.groundAlbedo}_destroy(){this._nativeObj=null}destroy(){this._destroy()}}_o.SUN_ILLUM=65e3,_o.SKY_ILLUM=2e4,c.Ambient=_o;class uo{set enabled(e){this._enabled=e,this._nativeObj.enabled=e}get enabled(){return this._enabled}get minPos(){return this._minPos}set minPos(e){this._minPos=e,this._nativeObj.minPos=e}get maxPos(){return this._maxPos}set maxPos(e){this._maxPos=e,this._nativeObj.maxPos=e}get depth(){return this._depth}set depth(e){this._depth=e,this._nativeObj.depth=e}get native(){return this._nativeObj}constructor(){this._enabled=!1,this._minPos=new _i(0,0,0),this._maxPos=new _i(0,0,0),this._depth=0,this._nativeObj=new eo}initialize(e){this._enabled=e.enabled,this._minPos=e.minPos,this._maxPos=e.maxPos,this._depth=e.depth,this._nativeObj.enabled=this._enabled,this._nativeObj.minPos=this._minPos,this._nativeObj.maxPos=this._maxPos,this._nativeObj.depth=this._depth}_destroy(){this._nativeObj=null}destroy(){this._destroy()}}const ho=new _i,fo=new _i,po=new _i,mo=new _i,Ao=new _i,vo=new _i,go=new Array(3),xo=new Array(3);function yo(e,t){return _i.dot(t.n,e)-t.d}function bo(e,t,n){return _i.copy(e,t),_i.subtract(Ao,n.center,n.halfExtents),_i.add(vo,n.center,n.halfExtents),e.x=e.x<Ao.x?Ao.x:e.x,e.y=e.y<Ao.y?Ao.y:e.y,e.z=e.z<Ao.z?Ao.z:e.z,e.x=e.x>vo.x?vo.x:e.x,e.y=e.y>vo.y?vo.y:e.y,e.z=e.z>vo.z?vo.z:e.z,e}function So(e,t,n){_i.set(ho,n.orientation.m00,n.orientation.m01,n.orientation.m02),_i.set(fo,n.orientation.m03,n.orientation.m04,n.orientation.m05),_i.set(po,n.orientation.m06,n.orientation.m07,n.orientation.m08),go[0]=ho,go[1]=fo,go[2]=po,xo[0]=n.halfExtents.x,xo[1]=n.halfExtents.y,xo[2]=n.halfExtents.z,_i.subtract(mo,t,n.center),_i.set(e,n.center.x,n.center.y,n.center.z);for(let t=0;t<3;t++){let n=_i.dot(mo,go[t]);n>xo[t]&&(n=xo[t]),n<-xo[t]&&(n=-xo[t]),e.x+=n*go[t].x,e.y+=n*go[t].y,e.z+=n*go[t].z}return e}var Co=Object.freeze({__proto__:null,point_plane:yo,pt_point_plane:function(e,t,n){const i=yo(t,n);return _i.subtract(e,t,_i.multiplyScalar(e,n.n,i))},pt_point_aabb:bo,pt_point_obb:So,pt_point_line:function(e,t,n,i){_i.subtract(ho,n,i);const o=ho,a=_i.lengthSqr(o);if(0==a)_i.copy(e,n);else{_i.subtract(ho,t,n);const r=_i.dot(ho,o)/a;r<0?_i.copy(e,n):r>1?_i.copy(e,i):_i.scaleAndAdd(e,n,o,r)}}}),Eo={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512};class To{static create(e,t,n,i,o,a){return new To(e,t,n,i,o,a)}static clone(e){return new To(e.s.x,e.s.y,e.s.z,e.e.x,e.e.y,e.e.z)}static copy(e,t){return _i.copy(e.s,t.s),_i.copy(e.e,t.e),e}static fromPoints(e,t,n){return _i.copy(e.s,t),_i.copy(e.e,n),e}static set(e,t,n,i,o,a,r){return e.s.x=t,e.s.y=n,e.s.z=i,e.e.x=o,e.e.y=a,e.e.z=r,e}static len(e){return _i.distance(e.s,e.e)}get type(){return this._type}constructor(e=0,t=0,n=0,i=0,o=0,a=-1){this.s=void 0,this.e=void 0,this._type=void 0,this._type=Eo.SHAPE_LINE,this.s=new _i(e,t,n),this.e=new _i(i,o,a)}length(){return _i.distance(this.s,this.e)}}class Po{static create(e=0,t=0,n=0,i=0,o=0,a=1){return new Po(e,t,n,i,o,a)}static clone(e){return new Po(e.o.x,e.o.y,e.o.z,e.d.x,e.d.y,e.d.z)}static copy(e,t){return _i.copy(e.o,t.o),_i.copy(e.d,t.d),e}static fromPoints(e,t,n){return _i.copy(e.o,t),_i.normalize(e.d,_i.subtract(e.d,n,t)),e}static set(e,t,n,i,o,a,r){return e.o.x=t,e.o.y=n,e.o.z=i,e.d.x=o,e.d.y=a,e.d.z=r,e}get type(){return this._type}constructor(e=0,t=0,n=0,i=0,o=0,a=-1){this.o=void 0,this.d=void 0,this._type=void 0,this._type=Eo.SHAPE_RAY,this.o=new _i(e,t,n),this.d=new _i(i,o,a)}computeHit(e,t){_i.normalize(e,this.d),_i.scaleAndAdd(e,this.o,e,t)}}const wo=new _i,Io=new _i,Ro=new _i,Do=new _i;function No(e){return Math.max(Math.max(e.x,e.y),e.z)}class Oo{static create(e,t,n,i){return new Oo(e,t,n,i)}static clone(e){return new Oo(e.center.x,e.center.y,e.center.z,e.radius)}static copy(e,t){return _i.copy(e.center,t.center),e.radius=t.radius,e}static fromPoints(e,t,n){return _i.multiplyScalar(e.center,_i.add(wo,t,n),.5),e.radius=.5*_i.subtract(wo,n,t).length(),e}static set(e,t,n,i,o){return e.center.x=t,e.center.y=n,e.center.z=i,e.radius=o,e}get center(){return this._center}set center(e){this._center=e}get radius(){return this._radius}set radius(e){this._radius=e}get type(){return this._type}constructor(e=0,t=0,n=0,i=1){this._center=new _i(0,0,0),this._radius=0,this._type=void 0,this._type=Eo.SHAPE_SPHERE,this._center=new _i(e,t,n),this._radius=i}destroy(){}clone(){return Oo.clone(this)}copy(e){return Oo.copy(this,e)}getBoundary(e,t){_i.set(e,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),_i.set(t,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)}transform(e,t,n,i,o){_i.transformMat4(o.center,this.center,e),o.radius=this.radius*No(i)}translateAndRotate(e,t,n){_i.transformMat4(n.center,this.center,e)}setScale(e,t){t.radius=this.radius*No(e)}mergePoint(e){this.radius<0&&(this.center.set(e),this.radius=0),_i.subtract(Io,e,this.center);const t=Io.length();if(t>this.radius){const e=.5*(t-this.radius);this.radius+=e,_i.multiplyScalar(Io,Io,e/t),_i.add(this.center,this.center,Io)}}mergePoints(e){const t=e.length;if(!(t<1)){this.radius=-1;for(let n=0;n<t;n++)this.mergePoint(e[n])}}mergeAABB(e){e.getBoundary(Ro,Do),this.mergePoint(Ro),this.mergePoint(Do)}}class Mo{static create(e=1,t=0,n=0,i=0,o=0,a=0,r=0,s=0,c=1){return new Mo(e,t,n,i,o,a,r,s,c)}static clone(e){return new Mo(e.a.x,e.a.y,e.a.z,e.b.x,e.b.y,e.b.z,e.c.x,e.c.y,e.c.z)}static copy(e,t){return _i.copy(e.a,t.a),_i.copy(e.b,t.b),_i.copy(e.c,t.c),e}static fromPoints(e,t,n,i){return _i.copy(e.a,t),_i.copy(e.b,n),_i.copy(e.c,i),e}static set(e,t,n,i,o,a,r,s,c,l){return e.a.x=t,e.a.y=n,e.a.z=i,e.b.x=o,e.b.y=a,e.b.z=r,e.c.x=s,e.c.y=c,e.c.z=l,e}get type(){return this._type}constructor(e=0,t=0,n=0,i=1,o=0,a=0,r=0,s=1,c=0){this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=Eo.SHAPE_TRIANGLE,this.a=new _i(e,t,n),this.b=new _i(i,o,a),this.c=new _i(r,s,c)}}const zo=(e,t,n)=>{for(let i=0;i<t.length;++i)e.length<=i&&e.push(new n),e[i].copy(t[i]);e.length=t.length};let Lo,Fo,Bo,ko,Uo,Go,jo,Vo,Ho,Wo,qo,Yo,Xo,Qo,Zo,Jo,Ko,$o,ea,ta,na,ia,oa,aa,ra,sa,ca,la,_a,ua,ha,fa,pa,da,ma,Aa,va,ga,xa,ya,ba,Sa;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SWAPCHAIN=1]="SWAPCHAIN",e[e.BUFFER=2]="BUFFER",e[e.TEXTURE=3]="TEXTURE",e[e.RENDER_PASS=4]="RENDER_PASS",e[e.FRAMEBUFFER=5]="FRAMEBUFFER",e[e.SAMPLER=6]="SAMPLER",e[e.SHADER=7]="SHADER",e[e.DESCRIPTOR_SET_LAYOUT=8]="DESCRIPTOR_SET_LAYOUT",e[e.PIPELINE_LAYOUT=9]="PIPELINE_LAYOUT",e[e.PIPELINE_STATE=10]="PIPELINE_STATE",e[e.DESCRIPTOR_SET=11]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=12]="INPUT_ASSEMBLER",e[e.COMMAND_BUFFER=13]="COMMAND_BUFFER",e[e.QUEUE=14]="QUEUE",e[e.QUERY_POOL=15]="QUERY_POOL",e[e.GLOBAL_BARRIER=16]="GLOBAL_BARRIER",e[e.TEXTURE_BARRIER=17]="TEXTURE_BARRIER",e[e.BUFFER_BARRIER=18]="BUFFER_BARRIER",e[e.COUNT=19]="COUNT"}(Lo||(Lo=e("O",{}))),function(e){e[e.UNREADY=0]="UNREADY",e[e.FAILED=1]="FAILED",e[e.SUCCESS=2]="SUCCESS"}(Fo||(Fo=e("f",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.GLES2=1]="GLES2",e[e.GLES3=2]="GLES3",e[e.METAL=3]="METAL",e[e.VULKAN=4]="VULKAN",e[e.WEBGL=5]="WEBGL",e[e.WEBGL2=6]="WEBGL2",e[e.WEBGPU=7]="WEBGPU"}(Bo||(Bo=e("A",{}))),function(e){e[e.IDENTITY=0]="IDENTITY",e[e.ROTATE_90=1]="ROTATE_90",e[e.ROTATE_180=2]="ROTATE_180",e[e.ROTATE_270=3]="ROTATE_270"}(ko||(ko=e("c",{}))),function(e){e[e.COLOR_FLOAT=0]="COLOR_FLOAT",e[e.COLOR_HALF_FLOAT=1]="COLOR_HALF_FLOAT",e[e.TEXTURE_FLOAT=2]="TEXTURE_FLOAT",e[e.TEXTURE_HALF_FLOAT=3]="TEXTURE_HALF_FLOAT",e[e.TEXTURE_FLOAT_LINEAR=4]="TEXTURE_FLOAT_LINEAR",e[e.TEXTURE_HALF_FLOAT_LINEAR=5]="TEXTURE_HALF_FLOAT_LINEAR",e[e.FORMAT_R11G11B10F=6]="FORMAT_R11G11B10F",e[e.FORMAT_SRGB=7]="FORMAT_SRGB",e[e.FORMAT_ETC1=8]="FORMAT_ETC1",e[e.FORMAT_ETC2=9]="FORMAT_ETC2",e[e.FORMAT_DXT=10]="FORMAT_DXT",e[e.FORMAT_PVRTC=11]="FORMAT_PVRTC",e[e.FORMAT_ASTC=12]="FORMAT_ASTC",e[e.FORMAT_RGB8=13]="FORMAT_RGB8",e[e.ELEMENT_INDEX_UINT=14]="ELEMENT_INDEX_UINT",e[e.INSTANCED_ARRAYS=15]="INSTANCED_ARRAYS",e[e.MULTIPLE_RENDER_TARGETS=16]="MULTIPLE_RENDER_TARGETS",e[e.BLEND_MINMAX=17]="BLEND_MINMAX",e[e.COMPUTE_SHADER=18]="COMPUTE_SHADER",e[e.INPUT_ATTACHMENT_BENEFIT=19]="INPUT_ATTACHMENT_BENEFIT",e[e.COUNT=20]="COUNT"}(Uo||(Uo=e("F",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.A8=1]="A8",e[e.L8=2]="L8",e[e.LA8=3]="LA8",e[e.R8=4]="R8",e[e.R8SN=5]="R8SN",e[e.R8UI=6]="R8UI",e[e.R8I=7]="R8I",e[e.R16F=8]="R16F",e[e.R16UI=9]="R16UI",e[e.R16I=10]="R16I",e[e.R32F=11]="R32F",e[e.R32UI=12]="R32UI",e[e.R32I=13]="R32I",e[e.RG8=14]="RG8",e[e.RG8SN=15]="RG8SN",e[e.RG8UI=16]="RG8UI",e[e.RG8I=17]="RG8I",e[e.RG16F=18]="RG16F",e[e.RG16UI=19]="RG16UI",e[e.RG16I=20]="RG16I",e[e.RG32F=21]="RG32F",e[e.RG32UI=22]="RG32UI",e[e.RG32I=23]="RG32I",e[e.RGB8=24]="RGB8",e[e.SRGB8=25]="SRGB8",e[e.RGB8SN=26]="RGB8SN",e[e.RGB8UI=27]="RGB8UI",e[e.RGB8I=28]="RGB8I",e[e.RGB16F=29]="RGB16F",e[e.RGB16UI=30]="RGB16UI",e[e.RGB16I=31]="RGB16I",e[e.RGB32F=32]="RGB32F",e[e.RGB32UI=33]="RGB32UI",e[e.RGB32I=34]="RGB32I",e[e.RGBA8=35]="RGBA8",e[e.BGRA8=36]="BGRA8",e[e.SRGB8_A8=37]="SRGB8_A8",e[e.RGBA8SN=38]="RGBA8SN",e[e.RGBA8UI=39]="RGBA8UI",e[e.RGBA8I=40]="RGBA8I",e[e.RGBA16F=41]="RGBA16F",e[e.RGBA16UI=42]="RGBA16UI",e[e.RGBA16I=43]="RGBA16I",e[e.RGBA32F=44]="RGBA32F",e[e.RGBA32UI=45]="RGBA32UI",e[e.RGBA32I=46]="RGBA32I",e[e.R5G6B5=47]="R5G6B5",e[e.R11G11B10F=48]="R11G11B10F",e[e.RGB5A1=49]="RGB5A1",e[e.RGBA4=50]="RGBA4",e[e.RGB10A2=51]="RGB10A2",e[e.RGB10A2UI=52]="RGB10A2UI",e[e.RGB9E5=53]="RGB9E5",e[e.DEPTH=54]="DEPTH",e[e.DEPTH_STENCIL=55]="DEPTH_STENCIL",e[e.BC1=56]="BC1",e[e.BC1_ALPHA=57]="BC1_ALPHA",e[e.BC1_SRGB=58]="BC1_SRGB",e[e.BC1_SRGB_ALPHA=59]="BC1_SRGB_ALPHA",e[e.BC2=60]="BC2",e[e.BC2_SRGB=61]="BC2_SRGB",e[e.BC3=62]="BC3",e[e.BC3_SRGB=63]="BC3_SRGB",e[e.BC4=64]="BC4",e[e.BC4_SNORM=65]="BC4_SNORM",e[e.BC5=66]="BC5",e[e.BC5_SNORM=67]="BC5_SNORM",e[e.BC6H_UF16=68]="BC6H_UF16",e[e.BC6H_SF16=69]="BC6H_SF16",e[e.BC7=70]="BC7",e[e.BC7_SRGB=71]="BC7_SRGB",e[e.ETC_RGB8=72]="ETC_RGB8",e[e.ETC2_RGB8=73]="ETC2_RGB8",e[e.ETC2_SRGB8=74]="ETC2_SRGB8",e[e.ETC2_RGB8_A1=75]="ETC2_RGB8_A1",e[e.ETC2_SRGB8_A1=76]="ETC2_SRGB8_A1",e[e.ETC2_RGBA8=77]="ETC2_RGBA8",e[e.ETC2_SRGB8_A8=78]="ETC2_SRGB8_A8",e[e.EAC_R11=79]="EAC_R11",e[e.EAC_R11SN=80]="EAC_R11SN",e[e.EAC_RG11=81]="EAC_RG11",e[e.EAC_RG11SN=82]="EAC_RG11SN",e[e.PVRTC_RGB2=83]="PVRTC_RGB2",e[e.PVRTC_RGBA2=84]="PVRTC_RGBA2",e[e.PVRTC_RGB4=85]="PVRTC_RGB4",e[e.PVRTC_RGBA4=86]="PVRTC_RGBA4",e[e.PVRTC2_2BPP=87]="PVRTC2_2BPP",e[e.PVRTC2_4BPP=88]="PVRTC2_4BPP",e[e.ASTC_RGBA_4X4=89]="ASTC_RGBA_4X4",e[e.ASTC_RGBA_5X4=90]="ASTC_RGBA_5X4",e[e.ASTC_RGBA_5X5=91]="ASTC_RGBA_5X5",e[e.ASTC_RGBA_6X5=92]="ASTC_RGBA_6X5",e[e.ASTC_RGBA_6X6=93]="ASTC_RGBA_6X6",e[e.ASTC_RGBA_8X5=94]="ASTC_RGBA_8X5",e[e.ASTC_RGBA_8X6=95]="ASTC_RGBA_8X6",e[e.ASTC_RGBA_8X8=96]="ASTC_RGBA_8X8",e[e.ASTC_RGBA_10X5=97]="ASTC_RGBA_10X5",e[e.ASTC_RGBA_10X6=98]="ASTC_RGBA_10X6",e[e.ASTC_RGBA_10X8=99]="ASTC_RGBA_10X8",e[e.ASTC_RGBA_10X10=100]="ASTC_RGBA_10X10",e[e.ASTC_RGBA_12X10=101]="ASTC_RGBA_12X10",e[e.ASTC_RGBA_12X12=102]="ASTC_RGBA_12X12",e[e.ASTC_SRGBA_4X4=103]="ASTC_SRGBA_4X4",e[e.ASTC_SRGBA_5X4=104]="ASTC_SRGBA_5X4",e[e.ASTC_SRGBA_5X5=105]="ASTC_SRGBA_5X5",e[e.ASTC_SRGBA_6X5=106]="ASTC_SRGBA_6X5",e[e.ASTC_SRGBA_6X6=107]="ASTC_SRGBA_6X6",e[e.ASTC_SRGBA_8X5=108]="ASTC_SRGBA_8X5",e[e.ASTC_SRGBA_8X6=109]="ASTC_SRGBA_8X6",e[e.ASTC_SRGBA_8X8=110]="ASTC_SRGBA_8X8",e[e.ASTC_SRGBA_10X5=111]="ASTC_SRGBA_10X5",e[e.ASTC_SRGBA_10X6=112]="ASTC_SRGBA_10X6",e[e.ASTC_SRGBA_10X8=113]="ASTC_SRGBA_10X8",e[e.ASTC_SRGBA_10X10=114]="ASTC_SRGBA_10X10",e[e.ASTC_SRGBA_12X10=115]="ASTC_SRGBA_12X10",e[e.ASTC_SRGBA_12X12=116]="ASTC_SRGBA_12X12",e[e.COUNT=117]="COUNT"}(Go||(Go=e("g",{}))),function(e){e[e.NONE=0]="NONE",e[e.UNORM=1]="UNORM",e[e.SNORM=2]="SNORM",e[e.UINT=3]="UINT",e[e.INT=4]="INT",e[e.UFLOAT=5]="UFLOAT",e[e.FLOAT=6]="FLOAT"}(jo||(jo=e("h",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BOOL=1]="BOOL",e[e.BOOL2=2]="BOOL2",e[e.BOOL3=3]="BOOL3",e[e.BOOL4=4]="BOOL4",e[e.INT=5]="INT",e[e.INT2=6]="INT2",e[e.INT3=7]="INT3",e[e.INT4=8]="INT4",e[e.UINT=9]="UINT",e[e.UINT2=10]="UINT2",e[e.UINT3=11]="UINT3",e[e.UINT4=12]="UINT4",e[e.FLOAT=13]="FLOAT",e[e.FLOAT2=14]="FLOAT2",e[e.FLOAT3=15]="FLOAT3",e[e.FLOAT4=16]="FLOAT4",e[e.MAT2=17]="MAT2",e[e.MAT2X3=18]="MAT2X3",e[e.MAT2X4=19]="MAT2X4",e[e.MAT3X2=20]="MAT3X2",e[e.MAT3=21]="MAT3",e[e.MAT3X4=22]="MAT3X4",e[e.MAT4X2=23]="MAT4X2",e[e.MAT4X3=24]="MAT4X3",e[e.MAT4=25]="MAT4",e[e.SAMPLER1D=26]="SAMPLER1D",e[e.SAMPLER1D_ARRAY=27]="SAMPLER1D_ARRAY",e[e.SAMPLER2D=28]="SAMPLER2D",e[e.SAMPLER2D_ARRAY=29]="SAMPLER2D_ARRAY",e[e.SAMPLER3D=30]="SAMPLER3D",e[e.SAMPLER_CUBE=31]="SAMPLER_CUBE",e[e.SAMPLER=32]="SAMPLER",e[e.TEXTURE1D=33]="TEXTURE1D",e[e.TEXTURE1D_ARRAY=34]="TEXTURE1D_ARRAY",e[e.TEXTURE2D=35]="TEXTURE2D",e[e.TEXTURE2D_ARRAY=36]="TEXTURE2D_ARRAY",e[e.TEXTURE3D=37]="TEXTURE3D",e[e.TEXTURE_CUBE=38]="TEXTURE_CUBE",e[e.IMAGE1D=39]="IMAGE1D",e[e.IMAGE1D_ARRAY=40]="IMAGE1D_ARRAY",e[e.IMAGE2D=41]="IMAGE2D",e[e.IMAGE2D_ARRAY=42]="IMAGE2D_ARRAY",e[e.IMAGE3D=43]="IMAGE3D",e[e.IMAGE_CUBE=44]="IMAGE_CUBE",e[e.SUBPASS_INPUT=45]="SUBPASS_INPUT",e[e.COUNT=46]="COUNT"}(Vo||(Vo=e("i",{}))),function(e){e[e.NONE=0]="NONE",e[e.TRANSFER_SRC=1]="TRANSFER_SRC",e[e.TRANSFER_DST=2]="TRANSFER_DST",e[e.INDEX=4]="INDEX",e[e.VERTEX=8]="VERTEX",e[e.UNIFORM=16]="UNIFORM",e[e.STORAGE=32]="STORAGE",e[e.INDIRECT=64]="INDIRECT"}(Ho||(Ho=e("B",{}))),function(e){e[e.NONE=0]="NONE"}(Wo||(Wo=e("b",{}))),function(e){e[e.NONE=0]="NONE",e[e.READ_ONLY=1]="READ_ONLY",e[e.WRITE_ONLY=2]="WRITE_ONLY",e[e.READ_WRITE=3]="READ_WRITE"}(qo||(qo=e("j",{}))),function(e){e[e.NONE=0]="NONE",e[e.DEVICE=1]="DEVICE",e[e.HOST=2]="HOST"}(Yo||(Yo=e("M",{}))),function(e){e[e.TEX1D=0]="TEX1D",e[e.TEX2D=1]="TEX2D",e[e.TEX3D=2]="TEX3D",e[e.CUBE=3]="CUBE",e[e.TEX1D_ARRAY=4]="TEX1D_ARRAY",e[e.TEX2D_ARRAY=5]="TEX2D_ARRAY"}(Xo||(Xo=e("k",{}))),function(e){e[e.NONE=0]="NONE",e[e.TRANSFER_SRC=1]="TRANSFER_SRC",e[e.TRANSFER_DST=2]="TRANSFER_DST",e[e.SAMPLED=4]="SAMPLED",e[e.STORAGE=8]="STORAGE",e[e.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",e[e.INPUT_ATTACHMENT=64]="INPUT_ATTACHMENT"}(Qo||(Qo=e("l",{}))),function(e){e[e.NONE=0]="NONE",e[e.GEN_MIPMAP=1]="GEN_MIPMAP",e[e.GENERAL_LAYOUT=2]="GENERAL_LAYOUT"}(Zo||(Zo=e("n",{}))),function(e){e[e.ONE=0]="ONE",e[e.MULTIPLE_PERFORMANCE=1]="MULTIPLE_PERFORMANCE",e[e.MULTIPLE_BALANCE=2]="MULTIPLE_BALANCE",e[e.MULTIPLE_QUALITY=3]="MULTIPLE_QUALITY"}(Jo||(Jo=e("o",{}))),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON",e[e.RELAXED=2]="RELAXED",e[e.MAILBOX=3]="MAILBOX",e[e.HALF=4]="HALF"}(Ko||(Ko=e("V",{}))),function(e){e[e.NONE=0]="NONE",e[e.POINT=1]="POINT",e[e.LINEAR=2]="LINEAR",e[e.ANISOTROPIC=3]="ANISOTROPIC"}($o||($o=e("p",{}))),function(e){e[e.WRAP=0]="WRAP",e[e.MIRROR=1]="MIRROR",e[e.CLAMP=2]="CLAMP",e[e.BORDER=3]="BORDER"}(ea||(ea=e("q",{}))),function(e){e[e.NEVER=0]="NEVER",e[e.LESS=1]="LESS",e[e.EQUAL=2]="EQUAL",e[e.LESS_EQUAL=3]="LESS_EQUAL",e[e.GREATER=4]="GREATER",e[e.NOT_EQUAL=5]="NOT_EQUAL",e[e.GREATER_EQUAL=6]="GREATER_EQUAL",e[e.ALWAYS=7]="ALWAYS"}(ta||(ta=e("r",{}))),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=1]="KEEP",e[e.REPLACE=2]="REPLACE",e[e.INCR=3]="INCR",e[e.DECR=4]="DECR",e[e.INVERT=5]="INVERT",e[e.INCR_WRAP=6]="INCR_WRAP",e[e.DECR_WRAP=7]="DECR_WRAP"}(na||(na=e("s",{}))),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=2]="SRC_ALPHA",e[e.DST_ALPHA=3]="DST_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",e[e.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",e[e.SRC_COLOR=6]="SRC_COLOR",e[e.DST_COLOR=7]="DST_COLOR",e[e.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",e[e.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=11]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(ia||(ia=e("t",{}))),function(e){e[e.ADD=0]="ADD",e[e.SUB=1]="SUB",e[e.REV_SUB=2]="REV_SUB",e[e.MIN=3]="MIN",e[e.MAX=4]="MAX"}(oa||(oa=e("u",{}))),function(e){e[e.NONE=0]="NONE",e[e.R=1]="R",e[e.G=2]="G",e[e.B=4]="B",e[e.A=8]="A",e[e.ALL=15]="ALL"}(aa||(aa=e("v",{}))),function(e){e[e.NONE=0]="NONE",e[e.VERTEX=1]="VERTEX",e[e.CONTROL=2]="CONTROL",e[e.EVALUATION=4]="EVALUATION",e[e.GEOMETRY=8]="GEOMETRY",e[e.FRAGMENT=16]="FRAGMENT",e[e.COMPUTE=32]="COMPUTE",e[e.ALL=63]="ALL"}(ra||(ra=e("w",{}))),function(e){e[e.LOAD=0]="LOAD",e[e.CLEAR=1]="CLEAR",e[e.DISCARD=2]="DISCARD"}(sa||(sa=e("L",{}))),function(e){e[e.STORE=0]="STORE",e[e.DISCARD=1]="DISCARD"}(ca||(ca=e("x",{}))),function(e){e[e.NONE=0]="NONE",e[e.INDIRECT_BUFFER=1]="INDIRECT_BUFFER",e[e.INDEX_BUFFER=2]="INDEX_BUFFER",e[e.VERTEX_BUFFER=3]="VERTEX_BUFFER",e[e.VERTEX_SHADER_READ_UNIFORM_BUFFER=4]="VERTEX_SHADER_READ_UNIFORM_BUFFER",e[e.VERTEX_SHADER_READ_TEXTURE=5]="VERTEX_SHADER_READ_TEXTURE",e[e.VERTEX_SHADER_READ_OTHER=6]="VERTEX_SHADER_READ_OTHER",e[e.FRAGMENT_SHADER_READ_UNIFORM_BUFFER=7]="FRAGMENT_SHADER_READ_UNIFORM_BUFFER",e[e.FRAGMENT_SHADER_READ_TEXTURE=8]="FRAGMENT_SHADER_READ_TEXTURE",e[e.FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT=9]="FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT",e[e.FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT=10]="FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT",e[e.FRAGMENT_SHADER_READ_OTHER=11]="FRAGMENT_SHADER_READ_OTHER",e[e.COLOR_ATTACHMENT_READ=12]="COLOR_ATTACHMENT_READ",e[e.DEPTH_STENCIL_ATTACHMENT_READ=13]="DEPTH_STENCIL_ATTACHMENT_READ",e[e.COMPUTE_SHADER_READ_UNIFORM_BUFFER=14]="COMPUTE_SHADER_READ_UNIFORM_BUFFER",e[e.COMPUTE_SHADER_READ_TEXTURE=15]="COMPUTE_SHADER_READ_TEXTURE",e[e.COMPUTE_SHADER_READ_OTHER=16]="COMPUTE_SHADER_READ_OTHER",e[e.TRANSFER_READ=17]="TRANSFER_READ",e[e.HOST_READ=18]="HOST_READ",e[e.PRESENT=19]="PRESENT",e[e.VERTEX_SHADER_WRITE=20]="VERTEX_SHADER_WRITE",e[e.FRAGMENT_SHADER_WRITE=21]="FRAGMENT_SHADER_WRITE",e[e.COLOR_ATTACHMENT_WRITE=22]="COLOR_ATTACHMENT_WRITE",e[e.DEPTH_STENCIL_ATTACHMENT_WRITE=23]="DEPTH_STENCIL_ATTACHMENT_WRITE",e[e.COMPUTE_SHADER_WRITE=24]="COMPUTE_SHADER_WRITE",e[e.TRANSFER_WRITE=25]="TRANSFER_WRITE",e[e.HOST_PREINITIALIZED=26]="HOST_PREINITIALIZED",e[e.HOST_WRITE=27]="HOST_WRITE"}(la||(la=e("y",{}))),function(e){e[e.NONE=0]="NONE",e[e.SAMPLE_ZERO=1]="SAMPLE_ZERO",e[e.AVERAGE=2]="AVERAGE",e[e.MIN=3]="MIN",e[e.MAX=4]="MAX"}(_a||(_a=e("z",{}))),function(e){e[e.GRAPHICS=0]="GRAPHICS",e[e.COMPUTE=1]="COMPUTE",e[e.RAY_TRACING=2]="RAY_TRACING"}(ua||(ua=e("E",{}))),function(e){e[e.POINT_LIST=0]="POINT_LIST",e[e.LINE_LIST=1]="LINE_LIST",e[e.LINE_STRIP=2]="LINE_STRIP",e[e.LINE_LOOP=3]="LINE_LOOP",e[e.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",e[e.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",e[e.ISO_LINE_LIST=6]="ISO_LINE_LIST",e[e.TRIANGLE_LIST=7]="TRIANGLE_LIST",e[e.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=9]="TRIANGLE_FAN",e[e.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",e[e.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",e[e.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",e[e.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(ha||(ha=e("H",{}))),function(e){e[e.FILL=0]="FILL",e[e.POINT=1]="POINT",e[e.LINE=2]="LINE"}(fa||(fa=e("I",{}))),function(e){e[e.GOURAND=0]="GOURAND",e[e.FLAT=1]="FLAT"}(pa||(pa=e("J",{}))),function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK"}(da||(da=e("K",{}))),function(e){e[e.NONE=0]="NONE",e[e.LINE_WIDTH=1]="LINE_WIDTH",e[e.DEPTH_BIAS=2]="DEPTH_BIAS",e[e.BLEND_CONSTANTS=4]="BLEND_CONSTANTS",e[e.DEPTH_BOUNDS=8]="DEPTH_BOUNDS",e[e.STENCIL_WRITE_MASK=16]="STENCIL_WRITE_MASK",e[e.STENCIL_COMPARE_MASK=32]="STENCIL_COMPARE_MASK"}(ma||(ma=e("N",{}))),function(e){e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.ALL=3]="ALL"}(Aa||(Aa=e("U",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",e[e.DYNAMIC_UNIFORM_BUFFER=2]="DYNAMIC_UNIFORM_BUFFER",e[e.STORAGE_BUFFER=4]="STORAGE_BUFFER",e[e.DYNAMIC_STORAGE_BUFFER=8]="DYNAMIC_STORAGE_BUFFER",e[e.SAMPLER_TEXTURE=16]="SAMPLER_TEXTURE",e[e.SAMPLER=32]="SAMPLER",e[e.TEXTURE=64]="TEXTURE",e[e.STORAGE_IMAGE=128]="STORAGE_IMAGE",e[e.INPUT_ATTACHMENT=256]="INPUT_ATTACHMENT"}(va||(va=e("W",{}))),function(e){e[e.GRAPHICS=0]="GRAPHICS",e[e.COMPUTE=1]="COMPUTE",e[e.TRANSFER=2]="TRANSFER"}(ga||(ga=e("Q",{}))),function(e){e[e.OCCLUSION=0]="OCCLUSION",e[e.PIPELINE_STATISTICS=1]="PIPELINE_STATISTICS",e[e.TIMESTAMP=2]="TIMESTAMP"}(xa||(xa=e("X",{}))),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.SECONDARY=1]="SECONDARY"}(ya||(ya=e("C",{}))),function(e){e[e.NONE=0]="NONE",e[e.COLOR=1]="COLOR",e[e.DEPTH=2]="DEPTH",e[e.STENCIL=4]="STENCIL",e[e.DEPTH_STENCIL=6]="DEPTH_STENCIL",e[e.ALL=7]="ALL"}(ba||(ba=e("Y",{})));class Ca{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}}e("Z",Ca);class Ea{constructor(e=0,t=0,n=0,i=0,o=0,a=0,r=0,s=0,c=0,l=0,_=0,u=0,h=0,f=1,p=0,d=0,m=new Ca,A=new Ca,v=!1,g=-1,x=1,y=1){this.maxVertexAttributes=e,this.maxVertexUniformVectors=t,this.maxFragmentUniformVectors=n,this.maxTextureUnits=i,this.maxImageUnits=o,this.maxVertexTextureUnits=a,this.maxColorRenderTargets=r,this.maxShaderStorageBufferBindings=s,this.maxShaderStorageBlockSize=c,this.maxUniformBufferBindings=l,this.maxUniformBlockSize=_,this.maxTextureSize=u,this.maxCubeMapTextureSize=h,this.uboOffsetAlignment=f,this.maxComputeSharedMemorySize=p,this.maxComputeWorkGroupInvocations=d,this.maxComputeWorkGroupSize=m,this.maxComputeWorkGroupCount=A,this.supportQuery=v,this.clipSpaceMinZ=g,this.screenSpaceSignY=x,this.clipSpaceSignY=y}copy(e){return this.maxVertexAttributes=e.maxVertexAttributes,this.maxVertexUniformVectors=e.maxVertexUniformVectors,this.maxFragmentUniformVectors=e.maxFragmentUniformVectors,this.maxTextureUnits=e.maxTextureUnits,this.maxImageUnits=e.maxImageUnits,this.maxVertexTextureUnits=e.maxVertexTextureUnits,this.maxColorRenderTargets=e.maxColorRenderTargets,this.maxShaderStorageBufferBindings=e.maxShaderStorageBufferBindings,this.maxShaderStorageBlockSize=e.maxShaderStorageBlockSize,this.maxUniformBufferBindings=e.maxUniformBufferBindings,this.maxUniformBlockSize=e.maxUniformBlockSize,this.maxTextureSize=e.maxTextureSize,this.maxCubeMapTextureSize=e.maxCubeMapTextureSize,this.uboOffsetAlignment=e.uboOffsetAlignment,this.maxComputeSharedMemorySize=e.maxComputeSharedMemorySize,this.maxComputeWorkGroupInvocations=e.maxComputeWorkGroupInvocations,this.maxComputeWorkGroupSize.copy(e.maxComputeWorkGroupSize),this.maxComputeWorkGroupCount.copy(e.maxComputeWorkGroupCount),this.supportQuery=e.supportQuery,this.clipSpaceMinZ=e.clipSpaceMinZ,this.screenSpaceSignY=e.screenSpaceSignY,this.clipSpaceSignY=e.clipSpaceSignY,this}}e("_",Ea);class Ta{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}}e("$",Ta);class Pa{constructor(e=0,t=0,n=0,i=0){this.x=e,this.y=t,this.width=n,this.height=i}copy(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}}e("a0",Pa);class wa{constructor(e=0,t=0,n=1){this.width=e,this.height=t,this.depth=n}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this}}e("a1",wa);class Ia{constructor(e=0,t=0,n=1){this.mipLevel=e,this.baseArrayLayer=t,this.layerCount=n}copy(e){return this.mipLevel=e.mipLevel,this.baseArrayLayer=e.baseArrayLayer,this.layerCount=e.layerCount,this}}e("a2",Ia);class Ra{constructor(e=0,t=1,n=0,i=1){this.baseMipLevel=e,this.levelCount=t,this.baseArrayLayer=n,this.layerCount=i}copy(e){return this.baseMipLevel=e.baseMipLevel,this.levelCount=e.levelCount,this.baseArrayLayer=e.baseArrayLayer,this.layerCount=e.layerCount,this}}e("a3",Ra);class Da{constructor(e=new Ia,t=new Ta,n=new Ia,i=new Ta,o=new wa){this.srcSubres=e,this.srcOffset=t,this.dstSubres=n,this.dstOffset=i,this.extent=o}copy(e){return this.srcSubres.copy(e.srcSubres),this.srcOffset.copy(e.srcOffset),this.dstSubres.copy(e.dstSubres),this.dstOffset.copy(e.dstOffset),this.extent.copy(e.extent),this}}e("a4",Da);class Na{constructor(e=new Ia,t=new Ta,n=new wa,i=new Ia,o=new Ta,a=new wa){this.srcSubres=e,this.srcOffset=t,this.srcExtent=n,this.dstSubres=i,this.dstOffset=o,this.dstExtent=a}copy(e){return this.srcSubres.copy(e.srcSubres),this.srcOffset.copy(e.srcOffset),this.srcExtent.copy(e.srcExtent),this.dstSubres.copy(e.dstSubres),this.dstOffset.copy(e.dstOffset),this.dstExtent.copy(e.dstExtent),this}}e("a5",Na);class Oa{constructor(e=0,t=0,n=new Ta,i=new wa,o=new Ia){this.buffStride=e,this.buffTexHeight=t,this.texOffset=n,this.texExtent=i,this.texSubres=o}copy(e){return this.buffStride=e.buffStride,this.buffTexHeight=e.buffTexHeight,this.texOffset.copy(e.texOffset),this.texExtent.copy(e.texExtent),this.texSubres.copy(e.texSubres),this}}e("a6",Oa);class Ma{constructor(e=0,t=0,n=0,i=0,o=0,a=1){this.left=e,this.top=t,this.width=n,this.height=i,this.minDepth=o,this.maxDepth=a}copy(e){return this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height,this.minDepth=e.minDepth,this.maxDepth=e.maxDepth,this}}e("a7",Ma);class za{constructor(e=0,t=0,n=0,i=0){this.x=e,this.y=t,this.z=n,this.w=i}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}}e("a8",za);class La{constructor(e=[],t=[],n=0){this.bufferOffsets=e,this.samplerOffsets=t,this.flexibleSet=n}copy(e){return this.bufferOffsets=e.bufferOffsets.slice(),this.samplerOffsets=e.samplerOffsets.slice(),this.flexibleSet=e.flexibleSet,this}}e("a9",La);class Fa{constructor(e=null,t=Ko.ON,n=0,i=0){this.windowHandle=e,this.vsyncMode=t,this.width=n,this.height=i}copy(e){return this.windowHandle=e.windowHandle,this.vsyncMode=e.vsyncMode,this.width=e.width,this.height=e.height,this}}e("aa",Fa);class Ba{constructor(e=new La){this.bindingMappingInfo=e}copy(e){return this.bindingMappingInfo.copy(e.bindingMappingInfo),this}}e("ab",Ba);class ka{constructor(e=Ho.NONE,t=Yo.NONE,n=0,i=1,o=Wo.NONE){this.usage=e,this.memUsage=t,this.size=n,this.stride=i,this.flags=o}copy(e){return this.usage=e.usage,this.memUsage=e.memUsage,this.size=e.size,this.stride=e.stride,this.flags=e.flags,this}}e("ac",ka);class Ua{constructor(e=null,t=0,n=0){this.buffer=e,this.offset=t,this.range=n}copy(e){return this.buffer=e.buffer,this.offset=e.offset,this.range=e.range,this}}e("ad",Ua);class Ga{constructor(e=0,t=0,n=0,i=0,o=0,a=0,r=0){this.vertexCount=e,this.firstVertex=t,this.indexCount=n,this.firstIndex=i,this.vertexOffset=o,this.instanceCount=a,this.firstInstance=r}copy(e){return this.vertexCount=e.vertexCount,this.firstVertex=e.firstVertex,this.indexCount=e.indexCount,this.firstIndex=e.firstIndex,this.vertexOffset=e.vertexOffset,this.instanceCount=e.instanceCount,this.firstInstance=e.firstInstance,this}}e("d",Ga);class ja{constructor(e=0,t=0,n=0,i=null,o=0){this.groupCountX=e,this.groupCountY=t,this.groupCountZ=n,this.indirectBuffer=i,this.indirectOffset=o}copy(e){return this.groupCountX=e.groupCountX,this.groupCountY=e.groupCountY,this.groupCountZ=e.groupCountZ,this.indirectBuffer=e.indirectBuffer,this.indirectOffset=e.indirectOffset,this}}e("ae",ja);class Va{constructor(e=[]){this.drawInfos=e}copy(e){return zo(this.drawInfos,e.drawInfos,Ga),this}}e("af",Va);class Ha{constructor(e=Xo.TEX2D,t=Qo.NONE,n=Go.UNKNOWN,i=0,o=0,a=Zo.NONE,r=1,s=1,c=Jo.ONE,l=1,_=0){this.type=e,this.usage=t,this.format=n,this.width=i,this.height=o,this.flags=a,this.layerCount=r,this.levelCount=s,this.samples=c,this.depth=l,this.externalRes=_}copy(e){return this.type=e.type,this.usage=e.usage,this.format=e.format,this.width=e.width,this.height=e.height,this.flags=e.flags,this.layerCount=e.layerCount,this.levelCount=e.levelCount,this.samples=e.samples,this.depth=e.depth,this.externalRes=e.externalRes,this}}e("ag",Ha);class Wa{constructor(e=null,t=Xo.TEX2D,n=Go.UNKNOWN,i=0,o=1,a=0,r=1){this.texture=e,this.type=t,this.format=n,this.baseLevel=i,this.levelCount=o,this.baseLayer=a,this.layerCount=r}copy(e){return this.texture=e.texture,this.type=e.type,this.format=e.format,this.baseLevel=e.baseLevel,this.levelCount=e.levelCount,this.baseLayer=e.baseLayer,this.layerCount=e.layerCount,this}}e("ah",Wa);class qa{constructor(e=$o.LINEAR,t=$o.LINEAR,n=$o.NONE,i=ea.WRAP,o=ea.WRAP,a=ea.WRAP,r=0,s=ta.ALWAYS){this.minFilter=e,this.magFilter=t,this.mipFilter=n,this.addressU=i,this.addressV=o,this.addressW=a,this.maxAnisotropy=r,this.cmpFunc=s}copy(e){return this.minFilter=e.minFilter,this.magFilter=e.magFilter,this.mipFilter=e.mipFilter,this.addressU=e.addressU,this.addressV=e.addressV,this.addressW=e.addressW,this.maxAnisotropy=e.maxAnisotropy,this.cmpFunc=e.cmpFunc,this}}e("ai",qa);class Ya{constructor(e="",t=Vo.UNKNOWN,n=0){this.name=e,this.type=t,this.count=n}copy(e){return this.name=e.name,this.type=e.type,this.count=e.count,this}}e("aj",Ya);class Xa{constructor(e=0,t=0,n="",i=[],o=0){this.set=e,this.binding=t,this.name=n,this.members=i,this.count=o}copy(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,zo(this.members,e.members,Ya),this.count=e.count,this}}e("ak",Xa);class Qa{constructor(e=0,t=0,n="",i=Vo.UNKNOWN,o=0){this.set=e,this.binding=t,this.name=n,this.type=i,this.count=o}copy(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.type=e.type,this.count=e.count,this}}e("al",Qa);class Za{constructor(e=0,t=0,n="",i=0){this.set=e,this.binding=t,this.name=n,this.count=i}copy(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.count=e.count,this}}e("am",Za);class Ja{constructor(e=0,t=0,n="",i=Vo.UNKNOWN,o=0){this.set=e,this.binding=t,this.name=n,this.type=i,this.count=o}copy(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.type=e.type,this.count=e.count,this}}e("an",Ja);class Ka{constructor(e=0,t=0,n="",i=Vo.UNKNOWN,o=0,a=qo.READ_WRITE){this.set=e,this.binding=t,this.name=n,this.type=i,this.count=o,this.memoryAccess=a}copy(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.type=e.type,this.count=e.count,this.memoryAccess=e.memoryAccess,this}}e("ao",Ka);class $a{constructor(e=0,t=0,n="",i=0,o=qo.READ_WRITE){this.set=e,this.binding=t,this.name=n,this.count=i,this.memoryAccess=o}copy(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.count=e.count,this.memoryAccess=e.memoryAccess,this}}e("ap",$a);class er{constructor(e=0,t=0,n="",i=0){this.set=e,this.binding=t,this.name=n,this.count=i}copy(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.count=e.count,this}}e("aq",er);class tr{constructor(e=ra.NONE,t=""){this.stage=e,this.source=t}copy(e){return this.stage=e.stage,this.source=e.source,this}}e("ar",tr);class ir{constructor(e="",t=Go.UNKNOWN,n=!1,i=0,o=!1,a=0){this.name=e,this.format=t,this.isNormalized=n,this.stream=i,this.isInstanced=o,this.location=a}copy(e){return this.name=e.name,this.format=e.format,this.isNormalized=e.isNormalized,this.stream=e.stream,this.isInstanced=e.isInstanced,this.location=e.location,this}}e("as",ir);class or{constructor(e="",t=[],n=[],i=[],o=[],a=[],r=[],s=[],c=[],l=[]){this.name=e,this.stages=t,this.attributes=n,this.blocks=i,this.buffers=o,this.samplerTextures=a,this.samplers=r,this.textures=s,this.images=c,this.subpassInputs=l}copy(e){return this.name=e.name,zo(this.stages,e.stages,tr),zo(this.attributes,e.attributes,ir),zo(this.blocks,e.blocks,Xa),zo(this.buffers,e.buffers,$a),zo(this.samplerTextures,e.samplerTextures,Qa),zo(this.samplers,e.samplers,Za),zo(this.textures,e.textures,Ja),zo(this.images,e.images,Ka),zo(this.subpassInputs,e.subpassInputs,er),this}}e("at",or);class ar{constructor(e=[],t=[],n=null,i=null){this.attributes=e,this.vertexBuffers=t,this.indexBuffer=n,this.indirectBuffer=i}copy(e){return zo(this.attributes,e.attributes,ir),this.vertexBuffers=e.vertexBuffers.slice(),this.indexBuffer=e.indexBuffer,this.indirectBuffer=e.indirectBuffer,this}}e("au",ar);class rr{constructor(e=Go.UNKNOWN,t=Jo.ONE,n=sa.CLEAR,i=ca.STORE,o=[],a=[la.COLOR_ATTACHMENT_WRITE],r=!1){this.format=e,this.sampleCount=t,this.loadOp=n,this.storeOp=i,this.beginAccesses=o,this.endAccesses=a,this.isGeneralLayout=r}copy(e){return this.format=e.format,this.sampleCount=e.sampleCount,this.loadOp=e.loadOp,this.storeOp=e.storeOp,this.beginAccesses=e.beginAccesses.slice(),this.endAccesses=e.endAccesses.slice(),this.isGeneralLayout=e.isGeneralLayout,this}}e("av",rr);class sr{constructor(e=Go.UNKNOWN,t=Jo.ONE,n=sa.CLEAR,i=ca.STORE,o=sa.CLEAR,a=ca.STORE,r=[],s=[la.DEPTH_STENCIL_ATTACHMENT_WRITE],c=!1){this.format=e,this.sampleCount=t,this.depthLoadOp=n,this.depthStoreOp=i,this.stencilLoadOp=o,this.stencilStoreOp=a,this.beginAccesses=r,this.endAccesses=s,this.isGeneralLayout=c}copy(e){return this.format=e.format,this.sampleCount=e.sampleCount,this.depthLoadOp=e.depthLoadOp,this.depthStoreOp=e.depthStoreOp,this.stencilLoadOp=e.stencilLoadOp,this.stencilStoreOp=e.stencilStoreOp,this.beginAccesses=e.beginAccesses.slice(),this.endAccesses=e.endAccesses.slice(),this.isGeneralLayout=e.isGeneralLayout,this}}e("aw",sr);class cr{constructor(e=[],t=[],n=[],i=[],o=-1,a=-1,r=_a.NONE,s=_a.NONE){this.inputs=e,this.colors=t,this.resolves=n,this.preserves=i,this.depthStencil=o,this.depthStencilResolve=a,this.depthResolveMode=r,this.stencilResolveMode=s}copy(e){return this.inputs=e.inputs.slice(),this.colors=e.colors.slice(),this.resolves=e.resolves.slice(),this.preserves=e.preserves.slice(),this.depthStencil=e.depthStencil,this.depthStencilResolve=e.depthStencilResolve,this.depthResolveMode=e.depthResolveMode,this.stencilResolveMode=e.stencilResolveMode,this}}e("ax",cr);class lr{constructor(e=0,t=0,n=[],i=[]){this.srcSubpass=e,this.dstSubpass=t,this.srcAccesses=n,this.dstAccesses=i}copy(e){return this.srcSubpass=e.srcSubpass,this.dstSubpass=e.dstSubpass,this.srcAccesses=e.srcAccesses.slice(),this.dstAccesses=e.dstAccesses.slice(),this}}e("ay",lr);class _r{constructor(e=[],t=new sr,n=[],i=[]){this.colorAttachments=e,this.depthStencilAttachment=t,this.subpasses=n,this.dependencies=i}copy(e){return zo(this.colorAttachments,e.colorAttachments,rr),this.depthStencilAttachment.copy(e.depthStencilAttachment),zo(this.subpasses,e.subpasses,cr),zo(this.dependencies,e.dependencies,lr),this}}e("az",_r);class ur{constructor(e=[],t=[]){this.prevAccesses=e,this.nextAccesses=t}copy(e){return this.prevAccesses=e.prevAccesses.slice(),this.nextAccesses=e.nextAccesses.slice(),this}}e("e",ur);class hr{constructor(e=[],t=[],n=!1,i=null,o=null){this.prevAccesses=e,this.nextAccesses=t,this.discardContents=n,this.srcQueue=i,this.dstQueue=o}copy(e){return this.prevAccesses=e.prevAccesses.slice(),this.nextAccesses=e.nextAccesses.slice(),this.discardContents=e.discardContents,this.srcQueue=e.srcQueue,this.dstQueue=e.dstQueue,this}}e("T",hr);class fr{constructor(e=null,t=[],n=null){this.renderPass=e,this.colorTextures=t,this.depthStencilTexture=n}copy(e){return this.renderPass=e.renderPass,this.colorTextures=e.colorTextures.slice(),this.depthStencilTexture=e.depthStencilTexture,this}}e("aA",fr);class pr{constructor(e=-1,t=va.UNKNOWN,n=0,i=ra.NONE,o=[]){this.binding=e,this.descriptorType=t,this.count=n,this.stageFlags=i,this.immutableSamplers=o}copy(e){return this.binding=e.binding,this.descriptorType=e.descriptorType,this.count=e.count,this.stageFlags=e.stageFlags,this.immutableSamplers=e.immutableSamplers.slice(),this}}e("aB",pr);class dr{constructor(e=[]){this.bindings=e}copy(e){return zo(this.bindings,e.bindings,pr),this}}e("aC",dr);class mr{constructor(e=null){this.layout=e}copy(e){return this.layout=e.layout,this}}e("aD",mr);class Ar{constructor(e=[]){this.setLayouts=e}copy(e){return this.setLayouts=e.setLayouts.slice(),this}}e("aE",Ar);class vr{constructor(e=[]){this.attributes=e}copy(e){return zo(this.attributes,e.attributes,ir),this}}e("aF",vr);class gr{constructor(e=null,t=ya.PRIMARY){this.queue=e,this.type=t}copy(e){return this.queue=e.queue,this.type=e.type,this}}e("aG",gr);class xr{constructor(e=ga.GRAPHICS){this.type=e}copy(e){return this.type=e.type,this}}e("aH",xr);class yr{constructor(e=xa.OCCLUSION,t=65536,n=!0){this.type=e,this.maxQueryObjects=t,this.forceWait=n}copy(e){return this.type=e.type,this.maxQueryObjects=e.maxQueryObjects,this.forceWait=e.forceWait,this}}e("aI",yr);class br{constructor(e="",t=0,n=0,i=jo.NONE,o=!1,a=!1,r=!1,s=!1){this.name=e,this.size=t,this.count=n,this.type=i,this.hasAlpha=o,this.hasDepth=a,this.hasStencil=r,this.isCompressed=s}}e("aJ",br);class Sr{constructor(e=0,t=0){this.bufferSize=e,this.textureSize=t}copy(e){return this.bufferSize=e.bufferSize,this.textureSize=e.textureSize,this}}e("aK",Sr);class Cr{constructor(e=0,t=0,n=0){this.writeMask=e,this.compareMask=t,this.reference=n}copy(e){return this.writeMask=e.writeMask,this.compareMask=e.compareMask,this.reference=e.reference,this}}e("aL",Cr);class Er{constructor(e=new Ma,t=new Pa,n=new za,i=1,o=0,a=0,r=0,s=0,c=0,l=new Cr,_=new Cr){this.viewport=e,this.scissor=t,this.blendConstant=n,this.lineWidth=i,this.depthBiasConstant=o,this.depthBiasClamp=a,this.depthBiasSlope=r,this.depthMinBounds=s,this.depthMaxBounds=c,this.stencilStatesFront=l,this.stencilStatesBack=_}copy(e){return this.viewport.copy(e.viewport),this.scissor.copy(e.scissor),this.blendConstant.copy(e.blendConstant),this.lineWidth=e.lineWidth,this.depthBiasConstant=e.depthBiasConstant,this.depthBiasClamp=e.depthBiasClamp,this.depthBiasSlope=e.depthBiasSlope,this.depthMinBounds=e.depthMinBounds,this.depthMaxBounds=e.depthMaxBounds,this.stencilStatesFront.copy(e.stencilStatesFront),this.stencilStatesBack.copy(e.stencilStatesBack),this}}e("aM",Er);class Tr{get objectType(){return this._objectType}get objectID(){return this._objectID}get typedID(){return this._typedID}constructor(e){this._objectType=Lo.UNKNOWN,this._objectID=0,this._typedID=0,this._objectType=e,this._objectID=Tr._idTable[Lo.UNKNOWN]++,this._typedID=Tr._idTable[e]++}}e("G",Tr),Tr._idTable=Array(Lo.COUNT).fill(65536),function(e){e.ATTR_POSITION="a_position",e.ATTR_NORMAL="a_normal",e.ATTR_TANGENT="a_tangent",e.ATTR_BITANGENT="a_bitangent",e.ATTR_WEIGHTS="a_weights",e.ATTR_JOINTS="a_joints",e.ATTR_COLOR="a_color",e.ATTR_COLOR1="a_color1",e.ATTR_COLOR2="a_color2",e.ATTR_TEX_COORD="a_texCoord",e.ATTR_TEX_COORD1="a_texCoord1",e.ATTR_TEX_COORD2="a_texCoord2",e.ATTR_TEX_COORD3="a_texCoord3",e.ATTR_TEX_COORD4="a_texCoord4",e.ATTR_TEX_COORD5="a_texCoord5",e.ATTR_TEX_COORD6="a_texCoord6",e.ATTR_TEX_COORD7="a_texCoord7",e.ATTR_TEX_COORD8="a_texCoord8",e.ATTR_BATCH_ID="a_batch_id",e.ATTR_BATCH_UV="a_batch_uv"}(Sa||(Sa=e("aN",{})));const Pr=e("aO",Object.freeze([new br("UNKNOWN",0,0,jo.NONE,!1,!1,!1,!1),new br("A8",1,1,jo.UNORM,!0,!1,!1,!1),new br("L8",1,1,jo.UNORM,!1,!1,!1,!1),new br("LA8",1,2,jo.UNORM,!0,!1,!1,!1),new br("R8",1,1,jo.UNORM,!1,!1,!1,!1),new br("R8SN",1,1,jo.SNORM,!1,!1,!1,!1),new br("R8UI",1,1,jo.UINT,!1,!1,!1,!1),new br("R8I",1,1,jo.INT,!1,!1,!1,!1),new br("R16F",2,1,jo.FLOAT,!1,!1,!1,!1),new br("R16UI",2,1,jo.UINT,!1,!1,!1,!1),new br("R16I",2,1,jo.INT,!1,!1,!1,!1),new br("R32F",4,1,jo.FLOAT,!1,!1,!1,!1),new br("R32UI",4,1,jo.UINT,!1,!1,!1,!1),new br("R32I",4,1,jo.INT,!1,!1,!1,!1),new br("RG8",2,2,jo.UNORM,!1,!1,!1,!1),new br("RG8SN",2,2,jo.SNORM,!1,!1,!1,!1),new br("RG8UI",2,2,jo.UINT,!1,!1,!1,!1),new br("RG8I",2,2,jo.INT,!1,!1,!1,!1),new br("RG16F",4,2,jo.FLOAT,!1,!1,!1,!1),new br("RG16UI",4,2,jo.UINT,!1,!1,!1,!1),new br("RG16I",4,2,jo.INT,!1,!1,!1,!1),new br("RG32F",8,2,jo.FLOAT,!1,!1,!1,!1),new br("RG32UI",8,2,jo.UINT,!1,!1,!1,!1),new br("RG32I",8,2,jo.INT,!1,!1,!1,!1),new br("RGB8",3,3,jo.UNORM,!1,!1,!1,!1),new br("SRGB8",3,3,jo.UNORM,!1,!1,!1,!1),new br("RGB8SN",3,3,jo.SNORM,!1,!1,!1,!1),new br("RGB8UI",3,3,jo.UINT,!1,!1,!1,!1),new br("RGB8I",3,3,jo.INT,!1,!1,!1,!1),new br("RGB16F",6,3,jo.FLOAT,!1,!1,!1,!1),new br("RGB16UI",6,3,jo.UINT,!1,!1,!1,!1),new br("RGB16I",6,3,jo.INT,!1,!1,!1,!1),new br("RGB32F",12,3,jo.FLOAT,!1,!1,!1,!1),new br("RGB32UI",12,3,jo.UINT,!1,!1,!1,!1),new br("RGB32I",12,3,jo.INT,!1,!1,!1,!1),new br("RGBA8",4,4,jo.UNORM,!0,!1,!1,!1),new br("BGRA8",4,4,jo.UNORM,!0,!1,!1,!1),new br("SRGB8_A8",4,4,jo.UNORM,!0,!1,!1,!1),new br("RGBA8SN",4,4,jo.SNORM,!0,!1,!1,!1),new br("RGBA8UI",4,4,jo.UINT,!0,!1,!1,!1),new br("RGBA8I",4,4,jo.INT,!0,!1,!1,!1),new br("RGBA16F",8,4,jo.FLOAT,!0,!1,!1,!1),new br("RGBA16UI",8,4,jo.UINT,!0,!1,!1,!1),new br("RGBA16I",8,4,jo.INT,!0,!1,!1,!1),new br("RGBA32F",16,4,jo.FLOAT,!0,!1,!1,!1),new br("RGBA32UI",16,4,jo.UINT,!0,!1,!1,!1),new br("RGBA32I",16,4,jo.INT,!0,!1,!1,!1),new br("R5G6B5",2,3,jo.UNORM,!1,!1,!1,!1),new br("R11G11B10F",4,3,jo.FLOAT,!1,!1,!1,!1),new br("RGB5A1",2,4,jo.UNORM,!0,!1,!1,!1),new br("RGBA4",2,4,jo.UNORM,!0,!1,!1,!1),new br("RGB10A2",2,4,jo.UNORM,!0,!1,!1,!1),new br("RGB10A2UI",2,4,jo.UINT,!0,!1,!1,!1),new br("RGB9E5",2,4,jo.FLOAT,!0,!1,!1,!1),new br("DEPTH",4,1,jo.FLOAT,!1,!0,!1,!1),new br("DEPTH_STENCIL",5,2,jo.FLOAT,!1,!0,!0,!1),new br("BC1",1,3,jo.UNORM,!1,!1,!1,!0),new br("BC1_ALPHA",1,4,jo.UNORM,!0,!1,!1,!0),new br("BC1_SRGB",1,3,jo.UNORM,!1,!1,!1,!0),new br("BC1_SRGB_ALPHA",1,4,jo.UNORM,!0,!1,!1,!0),new br("BC2",1,4,jo.UNORM,!0,!1,!1,!0),new br("BC2_SRGB",1,4,jo.UNORM,!0,!1,!1,!0),new br("BC3",1,4,jo.UNORM,!0,!1,!1,!0),new br("BC3_SRGB",1,4,jo.UNORM,!0,!1,!1,!0),new br("BC4",1,1,jo.UNORM,!1,!1,!1,!0),new br("BC4_SNORM",1,1,jo.SNORM,!1,!1,!1,!0),new br("BC5",1,2,jo.UNORM,!1,!1,!1,!0),new br("BC5_SNORM",1,2,jo.SNORM,!1,!1,!1,!0),new br("BC6H_UF16",1,3,jo.UFLOAT,!1,!1,!1,!0),new br("BC6H_SF16",1,3,jo.FLOAT,!1,!1,!1,!0),new br("BC7",1,4,jo.UNORM,!0,!1,!1,!0),new br("BC7_SRGB",1,4,jo.UNORM,!0,!1,!1,!0),new br("ETC_RGB8",1,3,jo.UNORM,!1,!1,!1,!0),new br("ETC2_RGB8",1,3,jo.UNORM,!1,!1,!1,!0),new br("ETC2_SRGB8",1,3,jo.UNORM,!1,!1,!1,!0),new br("ETC2_RGB8_A1",1,4,jo.UNORM,!0,!1,!1,!0),new br("ETC2_SRGB8_A1",1,4,jo.UNORM,!0,!1,!1,!0),new br("ETC2_RGBA8",2,4,jo.UNORM,!0,!1,!1,!0),new br("ETC2_SRGB8_A8",2,4,jo.UNORM,!0,!1,!1,!0),new br("EAC_R11",1,1,jo.UNORM,!1,!1,!1,!0),new br("EAC_R11SN",1,1,jo.SNORM,!1,!1,!1,!0),new br("EAC_RG11",2,2,jo.UNORM,!1,!1,!1,!0),new br("EAC_RG11SN",2,2,jo.SNORM,!1,!1,!1,!0),new br("PVRTC_RGB2",2,3,jo.UNORM,!1,!1,!1,!0),new br("PVRTC_RGBA2",2,4,jo.UNORM,!0,!1,!1,!0),new br("PVRTC_RGB4",2,3,jo.UNORM,!1,!1,!1,!0),new br("PVRTC_RGBA4",2,4,jo.UNORM,!0,!1,!1,!0),new br("PVRTC2_2BPP",2,4,jo.UNORM,!0,!1,!1,!0),new br("PVRTC2_4BPP",2,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_4x4",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_5x4",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_5x5",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_6x5",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_6x6",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_8x5",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_8x6",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_8x8",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_10x5",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_10x6",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_10x8",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_10x10",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_12x10",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_RGBA_12x12",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_4x4",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_5x4",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_5x5",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_6x5",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_6x6",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_8x5",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_8x6",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_8x8",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_10x5",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_10x6",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_10x8",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_10x10",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_12x10",1,4,jo.UNORM,!0,!1,!1,!0),new br("ASTC_SRGBA_12x12",1,4,jo.UNORM,!0,!1,!1,!0)])),wr=e("D",va.UNIFORM_BUFFER|va.DYNAMIC_UNIFORM_BUFFER|va.STORAGE_BUFFER|va.DYNAMIC_STORAGE_BUFFER),Ir=e("a",va.SAMPLER_TEXTURE|va.SAMPLER|va.TEXTURE|va.STORAGE_IMAGE|va.INPUT_ATTACHMENT),Rr=e("aP",va.DYNAMIC_STORAGE_BUFFER|va.DYNAMIC_UNIFORM_BUFFER),Dr=e("aQ",28);function Nr(e){return e>0&&0==(e&e-1)}function Or(e,t,n,i){if(!Pr[e].isCompressed)return t*n*i*Pr[e].size;switch(e){case Go.BC1:case Go.BC1_ALPHA:case Go.BC1_SRGB:case Go.BC1_SRGB_ALPHA:return Math.ceil(t/4)*Math.ceil(n/4)*8*i;case Go.BC2:case Go.BC2_SRGB:case Go.BC3:case Go.BC3_SRGB:case Go.BC4:case Go.BC4_SNORM:case Go.BC6H_SF16:case Go.BC6H_UF16:case Go.BC7:case Go.BC7_SRGB:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case Go.BC5:case Go.BC5_SNORM:return Math.ceil(t/4)*Math.ceil(n/4)*32*i;case Go.ETC_RGB8:case Go.ETC2_RGB8:case Go.ETC2_SRGB8:case Go.ETC2_RGB8_A1:case Go.EAC_R11:case Go.EAC_R11SN:return Math.ceil(t/4)*Math.ceil(n/4)*8*i;case Go.ETC2_RGBA8:case Go.ETC2_SRGB8_A1:case Go.EAC_RG11:case Go.EAC_RG11SN:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case Go.PVRTC_RGB2:case Go.PVRTC_RGBA2:case Go.PVRTC2_2BPP:return Math.ceil(Math.max(t,16)*Math.max(n,8)/4)*i;case Go.PVRTC_RGB4:case Go.PVRTC_RGBA4:case Go.PVRTC2_4BPP:return Math.ceil(Math.max(t,8)*Math.max(n,8)/2)*i;case Go.ASTC_RGBA_4X4:case Go.ASTC_SRGBA_4X4:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case Go.ASTC_RGBA_5X4:case Go.ASTC_SRGBA_5X4:return Math.ceil(t/5)*Math.ceil(n/4)*16*i;case Go.ASTC_RGBA_5X5:case Go.ASTC_SRGBA_5X5:return Math.ceil(t/5)*Math.ceil(n/5)*16*i;case Go.ASTC_RGBA_6X5:case Go.ASTC_SRGBA_6X5:return Math.ceil(t/6)*Math.ceil(n/5)*16*i;case Go.ASTC_RGBA_6X6:case Go.ASTC_SRGBA_6X6:return Math.ceil(t/6)*Math.ceil(n/6)*16*i;case Go.ASTC_RGBA_8X5:case Go.ASTC_SRGBA_8X5:return Math.ceil(t/8)*Math.ceil(n/5)*16*i;case Go.ASTC_RGBA_8X6:case Go.ASTC_SRGBA_8X6:return Math.ceil(t/8)*Math.ceil(n/6)*16*i;case Go.ASTC_RGBA_8X8:case Go.ASTC_SRGBA_8X8:return Math.ceil(t/8)*Math.ceil(n/8)*16*i;case Go.ASTC_RGBA_10X5:case Go.ASTC_SRGBA_10X5:return Math.ceil(t/10)*Math.ceil(n/5)*16*i;case Go.ASTC_RGBA_10X6:case Go.ASTC_SRGBA_10X6:return Math.ceil(t/10)*Math.ceil(n/6)*16*i;case Go.ASTC_RGBA_10X8:case Go.ASTC_SRGBA_10X8:return Math.ceil(t/10)*Math.ceil(n/8)*16*i;case Go.ASTC_RGBA_10X10:case Go.ASTC_SRGBA_10X10:return Math.ceil(t/10)*Math.ceil(n/10)*16*i;case Go.ASTC_RGBA_12X10:case Go.ASTC_SRGBA_12X10:return Math.ceil(t/12)*Math.ceil(n/10)*16*i;case Go.ASTC_RGBA_12X12:case Go.ASTC_SRGBA_12X12:return Math.ceil(t/12)*Math.ceil(n/12)*16*i;default:return 0}}function Mr(e,t,n,i,o){let a=0;for(let r=0;r<o;++r)a+=Or(e,t,n,i),t=Math.max(t>>1,1),n=Math.max(n>>1,1);return a}const zr=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function Lr(e){return zr[e]||0}function Fr(e){const t=e.size/e.count;switch(e.type){case jo.UNORM:case jo.UINT:switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}break;case jo.SNORM:case jo.INT:switch(t){case 1:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}break;case jo.FLOAT:return Float32Array}return Float32Array}var Br=Object.freeze({__proto__:null,get ObjectType(){return Lo},get Status(){return Fo},get API(){return Bo},get SurfaceTransform(){return ko},get Feature(){return Uo},get Format(){return Go},get FormatType(){return jo},get Type(){return Vo},get BufferUsageBit(){return Ho},get BufferFlagBit(){return Wo},get MemoryAccessBit(){return qo},get MemoryUsageBit(){return Yo},get TextureType(){return Xo},get TextureUsageBit(){return Qo},get TextureFlagBit(){return Zo},get SampleCount(){return Jo},get VsyncMode(){return Ko},get Filter(){return $o},get Address(){return ea},get ComparisonFunc(){return ta},get StencilOp(){return na},get BlendFactor(){return ia},get BlendOp(){return oa},get ColorMask(){return aa},get ShaderStageFlagBit(){return ra},get LoadOp(){return sa},get StoreOp(){return ca},get AccessType(){return la},get ResolveMode(){return _a},get PipelineBindPoint(){return ua},get PrimitiveMode(){return ha},get PolygonMode(){return fa},get ShadeModel(){return pa},get CullMode(){return da},get DynamicStateFlagBit(){return ma},get StencilFace(){return Aa},get DescriptorType(){return va},get QueueType(){return ga},get QueryType(){return xa},get CommandBufferType(){return ya},get ClearFlagBit(){return ba},Size:Ca,DeviceCaps:Ea,Offset:Ta,Rect:Pa,Extent:wa,TextureSubresLayers:Ia,TextureSubresRange:Ra,TextureCopy:Da,TextureBlit:Na,BufferTextureCopy:Oa,Viewport:Ma,Color:za,BindingMappingInfo:La,SwapchainInfo:Fa,DeviceInfo:Ba,BufferInfo:ka,BufferViewInfo:Ua,DrawInfo:Ga,DispatchInfo:ja,IndirectBuffer:Va,TextureInfo:Ha,TextureViewInfo:Wa,SamplerInfo:qa,Uniform:Ya,UniformBlock:Xa,UniformSamplerTexture:Qa,UniformSampler:Za,UniformTexture:Ja,UniformStorageImage:Ka,UniformStorageBuffer:$a,UniformInputAttachment:er,ShaderStage:tr,Attribute:ir,ShaderInfo:or,InputAssemblerInfo:ar,ColorAttachment:rr,DepthStencilAttachment:sr,SubpassInfo:cr,SubpassDependency:lr,RenderPassInfo:_r,GlobalBarrierInfo:ur,TextureBarrierInfo:hr,FramebufferInfo:fr,DescriptorSetLayoutBinding:pr,DescriptorSetLayoutInfo:dr,DescriptorSetInfo:mr,PipelineLayoutInfo:Ar,InputState:vr,CommandBufferInfo:gr,QueueInfo:xr,QueryPoolInfo:yr,FormatInfo:br,MemoryStatus:Sr,DynamicStencilStates:Cr,DynamicStates:Er,GFXObject:Tr,get AttributeName(){return Sa},FormatInfos:Pr,DESCRIPTOR_BUFFER_TYPE:wr,DESCRIPTOR_SAMPLER_TYPE:Ir,DESCRIPTOR_DYNAMIC_TYPE:Rr,DRAW_INFO_SIZE:Dr,IsPowerOf2:Nr,FormatSize:Or,FormatSurfaceSize:Mr,GetTypeSize:Lr,getTypedArrayConstructor:Fr});class kr{constructor(e=!1,t=fa.FILL,n=pa.GOURAND,i=da.BACK,o=!0,a=!1,r=0,s=0,c=0,l=!0,_=!1,u=1){this._nativeObj=void 0,this._isDiscard=!1,this._polygonMode=fa.FILL,this._shadeModel=pa.GOURAND,this._cullMode=da.BACK,this._isFrontFaceCCW=!0,this._depthBiasEnabled=!1,this._depthBias=0,this._depthBiasClamp=0,this._depthBiasSlop=0,this._isDepthClip=!0,this._isMultisample=!1,this._lineWidth=1,this._nativeObj=new gfx.RasterizerState,this.assignProperties(e,t,n,i,o,a,r,s,c,l,_,u)}get native(){return this._nativeObj}get isDiscard(){return this._isDiscard}set isDiscard(e){this._isDiscard=e,this._nativeObj.isDiscard=e}get polygonMode(){return this._polygonMode}set polygonMode(e){this._polygonMode=e,this._nativeObj.polygonMode=e}get shadeModel(){return this._shadeModel}set shadeModel(e){this._shadeModel=e,this._nativeObj.shadeModel=e}get cullMode(){return this._cullMode}set cullMode(e){this._cullMode=e,this._nativeObj.cullMode=e}get isFrontFaceCCW(){return this._isFrontFaceCCW}set isFrontFaceCCW(e){this._isFrontFaceCCW=e,this._nativeObj.isFrontFaceCCW=e}get depthBiasEnabled(){return this._depthBiasEnabled}set depthBiasEnabled(e){this._depthBiasEnabled=e,this._nativeObj.depthBiasEnabled=e}get depthBias(){return this._depthBias}set depthBias(e){this._depthBias=e,this._nativeObj.depthBias=e}get depthBiasClamp(){return this._depthBiasClamp}set depthBiasClamp(e){this._depthBiasClamp=e,this._nativeObj.depthBiasClamp=e}get depthBiasSlop(){return this._depthBiasSlop}set depthBiasSlop(e){this._depthBiasSlop=e,this._nativeObj.depthBiasSlop=e}get isDepthClip(){return this._isDepthClip}set isDepthClip(e){this._isDepthClip=e,this._nativeObj.isDepthClip=e}get isMultisample(){return this._isMultisample}set isMultisample(e){this._isMultisample=e,this._nativeObj.isMultisample=e}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._nativeObj.lineWidth=e}reset(){this.assignProperties(!1,fa.FILL,pa.GOURAND,da.BACK,!0,!1,0,0,0,!0,!1,1)}assign(e){e&&this.assignProperties(e.isDiscard,e.polygonMode,e.shadeModel,e.cullMode,e.isFrontFaceCCW,e.depthBiasEnabled,e.depthBias,e.depthBiasClamp,e.depthBiasSlop,e.isDepthClip,e.isMultisample,e.lineWidth)}destroy(){this._nativeObj=null}assignProperties(e,t,n,i,o,a,r,s,c,l,_,u){void 0!==e&&(this.isDiscard=e),void 0!==t&&(this.polygonMode=t),void 0!==n&&(this.shadeModel=n),void 0!==i&&(this.cullMode=i),void 0!==o&&(this.isFrontFaceCCW=o),void 0!==a&&(this.depthBiasEnabled=a),void 0!==r&&(this.depthBias=r),void 0!==s&&(this.depthBiasClamp=s),void 0!==c&&(this.depthBiasSlop=c),void 0!==l&&(this.isDepthClip=l),void 0!==_&&(this.isMultisample=_),void 0!==u&&(this.lineWidth=u)}}class Ur{constructor(e=!0,t=!0,n=ta.LESS,i=!1,o=ta.ALWAYS,a=65535,r=65535,s=na.KEEP,c=na.KEEP,l=na.KEEP,_=1,u=!1,h=ta.ALWAYS,f=65535,p=65535,d=na.KEEP,m=na.KEEP,A=na.KEEP,v=1){this._nativeObj=void 0,this._depthTest=!0,this._depthWrite=!0,this._depthFunc=ta.LESS,this._stencilTestFront=!1,this._stencilFuncFront=ta.ALWAYS,this._stencilReadMaskFront=65535,this._stencilWriteMaskFront=65535,this._stencilFailOpFront=na.KEEP,this._stencilZFailOpFront=na.KEEP,this._stencilPassOpFront=na.KEEP,this._stencilRefFront=1,this._stencilTestBack=!1,this._stencilFuncBack=ta.ALWAYS,this._stencilReadMaskBack=65535,this._stencilWriteMaskBack=65535,this._stencilFailOpBack=na.KEEP,this._stencilZFailOpBack=na.KEEP,this._stencilPassOpBack=na.KEEP,this._stencilRefBack=1,this._nativeObj=new gfx.DepthStencilState,this.assignProperties(e,t,n,i,o,a,r,s,c,l,_,u,h,f,p,d,m,A,v)}get native(){return this._nativeObj}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest=e,this._nativeObj.depthTest=e}get depthWrite(){return this._depthWrite}set depthWrite(e){this._depthWrite=e,this._nativeObj.depthWrite=e}get depthFunc(){return this._depthFunc}set depthFunc(e){this._depthFunc=e,this._nativeObj.depthFunc=e}get stencilTestFront(){return this._stencilTestFront}set stencilTestFront(e){this._stencilTestFront=e,this._nativeObj.stencilTestFront=e}get stencilFuncFront(){return this._stencilFuncFront}set stencilFuncFront(e){this._stencilFuncFront=e,this._nativeObj.stencilFuncFront=e}get stencilReadMaskFront(){return this._stencilReadMaskFront}set stencilReadMaskFront(e){this._stencilReadMaskFront=e,this._nativeObj.stencilReadMaskFront=e}get stencilWriteMaskFront(){return this._stencilWriteMaskFront}set stencilWriteMaskFront(e){this._stencilWriteMaskFront=e,this._nativeObj.stencilWriteMaskFront=e}get stencilFailOpFront(){return this._stencilFailOpFront}set stencilFailOpFront(e){this._stencilFailOpFront=e,this._nativeObj.stencilFailOpFront=e}get stencilZFailOpFront(){return this._stencilZFailOpFront}set stencilZFailOpFront(e){this._stencilZFailOpFront=e,this._nativeObj.stencilZFailOpFront=e}get stencilPassOpFront(){return this._stencilPassOpFront}set stencilPassOpFront(e){this._stencilPassOpFront=e,this._nativeObj.stencilPassOpFront=e}get stencilRefFront(){return this._stencilRefFront}set stencilRefFront(e){this._stencilRefFront=e,this._nativeObj.stencilRefFront=e}get stencilTestBack(){return this._stencilTestBack}set stencilTestBack(e){this._stencilTestBack=e,this._nativeObj.stencilTestBack=e}get stencilFuncBack(){return this._stencilFuncBack}set stencilFuncBack(e){this._stencilFuncBack=e,this._nativeObj.stencilFuncBack=e}get stencilReadMaskBack(){return this._stencilReadMaskBack}set stencilReadMaskBack(e){this._stencilReadMaskBack=e,this._nativeObj.stencilReadMaskBack=e}get stencilWriteMaskBack(){return this._stencilWriteMaskBack}set stencilWriteMaskBack(e){this._stencilWriteMaskBack=e,this._nativeObj.stencilWriteMaskBack=e}get stencilFailOpBack(){return this._stencilFailOpBack}set stencilFailOpBack(e){this._stencilFailOpBack=e,this._nativeObj.stencilFailOpBack=e}get stencilZFailOpBack(){return this._stencilZFailOpBack}set stencilZFailOpBack(e){this._stencilZFailOpBack=e,this._nativeObj.stencilZFailOpBack=e}get stencilPassOpBack(){return this._stencilPassOpBack}set stencilPassOpBack(e){this._stencilPassOpBack=e,this._nativeObj.stencilPassOpBack=e}get stencilRefBack(){return this._stencilRefBack}set stencilRefBack(e){this._stencilRefBack=e,this._nativeObj.stencilRefBack=e}reset(){this.assignProperties(!0,!0,ta.LESS,!1,ta.ALWAYS,65535,65535,na.KEEP,na.KEEP,na.KEEP,1,!1,ta.ALWAYS,65535,65535,na.KEEP,na.KEEP,na.KEEP,1)}assign(e){e&&this.assignProperties(e.depthTest,e.depthWrite,e.depthFunc,e.stencilTestFront,e.stencilFuncFront,e.stencilReadMaskFront,e.stencilWriteMaskFront,e.stencilFailOpFront,e.stencilZFailOpFront,e.stencilPassOpFront,e.stencilRefFront,e.stencilTestBack,e.stencilFuncBack,e.stencilReadMaskBack,e.stencilWriteMaskBack,e.stencilFailOpBack,e.stencilZFailOpBack,e.stencilPassOpBack,e.stencilRefBack)}destroy(){this._nativeObj=null}assignProperties(e,t,n,i,o,a,r,s,c,l,_,u,h,f,p,d,m,A,v){void 0!==e&&(this.depthTest=e),void 0!==t&&(this.depthWrite=t),void 0!==n&&(this.depthFunc=n),void 0!==i&&(this.stencilTestFront=i),void 0!==o&&(this.stencilFuncFront=o),void 0!==a&&(this.stencilReadMaskFront=a),void 0!==r&&(this.stencilWriteMaskFront=r),void 0!==s&&(this.stencilFailOpFront=s),void 0!==c&&(this.stencilZFailOpFront=c),void 0!==l&&(this.stencilPassOpFront=l),void 0!==_&&(this.stencilRefFront=_),void 0!==u&&(this.stencilTestBack=u),void 0!==h&&(this.stencilFuncBack=h),void 0!==f&&(this.stencilReadMaskBack=f),void 0!==p&&(this.stencilWriteMaskBack=p),void 0!==d&&(this.stencilFailOpBack=d),void 0!==m&&(this.stencilZFailOpBack=m),void 0!==A&&(this.stencilPassOpBack=A),void 0!==v&&(this.stencilRefBack=v)}}class Gr{get native(){return this._nativeObj}constructor(e=!1,t=ia.ONE,n=ia.ZERO,i=oa.ADD,o=ia.ONE,a=ia.ZERO,r=oa.ADD,s=aa.ALL){this._nativeObj=void 0,this._blend=!1,this._blendSrc=ia.ONE,this._blendDst=ia.ZERO,this._blendEq=oa.ADD,this._blendSrcAlpha=ia.ONE,this._blendDstAlpha=ia.ZERO,this._blendAlphaEq=oa.ADD,this._blendColorMask=aa.ALL,this._nativeObj=new gfx.BlendTarget,this.assignProperties(e,t,n,i,o,a,r,s)}get blend(){return this._blend}set blend(e){this._blend=e,this._nativeObj.blend=e}get blendSrc(){return this._blendSrc}set blendSrc(e){this._blendSrc=e,this._nativeObj.blendSrc=e}get blendDst(){return this._blendDst}set blendDst(e){this._blendDst=e,this._nativeObj.blendDst=e}get blendEq(){return this._blendEq}set blendEq(e){this._blendEq=e,this._nativeObj.blendEq=e}get blendSrcAlpha(){return this._blendSrcAlpha}set blendSrcAlpha(e){this._blendSrcAlpha=e,this._nativeObj.blendSrcAlpha=e}get blendDstAlpha(){return this._blendDstAlpha}set blendDstAlpha(e){this._blendDstAlpha=e,this._nativeObj.blendDstAlpha=e}get blendAlphaEq(){return this._blendAlphaEq}set blendAlphaEq(e){this._blendAlphaEq=e,this._nativeObj.blendAlphaEq=e}get blendColorMask(){return this._blendColorMask}set blendColorMask(e){this._blendColorMask=e,this._nativeObj.blendColorMask=e}reset(){this.assignProperties(!1,ia.ONE,ia.ZERO,oa.ADD,ia.ONE,ia.ZERO,oa.ADD,aa.ALL)}destroy(){this._nativeObj=null}assign(e){e&&this.assignProperties(e.blend,e.blendSrc,e.blendDst,e.blendEq,e.blendSrcAlpha,e.blendDstAlpha,e.blendAlphaEq,e.blendColorMask)}assignProperties(e,t,n,i,o,a,r,s){void 0!==e&&(this.blend=e),void 0!==t&&(this.blendSrc=t),void 0!==n&&(this.blendDst=n),void 0!==i&&(this.blendEq=i),void 0!==o&&(this.blendSrcAlpha=o),void 0!==a&&(this.blendDstAlpha=a),void 0!==r&&(this.blendAlphaEq=r),void 0!==s&&(this.blendColorMask=s)}}class jr{_setTargets(e){this.targets=e;const t="$__nativeObj";this._syncTargetsToNativeObj(t),function(e,t,n,i,o){for(let a=0,r=t.length;a<r;a++){let r=t[a],s=r[n].$__nativeObj||r[n];r[n]=new Proxy(s,{get:(e,t)=>t===i?e:Reflect.get(e,t),set:(t,n,i)=>(Reflect.set(t,n,i),o(e),!0)})}}(this,this.targets,"_nativeObj",t,(e=>{e._syncTargetsToNativeObj(t)}))}_syncTargetsToNativeObj(e){const t=this.targets.map((t=>t.native[e]||t.native));this._nativeObj.targets=t}get native(){return this._nativeObj}constructor(e=!1,t=!1,n=new za,i=[new Gr]){this.targets=void 0,this._blendColor=void 0,this._nativeObj=void 0,this._isA2C=!1,this._isIndepend=!1,this._nativeObj=new gfx.BlendState,this._setTargets(i),this.blendColor=n,this.isA2c=e,this.isIndepend=t}get isA2c(){return this._isA2C}set isA2c(e){this._isA2C=e,this._nativeObj.isA2C=e}get isIndepend(){return this._isIndepend}set isIndepend(e){this._isIndepend=e,this._nativeObj.isIndepend=e}get blendColor(){return this._blendColor}set blendColor(e){this._blendColor=e,this._nativeObj.blendColor=e}setTarget(e,t){let n=this.targets[e];n||(n=this.targets[e]=new Gr),n.assign(t),this._setTargets(this.targets)}reset(){this.isA2c=!1,this.isIndepend=!1,this.blendColor=new za(0,0,0,0);const e=this.targets;for(let t=1,n=e.length;t<n;++t)e[t].destroy();e.length=1,e[0].reset(),this._setTargets(e)}destroy(){for(let e=0,t=this.targets.length;e<t;++e)this.targets[e].destroy();this.targets=null,this._nativeObj=null}}const Vr=gfx.PipelineState,Hr=gfx.PipelineStateInfo;class Wr{constructor(){this._gfxAPI=Bo.UNKNOWN,this._renderer="",this._vendor="",this._features=new Array(Uo.COUNT),this._queue=null,this._cmdBuff=null,this._numDrawCalls=0,this._numInstances=0,this._numTris=0,this._memoryStatus=new Sr,this._caps=new Ea,this._bindingMappingInfo=new La,this._samplers=new Map,this._globalBarriers=new Map,this._textureBarriers=new Map}get gfxAPI(){return this._gfxAPI}get queue(){return this._queue}get commandBuffer(){return this._cmdBuff}get renderer(){return this._renderer}get vendor(){return this._vendor}get numDrawCalls(){return this._numDrawCalls}get numInstances(){return this._numInstances}get numTris(){return this._numTris}get memoryStatus(){return this._memoryStatus}get capabilities(){return this._caps}get bindingMappingInfo(){return this._bindingMappingInfo}hasFeature(e){return this._features[e]}}e("aW",Wr),Wr.canvas=void 0;const qr=String.prototype.charCodeAt;function Yr(e){return this[e]}function Xr(e,t){let n=e.length,i=t^n,o=0;const a="string"==typeof e?qr:Yr;for(;n>=4;){let t=255&a.call(e,o)|(255&a.call(e,++o))<<8|(255&a.call(e,++o))<<16|(255&a.call(e,++o))<<24;t=1540483477*(65535&t)+((1540483477*(t>>>16)&65535)<<16),t^=t>>>24,t=1540483477*(65535&t)+((1540483477*(t>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^t,n-=4,++o}switch(n){case 3:i^=(255&a.call(e,o+2))<<16;case 2:i^=(255&a.call(e,o+1))<<8;case 1:i^=255&a.call(e,o),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)}return i^=i>>>13,i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16),i^=i>>>15,i>>>0}class Qr extends Tr{get type(){return this._type}get usage(){return this._usage}get format(){return this._format}get width(){return this._width}get height(){return this._height}get depth(){return this._depth}get layerCount(){return this._layerCount}get levelCount(){return this._levelCount}get samples(){return this._samples}get flags(){return this._flags}get size(){return this._size}constructor(){super(Lo.TEXTURE),this._type=Xo.TEX2D,this._usage=Qo.NONE,this._format=Go.UNKNOWN,this._width=0,this._height=0,this._depth=1,this._layerCount=1,this._levelCount=1,this._samples=Jo.ONE,this._flags=Zo.NONE,this._isPowerOf2=!1,this._size=0}}e("aX",Qr);class Zr extends Tr{get info(){return this._info}get hash(){return this._hash}constructor(e,t){super(Lo.SAMPLER),this._info=new qa,this._hash=0,this._info.copy(e),this._hash=t}static computeHash(e){let t=e.minFilter;return t|=e.magFilter<<2,t|=e.mipFilter<<4,t|=e.addressU<<6,t|=e.addressV<<8,t|=e.addressW<<10,t|=e.maxAnisotropy<<12,t|=e.cmpFunc<<16,t}static unpackFromHash(e){const t=new qa;return t.minFilter=(3&e)>>0,t.magFilter=(3&e)>>2,t.mipFilter=(3&e)>>4,t.addressU=(3&e)>>6,t.addressV=(3&e)>>8,t.addressW=(3&e)>>10,t.maxAnisotropy=(15&e)>>12,t.cmpFunc=(7&e)>>16,t}}e("aY",Zr);const Jr={Obj:"GFXObject",DRAW_INFO_SIZE:"GFX_DRAW_INFO_SIZE",DESCRIPTOR_BUFFER_TYPE:"",DESCRIPTOR_SAMPLER_TYPE:"",DESCRIPTOR_DYNAMIC_TYPE:"",getTypedArrayConstructor:""};for(const e in c.gfx){if("__esModule"===e)continue;let t=Jr[e];""===t?t=e:void 0===t&&(t=`GFX${e}`),Pn(c,"cc",[{name:t,newName:e,target:c.gfx,targetName:"cc.gfx"}])}const Kr=Object.assign({},Br);Kr.Device=gfx.Device,Kr.Swapchain=gfx.Swapchain,Kr.Buffer=gfx.Buffer,Kr.Texture=gfx.Texture,Kr.Sampler=gfx.Sampler,Kr.Shader=gfx.Shader,Kr.InputAssembler=gfx.InputAssembler,Kr.RenderPass=gfx.RenderPass,Kr.Framebuffer=gfx.Framebuffer,Kr.DescriptorSet=gfx.DescriptorSet,Kr.DescriptorSetLayout=gfx.DescriptorSetLayout,Kr.PipelineLayout=gfx.PipelineLayout,Kr.PipelineState=gfx.PipelineState,Kr.CommandBuffer=gfx.CommandBuffer,Kr.Queue=gfx.Queue,c.gfx=Kr,e("aZ",Gr);const $r=e("a_",jr),es=e("a$",kr),ts=e("b0",Ur);let is;e("b1",Vr),e("b2",Hr),Kr.BlendTarget=Gr,Kr.BlendState=jr,Kr.RasterizerState=kr,Kr.DepthStencilState=Ur,Kr.PipelineStateInfo=Hr,function(e){e[e.ALL=0]="ALL",e[e.CLOSEST=1]="CLOSEST",e[e.ANY=2]="ANY"}(is||(is={}));const os=function(){const e=new _i(0,0,0);return function(t,n){const i=_i.dot(t.d,n.n);if(Math.abs(i)<Number.EPSILON)return 0;_i.multiplyScalar(e,n.n,n.d);const o=_i.dot(_i.subtract(e,e,t.o),n.n)/i;return o<0?0:o}}(),as=function(){const e=new _i(0,0,0),t=new _i(0,0,0),n=new _i(0,0,0),i=new _i(0,0,0),o=new _i(0,0,0);return function(a,r,s){_i.subtract(e,r.b,r.a),_i.subtract(t,r.c,r.a),_i.cross(n,a.d,t);const c=_i.dot(e,n);if(c<Number.EPSILON&&(!s||c>-Number.EPSILON))return 0;const l=1/c;_i.subtract(i,a.o,r.a);const _=_i.dot(i,n)*l;if(_<0||_>1)return 0;_i.cross(o,i,e);const u=_i.dot(a.d,o)*l;if(u<0||_+u>1)return 0;const h=_i.dot(t,o)*l;return h<0?0:h}}(),rs=function(){const e=new _i(0,0,0);return function(t,n){const i=n.radius,o=n.center,a=t.o,r=t.d,s=i*i;_i.subtract(e,o,a);const c=e.lengthSqr(),l=_i.dot(e,r),_=s-(c-l*l);if(_<0)return 0;const u=Math.sqrt(_),h=c<s?l+u:l-u;return h<0?0:h}}(),ss=function(){const e=new _i,t=new _i;return function(n,i){return _i.subtract(e,i.center,i.halfExtents),_i.add(t,i.center,i.halfExtents),cs(n,e,t)}}();function cs(e,t,n){const i=e.o,o=e.d,a=1/o.x,r=1/o.y,s=1/o.z,c=(t.x-i.x)*a,l=(n.x-i.x)*a,_=(t.y-i.y)*r,u=(n.y-i.y)*r,h=(t.z-i.z)*s,f=(n.z-i.z)*s,p=Math.max(Math.max(Math.min(c,l),Math.min(_,u)),Math.min(h,f)),d=Math.min(Math.min(Math.max(c,l),Math.max(_,u)),Math.max(h,f));return d<0||p>d?0:p>0?p:d}const ls=function(){let e=new _i,t=new _i,n=new _i;const i=new _i,o=new _i,a=new _i,r=new _i,s=new Array(3),c=new Array(3),l=new Array(3),_=new Array(6);return function(u,h){s[0]=h.halfExtents.x,s[1]=h.halfExtents.y,s[2]=h.halfExtents.z,e=h.center,t=u.o,n=u.d,_i.set(i,h.orientation.m00,h.orientation.m01,h.orientation.m02),_i.set(o,h.orientation.m03,h.orientation.m04,h.orientation.m05),_i.set(a,h.orientation.m06,h.orientation.m07,h.orientation.m08),_i.subtract(r,e,t),c[0]=_i.dot(i,n),c[1]=_i.dot(o,n),c[2]=_i.dot(a,n),l[0]=_i.dot(i,r),l[1]=_i.dot(o,r),l[2]=_i.dot(a,r);for(let e=0;e<3;++e){if(0===c[e]){if(-l[e]-s[e]>0||-l[e]+s[e]<0)return 0;c[e]=1e-7}_[2*e+0]=(l[e]+s[e])/c[e],_[2*e+1]=(l[e]-s[e])/c[e]}const f=Math.max(Math.max(Math.min(_[0],_[1]),Math.min(_[2],_[3])),Math.min(_[4],_[5])),p=Math.min(Math.min(Math.max(_[0],_[1]),Math.max(_[2],_[3])),Math.max(_[4],_[5]));return p<0||f>p?0:f>0?f:p}}(),_s=function(){const e=new _i,t=new _i,n=new _i,i=new _i,o=new _i,a=new _i,r=new _i,s=new Oo;return function(c,l){const _=l.radius*l.radius,u=_i.normalize(e,c.d),h=l.ellipseCenter0,f=l.ellipseCenter1,p=_i.subtract(t,f,h);if(p.equals(_i.ZERO))return s.radius=l.radius,s.center.set(l.ellipseCenter0),Gs.raySphere(c,s);const d=c.o,m=_i.subtract(n,d,h),A=_i.cross(i,u,p),v=A.lengthSqr();if(0===v){s.radius=l.radius;const e=_i.subtract(o,f,d);return m.lengthSqr()<e.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),Gs.raySphere(c,s)}const g=_i.cross(o,m,p),x=p.lengthSqr(),y=2*_i.dot(A,g),b=y*y-4*v*(g.lengthSqr()-_*x);if(b<0)return 0;const S=(-y-Math.sqrt(b))/(2*v);if(S<0){s.radius=l.radius;const e=_i.subtract(a,f,d);return m.lengthSqr()<e.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),Gs.raySphere(c,s)}{const e=_i.scaleAndAdd(a,c.o,u,S),t=_i.subtract(r,e,h),n=_i.dot(t,p)/x;return n>=0&&n<=1?S:n<0?(s.radius=l.radius,s.center.set(l.ellipseCenter0),Gs.raySphere(c,s)):n>1?(s.radius=l.radius,s.center.set(l.ellipseCenter1),Gs.raySphere(c,s)):0}}}(),us=function(){const e=Mo.create(),t={distance:1/0,doubleSided:!1,mode:is.ANY};let n=0;const i=(e,t,i,o,a,r)=>{e===is.CLOSEST?(n>t||0===n)&&(n=t,r&&(0===r.length?r.push({distance:t,vertexIndex0:i/3,vertexIndex1:o/3,vertexIndex2:a/3}):(r[0].distance=t,r[0].vertexIndex0=i/3,r[0].vertexIndex1=o/3,r[0].vertexIndex2=a/3))):(n=t,r&&r.push({distance:t,vertexIndex0:i/3,vertexIndex1:o/3,vertexIndex2:a/3}))};return function(o,a,r){if(n=0,0===a.geometricInfo.positions.length)return n;const s=void 0===r?t:r;if(cs(o,a.geometricInfo.boundingBox.min,a.geometricInfo.boundingBox.max)){const t=a.primitiveMode,{positions:n,indices:r}=a.geometricInfo;((t,n,o,a,r)=>{if(o===ha.TRIANGLE_LIST){const o=n.length;for(let s=0;s<o;s+=3){const o=3*n[s],c=3*n[s+1],l=3*n[s+2];_i.set(e.a,t[o],t[o+1],t[o+2]),_i.set(e.b,t[c],t[c+1],t[c+2]),_i.set(e.c,t[l],t[l+1],t[l+2]);const _=Gs.rayTriangle(a,e,r.doubleSided);if(!(0===_||_>r.distance)&&(i(r.mode,_,o,c,l,r.result),r.mode===is.ANY))return _}}else if(o===ha.TRIANGLE_STRIP){const o=n.length-2;let s=0;for(let c=0;c<o;c+=1){const o=3*n[c-s],l=3*n[c+s+1],_=3*n[c+2];_i.set(e.a,t[o],t[o+1],t[o+2]),_i.set(e.b,t[l],t[l+1],t[l+2]),_i.set(e.c,t[_],t[_+1],t[_+2]),s=~s;const u=Gs.rayTriangle(a,e,r.doubleSided);if(!(0===u||u>r.distance)&&(i(r.mode,u,o,l,_,r.result),r.mode===is.ANY))return u}}else if(o===ha.TRIANGLE_FAN){const o=n.length-1,s=3*n[0];_i.set(e.a,t[s],t[s+1],t[s+2]);for(let c=1;c<o;c+=1){const o=3*n[c],l=3*n[c+1];_i.set(e.b,t[o],t[o+1],t[o+2]),_i.set(e.c,t[l],t[l+1],t[l+2]);const _=Gs.rayTriangle(a,e,r.doubleSided);if(!(0===_||_>r.distance)&&(i(r.mode,_,s,o,l,r.result),r.mode===is.ANY))return _}}})(n,r,t,o,s)}return n}}(),hs=function(){let e=0;const t={distance:1/0,doubleSided:!1,mode:is.ANY};return function(n,i,o){e=0;const a=void 0===o?t:o,r=i.renderingSubMeshes.length,s=i.struct.minPosition,c=i.struct.maxPosition;if(s&&c&&!cs(n,s,c))return e;for(let t=0;t<r;t++){const o=i.renderingSubMeshes[t],r=us(n,o,a);if(r)if(a.mode===is.CLOSEST)(0===e||e>r)&&(e=r,a.subIndices&&(a.subIndices[0]=t));else if(e=r,a.subIndices&&a.subIndices.push(t),a.mode===is.ANY)return r}return e&&a.mode===is.CLOSEST&&(a.result&&(a.result[0].distance=e,a.result.length=1),a.subIndices&&(a.subIndices.length=1)),e}}(),fs=function(){let e=0;const t={distance:1/0,doubleSided:!1,mode:is.ANY},n=new Po,i=new Ei;return function(o,a,r){e=0;const s=void 0===r?t:r,c=a.worldBounds;if(c&&!ss(o,c))return e;Po.copy(n,o),a.node&&(Ei.invert(i,a.node.getWorldMatrix(i)),_i.transformMat4(n.o,o.o,i),_i.transformMat4Normal(n.d,o.d,i));const l=a.subModels;for(let t=0;t<l.length;t++){const i=l[t].subMesh,o=us(n,i,s);if(o)if(s.mode===is.CLOSEST)(0===e||e>o)&&(e=o,s.subIndices&&(s.subIndices[0]=t));else if(e=o,s.subIndices&&s.subIndices.push(t),s.mode===is.ANY)return o}return e&&s.mode===is.CLOSEST&&(s.result&&(s.result[0].distance=e,s.result.length=1),s.subIndices&&(s.subIndices.length=1)),e}}(),ps=function(){const e=new _i(0,0,0);return function(t,n){_i.subtract(e,t.e,t.s);const i=(n.d-_i.dot(t.s,n.n))/_i.dot(e,n.n);return i<0||i>1?0:i}}(),ds=function(){const e=new _i(0,0,0),t=new _i(0,0,0),n=new _i(0,0,0),i=new _i(0,0,0),o=new _i(0,0,0),a=new _i(0,0,0);return function(r,s,c){_i.subtract(e,s.b,s.a),_i.subtract(t,s.c,s.a),_i.subtract(n,r.s,r.e),_i.cross(o,e,t);const l=_i.dot(n,o);if(l<=0)return 0;_i.subtract(i,r.s,s.a);const _=_i.dot(i,o);if(_<0||_>l)return 0;_i.cross(a,n,i);let u=_i.dot(t,a);if(u<0||u>l)return 0;let h=-_i.dot(e,a);if(h<0||u+h>l)return 0;if(c){const e=1/l;u*=e,h*=e;const t=1-u-h;_i.set(c,s.a.x*t+s.b.x*u+s.c.x*h,s.a.y*t+s.b.y*u+s.c.y*h,s.a.z*t+s.b.z*u+s.c.z*h)}return 1}}(),ms=new Po;function As(e,t){ms.o.set(e.s),_i.subtract(ms.d,e.e,e.s),ms.d.normalize();const n=ss(ms,t);return n<=e.length()?n:0}function vs(e,t){ms.o.set(e.s),_i.subtract(ms.d,e.e,e.s),ms.d.normalize();const n=ls(ms,t);return n<=e.length()?n:0}function gs(e,t){ms.o.set(e.s),_i.subtract(ms.d,e.e,e.s),ms.d.normalize();const n=rs(ms,t);return n<=e.length()?n:0}const xs=function(){const e=new _i,t=new _i,n=new _i,i=new _i;return function(o,a){return _i.subtract(e,o.center,o.halfExtents),_i.add(t,o.center,o.halfExtents),_i.subtract(n,a.center,a.halfExtents),_i.add(i,a.center,a.halfExtents),e.x<=i.x&&t.x>=n.x&&e.y<=i.y&&t.y>=n.y&&e.z<=i.z&&t.z>=n.z}}();function ys(e,t,n,i,o,a){_i.set(a[0],e.x+n.x*t.x+i.x*t.y+o.x*t.z,e.y+n.y*t.x+i.y*t.y+o.y*t.z,e.z+n.z*t.x+i.z*t.y+o.z*t.z),_i.set(a[1],e.x-n.x*t.x+i.x*t.y+o.x*t.z,e.y-n.y*t.x+i.y*t.y+o.y*t.z,e.z-n.z*t.x+i.z*t.y+o.z*t.z),_i.set(a[2],e.x+n.x*t.x-i.x*t.y+o.x*t.z,e.y+n.y*t.x-i.y*t.y+o.y*t.z,e.z+n.z*t.x-i.z*t.y+o.z*t.z),_i.set(a[3],e.x+n.x*t.x+i.x*t.y-o.x*t.z,e.y+n.y*t.x+i.y*t.y-o.y*t.z,e.z+n.z*t.x+i.z*t.y-o.z*t.z),_i.set(a[4],e.x-n.x*t.x-i.x*t.y-o.x*t.z,e.y-n.y*t.x-i.y*t.y-o.y*t.z,e.z-n.z*t.x-i.z*t.y-o.z*t.z),_i.set(a[5],e.x+n.x*t.x-i.x*t.y-o.x*t.z,e.y+n.y*t.x-i.y*t.y-o.y*t.z,e.z+n.z*t.x-i.z*t.y-o.z*t.z),_i.set(a[6],e.x-n.x*t.x+i.x*t.y-o.x*t.z,e.y-n.y*t.x+i.y*t.y-o.y*t.z,e.z-n.z*t.x+i.z*t.y-o.z*t.z),_i.set(a[7],e.x-n.x*t.x-i.x*t.y+o.x*t.z,e.y-n.y*t.x-i.y*t.y+o.y*t.z,e.z-n.z*t.x-i.z*t.y+o.z*t.z)}function bs(e,t){let n=_i.dot(t,e[0]),i=n;for(let o=1;o<8;++o){const a=_i.dot(t,e[o]);n=a<n?a:n,i=a>i?a:i}return[n,i]}const Ss=function(){const e=new Array(15);for(let t=0;t<15;t++)e[t]=new _i(0,0,0);const t=new Array(8),n=new Array(8);for(let e=0;e<8;e++)t[e]=new _i(0,0,0),n[e]=new _i(0,0,0);const i=new _i,o=new _i;return function(a,r){_i.set(e[0],1,0,0),_i.set(e[1],0,1,0),_i.set(e[2],0,0,1),_i.set(e[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),_i.set(e[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),_i.set(e[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(let t=0;t<3;++t)_i.cross(e[6+3*t],e[t],e[3]),_i.cross(e[7+3*t],e[t],e[4]),_i.cross(e[7+3*t],e[t],e[5]);_i.subtract(i,a.center,a.halfExtents),_i.add(o,a.center,a.halfExtents),function(e,t,n){_i.set(n[0],e.x,t.y,t.z),_i.set(n[1],e.x,t.y,e.z),_i.set(n[2],e.x,e.y,t.z),_i.set(n[3],e.x,e.y,e.z),_i.set(n[4],t.x,t.y,t.z),_i.set(n[5],t.x,t.y,e.z),_i.set(n[6],t.x,e.y,t.z),_i.set(n[7],t.x,e.y,e.z)}(i,o,t),ys(r.center,r.halfExtents,e[3],e[4],e[5],n);for(let i=0;i<15;++i){const o=bs(t,e[i]),a=bs(n,e[i]);if(a[0]>o[1]||o[0]>a[1])return 0}return 1}}(),Cs=function(e,t){const n=e.halfExtents.x*Math.abs(t.n.x)+e.halfExtents.y*Math.abs(t.n.y)+e.halfExtents.z*Math.abs(t.n.z),i=_i.dot(t.n,e.center);return i+n<t.d?-1:i-n>t.d?0:1},Es=function(e,t){for(let n=0;n<t.planes.length;n++)if(-1===Cs(e,t.planes[n]))return 0;return 1},Ts=function(){const e=new Array(8);let t=0,n=0;for(let t=0;t<e.length;t++)e[t]=new _i(0,0,0);return function(i,o){let a=0,r=!1;for(let e=0;e<o.planes.length;e++){if(a=Cs(i,o.planes[e]),-1===a)return 0;1===a&&(r=!0)}if(!r)return 1;for(let t=0;t<o.vertices.length;t++)_i.subtract(e[t],o.vertices[t],i.center);t=0,n=0;for(let a=0;a<o.vertices.length;a++)e[a].x>i.halfExtents.x?t++:e[a].x<-i.halfExtents.x&&n++;if(t===o.vertices.length||n===o.vertices.length)return 0;t=0,n=0;for(let a=0;a<o.vertices.length;a++)e[a].y>i.halfExtents.y?t++:e[a].y<-i.halfExtents.y&&n++;if(t===o.vertices.length||n===o.vertices.length)return 0;t=0,n=0;for(let a=0;a<o.vertices.length;a++)e[a].z>i.halfExtents.z?t++:e[a].z<-i.halfExtents.z&&n++;return t===o.vertices.length||n===o.vertices.length?0:1}}(),Ps=function(){const e=new _i(0,0,0),t=new pi;return function(n,i){return _i.subtract(e,i,n.center),_i.transformMat3(e,e,pi.transpose(t,n.orientation)),o=e,a=n.halfExtents,Math.abs(o.x)<a.x&&Math.abs(o.y)<a.y&&Math.abs(o.z)<a.z;var o,a}}(),ws=function(){const e=function(e,t,n,i){return Math.abs(e.x*t+e.y*n+e.z*i)};return function(t,n){const i=t.halfExtents.x*e(n.n,t.orientation.m00,t.orientation.m01,t.orientation.m02)+t.halfExtents.y*e(n.n,t.orientation.m03,t.orientation.m04,t.orientation.m05)+t.halfExtents.z*e(n.n,t.orientation.m06,t.orientation.m07,t.orientation.m08),o=_i.dot(n.n,t.center);return o+i<n.d?-1:o-i>n.d?0:1}}(),Is=function(e,t){for(let n=0;n<t.planes.length;n++)if(-1===ws(e,t.planes[n]))return 0;return 1},Rs=function(){const e=new Array(8);let t=0,n=0,i=0;for(let t=0;t<e.length;t++)e[t]=new _i(0,0,0);const o=function(e,t,n,i){return e.x*t+e.y*n+e.z*i};return function(a,r){let s=0,c=!1;for(let e=0;e<r.planes.length;e++){if(s=ws(a,r.planes[e]),-1===s)return 0;1===s&&(c=!0)}if(!c)return 1;for(let t=0;t<r.vertices.length;t++)_i.subtract(e[t],r.vertices[t],a.center);n=0,i=0;for(let s=0;s<r.vertices.length;s++)t=o(e[s],a.orientation.m00,a.orientation.m01,a.orientation.m02),t>a.halfExtents.x?n++:t<-a.halfExtents.x&&i++;if(n===r.vertices.length||i===r.vertices.length)return 0;n=0,i=0;for(let s=0;s<r.vertices.length;s++)t=o(e[s],a.orientation.m03,a.orientation.m04,a.orientation.m05),t>a.halfExtents.y?n++:t<-a.halfExtents.y&&i++;if(n===r.vertices.length||i===r.vertices.length)return 0;n=0,i=0;for(let s=0;s<r.vertices.length;s++)t=o(e[s],a.orientation.m06,a.orientation.m07,a.orientation.m08),t>a.halfExtents.z?n++:t<-a.halfExtents.z&&i++;return n===r.vertices.length||i===r.vertices.length?0:1}}(),Ds=function(){const e=new Array(15);for(let t=0;t<15;t++)e[t]=new _i(0,0,0);const t=new Array(8),n=new Array(8);for(let e=0;e<8;e++)t[e]=new _i(0,0,0),n[e]=new _i(0,0,0);return function(i,o){_i.set(e[0],i.orientation.m00,i.orientation.m01,i.orientation.m02),_i.set(e[1],i.orientation.m03,i.orientation.m04,i.orientation.m05),_i.set(e[2],i.orientation.m06,i.orientation.m07,i.orientation.m08),_i.set(e[3],o.orientation.m00,o.orientation.m01,o.orientation.m02),_i.set(e[4],o.orientation.m03,o.orientation.m04,o.orientation.m05),_i.set(e[5],o.orientation.m06,o.orientation.m07,o.orientation.m08);for(let t=0;t<3;++t)_i.cross(e[6+3*t],e[t],e[3]),_i.cross(e[7+3*t],e[t],e[4]),_i.cross(e[8+3*t],e[t],e[5]);ys(i.center,i.halfExtents,e[0],e[1],e[2],t),ys(o.center,o.halfExtents,e[3],e[4],e[5],n);for(let i=0;i<15;++i){const o=bs(t,e[i]),a=bs(n,e[i]);if(a[0]>o[1]||o[0]>a[1])return 0}return 1}}(),Ns=function(){const e=new Oo,t=new _i,n=new _i,i=new _i,o=new Array(8);for(let e=0;e<8;e++)o[e]=new _i;const a=new Array(8);for(let e=0;e<8;e++)a[e]=new _i;return function(r,s){if(0===_i.squaredDistance(s.ellipseCenter0,s.ellipseCenter1))return e.radius=s.radius,e.center.set(s.ellipseCenter0),Gs.sphereOBB(e,r);{t.x=r.orientation.m00,t.y=r.orientation.m01,t.z=r.orientation.m02,n.x=r.orientation.m03,n.y=r.orientation.m04,n.z=r.orientation.m05,i.x=r.orientation.m06,i.y=r.orientation.m07,i.z=r.orientation.m08,ys(r.center,r.halfExtents,t,n,i,o);const e=a,c=_i.copy(e[0],t),l=_i.copy(e[1],n),_=_i.copy(e[2],i);_i.subtract(e[3],s.center,r.center).normalize();const u=_i.subtract(e[4],s.ellipseCenter0,s.ellipseCenter1);u.normalize(),_i.cross(e[5],c,u),_i.cross(e[6],l,u),_i.cross(e[7],_,u);for(let t=0;t<8;++t){const n=bs(o,e[t]),i=_i.dot(e[t],s.ellipseCenter0),a=_i.dot(e[t],s.ellipseCenter1),r=Math.max(i,a),c=Math.min(i,a)-s.radius,l=r+s.radius;if(c>n[1]||n[0]>l)return 0}return 1}}}(),Os=function(e,t){const n=_i.dot(t.n,e.center),i=e.radius*t.n.length();return n+i<t.d?-1:n-i>t.d?0:1},Ms=function(e,t){for(let n=0;n<t.planes.length;n++)if(-1===Os(e,t.planes[n]))return 0;return 1},zs=function(){const e=new _i(0,0,0),t=[1,-1,1,-1,1,-1];return function(n,i){for(let o=0;o<6;o++){const a=i.planes[o],r=n.radius,s=n.center,c=a.n,l=a.d,_=_i.dot(c,s);if(_+r<l)return 0;if(!(_-r>l)){_i.add(e,s,_i.multiplyScalar(e,c,r));for(let n=0;n<6;n++){if(n===o||n===o+t[o])continue;const a=i.planes[n];if(_i.dot(a.n,e)<a.d)return 0}}}return 1}}(),Ls=function(e,t){const n=e.radius+t.radius;return _i.squaredDistance(e.center,t.center)<n*n},Fs=function(){const e=new _i;return function(t,n){return bo(e,t.center,n),_i.squaredDistance(t.center,e)<t.radius*t.radius}}(),Bs=function(){const e=new _i;return function(t,n){return So(e,t.center,n),_i.squaredDistance(t.center,e)<t.radius*t.radius}}(),ks=function(){const e=new _i,t=new _i;return function(n,i){const o=n.radius+i.radius,a=o*o,r=_i.squaredDistance(i.ellipseCenter0,i.ellipseCenter1);if(0===r)return _i.squaredDistance(n.center,i.center)<a;{_i.subtract(e,n.center,i.ellipseCenter0),_i.subtract(t,i.ellipseCenter1,i.ellipseCenter0);const o=_i.dot(e,t)/r;return o<0?_i.squaredDistance(n.center,i.ellipseCenter0)<a:o>1?_i.squaredDistance(n.center,i.ellipseCenter1)<a:(_i.scaleAndAdd(e,i.ellipseCenter0,t,o),_i.squaredDistance(n.center,e)<a)}}}(),Us=function(){const e=new _i,t=new _i,n=new _i,i=new _i,o=new _i,a=new _i;return function(r,s){const c=_i.subtract(e,r.ellipseCenter1,r.ellipseCenter0),l=_i.subtract(t,s.ellipseCenter1,s.ellipseCenter0),_=_i.subtract(n,r.ellipseCenter0,s.ellipseCenter0),u=_i.dot(c,c),h=_i.dot(c,l),f=_i.dot(l,l),p=_i.dot(c,_),d=_i.dot(l,_),m=u*f-h*h;let A,v,g=m,x=m;m<Bn?(A=0,g=1,v=d,x=f):(A=h*d-f*p,v=u*d-h*p,A<0?(A=0,v=d,x=f):A>g&&(A=g,v=d+h,x=f)),v<0?(v=0,-p<0?A=0:-p>u?A=g:(A=-p,g=u)):v>x&&(v=x,-p+h<0?A=0:-p+h>u?A=g:(A=-p+h,g=u));const y=Math.abs(A)<Bn?0:A/g,b=Math.abs(v)<Bn?0:v/x,S=i;S.set(_),S.add(_i.multiplyScalar(o,c,y)),S.subtract(_i.multiplyScalar(a,l,b));const C=r.radius+s.radius;return S.lengthSqr()<C*C}}(),Gs=e("e5",{raySphere:rs,rayAABB:ss,rayOBB:ls,rayPlane:os,rayTriangle:as,rayCapsule:_s,raySubMesh:us,rayMesh:hs,rayModel:fs,lineSphere:gs,lineAABB:As,lineOBB:vs,linePlane:ps,lineTriangle:ds,sphereWithSphere:Ls,sphereAABB:Fs,sphereOBB:Bs,spherePlane:Os,sphereFrustum:Ms,sphereFrustumAccurate:zs,sphereCapsule:ks,aabbWithAABB:xs,aabbWithOBB:Ss,aabbPlane:Cs,aabbFrustum:Es,aabbFrustumAccurate:Ts,obbWithOBB:Ds,obbPlane:ws,obbFrustum:Is,obbFrustumAccurate:Rs,obbPoint:Ps,obbCapsule:Ns,capsuleWithCapsule:Us,resolve(e,t,n=null){const i=e._type,o=t._type,a=this[i|o];return i<o?a(e,t,n):a(t,e,n)}});Gs[Eo.SHAPE_RAY|Eo.SHAPE_SPHERE]=rs,Gs[Eo.SHAPE_RAY|Eo.SHAPE_AABB]=ss,Gs[Eo.SHAPE_RAY|Eo.SHAPE_OBB]=ls,Gs[Eo.SHAPE_RAY|Eo.SHAPE_PLANE]=os,Gs[Eo.SHAPE_RAY|Eo.SHAPE_TRIANGLE]=as,Gs[Eo.SHAPE_RAY|Eo.SHAPE_CAPSULE]=_s,Gs[Eo.SHAPE_LINE|Eo.SHAPE_SPHERE]=gs,Gs[Eo.SHAPE_LINE|Eo.SHAPE_AABB]=As,Gs[Eo.SHAPE_LINE|Eo.SHAPE_OBB]=vs,Gs[Eo.SHAPE_LINE|Eo.SHAPE_PLANE]=ps,Gs[Eo.SHAPE_LINE|Eo.SHAPE_TRIANGLE]=ds,Gs[Eo.SHAPE_SPHERE]=Ls,Gs[Eo.SHAPE_SPHERE|Eo.SHAPE_AABB]=Fs,Gs[Eo.SHAPE_SPHERE|Eo.SHAPE_OBB]=Bs,Gs[Eo.SHAPE_SPHERE|Eo.SHAPE_PLANE]=Os,Gs[Eo.SHAPE_SPHERE|Eo.SHAPE_FRUSTUM]=Ms,Gs[Eo.SHAPE_SPHERE|Eo.SHAPE_FRUSTUM_ACCURATE]=zs,Gs[Eo.SHAPE_SPHERE|Eo.SHAPE_CAPSULE]=ks,Gs[Eo.SHAPE_AABB]=xs,Gs[Eo.SHAPE_AABB|Eo.SHAPE_OBB]=Ss,Gs[Eo.SHAPE_AABB|Eo.SHAPE_PLANE]=Cs,Gs[Eo.SHAPE_AABB|Eo.SHAPE_FRUSTUM]=Es,Gs[Eo.SHAPE_AABB|Eo.SHAPE_FRUSTUM_ACCURATE]=Ts,Gs[Eo.SHAPE_OBB]=Ds,Gs[Eo.SHAPE_OBB|Eo.SHAPE_PLANE]=ws,Gs[Eo.SHAPE_OBB|Eo.SHAPE_FRUSTUM]=Is,Gs[Eo.SHAPE_OBB|Eo.SHAPE_FRUSTUM_ACCURATE]=Rs,Gs[Eo.SHAPE_OBB|Eo.SHAPE_CAPSULE]=Ns,Gs[Eo.SHAPE_CAPSULE]=Us,Pn(To.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),wn(Gs,"intersect",[{name:"line_quad"}]);const js=new _i(0,0,0),Vs=new _i(0,0,0),Hs=c.mat4(),Ws=c.v4();class qs{static create(e,t,n,i){return new qs(e,t,n,i)}static clone(e){return new qs(e.n.x,e.n.y,e.n.z,e.d)}static copy(e,t){return _i.copy(e.n,t.n),e.d=t.d,e}static fromPoints(e,t,n,i){return _i.subtract(js,n,t),_i.subtract(Vs,i,t),_i.normalize(e.n,_i.cross(e.n,js,Vs)),e.d=_i.dot(e.n,t),e}static set(e,t,n,i,o){return e.n.x=t,e.n.y=n,e.n.z=i,e.d=o,e}static fromNormalAndPoint(e,t,n){return _i.copy(e.n,t),e.d=_i.dot(t,n),e}static normalize(e,t){const n=t.n.length();return _i.normalize(e.n,t.n),n>0&&(e.d=t.d/n),e}get type(){return this._type}set x(e){this.n.x=e}get x(){return this.n.x}set y(e){this.n.y=e}get y(){return this.n.y}set z(e){this.n.z=e}get z(){return this.n.z}set w(e){this.d=e}get w(){return this.d}constructor(e=0,t=1,n=0,i=0){this.n=void 0,this.d=void 0,this._type=void 0,this._type=Eo.SHAPE_PLANE,this.n=new _i(e,t,n),this.d=i}transform(e){Ei.invert(Hs,e),Ei.transpose(Hs,Hs),Oi.set(Ws,this.n.x,this.n.y,this.n.z,this.d),Oi.transformMat4(Ws,Ws,Hs),_i.set(this.n,Ws.x,Ws.y,Ws.z),this.d=Ws.w}}const Ys=jsb.NativeBufferPool;var Xs;jsb.NativeObjectPool,jsb.NativeBufferAllocator,function(e){e[e.UINT32=0]="UINT32",e[e.FLOAT32=1]="FLOAT32",e[e.NEVER=2]="NEVER"}(Xs||(Xs={}));class Qs{constructor(e,t,n,i,o=8){this._dataType=void 0,this._dataMembers=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freeLists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=i.COUNT,this._entryBits=o,this._dataType=t,this._dataMembers=n,this._stride=4*this._elementCount,this._entriesPerChunk=1<<o,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new Ys(e,o,this._stride);let a=Xs.NEVER,r=!1,s=!1;for(const e in t){if(r=this._hasFloat32,s=this._hasUint32,s&&r)break;a=t[e],r||a!==Xs.FLOAT32?s||a!==Xs.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}alloc(){let e=0;for(;e<this._freeLists.length;e++){const t=this._freeLists[e];if(t.length){const n=t[t.length-1];return t.length--,(e<<this._entryBits)+n+this._poolFlag}}const t=this._nativePool.allocateNewChunk(),n=[],i=[],o=[],a=this._hasFloat32,r=this._hasUint32;for(let e=0;e<this._entriesPerChunk;e++)a&&n.push(new Float32Array(t,this._stride*e,this._elementCount)),r&&i.push(new Uint32Array(t,this._stride*e,this._elementCount)),e&&o.push(e);return r&&this._uint32BufferViews.push(i),a&&this._float32BufferViews.push(n),this._freeLists.push(o),this._arrayBuffers.push(t),(e<<this._entryBits)+this._poolFlag}getBuffer(e){const t=(this._chunkMask&e)>>this._entryBits,n=this._entryMask&e;return(this._hasFloat32?this._float32BufferViews:this._uint32BufferViews)[t][n]}getTypedArray(e,t){const n=(this._chunkMask&e)>>this._entryBits,i=this._entryMask&e,o=t,a=(this._dataType[t]===Xs.UINT32?this._uint32BufferViews:this._float32BufferViews)[n][i],r=this._dataMembers[t];return a.subarray(o,o+r)}free(e){const t=(this._chunkMask&e)>>this._entryBits,n=this._entryMask&e;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[t][n].fill(0),this._freeLists[t].push(n)}}let Zs,Js;!function(e){e[e.NODE=0]="NODE",e[e.PASS=1]="PASS",e[e.AABB=2]="AABB"}(Zs||(Zs={})),function(e){e[e.DIRTY_FLAG=0]="DIRTY_FLAG",e[e.LAYER=1]="LAYER",e[e.WORLD_SCALE=2]="WORLD_SCALE",e[e.WORLD_POSITION=5]="WORLD_POSITION",e[e.WORLD_ROTATION=8]="WORLD_ROTATION",e[e.WORLD_MATRIX=12]="WORLD_MATRIX",e[e.LOCAL_SCALE=28]="LOCAL_SCALE",e[e.LOCAL_POSITION=31]="LOCAL_POSITION",e[e.LOCAL_ROTATION=34]="LOCAL_ROTATION",e[e.COUNT=38]="COUNT"}(Js||(Js={}));const Ks={[Js.DIRTY_FLAG]:Xs.UINT32,[Js.LAYER]:Xs.UINT32,[Js.WORLD_SCALE]:Xs.FLOAT32,[Js.WORLD_POSITION]:Xs.FLOAT32,[Js.WORLD_ROTATION]:Xs.FLOAT32,[Js.WORLD_MATRIX]:Xs.FLOAT32,[Js.LOCAL_SCALE]:Xs.FLOAT32,[Js.LOCAL_POSITION]:Xs.FLOAT32,[Js.LOCAL_ROTATION]:Xs.FLOAT32,[Js.COUNT]:Xs.NEVER},$s={[Js.DIRTY_FLAG]:Js.LAYER-Js.DIRTY_FLAG,[Js.LAYER]:Js.WORLD_SCALE-Js.LAYER,[Js.WORLD_SCALE]:Js.WORLD_POSITION-Js.WORLD_SCALE,[Js.WORLD_POSITION]:Js.WORLD_ROTATION-Js.WORLD_POSITION,[Js.WORLD_ROTATION]:Js.WORLD_MATRIX-Js.WORLD_ROTATION,[Js.WORLD_MATRIX]:Js.LOCAL_SCALE-Js.WORLD_MATRIX,[Js.LOCAL_SCALE]:Js.LOCAL_POSITION-Js.LOCAL_SCALE,[Js.LOCAL_POSITION]:Js.LOCAL_ROTATION-Js.LOCAL_POSITION,[Js.LOCAL_ROTATION]:Js.COUNT-Js.LOCAL_ROTATION,[Js.COUNT]:1},ec=new Qs(Zs.NODE,Ks,$s,Js);let tc;!function(e){e[e.PRIORITY=0]="PRIORITY",e[e.STAGE=1]="STAGE",e[e.PHASE=2]="PHASE",e[e.PRIMITIVE=3]="PRIMITIVE",e[e.BATCHING_SCHEME=4]="BATCHING_SCHEME",e[e.DYNAMIC_STATE=5]="DYNAMIC_STATE",e[e.HASH=6]="HASH",e[e.COUNT=7]="COUNT"}(tc||(tc={}));const nc={[tc.PRIORITY]:Xs.UINT32,[tc.STAGE]:Xs.UINT32,[tc.PHASE]:Xs.UINT32,[tc.PRIMITIVE]:Xs.UINT32,[tc.BATCHING_SCHEME]:Xs.UINT32,[tc.DYNAMIC_STATE]:Xs.UINT32,[tc.HASH]:Xs.UINT32,[tc.COUNT]:Xs.NEVER},ic={[tc.PRIORITY]:tc.STAGE-tc.PRIORITY,[tc.STAGE]:tc.PHASE-tc.STAGE,[tc.PHASE]:tc.PRIMITIVE-tc.PHASE,[tc.PRIMITIVE]:tc.BATCHING_SCHEME-tc.PRIMITIVE,[tc.BATCHING_SCHEME]:tc.DYNAMIC_STATE-tc.BATCHING_SCHEME,[tc.DYNAMIC_STATE]:tc.HASH-tc.DYNAMIC_STATE,[tc.HASH]:tc.COUNT-tc.HASH,[tc.COUNT]:1},oc=new Qs(Zs.PASS,nc,ic,tc);let ac;!function(e){e[e.CENTER=0]="CENTER",e[e.HALFEXTENTS=3]="HALFEXTENTS",e[e.COUNT=6]="COUNT"}(ac||(ac={}));const rc={[ac.CENTER]:Xs.FLOAT32,[ac.HALFEXTENTS]:Xs.FLOAT32,[ac.COUNT]:Xs.NEVER},sc={[ac.CENTER]:ac.HALFEXTENTS-ac.CENTER,[ac.HALFEXTENTS]:ac.COUNT-ac.HALFEXTENTS,[ac.COUNT]:1},cc=new Qs(Zs.AABB,rc,sc,ac),lc=new _i,_c=new _i,uc=new _i,hc=new _i,fc=new pi,pc=(e,t,n)=>{fc.m00=Math.abs(n.m00),fc.m01=Math.abs(n.m01),fc.m02=Math.abs(n.m02),fc.m03=Math.abs(n.m04),fc.m04=Math.abs(n.m05),fc.m05=Math.abs(n.m06),fc.m06=Math.abs(n.m08),fc.m07=Math.abs(n.m09),fc.m08=Math.abs(n.m10),_i.transformMat3(e,t,fc)};class dc{static create(e,t,n,i,o,a){return new dc(e,t,n,i,o,a)}static clone(e){return new dc(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z)}static copy(e,t){return _i.copy(e.center,t.center),_i.copy(e.halfExtents,t.halfExtents),e}static fromPoints(e,t,n){return _i.add(lc,n,t),_i.subtract(_c,n,t),_i.multiplyScalar(e.center,lc,.5),_i.multiplyScalar(e.halfExtents,_c,.5),e}static set(e,t,n,i,o,a,r){return e.center.set(t,n,i),e.halfExtents.set(o,a,r),e}static merge(e,t,n){return _i.subtract(lc,t.center,t.halfExtents),_i.subtract(_c,n.center,n.halfExtents),_i.add(uc,t.center,t.halfExtents),_i.add(hc,n.center,n.halfExtents),_i.max(hc,uc,hc),_i.min(uc,lc,_c),dc.fromPoints(e,uc,hc)}static toBoundingSphere(e,t){return e.center.set(t.center),e.radius=t.halfExtents.length(),e}static transform(e,t,n){return _i.transformMat4(e.center,t.center,n),pc(e.halfExtents,t.halfExtents,n),e}get type(){return this._type}constructor(e=0,t=0,n=0,i=1,o=1,a=1){return this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._aabbHandle=0,this._type=Eo.SHAPE_AABB,this._aabbHandle=cc.alloc(),this.center=new _i(cc.getTypedArray(this._aabbHandle,ac.CENTER)),this.halfExtents=new _i(cc.getTypedArray(this._aabbHandle,ac.HALFEXTENTS)),this.center.set(e,t,n),this.halfExtents.set(i,o,a),this._nativeObj=new lo,void this._nativeObj.initWithData(cc.getBuffer(this._aabbHandle))}get native(){return this._nativeObj}getBoundary(e,t){_i.subtract(e,this.center,this.halfExtents),_i.add(t,this.center,this.halfExtents)}transform(e,t,n,i,o){_i.transformMat4(o.center,this.center,e),pc(o.halfExtents,this.halfExtents,e)}clone(){return dc.clone(this)}copy(e){return dc.copy(this,e)}mergePoint(e){this.getBoundary(lc,_c),e.x<lc.x&&(lc.x=e.x),e.y<lc.y&&(lc.y=e.y),e.z<lc.z&&(lc.z=e.z),e.x>_c.x&&(_c.x=e.x),e.y>_c.y&&(_c.y=e.y),e.z>_c.z&&(_c.z=e.z),_i.add(uc,lc,_c),this.center.set(_i.multiplyScalar(uc,uc,.5)),this.halfExtents.set(_c.x-uc.x,_c.y-uc.y,_c.z-uc.z)}mergePoints(e){if(!(e.length<1))for(let t=0;t<e.length;t++)this.mergePoint(e[t])}mergeFrustum(e){return this.mergePoints(e.vertices)}}e("cn",dc);const mc=new _i,Ac=new _i,vc=new pi;class gc{static create(e,t,n,i,o,a,r,s,c,l,_,u,h,f,p){return new gc(e,t,n,i,o,a,r,s,c,l,_,u,h,f,p)}static clone(e){return new gc(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z,e.orientation.m00,e.orientation.m01,e.orientation.m02,e.orientation.m03,e.orientation.m04,e.orientation.m05,e.orientation.m06,e.orientation.m07,e.orientation.m08)}static copy(e,t){return _i.copy(e.center,t.center),_i.copy(e.halfExtents,t.halfExtents),pi.copy(e.orientation,t.orientation),e}static fromPoints(e,t,n){return _i.multiplyScalar(e.center,_i.add(mc,t,n),.5),_i.multiplyScalar(e.halfExtents,_i.subtract(Ac,n,t),.5),pi.identity(e.orientation),e}static set(e,t,n,i,o,a,r,s,c,l,_,u,h,f,p,d){return _i.set(e.center,t,n,i),_i.set(e.halfExtents,o,a,r),pi.set(e.orientation,s,c,l,_,u,h,f,p,d),e}get type(){return this._type}constructor(e=0,t=0,n=0,i=1,o=1,a=1,r=1,s=0,c=0,l=0,_=1,u=0,h=0,f=0,p=1){this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=Eo.SHAPE_OBB,this.center=new _i(e,t,n),this.halfExtents=new _i(i,o,a),this.orientation=new pi(r,s,c,l,_,u,h,f,p)}getBoundary(e,t){var n,i,o;n=mc,i=this.halfExtents,o=this.orientation,vc.m00=Math.abs(o.m00),vc.m01=Math.abs(o.m01),vc.m02=Math.abs(o.m02),vc.m03=Math.abs(o.m03),vc.m04=Math.abs(o.m04),vc.m05=Math.abs(o.m05),vc.m06=Math.abs(o.m06),vc.m07=Math.abs(o.m07),vc.m08=Math.abs(o.m08),_i.transformMat3(n,i,vc),_i.subtract(e,this.center,mc),_i.add(t,this.center,mc)}transform(e,t,n,i,o){_i.transformMat4(o.center,this.center,e),pi.fromQuat(o.orientation,n),_i.multiply(o.halfExtents,this.halfExtents,i)}translateAndRotate(e,t,n){_i.transformMat4(n.center,this.center,e),pi.fromQuat(n.orientation,t)}setScale(e,t){_i.multiply(t.halfExtents,this.halfExtents,e)}}class xc{get type(){return this._type}constructor(e=.5,t=.5,n=1){this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=Eo.SHAPE_CAPSULE,this.radius=e,this.halfHeight=t,this.axis=n,this.center=new _i,this.rotation=new Ai,this.ellipseCenter0=new _i(0,t,0),this.ellipseCenter1=new _i(0,-t,0),this.updateCache()}transform(e,t,n,i,o){const a=i,r=ni(a);o.radius=this.radius*Math.abs(r);let s=(this.halfHeight+this.radius)*Math.abs(a.y)-o.radius;s<0&&(s=0),o.halfHeight=s,_i.transformMat4(o.center,this.center,e),Ai.multiply(o.rotation,this.rotation,n),o.updateCache()}updateCache(){this.updateLocalCenter(),_i.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),_i.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)}updateLocalCenter(){const e=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(e,0,0),this.ellipseCenter1.set(-e,0,0);break;case 1:this.ellipseCenter0.set(0,e,0),this.ellipseCenter1.set(0,-e,0);break;case 2:this.ellipseCenter0.set(0,0,e),this.ellipseCenter1.set(0,0,-e)}}}const yc=new Array(8);yc[0]=new _i(1,1,1),yc[1]=new _i(-1,1,1),yc[2]=new _i(-1,-1,1),yc[3]=new _i(1,-1,1),yc[4]=new _i(1,1,-1),yc[5]=new _i(-1,1,-1),yc[6]=new _i(-1,-1,-1),yc[7]=new _i(1,-1,-1);const bc=new _i,Sc=new _i,Cc=new _i;class Ec{set accurate(e){this._type=e?Eo.SHAPE_FRUSTUM_ACCURATE:Eo.SHAPE_FRUSTUM}static createFromAABB(e,t){const n=new _i,i=new _i;return _i.subtract(n,t.center,t.halfExtents),_i.add(i,t.center,t.halfExtents),e.vertices[0].set(n.x,i.y,n.z),e.vertices[1].set(i.x,i.y,n.z),e.vertices[2].set(i.x,n.y,n.z),e.vertices[3].set(n.x,n.y,n.z),e.vertices[4].set(n.x,i.y,i.z),e.vertices[5].set(i.x,i.y,i.z),e.vertices[6].set(i.x,n.y,i.z),e.vertices[7].set(n.x,n.y,i.z),e._type!==Eo.SHAPE_FRUSTUM_ACCURATE||e.updatePlanes(),e}static split(e,t,n,i,o){const a=Math.tan(.5*t.fov),r=a*t.aspect;bc.set(i*r,i*a,i),Sc.set(o*r,o*a,o);const s=e.vertices;return Cc.set(bc.x,bc.y,bc.z),_i.transformMat4(s[0],Cc,n),Cc.set(-bc.x,bc.y,bc.z),_i.transformMat4(s[1],Cc,n),Cc.set(-bc.x,-bc.y,bc.z),_i.transformMat4(s[2],Cc,n),Cc.set(bc.x,-bc.y,bc.z),_i.transformMat4(s[3],Cc,n),Cc.set(Sc.x,Sc.y,Sc.z),_i.transformMat4(s[4],Cc,n),Cc.set(-Sc.x,Sc.y,Sc.z),_i.transformMat4(s[5],Cc,n),Cc.set(-Sc.x,-Sc.y,Sc.z),_i.transformMat4(s[6],Cc,n),Cc.set(Sc.x,-Sc.y,Sc.z),_i.transformMat4(s[7],Cc,n),e.updatePlanes(),e}static create(){return new Ec}static clone(e){return Ec.copy(new Ec,e)}static copy(e,t){e._type=t._type;for(let n=0;n<6;++n)qs.copy(e.planes[n],t.planes[n]);for(let n=0;n<8;++n)_i.copy(e.vertices[n],t.vertices[n]);return e}get type(){return this._type}constructor(){this._type=void 0,this.planes=void 0,this.vertices=void 0,this._type=Eo.SHAPE_FRUSTUM,this.planes=new Array(6);for(let e=0;e<6;++e)this.planes[e]=qs.create(0,0,0,0);this.vertices=new Array(8);for(let e=0;e<8;++e)this.vertices[e]=new _i}update(e,t){if(_i.set(this.planes[0].n,e.m03+e.m00,e.m07+e.m04,e.m11+e.m08),this.planes[0].d=-(e.m15+e.m12),_i.set(this.planes[1].n,e.m03-e.m00,e.m07-e.m04,e.m11-e.m08),this.planes[1].d=-(e.m15-e.m12),_i.set(this.planes[2].n,e.m03+e.m01,e.m07+e.m05,e.m11+e.m09),this.planes[2].d=-(e.m15+e.m13),_i.set(this.planes[3].n,e.m03-e.m01,e.m07-e.m05,e.m11-e.m09),this.planes[3].d=-(e.m15-e.m13),_i.set(this.planes[4].n,e.m03+e.m02,e.m07+e.m06,e.m11+e.m10),this.planes[4].d=-(e.m15+e.m14),_i.set(this.planes[5].n,e.m03-e.m02,e.m07-e.m06,e.m11-e.m10),this.planes[5].d=-(e.m15-e.m14),this._type===Eo.SHAPE_FRUSTUM_ACCURATE){for(let e=0;e<6;e++){const t=this.planes[e],n=1/t.n.length();_i.multiplyScalar(t.n,t.n,n),t.d*=n}for(let e=0;e<8;e++)_i.transformMat4(this.vertices[e],yc[e],t)}}transform(e){if(this._type===Eo.SHAPE_FRUSTUM_ACCURATE){for(let t=0;t<8;t++)_i.transformMat4(this.vertices[t],this.vertices[t],e);qs.fromPoints(this.planes[0],this.vertices[1],this.vertices[6],this.vertices[5]),qs.fromPoints(this.planes[1],this.vertices[3],this.vertices[4],this.vertices[7]),qs.fromPoints(this.planes[2],this.vertices[6],this.vertices[3],this.vertices[7]),qs.fromPoints(this.planes[3],this.vertices[0],this.vertices[5],this.vertices[4]),qs.fromPoints(this.planes[4],this.vertices[2],this.vertices[0],this.vertices[3]),qs.fromPoints(this.planes[5],this.vertices[7],this.vertices[5],this.vertices[6])}}updatePlanes(){qs.fromPoints(this.planes[0],this.vertices[1],this.vertices[6],this.vertices[5]),qs.fromPoints(this.planes[1],this.vertices[3],this.vertices[4],this.vertices[7]),qs.fromPoints(this.planes[2],this.vertices[6],this.vertices[3],this.vertices[7]),qs.fromPoints(this.planes[3],this.vertices[0],this.vertices[5],this.vertices[4]),qs.fromPoints(this.planes[4],this.vertices[2],this.vertices[0],this.vertices[3]),qs.fromPoints(this.planes[5],this.vertices[7],this.vertices[5],this.vertices[6])}}function Tc(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function Pc(e,t,n,i,o){var a={};return Object.keys(i).forEach((function(e){a[e]=i[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}let wc,Ic;Ec.createOrtho=(e,t,n,i,o,a)=>{const r=t/2,s=n/2;_i.set(Cc,r,s,-i),_i.transformMat4(e.vertices[0],Cc,a),_i.set(Cc,-r,s,-i),_i.transformMat4(e.vertices[1],Cc,a),_i.set(Cc,-r,-s,-i),_i.transformMat4(e.vertices[2],Cc,a),_i.set(Cc,r,-s,-i),_i.transformMat4(e.vertices[3],Cc,a),_i.set(Cc,r,s,-o),_i.transformMat4(e.vertices[4],Cc,a),_i.set(Cc,-r,s,-o),_i.transformMat4(e.vertices[5],Cc,a),_i.set(Cc,-r,-s,-o),_i.transformMat4(e.vertices[6],Cc,a),_i.set(Cc,r,-s,-o),_i.transformMat4(e.vertices[7],Cc,a),qs.fromPoints(e.planes[0],e.vertices[1],e.vertices[6],e.vertices[5]),qs.fromPoints(e.planes[1],e.vertices[3],e.vertices[4],e.vertices[7]),qs.fromPoints(e.planes[2],e.vertices[6],e.vertices[3],e.vertices[7]),qs.fromPoints(e.planes[3],e.vertices[0],e.vertices[5],e.vertices[4]),qs.fromPoints(e.planes[4],e.vertices[2],e.vertices[0],e.vertices[3]),qs.fromPoints(e.planes[5],e.vertices[7],e.vertices[5],e.vertices[6])},function(e){e[e.Default=0]="Default",e[e.Normal=1]="Normal",e[e.Loop=2]="Loop",e[e.ShouldWrap=4]="ShouldWrap",e[e.Clamp=8]="Clamp",e[e.PingPong=22]="PingPong",e[e.Reverse=36]="Reverse"}(wc||(wc={})),function(e){e[e.Default=wc.Default]="Default",e[e.Normal=wc.Normal]="Normal",e[e.Reverse=wc.Reverse]="Reverse",e[e.Loop=wc.Loop]="Loop",e[e.LoopReverse=wc.Loop|wc.Reverse]="LoopReverse",e[e.PingPong=wc.PingPong]="PingPong",e[e.PingPongReverse=wc.PingPong|wc.Reverse]="PingPongReverse"}(Ic||(Ic={})),je(Ic);class Rc{constructor(e){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,e&&this.set(e)}set(e){this.ratio=e.ratio,this.time=e.time,this.direction=e.direction,this.stopped=e.stopped,this.iterations=e.iterations,this.frameIndex=e.frameIndex}}function Dc(e,t,n=1e-6){let i=0,o=e.length-1,a=o>>>1;for(;i<=o;a=i+o>>>1){const r=e[a];if(r>t+n)o=a-1;else{if(!(r<t-n))return a;i=a+1}}return~i}const Nc=()=>{},Oc=()=>Nc,Mc=zc((()=>{}));function zc(e){return function(t){return"function"==typeof t?e(t):function(n){return e(n,t)}}}function Lc(e){return t=>n=>{!function(e,t,n){const i=Bc(e);if(i){const e=kc(i,"proto");kc(e,"editor")[t]=n}}(n,e,t)}}const Fc="__ccclassCache__";function Bc(e){return kc(e,Fc)}function kc(e,t){return e[t]||(e[t]={})}const Uc=e("bN",zc(((e,t)=>{let n=Ne.getSuper(e);n===Object&&(n=null);const i={name:t,extends:n,ctor:e},o=e[Fc];if(o){const t=o.proto;t&&Ne.mixin(i,t),e[Fc]=void 0}return Rt(i)}))),Gc=e("d3",Lc("requireComponent")),jc=e("bX",Lc("executionOrder")),Vc=e("c$",Mc);function Hc(e,t,n){let i=null;function o(e,t,n){const o=Bc(e.constructor);if(o){const a=kc(o,"proto"),r=kc(a,"properties");!function(e,t,n,i,o,a){let r;const s=o&&(o.get||o.set);i&&(r=xt(i,s));const c=t[n],l=Ne.mixin(c||{},r||i||{});if(s)o.get&&(l.get=o.get),o.set&&(l.set=o.set);else if(o)o.initializer&&(l.default=function(e){let t;try{t=e()}catch(t){return e}return"object"!=typeof t||null===t?t:e}(o.initializer));else{const t=a.default||(a.default=function(e){let t;try{t=new e}catch(e){return{}}return t}(e));t.hasOwnProperty(n)&&(l.default=t[n])}t[n]=l}(e.constructor,r,t,i,n,o)}}return void 0===e?Hc({type:void 0}):void 0===t?(i=e,o):void o(e,t,n)}const Wc=Symbol("cc:SerializationMetadata"),qc=e("bU",((e,t,n)=>Hc(Qc({}))(e,t,n)));function Yc(e){return Hc(Qc({formerlySerializedAs:e}))}const Xc=e("dQ",((e,t,n)=>Hc({editorOnly:!0})(e,t,n)));function Qc(e){return e.__noImplicit=!0,"serializable"in e||(e.serializable=!0),e}const Zc=Nc,Jc=e("bS",Mc),Kc=e("bY",Oc),$c=e("ez",Mc),el=Oc,tl=Oc,nl=e("bW",Oc),il=e("bQ",Nc),ol=e("b_",Oc),al=Nc,rl=e("d4",Oc),sl=e("bZ",Oc),cl=e("c9",Oc),ll=e("dB",Oc),_l=(e("dC",Oc),Oc),ul=e("c8",Nc),hl=e("ca",Oc),fl=(e("e2",Nc),e("d5",Nc),e("bT",Nc)),pl=vl(_t),dl=vl(ut),ml=vl(ht),Al=e("cV",vl(ft));function vl(e){return Hc({type:e})}const gl=e("cH",((e,t,n)=>Hc({__noImplicit:!0,override:!0})(e,t,n)));let xl;var yl,bl,Sl,Cl;let El,Tl,Pl,wl=Uc("cc.KeyframeCurve")((xl=Symbol.iterator,Sl=Pc((bl=class{constructor(){Tc(this,"_times",Sl,this),Tc(this,"_values",Cl,this)}get keyFramesCount(){return this._times.length}get rangeMin(){return this._times[0]}get rangeMax(){return this._times[this._values.length-1]}[xl](){let e=0;return{next:()=>{if(e>=this._times.length)return{done:!0,value:void 0};{const t=[this._times[e],this._values[e]];return++e,{done:!1,value:t}}}}}keyframes(){return this}times(){return this._times}values(){return this._values}getKeyframeTime(e){return this._times[e]}getKeyframeValue(e){return this._values[e]}addKeyFrame(e,t){return this._insertNewKeyframe(e,t)}removeKeyframe(e){this._times.splice(e,1),this._values.splice(e,1)}indexOfKeyframe(e){return Dc(this._times,e)}updateTime(e,t){const n=this._values[e];this.removeKeyframe(e),this._insertNewKeyframe(t,n)}assignSorted(e,t){if(void 0!==t)this.setKeyframes(e.slice(),t.slice());else{const t=Array.from(e);this.setKeyframes(t.map((([e])=>e)),t.map((([,e])=>e)))}}clear(){this._times.length=0,this._values.length=0}searchKeyframe(e){return Dc(this._times,e)}setKeyframes(e,t){e.length,t.length,function(e){e.every(((e,t,n)=>0===t||e>n[t-1]||Un(e,n[t-1],1e-6)))}(e),this._times=e,this._values=t}_insertNewKeyframe(e,t){const n=this._times,i=this._values,o=n.length,a=Dc(n,e);if(a>=0)return a;const r=~a;return 0===r?(n.unshift(e),i.unshift(t)):r===o?(n.push(e),i.push(t)):(n.splice(r-1,0,e),i.splice(r-1,0,t)),r}}).prototype,"_times",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Cl=Pc(bl.prototype,"_values",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yl=bl))||yl;function Il(e){return e>-1e-9&&e<1e-9}!function(e){e[e.LINEAR=0]="LINEAR",e[e.CONSTANT=1]="CONSTANT",e[e.CUBIC=2]="CUBIC"}(El||(El=e("gD",{}))),function(e){e[e.LINEAR=0]="LINEAR",e[e.CLAMP=1]="CLAMP",e[e.LOOP=2]="LOOP",e[e.PING_PONG=3]="PING_PONG"}(Tl||(Tl=e("gE",{}))),function(e){e[e.NONE=0]="NONE",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.BOTH=3]="BOTH"}(Pl||(Pl=e("gF",{})));const Rl=class{};var Dl=Object.freeze({__proto__:null,uniquelyReferenced:Zc,ccclass:Uc,property:Hc,requireComponent:Gc,executionOrder:jc,disallowMultiple:Vc,allowReplicated:e=>{Rt.Attr.setClassAttr(e,"replicated","visible",!0)},executeInEditMode:Jc,menu:Kc,playOnFocus:$c,inspector:el,icon:tl,help:nl,type:vl,integer:pl,float:dl,boolean:ml,string:Al});e("ev",Dl);class Nl{constructor(e){this._map=null,this._count=0,e?(this._map=e,this._count=Object.keys(e).length):(this._map=Ne.createMap(!0),this._count=0)}add(e,t){return e in this._map||this._count++,this._map[e]=t}get(e){return this._map[e]}has(e){return e in this._map}remove(e){const t=this._map[e];return e in this._map&&(delete this._map[e],this._count--),t}clear(){0!==this._count&&(this._map=Ne.createMap(!0),this._count=0)}forEach(e){for(const t in this._map)e(this._map[t],t)}find(e){for(const t in this._map)if(e(this._map[t],t))return this._map[t];return null}get count(){return this._count}destroy(){this._map=null}}class Ol{constructor(e,t){this.id=Ol._pipelineId++,this.name="",this.pipes=[],this.name=e;for(let e=0,n=t.length;e<n;e++)this.pipes.push(t[e])}insert(e,t){return t>this.pipes.length?(w(4921),this):(this.pipes.splice(t,0,e),this)}append(e){return this.pipes.push(e),this}remove(e){return this.pipes.splice(e,1),this}sync(e){const t=this.pipes;if(0===t.length)return null;e.isFinish=!1;for(let n=0,i=t.length;n<i;){const o=(0,t[n])(e);if(o)return e.isFinish=!0,o;n++,n!==i&&(e.input=e.output,e.output=null)}return e.isFinish=!0,e.output}async(e){0!==this.pipes.length&&(e.isFinish=!1,this._flow(0,e))}_flow(e,t){(0,this.pipes[e])(t,(n=>{n?(t.isFinish=!0,t.dispatch("complete",n)):++e<this.pipes.length?(t.input=t.output,t.output=null,this._flow(e,t)):(t.isFinish=!0,t.dispatch("complete",n,t.output))}))}}Ol._pipelineId=0;const Ml=new Nl,zl=new Nl,Ll=new Nl,Fl=new Nl,Bl=new Ol("normal load",[]),kl=new Ol("fetch",[]),Ul=new Ol("transform url",[]);let Gl;!function(e){e.UUID="uuid",e.PATH="path",e.DIR="dir",e.URL="url",e.SCENE="scene"}(Gl||(Gl={}));const jl={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};let Vl;!function(e){e.RESOURCES="resources",e.MAIN="main",e.START_SCENE="start-scene"}(Vl||(Vl={}));class Hl{static create(e){let t;return 0!==Hl._deadPool.length?(t=Hl._deadPool.pop(),t.set(e)):t=new Hl(e),t}constructor(e){this.id=Hl._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinish=!0,this.set(e)}set(e=Object.create(null)){this.onComplete=e.onComplete||null,this.onProgress=e.onProgress||null,this.onError=e.onError||null,this.source=this.input=e.input,this.output=null,this.progress=e.progress,this.options=e.options||Object.create(null)}dispatch(e,t,n,i,o){switch(e){case"complete":this.onComplete&&this.onComplete(t,n);break;case"progress":this.onProgress&&this.onProgress(t,n,i,o);break;case"error":this.onError&&this.onError(t,n,i,o);break;default:{const a=`on${e[0].toUpperCase()}${e.substr(1)}`;"function"==typeof this[a]&&this[a](t,n,i,o);break}}}recycle(){Hl._deadPool.length!==Hl.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,Hl._deadPool.push(this))}}Hl.MAX_DEAD_NUM=500,Hl._taskId=0,Hl._deadPool=[];const Wl="0123456789abcdef".split(""),ql=["","","",""],Yl=ql.concat(ql,"-",ql,"-",ql,"-",ql,"-",ql,ql,ql),Xl=Yl.map(((e,t)=>"-"===e?NaN:t)).filter(isFinite);function Ql(e){const t=e.split("@")[0];if(22!==t.length)return e;Yl[0]=e[0],Yl[1]=e[1];for(let t=2,n=2;t<22;t+=2){const i=Ye[e.charCodeAt(t)],o=Ye[e.charCodeAt(t+1)];Yl[Xl[n++]]=Wl[i>>2],Yl[Xl[n++]]=Wl[(3&i)<<2|o>>4],Yl[Xl[n++]]=Wl[15&o]}return e.replace(t,Yl.join(""))}const Zl=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function Jl(e){const t=Zl.exec(e);return t?t[1]:""}function Kl(e,t){(t=t||Object.create(null)).__isNative__=t.isNative,t.ext=t.nativeExt;const n=Fl.find((t=>!!t.getAssetInfo(e)));return n&&(t.bundle=n.name),t_(e,t)}function $l(e){return!!e&&(e instanceof c.SceneAsset||e instanceof c.Scene)}function e_(e){return e&&(46===e.charCodeAt(0)&&47===e.charCodeAt(1)?e=e.slice(2):47===e.charCodeAt(0)&&(e=e.slice(1))),e}function t_(e,t){const n=Hl.create({input:e,options:t}),i=[];try{const e=Ul.sync(n);for(const t of e){const e=t.url;t.recycle(),i.push(e)}}catch(e){for(const e of n.output)e.recycle();g(e.message,e.stack)}return n.recycle(),i.length>1?i:i[0]}var n_=Object.freeze({__proto__:null,getUuidFromURL:Jl,getUrlWithUuid:Kl,isScene:$l,normalize:e_,transform:t_,decodeUuid:Ql});const i_=new class{constructor(){this._finalizationRegistry=null}registerGCObject(e){return e}unregisterGCObject(e){}init(){}finalizationRegistryCallback(e){e.isValid&&e.destroy()}destroy(){}};var o_;let a_=Uc("cc.GCObject")(o_=class extends Lt{constructor(...e){return super(...e),i_.registerGCObject(this)}equals(e){return!!e&&e===this}destroy(){return i_.unregisterGCObject(this),super.destroy()}})||o_;var r_,s_,c_,l_;let __=e("cP",Uc("cc.Asset")((l_=class extends(qt(a_)){static deserialize(e){return c.deserialize(e)}get nativeUrl(){if(!this._nativeUrl){if(!this._native)return"";const e=this._native;if(47===e.charCodeAt(0))return e.slice(1);46===e.charCodeAt(0)?this._nativeUrl=Kl(this._uuid,{nativeExt:e,isNative:!0}):this._nativeUrl=Kl(this._uuid,{__nativeName__:e,nativeExt:cn(e),isNative:!0})}return this._nativeUrl}get _nativeAsset(){return this._file}set _nativeAsset(e){this._file=e}constructor(...e){super(...e),this.loaded=!0,Tc(this,"_native",c_,this),this._nativeUrl="",this._file=null,this._ref=0,Object.defineProperty(this,"_uuid",{value:"",writable:!0})}toString(){return this.nativeUrl}serialize(){}_setRawAsset(e,t=!0){this._native=!1!==t?e||"":`/${e}`}get _nativeDep(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}get refCount(){return this._ref}addRef(){return this._ref++,this}decRef(e=!0){return this._ref>0&&this._ref--,e&&c.assetManager._releaseManager.tryRelease(this),this}onLoaded(){}initDefault(e){e&&(this._uuid=e),this.isDefault=!0}validate(){return!0}destroy(){return y(M(12101,this._uuid)),super.destroy()}},c_=Pc((s_=l_).prototype,"_native",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Pc(s_.prototype,"_nativeAsset",[Hc],Object.getOwnPropertyDescriptor(s_.prototype,"_nativeAsset"),s_.prototype),r_=s_))||r_);var u_,h_,f_;__.prototype.createNode=null,c.Asset=__;let p_=e("fM",Uc("cc.Script")(u_=class extends __{})||u_);c._Script=p_;let d_=e("fN",Uc("cc.JavaScript")(h_=class extends p_{})||h_);c._JavaScript=d_;let m_=e("fO",Uc("cc.TypeScript")(f_=class extends p_{})||f_);var A_,v_,g_,x_,y_,b_,S_,C_,E_,T_,P_;c._TypeScript=m_;const w_=new W("Comp"),I_=Lt.Flags.IsOnLoadCalled;let R_=e("cb",(A_=Uc("cc.Component"),v_=rl(),g_=vl(p_),x_=sl(),A_((P_=T_=class extends Lt{constructor(...e){super(...e),Tc(this,"node",S_,this),Tc(this,"_enabled",C_,this),Tc(this,"__prefab",E_,this),this._sceneGetter=null,this._id=w_.getNewId()}get name(){if(this._name)return this._name;let e=ie(this);const t=e.lastIndexOf(".");return t>=0&&(e=e.slice(t+1)),this.node?`${this.node.name}<${e}>`:e}set name(e){this._name=e}get uuid(){return this._id}get __scriptAsset(){return null}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&(this._enabled=e,this.node.activeInHierarchy)){const t=c.director._compScheduler;e?t.enableComp(this):t.disableComp(this)}}get enabledInHierarchy(){return this._enabled&&this.node&&this.node.activeInHierarchy}get _isOnLoadCalled(){return this._objFlags&I_}_getRenderScene(){return this._sceneGetter?this._sceneGetter():this.node.scene.renderScene}addComponent(e){return this.node.addComponent(e)}getComponent(e){return this.node.getComponent(e)}getComponents(e){return this.node.getComponents(e)}getComponentInChildren(e){return this.node.getComponentInChildren(e)}getComponentsInChildren(e){return this.node.getComponentsInChildren(e)}destroy(){return!!super.destroy()&&(this._enabled&&this.node.activeInHierarchy&&c.director._compScheduler.disableComp(this),!0)}_onPreDestroy(){this.unscheduleAllCallbacks(),c.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)}_instantiate(e){return e||(e=c.instantiate._clone(this,this)),e&&(e.node=null),e}schedule(e,t=0,n=c.macro.REPEAT_FOREVER,i=0){N(e,1619),N((t=t||0)>=0,1620),n=Number.isNaN(n)?c.macro.REPEAT_FOREVER:n,i=i||0;const o=c.director.getScheduler(),a=o.isTargetPaused(this);o.schedule(e,this,t,n,i,a)}scheduleOnce(e,t=0){this.schedule(e,0,0,t)}unschedule(e){e&&c.director.getScheduler().unschedule(e,this)}unscheduleAllCallbacks(){c.director.getScheduler().unscheduleAllForTarget(this)}},T_.system=null,Pc((b_=P_).prototype,"__scriptAsset",[v_,g_,x_,fl],Object.getOwnPropertyDescriptor(b_.prototype,"__scriptAsset"),b_.prototype),S_=Pc(b_.prototype,"node",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C_=Pc(b_.prototype,"_enabled",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),E_=Pc(b_.prototype,"__prefab",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y_=b_))||y_));const D_=R_.prototype;var N_,O_,M_;D_.update=null,D_.lateUpdate=null,D_.__preload=null,D_.onLoad=null,D_.start=null,D_.onEnable=null,D_.onDisable=null,D_.onDestroy=null,D_.onFocusInEditor=null,D_.onLostFocusInEditor=null,D_.resetInEditor=null,D_._getLocalBounds=null,D_.onRestore=null,R_._requireComponent=null,R_._executionOrder=0,K(R_,"_registerEditorProps",((e,t)=>{let n=t.requireComponent;n&&(Array.isArray(n)&&(n=n.filter(Boolean)),e._requireComponent=n);const i=t.executionOrder;i&&"number"==typeof i&&(e._executionOrder=i)})),c.Component=R_;let z_,L_=e("gk",Uc("cc.MissingScript")(N_=el()((M_=Pc((O_=class extends R_{static safeFindClass(e){const t=Pe(e);if(t)return t;c.deserialize.reportMissingClass(e)}constructor(){super(),Tc(this,"_$erialized",M_,this)}onLoad(){w(4600,this.node.name)}}).prototype,"_$erialized",[qc,Xc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N_=O_))||N_)||N_);c._MissingScript=L_;try{const e=L_.__values__;0!==e.length&&"_$erialized"===e[e.length-1]||(g("The '_$erialized' prop in MissingScript is missing. Please contact jare."),g(`    Error props: ['${e}']`))}catch(xo){g(`Error when checking MissingScript 5, ${xo}`)}!function(e){e[e.PORTRAIT=1]="PORTRAIT",e[e.PORTRAIT_UPSIDE_DOWN=2]="PORTRAIT_UPSIDE_DOWN",e[e.LANDSCAPE_LEFT=4]="LANDSCAPE_LEFT",e[e.LANDSCAPE_RIGHT=8]="LANDSCAPE_RIGHT",e[e.LANDSCAPE=12]="LANDSCAPE",e[e.AUTO=13]="AUTO"}(z_||(z_={}));const F_={0:z_.PORTRAIT,"-90":z_.LANDSCAPE_LEFT,90:z_.LANDSCAPE_RIGHT,180:z_.PORTRAIT_UPSIDE_DOWN},B_=e("dG",new class extends Yt{get supportFullScreen(){return!1}get isFullScreen(){return!1}get devicePixelRatio(){return jsb.device.getDevicePixelRatio()||1}get windowSize(){const e=this.devicePixelRatio,t=Math.round(window.innerWidth),n=Math.round(window.innerHeight);return new Li(t*e,n*e)}set windowSize(e){console.warn("Setting window size is not supported yet.")}get resolution(){const e=this.windowSize,t=this.resolutionScale;return new Li(e.width*t,e.height*t)}get resolutionScale(){return this._resolutionScale}set resolutionScale(e){var t;e!==this._resolutionScale&&(this._resolutionScale=e,null===(t=this._cbToUpdateFrameBuffer)||void 0===t||t.call(this))}get orientation(){return F_[jsb.device.getDeviceOrientation()]}set orientation(e){console.warn("Setting orientation is not supported yet.")}get safeAreaEdge(){const e=jsb.device.getSafeAreaEdge(),t=this.devicePixelRatio;let n=e.x*t,i=e.z*t,o=e.y*t,a=e.w*t;return this.orientation===z_.PORTRAIT?n<i?n=i:i=n:o<a?o=a:a=o,{top:n,bottom:i,left:o,right:a}}get isProportionalToFrame(){return this._isProportionalToFrame}set isProportionalToFrame(e){}constructor(){super(),this.isFrameRotated=!1,this.handleResizeEvent=!0,this._cbToUpdateFrameBuffer=void 0,this._resolutionScale=1,this._isProportionalToFrame=!1,this._registerEvent()}init(e,t){this._cbToUpdateFrameBuffer=t,this._cbToUpdateFrameBuffer()}requestFullScreen(){return Promise.reject(new Error("request fullscreen has not been supported yet on this platform."))}exitFullScreen(){return Promise.reject(new Error("exit fullscreen has not been supported yet on this platform."))}_registerEvent(){jsb.onResize=e=>{0!==e.width&&0!==e.height&&(e.width/=this.devicePixelRatio,e.height/=this.devicePixelRatio,window.resize(e.width,e.height),this.emit("window-resize"))},jsb.onOrientationChanged=()=>{this.emit("orientation-change")}}}),k_=e("de",new class{_init(e){B_.init(e,(()=>{var e;const t=c.director;(null===(e=t.root)||void 0===e?void 0:e.pipeline)?t.root.pipeline.pipelineSceneData.shadingScale=B_.resolutionScale:w(1220)}))}get devicePixelRatio(){return B_.devicePixelRatio}get windowSize(){return B_.windowSize}set windowSize(e){B_.windowSize=e}get resolution(){return B_.resolution}get supportsFullScreen(){return B_.supportFullScreen}fullScreen(){return B_.isFullScreen}requestFullScreen(e,t,n){return arguments.length>0&&w(1400,"screen.requestFullScreen(element, onFullScreenChange?, onFullScreenError?)","screen.requestFullScreen(): Promise"),B_.requestFullScreen().then((()=>{null==t||t()})).catch((e=>{console.error(e),null==n||n()}))}exitFullScreen(){return B_.exitFullScreen()}autoFullScreen(e,t){var n;null===(n=this.requestFullScreen(e,t))||void 0===n||n.catch((()=>{}))}disableAutoFullScreen(e){}});c.screen=k_;const U_=e("dp",{Feature:$t,hasFeature:e=>nn.hasFeature(e),NetworkType:Zt,Language:Qt,OS:Jt,Platform:Kt,BrowserType:Xt,isNative:nn.isNative,isBrowser:nn.isBrowser,isMobile:nn.isMobile,isLittleEndian:nn.isLittleEndian,platform:nn.platform,language:nn.language,languageCode:nn.nativeLanguage,os:nn.os,osVersion:nn.osVersion,osMainVersion:nn.osMainVersion,browserType:nn.browserType,browserVersion:nn.browserVersion,windowPixelResolution:k_.windowSize,capabilities:{canvas:!0,opengl:!0,webp:nn.hasFeature($t.WEBP),imageBitmap:nn.hasFeature($t.IMAGE_BITMAP),touches:nn.hasFeature($t.INPUT_TOUCH),mouse:nn.hasFeature($t.EVENT_MOUSE),keyboard:nn.hasFeature($t.EVENT_KEYBOARD),accelerometer:nn.hasFeature($t.EVENT_ACCELEROMETER)},localStorage:{},getNetworkType:()=>nn.networkType,getBatteryLevel:()=>nn.getBatteryLevel(),garbageCollect(){nn.triggerGC()},isObjectValid:e=>null!=e,dump(){let e="";e+=`isMobile : ${this.isMobile}\r\n`,e+=`language : ${this.language}\r\n`,e+=`browserType : ${this.browserType}\r\n`,e+=`browserVersion : ${this.browserVersion}\r\n`,e+=`capabilities : ${JSON.stringify(this.capabilities)}\r\n`,e+=`os : ${this.os}\r\n`,e+=`osVersion : ${this.osVersion}\r\n`,e+=`platform : ${this.platform}\r\n`,e+=`Using ${c.game.renderType===c.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS"} renderer.\r\n`,A(e)},openURL(e){nn.openURL(e)},now:()=>nn.now(),restartVM(){nn.restartJSVM()},getSafeAreaRect(){const e=c.view,t=B_.safeAreaEdge,n=B_.windowSize,i=new Ii(t.left,t.bottom),o=new Ii(n.width-t.right,n.height-t.top);e._convertToUISpace(i),e._convertToUISpace(o);const a=i.x,r=i.y,s=o.x-i.x,l=o.y-i.y;return new Bi(a,r,s,l)}});!function(){try{let e=U_.localStorage=window.localStorage;e.setItem("storage",""),e.removeItem("storage"),e=null}catch(e){const t=function(){w(5200)};U_.localStorage={getItem:t,setItem:t,clear:t,removeItem:t}}U_.__isWebIOS14OrIPadOS14Env=(U_.os===Jt.IOS||U_.os===Jt.OSX)&&nn.isBrowser&&/(OS 14)|(Version\/14)/.test(window.navigator.userAgent)}(),c.sys=U_;const G_=e("fG",Symbol("[[Serialize]]")),j_=e("fF",Symbol("[[Deserialize]]"));class V_{constructor(e,t){this._document=void 0,this._chunks=void 0,this._document=e,this._chunks=t}get document(){return this._document}get chunks(){return this._chunks}}function H_(e){const t=e;return{chunks:t.chunks,document:t.document}}function W_(e){if(e.length<16)throw new q_(M(13102));const t=new DataView(e.buffer,e.byteOffset,e.byteLength);if(1313817411!==t.getUint32(0,!0))throw new q_(M(13100));const n=t.getUint32(4,!0);if(1!==n)throw new q_(M(13101,n));if(t.getUint32(8,!0)!==t.byteLength)throw new q_(M(13102));let i=12;const o=t.getUint32(i,!0);i+=4;const a=new Uint8Array(t.buffer,i+t.byteOffset,o);i+=o;const r=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);if("Buffer"in globalThis){const{Buffer:t}=globalThis;return t.from(e.buffer,e.byteOffset,e.byteLength).toString()}throw new Error(M(13104))}(a);let s;try{s=JSON.parse(r)}catch(e){throw new q_(e)}const c=[];for(;i<t.byteLength;){i%8!=0&&(i+=8-i%8);const e=t.getUint32(i,!0);i+=4,c.push(new Uint8Array(t.buffer,i+t.byteOffset,e)),i+=e}if(i!==t.byteLength)throw new q_(M(13102));return new V_(s,c)}class q_ extends Error{}function Y_(e,t,n,i,o){if(t instanceof c.ValueType){o||e.push("if(prop){");const i=ie(t);e.push(`s._deserializeFastDefinedObject(o${n},prop,${i});`),o||e.push(`}else o${n}=null;`)}else e.push(`\nif (prop) {\n    s._deserializeAndAssignField(o, prop, ${i});\n} else {\n    o${n}=null;\n}\n`)}c.internal.parseCCONJson=H_,c.internal.decodeCCONBinary=W_,c.internal.CCON=V_;const X_="$_$type",Q_="$_$default",Z_="$_$formerlySerializedAs";class J_{constructor(e,t,n,i,o){this.deserializedList=void 0,this.deserializedData=void 0,this._ignoreEditorOnly=void 0,this.result=e,this.customEnv=i,this.deserializedList=[],this.deserializedData=null,this._classFinder=t,this._reportMissingClass=n,this._onDereferenced=null==t?void 0:t.onDereferenced}reset(e,t,n,i,o){this.result=e,this.customEnv=i,this._classFinder=t,this._reportMissingClass=n,this._onDereferenced=null==t?void 0:t.onDereferenced}clear(){this.result=null,this.customEnv=null,this.deserializedList.length=0,this.deserializedData=null,this._classFinder=null,this._reportMissingClass=null,this._onDereferenced=null}deserialize(e){let t,n=!1;e instanceof V_?(n=!0,t=e.document,e.chunks.length>0&&(e.chunks.length,this._mainBinChunk=e.chunks[0])):t=e,this._serializedData=t,this._context={fromCCON:n};const i=Array.isArray(t)?t[0]:t;return this.deserializedData=this._deserializeObject(i,0),this._serializedData=void 0,this._mainBinChunk=void 0,this._context=void 0,this.deserializedData}_deserializeObject(e,t,n,i){switch(e.__type__){case"TypedArray":return this._deserializeTypedArrayView(e);case"TypedArrayRef":return this._deserializeTypedArrayViewRef(e);default:return e.__type__?this._deserializeTypeTaggedObject(e,t,n,i):Array.isArray(e)?this._deserializeArray(e):this._deserializePlainObject(e)}}_deserializeTypedArrayView(e){return globalThis[e.ctor].from(e.array)}_deserializeTypedArrayViewRef(e){const{offset:t,length:n,ctor:i}=e;return new globalThis[i](this._mainBinChunk.buffer,this._mainBinChunk.byteOffset+t,n)}_deserializeArray(e){const t=new Array(e.length);let n;for(let i=0;i<e.length;i++)n=e[i],"object"==typeof n&&n?this._deserializeAndAssignField(t,n,`${i}`)&&(t[i]=null):t[i]=n;return t}_deserializePlainObject(e){const t={};return this._fillPlainObject(t,e),t}_deserializeTypeTaggedObject(e,t,n,i){const o=e.__type__,a=this._classFinder(o,e,n,i);if(!a)return this._classFinder===Pe&&this._reportMissingClass(o),null;{const n=(e=>{const n=new e;return t>=0&&(this.deserializedList[t]=n),n})(a);return this._deserializeInto(e,n,a),n}}_deserializeInto(e,t,n,i=!1){i||!t[j_]?t._deserialize?t._deserialize(e.content,this):c.Class._isCCClass(n)?this._deserializeFireClass(t,e,n):this._deserializeFastDefinedObject(t,e,n):this._runCustomizedDeserialize(e,t,n)}_runCustomizedDeserialize(e,t,n){const i={readProperty:t=>{const n=e[t];return"object"==typeof n&&n?this._deserializeObjectField(n):n},readThis:()=>{this._deserializeInto(e,t,n,!0)},readSuper:()=>{const i=de(n);i&&this._deserializeInto(e,t,i)}};t[j_](i,this._context)}_deserializeFireClass(e,t,n){let i;if(n.hasOwnProperty("__deserialize__"))i=n.__deserialize__;else{i=function(e,t){const n=st(t),i=t.__values__,o=["var prop;"],a=We.test(Ie(t));for(let e=0;e<i.length;e++){const t=i[e];let r,s;Rt.IDENTIFIER_RE.test(t)?(s=`"${t}"`,r=`.${t}`):(s=Rt.escapeForJS(t),r=`[${s}]`);let c=r;if(n[t+Z_]){const e=n[t+Z_];c=Rt.IDENTIFIER_RE.test(e)?`.${e}`:`[${Rt.escapeForJS(e)}]`}o.push(`prop=d${c};`),o.push('if(typeof (prop)!=="undefined"){');const l=Rt.getDefault(n[t+Q_]);if(a){let e;const i=n[t+X_];if(void 0===l&&i)e=i instanceof lt;else{const t=typeof l;e="string"===t||"number"===t||"boolean"===t}e?o.push(`o${r}=prop;`):Y_(o,l,r,s,!0)}else o.push(`if(typeof (prop)!=="object"){o${r}=prop;}else{`),Y_(o,l,r,s,!1),o.push("}");o.push("}")}return(c.js.isChildClassOf(t,c._BaseNode)||c.js.isChildClassOf(t,c.Component))&&o.push("d._id&&(o._id=d._id);"),"_$erialized"===i[i.length-1]&&(o.push("o._$erialized=JSON.parse(JSON.stringify(d));"),o.push("s._fillPlainObject(o._$erialized,d);")),Function("s","o","d","k",o.join(""))}(0,n);try{if(n===L_){const e=n.__values__;0!==e.length&&"_$erialized"===e[e.length-1]||(g("The '_$erialized' prop of MissingScript is missing. Will force the raw data to be save."),g(`    Error props: ['${e}']. Please contact jare.`));const t=i;i=function(e,n,i,o){try{JSON.parse(JSON.stringify(i._$erialized))||g(`Unable to load previously serialized data. ${JSON.stringify(i)}`)}catch(e){g(`Error when checking MissingScript 7, ${e}`)}t(e,n,i,o)}}}catch(e){g(`Error when checking MissingScript 6, ${e}`)}K(n,"__deserialize__",i,!0)}i(this,e,t,n)}_deserializeAndAssignField(e,t,n){const i=t.__id__;if("number"==typeof i){const t=this.deserializedList[i];if(t)e[n]=t;else{var o;const t=this._serializedData[i];e[n]=this._deserializeObject(t,i,void 0,n),null===(o=this._onDereferenced)||void 0===o||o.call(this,this.deserializedList,i,e,n)}}else{const i=t.__uuid__;if(i){const o=t.__expectedType__;this.result.push(e,n,i,o)}else e[n]=this._deserializeObject(t,-1)}return!1}_deserializeObjectField(e){const t=e.__id__;if("number"==typeof t){const e=this.deserializedList[t];if(e)return e;{const e=this._serializedData[t];return this._deserializeObject(e,t,void 0,void 0)}}if(e.__uuid__)throw e.__expectedType__,new Error("Asset reference field serialization is currently not supported in custom serialization.");return this._deserializeObject(e,-1)}_fillPlainObject(e,t){for(const n in t){if(!t.hasOwnProperty(n))continue;const i=t[n];"object"!=typeof i?"__type__"!==n&&(e[n]=i):i?this._deserializeAndAssignField(e,i,n)&&(e[n]=null):e[n]=null}}_deserializeFastDefinedObject(e,t,n){if(n===c.Vec2)return e.x=t.x||0,void(e.y=t.y||0);if(n===c.Vec3)return e.x=t.x||0,e.y=t.y||0,void(e.z=t.z||0);if(n===c.Color){e.r=t.r||0,e.g=t.g||0,e.b=t.b||0;const n=t.a;return void(e.a=void 0===n?255:n)}if(n===c.Size)return e.width=t.width||0,void(e.height=t.height||0);const i=st(n),o=n.__values__;for(let n=0;n<o.length;n++){const a=o[n];let r=t[a];void 0!==r||t.hasOwnProperty(a)||(r=Rt.getDefault(i[a+Q_])),"object"!=typeof r?e[a]=r:r?this._deserializeAndAssignField(e,r,a):e[a]=null}}}J_.pool=new class extends Re{constructor(){super((e=>{e.clear()}),1)}get(e,t,n,i,o){const a=this._get();return a?(a.reset(e,t,n,i,o),a):new J_(e,t,n,i,o)}};const K_=[Ii,_i,Oi,Ai,ri,Li,Bi,Ei];function $_(e,t){e.x=t[1],e.y=t[2],e.z=t[3],e.w=t[4]}const eu=[(e,t)=>{e.x=t[1],e.y=t[2]},(e,t)=>{e.x=t[1],e.y=t[2],e.z=t[3]},$_,$_,(e,t)=>{e._val=t[1]},(e,t)=>{e.width=t[1],e.height=t[2]},(e,t)=>{e.x=t[1],e.y=t[2],e.width=t[3],e.height=t[4]},(e,t)=>{Ei.fromArray(e,t,1)}];class tu{constructor(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}init(e){e?(this.uuidObjList=e[8],this.uuidPropList=e[9],this.uuidList=e[10]):this.uuidList||(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.uuidTypeList=[])}reset(){this.uuidList&&(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.uuidTypeList.length=0)}push(e,t,n,i){this.uuidObjList.push(e),this.uuidPropList.push(t),this.uuidList.push(n),this.uuidTypeList.push(i||"")}}function nu(e,t){const n=e[4][t[0]],i=n[0],o=new(0,i[0]),a=i[1],r=i[2],s=n[n.length-1];let c=1;for(;c<s;++c)o[a[n[c]]]=t[c];for(;c<t.length;++c){const s=a[n[c]],l=i[n[c]+r];(0,cu[l])(e,o,s,t[c])}return o}function iu(e,t,n){const i=new t;return i._deserialize?i._deserialize(n,e[0]):R(5303,ie(t)),i}function ou(e,t,n,i){i>=0?t[n]=e[5][i]:e[7][3*~i]=t}function au(e){return(t,n,i,o)=>{n[i]=o;for(let n=0;n<o.length;++n)e(t,o,n,o[n])}}function ru(e,t,n,i){t[n]=null,e[8][i]=t}function su(e,t,n,i){t[n]=nu(e,i)}e("fB",tu),tu.pool=new Re((e=>{e.reset()}),5),tu.pool.get=function(){return this._get()||new tu};const cu=new Array(13);function lu(e,t,n){return e||n(t),Object}function _u(e,t,n,i,o,a,r){let s=e(t);if(!s){if(o)return void(n[i]=(c=n,l=i,_=t,function(){const t=e(_)||lu(a,_,r);return c[l]=t,new t}));s=lu(a,t,r)}var c,l,_;n[i]=s}function uu(e,t,n,i){const o=n||Pe,a=e[3];for(let e=0;e<a.length;++e){const r=a[e];"string"!=typeof r?_u(o,r[0],r,0,t,n,i):_u(o,r,a,e,t,n,i)}}function hu(e){const t=e[4];if(t){const n=e[3];for(let e=0;e<t.length;++e){const i=t[e];i[0]=n[i[0]]}}}function fu(e,t,n){"string"==typeof e&&(e=JSON.parse(e));const i=!t;let o;if(t=t||tu.pool.get(),function(e){if(Array.isArray(e)){const t=e[0];return"number"==typeof t||t instanceof pu}return!1}(e)){t.init(e),n=n||{};let i=e[0],r=!1;if("object"==typeof i&&(r=i.preprocessed,i=i.version),i<1)throw new Error(M(5304,i));var a;n._version=i,n.result=t,e[0]=n,r||(uu(e,!1,n.classFinder,null!==(a=n.reportMissingClass)&&void 0!==a?a:fu.reportMissingClass),hu(e)),c.game._isCloning=!0;const s=e[5],l=function(e){const t=e[5],n=e[6],i=0===n?0:n.length;let o=t[t.length-1],a=t.length-i;"number"!=typeof o?o=0:(o<0&&(o=~o),--a);let r=0;for(;r<a;++r)t[r]=nu(e,t[r]);const s=e[3];for(let o=0;o<i;++o,++r){let i=n[o];const a=t[r];if(i>=0){const n=s[i];t[r]=iu(e,n,a)}else i=~i,(0,cu[i])(e,t,r,a)}return o}(e);c.game._isCloning=!1,e[7]&&function(e,t,n){const i=e.length-1;let o=0;const a=3*e[i];for(;o<a;o+=3){const i=e[o],a=t[e[o+2]],r=e[o+1];r>=0?i[n[r]]=a:i[~r]=a}for(;o<i;o+=3){const i=t[e[o]],a=t[e[o+2]],r=e[o+1];r>=0?i[n[r]]=a:i[~r]=a}}(e[7],s,e[2]),function(e){const t=e[5],n=e[2],i=e[1],o=e[8],a=e[9],r=e[10];for(let e=0;e<o.length;++e){const s=o[e];"number"==typeof s&&(o[e]=t[s]);let c=a[e];"number"==typeof c&&(c=c>=0?n[c]:~c,a[e]=c);const l=r[e];"number"==typeof l&&(r[e]=i[l])}}(e),o=s[l]}else o=function(e,t,n){var i;const o=(n=n||{}).classFinder||Pe,a=n.createAssetRefs||U_.platform===Kt.EDITOR_CORE,r=n.customEnv,s=n.ignoreEditorOnly,l=null!==(i=n.reportMissingClass)&&void 0!==i?i:c.deserialize.reportMissingClass;t.init();const _=J_.pool.get(t,o,l,r,s);c.game._isCloning=!0;const u=_.deserialize(e);return c.game._isCloning=!1,J_.pool.put(_),a&&t.assignAssetsBy(EditorExtends.serialize.asAsset),u}(e,t,n);return i&&tu.pool.put(t),o}cu[0]=function(e,t,n,i){t[n]=i},cu[1]=ou,cu[2]=au(ou),cu[3]=au(ru),cu[4]=su,cu[5]=function(e,t,n,i){eu[i[0]](t[n],i)},cu[6]=ru,cu[7]=function(e,t,n,i){t[n].set(i)},cu[8]=function(e,t,n,i){const o=new K_[i[0]];eu[i[0]](o,i),t[n]=o},cu[9]=au(su),cu[10]=function(e,t,n,i){const o=e[3][i[0]];t[n]=iu(e,o,i[1])},cu[11]=function(e,t,n,i){const o=i[0];t[n]=o;for(let t=1;t<i.length;t+=3){const n=i[t],a=i[t+1],r=i[t+2];(0,cu[a])(e,o,n,r)}},cu[12]=function(e,t,n,i){const o=i[0];t[n]=o;for(let t=0;t<o.length;++t){const n=o[t],a=i[t+1];0!==a&&(0,cu[a])(e,o,t,n)}},fu.Details=tu,fu.reportMissingClass=function(e){R(5302,e)};class pu{constructor(e){this.preprocessed=!0,this.version=e}}function du(e,t,n){return[1,0,0,[e],0,n?[t,-1]:[t],[0],0,[],[],[]]}c.deserialize=fu;const mu=Lt.Flags.Destroyed,Au=Lt.Flags.PersistentMask,vu=[];function gu(e){let t;if(e instanceof Lt){if(e._instantiate)return c.game._isCloning=!0,t=e._instantiate(null,!0),c.game._isCloning=!1,t;if(e instanceof c.Asset)throw new TypeError(M(6903))}return c.game._isCloning=!0,t=xu(e),c.game._isCloning=!1,t}function xu(e,t){let n;n=e._iN$t?e._iN$t:e.constructor?new(0,e.constructor):Object.create(null),yu(e,n,t);for(let e=0,t=vu.length;e<t;++e)vu[e]._iN$t=null;return vu.length=0,n}function yu(e,t,n){Ne.value(e,"_iN$t",t,!0),vu.push(e);const i=e.constructor;if(c.Class._isCCClass(i))!function(e,t,n,i){const o=e.__values__;for(let e=0;e<o.length;e++){const a=o[e],r=t[a];if("object"==typeof r&&r){const e=n[a];e instanceof Ve&&e.constructor===r.constructor?e.set(r):n[a]=r._iN$t||bu(r,i)}else n[a]=r}}(i,e,t,n);else for(const i in e){if(!e.hasOwnProperty(i)||95===i.charCodeAt(0)&&95===i.charCodeAt(1)&&"__type__"!==i&&"__prefab"!==i)continue;const o=e[i];if("object"==typeof o&&o){if(o===t)continue;t[i]=o._iN$t||bu(o,n)}else t[i]=o}e instanceof Lt&&(t._objFlags&=Au)}function bu(e,t){if(e instanceof Ve)return e.clone();if(e instanceof c.Asset)return e;let n;if(ArrayBuffer.isView(e)){const t=e.length;n=new e.constructor(t),e._iN$t=n,vu.push(e);for(let i=0;i<t;++i)n[i]=e[i];return n}if(Array.isArray(e)){const i=e.length;n=new Array(i),e._iN$t=n,vu.push(e);for(let o=0;o<i;++o){const i=e[o];n[o]="object"==typeof i&&i?i._iN$t||bu(i,t):i}return n}if(e._objFlags&mu)return null;const i=e.constructor;if(c.Class._isCCClass(i)){if(t)if(t instanceof c.Component){if(e instanceof c._BaseNode||e instanceof c.Component)return e}else if(t instanceof c._BaseNode)if(e instanceof c._BaseNode){if(!e.isChildOf(t))return e}else if(e instanceof c.Component&&e.node&&!e.node.isChildOf(t))return e;n=new i}else if(i===Object)n={};else{if(i)return e;n=Object.create(null)}return yu(e,n,t),n}var Su,Cu,Eu,Tu,Pu,wu,Iu,Ru;let Du,Nu;function Ou(e,t){return(t<<3)+e}function Mu(e){return Lu[e]}function zu(e){switch(e){case Du.Uint8:return Uint8Array;case Du.Uint16:return Uint16Array;case Du.Uint32:return Uint32Array;case Du.Int8:return Int8Array;case Du.Int16:return Int16Array;case Du.Int32:return Int32Array;case Du.Float32:return Float32Array;case Du.Float64:return Float64Array}}gu._clone=xu,c.instantiate=gu,function(e){e[e.Uint8=0]="Uint8",e[e.Uint16=1]="Uint16",e[e.Uint32=2]="Uint32",e[e.Int8=3]="Int8",e[e.Int16=4]="Int16",e[e.Int32=5]="Int32",e[e.Float32=6]="Float32",e[e.Float64=7]="Float64"}(Du||(Du={})),function(e){e[e.Scalar=0]="Scalar",e[e.Vec2=1]="Vec2",e[e.Vec3=2]="Vec3",e[e.Vec4=3]="Vec4",e[e.Quat=4]="Quat",e[e.Mat4=5]="Mat4"}(Nu||(Nu={})),e("fD",Uc("cc.CompactValueTypeArray")((Ru=Iu=class e{constructor(){Tc(this,"_byteOffset",Eu,this),Tc(this,"_unitCount",Tu,this),Tc(this,"_unitElement",Pu,this),Tc(this,"_length",wu,this)}static lengthFor(e,t,n){return Mu(t).requiredUnits*e.length*zu(n).BYTES_PER_ELEMENT}static compress(t,n,i,o,a,r){const s=Mu(n),c=zu(i),l=s.requiredUnits*t.length,_=new c(o,a,l);for(let e=0;e<t.length;++e)s.compress(_,e,t[e]);const u=new e;return u._unitElement=Ou(i,n),u._byteOffset=r,u._unitCount=l,u._length=t.length,u}decompress(e){const{storageUnit:t,elementType:n}={storageUnit:7&(i=this._unitElement),elementType:i>>3};var i;const o=Mu(n),a=new(zu(t))(e,this._byteOffset,this._unitCount),r=new Array(this._length);for(let e=0;e<this._length;++e)r[e]=o.decompress(a,e);return r}},Iu.StorageUnit=Du,Iu.ElementType=Nu,Eu=Pc((Cu=Ru).prototype,"_byteOffset",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Tu=Pc(Cu.prototype,"_unitCount",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Pu=Pc(Cu.prototype,"_unitElement",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ou(Du.Uint8,Nu.Scalar)}}),wu=Pc(Cu.prototype,"_length",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Su=Cu))||Su);const Lu={[Nu.Scalar]:{requiredUnits:1,compress(e,t,n){e[t]=n},decompress:(e,t)=>e[t]},[Nu.Vec2]:{requiredUnits:2,compress(e,t,n){e[2*t]=n.x,e[2*t+1]=n.y},decompress:(e,t)=>new _i(e[2*t],e[2*t+1])},[Nu.Vec3]:{requiredUnits:3,compress(e,t,n){e[3*t]=n.x,e[3*t+1]=n.y,e[3*t+2]=n.z},decompress:(e,t)=>new _i(e[3*t],e[3*t+1],e[3*t+2])},[Nu.Vec4]:{requiredUnits:4,compress(e,t,n){e[4*t]=n.x,e[4*t+1]=n.y,e[4*t+2]=n.z,e[4*t+3]=n.w},decompress:(e,t)=>new Oi(e[4*t],e[4*t+1],e[4*t+2],e[4*t+3])},[Nu.Quat]:{requiredUnits:4,compress(e,t,n){e[4*t]=n.x,e[4*t+1]=n.y,e[4*t+2]=n.z,e[4*t+3]=n.w},decompress:(e,t)=>new Ai(e[4*t],e[4*t+1],e[4*t+2],e[4*t+3])},[Nu.Mat4]:{requiredUnits:16,compress(e,t,n){Ei.toArray(e,n,16*t)},decompress:(e,t)=>Ei.fromArray(new Ei,e,16*t)}};function Fu(){return 0}function Bu(e){return e}function ku(e){return e*e}function Uu(e){return e*(2-e)}function Gu(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}function ju(e){return e*e*e}function Vu(e){return--e*e*e+1}function Hu(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}function Wu(e){return e*e*e*e}function qu(e){return 1- --e*e*e*e}function Yu(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}function Xu(e){return e*e*e*e*e}function Qu(e){return--e*e*e*e*e+1}function Zu(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}function Ju(e){return 1===e?1:1-Math.cos(e*Math.PI/2)}function Ku(e){return Math.sin(e*Math.PI/2)}function $u(e){return.5*(1-Math.cos(Math.PI*e))}function eh(e){return 0===e?0:Math.pow(1024,e-1)}function th(e){return 1===e?1:1-Math.pow(2,-10*e)}function nh(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}function ih(e){return 1-Math.sqrt(1-e*e)}function oh(e){return Math.sqrt(1- --e*e)}function ah(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}function rh(e){let t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4))}function sh(e){let t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/.4)+1)}function ch(e){let t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)*.5+1)}function lh(e){if(1===e)return 1;const t=1.70158;return e*e*((t+1)*e-t)}function _h(e){if(0===e)return 0;const t=1.70158;return--e*e*((t+1)*e+t)+1}function uh(e){const t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}function hh(e){return 1-fh(1-e)}function fh(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function ph(e){return e<.5?.5*hh(2*e):.5*fh(2*e-1)+.5}function dh(e){return e<=0?0:e>=1?1:e*e*(3-2*e)}function mh(e){return e<=0?0:e>=1?1:e*e*e*(e*(6*e-15)+10)}c._decorator=Dl;const Ah=Ph(ku,Uu),vh=Ph(ju,Vu),gh=Ph(Wu,qu),xh=Ph(Xu,Qu),yh=Ph(Ju,Ku),bh=Ph(eh,th),Sh=Ph(ih,oh),Ch=Ph(rh,sh),Eh=Ph(lh,_h),Th=Ph(hh,fh);function Ph(e,t){return n=>n<.5?t(2*n)/2:e(2*n-1)/2+.5}var wh=Object.freeze({__proto__:null,constant:Fu,linear:Bu,quadIn:ku,quadOut:Uu,quadInOut:Gu,cubicIn:ju,cubicOut:Vu,cubicInOut:Hu,quartIn:Wu,quartOut:qu,quartInOut:Yu,quintIn:Xu,quintOut:Qu,quintInOut:Zu,sineIn:Ju,sineOut:Ku,sineInOut:$u,expoIn:eh,expoOut:th,expoInOut:nh,circIn:ih,circOut:oh,circInOut:ah,elasticIn:rh,elasticOut:sh,elasticInOut:ch,backIn:lh,backOut:_h,backInOut:uh,bounceIn:hh,bounceOut:fh,bounceInOut:ph,smooth:dh,fade:mh,quadOutIn:Ah,cubicOutIn:vh,quartOutIn:gh,quintOutIn:xh,sineOutIn:yh,expoOutIn:bh,circOutIn:Sh,elasticOutIn:Ch,backOutIn:Eh,bounceOutIn:Th});let Ih;e("eG",wh),function(e){e[e.LINEAR=0]="LINEAR",e[e.CONSTANT=1]="CONSTANT",e[e.QUAD_IN=2]="QUAD_IN",e[e.QUAD_OUT=3]="QUAD_OUT",e[e.QUAD_IN_OUT=4]="QUAD_IN_OUT",e[e.QUAD_OUT_IN=5]="QUAD_OUT_IN",e[e.CUBIC_IN=6]="CUBIC_IN",e[e.CUBIC_OUT=7]="CUBIC_OUT",e[e.CUBIC_IN_OUT=8]="CUBIC_IN_OUT",e[e.CUBIC_OUT_IN=9]="CUBIC_OUT_IN",e[e.QUART_IN=10]="QUART_IN",e[e.QUART_OUT=11]="QUART_OUT",e[e.QUART_IN_OUT=12]="QUART_IN_OUT",e[e.QUART_OUT_IN=13]="QUART_OUT_IN",e[e.QUINT_IN=14]="QUINT_IN",e[e.QUINT_OUT=15]="QUINT_OUT",e[e.QUINT_IN_OUT=16]="QUINT_IN_OUT",e[e.QUINT_OUT_IN=17]="QUINT_OUT_IN",e[e.SINE_IN=18]="SINE_IN",e[e.SINE_OUT=19]="SINE_OUT",e[e.SINE_IN_OUT=20]="SINE_IN_OUT",e[e.SINE_OUT_IN=21]="SINE_OUT_IN",e[e.EXPO_IN=22]="EXPO_IN",e[e.EXPO_OUT=23]="EXPO_OUT",e[e.EXPO_IN_OUT=24]="EXPO_IN_OUT",e[e.EXPO_OUT_IN=25]="EXPO_OUT_IN",e[e.CIRC_IN=26]="CIRC_IN",e[e.CIRC_OUT=27]="CIRC_OUT",e[e.CIRC_IN_OUT=28]="CIRC_IN_OUT",e[e.CIRC_OUT_IN=29]="CIRC_OUT_IN",e[e.ELASTIC_IN=30]="ELASTIC_IN",e[e.ELASTIC_OUT=31]="ELASTIC_OUT",e[e.ELASTIC_IN_OUT=32]="ELASTIC_IN_OUT",e[e.ELASTIC_OUT_IN=33]="ELASTIC_OUT_IN",e[e.BACK_IN=34]="BACK_IN",e[e.BACK_OUT=35]="BACK_OUT",e[e.BACK_IN_OUT=36]="BACK_IN_OUT",e[e.BACK_OUT_IN=37]="BACK_OUT_IN",e[e.BOUNCE_IN=38]="BOUNCE_IN",e[e.BOUNCE_OUT=39]="BOUNCE_OUT",e[e.BOUNCE_IN_OUT=40]="BOUNCE_IN_OUT",e[e.BOUNCE_OUT_IN=41]="BOUNCE_OUT_IN",e[e.SMOOTH=42]="SMOOTH",e[e.FADE=43]="FADE"}(Ih||(Ih={}));const Rh={[Ih.CONSTANT]:Fu,[Ih.LINEAR]:Bu,[Ih.QUAD_IN]:ku,[Ih.QUAD_OUT]:Uu,[Ih.QUAD_IN_OUT]:Gu,[Ih.QUAD_OUT_IN]:Ah,[Ih.CUBIC_IN]:ju,[Ih.CUBIC_OUT]:Vu,[Ih.CUBIC_IN_OUT]:Hu,[Ih.CUBIC_OUT_IN]:vh,[Ih.QUART_IN]:Wu,[Ih.QUART_OUT]:qu,[Ih.QUART_IN_OUT]:Yu,[Ih.QUART_OUT_IN]:gh,[Ih.QUINT_IN]:Xu,[Ih.QUINT_OUT]:Qu,[Ih.QUINT_IN_OUT]:Zu,[Ih.QUINT_OUT_IN]:xh,[Ih.SINE_IN]:Ju,[Ih.SINE_OUT]:Ku,[Ih.SINE_IN_OUT]:$u,[Ih.SINE_OUT_IN]:yh,[Ih.EXPO_IN]:eh,[Ih.EXPO_OUT]:th,[Ih.EXPO_IN_OUT]:nh,[Ih.EXPO_OUT_IN]:bh,[Ih.CIRC_IN]:ih,[Ih.CIRC_OUT]:oh,[Ih.CIRC_IN_OUT]:ah,[Ih.CIRC_OUT_IN]:Sh,[Ih.ELASTIC_IN]:rh,[Ih.ELASTIC_OUT]:sh,[Ih.ELASTIC_IN_OUT]:ch,[Ih.ELASTIC_OUT_IN]:Ch,[Ih.BACK_IN]:lh,[Ih.BACK_OUT]:_h,[Ih.BACK_IN_OUT]:uh,[Ih.BACK_OUT_IN]:Eh,[Ih.BOUNCE_IN]:hh,[Ih.BOUNCE_OUT]:fh,[Ih.BOUNCE_IN_OUT]:ph,[Ih.BOUNCE_OUT_IN]:Th,[Ih.SMOOTH]:dh,[Ih.FADE]:mh};function Dh(e){return Rh[e]}var Nh,Oh,Mh,zh,Lh,Fh,Bh;class kh extends Rl{constructor(...e){super(...e),this.interpolationMode=El.LINEAR,this.tangentWeightMode=Pl.NONE,this.value=0,this.rightTangent=0,this.rightTangentWeight=0,this.leftTangent=0,this.leftTangentWeight=0,this.easingMethod=Ih.LINEAR}}function Uh(e){const t=new kh;if("number"==typeof e)t.value=e;else{const{interpolationMode:n,tangentWeightMode:i,value:o,rightTangent:a,rightTangentWeight:r,leftTangent:s,leftTangentWeight:c,easingMethod:l,[Ot]:_}=e;t.value=null!=o?o:t.value,t.rightTangent=null!=a?a:t.rightTangent,t.rightTangentWeight=null!=r?r:t.rightTangentWeight,t.leftTangent=null!=s?s:t.leftTangent,t.leftTangentWeight=null!=c?c:t.leftTangentWeight,t.interpolationMode=null!=n?n:t.interpolationMode,t.tangentWeightMode=null!=i?i:t.tangentWeightMode,t.easingMethod=null!=l?l:t.easingMethod,_&&(t[Ot]=_)}return t}Rt.fastDefine("cc.RealKeyframeValue",kh,{interpolationMode:El.LINEAR,tangentWeightMode:Pl.NONE,value:0,rightTangent:0,rightTangentWeight:0,leftTangent:0,leftTangentWeight:0,easingMethod:Ih.LINEAR}),Rt.Attr.setClassAttr(kh,Ot,"editorOnly",!0),(Lh=kh,null!==(Bh=(Fh=Lh)[Wc])&&void 0!==Bh?Bh:Fh[Wc]={}).uniquelyReferenced=!0;let Gh=e("dU",Uc("cc.RealCurve")((Mh=Pc((Oh=class extends wl{constructor(...e){super(...e),Tc(this,"preExtrapolation",Mh,this),Tc(this,"postExtrapolation",zh,this)}evaluate(e){const{_times:t,_values:n}=this,i=t.length;if(0===i)return 0;const o=t[0],a=t[i-1];if(e<o){const{preExtrapolation:r}=this,s=n[0];if(r===Tl.CLAMP||i<2)return s.value;switch(r){case Tl.LINEAR:return of(o,n[0].value,t[1],n[1].value,e);case Tl.LOOP:e=tf(e,o,a);break;case Tl.PING_PONG:e=nf(e,o,a);break;default:return s.value}}else if(e>a){const{postExtrapolation:r}=this,s=n[i-1];if(r===Tl.CLAMP||i<2)return s.value;switch(r){case Tl.LINEAR:return of(a,s.value,t[i-2],n[i-2].value,e);case Tl.LOOP:e=tf(e,o,a);break;case Tl.PING_PONG:e=nf(e,o,a);break;default:return s.value}}const r=Dc(t,e);if(r>=0)return n[r].value;const s=~r,c=s-1,l=t[c],_=n[c],u=t[s];return function(e,t,n,i,o){const a=n-e;switch(t.interpolationMode){default:case El.CONSTANT:return t.value;case El.LINEAR:{const e=t.easingMethod===Ih.LINEAR?o:Dh(t.easingMethod)(o);return Vn(t.value,i.value,e)}case El.CUBIC:{const r=1/3,{rightTangent:s,rightTangentWeight:c}=t,l=0!=(t.tangentWeightMode&Pl.RIGHT),{leftTangent:_,leftTangentWeight:u}=i,h=0!=(i.tangentWeightMode&Pl.LEFT);if(l||h){let f=0;if(l)f=c;else{const e=a,t=a*s;f=Math.sqrt(e*e+t*t)*r}const p=Math.atan(s),d=Math.cos(p)*f+e,m=Math.sin(p)*f+t.value;let A=0;if(h)A=u;else{const e=a,t=a*_;A=Math.sqrt(e*e+t*t)*r}const v=Math.atan(_),g=(d-e)/a,x=(-Math.cos(v)*A+n-e)/a,y=m,b=-Math.sin(v)*A+i.value,S=[0,0,0],C=function(e,t,n,i,o){const a=n/i,r=t/i,s=a*a,c=1/3*(-1/3*s+r),l=.5*(2/27*a*s-1/3*a*r+e/i),_=c*c*c,u=l*l+_;let h=0;if(Il(u)){if(Il(l))return o[0]=0,1;{const e=Math.cbrt(-l);return o[0]=2*e,o[1]=-e,2}}if(u<0){const e=1/3*Math.acos(-l/Math.sqrt(-_)),t=2*Math.sqrt(-c);o[0]=t*Math.cos(e),o[1]=-t*Math.cos(e+Math.PI/3),o[2]=-t*Math.cos(e-Math.PI/3),h=3}else{const e=Math.sqrt(u),t=Math.cbrt(e-l),n=-Math.cbrt(e+l);o[0]=t+n,h=1}const f=1/3*a;for(let e=0;e<h;++e)o[e]-=f;return h}(0-o,3*g,3*x-6*g,3*(g-x)+1,S),E=function(e,t,n){let i=n;if(1===t)i=e[0];else{i=-1/0;for(let n=0;n<t;++n){const t=e[n];t>=0&&t<=1&&t>i&&(i=t)}i===-1/0&&(i=0)}return i}(S,C,o);return af(t.value,y,b,i.value,E)}{const e=t.value+r*s*a,n=i.value-r*_*a;return af(t.value,e,n,i.value,o)}}}}(l,_,u,n[s],(e-l)/(u-l))}addKeyFrame(e,t){return super.addKeyFrame(e,Uh(t))}assignSorted(e,t){if(void 0!==t)this.setKeyframes(e.slice(),t.map((e=>Uh(e))));else{const t=Array.from(e);this.setKeyframes(t.map((([e])=>e)),t.map((([,e])=>Uh(e))))}}isConstant(e){if(this._values.length<=1)return!0;const t=this._values[0].value;return this._values.every((n=>Un(n.value,t,e)))}[G_](e,t){if(!t.toCCON)return void e.writeThis();const{_times:n,_values:i}=this,o=n.length,a=new DataView(new ArrayBuffer(0+Vh+Vh+Hh+Wh*o+Kh*o));let r=0;a.setUint8(r,this.preExtrapolation),r+=Vh,a.setUint8(r,this.postExtrapolation),r+=Vh,a.setUint32(r,o,!0),r+=Hh,n.forEach(((e,t)=>a.setFloat32(r+Wh*t,e,!0))),r+=Wh*o;for(const e of i)r=$h(a,e,r);const s=new Uint8Array(a.buffer,0,r);e.writeProperty("bytes",s);const c=i.map((e=>e[Ot]));c.some((e=>void 0!==e))&&e.writeProperty("keyframeValueEditorExtras",c)}[j_](e,t){if(!t.fromCCON)return void e.readThis();const n=e.readProperty("bytes"),i=new DataView(n.buffer,n.byteOffset,n.byteLength);let o=0;this.preExtrapolation=i.getUint8(o),o+=Vh,this.postExtrapolation=i.getUint8(o),o+=Vh;const a=i.getUint32(o,!0);o+=Hh;const r=Array.from({length:a},((e,t)=>i.getFloat32(o+Wh*t,!0)));o+=Wh*a;const s=new Array(a);for(let e=0;e<a;++e){const t=Uh({});o=ef(i,t,o),s[e]=t}n.byteLength;const c=e.readProperty("keyframeValueEditorExtras");c&&(c.length,c.forEach(((e,t)=>s[t][Ot]=e))),this._times=r,this._values=s}}).prototype,"preExtrapolation",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Tl.CLAMP}}),zh=Pc(Oh.prototype,"postExtrapolation",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Tl.CLAMP}}),Nh=Oh))||Nh);var jh;!function(e){e[e.VALUE=1]="VALUE",e[e.INTERPOLATION_MODE=2]="INTERPOLATION_MODE",e[e.TANGENT_WEIGHT_MODE=4]="TANGENT_WEIGHT_MODE",e[e.LEFT_TANGENT=8]="LEFT_TANGENT",e[e.LEFT_TANGENT_WEIGHT=16]="LEFT_TANGENT_WEIGHT",e[e.RIGHT_TANGENT=32]="RIGHT_TANGENT",e[e.RIGHT_TANGENT_WEIGHT=64]="RIGHT_TANGENT_WEIGHT"}(jh||(jh={}));const Vh=1,Hh=4,Wh=4,{interpolationMode:qh,tangentWeightMode:Yh,leftTangent:Xh,leftTangentWeight:Qh,rightTangent:Zh,rightTangentWeight:Jh}=Uh({}),Kh=26;function $h(e,t,n){let i=0,o=n;const a=o;o+=4;const{value:r,interpolationMode:s,tangentWeightMode:c,rightTangent:l,rightTangentWeight:_,leftTangent:u,leftTangentWeight:h,easingMethod:f}=t;return e.setFloat32(o,r,!0),o+=4,s!==qh&&(i|=jh.INTERPOLATION_MODE,e.setUint8(o,s),o+=1),c!==Yh&&(i|=jh.TANGENT_WEIGHT_MODE,e.setUint8(o,c),o+=1),u!==Xh&&(i|=jh.LEFT_TANGENT,e.setFloat32(o,u,!0),o+=4),h!==Qh&&(i|=jh.LEFT_TANGENT_WEIGHT,e.setFloat32(o,h,!0),o+=4),l!==Zh&&(i|=jh.RIGHT_TANGENT,e.setFloat32(o,l,!0),o+=4),_!==Jh&&(i|=jh.RIGHT_TANGENT_WEIGHT,e.setFloat32(o,_,!0),o+=4),i|=f<<8,e.setUint32(a,i,!0),o}function ef(e,t,n){let i=n;const o=e.getUint32(i,!0);i+=4,t.value=e.getFloat32(i,!0),i+=4,o&jh.INTERPOLATION_MODE&&(t.interpolationMode=e.getUint8(i),i+=1),o&jh.TANGENT_WEIGHT_MODE&&(t.tangentWeightMode=e.getUint8(i),i+=1),o&jh.LEFT_TANGENT&&(t.leftTangent=e.getFloat32(i,!0),i+=4),o&jh.LEFT_TANGENT_WEIGHT&&(t.leftTangentWeight=e.getFloat32(i,!0),i+=4),o&jh.RIGHT_TANGENT&&(t.rightTangent=e.getFloat32(i,!0),i+=4),o&jh.RIGHT_TANGENT_WEIGHT&&(t.rightTangentWeight=e.getFloat32(i,!0),i+=4);const a=(65280&o)>>8;return t.easingMethod=a,i}function tf(e,t,n){return t+$n(e-t,n-t)}function nf(e,t,n){return t+ei(e-t,n-t)}function of(e,t,n,i,o){return t+(i-t)/(n-e)*(o-e)}function af(e,t,n,i,o){const a=1-o;return a*a*a*e+3*a*a*o*t+3*a*o*o*n+o*o*o*i}function rf(e,t,n,i,o){const a=1-o;return a*(a*(e+(3*t-e)*o)+3*n*o*o)+i*o*o*o}c.bezier=rf;const sf=Math.cos,cf=Math.acos,lf=Math.max,_f=2*Math.PI,uf=Math.sqrt;function hf(e){return e<0?-Math.pow(-e,1/3):Math.pow(e,1/3)}function ff(e,t){const n=function(e,t){const n=t-0,i=t-e[0],o=3*n,a=3*i,r=3*(t-e[2]),s=1/(-n+a-r+(t-1)),c=1/3,l=(o-6*i+r)*s,_=l*c,u=(-o+a)*s,h=(3*u-l*l)*c,f=h*c,p=(2*l*l*l-9*l*u+n*s*27)/27,d=p/2,m=d*d+f*f*f;let A,v,g,x,y;if(m<0){const e=-h*c,t=uf(e*e*e),n=-p/(2*t),i=cf(n<-1?-1:n>1?1:n),o=2*hf(t);return g=o*sf(i*c)-_,x=o*sf((i+_f)*c)-_,y=o*sf((i+2*_f)*c)-_,g>=0&&g<=1?x>=0&&x<=1?y>=0&&y<=1?lf(g,x,y):lf(g,x):y>=0&&y<=1?lf(g,y):g:x>=0&&x<=1?y>=0&&y<=1?lf(x,y):x:y}if(0===m)return A=d<0?hf(-d):-hf(d),g=2*A-_,x=-A-_,g>=0&&g<=1?x>=0&&x<=1?lf(g,x):g:x;{const e=uf(m);return A=hf(-d+e),v=hf(d+e),g=A-v-_,g}}(e,t),i=e[1];return((1-n)*(i+(e[3]-i)*n)*3+n*n)*n}var pf,df,mf,Af,vf,gf,xf,yf,bf;let Sf;c.bezierByTime=ff,function(e){e[e.SLERP=0]="SLERP",e[e.CONSTANT=1]="CONSTANT"}(Sf||(Sf=e("gH",{})));let Cf=Uc("cc.QuatKeyframeValue")(pf=Zc((mf=Pc((df=class{constructor({value:e,interpolationMode:t,easingMethod:n}={}){Tc(this,"interpolationMode",mf,this),Tc(this,"value",Af,this),Tc(this,"easingMethod",vf,this),this.value=e?Ai.clone(e):this.value,this.interpolationMode=null!=t?t:this.interpolationMode,this.easingMethod=null!=n?n:this.easingMethod}}).prototype,"interpolationMode",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sf.SLERP}}),Af=Pc(df.prototype,"value",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ai.clone(Ai.IDENTITY)}}),vf=Pc(df.prototype,"easingMethod",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ih.LINEAR}}),pf=df))||pf)||pf;function Ef(e){return new Cf(e)}let Tf=e("gG",Uc("cc.QuatCurve")((yf=Pc((xf=class extends wl{constructor(...e){super(...e),Tc(this,"preExtrapolation",yf,this),Tc(this,"postExtrapolation",bf,this)}evaluate(e,t){var n;null!==(n=t)&&void 0!==n||(t=new Ai);const{_times:i,_values:o,postExtrapolation:a,preExtrapolation:r}=this,s=i.length;if(0===s)return t;const c=i[0],l=i[s-1];if(e<c){const n=o[0];switch(r){case Tl.LOOP:e=c+$n(e-c,l-c);break;case Tl.PING_PONG:e=c+ei(e-c,l-c);break;case Tl.CLAMP:default:return Ai.copy(t,n.value)}}else if(e>l){const n=o[s-1];switch(a){case Tl.LOOP:e=c+$n(e-c,l-c);break;case Tl.PING_PONG:e=c+ei(e-c,l-c);break;case Tl.CLAMP:default:return Ai.copy(t,n.value)}}const _=Dc(i,e);if(_>=0)return Ai.copy(t,o[_].value);const u=~_,h=u-1,f=i[h],p=o[h],d=i[u],m=o[u],A=(e-f)/(d-f);switch(p.interpolationMode){default:case Sf.CONSTANT:return Ai.copy(t,p.value);case Sf.SLERP:{const{easingMethod:e}=p,n=e===Ih.LINEAR?A:Array.isArray(e)?ff(e,A):Dh(e)(A);return Ai.slerp(t,p.value,m.value,n)}}}addKeyFrame(e,t){const n=new Cf(t);return super.addKeyFrame(e,n)}assignSorted(e,t){if(void 0!==t)this.setKeyframes(e.slice(),t.map((e=>Ef(e))));else{const t=Array.from(e);this.setKeyframes(t.map((([e])=>e)),t.map((([,e])=>Ef(e))))}}[G_](e,t){if(!t.toCCON)return void e.writeThis();const{_times:n,_values:i}=this;let o=!0;i.forEach(((e,t,[n])=>{o&&e.interpolationMode!==n.interpolationMode&&(o=!1)}));const a=n.length,r=Nf*(o?1:a),s=i.reduce(((e,{easingMethod:t})=>e+(Array.isArray(t)?Of+4*zf:Of)),0);let c=0;c+=wf+If+Rf*a+4*Df*a+s+r+0;const l=new DataView(new ArrayBuffer(c));let _=0,u=0;o&&(u|=Pf.INTERPOLATION_MODE),l.setUint32(_,u,!0),_+=wf,l.setUint32(_,a,!0),_+=If,n.forEach(((e,t)=>l.setFloat32(_+Rf*t,e,!0))),_+=Rf*a,i.forEach((({value:{x:e,y:t,z:n,w:i}},o)=>{const a=_+4*Df*o;l.setFloat32(a+0*Df,e,!0),l.setFloat32(a+1*Df,t,!0),l.setFloat32(a+2*Df,n,!0),l.setFloat32(a+3*Df,i,!0)})),_+=4*Df*a,i.forEach((({easingMethod:e})=>{Array.isArray(e)?(l.setUint8(_,Mf),++_,l.setFloat32(_+0*zf,e[0],!0),l.setFloat32(_+1*zf,e[1],!0),l.setFloat32(_+2*zf,e[2],!0),l.setFloat32(_+3*zf,e[3],!0),_+=4*zf):(l.setUint8(_,e),++_)}));const h=_;_+=r;let f=h;i.forEach((({interpolationMode:e})=>{l.setUint8(f,e),o||(f+=Nf)}));const p=new Uint8Array(l.buffer);e.writeProperty("bytes",p)}[j_](e,t){if(!t.fromCCON)return void e.readThis();const n=e.readProperty("bytes"),i=new DataView(n.buffer,n.byteOffset,n.byteLength);let o=0;const a=i.getUint32(o,!0);o+=wf;const r=a&Pf.INTERPOLATION_MODE,s=i.getUint32(o,!0);o+=If;const c=Array.from({length:s},((e,t)=>i.getFloat32(o+Rf*t,!0)));o+=Rf*s;const l=o;o+=4*Df*s;const _=Array.from({length:s},((e,t)=>{const n=l+4*Df*t,a=i.getFloat32(n+0*Df,!0),r=i.getFloat32(n+1*Df,!0),s=i.getFloat32(n+2*Df,!0),c=i.getFloat32(n+3*Df,!0),_=i.getUint8(o);++o;const u=Ef({value:{x:a,y:r,z:s,w:c}});return _!==Mf?u.easingMethod=_:(u.easingMethod=[i.getFloat32(o+0*zf,!0),i.getFloat32(o+1*zf,!0),i.getFloat32(o+2*zf,!0),i.getFloat32(o+3*zf,!0)],o+=4*zf),u}));if(r){const e=i.getUint8(o);++o;for(let t=0;t<s;++t)_[t].interpolationMode=e}else{for(let e=0;e<s;++e){const t=i.getUint8(o+e);_[e].interpolationMode=t}o+=s}this._times=c,this._values=_}}).prototype,"preExtrapolation",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Tl.CLAMP}}),bf=Pc(xf.prototype,"postExtrapolation",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Tl.CLAMP}}),gf=xf))||gf);var Pf;!function(e){e[e.INTERPOLATION_MODE=1]="INTERPOLATION_MODE"}(Pf||(Pf={}));const wf=1,If=4,Rf=4,Df=4,Nf=1,Of=1,Mf=255,zf=4;var Lf;let Ff=e("gI",Uc("cc.ObjectCurve")(Lf=class extends wl{evaluate(e){const t=this.searchKeyframe(e);if(t>=0)return this._values[t];const n=Gn(~t-1,0,this._values.length-1);return this._values[n]}})||Lf);var Bf,kf,Uf,Gf,jf;class Vf{constructor(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0}}Rt.fastDefine("cc.Keyframe",Vf,{time:0,value:0,inTangent:0,outTangent:0});class Hf{constructor(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}evaluate(e){return t=e-this.time,n=this.coefficient,t*(t*(t*n[0]+n[1])+n[2])+n[3];var t,n}}let Wf=e("dV",Uc("cc.AnimationCurve")((jf=Gf=class{get _internalCurve(){return this._curve}get keyFrames(){return Array.from(this._curve.keyframes()).map((([e,t])=>{const n=new Vf;return n.time=e,n.value=t.value,n.inTangent=t.leftTangent,n.outTangent=t.rightTangent,n}))}set keyFrames(e){this._curve.assignSorted(e.map((e=>[e.time,{interpolationMode:El.CUBIC,value:e.value,leftTangent:e.inTangent,rightTangent:e.outTangent}])))}get preWrapMode(){return Yf(this._curve.preExtrapolation)}set preWrapMode(e){this._curve.preExtrapolation=qf(e)}get postWrapMode(){return Yf(this._curve.postExtrapolation)}set postWrapMode(e){this._curve.postExtrapolation=qf(e)}constructor(e=null){if(Tc(this,"_curve",Uf,this),this.cachedKey=void 0,e instanceof Gh)this._curve=e;else{const t=new Gh;this._curve=t,t.preExtrapolation=Tl.LOOP,t.postExtrapolation=Tl.CLAMP,e?t.assignSorted(e.map((e=>[e.time,{interpolationMode:El.CUBIC,value:e.value,leftTangent:e.inTangent,rightTangent:e.outTangent}]))):t.assignSorted([[0,{interpolationMode:El.CUBIC,value:1}],[1,{interpolationMode:El.CUBIC,value:1}]])}this.cachedKey=new Hf}addKey(e){e?this._curve.addKeyFrame(e.time,{interpolationMode:El.CUBIC,value:e.value,leftTangent:e.inTangent,rightTangent:e.outTangent}):this._curve.clear()}evaluate_slow(e){return this._curve.evaluate(e)}evaluate(e){const{cachedKey:t,_curve:n}=this,i=n.keyFramesCount-1;let o=e;const a=e<0?n.preExtrapolation:n.postExtrapolation,r=n.getKeyframeTime(0),s=n.getKeyframeTime(i);switch(a){case Tl.LOOP:o=$n(e-r,s-r)+r;break;case Tl.PING_PONG:o=ei(e-r,s-r)+r;break;case Tl.CLAMP:default:o=Gn(e,r,s)}if(o>=t.time&&o<t.endTime)return t.evaluate(o);const c=this.findIndex(t,o),l=Math.min(c+1,i);return this.calcOptimizedKey(t,c,l),t.evaluate(o)}calcOptimizedKey(e,t,n){const i=this._curve.getKeyframeTime(t),o=this._curve.getKeyframeTime(n),{value:a,leftTangent:r}=this._curve.getKeyframeValue(t),{value:s,rightTangent:c}=this._curve.getKeyframeValue(n);e.index=t,e.time=i,e.endTime=o;const l=o-i,_=s-a,u=1/(l*l),h=r*l,f=c*l;e.coefficient[0]=(h+f-_-_)*u/l,e.coefficient[1]=(_+_+_-h-h-f)*u,e.coefficient[2]=r,e.coefficient[3]=a}findIndex(e,t){const{_curve:n}=this,i=n.keyFramesCount,o=e.index;if(-1!==o)if(t>n.getKeyframeTime(o))for(let e=0;e<3;e++){const a=o+e;if(a+1<i&&n.getKeyframeTime(a+1)>t)return a}else for(let e=0;e<3;e++){const i=o-e;if(i>=0&&n.getKeyframeTime(i-1)<=t)return i-1}let a,r=0,s=i;for(;s-r>1;)a=Math.floor((r+s)/2),n.getKeyframeTime(a)>=t?s=a:r=a;return r}},Gf.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],Uf=Pc((kf=jf).prototype,"_curve",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bf=kf))||Bf);function qf(e){switch(e){default:case wc.Default:case wc.Normal:case wc.Clamp:return Tl.CLAMP;case wc.PingPong:return Tl.PING_PONG;case wc.Loop:return Tl.LOOP}}function Yf(e){switch(e){default:case Tl.LINEAR:case Tl.CLAMP:return wc.Clamp;case Tl.PING_PONG:return wc.PingPong;case Tl.LOOP:return wc.Loop}}function Xf(e,t){console.warn(`${e} is deprecated, please use ${t} instead.`)}Pn(Gs,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var Qf=Object.freeze({__proto__:null,distance:Co,enums:Eo,intersect:Gs,Line:To,Plane:qs,Ray:Po,Triangle:Mo,Sphere:Oo,AABB:dc,OBB:gc,Capsule:xc,Frustum:Ec,Keyframe:Vf,AnimationCurve:Wf,get ERaycastMode(){return is},line:class extends To{constructor(){super(),Xf("line","Line")}},plane:class extends qs{constructor(){super(),Xf("plane","Plane")}},ray:class extends Po{constructor(){super(),Xf("ray","Ray")}},triangle:class extends Mo{constructor(){super(),Xf("triangle","Triangle")}},sphere:class extends Oo{constructor(){super(),Xf("sphere","Sphere")}},aabb:class extends dc{constructor(){super(),Xf("aabb","AABB")}},obb:class extends gc{constructor(){super(),Xf("obb","OBB")}},capsule:class extends xc{constructor(){super(),Xf("capsule","Capsule")}},frustum:class extends Ec{constructor(){super(),Xf("frustum","Frustum")}}});e("f5",Qf);const Zf={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295};class Jf{static makeMaskInclude(e){let t=0;for(const n of e)t|=n;return t}static makeMaskExclude(e){return~Jf.makeMaskInclude(e)}static addLayer(e,t){if(void 0===t)return void console.warn("bitNum can't be undefined");if(t>19||t<0)return void console.warn("maximum layers reached.");const n=1<<t;Jf.Enum[e],M(2104,e),Jf.Enum[e]=n,Ne.value(Jf.Enum,String(n),e),Jf.BitMask[e]=n,Ne.value(Jf.BitMask,String(n),e)}static deleteLayer(e){if(e>19||e<0)return void console.warn("do not change buildin layers.");const t=1<<e;delete Jf.Enum[Jf.Enum[t]],delete Jf.Enum[t],delete Jf.BitMask[Jf.BitMask[t]],delete Jf.BitMask[t]}static nameToLayer(e){return void 0===e?(console.warn("name can't be undefined"),-1):bn(Jf.Enum[e])}static layerToName(e){return e>31||e<0?(console.warn("Unable to access unknown layer."),""):Jf.Enum[1<<e]}}let Kf,$f;e("dh",Jf),Jf.Enum=ke(Zf),Jf.BitMask=Fe({...Zf}),c.Layers=Jf,function(e){e[e.DEFAULT=100]="DEFAULT",e[e.UI=200]="UI"}(Kf||(Kf={})),c.RenderPassStage=Kf,function(e){e[e.MIN=0]="MIN",e[e.MAX=255]="MAX",e[e.DEFAULT=128]="DEFAULT"}($f||($f=e("dg",{})));const ep={bindings:[],layouts:{}},tp={bindings:[],layouts:{}};let np;!function(e){e[e.UBO_GLOBAL=0]="UBO_GLOBAL",e[e.UBO_CAMERA=1]="UBO_CAMERA",e[e.UBO_SHADOW=2]="UBO_SHADOW",e[e.SAMPLER_SHADOWMAP=3]="SAMPLER_SHADOWMAP",e[e.SAMPLER_ENVIRONMENT=4]="SAMPLER_ENVIRONMENT",e[e.SAMPLER_SPOT_LIGHTING_MAP=5]="SAMPLER_SPOT_LIGHTING_MAP",e[e.SAMPLER_DIFFUSEMAP=6]="SAMPLER_DIFFUSEMAP",e[e.COUNT=7]="COUNT"}(np||(np={}));const ip=np.SAMPLER_SHADOWMAP,op=np.COUNT-ip;let ap;!function(e){e[e.UBO_LOCAL=0]="UBO_LOCAL",e[e.UBO_FORWARD_LIGHTS=1]="UBO_FORWARD_LIGHTS",e[e.UBO_SKINNING_ANIMATION=2]="UBO_SKINNING_ANIMATION",e[e.UBO_SKINNING_TEXTURE=3]="UBO_SKINNING_TEXTURE",e[e.UBO_MORPH=4]="UBO_MORPH",e[e.UBO_UI_LOCAL=5]="UBO_UI_LOCAL",e[e.SAMPLER_JOINTS=6]="SAMPLER_JOINTS",e[e.SAMPLER_MORPH_POSITION=7]="SAMPLER_MORPH_POSITION",e[e.SAMPLER_MORPH_NORMAL=8]="SAMPLER_MORPH_NORMAL",e[e.SAMPLER_MORPH_TANGENT=9]="SAMPLER_MORPH_TANGENT",e[e.SAMPLER_LIGHTMAP=10]="SAMPLER_LIGHTMAP",e[e.SAMPLER_SPRITE=11]="SAMPLER_SPRITE",e[e.SAMPLER_REFLECTION=12]="SAMPLER_REFLECTION",e[e.STORAGE_REFLECTION=13]="STORAGE_REFLECTION",e[e.COUNT=14]="COUNT"}(ap||(ap=e("dw",{})));const rp=ap.SAMPLER_JOINTS,sp=ap.COUNT-rp;let cp;!function(e){e[e.GLOBAL=0]="GLOBAL",e[e.MATERIAL=1]="MATERIAL",e[e.LOCAL=2]="LOCAL"}(cp||(cp={}));const lp=new La;lp.bufferOffsets=[0,ip+rp,ip],lp.samplerOffsets=[-ip,op+sp,op-rp],lp.flexibleSet=1;class _p{}_p.TIME_OFFSET=0,_p.NATIVE_SIZE_OFFSET=_p.TIME_OFFSET+4,_p.SCREEN_SIZE_OFFSET=_p.NATIVE_SIZE_OFFSET+4,_p.COUNT=_p.SCREEN_SIZE_OFFSET+4,_p.SIZE=4*_p.COUNT,_p.NAME="CCGlobal",_p.BINDING=np.UBO_GLOBAL,_p.DESCRIPTOR=new pr(_p.BINDING,va.UNIFORM_BUFFER,1,ra.ALL),_p.LAYOUT=new Xa(cp.GLOBAL,_p.BINDING,_p.NAME,[new Ya("cc_time",Vo.FLOAT4,1),new Ya("cc_screenSize",Vo.FLOAT4,1),new Ya("cc_nativeSize",Vo.FLOAT4,1)],1),ep.layouts[_p.NAME]=_p.LAYOUT,ep.bindings[_p.BINDING]=_p.DESCRIPTOR;class up{}up.MAT_VIEW_OFFSET=0,up.MAT_VIEW_INV_OFFSET=up.MAT_VIEW_OFFSET+16,up.MAT_PROJ_OFFSET=up.MAT_VIEW_INV_OFFSET+16,up.MAT_PROJ_INV_OFFSET=up.MAT_PROJ_OFFSET+16,up.MAT_VIEW_PROJ_OFFSET=up.MAT_PROJ_INV_OFFSET+16,up.MAT_VIEW_PROJ_INV_OFFSET=up.MAT_VIEW_PROJ_OFFSET+16,up.CAMERA_POS_OFFSET=up.MAT_VIEW_PROJ_INV_OFFSET+16,up.SCREEN_SCALE_OFFSET=up.CAMERA_POS_OFFSET+4,up.EXPOSURE_OFFSET=up.SCREEN_SCALE_OFFSET+4,up.MAIN_LIT_DIR_OFFSET=up.EXPOSURE_OFFSET+4,up.MAIN_LIT_COLOR_OFFSET=up.MAIN_LIT_DIR_OFFSET+4,up.AMBIENT_SKY_OFFSET=up.MAIN_LIT_COLOR_OFFSET+4,up.AMBIENT_GROUND_OFFSET=up.AMBIENT_SKY_OFFSET+4,up.GLOBAL_FOG_COLOR_OFFSET=up.AMBIENT_GROUND_OFFSET+4,up.GLOBAL_FOG_BASE_OFFSET=up.GLOBAL_FOG_COLOR_OFFSET+4,up.GLOBAL_FOG_ADD_OFFSET=up.GLOBAL_FOG_BASE_OFFSET+4,up.NEAR_FAR_OFFSET=up.GLOBAL_FOG_ADD_OFFSET+4,up.VIEW_PORT_OFFSET=up.NEAR_FAR_OFFSET+4,up.COUNT=up.VIEW_PORT_OFFSET+4,up.SIZE=4*up.COUNT,up.NAME="CCCamera",up.BINDING=np.UBO_CAMERA,up.DESCRIPTOR=new pr(up.BINDING,va.UNIFORM_BUFFER,1,ra.ALL),up.LAYOUT=new Xa(cp.GLOBAL,up.BINDING,up.NAME,[new Ya("cc_matView",Vo.MAT4,1),new Ya("cc_matViewInv",Vo.MAT4,1),new Ya("cc_matProj",Vo.MAT4,1),new Ya("cc_matProjInv",Vo.MAT4,1),new Ya("cc_matViewProj",Vo.MAT4,1),new Ya("cc_matViewProjInv",Vo.MAT4,1),new Ya("cc_cameraPos",Vo.FLOAT4,1),new Ya("cc_screenScale",Vo.FLOAT4,1),new Ya("cc_exposure",Vo.FLOAT4,1),new Ya("cc_mainLitDir",Vo.FLOAT4,1),new Ya("cc_mainLitColor",Vo.FLOAT4,1),new Ya("cc_ambientSky",Vo.FLOAT4,1),new Ya("cc_ambientGround",Vo.FLOAT4,1),new Ya("cc_fogColor",Vo.FLOAT4,1),new Ya("cc_fogBase",Vo.FLOAT4,1),new Ya("cc_fogAdd",Vo.FLOAT4,1),new Ya("cc_nearFar",Vo.FLOAT4,1),new Ya("cc_viewPort",Vo.FLOAT4,1)],1),ep.layouts[up.NAME]=up.LAYOUT,ep.bindings[up.BINDING]=up.DESCRIPTOR;class hp{}hp.MAT_LIGHT_PLANE_PROJ_OFFSET=0,hp.MAT_LIGHT_VIEW_OFFSET=hp.MAT_LIGHT_PLANE_PROJ_OFFSET+16,hp.MAT_LIGHT_VIEW_PROJ_OFFSET=hp.MAT_LIGHT_VIEW_OFFSET+16,hp.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET=hp.MAT_LIGHT_VIEW_PROJ_OFFSET+16,hp.SHADOW_PROJ_DEPTH_INFO_OFFSET=hp.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+4,hp.SHADOW_PROJ_INFO_OFFSET=hp.SHADOW_PROJ_DEPTH_INFO_OFFSET+4,hp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET=hp.SHADOW_PROJ_INFO_OFFSET+4,hp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET=hp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+4,hp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET=hp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+4,hp.SHADOW_COLOR_OFFSET=hp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+4,hp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET=hp.SHADOW_COLOR_OFFSET+4,hp.COUNT=hp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+4,hp.SIZE=4*hp.COUNT,hp.NAME="CCShadow",hp.BINDING=np.UBO_SHADOW,hp.DESCRIPTOR=new pr(hp.BINDING,va.UNIFORM_BUFFER,1,ra.ALL),hp.LAYOUT=new Xa(cp.GLOBAL,hp.BINDING,hp.NAME,[new Ya("cc_matLightPlaneProj",Vo.MAT4,1),new Ya("cc_matLightView",Vo.MAT4,1),new Ya("cc_matLightViewProj",Vo.MAT4,1),new Ya("cc_shadowInvProjDepthInfo",Vo.FLOAT4,1),new Ya("cc_shadowProjDepthInfo",Vo.FLOAT4,1),new Ya("cc_shadowProjInfo",Vo.FLOAT4,1),new Ya("cc_shadowNFLSInfo",Vo.FLOAT4,1),new Ya("cc_shadowWHPBInfo",Vo.FLOAT4,1),new Ya("cc_shadowLPNNInfo",Vo.FLOAT4,1),new Ya("cc_shadowColor",Vo.FLOAT4,1),new Ya("cc_planarNDInfo",Vo.FLOAT4,1)],1),ep.layouts[hp.NAME]=hp.LAYOUT,ep.bindings[hp.BINDING]=hp.DESCRIPTOR;const fp=np.SAMPLER_SHADOWMAP,pp=new pr(fp,va.SAMPLER_TEXTURE,1,ra.FRAGMENT),dp=new Qa(cp.GLOBAL,fp,"cc_shadowMap",Vo.SAMPLER2D,1);ep.layouts.cc_shadowMap=dp,ep.bindings[fp]=pp;const mp=np.SAMPLER_ENVIRONMENT,Ap=new pr(mp,va.SAMPLER_TEXTURE,1,ra.FRAGMENT),vp=new Qa(cp.GLOBAL,mp,"cc_environment",Vo.SAMPLER_CUBE,1);ep.layouts.cc_environment=vp,ep.bindings[mp]=Ap;const gp=np.SAMPLER_DIFFUSEMAP,xp=new pr(gp,va.SAMPLER_TEXTURE,1,ra.FRAGMENT),yp=new Qa(cp.GLOBAL,gp,"cc_diffuseMap",Vo.SAMPLER_CUBE,1);ep.layouts.cc_diffuseMap=yp,ep.bindings[gp]=xp;const bp=np.SAMPLER_SPOT_LIGHTING_MAP,Sp=new pr(bp,va.SAMPLER_TEXTURE,1,ra.FRAGMENT),Cp=new Qa(cp.GLOBAL,bp,"cc_spotLightingMap",Vo.SAMPLER2D,1);ep.layouts.cc_spotLightingMap=Cp,ep.bindings[bp]=Sp;class Ep{}e("dx",Ep),Ep.MAT_WORLD_OFFSET=0,Ep.MAT_WORLD_IT_OFFSET=Ep.MAT_WORLD_OFFSET+16,Ep.LIGHTINGMAP_UVPARAM=Ep.MAT_WORLD_IT_OFFSET+16,Ep.COUNT=Ep.LIGHTINGMAP_UVPARAM+4,Ep.SIZE=4*Ep.COUNT,Ep.NAME="CCLocal",Ep.BINDING=ap.UBO_LOCAL,Ep.DESCRIPTOR=new pr(Ep.BINDING,va.UNIFORM_BUFFER,1,ra.VERTEX|ra.COMPUTE),Ep.LAYOUT=new Xa(cp.LOCAL,Ep.BINDING,Ep.NAME,[new Ya("cc_matWorld",Vo.MAT4,1),new Ya("cc_matWorldIT",Vo.MAT4,1),new Ya("cc_lightingMapUVParam",Vo.FLOAT4,1)],1),tp.layouts[Ep.NAME]=Ep.LAYOUT,tp.bindings[Ep.BINDING]=Ep.DESCRIPTOR;class Tp{}Tp.WORLD_BOUND_CENTER=0,Tp.WORLD_BOUND_HALF_EXTENTS=Tp.WORLD_BOUND_CENTER+4,Tp.COUNT=Tp.WORLD_BOUND_HALF_EXTENTS+4,Tp.SIZE=4*Tp.COUNT,Tp.NAME="CCWorldBound",Tp.BINDING=ap.UBO_LOCAL,Tp.DESCRIPTOR=new pr(Tp.BINDING,va.UNIFORM_BUFFER,1,ra.VERTEX|ra.COMPUTE),Tp.LAYOUT=new Xa(cp.LOCAL,Tp.BINDING,Tp.NAME,[new Ya("cc_worldBoundCenter",Vo.FLOAT4,1),new Ya("cc_worldBoundHalfExtents",Vo.FLOAT4,1)],1),tp.layouts[Tp.NAME]=Tp.LAYOUT,tp.bindings[Tp.BINDING]=Tp.DESCRIPTOR;class Pp{}Pp.BATCHING_COUNT=10,Pp.MAT_WORLDS_OFFSET=0,Pp.COUNT=16*Pp.BATCHING_COUNT,Pp.SIZE=4*Pp.COUNT,Pp.NAME="CCLocalBatched",Pp.BINDING=ap.UBO_LOCAL,Pp.DESCRIPTOR=new pr(Pp.BINDING,va.UNIFORM_BUFFER,1,ra.VERTEX|ra.COMPUTE),Pp.LAYOUT=new Xa(cp.LOCAL,Pp.BINDING,Pp.NAME,[new Ya("cc_matWorlds",Vo.MAT4,Pp.BATCHING_COUNT)],1),tp.layouts[Pp.NAME]=Pp.LAYOUT,tp.bindings[Pp.BINDING]=Pp.DESCRIPTOR;class wp{}wp.LIGHTS_PER_PASS=1,wp.LIGHT_POS_OFFSET=0,wp.LIGHT_COLOR_OFFSET=wp.LIGHT_POS_OFFSET+4*wp.LIGHTS_PER_PASS,wp.LIGHT_SIZE_RANGE_ANGLE_OFFSET=wp.LIGHT_COLOR_OFFSET+4*wp.LIGHTS_PER_PASS,wp.LIGHT_DIR_OFFSET=wp.LIGHT_SIZE_RANGE_ANGLE_OFFSET+4*wp.LIGHTS_PER_PASS,wp.COUNT=wp.LIGHT_DIR_OFFSET+4*wp.LIGHTS_PER_PASS,wp.SIZE=4*wp.COUNT,wp.NAME="CCForwardLight",wp.BINDING=ap.UBO_FORWARD_LIGHTS,wp.DESCRIPTOR=new pr(wp.BINDING,va.DYNAMIC_UNIFORM_BUFFER,1,ra.FRAGMENT),wp.LAYOUT=new Xa(cp.LOCAL,wp.BINDING,wp.NAME,[new Ya("cc_lightPos",Vo.FLOAT4,wp.LIGHTS_PER_PASS),new Ya("cc_lightColor",Vo.FLOAT4,wp.LIGHTS_PER_PASS),new Ya("cc_lightSizeRangeAngle",Vo.FLOAT4,wp.LIGHTS_PER_PASS),new Ya("cc_lightDir",Vo.FLOAT4,wp.LIGHTS_PER_PASS)],1),tp.layouts[wp.NAME]=wp.LAYOUT,tp.bindings[wp.BINDING]=wp.DESCRIPTOR;class Ip{}e("cA",Ip),Ip.JOINTS_TEXTURE_INFO_OFFSET=0,Ip.COUNT=Ip.JOINTS_TEXTURE_INFO_OFFSET+4,Ip.SIZE=4*Ip.COUNT,Ip.NAME="CCSkinningTexture",Ip.BINDING=ap.UBO_SKINNING_TEXTURE,Ip.DESCRIPTOR=new pr(Ip.BINDING,va.UNIFORM_BUFFER,1,ra.VERTEX),Ip.LAYOUT=new Xa(cp.LOCAL,Ip.BINDING,Ip.NAME,[new Ya("cc_jointTextureInfo",Vo.FLOAT4,1)],1),tp.layouts[Ip.NAME]=Ip.LAYOUT,tp.bindings[Ip.BINDING]=Ip.DESCRIPTOR;class Rp{}e("cr",Rp),Rp.JOINTS_ANIM_INFO_OFFSET=0,Rp.COUNT=Rp.JOINTS_ANIM_INFO_OFFSET+4,Rp.SIZE=4*Rp.COUNT,Rp.NAME="CCSkinningAnimation",Rp.BINDING=ap.UBO_SKINNING_ANIMATION,Rp.DESCRIPTOR=new pr(Rp.BINDING,va.UNIFORM_BUFFER,1,ra.VERTEX),Rp.LAYOUT=new Xa(cp.LOCAL,Rp.BINDING,Rp.NAME,[new Ya("cc_jointAnimInfo",Vo.FLOAT4,1)],1),tp.layouts[Rp.NAME]=Rp.LAYOUT,tp.bindings[Rp.BINDING]=Rp.DESCRIPTOR,e("cC","a_jointAnimInfo");class Dp{}e("cy",Dp),Dp.JOINTS_OFFSET=0,Dp.COUNT=Dp.JOINTS_OFFSET+360,Dp.SIZE=4*Dp.COUNT,Dp.NAME="CCSkinning",Dp.BINDING=ap.UBO_SKINNING_TEXTURE,Dp.DESCRIPTOR=new pr(Dp.BINDING,va.UNIFORM_BUFFER,1,ra.VERTEX),Dp.LAYOUT=new Xa(cp.LOCAL,Dp.BINDING,Dp.NAME,[new Ya("cc_joints",Vo.FLOAT4,90)],1),tp.layouts[Dp.NAME]=Dp.LAYOUT,tp.bindings[Dp.BINDING]=Dp.DESCRIPTOR;class Np{}Np.MAX_MORPH_TARGET_COUNT=60,Np.OFFSET_OF_WEIGHTS=0,Np.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=4*Np.MAX_MORPH_TARGET_COUNT,Np.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=Np.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH+4,Np.OFFSET_OF_VERTICES_COUNT=Np.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT+4,Np.COUNT_BASE_4_BYTES=4*Math.ceil(Np.MAX_MORPH_TARGET_COUNT/4)+4,Np.SIZE=4*Np.COUNT_BASE_4_BYTES,Np.NAME="CCMorph",Np.BINDING=ap.UBO_MORPH,Np.DESCRIPTOR=new pr(Np.BINDING,va.UNIFORM_BUFFER,1,ra.VERTEX),Np.LAYOUT=new Xa(cp.LOCAL,Np.BINDING,Np.NAME,[new Ya("cc_displacementWeights",Vo.FLOAT4,Np.MAX_MORPH_TARGET_COUNT/4),new Ya("cc_displacementTextureInfo",Vo.FLOAT4,1)],1),tp.layouts[Np.NAME]=Np.LAYOUT,tp.bindings[Np.BINDING]=Np.DESCRIPTOR;class Op{}Op.NAME="CCUILocal",Op.BINDING=ap.UBO_UI_LOCAL,Op.DESCRIPTOR=new pr(Op.BINDING,va.DYNAMIC_UNIFORM_BUFFER,1,ra.VERTEX),Op.LAYOUT=new Xa(cp.LOCAL,Op.BINDING,Op.NAME,[new Ya("cc_local_data",Vo.FLOAT4,1)],1),tp.layouts[Op.NAME]=Op.LAYOUT,tp.bindings[Op.BINDING]=Op.DESCRIPTOR;const Mp=e("cB",ap.SAMPLER_JOINTS),zp=new pr(Mp,va.SAMPLER_TEXTURE,1,ra.VERTEX),Lp=new Qa(cp.LOCAL,Mp,"cc_jointTexture",Vo.SAMPLER2D,1);tp.layouts.cc_jointTexture=Lp,tp.bindings[Mp]=zp;const Fp=ap.SAMPLER_MORPH_POSITION,Bp=new pr(Fp,va.SAMPLER_TEXTURE,1,ra.VERTEX),kp=new Qa(cp.LOCAL,Fp,"cc_PositionDisplacements",Vo.SAMPLER2D,1);tp.layouts.cc_PositionDisplacements=kp,tp.bindings[Fp]=Bp;const Up=ap.SAMPLER_MORPH_NORMAL,Gp=new pr(Up,va.SAMPLER_TEXTURE,1,ra.VERTEX),jp=new Qa(cp.LOCAL,Up,"cc_NormalDisplacements",Vo.SAMPLER2D,1);tp.layouts.cc_NormalDisplacements=jp,tp.bindings[Up]=Gp;const Vp=ap.SAMPLER_MORPH_TANGENT,Hp=new pr(Vp,va.SAMPLER_TEXTURE,1,ra.VERTEX),Wp=new Qa(cp.LOCAL,Vp,"cc_TangentDisplacements",Vo.SAMPLER2D,1);tp.layouts.cc_TangentDisplacements=Wp,tp.bindings[Vp]=Hp;const qp=ap.SAMPLER_LIGHTMAP,Yp=new pr(qp,va.SAMPLER_TEXTURE,1,ra.FRAGMENT),Xp=new Qa(cp.LOCAL,qp,"cc_lightingMap",Vo.SAMPLER2D,1);tp.layouts.cc_lightingMap=Xp,tp.bindings[qp]=Yp;const Qp=ap.SAMPLER_SPRITE,Zp=new pr(Qp,va.SAMPLER_TEXTURE,1,ra.FRAGMENT),Jp=new Qa(cp.LOCAL,Qp,"cc_spriteTexture",Vo.SAMPLER2D,1);tp.layouts.cc_spriteTexture=Jp,tp.bindings[Qp]=Zp;const Kp=ap.SAMPLER_REFLECTION,$p=new pr(Kp,va.SAMPLER_TEXTURE,1,ra.FRAGMENT),ed=new Qa(cp.LOCAL,Kp,"cc_reflectionTexture",Vo.SAMPLER2D,1);tp.layouts.cc_reflectionTexture=ed,tp.bindings[Kp]=$p;const td=ap.STORAGE_REFLECTION,nd=new pr(td,va.STORAGE_IMAGE,1,ra.COMPUTE),id=new Ka(cp.LOCAL,td,"cc_reflectionStorage",Vo.IMAGE2D,1);tp.layouts.cc_reflectionStorage=id,tp.bindings[td]=nd;const od=Jf.makeMaskExclude([Jf.BitMask.UI_2D,Jf.BitMask.GIZMOS,Jf.BitMask.EDITOR,Jf.BitMask.SCENE_GIZMO,Jf.BitMask.PROFILER]);function ad(e){return e.hasFeature(Uo.COLOR_FLOAT)&&e.hasFeature(Uo.TEXTURE_FLOAT)&&!(e.gfxAPI===Bo.WEBGL)}let rd,sd,cd,ld,_d;Jf.makeMaskExclude([Jf.BitMask.UI_2D,Jf.BitMask.PROFILER]),Jf.Enum.ALL,function(e){e[e.VERTICAL=0]="VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL"}(rd||(rd={})),function(e){e[e.ORTHO=0]="ORTHO",e[e.PERSPECTIVE=1]="PERSPECTIVE"}(sd||(sd={})),function(e){e[e.F1_8=0]="F1_8",e[e.F2_0=1]="F2_0",e[e.F2_2=2]="F2_2",e[e.F2_5=3]="F2_5",e[e.F2_8=4]="F2_8",e[e.F3_2=5]="F3_2",e[e.F3_5=6]="F3_5",e[e.F4_0=7]="F4_0",e[e.F4_5=8]="F4_5",e[e.F5_0=9]="F5_0",e[e.F5_6=10]="F5_6",e[e.F6_3=11]="F6_3",e[e.F7_1=12]="F7_1",e[e.F8_0=13]="F8_0",e[e.F9_0=14]="F9_0",e[e.F10_0=15]="F10_0",e[e.F11_0=16]="F11_0",e[e.F13_0=17]="F13_0",e[e.F14_0=18]="F14_0",e[e.F16_0=19]="F16_0",e[e.F18_0=20]="F18_0",e[e.F20_0=21]="F20_0",e[e.F22_0=22]="F22_0"}(cd||(cd={})),function(e){e[e.ISO100=0]="ISO100",e[e.ISO200=1]="ISO200",e[e.ISO400=2]="ISO400",e[e.ISO800=3]="ISO800"}(ld||(ld={})),function(e){e[e.D1=0]="D1",e[e.D2=1]="D2",e[e.D4=2]="D4",e[e.D8=3]="D8",e[e.D15=4]="D15",e[e.D30=5]="D30",e[e.D60=6]="D60",e[e.D125=7]="D125",e[e.D250=8]="D250",e[e.D500=9]="D500",e[e.D1000=10]="D1000",e[e.D2000=11]="D2000",e[e.D4000=12]="D4000"}(_d||(_d={}));const ud=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],hd=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],fd=[100,200,400,800],pd=new _i,dd=new _i,md=new Ei,Ad=ba.STENCIL<<1,vd=[];class gd{constructor(e){if(this.isWindowSize=!0,this.screenScale=void 0,this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=rd.VERTICAL,this._fov=Hn(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new za(.2,.2,.2,1),this._viewport=new Bi(0,0,1,1),this._orientedViewport=new Bi(0,0,1,1),this._curTransform=ko.IDENTITY,this._isProjDirty=!0,this._matView=new Ei,this._matProj=new Ei,this._matProjInv=new Ei,this._matViewProj=new Ei,this._matViewProjInv=new Ei,this._frustum=new Ec,this._forward=new _i,this._position=new _i,this._priority=0,this._aperture=cd.F16_0,this._apertureValue=void 0,this._shutter=_d.D125,this._shutterValue=0,this._iso=ld.ISO100,this._isoValue=0,this._ec=0,this._window=null,this._width=1,this._height=1,this._clearFlag=ba.NONE,this._clearDepth=1,this._visibility=od,this._exposure=0,this._clearStencil=0,this._device=e,this._apertureValue=ud[this._aperture],this._shutterValue=hd[this._shutter],this._isoValue=fd[this._iso],this._aspect=this.screenScale=1,this._frustum.accurate=!0,!vd.length){const t=e.capabilities.clipSpaceSignY;vd[ko.IDENTITY]=new Ei(1,0,0,0,0,t),vd[ko.ROTATE_90]=new Ei(0,1,0,0,-t,0),vd[ko.ROTATE_180]=new Ei(-1,0,0,0,0,-t),vd[ko.ROTATE_270]=new Ei(0,-1,0,0,t,0)}}_setWidth(e){this._width=e,this._nativeObj.width=e}_setHeight(e){this._height=e,this._nativeObj.height=e}_setScene(e){this._scene=e,this._nativeObj.scene=e?e.native:null}_updateAspect(e=!0){if(this._aspect=this.window.width*this._viewport.width/(this.window.height*this._viewport.height),e){const e=this.window.swapchain;(e&&e.surfaceTransform||ko.IDENTITY)%2&&(this._aspect=1/this._aspect)}this._isProjDirty=!0,this._nativeObj.aspect=this._aspect}_init(e){this._nativeObj=new to,this._scene&&(this._nativeObj.scene=this._scene.native),this._nativeObj.frustum=this._frustum}static get standardExposureValue(){return 1/38400}static get standardLightMeterScale(){return 1e4}initialize(e){this._init(e),this.node=e.node,this._setWidth(1),this._setHeight(1),this.clearFlag=ba.NONE,this.clearDepth=1,this.visibility=od,this._name=e.name,this._proj=e.projection,this._priority=e.priority||0,this._aspect=this.screenScale=1,this.updateExposure(),this.changeTargetWindow(e.window)}_destroy(){this._nativeObj=null}destroy(){this._window&&(this._window.detachCamera(this),this.window=null),this._name=null,this._destroy()}attachToScene(e){this._enabled=!0,this._setScene(e)}detachFromScene(){this._enabled=!1,this._setScene(null)}resize(e,t){this._window&&(this._setWidth(e),this._setHeight(t),this._updateAspect())}setFixedSize(e,t){this._setWidth(e),this._setHeight(t),this._updateAspect(!1),this.isWindowSize=!1}syncCameraEditor(e){}update(e=!1){var t;if(!this._node)return;let n=!1;(this._node.hasChangedFlags||e)&&(Ei.invert(this._matView,this._node.worldMatrix),this._nativeObj.matView=this._matView,this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,this._node.getWorldPosition(this._position),this._nativeObj.position=this._position,this._nativeObj.forward=this._forward,n=!0);const i=null===(t=this.window)||void 0===t?void 0:t.swapchain,o=i&&i.surfaceTransform||ko.IDENTITY;if(this._isProjDirty||this._curTransform!==o){this._curTransform=o;const e=this._device.capabilities.clipSpaceSignY;if(this._proj===sd.PERSPECTIVE)Ei.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===rd.VERTICAL,this._device.capabilities.clipSpaceMinZ,e,o);else{const t=this._orthoHeight*this._aspect,n=this._orthoHeight;Ei.ortho(this._matProj,-t,t,-n,n,this._nearClip,this._farClip,this._device.capabilities.clipSpaceMinZ,e,o)}this._nativeObj.aspect=this._aspect,Ei.invert(this._matProjInv,this._matProj),this._nativeObj.matProj=this._matProj,this._nativeObj.matProjInv=this._matProjInv,n=!0,this._isProjDirty=!1}n&&(Ei.multiply(this._matViewProj,this._matProj,this._matView),Ei.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv),this._nativeObj.matViewProj=this._matViewProj,this._nativeObj.matViewProjInv=this._matViewProjInv,this._nativeObj.frustum=this._frustum)}set node(e){this._node=e,this._nativeObj.node=this._node.native}get node(){return this._node}set enabled(e){this._enabled=e}get enabled(){return this._enabled}set orthoHeight(e){this._orthoHeight=e,this._isProjDirty=!0}get orthoHeight(){return this._orthoHeight}set projectionType(e){this._proj=e,this._isProjDirty=!0}get projectionType(){return this._proj}set fovAxis(e){this._fovAxis=e,this._isProjDirty=!0}get fovAxis(){return this._fovAxis}set fov(e){this._fov=e,this._nativeObj.fov=e,this._isProjDirty=!0}get fov(){return this._fov}set nearClip(e){this._nearClip=e,this._nativeObj.nearClip=this._nearClip,this._isProjDirty=!0}get nearClip(){return this._nearClip}set farClip(e){this._farClip=e,this._nativeObj.farClip=this._farClip,this._isProjDirty=!0}get farClip(){return this._farClip}set clearColor(e){this._clearColor.x=e.x,this._clearColor.y=e.y,this._clearColor.z=e.z,this._clearColor.w=e.w,this._nativeObj.clearColor=this._clearColor}get clearColor(){return this._clearColor}get viewport(){return this._viewport}set viewport(e){w(8302),this.setViewportInOrientedSpace(e)}setViewportInOrientedSpace(e){var t;const{x:n,width:i,height:o}=e,a=this._device.capabilities.screenSpaceSignY<0?1-e.y-o:e.y,r=null===(t=this.window)||void 0===t?void 0:t.swapchain;switch(r&&r.surfaceTransform||ko.IDENTITY){case ko.ROTATE_90:this._viewport.x=1-a-o,this._viewport.y=n,this._viewport.width=o,this._viewport.height=i;break;case ko.ROTATE_180:this._viewport.x=1-n-i,this._viewport.y=1-a-o,this._viewport.width=i,this._viewport.height=o;break;case ko.ROTATE_270:this._viewport.x=a,this._viewport.y=1-n-i,this._viewport.width=o,this._viewport.height=i;break;case ko.IDENTITY:this._viewport.x=n,this._viewport.y=a,this._viewport.width=i,this._viewport.height=o}this._orientedViewport.x=n,this._orientedViewport.y=a,this._orientedViewport.width=i,this._orientedViewport.height=o,this._nativeObj.viewPort=this._viewport,this.resize(this.width,this.height)}get scene(){return this._scene}get name(){return this._name}get width(){return this._width}get height(){return this._height}get aspect(){return this._aspect}get matView(){return this._matView}get matProj(){return this._matProj}get matProjInv(){return this._matProjInv}get matViewProj(){return this._matViewProj}get matViewProjInv(){return this._matViewProjInv}set frustum(e){this._frustum=e,this._nativeObj.frustum=this._frustum}get frustum(){return this._frustum}set window(e){this._window=e,e&&(this._nativeObj.window=this._window.native)}get window(){return this._window}set forward(e){this._forward=e,this._nativeObj.forward=this._forward}get forward(){return this._forward}set position(e){this._position=e,this._nativeObj.position=this._position}get position(){return this._position}set visibility(e){this._visibility=e,this._nativeObj.visibility=this._visibility}get visibility(){return this._visibility}get priority(){return this._priority}set priority(e){this._priority=e}set aperture(e){this._aperture=e,this._apertureValue=ud[this._aperture],this.updateExposure()}get aperture(){return this._aperture}get apertureValue(){return this._apertureValue}set shutter(e){this._shutter=e,this._shutterValue=hd[this._shutter],this.updateExposure()}get shutter(){return this._shutter}get shutterValue(){return this._shutterValue}set iso(e){this._iso=e,this._isoValue=fd[this._iso],this.updateExposure()}get iso(){return this._iso}get isoValue(){return this._isoValue}set ec(e){this._ec=e}get ec(){return this._ec}get exposure(){return this._exposure}get clearFlag(){return this._clearFlag}set clearFlag(e){this._clearFlag=e,this._nativeObj.clearFlag=e}get clearDepth(){return this._clearDepth}set clearDepth(e){this._clearDepth=e,this._nativeObj.clearDepth=e}get clearStencil(){return this._clearStencil}set clearStencil(e){this._clearStencil=e,this._nativeObj.clearStencil=e}get native(){return this._nativeObj}changeTargetWindow(e=null){this._window&&this._window.detachCamera(this);const t=e||c.director.root.mainWindow;if(t){t.attachCamera(this),this.window=t;const e=t.swapchain;(e&&e.surfaceTransform||ko.IDENTITY)%2?this.resize(t.height,t.width):this.resize(t.width,t.height)}}detachCamera(){this._window&&this._window.detachCamera(this)}screenPointToRay(e,t,n){if(!this._node)return null;const i=this.width,o=this.height,a=this._orientedViewport.x*i,r=this._orientedViewport.y*o,s=this._orientedViewport.width*i,c=this._orientedViewport.height*o,l=this._proj===sd.PERSPECTIVE,_=this._device.capabilities.clipSpaceSignY,u=Ci[this._curTransform];_i.set(pd,(t-a)/s*2-1,(n-r)/c*2-1,l?1:-1);const{x:h,y:f}=pd;return pd.x=h*u[0]+f*u[2]*_,pd.y=h*u[1]+f*u[3]*_,_i.transformMat4(l?pd:e.o,pd,this._matViewProjInv),l?(this._node.getWorldPosition(dd),Po.fromPoints(e,dd,pd)):_i.transformQuat(e.d,_i.FORWARD,this._node.worldRotation),e}screenToWorld(e,t){const n=this.width,i=this.height,o=this._orientedViewport.x*n,a=this._orientedViewport.y*i,r=this._orientedViewport.width*n,s=this._orientedViewport.height*i,c=this._device.capabilities.clipSpaceSignY,l=Ci[this._curTransform];if(this._proj===sd.PERSPECTIVE){_i.set(e,(t.x-o)/r*2-1,(t.y-a)/s*2-1,1);const{x:n,y:i}=e;e.x=n*l[0]+i*l[2]*c,e.y=n*l[1]+i*l[3]*c,_i.transformMat4(e,e,this._matViewProjInv),this._node&&this._node.getWorldPosition(pd),_i.lerp(e,pd,e,Vn(this._nearClip/this._farClip,1,t.z))}else{_i.set(e,(t.x-o)/r*2-1,(t.y-a)/s*2-1,2*t.z-1);const{x:n,y:i}=e;e.x=n*l[0]+i*l[2]*c,e.y=n*l[1]+i*l[3]*c,_i.transformMat4(e,e,this._matViewProjInv)}return e}worldToScreen(e,t){const n=this._device.capabilities.clipSpaceSignY,i=Ci[this._curTransform];_i.transformMat4(e,t,this._matViewProj);const{x:o,y:a}=e;e.x=o*i[0]+a*i[2]*n,e.y=o*i[1]+a*i[3]*n;const r=this.width,s=this.height,c=this._orientedViewport.x*r,l=this._orientedViewport.y*s,_=this._orientedViewport.width*r,u=this._orientedViewport.height*s;return e.x=c+.5*(e.x+1)*_,e.y=l+.5*(e.y+1)*u,e.z=.5*e.z+.5,e}worldMatrixToScreen(e,t,n,i){Ei.multiply(e,this._matViewProj,t),Ei.multiply(e,vd[this._curTransform],e);const o=n/2,a=i/2;return Ei.identity(md),Ei.transform(md,md,_i.set(pd,o,a,0)),Ei.scale(md,md,_i.set(pd,o,a,1)),Ei.multiply(e,md,e),e}setExposure(e){this._exposure=.833333/2**e,this._nativeObj.exposure=this._exposure}updateExposure(){const e=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);this.setExposure(e)}}e("cg",gd);let xd,yd,bd,Sd=1024;var Cd,Ed,Td,Pd;function wd(e){return!!(c.sys.hasFeature(c.sys.Feature.IMAGE_BITMAP)&&e instanceof ImageBitmap)}!function(e){e[e.RGB565=Go.R5G6B5]="RGB565",e[e.RGB5A1=Go.RGB5A1]="RGB5A1",e[e.RGBA4444=Go.RGBA4]="RGBA4444",e[e.RGB888=Go.RGB8]="RGB888",e[e.RGB32F=Go.RGB32F]="RGB32F",e[e.RGBA8888=Go.RGBA8]="RGBA8888",e[e.RGBA32F=Go.RGBA32F]="RGBA32F",e[e.A8=Go.A8]="A8",e[e.I8=Go.L8]="I8",e[e.AI8=Go.LA8]="AI8",e[e.RGB_PVRTC_2BPPV1=Go.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",e[e.RGBA_PVRTC_2BPPV1=Go.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",e[e.RGB_A_PVRTC_2BPPV1=Sd++]="RGB_A_PVRTC_2BPPV1",e[e.RGB_PVRTC_4BPPV1=Go.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",e[e.RGBA_PVRTC_4BPPV1=Go.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",e[e.RGB_A_PVRTC_4BPPV1=Sd++]="RGB_A_PVRTC_4BPPV1",e[e.RGB_ETC1=Go.ETC_RGB8]="RGB_ETC1",e[e.RGBA_ETC1=Sd++]="RGBA_ETC1",e[e.RGB_ETC2=Go.ETC2_RGB8]="RGB_ETC2",e[e.RGBA_ETC2=Go.ETC2_RGBA8]="RGBA_ETC2",e[e.RGBA_ASTC_4x4=Go.ASTC_RGBA_4X4]="RGBA_ASTC_4x4",e[e.RGBA_ASTC_5x4=Go.ASTC_RGBA_5X4]="RGBA_ASTC_5x4",e[e.RGBA_ASTC_5x5=Go.ASTC_RGBA_5X5]="RGBA_ASTC_5x5",e[e.RGBA_ASTC_6x5=Go.ASTC_RGBA_6X5]="RGBA_ASTC_6x5",e[e.RGBA_ASTC_6x6=Go.ASTC_RGBA_6X6]="RGBA_ASTC_6x6",e[e.RGBA_ASTC_8x5=Go.ASTC_RGBA_8X5]="RGBA_ASTC_8x5",e[e.RGBA_ASTC_8x6=Go.ASTC_RGBA_8X6]="RGBA_ASTC_8x6",e[e.RGBA_ASTC_8x8=Go.ASTC_RGBA_8X8]="RGBA_ASTC_8x8",e[e.RGBA_ASTC_10x5=Go.ASTC_RGBA_10X5]="RGBA_ASTC_10x5",e[e.RGBA_ASTC_10x6=Go.ASTC_RGBA_10X6]="RGBA_ASTC_10x6",e[e.RGBA_ASTC_10x8=Go.ASTC_RGBA_10X8]="RGBA_ASTC_10x8",e[e.RGBA_ASTC_10x10=Go.ASTC_RGBA_10X10]="RGBA_ASTC_10x10",e[e.RGBA_ASTC_12x10=Go.ASTC_RGBA_12X10]="RGBA_ASTC_12x10",e[e.RGBA_ASTC_12x12=Go.ASTC_RGBA_12X12]="RGBA_ASTC_12x12"}(xd||(xd=e("cL",{}))),function(e){e[e.REPEAT=ea.WRAP]="REPEAT",e[e.CLAMP_TO_EDGE=ea.CLAMP]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=ea.MIRROR]="MIRRORED_REPEAT",e[e.CLAMP_TO_BORDER=ea.BORDER]="CLAMP_TO_BORDER"}(yd||(yd=e("dX",{}))),function(e){e[e.NONE=$o.NONE]="NONE",e[e.LINEAR=$o.LINEAR]="LINEAR",e[e.NEAREST=$o.POINT]="NEAREST"}(bd||(bd=e("cK",{})));let Id=e("cQ",Uc("cc.ImageAsset")((Pd=Td=class e extends __{get _nativeAsset(){return this._nativeData}set _nativeAsset(e){e instanceof HTMLElement||wd(e)||(e.format=e.format||this._format),this.reset(e)}get data(){return this._nativeData&&!0!==(e=this._nativeData)._compressed&&(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||wd(e))?this._nativeData:this._nativeData&&this._nativeData._data;var e}get width(){return this._nativeData.width||this._width}get height(){return this._nativeData.height||this._height}get format(){return this._format}get isCompressed(){return this._format>=xd.RGB_ETC1&&this._format<=xd.RGBA_ASTC_12x12||this._format>=xd.RGB_A_PVRTC_2BPPV1&&this._format<=xd.RGBA_ETC1}get url(){return this.nativeUrl}constructor(e){super(),this._nativeData=void 0,this._exportedExts=void 0,this._format=xd.RGBA8888,this._width=0,this._height=0,this._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1},void 0!==e&&this.reset(e)}reset(e){wd(e)||e instanceof HTMLElement?this._nativeData=e:(this._nativeData=e,this._format=e.format)}destroy(){return this.data&&this.data instanceof HTMLImageElement?(this.data.src="",this._setRawAsset(""),this.data.destroy()):wd(this.data)&&this.data.close&&this.data.close(),super.destroy()}_serialize(){}_deserialize(t){let n="";"string"==typeof t?n=t:(this._width=t.w,this._height=t.h,n=t.fmt);const i=c.director.root?c.director.root.device:null,o=n.split("_");let a=Number.MAX_VALUE,r=this._format,s="";const l=c.macro.SUPPORT_TEXTURE_FORMATS;for(const t of o){const n=t.split("@"),o=parseInt(n[0],void 0),_=e.extnames[o]||n[0],u=l.indexOf(_);if(-1!==u&&u<a){const e=n[1]?parseInt(n[1]):this._format;if(!(".astc"!==_||i&&i.hasFeature(Uo.FORMAT_ASTC)))continue;if(!(".pvr"!==_||i&&i.hasFeature(Uo.FORMAT_PVRTC)))continue;if(!(e!==xd.RGB_ETC1&&e!==xd.RGBA_ETC1||i&&i.hasFeature(Uo.FORMAT_ETC1)))continue;if(!(e!==xd.RGB_ETC2&&e!==xd.RGBA_ETC2||i&&i.hasFeature(Uo.FORMAT_ETC2)))continue;if(".webp"===_&&!c.sys.hasFeature(c.sys.Feature.WEBP))continue;a=u,s=_,r=e}}s?(this._setRawAsset(s),this._format=r):w(3121)}initDefault(t){if(super.initDefault(t),e._sharedPlaceHolderCanvas)this.reset(e._sharedPlaceHolderCanvas);else{const t=document.createElement("canvas"),n=t.getContext("2d"),i=t.width=t.height=2;n.fillStyle="#ff00ff",n.fillRect(0,0,i,i),this.reset(t),e._sharedPlaceHolderCanvas=t}}validate(){return!!this.data}},Td.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],Td._sharedPlaceHolderCanvas=null,Pc((Ed=Pd).prototype,"_nativeAsset",[gl],Object.getOwnPropertyDescriptor(Ed.prototype,"_nativeAsset"),Ed.prototype),Cd=Ed))||Cd);var Rd,Dd,Nd,Od,Md,zd,Ld,Fd,Bd,kd,Ud,Gd;c.ImageAsset=Id,je(Go);const jd=new W("Tex");let Vd=e("d6",Uc("cc.TextureBase")((Gd=Ud=class extends __{get isCompressed(){return this._format>=xd.RGB_ETC1&&this._format<=xd.RGBA_ASTC_12x12||this._format>=xd.RGB_A_PVRTC_2BPPV1&&this._format<=xd.RGBA_ETC1}get width(){return this._width}get height(){return this._height}constructor(){super(),Tc(this,"_format",Nd,this),Tc(this,"_minFilter",Od,this),Tc(this,"_magFilter",Md,this),Tc(this,"_mipFilter",zd,this),Tc(this,"_wrapS",Ld,this),Tc(this,"_wrapT",Fd,this),Tc(this,"_wrapR",Bd,this),Tc(this,"_anisotropy",kd,this),this._width=1,this._height=1,this._id=void 0,this._samplerInfo=new qa,this._gfxSampler=null,this._gfxDevice=null,this._textureHash=0,this._id=jd.getNewId(),this._gfxDevice=this._getGFXDevice(),this._textureHash=Xr(this._id,666)}getId(){return this._id}getPixelFormat(){return this._format}getAnisotropy(){return this._anisotropy}setWrapMode(e,t,n){void 0===n&&(n=e),this._wrapS=e,this._samplerInfo.addressU=e,this._wrapT=t,this._samplerInfo.addressV=t,this._wrapR=n,this._samplerInfo.addressW=n,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))}setFilters(e,t){this._minFilter=e,this._samplerInfo.minFilter=e,this._magFilter=t,this._samplerInfo.magFilter=t,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))}setMipFilter(e){this._mipFilter=e,this._samplerInfo.mipFilter=e,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))}setAnisotropy(e){this._anisotropy=e,this._samplerInfo.maxAnisotropy=e,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))}destroy(){var e;const t=super.destroy();return t&&(null===(e=c.director.root)||void 0===e?void 0:e.batcher2D)&&c.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),t}getHash(){return this._textureHash}getGFXTexture(){return null}getSamplerInfo(){return this._samplerInfo}getGFXSampler(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo):R(9302)),this._gfxSampler}_serialize(e){return""}_deserialize(e,t){const n=e.split(",");n.unshift(""),n.length>=5&&(this.setFilters(parseInt(n[1]),parseInt(n[2])),this.setWrapMode(parseInt(n[3]),parseInt(n[4]))),n.length>=7&&(this.setMipFilter(parseInt(n[5])),this.setAnisotropy(parseInt(n[6])))}_getGFXDevice(){return c.director.root?c.director.root.device:null}_getGFXFormat(){return this._getGFXPixelFormat(this._format)}_setGFXFormat(e){this._format=void 0===e?xd.RGBA8888:e}_getGFXPixelFormat(e){return e===xd.RGBA_ETC1?e=xd.RGB_ETC1:e===xd.RGB_A_PVRTC_4BPPV1?e=xd.RGB_PVRTC_4BPPV1:e===xd.RGB_A_PVRTC_2BPPV1&&(e=xd.RGB_PVRTC_2BPPV1),e}},Ud.PixelFormat=xd,Ud.WrapMode=yd,Ud.Filter=bd,Nd=Pc((Dd=Gd).prototype,"_format",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xd.RGBA8888}}),Od=Pc(Dd.prototype,"_minFilter",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bd.LINEAR}}),Md=Pc(Dd.prototype,"_magFilter",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bd.LINEAR}}),zd=Pc(Dd.prototype,"_mipFilter",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bd.NONE}}),Ld=Pc(Dd.prototype,"_wrapS",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yd.REPEAT}}),Fd=Pc(Dd.prototype,"_wrapT",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yd.REPEAT}}),Bd=Pc(Dd.prototype,"_wrapR",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yd.REPEAT}}),kd=Pc(Dd.prototype,"_anisotropy",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Rd=Dd))||Rd);c.TextureBase=Vd;const Hd=new WeakMap,Wd=new WeakSet,qd=new WeakSet;function Yd(e,t){let n;n=L_.safeFindClass;const i=tu.pool.get();let o;try{o=fu(e,i,{classFinder:n,customEnv:t})}catch(e){throw g(e),tu.pool.put(i),e}o._uuid=t.__uuid__||"";const a=i.uuidList,r=i.uuidObjList,s=i.uuidPropList,c=i.uuidTypeList||[],l=[];for(let e=0;e<a.length;e++){const t=a[e];l[e]={uuid:Ql(t),owner:r[e],prop:s[e],type:Ne._getClassById(c[e])}}return Hd.set(o,l),o._native&&Wd.add(o),tu.pool.put(i),o}var Xd,Qd=new class{constructor(){this._depends=new Nl}init(){this._depends.clear()}getNativeDep(e){const t=this._depends.get(e);return t&&t.nativeDep?{...t.nativeDep}:null}getDeps(e){return this._depends.has(e)?this._depends.get(e).deps:[]}getDepsRecursively(e){const t=Object.create(null),n=[];return this._descend(e,t,n),n}remove(e){this._depends.remove(e)}parse(e,t){let n=null;if(Array.isArray(t)||t.__type__||t instanceof V_){if(this._depends.has(e))return this._depends.get(e);if(Array.isArray(t)&&!function(e){const t=e[5],n=t[t.length-1];return"number"==typeof n&&n<0}(t))n={deps:this._parseDepsFromJson(t)};else try{const i=Yd(t,{__uuid__:e});n=this._parseDepsFromAsset(i),n.nativeDep&&(n.nativeDep.uuid=e),Ll.add(`${e}@import`,i)}catch(t){zl.remove(`${e}@import`),n={deps:[]}}}else{if(this._depends.has(e)&&(n=this._depends.get(e),n.parsedFromExistAsset))return n;n=this._parseDepsFromAsset(t)}return this._depends.add(e,n),n}_parseDepsFromAsset(e){const t={deps:[],parsedFromExistAsset:!0},n=Hd.get(e);for(let e=0,i=n.length;e<i;e++)t.deps.push(n[e].uuid);return Wd.has(e)&&(t.nativeDep=e._nativeDep),t}_parseDepsFromJson(e){const t=function(e){const t=e[1];return e[10].map((e=>t[e]))}(e);return t.forEach(((e,n)=>t[n]=Ql(e))),t}_descend(e,t,n){const i=this.getDeps(e);for(let e=0;e<i.length;e++){const o=i[e];t[o]||(t[o]=!0,n.push(o),this._descend(o,t,n))}}};const Zd=[new Oa];function Jd(e){return e&&0==(e&e-1)}let Kd=Uc("cc.SimpleTexture")(Xd=class extends Vd{constructor(...e){super(...e),this._gfxTexture=null,this._mipmapLevel=1,this._textureWidth=0,this._textureHeight=0}get mipmapLevel(){return this._mipmapLevel}getGFXTexture(){return this._gfxTexture}destroy(){return this._tryDestroyTexture(),super.destroy()}updateImage(){this.updateMipmaps(0)}updateMipmaps(e=0,t){}uploadData(e,t=0,n=0){if(!this._gfxTexture||this._mipmapLevel<=t)return;const i=this._getGFXDevice();if(!i)return;const o=Zd[0];o.texExtent.width=this._textureWidth>>t,o.texExtent.height=this._textureHeight>>t,o.texSubres.mipLevel=t,o.texSubres.baseArrayLayer=n,ArrayBuffer.isView(e)?i.copyBuffersToTexture([e],this._gfxTexture,Zd):i.copyTexImagesToTexture([e],this._gfxTexture,Zd)}_assignImage(e,t,n){const i=e.data;if(i&&(this.uploadData(i,t,n),this._checkTextureLoaded(),He.CLEANUP_IMAGE_CACHE)){const t=Qd.getDeps(this._uuid),n=t.indexOf(e._uuid);-1!==n&&(U(t,n),e.decRef())}}_checkTextureLoaded(){this._textureReady()}_textureReady(){this.loaded=!0,this.emit("load")}_setMipmapLevel(e){this._mipmapLevel=e<1?1:e}_getGfxTextureCreateInfo(e){return null}_tryReset(){if(this._tryDestroyTexture(),0===this._mipmapLevel)return;const e=this._getGFXDevice();e&&this._createTexture(e)}_createTexture(e){if(0===this._width||0===this._height)return;let t=Zo.NONE;this._mipFilter!==bd.NONE&&function(e,t,n){return!(e.gfxAPI===Bo.WEBGL)||Jd(t)&&Jd(n)}(e,this._width,this._height)&&(this._mipmapLevel=function(e,t){let n=Math.max(e,t),i=0;for(;n;)n>>=1,i++;return i}(this._width,this._height),t=Zo.GEN_MIPMAP);const n=this._getGfxTextureCreateInfo({usage:Qo.SAMPLED|Qo.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:t});if(!n)return;const i=e.createTexture(n);this._textureWidth=n.width,this._textureHeight=n.height,this._gfxTexture=i}_tryDestroyTexture(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)}})||Xd;var $d,em,tm,nm,im;c.SimpleTexture=Kd;let om=e("cJ",($d=Uc("cc.Texture2D"),em=vl([Id]),$d((im=Pc((nm=class extends Kd{constructor(...e){super(...e),Tc(this,"_mipmaps",im,this)}get mipmaps(){return this._mipmaps}set mipmaps(e){if(this._mipmaps=e,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){const e=this._mipmaps[0];this.reset({width:e.width,height:e.height,format:e.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach(((e,t)=>{this._assignImage(e,t)}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}get image(){return 0===this._mipmaps.length?null:this._mipmaps[0]}set image(e){this.mipmaps=e?[e]:[]}initialize(){this.mipmaps=this._mipmaps}onLoaded(){this.initialize()}reset(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format),this._setMipmapLevel(e.mipmapLevel||1),this._tryReset()}create(e,t,n=xd.RGBA8888,i=1){this.reset({width:e,height:t,format:n,mipmapLevel:i})}toString(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""}updateMipmaps(e=0,t){if(e>=this._mipmaps.length)return;const n=Math.min(void 0===t?this._mipmaps.length:t,this._mipmaps.length-e);for(let t=0;t<n;++t){const n=e+t;this._assignImage(this._mipmaps[n],n)}}getHtmlElementObj(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null}destroy(){return this._mipmaps=[],super.destroy()}description(){return`<cc.Texture2D | Name = ${this._mipmaps[0]?this._mipmaps[0].url:""} | Dimension = ${this.width} x ${this.height}>`}releaseTexture(){this.destroy()}_serialize(e){return null}_deserialize(e,t){const n=e;super._deserialize(n.base,t),this._mipmaps=new Array(n.mipmaps.length);for(let e=0;e<n.mipmaps.length;++e){if(this._mipmaps[e]=new Id,!n.mipmaps[e])continue;const i=n.mipmaps[e];t.result.push(this._mipmaps,`${e}`,i,Ne._getClassId(Id))}}_getGfxTextureCreateInfo(e){const t=new Ha(Xo.TEX2D);return t.width=this._width,t.height=this._height,Object.assign(t,e)}initDefault(e){super.initDefault(e);const t=new Id;t.initDefault(),this.image=t}validate(){return this.mipmaps&&0!==this.mipmaps.length}}).prototype,"_mipmaps",[em],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tm=nm))||tm));var am,rm,sm,cm,lm,_m,um;c.Texture2D=om,function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom",e[e.front=4]="front",e[e.back=5]="back"}(um||(um={}));let hm=e("fL",Uc("cc.TextureCube")((_m=lm=class e extends Kd{constructor(...e){super(...e),Tc(this,"isRGBE",sm,this),Tc(this,"_mipmaps",cm,this)}get mipmaps(){return this._mipmaps}set mipmaps(e){if(this._mipmaps=e,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){const e=this._mipmaps[0].front;this.reset({width:e.width,height:e.height,format:e.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach(((e,t)=>{fm(e,((e,n)=>{this._assignImage(e,t,n)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}get image(){return 0===this._mipmaps.length?null:this._mipmaps[0]}set image(e){this.mipmaps=e?[e]:[]}static fromTexture2DArray(t,n){const i=[],o=t.length/6;for(let e=0;e<o;e++){const n=6*e;i.push({front:t[n+um.front].image,back:t[n+um.back].image,left:t[n+um.left].image,right:t[n+um.right].image,top:t[n+um.top].image,bottom:t[n+um.bottom].image})}return(n=n||new e).mipmaps=i,n}onLoaded(){this.mipmaps=this._mipmaps}reset(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format),this._setMipmapLevel(e.mipmapLevel||1),this._tryReset()}updateMipmaps(e=0,t){if(e>=this._mipmaps.length)return;const n=Math.min(void 0===t?this._mipmaps.length:t,this._mipmaps.length-e);for(let t=0;t<n;++t){const n=e+t;fm(this._mipmaps[n],((e,t)=>{this._assignImage(e,n,t)}))}}destroy(){return this._mipmaps=[],super.destroy()}releaseTexture(){this.mipmaps=[]}_serialize(e){return null}_deserialize(e,t){const n=e;super._deserialize(n.base,t),this.isRGBE=n.rgbe,this._mipmaps=new Array(n.mipmaps.length);for(let e=0;e<n.mipmaps.length;++e){this._mipmaps[e]={front:new Id,back:new Id,left:new Id,right:new Id,top:new Id,bottom:new Id};const i=n.mipmaps[e],o=Ne._getClassId(Id);t.result.push(this._mipmaps[e],"front",i.front,o),t.result.push(this._mipmaps[e],"back",i.back,o),t.result.push(this._mipmaps[e],"left",i.left,o),t.result.push(this._mipmaps[e],"right",i.right,o),t.result.push(this._mipmaps[e],"top",i.top,o),t.result.push(this._mipmaps[e],"bottom",i.bottom,o)}}_getGfxTextureCreateInfo(e){const t=new Ha(Xo.CUBE);return t.width=this._width,t.height=this._height,t.layerCount=6,Object.assign(t,e),t}initDefault(e){super.initDefault(e);const t=new Id;t.initDefault(),this.mipmaps=[{front:t,back:t,top:t,bottom:t,left:t,right:t}]}validate(){return 0!==this._mipmaps.length&&!this._mipmaps.find((e=>!(e.top&&e.bottom&&e.front&&e.back&&e.left&&e.right)))}},lm.FaceIndex=um,sm=Pc((rm=_m).prototype,"isRGBE",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),cm=Pc(rm.prototype,"_mipmaps",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),am=rm))||am);function fm(e,t){t(e.front,um.front),t(e.back,um.back),t(e.left,um.left),t(e.right,um.right),t(e.top,um.top),t(e.bottom,um.bottom)}c.TextureCube=hm;const pm=e("gl",[{name:"billboard",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"billboard|vert:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"billboard|vert:vs_main|tinted-fs:add",hash:2909832090,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:53,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:21,location:1},{name:"a_color",defines:[],format:44,location:2}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"builtin",defines:[],binding:1,stageFlags:1,members:[{name:"cc_size_rotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:2,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:3}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"clear-stencil",techniques:[{passes:[{blendState:{targets:[{blend:!0}]},rasterizerState:{cullMode:0},program:"clear-stencil|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"clear-stencil|sprite-vs:vert|sprite-fs:frag",hash:3507038093,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:0,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"graphics",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:1,blendDst:4,blendSrcAlpha:1,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"graphics|vs:vert|fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"graphics|vs:vert|fs:frag",hash:2610213142,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:48,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1},{name:"a_dist",defines:[],format:11,location:2}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"occlusion-query",techniques:[{passes:[{rasterizerState:{cullMode:2},blendState:{targets:[{blendColorMask:0}]},program:"occlusion-query|occlusion-query-vs:vert|occlusion-query-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"occlusion-query|occlusion-query-vs:vert|occlusion-query-fs:frag",hash:1571978323,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:41,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCWorldBound",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"particle-gpu",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",hash:1250077034,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:63,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"USE_VK_SHADER",type:"boolean"},{name:"COLOR_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"SIZE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"FORCE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"VELOCITY_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"TEXTURE_ANIMATION_MODULE_ENABLE",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"}],attributes:[{name:"a_position_starttime",defines:[],format:44,location:0},{name:"a_size_uv",defines:[],format:44,location:1},{name:"a_rotation_uv",defines:[],format:44,location:2},{name:"a_color",defines:[],format:44,location:3},{name:"a_dir_life",defines:[],format:44,location:4},{name:"a_rndSeed",defines:[],format:11,location:5},{name:"a_texCoord",defines:["CC_RENDER_MODE"],format:32,location:6},{name:"a_texCoord3",defines:["CC_RENDER_MODE"],format:32,location:7},{name:"a_normal",defines:["CC_RENDER_MODE"],format:32,location:8},{name:"a_color1",defines:["CC_RENDER_MODE"],format:44,location:9}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"SampleConstants",defines:[],binding:1,stageFlags:1,members:[{name:"u_sampleInfo",type:16,count:1}]},{name:"TickConstants",defines:[],binding:2,stageFlags:1,members:[{name:"u_worldRot",type:16,count:1},{name:"u_timeDelta",type:16,count:1}]},{name:"ColorConstant",defines:["COLOR_OVER_TIME_MODULE_ENABLE"],binding:3,stageFlags:1,members:[{name:"u_color_mode",type:5,count:1}]},{name:"RotationConstant",defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],binding:4,stageFlags:1,members:[{name:"u_rotation_mode",type:5,count:1}]},{name:"SizeConstant",defines:["SIZE_OVER_TIME_MODULE_ENABLE"],binding:5,stageFlags:1,members:[{name:"u_size_mode",type:5,count:1}]},{name:"ForceConstant",defines:["FORCE_OVER_TIME_MODULE_ENABLE"],binding:6,stageFlags:1,members:[{name:"u_force_mode",type:5,count:1},{name:"u_force_space",type:5,count:1}]},{name:"VelocityConstant",defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],binding:7,stageFlags:1,members:[{name:"u_velocity_mode",type:5,count:1},{name:"u_velocity_space",type:5,count:1}]},{name:"AnimationConstant",defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],binding:8,stageFlags:1,members:[{name:"u_anim_info",type:16,count:1}]},{name:"FragConstants",defines:[],binding:9,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"color_over_time_tex0",type:28,count:1,defines:["COLOR_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:10},{name:"rotation_over_time_tex0",type:28,count:1,defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:11},{name:"size_over_time_tex0",type:28,count:1,defines:["SIZE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:12},{name:"force_over_time_tex0",type:28,count:1,defines:["FORCE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:13},{name:"velocity_over_time_tex0",type:28,count:1,defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:14},{name:"texture_animation_tex0",type:28,count:1,defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],stageFlags:1,binding:15},{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:16}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"particle-trail",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-trail|particle-trail:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},frameTile_velLenScale:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-trail|particle-trail:vs_main|tinted-fs:add",hash:1437790364,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:52,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_DRAW_WIRE_FRAME",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:44,location:1},{name:"a_texCoord1",defines:[],format:32,location:2},{name:"a_texCoord2",defines:[],format:32,location:3},{name:"a_color",defines:[],format:44,location:4}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"particle",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",hash:2554907268,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:52,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:32,location:1},{name:"a_texCoord1",defines:[],format:32,location:2},{name:"a_texCoord2",defines:[],format:32,location:3},{name:"a_color",defines:[],format:44,location:4},{name:"a_color1",defines:["CC_RENDER_MODE"],format:32,location:8},{name:"a_texCoord3",defines:["CC_RENDER_MODE"],format:32,location:6},{name:"a_normal",defines:["CC_RENDER_MODE"],format:32,location:7}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"spine",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"spine|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"spine|sprite-vs:vert|sprite-fs:frag",hash:3192452405,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:48,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplerTextures:[{name:"cc_spriteTexture",defines:[]}],buffers:[],images:[]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"TWO_COLORED",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:21,location:1},{name:"a_color",defines:[],format:44,location:2},{name:"a_color2",defines:["TWO_COLORED"],format:44,location:3}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"sprite",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"sprite|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"sprite|sprite-vs:vert|sprite-fs:frag",hash:1770338543,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:48,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplerTextures:[{name:"cc_spriteTexture",defines:["USE_TEXTURE"]}],buffers:[],images:[]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"USE_PIXEL_ALIGNMENT",type:"boolean"},{name:"CC_USE_EMBEDDED_ALPHA",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"IS_GRAY",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:21,location:1},{name:"a_color",defines:[],format:44,location:2}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"standard",techniques:[{name:"opaque",passes:[{program:"standard|standard-vs|standard-fs",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],linear:!0,type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},SpecularIntensity:{value:[.5],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],linear:!0,type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},normalStrenth:{value:[1],type:13,handleInfo:["emissiveScaleParam",3,13]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,.5]},emissiveScaleParam:{type:16,value:[1,1,1,1]},albedoMap:{type:28,value:"grey"}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"standard|standard-vs|standard-fs",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1}},{phase:"shadow-caster",propertyIndex:0,rasterizerState:{cullMode:1},program:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},albedoMap:{type:28,value:"grey"}}}]}],shaders:[{name:"standard|standard-vs|standard-fs",hash:4038009253,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:222,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:65},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_diffuseMap",defines:["CC_USE_IBL","CC_USE_DIFFUSEMAP"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_USE_ACCURATE_FOG",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_NORMAL_MAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_TWOSIDE",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_DIFFUSEMAP",type:"number",range:[0,2]},{name:"USE_REFLECTION_DENOISE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"NORMAL_UV",type:"string",options:["v_uv","v_uv1"]},{name:"PBR_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_PBR_MAP",type:"boolean"},{name:"USE_METALLIC_ROUGHNESS_MAP",type:"boolean"},{name:"USE_OCCLUSION_MAP",type:"boolean"},{name:"USE_EMISSIVE_MAP",type:"boolean"},{name:"EMISSIVE_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_FORCE_FORWARD_SHADING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","USE_LIGHTMAP"],format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_color",defines:["USE_VERTEX_COLOR"],format:44,location:13},{name:"a_texCoord1",defines:[],format:21,location:14}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplerTextures:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1},{name:"normalMap",type:28,count:1,defines:["USE_NORMAL_MAP"],stageFlags:16,binding:2},{name:"pbrMap",type:28,count:1,defines:["USE_PBR_MAP"],stageFlags:16,binding:3},{name:"metallicRoughnessMap",type:28,count:1,defines:["USE_METALLIC_ROUGHNESS_MAP"],stageFlags:16,binding:4},{name:"occlusionMap",type:28,count:1,defines:["USE_OCCLUSION_MAP"],stageFlags:16,binding:5},{name:"emissiveMap",type:28,count:1,defines:["USE_EMISSIVE_MAP"],stageFlags:16,binding:6}],buffers:[{name:"b_ccLightsBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:7},{name:"b_clusterLightIndicesBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:8},{name:"b_clusterLightGridBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:9}],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:210600745,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:183,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:65},globals:{blocks:[{name:"CCShadow",defines:[]},{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","USE_LIGHTMAP"],format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_texCoord1",defines:[],format:21,location:13}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplerTextures:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"terrain",techniques:[{name:"opaque",passes:[{program:"terrain|terrain-vs|terrain-fs",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"terrain|terrain-vs|terrain-fs",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"shadow-add",propertyIndex:0,rasterizerState:{cullMode:2},program:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag"}]}],shaders:[{name:"terrain|terrain-vs|terrain-fs",hash:3916952624,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:70,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:61},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_diffuseMap",defines:["CC_USE_IBL","CC_USE_DIFFUSEMAP"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"]}],samplerTextures:[{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_USE_ACCURATE_FOG",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_NORMALMAP",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_DIFFUSEMAP",type:"number",range:[0,2]},{name:"USE_REFLECTION_DENOISE",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"LAYERS",type:"number",range:[0,4]},{name:"USE_PBR",type:"boolean"},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_FORCE_FORWARD_SHADING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2}],blocks:[{name:"TexCoords",defines:[],binding:0,stageFlags:1,members:[{name:"UVScale",type:16,count:1},{name:"lightMapUVParam",type:16,count:1}]},{name:"PbrParams",defines:[],binding:1,stageFlags:16,members:[{name:"metallic",type:16,count:1},{name:"roughness",type:16,count:1}]}],samplerTextures:[{name:"weightMap",type:28,count:1,defines:[],stageFlags:16,binding:2},{name:"detailMap0",type:28,count:1,defines:[],stageFlags:16,binding:3},{name:"detailMap1",type:28,count:1,defines:[],stageFlags:16,binding:4},{name:"detailMap2",type:28,count:1,defines:[],stageFlags:16,binding:5},{name:"detailMap3",type:28,count:1,defines:[],stageFlags:16,binding:6},{name:"normalMap0",type:28,count:1,defines:[],stageFlags:16,binding:7},{name:"normalMap1",type:28,count:1,defines:[],stageFlags:16,binding:8},{name:"normalMap2",type:28,count:1,defines:[],stageFlags:16,binding:9},{name:"normalMap3",type:28,count:1,defines:[],stageFlags:16,binding:10},{name:"lightMap",type:28,count:1,defines:[],stageFlags:16,binding:11}],buffers:[{name:"b_ccLightsBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:12},{name:"b_clusterLightIndicesBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:13},{name:"b_clusterLightGridBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:14}],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:4270039829,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:68,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"unlit",techniques:[{name:"opaque",passes:[{program:"unlit|unlit-vs:vert|unlit-fs:frag",properties:{mainTexture:{value:"grey",type:28},tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],linear:!0,type:16},colorScale:{value:[1,1,1],type:15,handleInfo:["colorScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["colorScaleAndCutoff",3,13]},color:{linear:!0,type:16,handleInfo:["mainColor",0,16]},colorScaleAndCutoff:{type:16,value:[1,1,1,.5]}}}]}],shaders:[{name:"unlit|unlit-vs:vert|unlit-fs:frag",hash:3319190198,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:197,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:41},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_USE_ACCURATE_FOG",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r","g","b"]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","USE_LIGHTMAP"],format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_color",defines:["USE_VERTEX_COLOR"],format:44,location:13}],blocks:[{name:"TexCoords",defines:["USE_TEXTURE"],binding:0,stageFlags:1,members:[{name:"tilingOffset",type:16,count:1}]},{name:"Constant",defines:[],binding:1,stageFlags:16,members:[{name:"mainColor",type:16,count:1},{name:"colorScaleAndCutoff",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:["USE_TEXTURE"],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"bloom",techniques:[{passes:[{phase:"bloom-prefilter",program:"bloom|bloom-vs|prefilter-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-combine",program:"bloom|bloom-vs|combine-fs",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"bloom|bloom-vs|prefilter-fs",hash:2185821616,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"outputResultMap",type:28,count:1,defines:[],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"bloom|bloom-vs|downsample-fs",hash:1780231359,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"bloomTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"bloom|bloom-vs|upsample-fs",hash:3580425335,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"bloomTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"bloom|bloom-vs|combine-fs",hash:3457196798,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"outputResultMap",type:28,count:1,defines:[],stageFlags:16,binding:1},{name:"bloomTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"deferred-lighting",techniques:[{passes:[{phase:"deferred-lighting",program:"deferred-lighting|lighting-vs|lighting-fs",depthStencilState:{depthFunc:4,depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"deferred-lighting|lighting-vs|lighting-fs",hash:3788484086,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:59},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_diffuseMap",defines:["CC_USE_IBL","CC_USE_DIFFUSEMAP"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCForwardLight",defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_DIFFUSEMAP",type:"number",range:[0,2]},{name:"USE_REFLECTION_DENOISE",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_FORCE_FORWARD_SHADING",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3}],blocks:[],samplerTextures:[{name:"depth_stencil",type:28,count:1,defines:[],stageFlags:16,binding:3}],buffers:[{name:"b_ccLightsBuffer",memoryAccess:1,defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:4},{name:"b_clusterLightIndicesBuffer",memoryAccess:1,defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:5},{name:"b_clusterLightGridBuffer",memoryAccess:1,defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:6}],images:[],textures:[],samplers:[],subpassInputs:[{name:"gbuffer_albedoMap",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:0},{name:"gbuffer_normalMap",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:1},{name:"gbuffer_emissiveMap",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:2}]}]},{name:"planar-shadow",techniques:[{passes:[{phase:"planarShadow",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1,stencilTestFront:!0,stencilFuncFront:5,stencilPassOpFront:2,stencilRefBack:128,stencilRefFront:128,stencilReadMaskBack:128,stencilReadMaskFront:128,stencilWriteMaskBack:128,stencilWriteMaskFront:128}}]}],shaders:[{name:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",hash:730673320,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:216,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:59},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","USE_LIGHTMAP"],format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"post-process",techniques:[{passes:[{phase:"post-process",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendSrcAlpha:2,blendDstAlpha:4}]},program:"post-process|post-process-vs|post-process-fs",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"post-process|post-process-vs|post-process-fs",hash:3237848814,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"ANTIALIAS_TYPE",type:"number",range:[0,3]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7}],blocks:[],samplerTextures:[{name:"outputResultMap",type:28,count:1,defines:[],stageFlags:16,binding:0}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"skybox",techniques:[{passes:[{rasterizerState:{cullMode:0},program:"skybox|sky-vs:vert|sky-fs:frag",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"skybox|sky-vs:vert|sky-fs:frag",hash:4277052359,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[{name:"cc_environment",defines:[]}],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_RGBE_CUBEMAP",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"profiler",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"profiler|profiler-vs:vert|profiler-fs:frag",priority:255,depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"profiler|profiler-vs:vert|profiler-fs:frag",hash:179162168,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:60,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"offset",type:16,count:1}]},{name:"PerFrameInfo",defines:[],binding:1,stageFlags:1,members:[{name:"digits",type:16,count:20}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"splash-screen",techniques:[{name:"default",passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},resolution:{value:[640,960],type:14,handleInfo:["u_buffer0",0,14]},percent:{value:[.5],type:13,handleInfo:["u_percent",0,13]},scale:{value:[200,500],type:14,handleInfo:["u_buffer1",0,14]},translate:{value:[320,480],type:14,handleInfo:["u_buffer1",2,14]},u_buffer0:{type:16,value:[640,960,0,0]},u_percent:{type:13,value:[.5]},u_buffer1:{type:16,value:[200,500,320,480]}}}]}],shaders:[{name:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",hash:3189094080,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:6,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:21,location:0},{name:"a_texCoord",defines:[],format:21,location:1}],blocks:[{name:"Constant",defines:[],binding:0,stageFlags:1,members:[{name:"u_buffer0",type:16,count:1},{name:"u_buffer1",type:16,count:1},{name:"u_projection",type:25,count:1}]},{name:"Factor",defines:[],binding:1,stageFlags:16,members:[{name:"u_percent",type:13,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]}]),dm=4227858432,mm=66060288,Am=1044480,vm=(e,t,n,i=0)=>t<<26&dm|e<<20&mm|n<<12&Am|4095&i,gm=e=>(e&dm)>>>26,xm=e=>(e&mm)>>>20,ym=e=>(e&Am)>>>12,bm=e=>4095&e,Sm=(e,t)=>67108863&e|t<<26&dm,Cm={[Vo.UNKNOWN]:()=>console.warn("illegal uniform handle"),[Vo.INT]:(e,t,n=0)=>e[n],[Vo.INT2]:(e,t,n=0)=>Ii.fromArray(t,e,n),[Vo.INT3]:(e,t,n=0)=>_i.fromArray(t,e,n),[Vo.INT4]:(e,t,n=0)=>Oi.fromArray(t,e,n),[Vo.FLOAT]:(e,t,n=0)=>e[n],[Vo.FLOAT2]:(e,t,n=0)=>Ii.fromArray(t,e,n),[Vo.FLOAT3]:(e,t,n=0)=>_i.fromArray(t,e,n),[Vo.FLOAT4]:(e,t,n=0)=>Oi.fromArray(t,e,n),[Vo.MAT3]:(e,t,n=0)=>pi.fromArray(t,e,n),[Vo.MAT4]:(e,t,n=0)=>Ei.fromArray(t,e,n)},Em={[Vo.UNKNOWN]:()=>console.warn("illegal uniform handle"),[Vo.INT]:(e,t,n=0)=>e[n]=t,[Vo.INT2]:(e,t,n=0)=>Ii.toArray(e,t,n),[Vo.INT3]:(e,t,n=0)=>_i.toArray(e,t,n),[Vo.INT4]:(e,t,n=0)=>Oi.toArray(e,t,n),[Vo.FLOAT]:(e,t,n=0)=>e[n]=t,[Vo.FLOAT2]:(e,t,n=0)=>Ii.toArray(e,t,n),[Vo.FLOAT3]:(e,t,n=0)=>_i.toArray(e,t,n),[Vo.FLOAT4]:(e,t,n=0)=>Oi.toArray(e,t,n),[Vo.MAT3]:(e,t,n=0)=>pi.toArray(e,t,n),[Vo.MAT4]:(e,t,n=0)=>Ei.toArray(e,t,n)},Tm=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function Pm(e){switch(e){case Vo.BOOL:case Vo.INT:case Vo.UINT:case Vo.FLOAT:return Tm[0];case Vo.BOOL2:case Vo.INT2:case Vo.UINT2:case Vo.FLOAT2:return Tm[1];case Vo.BOOL4:case Vo.INT4:case Vo.UINT4:case Vo.FLOAT4:return Tm[2];case Vo.MAT4:return Tm[3];case Vo.SAMPLER2D:return"default-texture";case Vo.SAMPLER_CUBE:return"default-cube-texture"}return Tm[0]}function wm(e,t){const n=Object.entries(t);let i=!1;for(let t=0;t<n.length;t++)e[n[t][0]]!==n[t][1]&&(e[n[t][0]]=n[t][1],i=!0);return i}const Im=new dr;function Rm(e){return Math.ceil(Math.log2(Math.max(e,2)))}function Dm(e,t){switch(e.type){case"boolean":return"number"==typeof t?t.toString():t?"1":"0";case"string":return void 0!==t?t:e.options[0];case"number":return void 0!==t?t.toString():e.range[0].toString();default:return console.warn(`unknown define type '${e.type}'`),"-1"}}function Nm(e,t,n,i,o){const a=e.builtins[i],r=[];for(let e=0;e<a.blocks.length;e++){const t=a.blocks[e],i=n.layouts[t.name],s=i&&n.bindings.find((e=>e.binding===i.binding));i&&s&&s.descriptorType&wr?(r.push(i),o&&!o.includes(s)&&o.push(s)):console.warn(`builtin UBO '${t.name}' not available!`)}Array.prototype.unshift.apply(t.shaderInfo.blocks,r);const s=[];for(let e=0;e<a.samplerTextures.length;e++){const t=a.samplerTextures[e],i=n.layouts[t.name],r=i&&n.bindings.find((e=>e.binding===i.binding));i&&r&&r.descriptorType&Ir?(s.push(i),o&&!o.includes(r)&&o.push(r)):console.warn(`builtin samplerTexture '${t.name}' not available!`)}Array.prototype.unshift.apply(t.shaderInfo.samplerTextures,s),o&&o.sort(((e,t)=>e.binding-t.binding))}function Om(e){return e.members.reduce(((e,t)=>e+Lr(t.type)*t.count),0)}function Mm(e,t){for(let n=0;n<e.length;n++){const i=e[n];if("!"===i[0]){if(t[i.slice(1)])return!1}else if(!t[i])return!1}return!0}function zm(e){switch(e.gfxAPI){case Bo.GLES2:case Bo.WEBGL:return"glsl1";case Bo.GLES3:case Bo.WEBGL2:return"glsl3";default:return"glsl4"}}const Lm=new class{constructor(){this._templates={},this._cache={},this._templateInfos={}}register(e){for(let t=0;t<e.shaders.length;t++)this.define(e.shaders[t]).effectName=e.name;for(let t=0;t<e.techniques.length;t++){const n=e.techniques[t];for(let e=0;e<n.passes.length;e++){const t=n.passes[e];void 0!==t.propertyIndex&&void 0===t.properties&&(t.properties=n.passes[t.propertyIndex].properties)}}}define(e){const t=this._templates[e.name];if(t&&t.hash===e.hash)return t;const n={...e};let i=0;for(let e=0;e<n.defines.length;e++){const t=n.defines[e];let o=1;if("number"===t.type){const e=t.range;o=Rm(e[1]-e[0]+1),t._map=t=>t-e[0]}else"string"===t.type?(o=Rm(t.options.length),t._map=e=>Math.max(0,t.options.findIndex((t=>t===e)))):"boolean"===t.type&&(t._map=e=>e?1:0);t._offset=i,i+=o}i>31&&(n.uber=!0),n.constantMacros="";for(const e in n.builtins.statistics)n.constantMacros+=`#define ${e} ${n.builtins.statistics[e]}\n`;if(this._templates[e.name]=n,!this._templateInfos[n.hash]){const e={};e.samplerStartBinding=n.blocks.length,e.shaderInfo=new or,e.blockSizes=[],e.bindings=[];for(let t=0;t<n.blocks.length;t++){const i=n.blocks[t];e.blockSizes.push(Om(i)),e.bindings.push(new pr(i.binding,va.UNIFORM_BUFFER,1,i.stageFlags)),e.shaderInfo.blocks.push(new Xa(cp.MATERIAL,i.binding,i.name,i.members.map((e=>new Ya(e.name,e.type,e.count))),1))}for(let t=0;t<n.samplerTextures.length;t++){const i=n.samplerTextures[t];e.bindings.push(new pr(i.binding,va.SAMPLER_TEXTURE,i.count,i.stageFlags)),e.shaderInfo.samplerTextures.push(new Qa(cp.MATERIAL,i.binding,i.name,i.type,i.count))}for(let t=0;t<n.samplers.length;t++){const i=n.samplers[t];e.bindings.push(new pr(i.binding,va.SAMPLER,i.count,i.stageFlags)),e.shaderInfo.samplers.push(new Za(cp.MATERIAL,i.binding,i.name,i.count))}for(let t=0;t<n.textures.length;t++){const i=n.textures[t];e.bindings.push(new pr(i.binding,va.TEXTURE,i.count,i.stageFlags)),e.shaderInfo.textures.push(new Ja(cp.MATERIAL,i.binding,i.name,i.type,i.count))}for(let t=0;t<n.buffers.length;t++){const i=n.buffers[t];e.bindings.push(new pr(i.binding,va.STORAGE_BUFFER,1,i.stageFlags)),e.shaderInfo.buffers.push(new $a(cp.MATERIAL,i.binding,i.name,1,i.memoryAccess))}for(let t=0;t<n.images.length;t++){const i=n.images[t];e.bindings.push(new pr(i.binding,va.STORAGE_IMAGE,i.count,i.stageFlags)),e.shaderInfo.images.push(new Ka(cp.MATERIAL,i.binding,i.name,i.type,i.count,i.memoryAccess))}for(let t=0;t<n.subpassInputs.length;t++){const i=n.subpassInputs[t];e.bindings.push(new pr(i.binding,va.INPUT_ATTACHMENT,i.count,i.stageFlags)),e.shaderInfo.subpassInputs.push(new er(cp.MATERIAL,i.binding,i.name,i.count))}e.gfxAttributes=[];for(let t=0;t<n.attributes.length;t++){const i=n.attributes[t];e.gfxAttributes.push(new ir(i.name,i.format,i.isNormalized,0,i.isInstanced,i.location))}Nm(n,e,tp,"locals"),e.shaderInfo.stages.push(new tr(ra.VERTEX,"")),e.shaderInfo.stages.push(new tr(ra.FRAGMENT,"")),e.handleMap=function(e){const t={};for(let n=0;n<e.blocks.length;n++){const i=e.blocks[n],o=i.members;let a=0;for(let e=0;e<o.length;e++){const n=o[e];t[n.name]=vm(i.binding,n.type,n.count,a),a+=(Lr(n.type)>>2)*n.count}}for(let n=0;n<e.samplerTextures.length;n++){const i=e.samplerTextures[n];t[i.name]=vm(i.binding,i.type,i.count)}return t}(n),e.setLayouts=[],this._templateInfos[n.hash]=e}return n}getTemplate(e){return this._templates[e]}getTemplateInfo(e){const t=this._templates[e].hash;return this._templateInfos[t]}getDescriptorSetLayout(e,t,n=!1){const i=this._templates[t],o=this._templateInfos[i.hash];return o.setLayouts.length||(Im.bindings=o.bindings,o.setLayouts[cp.MATERIAL]=e.createDescriptorSetLayout(Im),Im.bindings=tp.bindings,o.setLayouts[cp.LOCAL]=e.createDescriptorSetLayout(Im)),o.setLayouts[n?cp.LOCAL:cp.MATERIAL]}hasProgram(e){return void 0!==this._templates[e]}getKey(e,t){const n=this._templates[e],i=n.defines;if(n.uber){let e="";for(let n=0;n<i.length;n++){const o=i[n],a=t[o.name];if(!a||!o._map)continue;const r=o._map(a);e+=`${o._offset}${r}|`}return`${e}${n.hash}`}let o=0;for(let e=0;e<i.length;e++){const n=i[e],a=t[n.name];a&&n._map&&(o|=n._map(a)<<n._offset)}return`${o.toString(16)}|${n.hash}`}destroyShaderByDefines(e){const t=Object.keys(e);if(!t.length)return;const n=t.map((t=>{let n=e[t];return"boolean"==typeof n&&(n=n?"1":"0"),new RegExp(`${t}${n}`)})),i=Object.keys(this._cache).filter((e=>n.every((t=>t.test(this._cache[e].name)))));for(let e=0;e<i.length;e++){const t=i[e],n=this._cache[t];y(`destroyed shader ${n.name}`),n.destroy(),delete this._cache[t]}}getGFXShader(e,t,n,i,o){Object.assign(n,i.macros),o||(o=this.getKey(t,n));const a=this._cache[o];if(a)return a;const r=this._templates[t],s=this._templateInfos[r.hash];s.pipelineLayout||(this.getDescriptorSetLayout(e,t),Nm(r,s,ep,"globals"),s.setLayouts[cp.GLOBAL]=i.descriptorSetLayout,s.pipelineLayout=e.createPipelineLayout(new Ar(s.setLayouts)));const c=function(e,t){const n=[];for(let i=0;i<t.length;i++){const o=t[i],a=o.name,r=e[a],s=Dm(o,r),c=!r||"0"===r;n.push({name:a,value:s,isDefault:c})}return n}(n,r.defines),l=i.constantMacros+r.constantMacros+c.reduce(((e,t)=>`${e}#define ${t.name} ${t.value}\n`),"");let _=r.glsl3;const u=zm(e);return u?_=r[u]:console.error("Invalid GFX API!"),s.shaderInfo.stages[0].source=l+_.vert,s.shaderInfo.stages[1].source=l+_.frag,s.shaderInfo.attributes=function(e,t,n){const i=[],o=e.attributes,a=t.gfxAttributes;for(let e=0;e<o.length;e++)Mm(o[e].defines,n)&&i.push(a[e]);return i}(r,s,n),s.shaderInfo.name=function(e,t){return e+t.reduce(((e,t)=>t.isDefault?e:`${e}|${t.name}${t.value}`),"")}(t,c),this._cache[o]=e.createShader(s.shaderInfo)}};c.programLib=Lm;const Fm={glsl1:[[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nuniform vec4 cc_size_rotation;\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nattribute vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nattribute float a_dist;\nvarying float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\nprecision highp float;\nvarying vec4 v_color;\nvarying float v_dist;\nvec4 frag () {\nvec4 o = v_color;\n#ifdef GL_OES_standard_derivatives\nfloat aa = fwidth(v_dist);\n#else\nfloat aa = 0.05;\n#endif\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_worldBoundCenter;\nuniform highp vec4 cc_worldBoundHalfExtents;\nattribute vec3 a_position;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition *= cc_worldBoundHalfExtents;\nposition += cc_worldBoundCenter;\nposition = cc_matViewProj * position;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 frag () {\nreturn vec4(1, 0, 0, 1);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nvec4 eulerToQuat(vec3 euler) {\nvec3 er = euler * 0.5;\nfloat x = er.x, y = er.y, z = er.z;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat;\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform vec4 nodeRotation;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nuniform vec4 u_sampleInfo;\nuniform vec4 u_worldRot;\nuniform vec4 u_timeDelta;\nattribute vec4 a_position_starttime;\nattribute vec4 a_size_uv;\nattribute vec4 a_rotation_uv;\nattribute vec4 a_color;\nattribute vec4 a_dir_life;\nattribute float a_rndSeed;\n#if CC_RENDER_MODE == 4\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord3;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture2D(tex, coord);\nvec4 b = texture2D(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture2D(tex, coord);\nvec4 b = texture2D(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom(float x) {\n#if USE_VK_SHADER\nfloat o = x;\nx = mod(x - 1.0, 2.0) - 1.0;\nfloat freqVar = 10.16640753482;\nfloat y = sin(freqVar * floor(o * 0.5 - 0.5));\nfloat v = max(0.0, 1.0-abs(x));\nv *= 0.7071067812;\nv = y < 0.0 ? -v : v;\nreturn v;\n#else\nfloat seed = mod(x, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n#endif\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nuniform sampler2D color_over_time_tex0;\nuniform int u_color_mode;\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nuniform sampler2D rotation_over_time_tex0;\nuniform int u_rotation_mode;\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D size_over_time_tex0;\nuniform int u_size_mode;\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D force_over_time_tex0;\nuniform int u_force_mode;\nuniform int u_force_space;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nuniform sampler2D velocity_over_time_tex0;\nuniform int u_velocity_mode;\nuniform int u_velocity_space;\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nuniform sampler2D texture_animation_tex0;\nuniform vec4 u_anim_info;\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 startRotation = a_rotation_uv.xyz;\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = startRotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., startRotation.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(startRotation);\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nvec3 euler = unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nvec3 euler = mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n#if CC_RENDER_MODE == 3 || CC_RENDER_MODE == 2\neuler = vec3(0.0, 0.0, euler.z);\n#endif\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture2D(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture2D(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture2D(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 1\nrot = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\ncomputeVertPos(pos, cornerOffset, rot, compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nuniform vec4 mainTiling_Offset;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nattribute vec3 a_position;\nattribute vec4 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nvarying vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\n#if CC_DRAW_WIRE_FRAME\nvarying vec3 vBarycentric;\n#endif\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform vec4 nodeRotation;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nattribute vec3 a_position;\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_RENDER_MODE == 1\nattribute vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nattribute vec3 a_texCoord3;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nvec3 rotTmp = a_texCoord2;\nfloat mulFactor = 1.0;\nif (rotTmp.x > 10.0 * 0.5) {\nrotTmp.x -= 10.0;\nmulFactor = -1.0;\n}\nvec4 rot = vec4(rotTmp, 0.0);\nrot.w = mulFactor * sqrt(abs(1.0 - rot.x * rot.x - rot.y * rot.y - rot.z * rot.z));\n#else\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(a_texCoord2);\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_matViewInv);\n#elif CC_RENDER_MODE == 1\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_cameraPos.xyz, velocity, frameTile_velLenScale.z, frameTile_velLenScale.w, a_texCoord.x);\n#elif 2\ncomputeVertPos(pos, cornerOffset, rot, compScale);\n#endif\ncolor = a_color;\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 v_light;\nvarying vec2 uv0;\n#if TWO_COLORED\nattribute vec4 a_color2;\nvarying vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nuniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nvarying vec4 v_light;\n#if TWO_COLORED\nvarying vec4 v_dark;\n#endif\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture2D(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture2D(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\n#if SAMPLE_FROM_RT\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 color;\nvarying vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture2D(tex, uv).rgb, texture2D(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture2D(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nuniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nvarying vec4 color;\n#if USE_TEXTURE\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\nuniform highp vec4 cc_lightingMapUVParam;\n#endif\nuniform vec4 tilingOffset;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\n#if USE_VERTEX_COLOR\nattribute vec4 a_color;\nvarying vec4 v_color;\n#endif\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\n#if USE_NORMAL_MAP\nvarying vec3 v_tangent;\nvarying vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\nattribute vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\nv_luv.z = cc_lightingMapUVParam.z;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\nv_luv.z = a_lightingMapUVParam.z;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if USE_TWOSIDE\nvec3 viewDirect = normalize(cc_cameraPos.xyz - v_position);\nv_normal *= dot(v_normal, viewDirect) < 0.0 ? -1.0 : 1.0;\n#endif\n#if USE_NORMAL_MAP\nv_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(pos);\nv_shadowPos = cc_matLightViewProj * pos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers: enable\n#endif\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform mediump vec4 cc_nearFar;\nuniform mediump vec4 cc_viewPort;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nuniform vec4 pbrParams;\nuniform vec4 emissive;\nuniform vec4 emissiveScaleParam;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp vec4 cc_shadowInvProjDepthInfo;\nuniform highp vec4 cc_shadowProjDepthInfo;\nuniform highp vec4 cc_shadowProjInfo;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = textureCube(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = textureCube(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nvarying highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nvarying vec3 v_position;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec3 v_normal;\n#if USE_VERTEX_COLOR\nvarying vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nvarying vec3 v_tangent;\nvarying vec3 v_bitangent;\nuniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nuniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nuniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nuniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor.rgb *= SRGBToLinear(v_color.rgb);\nbaseColor.a *= v_color.a;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture2D(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture2D(cc_lightingMap, v_luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if USE_NORMAL_MAP\nvec3 nmmp = texture2D(normalMap, NORMAL_UV).xyz - vec3(0.5);\ns.normal =\n(nmmp.x * emissiveScaleParam.w) * normalize(v_tangent) +\n(nmmp.y * emissiveScaleParam.w) * normalize(v_bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture2D(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\npbr.w *= res.a;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture2D(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture2D(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = pbr.x;\ns.roughness = pbr.y;\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture2D(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nreadonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nreadonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nreadonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nCC_APPLY_FOG(color, s.position.xyz);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nvoid main () {\nStandardSurface s; surf(s);\ngl_FragData[0] = s.albedo;\ngl_FragData[1] = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\ngl_FragData[2] = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\n#endif\nuniform vec4 tilingOffset;\nuniform highp mat4 cc_matLightViewProj;\n#if HAS_SECOND_UV || USE_LIGHTMAP\nattribute vec2 a_texCoord1;\n#endif\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec4 v_worldPos;\nvarying float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nuniform highp mat4 cc_matLightView;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec4 v_worldPos;\nvarying float v_clip_depth;\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture2D(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nreturn vec4(CCGetLinearDepth(v_worldPos.xyz), 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform highp mat4 cc_matWorld;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\nvarying mediump vec3 v_tangent;\nvarying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 luv;\nvarying mediump vec3 diffuse;\nuniform vec4 UVScale;\nuniform vec4 lightMapUVParam;\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\nluv.z = lightMapUVParam.z;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\nCC_TRANSFER_FOG(vec4(worldPos, 1.0));\n#if USE_NORMALMAP\nv_tangent = vec3(1.0, 0.0, 0.0);\nv_binormal = vec3(0.0, 0.0, 1.0);\nv_binormal = cross(v_tangent, a_normal);\nv_tangent = cross(a_normal, v_binormal);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers: enable\n#endif\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform mediump vec4 cc_nearFar;\nuniform mediump vec4 cc_viewPort;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp vec4 cc_shadowInvProjDepthInfo;\nuniform highp vec4 cc_shadowProjDepthInfo;\nuniform highp vec4 cc_shadowProjInfo;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = textureCube(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = textureCube(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nvarying highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\nvarying mediump vec3 v_tangent;\nvarying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 diffuse;\nvarying mediump vec3 luv;\nuniform vec4 metallic;\nuniform vec4 roughness;\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture2D(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture2D(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\nbaseColor += texture2D(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\nbaseColor += texture2D(detailMap2, uv2) * w.b;\nbaseColor += texture2D(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture2D(detailMap0, uv0);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture2D(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\nbaseNormal += texture2D(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\nbaseNormal += texture2D(normalMap2, uv2) * w.b;\nbaseNormal += texture2D(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture2D(normalMap0, uv0);\n#endif\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(v_tangent) +\nnmmp.y * normalize(v_binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.metallic = 0.0;\n#if LAYERS == 1\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture2D(lightMap, luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nreadonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nreadonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nreadonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nCC_APPLY_FOG(color, s.position.xyz);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nvoid main () {\nStandardSurface s; surf(s);\ngl_FragData[0] = s.albedo;\ngl_FragData[1] = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\ngl_FragData[2] = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nvarying vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\n#if USE_VERTEX_COLOR\nattribute lowp vec4 a_color;\nvarying lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nvarying vec2 v_uv;\nuniform vec4 tilingOffset;\n#endif\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(matWorld * position);\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\n#endif\nuniform vec4 mainColor;\nuniform vec4 colorScaleAndCutoff;\n#if USE_VERTEX_COLOR\nvarying lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no.rgb *= SRGBToLinear(v_color.rgb);\no.a *= v_color.a;\n#endif\n#if USE_TEXTURE\nvec4 texColor = texture2D(mainTexture, v_uv);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\no *= texColor;\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\nCC_APPLY_FOG(o);\nreturn CCFragOutput(o);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D outputResultMap;\nfloat luminance(vec3 color) {\nreturn dot(color, vec3(0.2126, 0.7152, 0.0722));\n}\nvoid main() {\nvec3 color = texture2D(outputResultMap, v_uv).xyz;\nif (luminance(SRGBToLinear(color)) > texSize.z) {\ngl_FragColor = vec4(color, 1.0);\n} else {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n}"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D bloomTexture;\nvec3 downsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture2D(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main()\n{\nvec3 result = downsample4taps(v_uv, 1.0 / texSize.xy).rgb;\ngl_FragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D bloomTexture;\nvec3 upsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture2D(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main() {\nvec3 result = upsample4taps(v_uv, 0.5 / texSize.xy).rgb;\ngl_FragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D outputResultMap;\nuniform sampler2D bloomTexture;\nvoid main() {\nvec4 hdrColor = texture2D(outputResultMap, v_uv);\nvec3 bloomColor = texture2D(bloomTexture, v_uv).rgb;\nvec3 result = hdrColor.rgb + bloomColor * texSize.w * hdrColor.a;\ngl_FragColor = vec4(result, hdrColor.a);\n}"}],[{vert:"\nprecision highp float;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\n#ifdef GL_EXT_shader_framebuffer_fetch\n#extension GL_EXT_shader_framebuffer_fetch: enable\n#endif\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewProjInv;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform mediump vec4 cc_nearFar;\nuniform mediump vec4 cc_viewPort;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp mat4 cc_matLightViewProj;\nuniform highp vec4 cc_shadowInvProjDepthInfo;\nuniform highp vec4 cc_shadowProjDepthInfo;\nuniform highp vec4 cc_shadowProjInfo;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = textureCube(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = textureCube(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nreadonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nreadonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nreadonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec3 oct_to_float32x3(vec2 e) {\nvec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\nif (v.z < 0.0) v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\nreturn normalize(v);\n}\nvec4 screen2WS(vec3 coord) {\nvec3 ndc = vec3(\n2.0 * (coord.x - cc_viewPort.x) / cc_viewPort.z - 1.0,\n2.0 * (coord.y - cc_viewPort.y) / cc_viewPort.w - 1.0,\n2.0 * coord.z - 1.0);\nvec4 world = ((cc_matViewProjInv) * (vec4(ndc, 1.0)));\nworld      = world / world.w;\nreturn world;\n}\nvarying vec2 v_uv;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\n#else\nuniform sampler2D gbuffer_albedoMap;\nuniform sampler2D gbuffer_normalMap;\nuniform sampler2D gbuffer_emissiveMap;\n#endif\nuniform sampler2D depth_stencil;\n#if !CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT || __VERSION__ >= 450\n#endif\nvoid main () {\nStandardSurface s;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nvec4 albedoMap = gl_LastFragData[0];\nvec4 normalMap = gl_LastFragData[1];\nvec4 emissiveMap = gl_LastFragDat[2];\n#else\nvec4 albedoMap = texture2D(gbuffer_albedoMap,v_uv);\nvec4 normalMap = texture2D(gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture2D(gbuffer_emissiveMap,v_uv);\n#endif\nfloat depth = texture2D(depth_stencil, v_uv).x;\ns.albedo = albedoMap;\nvec3 position = screen2WS(vec3(gl_FragCoord.xy, depth)).xyz;\ns.position = position;\ns.roughness = normalMap.z;\ns.normal = oct_to_float32x3(normalMap.xy);\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\nCC_TRANSFER_FOG_BASE(vec4(position, 1), fogFactor);\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nCCClusterShadingAdditive(s, shadowPos);\n#else\nCCStandardShadingAdditive(s, shadowPos);\n#endif\nCC_APPLY_FOG_BASE(color, fogFactor);\ncolor = CCFragOutput(color);\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\ngl_FragData[2] = color;\n#else\ngl_FragColor = color;\n#endif\n}"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nuniform mediump vec4 cc_planarNDInfo;\nvarying float v_dist;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\nvec3 P = (matWorld * position).xyz;\nvec3 L = cc_mainLitDir.xyz;\nvec3 N = cc_planarNDInfo.xyz;\nfloat d = cc_planarNDInfo.w + 0.001;\nfloat dist = (-d - dot(P, N)) / (dot(L, N) + 0.0001);\nvec3 shadowPos = P + L * dist;\nvec3 view = normalize(cc_cameraPos.xyz - shadowPos);\nfloat viewLength = length(cc_cameraPos.xyz - shadowPos);\nshadowPos += view * min(1.0, 0.005 * viewLength);\nposition = cc_matProj * cc_matView * vec4(shadowPos, 1.0);\nv_dist = dist;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform lowp vec4 cc_shadowColor;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying float v_dist;\nvec4 frag () {\nif(v_dist < 0.0)\ndiscard;\nreturn CCFragOutput(cc_shadowColor);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nuniform mediump vec4 cc_screenSize;\n#if ANTIALIAS_TYPE == 1\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\nvec4 texColor = texture2D(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\n#endif\nvarying vec2 v_uv;\nuniform sampler2D outputResultMap;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\n#if ANTIALIAS_TYPE == 1\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\ngl_FragColor = fxaa(outputResultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n#else\ngl_FragColor = texture2D(outputResultMap, v_uv);\n#endif\n}"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\nvarying mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nvec4 pos = matViewRotOnly * viewDir;\nif (cc_matProj[3].w > 0.0) {\nmat4 matProj = cc_matProj;\nmatProj[0].x = 5.2;\nmatProj[1].y = 2.6;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\npos = matProj * pos;\n} else {\npos = cc_matProj * pos;\n}\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_ambientSky;\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nvarying mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(textureCube(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(textureCube(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matProj;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec2 v_uv;\nuniform vec4 offset;\nuniform vec4 digits[20];\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nmat2 proj = mat2(cc_matProj[0].xy, cc_matProj[1].xy);\nproj /= abs(proj[1].x + proj[1].y);\nvec2 position = proj * a_position.xy + offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn vec4(position, 0.0, 1.0);\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture2D(mainTexture, v_uv));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_uv;\nuniform vec4 u_buffer0;\nuniform vec4 u_buffer1;\nuniform mat4 u_projection;\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvarying vec2 v_uv;\nuniform float u_percent;\nuniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture2D(mainTexture, v_uv);\nfloat percent = clamp(u_percent, 0.0, 1.0);\ncolor.xyz *= percent;\nreturn color;\n}\nvoid main() { gl_FragColor = frag(); }"}]],glsl3:[[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nlayout(std140) uniform builtin {\nvec4 cc_size_rotation;\n};\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nin vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nin float a_dist;\nout float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nin vec4 v_color;\nin float v_dist;\nvec4 frag () {\nvec4 o = v_color;\nfloat aa = fwidth(v_dist);\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCWorldBound {\nhighp vec4 cc_worldBoundCenter;\nhighp vec4 cc_worldBoundHalfExtents;\n};\nin vec3 a_position;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition *= cc_worldBoundHalfExtents;\nposition += cc_worldBoundCenter;\nposition = cc_matViewProj * position;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 frag () {\nreturn vec4(1, 0, 0, 1);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nvec4 eulerToQuat(vec3 euler) {\nvec3 er = euler * 0.5;\nfloat x = er.x, y = er.y, z = er.z;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat;\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nlayout(std140) uniform SampleConstants {\nvec4 u_sampleInfo;\n};\nlayout(std140) uniform TickConstants {\nvec4 u_worldRot;\nvec4 u_timeDelta;\n};\nin vec4 a_position_starttime;\nin vec4 a_size_uv;\nin vec4 a_rotation_uv;\nin vec4 a_color;\nin vec4 a_dir_life;\nin float a_rndSeed;\n#if CC_RENDER_MODE == 4\nin vec3 a_texCoord;\nin vec3 a_texCoord3;\nin vec3 a_normal;\nin vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom(float x) {\n#if USE_VK_SHADER\nfloat o = x;\nx = mod(x - 1.0, 2.0) - 1.0;\nfloat freqVar = 10.16640753482;\nfloat y = sin(freqVar * floor(o * 0.5 - 0.5));\nfloat v = max(0.0, 1.0-abs(x));\nv *= 0.7071067812;\nv = y < 0.0 ? -v : v;\nreturn v;\n#else\nfloat seed = mod(x, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n#endif\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nuniform sampler2D color_over_time_tex0;\nlayout(std140) uniform ColorConstant {\nint u_color_mode;\n};\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nuniform sampler2D rotation_over_time_tex0;\nlayout(std140) uniform RotationConstant {\nint u_rotation_mode;\n};\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D size_over_time_tex0;\nlayout(std140) uniform SizeConstant {\nint u_size_mode;\n};\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D force_over_time_tex0;\nlayout(std140) uniform ForceConstant {\nint u_force_mode;\nint u_force_space;\n};\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nuniform sampler2D velocity_over_time_tex0;\nlayout(std140) uniform VelocityConstant {\nint u_velocity_mode;\nint u_velocity_space;\n};\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nuniform sampler2D texture_animation_tex0;\nlayout(std140) uniform AnimationConstant {\nvec4 u_anim_info;\n};\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 startRotation = a_rotation_uv.xyz;\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = startRotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., startRotation.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(startRotation);\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nvec3 euler = unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nvec3 euler = mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n#if CC_RENDER_MODE == 3 || CC_RENDER_MODE == 2\neuler = vec3(0.0, 0.0, euler.z);\n#endif\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 1\nrot = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\ncomputeVertPos(pos, cornerOffset, rot, compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nout vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\n#if CC_DRAW_WIRE_FRAME\nin vec3 vBarycentric;\n#endif\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nin vec3 a_position;\nin vec3 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_RENDER_MODE == 1\nin vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nin vec3 a_texCoord3;\nin vec3 a_normal;\nin vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nvec3 rotTmp = a_texCoord2;\nfloat mulFactor = 1.0;\nif (rotTmp.x > 10.0 * 0.5) {\nrotTmp.x -= 10.0;\nmulFactor = -1.0;\n}\nvec4 rot = vec4(rotTmp, 0.0);\nrot.w = mulFactor * sqrt(abs(1.0 - rot.x * rot.x - rot.y * rot.y - rot.z * rot.z));\n#else\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(a_texCoord2);\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_matViewInv);\n#elif CC_RENDER_MODE == 1\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_cameraPos.xyz, velocity, frameTile_velLenScale.z, frameTile_velLenScale.w, a_texCoord.x);\n#elif 2\ncomputeVertPos(pos, cornerOffset, rot, compScale);\n#endif\ncolor = a_color;\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 v_light;\nout vec2 uv0;\n#if TWO_COLORED\nin vec4 a_color2;\nout vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nlayout(std140) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nin vec4 v_light;\n#if TWO_COLORED\nin vec4 v_dark;\n#endif\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\n#if SAMPLE_FROM_RT\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 color;\nout vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture(tex, uv).rgb, texture(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nlayout(std140) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nin vec4 color;\n#if USE_TEXTURE\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nout float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\n#if USE_VERTEX_COLOR\nin vec4 a_color;\nout vec4 v_color;\n#endif\nout vec3 v_position;\nout vec3 v_normal;\nout vec2 v_uv;\nout vec2 v_uv1;\n#if USE_NORMAL_MAP\nout vec3 v_tangent;\nout vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\nin vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nout vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\nv_luv.z = cc_lightingMapUVParam.z;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\nv_luv.z = a_lightingMapUVParam.z;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if USE_TWOSIDE\nvec3 viewDirect = normalize(cc_cameraPos.xyz - v_position);\nv_normal *= dot(v_normal, viewDirect) < 0.0 ? -1.0 : 1.0;\n#endif\n#if USE_NORMAL_MAP\nv_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(pos);\nv_shadowPos = cc_matLightViewProj * pos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nin float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nin highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nin vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nin vec3 v_position;\nin vec2 v_uv;\nin vec2 v_uv1;\nin vec3 v_normal;\n#if USE_VERTEX_COLOR\nin vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nin vec3 v_tangent;\nin vec3 v_bitangent;\nuniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nuniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nuniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nuniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor.rgb *= SRGBToLinear(v_color.rgb);\nbaseColor.a *= v_color.a;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(cc_lightingMap, v_luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if USE_NORMAL_MAP\nvec3 nmmp = texture(normalMap, NORMAL_UV).xyz - vec3(0.5);\ns.normal =\n(nmmp.x * emissiveScaleParam.w) * normalize(v_tangent) +\n(nmmp.y * emissiveScaleParam.w) * normalize(v_bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\npbr.w *= res.a;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = pbr.x;\ns.roughness = pbr.y;\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(std430, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(std430, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(std430, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\nfragColor2 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if HAS_SECOND_UV || USE_LIGHTMAP\nin vec2 a_texCoord1;\n#endif\nout vec2 v_uv;\nout vec2 v_uv1;\nout vec4 v_worldPos;\nout float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\nin vec2 v_uv;\nin vec2 v_uv1;\nin vec4 v_worldPos;\nin float v_clip_depth;\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nreturn vec4(CCGetLinearDepth(v_worldPos.xyz), 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nout float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout highp vec3 v_position;\nout mediump vec3 v_normal;\n#if USE_NORMALMAP\nout mediump vec3 v_tangent;\nout mediump vec3 v_binormal;\n#endif\nout mediump vec2 uvw;\nout mediump vec2 uv0;\nout mediump vec2 uv1;\nout mediump vec2 uv2;\nout mediump vec2 uv3;\nout mediump vec3 luv;\nout mediump vec3 diffuse;\nlayout(std140) uniform TexCoords {\nvec4 UVScale;\nvec4 lightMapUVParam;\n};\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\nluv.z = lightMapUVParam.z;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\nCC_TRANSFER_FOG(vec4(worldPos, 1.0));\n#if USE_NORMALMAP\nv_tangent = vec3(1.0, 0.0, 0.0);\nv_binormal = vec3(0.0, 0.0, 1.0);\nv_binormal = cross(v_tangent, a_normal);\nv_tangent = cross(a_normal, v_binormal);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nin float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nin highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nin vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nin highp vec3 v_position;\nin mediump vec3 v_normal;\n#if USE_NORMALMAP\nin mediump vec3 v_tangent;\nin mediump vec3 v_binormal;\n#endif\nin mediump vec2 uvw;\nin mediump vec2 uv0;\nin mediump vec2 uv1;\nin mediump vec2 uv2;\nin mediump vec2 uv3;\nin mediump vec3 diffuse;\nin mediump vec3 luv;\nlayout(std140) uniform PbrParams {\nvec4 metallic;\nvec4 roughness;\n};\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\nbaseColor += texture(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture(detailMap0, uv0);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\nbaseNormal += texture(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture(normalMap0, uv0);\n#endif\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(v_tangent) +\nnmmp.y * normalize(v_binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.metallic = 0.0;\n#if LAYERS == 1\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(lightMap, luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(std430, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(std430, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(std430, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\nfragColor2 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nin vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nout float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\n#if USE_VERTEX_COLOR\nin lowp vec4 a_color;\nout lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nout vec2 v_uv;\nlayout(std140) uniform TexCoords {\nvec4 tilingOffset;\n};\n#endif\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(matWorld * position);\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nin float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nin vec2 v_uv;\nuniform sampler2D mainTexture;\n#endif\nlayout(std140) uniform Constant {\nvec4 mainColor;\nvec4 colorScaleAndCutoff;\n};\n#if USE_VERTEX_COLOR\nin lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no.rgb *= SRGBToLinear(v_color.rgb);\no.a *= v_color.a;\n#endif\n#if USE_TEXTURE\nvec4 texColor = texture(mainTexture, v_uv);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\no *= texColor;\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\nCC_APPLY_FOG(o);\nreturn CCFragOutput(o);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D outputResultMap;\nlayout(location = 0) out vec4 fragColor;\nfloat luminance(vec3 color) {\nreturn dot(color, vec3(0.2126, 0.7152, 0.0722));\n}\nvoid main() {\nvec3 color = texture(outputResultMap, v_uv).xyz;\nif (luminance(SRGBToLinear(color)) > texSize.z) {\nfragColor = vec4(color, 1.0);\n} else {\nfragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n}"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvec3 downsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main()\n{\nvec3 result = downsample4taps(v_uv, 1.0 / texSize.xy).rgb;\nfragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvec3 upsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main() {\nvec3 result = upsample4taps(v_uv, 0.5 / texSize.xy).rgb;\nfragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D outputResultMap;\nuniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvoid main() {\nvec4 hdrColor = texture(outputResultMap, v_uv);\nvec3 bloomColor = texture(bloomTexture, v_uv).rgb;\nvec3 result = hdrColor.rgb + bloomColor * texSize.w * hdrColor.a;\nfragColor = vec4(result, hdrColor.a);\n}"}],[{vert:"\nprecision highp float;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\n#ifdef GL_EXT_shader_framebuffer_fetch\n#extension GL_EXT_shader_framebuffer_fetch: enable\n#endif\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(std430, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(std430, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(std430, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec3 oct_to_float32x3(vec2 e) {\nvec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\nif (v.z < 0.0) v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\nreturn normalize(v);\n}\nvec4 screen2WS(vec3 coord) {\nvec3 ndc = vec3(\n2.0 * (coord.x - cc_viewPort.x) / cc_viewPort.z - 1.0,\n2.0 * (coord.y - cc_viewPort.y) / cc_viewPort.w - 1.0,\n2.0 * coord.z - 1.0);\nvec4 world = ((cc_matViewProjInv) * (vec4(ndc, 1.0)));\nworld      = world / world.w;\nreturn world;\n}\nin vec2 v_uv;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nlayout(location = 0) inout vec4 gbuffer_albedoMap;\nlayout(location = 1) inout vec4 gbuffer_normalMap;\nlayout(location = 2) inout vec4 gbuffer_emissiveMap;\n#else\nuniform sampler2D gbuffer_albedoMap;\nuniform sampler2D gbuffer_normalMap;\nuniform sampler2D gbuffer_emissiveMap;\n#endif\nuniform sampler2D depth_stencil;\n#if !CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT || __VERSION__ >= 450\nlayout(location = 0) out vec4 fragColor;\n#endif\nvoid main () {\nStandardSurface s;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nvec4 albedoMap = gbuffer_albedoMap;\nvec4 normalMap = gbuffer_normalMap;\nvec4 emissiveMap = gbuffer_emissiveMap;\n#else\nvec4 albedoMap = texture(gbuffer_albedoMap,v_uv);\nvec4 normalMap = texture(gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture(gbuffer_emissiveMap,v_uv);\n#endif\nfloat depth = texture(depth_stencil, v_uv).x;\ns.albedo = albedoMap;\nvec3 position = screen2WS(vec3(gl_FragCoord.xy, depth)).xyz;\ns.position = position;\ns.roughness = normalMap.z;\ns.normal = oct_to_float32x3(normalMap.xy);\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\nCC_TRANSFER_FOG_BASE(vec4(position, 1), fogFactor);\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nCCClusterShadingAdditive(s, shadowPos);\n#else\nCCStandardShadingAdditive(s, shadowPos);\n#endif\nCC_APPLY_FOG_BASE(color, fogFactor);\ncolor = CCFragOutput(color);\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\ngbuffer_emissiveMap = color;\n#else\nfragColor = color;\n#endif\n}"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nout float v_dist;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\nvec3 P = (matWorld * position).xyz;\nvec3 L = cc_mainLitDir.xyz;\nvec3 N = cc_planarNDInfo.xyz;\nfloat d = cc_planarNDInfo.w + 0.001;\nfloat dist = (-d - dot(P, N)) / (dot(L, N) + 0.0001);\nvec3 shadowPos = P + L * dist;\nvec3 view = normalize(cc_cameraPos.xyz - shadowPos);\nfloat viewLength = length(cc_cameraPos.xyz - shadowPos);\nshadowPos += view * min(1.0, 0.005 * viewLength);\nposition = cc_matProj * cc_matView * vec4(shadowPos, 1.0);\nv_dist = dist;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin float v_dist;\nvec4 frag () {\nif(v_dist < 0.0)\ndiscard;\nreturn CCFragOutput(cc_shadowColor);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if ANTIALIAS_TYPE == 1\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture(tex, v_rgbSE).xyz;\nvec4 texColor = texture(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\n#endif\nin vec2 v_uv;\nuniform sampler2D outputResultMap;\nlayout(location = 0) out vec4 fragColor;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\n#if ANTIALIAS_TYPE == 1\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\nfragColor = fxaa(outputResultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n#else\nfragColor = texture(outputResultMap, v_uv);\n#endif\n}"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\nout mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nvec4 pos = matViewRotOnly * viewDir;\nif (cc_matProj[3].w > 0.0) {\nmat4 matProj = cc_matProj;\nmatProj[0].x = 5.2;\nmatProj[1].y = 2.6;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\npos = matProj * pos;\n} else {\npos = cc_matProj * pos;\n}\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nin mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(texture(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(texture(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec2 v_uv;\nlayout(std140) uniform Constants {\nvec4 offset;\n};\nlayout(std140) uniform PerFrameInfo {\nvec4 digits[8 * 10 / 4];\n};\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nmat2 proj = mat2(cc_matProj[0].xy, cc_matProj[1].xy);\nproj /= abs(proj[1].x + proj[1].y);\nvec2 position = proj * a_position.xy + offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn vec4(position, 0.0, 1.0);\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture(mainTexture, v_uv));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_uv;\nlayout(std140) uniform Constant {\nvec4 u_buffer0;\nvec4 u_buffer1;\nmat4 u_projection;\n};\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nin vec2 v_uv;\nlayout(std140) uniform Factor {\nfloat u_percent;\n};\nuniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture(mainTexture, v_uv);\nfloat percent = clamp(u_percent, 0.0, 1.0);\ncolor.xyz *= percent;\nreturn color;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}]],glsl4:[[{vert:"\nprecision mediump float;\nlayout(set = 1, binding = 0) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nlayout(location = 0) out mediump vec2 uv;\nlayout(location = 1) out mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec2 a_texCoord;\nlayout(location = 2) in vec4 a_color;\nlayout(set = 1, binding = 1) uniform builtin {\nvec4 cc_size_rotation;\n};\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nlayout(location = 0) in vec2 uv;\nlayout(location = 1) in vec4 color;\nlayout(set = 1, binding = 3) uniform sampler2D mainTexture;\nlayout(set = 1, binding = 2) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nlayout(location = 0) in vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec4 a_color;\nlayout(location = 0) out vec4 v_color;\nlayout(location = 2) in float a_dist;\nlayout(location = 1) out float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(location = 0) in vec4 v_color;\nlayout(location = 1) in float v_dist;\nvec4 frag () {\nvec4 o = v_color;\nfloat aa = fwidth(v_dist);\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(set = 2, binding = 0) uniform CCWorldBound {\nhighp vec4 cc_worldBoundCenter;\nhighp vec4 cc_worldBoundHalfExtents;\n};\nlayout(location = 0) in vec3 a_position;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition *= cc_worldBoundHalfExtents;\nposition += cc_worldBoundCenter;\nposition = cc_matViewProj * position;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 frag () {\nreturn vec4(1, 0, 0, 1);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nvec4 eulerToQuat(vec3 euler) {\nvec3 er = euler * 0.5;\nfloat x = er.x, y = er.y, z = er.z;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat;\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nlayout(set = 1, binding = 0) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nlayout(location = 0) out mediump vec2 uv;\nlayout(location = 1) out mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nlayout(set = 1, binding = 1) uniform SampleConstants {\nvec4 u_sampleInfo;\n};\nlayout(set = 1, binding = 2) uniform TickConstants {\nvec4 u_worldRot;\nvec4 u_timeDelta;\n};\nlayout(location = 0) in vec4 a_position_starttime;\nlayout(location = 1) in vec4 a_size_uv;\nlayout(location = 2) in vec4 a_rotation_uv;\nlayout(location = 3) in vec4 a_color;\nlayout(location = 4) in vec4 a_dir_life;\nlayout(location = 5) in float a_rndSeed;\n#if CC_RENDER_MODE == 4\nlayout(location = 6) in vec3 a_texCoord;\nlayout(location = 7) in vec3 a_texCoord3;\nlayout(location = 8) in vec3 a_normal;\nlayout(location = 9) in vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom(float x) {\n#if USE_VK_SHADER\nfloat o = x;\nx = mod(x - 1.0, 2.0) - 1.0;\nfloat freqVar = 10.16640753482;\nfloat y = sin(freqVar * floor(o * 0.5 - 0.5));\nfloat v = max(0.0, 1.0-abs(x));\nv *= 0.7071067812;\nv = y < 0.0 ? -v : v;\nreturn v;\n#else\nfloat seed = mod(x, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n#endif\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nlayout(set = 1, binding = 10) uniform sampler2D color_over_time_tex0;\nlayout(set = 1, binding = 3) uniform ColorConstant {\nint u_color_mode;\n};\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nlayout(set = 1, binding = 11) uniform sampler2D rotation_over_time_tex0;\nlayout(set = 1, binding = 4) uniform RotationConstant {\nint u_rotation_mode;\n};\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nlayout(set = 1, binding = 12) uniform sampler2D size_over_time_tex0;\nlayout(set = 1, binding = 5) uniform SizeConstant {\nint u_size_mode;\n};\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nlayout(set = 1, binding = 13) uniform sampler2D force_over_time_tex0;\nlayout(set = 1, binding = 6) uniform ForceConstant {\nint u_force_mode;\nint u_force_space;\n};\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nlayout(set = 1, binding = 14) uniform sampler2D velocity_over_time_tex0;\nlayout(set = 1, binding = 7) uniform VelocityConstant {\nint u_velocity_mode;\nint u_velocity_space;\n};\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nlayout(set = 1, binding = 15) uniform sampler2D texture_animation_tex0;\nlayout(set = 1, binding = 8) uniform AnimationConstant {\nvec4 u_anim_info;\n};\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 startRotation = a_rotation_uv.xyz;\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = startRotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., startRotation.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(startRotation);\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nvec3 euler = unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nvec3 euler = mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n#if CC_RENDER_MODE == 3 || CC_RENDER_MODE == 2\neuler = vec3(0.0, 0.0, euler.z);\n#endif\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 1\nrot = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\ncomputeVertPos(pos, cornerOffset, rot, compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nlayout(location = 0) in vec2 uv;\nlayout(location = 1) in vec4 color;\nlayout(set = 1, binding = 16) uniform sampler2D mainTexture;\nlayout(set = 1, binding = 9) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nlayout(set = 1, binding = 0) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nlayout(location = 0) out mediump vec2 uv;\nlayout(location = 1) out mediump vec4 color;\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec4 a_texCoord;\nlayout(location = 2) in vec3 a_texCoord1;\nlayout(location = 3) in vec3 a_texCoord2;\nlayout(location = 4) in vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nlayout(location = 2) out vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nlayout(location = 0) in vec2 uv;\nlayout(location = 1) in vec4 color;\n#if CC_DRAW_WIRE_FRAME\nlayout(location = 2) in vec3 vBarycentric;\n#endif\nlayout(set = 1, binding = 2) uniform sampler2D mainTexture;\nlayout(set = 1, binding = 1) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nlayout(set = 1, binding = 0) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nlayout(location = 0) out mediump vec2 uv;\nlayout(location = 1) out mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_texCoord;\nlayout(location = 2) in vec3 a_texCoord1;\nlayout(location = 3) in vec3 a_texCoord2;\nlayout(location = 4) in vec4 a_color;\n#if CC_RENDER_MODE == 1\nlayout(location = 8) in vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nlayout(location = 6) in vec3 a_texCoord3;\nlayout(location = 7) in vec3 a_normal;\nlayout(location = 8) in vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nvec3 rotTmp = a_texCoord2;\nfloat mulFactor = 1.0;\nif (rotTmp.x > 10.0 * 0.5) {\nrotTmp.x -= 10.0;\nmulFactor = -1.0;\n}\nvec4 rot = vec4(rotTmp, 0.0);\nrot.w = mulFactor * sqrt(abs(1.0 - rot.x * rot.x - rot.y * rot.y - rot.z * rot.z));\n#else\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(a_texCoord2);\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_matViewInv);\n#elif CC_RENDER_MODE == 1\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_cameraPos.xyz, velocity, frameTile_velLenScale.z, frameTile_velLenScale.w, a_texCoord.x);\n#elif 2\ncomputeVertPos(pos, cornerOffset, rot, compScale);\n#endif\ncolor = a_color;\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nlayout(location = 0) in vec2 uv;\nlayout(location = 1) in vec4 color;\nlayout(set = 1, binding = 2) uniform sampler2D mainTexture;\nlayout(set = 1, binding = 1) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_LOCAL\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec2 a_texCoord;\nlayout(location = 2) in vec4 a_color;\nlayout(location = 0) out vec4 v_light;\nlayout(location = 1) out vec2 uv0;\n#if TWO_COLORED\nlayout(location = 3) in vec4 a_color2;\nlayout(location = 2) out vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nlayout(set = 1, binding = 0) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nlayout(location = 0) in vec4 v_light;\n#if TWO_COLORED\nlayout(location = 2) in vec4 v_dark;\n#endif\nlayout(location = 1) in vec2 uv0;\nlayout(set = 2, binding = 11) uniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_LOCAL\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\n#if SAMPLE_FROM_RT\n#endif\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec2 a_texCoord;\nlayout(location = 2) in vec4 a_color;\nlayout(location = 0) out vec4 color;\nlayout(location = 1) out vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture(tex, uv).rgb, texture(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nlayout(set = 1, binding = 0) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nlayout(location = 0) in vec4 color;\n#if USE_TEXTURE\nlayout(location = 1) in vec2 uv0;\nlayout(set = 2, binding = 11) uniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"#extension GL_EXT_shader_explicit_arithmetic_types_int32: require\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 3) in vec4 a_tangent;\n#if CC_USE_MORPH\nint getVertexId() {\nreturn gl_VertexIndex;\n}\nlayout(set = 2, binding = 4) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nlayout(set = 2, binding = 7) uniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nlayout(set = 2, binding = 8) uniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nlayout(set = 2, binding = 9) uniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nlayout(location = 4) in u32vec4 a_joints;\nlayout(location = 5) in vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nlayout(location = 7) in highp vec4 a_jointAnimInfo;\n#endif\nlayout(set = 2, binding = 3) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(set = 2, binding = 2) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nlayout(set = 2, binding = 6) uniform highp sampler2D cc_jointTexture;\n#else\nlayout(set = 2, binding = 3) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_INSTANCING\nlayout(location = 8) in vec4 a_matWorld0;\nlayout(location = 9) in vec4 a_matWorld1;\nlayout(location = 10) in vec4 a_matWorld2;\n#if USE_LIGHTMAP\nlayout(location = 11) in vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nlayout(location = 12) in float a_dyn_batch_id;\nlayout(set = 2, binding = 0) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(set = 1, binding = 0) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nlayout(location = 0) out float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nlayout(location = 1) out highp vec4 v_shadowPos;\nlayout(set = 0, binding = 2) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if CC_RECEIVE_SHADOW\nlayout(set = 0, binding = 3) uniform highp sampler2D cc_shadowMap;\nlayout(set = 0, binding = 5) uniform highp sampler2D cc_spotLightingMap;\n#endif\n#if USE_VERTEX_COLOR\nlayout(location = 13) in vec4 a_color;\nlayout(location = 2) out vec4 v_color;\n#endif\nlayout(location = 3) out vec3 v_position;\nlayout(location = 4) out vec3 v_normal;\nlayout(location = 5) out vec2 v_uv;\nlayout(location = 6) out vec2 v_uv1;\n#if USE_NORMAL_MAP\nlayout(location = 7) out vec3 v_tangent;\nlayout(location = 8) out vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\nlayout(location = 14) in vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nlayout(location = 9) out vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\nv_luv.z = cc_lightingMapUVParam.z;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\nv_luv.z = a_lightingMapUVParam.z;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if USE_TWOSIDE\nvec3 viewDirect = normalize(cc_cameraPos.xyz - v_position);\nv_normal *= dot(v_normal, viewDirect) < 0.0 ? -1.0 : 1.0;\n#endif\n#if USE_NORMAL_MAP\nv_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(pos);\nv_shadowPos = cc_matLightViewProj * pos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(set = 1, binding = 0) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nlayout(location = 0) in float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(set = 0, binding = 2) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nlayout(set = 0, binding = 3) uniform highp sampler2D cc_shadowMap;\nlayout(set = 0, binding = 5) uniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nlayout(set = 0, binding = 4) uniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nlayout(set = 0, binding = 6) uniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nlayout(location = 1) in highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nlayout(location = 9) in vec3 v_luv;\nlayout(set = 2, binding = 10) uniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nlayout(location = 3) in vec3 v_position;\nlayout(location = 5) in vec2 v_uv;\nlayout(location = 6) in vec2 v_uv1;\nlayout(location = 4) in vec3 v_normal;\n#if USE_VERTEX_COLOR\nlayout(location = 2) in vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nlayout(set = 1, binding = 1) uniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nlayout(location = 7) in vec3 v_tangent;\nlayout(location = 8) in vec3 v_bitangent;\nlayout(set = 1, binding = 2) uniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nlayout(set = 1, binding = 3) uniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nlayout(set = 1, binding = 4) uniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nlayout(set = 1, binding = 5) uniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nlayout(set = 1, binding = 6) uniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor.rgb *= SRGBToLinear(v_color.rgb);\nbaseColor.a *= v_color.a;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(cc_lightingMap, v_luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if USE_NORMAL_MAP\nvec3 nmmp = texture(normalMap, NORMAL_UV).xyz - vec3(0.5);\ns.normal =\n(nmmp.x * emissiveScaleParam.w) * normalize(v_tangent) +\n(nmmp.y * emissiveScaleParam.w) * normalize(v_bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\npbr.w *= res.a;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = pbr.x;\ns.roughness = pbr.y;\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(set = 2, binding = 1) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(set = 1, binding = 7) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(set = 1, binding = 8) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(set = 1, binding = 9) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\nfragColor2 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"#extension GL_EXT_shader_explicit_arithmetic_types_int32: require\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 3) in vec4 a_tangent;\n#if CC_USE_MORPH\nint getVertexId() {\nreturn gl_VertexIndex;\n}\nlayout(set = 2, binding = 4) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nlayout(set = 2, binding = 7) uniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nlayout(set = 2, binding = 8) uniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nlayout(set = 2, binding = 9) uniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nlayout(location = 4) in u32vec4 a_joints;\nlayout(location = 5) in vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nlayout(location = 7) in highp vec4 a_jointAnimInfo;\n#endif\nlayout(set = 2, binding = 3) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(set = 2, binding = 2) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nlayout(set = 2, binding = 6) uniform highp sampler2D cc_jointTexture;\n#else\nlayout(set = 2, binding = 3) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\nlayout(location = 8) in vec4 a_matWorld0;\nlayout(location = 9) in vec4 a_matWorld1;\nlayout(location = 10) in vec4 a_matWorld2;\n#if USE_LIGHTMAP\nlayout(location = 11) in vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nlayout(location = 12) in float a_dyn_batch_id;\nlayout(set = 2, binding = 0) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(set = 1, binding = 0) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nlayout(set = 0, binding = 2) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if HAS_SECOND_UV || USE_LIGHTMAP\nlayout(location = 13) in vec2 a_texCoord1;\n#endif\nlayout(location = 0) out vec2 v_uv;\nlayout(location = 1) out vec2 v_uv1;\nlayout(location = 2) out vec4 v_worldPos;\nlayout(location = 3) out float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(set = 1, binding = 0) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(set = 0, binding = 2) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nlayout(set = 0, binding = 3) uniform highp sampler2D cc_shadowMap;\nlayout(set = 0, binding = 5) uniform highp sampler2D cc_spotLightingMap;\n#endif\nlayout(location = 0) in vec2 v_uv;\nlayout(location = 1) in vec2 v_uv1;\nlayout(location = 2) in vec4 v_worldPos;\nlayout(location = 3) in float v_clip_depth;\n#if USE_ALBEDO_MAP\nlayout(set = 1, binding = 1) uniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nreturn vec4(CCGetLinearDepth(v_worldPos.xyz), 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nlayout(location = 0) out float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nlayout(location = 1) out highp vec4 v_shadowPos;\nlayout(set = 0, binding = 2) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if CC_RECEIVE_SHADOW\nlayout(set = 0, binding = 3) uniform highp sampler2D cc_shadowMap;\nlayout(set = 0, binding = 5) uniform highp sampler2D cc_spotLightingMap;\n#endif\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 2) out highp vec3 v_position;\nlayout(location = 3) out mediump vec3 v_normal;\n#if USE_NORMALMAP\nlayout(location = 4) out mediump vec3 v_tangent;\nlayout(location = 5) out mediump vec3 v_binormal;\n#endif\nlayout(location = 6) out mediump vec2 uvw;\nlayout(location = 7) out mediump vec2 uv0;\nlayout(location = 8) out mediump vec2 uv1;\nlayout(location = 9) out mediump vec2 uv2;\nlayout(location = 10) out mediump vec2 uv3;\nlayout(location = 11) out mediump vec3 luv;\nlayout(location = 12) out mediump vec3 diffuse;\nlayout(set = 1, binding = 0) uniform TexCoords {\nvec4 UVScale;\nvec4 lightMapUVParam;\n};\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\nluv.z = lightMapUVParam.z;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\nCC_TRANSFER_FOG(vec4(worldPos, 1.0));\n#if USE_NORMALMAP\nv_tangent = vec3(1.0, 0.0, 0.0);\nv_binormal = vec3(0.0, 0.0, 1.0);\nv_binormal = cross(v_tangent, a_normal);\nv_tangent = cross(a_normal, v_binormal);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(set = 0, binding = 2) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nlayout(set = 0, binding = 3) uniform highp sampler2D cc_shadowMap;\nlayout(set = 0, binding = 5) uniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nlayout(set = 0, binding = 4) uniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nlayout(set = 0, binding = 6) uniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nlayout(location = 0) in float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nlayout(location = 1) in highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nlayout(location = 13) in vec3 v_luv;\nlayout(set = 2, binding = 10) uniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nlayout(location = 2) in highp vec3 v_position;\nlayout(location = 3) in mediump vec3 v_normal;\n#if USE_NORMALMAP\nlayout(location = 4) in mediump vec3 v_tangent;\nlayout(location = 5) in mediump vec3 v_binormal;\n#endif\nlayout(location = 6) in mediump vec2 uvw;\nlayout(location = 7) in mediump vec2 uv0;\nlayout(location = 8) in mediump vec2 uv1;\nlayout(location = 9) in mediump vec2 uv2;\nlayout(location = 10) in mediump vec2 uv3;\nlayout(location = 12) in mediump vec3 diffuse;\nlayout(location = 11) in mediump vec3 luv;\nlayout(set = 1, binding = 1) uniform PbrParams {\nvec4 metallic;\nvec4 roughness;\n};\nlayout(set = 1, binding = 2) uniform sampler2D weightMap;\nlayout(set = 1, binding = 3) uniform sampler2D detailMap0;\nlayout(set = 1, binding = 4) uniform sampler2D detailMap1;\nlayout(set = 1, binding = 5) uniform sampler2D detailMap2;\nlayout(set = 1, binding = 6) uniform sampler2D detailMap3;\nlayout(set = 1, binding = 7) uniform sampler2D normalMap0;\nlayout(set = 1, binding = 8) uniform sampler2D normalMap1;\nlayout(set = 1, binding = 9) uniform sampler2D normalMap2;\nlayout(set = 1, binding = 10) uniform sampler2D normalMap3;\nlayout(set = 1, binding = 11) uniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\nbaseColor += texture(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture(detailMap0, uv0);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\nbaseNormal += texture(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture(normalMap0, uv0);\n#endif\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(v_tangent) +\nnmmp.y * normalize(v_binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.metallic = 0.0;\n#if LAYERS == 1\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(lightMap, luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(set = 2, binding = 1) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(set = 1, binding = 12) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(set = 1, binding = 13) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(set = 1, binding = 14) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\nfragColor2 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nlayout(set = 0, binding = 2) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 0) out vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nlayout(location = 0) in vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"#extension GL_EXT_shader_explicit_arithmetic_types_int32: require\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 3) in vec4 a_tangent;\n#if CC_USE_MORPH\nint getVertexId() {\nreturn gl_VertexIndex;\n}\nlayout(set = 2, binding = 4) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nlayout(set = 2, binding = 7) uniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nlayout(set = 2, binding = 8) uniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nlayout(set = 2, binding = 9) uniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nlayout(location = 4) in u32vec4 a_joints;\nlayout(location = 5) in vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nlayout(location = 7) in highp vec4 a_jointAnimInfo;\n#endif\nlayout(set = 2, binding = 3) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(set = 2, binding = 2) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nlayout(set = 2, binding = 6) uniform highp sampler2D cc_jointTexture;\n#else\nlayout(set = 2, binding = 3) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_INSTANCING\nlayout(location = 8) in vec4 a_matWorld0;\nlayout(location = 9) in vec4 a_matWorld1;\nlayout(location = 10) in vec4 a_matWorld2;\n#if USE_LIGHTMAP\nlayout(location = 11) in vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nlayout(location = 12) in float a_dyn_batch_id;\nlayout(set = 2, binding = 0) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nlayout(location = 0) out float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\n#if USE_VERTEX_COLOR\nlayout(location = 13) in lowp vec4 a_color;\nlayout(location = 1) out lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nlayout(location = 2) out vec2 v_uv;\nlayout(set = 1, binding = 0) uniform TexCoords {\nvec4 tilingOffset;\n};\n#endif\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(matWorld * position);\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nlayout(location = 0) in float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nlayout(location = 2) in vec2 v_uv;\nlayout(set = 1, binding = 2) uniform sampler2D mainTexture;\n#endif\nlayout(set = 1, binding = 1) uniform Constant {\nvec4 mainColor;\nvec4 colorScaleAndCutoff;\n};\n#if USE_VERTEX_COLOR\nlayout(location = 1) in lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no.rgb *= SRGBToLinear(v_color.rgb);\no.a *= v_color.a;\n#endif\n#if USE_TEXTURE\nvec4 texColor = texture(mainTexture, v_uv);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\no *= texColor;\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\nCC_APPLY_FOG(o);\nreturn CCFragOutput(o);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"#extension GL_EXT_shader_explicit_arithmetic_types_int32: require\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 3) in vec4 a_tangent;\n#if CC_USE_MORPH\nint getVertexId() {\nreturn gl_VertexIndex;\n}\nlayout(set = 2, binding = 4) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nlayout(set = 2, binding = 7) uniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nlayout(set = 2, binding = 8) uniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nlayout(set = 2, binding = 9) uniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nlayout(location = 4) in u32vec4 a_joints;\nlayout(location = 5) in vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nlayout(location = 7) in highp vec4 a_jointAnimInfo;\n#endif\nlayout(set = 2, binding = 3) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(set = 2, binding = 2) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nlayout(set = 2, binding = 6) uniform highp sampler2D cc_jointTexture;\n#else\nlayout(set = 2, binding = 3) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(location = 0) out vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(location = 0) in vec2 v_uv;\nlayout(set = 1, binding = 0) uniform BloomUBO {\nmediump vec4 texSize;\n};\nlayout(set = 1, binding = 1) uniform sampler2D outputResultMap;\nlayout(location = 0) out vec4 fragColor;\nfloat luminance(vec3 color) {\nreturn dot(color, vec3(0.2126, 0.7152, 0.0722));\n}\nvoid main() {\nvec3 color = texture(outputResultMap, v_uv).xyz;\nif (luminance(SRGBToLinear(color)) > texSize.z) {\nfragColor = vec4(color, 1.0);\n} else {\nfragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n}"},{vert:"#extension GL_EXT_shader_explicit_arithmetic_types_int32: require\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 3) in vec4 a_tangent;\n#if CC_USE_MORPH\nint getVertexId() {\nreturn gl_VertexIndex;\n}\nlayout(set = 2, binding = 4) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nlayout(set = 2, binding = 7) uniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nlayout(set = 2, binding = 8) uniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nlayout(set = 2, binding = 9) uniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nlayout(location = 4) in u32vec4 a_joints;\nlayout(location = 5) in vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nlayout(location = 7) in highp vec4 a_jointAnimInfo;\n#endif\nlayout(set = 2, binding = 3) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(set = 2, binding = 2) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nlayout(set = 2, binding = 6) uniform highp sampler2D cc_jointTexture;\n#else\nlayout(set = 2, binding = 3) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(location = 0) out vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(location = 0) in vec2 v_uv;\nlayout(set = 1, binding = 0) uniform BloomUBO {\nmediump vec4 texSize;\n};\nlayout(set = 1, binding = 1) uniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvec3 downsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main()\n{\nvec3 result = downsample4taps(v_uv, 1.0 / texSize.xy).rgb;\nfragColor = vec4(result, 1.0);\n}"},{vert:"#extension GL_EXT_shader_explicit_arithmetic_types_int32: require\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 3) in vec4 a_tangent;\n#if CC_USE_MORPH\nint getVertexId() {\nreturn gl_VertexIndex;\n}\nlayout(set = 2, binding = 4) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nlayout(set = 2, binding = 7) uniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nlayout(set = 2, binding = 8) uniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nlayout(set = 2, binding = 9) uniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nlayout(location = 4) in u32vec4 a_joints;\nlayout(location = 5) in vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nlayout(location = 7) in highp vec4 a_jointAnimInfo;\n#endif\nlayout(set = 2, binding = 3) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(set = 2, binding = 2) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nlayout(set = 2, binding = 6) uniform highp sampler2D cc_jointTexture;\n#else\nlayout(set = 2, binding = 3) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(location = 0) out vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(location = 0) in vec2 v_uv;\nlayout(set = 1, binding = 0) uniform BloomUBO {\nmediump vec4 texSize;\n};\nlayout(set = 1, binding = 1) uniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvec3 upsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main() {\nvec3 result = upsample4taps(v_uv, 0.5 / texSize.xy).rgb;\nfragColor = vec4(result, 1.0);\n}"},{vert:"#extension GL_EXT_shader_explicit_arithmetic_types_int32: require\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 3) in vec4 a_tangent;\n#if CC_USE_MORPH\nint getVertexId() {\nreturn gl_VertexIndex;\n}\nlayout(set = 2, binding = 4) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nlayout(set = 2, binding = 7) uniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nlayout(set = 2, binding = 8) uniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nlayout(set = 2, binding = 9) uniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nlayout(location = 4) in u32vec4 a_joints;\nlayout(location = 5) in vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nlayout(location = 7) in highp vec4 a_jointAnimInfo;\n#endif\nlayout(set = 2, binding = 3) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(set = 2, binding = 2) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nlayout(set = 2, binding = 6) uniform highp sampler2D cc_jointTexture;\n#else\nlayout(set = 2, binding = 3) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(location = 0) out vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(location = 0) in vec2 v_uv;\nlayout(set = 1, binding = 0) uniform BloomUBO {\nmediump vec4 texSize;\n};\nlayout(set = 1, binding = 1) uniform sampler2D outputResultMap;\nlayout(set = 1, binding = 2) uniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvoid main() {\nvec4 hdrColor = texture(outputResultMap, v_uv);\nvec3 bloomColor = texture(bloomTexture, v_uv).rgb;\nvec3 result = hdrColor.rgb + bloomColor * texSize.w * hdrColor.a;\nfragColor = vec4(result, hdrColor.a);\n}"}],[{vert:"\nprecision highp float;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 3) in vec4 a_tangent;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(location = 0) out vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(set = 0, binding = 2) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nlayout(set = 0, binding = 3) uniform highp sampler2D cc_shadowMap;\nlayout(set = 0, binding = 5) uniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nlayout(set = 0, binding = 4) uniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nlayout(set = 0, binding = 6) uniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(set = 2, binding = 1) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(set = 1, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(set = 1, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(set = 1, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec3 oct_to_float32x3(vec2 e) {\nvec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\nif (v.z < 0.0) v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\nreturn normalize(v);\n}\nvec4 screen2WS(vec3 coord) {\nvec3 ndc = vec3(\n2.0 * (coord.x - cc_viewPort.x) / cc_viewPort.z - 1.0,\n2.0 * (coord.y - cc_viewPort.y) / cc_viewPort.w - 1.0,\ncoord.z);\nvec4 world = ((cc_matViewProjInv) * (vec4(ndc, 1.0)));\nworld      = world / world.w;\nreturn world;\n}\nlayout(location = 0) in vec2 v_uv;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nlayout(set = 1, binding = 0, input_attachment_index = 0) uniform subpassInput gbuffer_albedoMap;\nlayout(set = 1, binding = 1, input_attachment_index = 1) uniform subpassInput gbuffer_normalMap;\nlayout(set = 1, binding = 2, input_attachment_index = 2) uniform subpassInput gbuffer_emissiveMap;\n#else\nlayout(set = 1, binding = 0) uniform sampler2D gbuffer_albedoMap;\nlayout(set = 1, binding = 1) uniform sampler2D gbuffer_normalMap;\nlayout(set = 1, binding = 2) uniform sampler2D gbuffer_emissiveMap;\n#endif\nlayout(set = 1, binding = 3) uniform sampler2D depth_stencil;\n#if !CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT || __VERSION__ >= 450\nlayout(location = 0) out vec4 fragColor;\n#endif\nvoid main () {\nStandardSurface s;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nvec4 albedoMap = subpassLoad(gbuffer_albedoMap);\nvec4 normalMap = subpassLoad(gbuffer_normalMap);\nvec4 emissiveMap = subpassLoad(gbuffer_emissiveMap);\n#else\nvec4 albedoMap = texture(gbuffer_albedoMap,v_uv);\nvec4 normalMap = texture(gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture(gbuffer_emissiveMap,v_uv);\n#endif\nfloat depth = texture(depth_stencil, v_uv).x;\ns.albedo = albedoMap;\nvec3 position = screen2WS(vec3(gl_FragCoord.xy, depth)).xyz;\ns.position = position;\ns.roughness = normalMap.z;\ns.normal = oct_to_float32x3(normalMap.xy);\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\nCC_TRANSFER_FOG_BASE(vec4(position, 1), fogFactor);\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nCCClusterShadingAdditive(s, shadowPos);\n#else\nCCStandardShadingAdditive(s, shadowPos);\n#endif\nCC_APPLY_FOG_BASE(color, fogFactor);\ncolor = CCFragOutput(color);\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nfragColor = color;\n#else\nfragColor = color;\n#endif\n}"}],[{vert:"#extension GL_EXT_shader_explicit_arithmetic_types_int32: require\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 3) in vec4 a_tangent;\n#if CC_USE_MORPH\nint getVertexId() {\nreturn gl_VertexIndex;\n}\nlayout(set = 2, binding = 4) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nlayout(set = 2, binding = 7) uniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nlayout(set = 2, binding = 8) uniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nlayout(set = 2, binding = 9) uniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nlayout(location = 4) in u32vec4 a_joints;\nlayout(location = 5) in vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nlayout(location = 7) in highp vec4 a_jointAnimInfo;\n#endif\nlayout(set = 2, binding = 3) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(set = 2, binding = 2) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nlayout(set = 2, binding = 6) uniform highp sampler2D cc_jointTexture;\n#else\nlayout(set = 2, binding = 3) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_INSTANCING\nlayout(location = 8) in vec4 a_matWorld0;\nlayout(location = 9) in vec4 a_matWorld1;\nlayout(location = 10) in vec4 a_matWorld2;\n#if USE_LIGHTMAP\nlayout(location = 11) in vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nlayout(location = 12) in float a_dyn_batch_id;\nlayout(set = 2, binding = 0) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(set = 2, binding = 0) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(set = 0, binding = 2) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nlayout(location = 0) out float v_dist;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\nvec3 P = (matWorld * position).xyz;\nvec3 L = cc_mainLitDir.xyz;\nvec3 N = cc_planarNDInfo.xyz;\nfloat d = cc_planarNDInfo.w + 0.001;\nfloat dist = (-d - dot(P, N)) / (dot(L, N) + 0.0001);\nvec3 shadowPos = P + L * dist;\nvec3 view = normalize(cc_cameraPos.xyz - shadowPos);\nfloat viewLength = length(cc_cameraPos.xyz - shadowPos);\nshadowPos += view * min(1.0, 0.005 * viewLength);\nposition = cc_matProj * cc_matView * vec4(shadowPos, 1.0);\nv_dist = dist;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(set = 0, binding = 2) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nlayout(location = 0) in float v_dist;\nvec4 frag () {\nif(v_dist < 0.0)\ndiscard;\nreturn CCFragOutput(cc_shadowColor);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"#extension GL_EXT_shader_explicit_arithmetic_types_int32: require\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 3) in vec4 a_tangent;\n#if CC_USE_MORPH\nint getVertexId() {\nreturn gl_VertexIndex;\n}\nlayout(set = 2, binding = 4) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nlayout(set = 2, binding = 7) uniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nlayout(set = 2, binding = 8) uniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nlayout(set = 2, binding = 9) uniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nlayout(location = 4) in u32vec4 a_joints;\nlayout(location = 5) in vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nlayout(location = 7) in highp vec4 a_jointAnimInfo;\n#endif\nlayout(set = 2, binding = 3) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(set = 2, binding = 2) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nlayout(set = 2, binding = 6) uniform highp sampler2D cc_jointTexture;\n#else\nlayout(set = 2, binding = 3) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(location = 0) out vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if ANTIALIAS_TYPE == 1\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture(tex, v_rgbSE).xyz;\nvec4 texColor = texture(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\n#endif\nlayout(location = 0) in vec2 v_uv;\nlayout(set = 1, binding = 0) uniform sampler2D outputResultMap;\nlayout(location = 0) out vec4 fragColor;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\n#if ANTIALIAS_TYPE == 1\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\nfragColor = fxaa(outputResultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n#else\nfragColor = texture(outputResultMap, v_uv);\n#endif\n}"}],[{vert:"\nprecision highp float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec3 a_normal;\nlayout(location = 2) in vec2 a_texCoord;\nlayout(location = 3) in vec4 a_tangent;\nlayout(location = 0) out mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nvec4 pos = matViewRotOnly * viewDir;\nif (cc_matProj[3].w > 0.0) {\nmat4 matProj = cc_matProj;\nmatProj[0].x = 5.2;\nmatProj[1].y = 2.6;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\npos = matProj * pos;\n} else {\npos = cc_matProj * pos;\n}\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(set = 0, binding = 4) uniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nlayout(location = 0) in mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(texture(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(texture(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(location = 0) in vec3 a_position;\nlayout(location = 1) in vec4 a_color;\nlayout(location = 0) out vec2 v_uv;\nlayout(set = 1, binding = 0) uniform Constants {\nvec4 offset;\n};\nlayout(set = 1, binding = 1) uniform PerFrameInfo {\nvec4 digits[8 * 10 / 4];\n};\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nmat2 proj = mat2(cc_matProj[0].xy, cc_matProj[1].xy);\nproj /= abs(proj[1].x + proj[1].y);\nvec2 position = proj * a_position.xy + offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn vec4(position, 0.0, 1.0);\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(set = 0, binding = 0) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(set = 0, binding = 1) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nlayout(location = 0) in vec2 v_uv;\nlayout(set = 1, binding = 2) uniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture(mainTexture, v_uv));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(location = 0) in vec2 a_position;\nlayout(location = 1) in vec2 a_texCoord;\nlayout(location = 0) out vec2 v_uv;\nlayout(set = 1, binding = 0) uniform Constant {\nvec4 u_buffer0;\nvec4 u_buffer1;\nmat4 u_projection;\n};\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(location = 0) in vec2 v_uv;\nlayout(set = 1, binding = 1) uniform Factor {\nfloat u_percent;\n};\nlayout(set = 1, binding = 2) uniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture(mainTexture, v_uv);\nfloat percent = clamp(u_percent, 0.0, 1.0);\ncolor.xyz *= percent;\nreturn color;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}]]},Bm=e("c3",c.builtinResMgr=new class{constructor(){this._device=null,this._resources={}}initBuiltinRes(e){this._device=e;const t=this._resources,n=new Uint8Array(16),i=new Uint8Array(16),o=new Uint8Array(16),a=new Uint8Array(16),r=new Uint8Array(16);let s=0;for(let e=0;e<4;e++)n[s]=0,n[s+1]=0,n[s+2]=0,n[s+3]=255,i[s]=0,i[s+1]=0,i[s+2]=0,i[s+3]=0,o[s]=119,o[s+1]=119,o[s+2]=119,o[s+3]=255,a[s]=255,a[s+1]=255,a[s+2]=255,a[s+3]=255,r[s]=127,r[s+1]=127,r[s+2]=255,r[s+3]=255,s+=4;const l=new Uint8Array(1024);s=0;for(let e=0;e<256;e++)l[s]=221,l[s+1]=221,l[s+2]=221,l[s+3]=255,s+=4;s=0;for(let e=0;e<8;e++){for(let e=0;e<8;e++)l[s]=85,l[s+1]=85,l[s+2]=85,l[s+3]=255,s+=4;s+=32}s+=32;for(let e=0;e<8;e++){for(let e=0;e<8;e++)l[s]=85,l[s+1]=85,l[s+2]=85,l[s+3]=255,s+=4;s+=32}const _={width:2,height:2,_data:n,_compressed:!1,format:om.PixelFormat.RGBA8888},u={width:2,height:2,_data:i,_compressed:!1,format:om.PixelFormat.RGBA8888},h={width:2,height:2,_data:o,_compressed:!1,format:om.PixelFormat.RGBA8888},f={width:2,height:2,_data:a,_compressed:!1,format:om.PixelFormat.RGBA8888},p={width:2,height:2,_data:r,_compressed:!1,format:om.PixelFormat.RGBA8888},d={width:16,height:16,_data:l,_compressed:!1,format:om.PixelFormat.RGBA8888},m=new Id(_),A=new om;A._uuid="black-texture",A.image=m,t[A._uuid]=A;const v=new Id(u),g=new om;g._uuid="empty-texture",g.image=v,t[g._uuid]=g;const x=new hm;x._uuid="black-cube-texture",x.setMipFilter(hm.Filter.NEAREST),x.image={front:new Id(_),back:new Id(_),left:new Id(_),right:new Id(_),top:new Id(_),bottom:new Id(_)},t[x._uuid]=x;const y=new Id(h),b=new om;b._uuid="grey-texture",b.image=y,t[b._uuid]=b;const S=new Id(f),C=new om;C._uuid="white-texture",C.image=S,t[C._uuid]=C;const E=new hm;E._uuid="white-cube-texture",E.setMipFilter(hm.Filter.NEAREST),E.image={front:new Id(f),back:new Id(f),left:new Id(f),right:new Id(f),top:new Id(f),bottom:new Id(f)},t[E._uuid]=E;const T=new Id(p),P=new om;P._uuid="normal-texture",P.image=T,t[P._uuid]=P;const w=new Id(d),I=new om;I._uuid="default-texture",I.image=w,t[I._uuid]=I;const R=new hm;if(R.setMipFilter(hm.Filter.NEAREST),R._uuid="default-cube-texture",R.image={front:new Id(d),back:new Id(d),left:new Id(d),right:new Id(d),top:new Id(d),bottom:new Id(d)},t[R._uuid]=R,c.SpriteFrame){const e=new c.SpriteFrame,n=m,i=new om;i.image=n,e.texture=i,e._uuid="default-spriteframe",t[e._uuid]=e}const D=zm(e);if(!D)return Promise.reject(Error("Failed to initialize builtin shaders: unknown device."));const N=Fm[D];return N?Promise.resolve().then((()=>{pm.forEach(((e,t)=>{const n=Object.assign(new c.EffectAsset,e);n.shaders.forEach(((e,n)=>{const i=N[t][n];i&&(e[D]=i)})),n.hideInEditor=!0,n.onLoaded()})),this._initMaterials()})):Promise.reject(Error(`Current device is requiring builtin shaders of version ${D} but shaders of that version are not assembled in this build.`))}get(e){return this._resources[e]}_initMaterials(){const e=this._resources,t=[],n=new c.Material;n._uuid="standard-material",n.initialize({effectName:"standard"}),e[n._uuid]=n,t.push(n);const i=new c.Material;i._uuid="missing-effect-material",i.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),i.setProperty("mainColor",c.color("#ffff00")),e[i._uuid]=i,t.push(i);const o=new c.Material;o._uuid="missing-material",o.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),o.setProperty("mainColor",c.color("#ff00ff")),e[o._uuid]=o,t.push(o);const a=new c.Material;a._uuid="default-clear-stencil",a.initialize({defines:{USE_TEXTURE:!1},effectName:"clear-stencil"}),e[a._uuid]=a,t.push(a);const r=new c.Material;r._uuid="ui-base-material",r.initialize({defines:{USE_TEXTURE:!1},effectName:"sprite"}),e[r._uuid]=r,t.push(r);const s=new c.Material;s._uuid="ui-sprite-material",s.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),e[s._uuid]=s,t.push(s);const l=new c.Material;l._uuid="ui-alpha-test-material",l.initialize({defines:{USE_TEXTURE:!0,USE_ALPHA_TEST:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),e[l._uuid]=l,t.push(l);const _=new c.Material;_._uuid="ui-sprite-gray-material",_.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!0},effectName:"sprite"}),e[_._uuid]=_,t.push(_);const u=new c.Material;u._uuid="ui-sprite-alpha-sep-material",u.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!1},effectName:"sprite"}),e[u._uuid]=u,t.push(u);const h=new c.Material;h._uuid="ui-sprite-gray-alpha-sep-material",h.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!0},effectName:"sprite"}),e[h._uuid]=h,t.push(h);const f=new c.Material;f._uuid="ui-graphics-material",f.initialize({effectName:"graphics"}),e[f._uuid]=f,t.push(f);const p=new c.Material;p._uuid="default-particle-material",p.initialize({effectName:"particle"}),e[p._uuid]=p,t.push(p);{const n=new c.Material;n._uuid="default-particle-gpu-material",n.initialize({effectName:"particle-gpu"}),e[n._uuid]=n,t.push(n)}const d=new c.Material;d._uuid="default-trail-material",d.initialize({effectName:"particle-trail"}),e[d._uuid]=d,t.push(d);const m=new c.Material;m._uuid="default-billboard-material",m.initialize({effectName:"billboard"}),e[m._uuid]=m,t.push(m);const A=new c.Material;A._uuid="default-spine-material",A.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"spine"}),e[A._uuid]=A,t.push(A),c.game.on(c.Game.EVENT_GAME_INITED,(()=>{for(let e=0;e<t.length;++e){const n=t[e];for(let e=0;e<n.passes.length;++e)n.passes[e].tryCompile()}}))}}),km=(()=>{const e=new Map;let t=0;return n=>"number"==typeof n?n:(e.has(n)||(e.set(n,1<<t),t++),e.get(n))})();class Um{constructor(e){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=e.device,this.pass=e}destroy(){for(let e=0;e<this.instances.length;++e){const t=this.instances[e];t.vb.destroy(),t.ia.destroy()}this.instances.length=0}merge(e,t,n,i=null){const o=t.buffer.length;if(!o)return;const a=e.inputAssembler,r=e.descriptorSet.getTexture(qp);let s=i;s||(s=e.shaders[n]);const c=e.descriptorSet;for(let e=0;e<this.instances.length;++e){const n=this.instances[e];if(!(n.ia.indexBuffer!==a.indexBuffer||n.count>=1024)&&n.lightingMap===r&&n.stride===o){if(n.count>=n.capacity){n.capacity<<=1;const e=n.stride*n.capacity,t=n.data;n.data=new Uint8Array(e),n.data.set(t),n.vb.resize(e)}return n.shader!==s&&(n.shader=s),n.descriptorSet!==c&&(n.descriptorSet=c),n.data.set(t.buffer,n.stride*n.count++),void(this.hasPendingModels=!0)}}const l=this._device.createBuffer(new ka(Ho.VERTEX|Ho.TRANSFER_DST,Yo.HOST|Yo.DEVICE,32*o,o)),_=new Uint8Array(32*o),u=a.vertexBuffers.slice(),h=a.attributes.slice(),f=a.indexBuffer;for(let e=0;e<t.attributes.length;e++){const n=t.attributes[e],i=new ir(n.name,n.format,n.isNormalized,u.length,!0);h.push(i)}_.set(t.buffer),u.push(l);const p=new ar(h,u,f),d=this._device.createInputAssembler(p);this.instances.push({count:1,capacity:32,vb:l,data:_,ia:d,stride:o,shader:s,descriptorSet:c,lightingMap:r}),this.hasPendingModels=!0}uploadBuffers(e){for(let t=0;t<this.instances.length;++t){const n=this.instances[t];n.count&&(n.ia.instanceCount=n.count,e.updateBuffer(n.vb,n.data))}}clear(){for(let e=0;e<this.instances.length;++e)this.instances[e].count=0;this.hasPendingModels=!1}}class Gm{constructor(e){this.batches=[],this.dynamicOffsets=[],this._device=void 0,this._device=e.device}destroy(){for(let e=0;e<this.batches.length;++e){const t=this.batches[e];for(let e=0;e<t.vbs.length;++e)t.vbs[e].destroy();t.vbIdx.destroy(),t.ia.destroy(),t.ubo.destroy()}this.batches.length=0}merge(e,t,n){const i=e.subMesh.flatBuffers;if(0===i.length)return;let o=0,a=0;const r=i[0].count,s=e.passes[t],c=e.shaders[t],l=e.descriptorSet;let _=!1;for(let e=0;e<this.batches.length;++e){const t=this.batches[e];if(t.vbs.length===i.length&&t.mergeCount<Pp.BATCHING_COUNT){_=!0;for(let e=0;e<t.vbs.length;++e)if(t.vbs[e].stride!==i[e].stride){_=!1;break}if(_){for(let e=0;e<t.vbs.length;++e){const n=i[e],a=t.vbs[e],s=t.vbDatas[e];o=(r+t.vbCount)*n.stride,o>a.size&&(a.resize(o),t.vbDatas[e]=new Uint8Array(o),t.vbDatas[e].set(s)),t.vbDatas[e].set(n.buffer,t.vbCount*n.stride)}let e=t.vbIdxData;a=4*(r+t.vbCount),a>t.vbIdx.size&&(t.vbIdx.resize(a),t.vbIdxData=new Float32Array(a/Float32Array.BYTES_PER_ELEMENT),t.vbIdxData.set(e),e=t.vbIdxData);const _=t.vbCount,u=_+r,h=t.mergeCount;if(e[_]!==h||e[u-1]!==h)for(let t=_;t<u;t++)e[t]=h+.1;return Ei.toArray(t.uboData,n.transform.worldMatrix,Pp.MAT_WORLDS_OFFSET+16*t.mergeCount),t.mergeCount||(l.bindBuffer(Pp.BINDING,t.ubo),l.update(),t.pass=s,t.shader=c,t.descriptorSet=l),++t.mergeCount,t.vbCount+=r,void(t.ia.vertexCount+=r)}}}const u=[],h=[],f=[];for(let e=0;e<i.length;++e){const t=i[e],n=this._device.createBuffer(new ka(Ho.VERTEX|Ho.TRANSFER_DST,Yo.HOST|Yo.DEVICE,t.count*t.stride,t.stride));n.update(t.buffer.buffer),u.push(n),h.push(new Uint8Array(n.size)),f.push(n)}const p=this._device.createBuffer(new ka(Ho.VERTEX|Ho.TRANSFER_DST,Yo.HOST|Yo.DEVICE,4*r,4)),d=new Float32Array(r);d.fill(0),p.update(d),f.push(p);const m=e.inputAssembler.attributes,A=new Array(m.length+1);for(let e=0;e<m.length;++e)A[e]=m[e];A[m.length]=new ir("a_dyn_batch_id",Go.R32F,!1,i.length);const v=new ar(A,f),g=this._device.createInputAssembler(v),x=this._device.createBuffer(new ka(Ho.UNIFORM|Ho.TRANSFER_DST,Yo.HOST|Yo.DEVICE,Pp.SIZE,Pp.SIZE));l.bindBuffer(Pp.BINDING,x),l.update();const y=new Float32Array(Pp.COUNT);Ei.toArray(y,n.transform.worldMatrix,Pp.MAT_WORLDS_OFFSET),this.batches.push({mergeCount:1,vbs:u,vbDatas:h,vbIdx:p,vbIdxData:d,vbCount:r,ia:g,ubo:x,uboData:y,pass:s,shader:c,descriptorSet:l})}clear(){for(let e=0;e<this.batches.length;++e){const t=this.batches[e];t.vbCount=0,t.mergeCount=0,t.ia.vertexCount=0}}}const jm=new ka(Ho.UNIFORM|Ho.TRANSFER_DST,Yo.DEVICE),Vm=new Ua(null),Hm=new mr(null);let Wm;!function(e){e[e.NONE=0]="NONE",e[e.INSTANCING=1]="INSTANCING",e[e.VB_MERGING=2]="VB_MERGING"}(Wm||(Wm=e("cx",{})));class qm{static fillPipelineInfo(e,t){void 0!==t.priority&&e._setPriority(t.priority),void 0!==t.primitive&&e._setPrimitive(t.primitive),void 0!==t.stage&&e._setStage(t.stage),void 0!==t.dynamicStates&&e._setDynamicState(t.dynamicStates),void 0!==t.phase&&e._setPhase(km(t.phase));const n=e._bs;if(t.blendState){const e=t.blendState,{targets:i}=e;i&&i.forEach(((e,t)=>{n.setTarget(t,e)})),void 0!==e.isA2C&&(n.isA2C=e.isA2C),void 0!==e.isIndepend&&(n.isIndepend=e.isIndepend),void 0!==e.blendColor&&(n.blendColor=e.blendColor)}e._rs.assign(t.rasterizerState),e._dss.assign(t.depthStencilState)}static getPassHash(e){let t=`${Lm.getKey(e.program,e.defines)},${e._primitive},${e._dynamicStates}`;var n;return t+=function(e){let t=`,bs,${e.isA2C}`;for(const n of e.targets)t+=`,bt,${n.blend},${n.blendEq},${n.blendAlphaEq},${n.blendColorMask}`,t+=`,${n.blendSrc},${n.blendDst},${n.blendSrcAlpha},${n.blendDstAlpha}`;return t}(e._bs),t+=function(e){let t=`,dss,${e.depthTest},${e.depthWrite},${e.depthFunc}`;return t+=`,${e.stencilTestFront},${e.stencilFuncFront},${e.stencilRefFront},${e.stencilReadMaskFront}`,t+=`,${e.stencilFailOpFront},${e.stencilZFailOpFront},${e.stencilPassOpFront},${e.stencilWriteMaskFront}`,t+=`,${e.stencilTestBack},${e.stencilFuncBack},${e.stencilRefBack},${e.stencilReadMaskBack}`,t+=`,${e.stencilFailOpBack},${e.stencilZFailOpBack},${e.stencilPassOpBack},${e.stencilWriteMaskBack}`,t}(e._dss),t+=`,rs,${(n=e._rs).cullMode},${n.depthBias},${n.isFrontFaceCCW}`,Xr(t,666)}get native(){return this._nativeObj}constructor(e){this._rootBuffer=null,this._buffers=[],this._descriptorSet=null,this._pipelineLayout=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocksInt=[],this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._shader=null,this._bs=new $r,this._dss=new ts,this._rs=new es,this._priority=$f.DEFAULT,this._stage=Kf.DEFAULT,this._phase=km("default"),this._primitive=ha.TRIANGLE_LIST,this._batchingScheme=Wm.NONE,this._dynamicStates=ma.NONE,this._instancedBuffers={},this._batchedBuffers={},this._hash=0,this._root=void 0,this._device=void 0,this._passHandle=0,this._rootBufferDirty=!1,this._root=e,this._device=e.device}initialize(e){this._doInit(e),this.resetUBOs(),this.resetTextures(),this.tryCompile()}getHandle(e,t=0,n=Vo.UNKNOWN){let i=this._propertyHandleMap[e];return i?(n?i=Sm(i,n):t&&(i=Sm(i,gm(i)-t)),i+t):0}getBinding(e){const t=this.getHandle(e);return t?qm.getBindingFromHandle(t):-1}setUniform(e,t){const n=qm.getBindingFromHandle(e),i=qm.getTypeFromHandle(e),o=qm.getOffsetFromHandle(e),a=this._getBlockView(i,n);Em[i](a,t,o),this._setRootBufferDirty(!0)}getUniform(e,t){const n=qm.getBindingFromHandle(e),i=qm.getTypeFromHandle(e),o=qm.getOffsetFromHandle(e),a=this._getBlockView(i,n);return Cm[i](a,t,o)}setUniformArray(e,t){const n=qm.getBindingFromHandle(e),i=qm.getTypeFromHandle(e),o=Lr(i)>>2,a=this._getBlockView(i,n);let r=qm.getOffsetFromHandle(e);for(let e=0;e<t.length;e++,r+=o)null!==t[e]&&Em[i](a,t[e],r);this._setRootBufferDirty(!0)}bindTexture(e,t,n){this._descriptorSet.bindTexture(e,t,n||0)}bindSampler(e,t,n){this._descriptorSet.bindSampler(e,t,n||0)}setDynamicState(e,t){const n=this._dynamics[e];n&&n.value===t||(n.value=t,n.dirty=!0)}overridePipelineStates(e,t){console.warn("base pass cannot override states, please use pass instance instead.")}_setRootBufferDirty(e){this._rootBufferDirty=e,this._nativeObj.setRootBufferDirty(e)}update(){this._descriptorSet?(this._rootBuffer&&this._rootBufferDirty&&(this._rootBuffer.update(this._rootBlock),this._setRootBufferDirty(!1)),this._descriptorSet.update(),this._nativeObj.update()):R(12006)}getInstancedBuffer(e=0){return this._instancedBuffers[e]||(this._instancedBuffers[e]=new Um(this))}getBatchedBuffer(e=0){return this._batchedBuffers[e]||(this._batchedBuffers[e]=new Gm(this))}_initNative(){this._nativeObj||(this._nativeObj=new ao,this._passHandle=oc.alloc(),this._nativePriority=oc.getTypedArray(this._passHandle,tc.PRIORITY),this._nativeStage=oc.getTypedArray(this._passHandle,tc.STAGE),this._nativePhase=oc.getTypedArray(this._passHandle,tc.PHASE),this._nativePrimitive=oc.getTypedArray(this._passHandle,tc.PRIMITIVE),this._nativeBatchingScheme=oc.getTypedArray(this._passHandle,tc.BATCHING_SCHEME),this._nativeDynamicStates=oc.getTypedArray(this._passHandle,tc.DYNAMIC_STATE),this._nativeHash=oc.getTypedArray(this._passHandle,tc.HASH),this._nativeObj.initWithData(oc.getBuffer(this._passHandle)))}_destroy(){this._nativeObj=null,this._passHandle&&oc.free(this._passHandle)}destroy(){for(let e=0;e<this._shaderInfo.blocks.length;e++){const t=this._shaderInfo.blocks[e];this._buffers[t.binding].destroy()}this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBuffer=null);for(const e in this._instancedBuffers)this._instancedBuffers[e].destroy();for(const e in this._batchedBuffers)this._batchedBuffers[e].destroy();this._descriptorSet.destroy(),this._rs.destroy(),this._dss.destroy(),this._bs.destroy(),this._destroy()}resetUniform(e){const t=this.getHandle(e);if(!t)return;const n=qm.getTypeFromHandle(t),i=qm.getBindingFromHandle(t),o=qm.getOffsetFromHandle(t),a=qm.getCountFromHandle(t),r=this._getBlockView(n,i),s=this._properties[e],c=s&&s.value||Pm(n),l=(Lr(n)>>2)*a;for(let e=0;e+c.length<=l;e+=c.length)r.set(c,o+e);this._setRootBufferDirty(!0)}resetTexture(e,t){const n=this.getHandle(e);if(!n)return;const i=qm.getTypeFromHandle(n),o=qm.getBindingFromHandle(n),a=this._properties[e],r=a&&a.value,s=r?`${r}-texture`:Pm(i),c=Bm.get(s),l=c&&c.getGFXTexture(),_=a&&void 0!==a.samplerHash?Zr.unpackFromHash(a.samplerHash):c&&c.getSamplerInfo(),u=this._device.getSampler(_);this._descriptorSet.bindSampler(o,u,t),this._descriptorSet.bindTexture(o,l,t)}resetUBOs(){for(let e=0;e<this._shaderInfo.blocks.length;e++){const t=this._shaderInfo.blocks[e];let n=0;for(let e=0;e<t.members.length;e++){const i=t.members[e],o=this._getBlockView(i.type,t.binding),a=this._properties[i.name],r=a&&a.value||Pm(i.type),s=(Lr(i.type)>>2)*i.count;for(let e=0;e+r.length<=s;e+=r.length)o.set(r,n+e);n+=s}}this._setRootBufferDirty(!0)}resetTextures(){for(let e=0;e<this._shaderInfo.samplerTextures.length;e++){const t=this._shaderInfo.samplerTextures[e];for(let e=0;e<t.count;e++)this.resetTexture(t.name,e)}}tryCompile(){const{pipeline:e}=this._root;if(!e)return!1;this._syncBatchingScheme();const t=Lm.getGFXShader(this._device,this._programName,this._defines,e);return t?(this._shader=t,this._setPipelineLayout(Lm.getTemplateInfo(this._programName).pipelineLayout),this._setHash(qm.getPassHash(this)),!0):(console.warn(`create shader ${this._programName} failed`),!1)}getShaderVariant(e=null){if(!this._shader&&!this.tryCompile())return console.warn("pass resources incomplete"),null;if(!e)return this._shader;const{pipeline:t}=this._root;for(let t=0;t<e.length;t++){const n=e[t];this._defines[n.name]=n.value}const n=Lm.getGFXShader(this._device,this._programName,this._defines,t);for(let t=0;t<e.length;t++){const n=e[t];delete this._defines[n.name]}return n}beginChangeStatesSilently(){}endChangeStatesSilently(){}_setPriority(e){this._priority=e,this._nativePriority[0]=e}_setStage(e){this._stage=e,this._nativeStage[0]=e}_setPhase(e){this._phase=e,this._nativePhase[0]=e}_setPrimitive(e){this._primitive=e,this._nativePrimitive[0]=e}_setState(e,t,n,i){this._bs=e,this._dss=t,this._rs=n,this._descriptorSet=i,this._nativeObj.blendState=e.native,this._nativeObj.depthStencilState=t.native,this._nativeObj.rasterizerState=n.native,this._nativeObj.descriptorSet=i}_doInit(e,t=!1){this._initNative(),this._setPriority($f.DEFAULT),this._setStage(Kf.DEFAULT),this._setPhase(km("default")),this._setPrimitive(ha.TRIANGLE_LIST),this._passIndex=e.passIndex,this._propertyIndex=void 0!==e.propertyIndex?e.propertyIndex:e.passIndex,this._programName=e.program,this._defines=t?{...e.defines}:e.defines,this._shaderInfo=Lm.getTemplate(e.program),this._properties=e.properties||this._properties;const n=this._device;qm.fillPipelineInfo(this,e),e.stateOverrides&&qm.fillPipelineInfo(this,e.stateOverrides),Hm.layout=Lm.getDescriptorSetLayout(this._device,e.program),this._descriptorSet=this._device.createDescriptorSet(Hm),this._setState(this._bs,this._dss,this._rs,this._descriptorSet);const i=this._shaderInfo.blocks,o=Lm.getTemplateInfo(e.program),{blockSizes:a,handleMap:r}=o,s=n.capabilities.uboOffsetAlignment,c=[];let l=0,_=0;for(let e=0;e<i.length;e++){const t=a[e];c.push(_),_+=Math.ceil(t/s)*s,l=t}const u=c[c.length-1]+l;u&&(jm.size=16*Math.ceil(u/16),this._rootBuffer=n.createBuffer(jm),this._rootBlock=new ArrayBuffer(u),this._nativeObj.setRootBufferAndBlock(this._rootBuffer,this._rootBlock));for(let e=0,t=0;e<i.length;e++){const{binding:o}=i[e],r=a[e];Vm.buffer=this._rootBuffer,Vm.offset=c[t++],Vm.range=16*Math.ceil(r/16);const s=this._buffers[o]=n.createBuffer(Vm);this._blocks[o]=new Float32Array(this._rootBlock,Vm.offset,r/Float32Array.BYTES_PER_ELEMENT),this._blocksInt[o]=new Int32Array(this._blocks[o].buffer,this._blocks[o].byteOffset,this._blocks[o].length),this._descriptorSet.bindBuffer(o,s)}const h=this._propertyHandleMap=r,f={};for(const e in this._properties){const t=this._properties[e];t.handleInfo&&(f[e]=this.getHandle.apply(this,t.handleInfo))}Object.assign(h,f)}_syncBatchingScheme(){this._defines.USE_INSTANCING?this._device.hasFeature(Uo.INSTANCED_ARRAYS)?this._setBatchingScheme(Wm.INSTANCING):(this._defines.USE_INSTANCING=!1,this._setBatchingScheme(Wm.NONE)):this._defines.USE_BATCHING?this._setBatchingScheme(Wm.VB_MERGING):this._setBatchingScheme(Wm.NONE)}_setBatchingScheme(e){this._batchingScheme=e,this._nativeBatchingScheme[0]=e}_setDynamicState(e){this._dynamicStates=e,this._nativeDynamicStates[0]=e}_setHash(e){this._hash=e,this._nativeHash[0]=e}_getBlockView(e,t){return e<Vo.FLOAT?this._blocksInt[t]:this._blocks[t]}_setPipelineLayout(e){this._pipelineLayout=e,this._nativeObj.setPipelineLayout(e)}_initPassFromTarget(e,t,n,i){this._initNative(),this._setPriority(e.priority),this._setStage(e.stage),this._setPhase(e.phase),this._setBatchingScheme(e.batchingScheme),this._setPrimitive(e.primitive),this._setDynamicState(e.dynamicStates),this._setState(n,t,e.rasterizerState,e.descriptorSet),this._passIndex=e.passIndex,this._propertyIndex=e.propertyIndex,this._programName=e.program,this._defines=e.defines,this._shaderInfo=e._shaderInfo,this._properties=e._properties,this._blocks=e._blocks,this._blocksInt=e._blocksInt,this._dynamics=e._dynamics,this._shader=e._shader,this._setPipelineLayout(Lm.getTemplateInfo(this._programName).pipelineLayout),this._setHash(e._hash^i)}get root(){return this._root}get device(){return this._device}get shaderInfo(){return this._shaderInfo}get localSetLayout(){return Lm.getDescriptorSetLayout(this._device,this._programName,!0)}get program(){return this._programName}get properties(){return this._properties}get defines(){return this._defines}get passIndex(){return this._passIndex}get propertyIndex(){return this._propertyIndex}get dynamics(){return this._dynamics}get blocks(){return this._blocks}get blocksInt(){return this._blocksInt}get rootBufferDirty(){return this._rootBufferDirty}get priority(){return this._priority}get primitive(){return this._primitive}get stage(){return this._stage}get phase(){return this._phase}get rasterizerState(){return this._rs}get depthStencilState(){return this._dss}get blendState(){return this._bs}get dynamicStates(){return this._dynamicStates}get batchingScheme(){return this._batchingScheme}get descriptorSet(){return this._descriptorSet}get hash(){return this._hash}get pipelineLayout(){return this._pipelineLayout}}e("dj",qm),qm.getTypeFromHandle=gm,qm.getBindingFromHandle=xm,qm.getCountFromHandle=ym,qm.getOffsetFromHandle=bm;const Ym=new mr(null);class Xm{constructor(){this._device=null,this._passes=null,this._shaders=null,this._subMesh=null,this._patches=null,this._priority=$f.DEFAULT,this._inputAssembler=null,this._descriptorSet=null,this._worldBoundDescriptorSet=null,this._planarInstanceShader=null,this._planarShader=null,this._reflectionTex=null,this._reflectionSampler=null}_destroyDescriptorSet(){this._descriptorSet.destroy(),this._nativeObj.setDescriptorSet(null),this._descriptorSet=null}_destroyWorldBoundDescriptorSet(){this._worldBoundDescriptorSet.destroy(),this._nativeObj.setWorldBoundDescriptorSet(null),this._worldBoundDescriptorSet=null}_destroyInputAssembler(){this._inputAssembler.destroy(),this._nativeObj.setInputAssembler(null),this._inputAssembler=null}_createDescriptorSet(e){this._descriptorSet=this._device.createDescriptorSet(e),this._nativeObj.setDescriptorSet(this._descriptorSet)}_createWorldBoundDescriptorSet(e){this._worldBoundDescriptorSet=this._device.createDescriptorSet(e),this._nativeObj.setWorldBoundDescriptorSet(this._worldBoundDescriptorSet)}set passes(e){e.length>8?R(12004,8):(this._passes=e,this._flushPassInfo(),this._passes[0].batchingScheme===Wm.VB_MERGING&&(this.subMesh.genFlatBuffers(),this._setSubMesh(this.subMesh)),this._descriptorSet&&(this._destroyDescriptorSet(),Ym.layout=e[0].localSetLayout,this._createDescriptorSet(Ym)))}get passes(){return this._passes}get shaders(){return this._shaders}set subMesh(e){this._inputAssembler.destroy(),this._inputAssembler.initialize(e.iaInfo),this._passes[0].batchingScheme===Wm.VB_MERGING&&this.subMesh.genFlatBuffers(),this._setSubMesh(e)}get subMesh(){return this._subMesh}set priority(e){this._priority=e,this._nativeObj.setPriority(e)}get priority(){return this._priority}get inputAssembler(){return this._inputAssembler}get descriptorSet(){return this._descriptorSet}get worldBoundDescriptorSet(){return this._worldBoundDescriptorSet}get patches(){return this._patches}get planarInstanceShader(){return this._planarInstanceShader}get planarShader(){return this._planarShader}_setInputAssembler(e){this._inputAssembler=this._device.createInputAssembler(e),this._nativeObj.setInputAssembler(this._inputAssembler)}_setSubMesh(e){this._subMesh=e,this._nativeObj.setSubMeshBuffers(e.flatBuffers)}get native(){return this._nativeObj}_init(){this._nativeObj=new ro}initialize(e,t,n=null){const i=c.director.root;this._device=i.device,Ym.layout=t[0].localSetLayout,this._init(),this._setInputAssembler(e.iaInfo),this._createDescriptorSet(Ym);const o=c.director.root.pipeline.pipelineSceneData.getOcclusionQueryPass(),a=new mr(null);if(a.layout=o.localSetLayout,this._createWorldBoundDescriptorSet(a),this._setSubMesh(e),this._patches=n,this._passes=t,this._flushPassInfo(),t[0].batchingScheme===Wm.VB_MERGING&&(this.subMesh.genFlatBuffers(),this._setSubMesh(this.subMesh)),this.priority=$f.DEFAULT,t[0].phase===km("reflection")){let e=i.mainWindow.width,t=i.mainWindow.height;const n=512;t<e?(e=n*e/t,t=n):(e=n,t=n*t/e),this._reflectionTex=this._device.createTexture(new Ha(Xo.TEX2D,Qo.STORAGE|Qo.TRANSFER_SRC|Qo.SAMPLED,Go.RGBA8,e,t)),this.descriptorSet.bindTexture(Kp,this._reflectionTex),this._reflectionSampler=this._device.getSampler(new qa($o.LINEAR,$o.LINEAR,$o.NONE,ea.CLAMP,ea.CLAMP,ea.CLAMP)),this.descriptorSet.bindSampler(Kp,this._reflectionSampler),this.descriptorSet.bindTexture(td,this._reflectionTex)}}_initNativePlanarShadowShader(e){this._planarShader=e.getPlanarShader(this._patches),this._nativeObj.setPlanarShader(this._planarShader)}initPlanarShadowShader(){const e=c.director.root.pipeline.pipelineSceneData.shadows;this._initNativePlanarShadowShader(e)}_initNativePlanarShadowInstanceShader(e){this._planarInstanceShader=e.getPlanarInstanceShader(this._patches),this._nativeObj.setPlanarInstanceShader(this._planarInstanceShader)}initPlanarShadowInstanceShader(){const e=c.director.root.pipeline.pipelineSceneData.shadows;this._initNativePlanarShadowInstanceShader(e)}_destroy(){this._nativeObj=null}destroy(){this._destroyDescriptorSet(),this._destroyWorldBoundDescriptorSet(),this._destroyInputAssembler(),this.priority=$f.DEFAULT,this._patches=null,this._subMesh=null,this._passes=null,this._shaders=null,this._reflectionTex&&this._reflectionTex.destroy(),this._reflectionTex=null,this._reflectionSampler=null,this._destroy()}update(){for(let e=0;e<this._passes.length;++e)this._passes[e].update();this._descriptorSet.update(),this._worldBoundDescriptorSet.update()}onPipelineStateChanged(){const e=this._passes;if(e){for(let t=0;t<e.length;t++){const n=e[t];n.beginChangeStatesSilently(),n.tryCompile(),n.endChangeStatesSilently()}this._flushPassInfo()}}onMacroPatchesStateChanged(e){this._patches=e;const t=this._passes;if(t){for(let e=0;e<t.length;e++){const n=t[e];n.beginChangeStatesSilently(),n.tryCompile(),n.endChangeStatesSilently()}this._flushPassInfo()}}_flushPassInfo(){const e=this._passes;if(e){this._shaders||(this._shaders=[]),this._shaders.length=e.length;for(let t=0,n=e.length;t<n;t++)this._shaders[t]=e[t].getShaderVariant(this.patches);{const t=e.map((e=>e.native));this._nativeObj.setPasses(t),this._nativeObj.setShaders(this._shaders)}}}}const Qm=new Ei,Zm=[{name:"CC_RECEIVE_SHADOW",value:!0}];let Jm;!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SKINNING=1]="SKINNING",e[e.BAKED_SKINNING=2]="BAKED_SKINNING",e[e.BATCH_2D=3]="BATCH_2D",e[e.PARTICLE_BATCH=4]="PARTICLE_BATCH",e[e.LINE=5]="LINE"}(Jm||(Jm=e("cs",{})));const Km=new qa($o.LINEAR,$o.LINEAR,$o.NONE,ea.CLAMP,ea.CLAMP,ea.CLAMP),$m=new qa($o.LINEAR,$o.LINEAR,$o.LINEAR,ea.CLAMP,ea.CLAMP,ea.CLAMP);class eA{get subModels(){return this._subModels}get inited(){return this._inited}get worldBounds(){return this._worldBounds}get modelBounds(){return this._modelBounds}get localBuffer(){return this._localBuffer}get worldBoundBuffer(){return this._worldBoundBuffer}get updateStamp(){return this._updateStamp}get isInstancingEnabled(){return this._instMatWorldIdx>=0}get receiveShadow(){return this._receiveShadow}set receiveShadow(e){this._setReceiveShadow(e),this.onMacroPatchesStateChanged()}get castShadow(){return this._castShadow}set castShadow(e){this._castShadow=e,this._nativeObj.setCastShadow(e)}get node(){return this._node}set node(e){this._node=e,this._nativeObj.setNode(e.native)}get transform(){return this._transform}set transform(e){this._transform=e,this._nativeObj.setTransform(e.native)}get visFlags(){return this._visFlags}set visFlags(e){this._visFlags=e,this._nativeObj.seVisFlag(e)}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._nativeObj.setEnabled(e)}get native(){return this._nativeObj}constructor(){this.type=Jm.DEFAULT,this.scene=null,this.isDynamicBatching=!1,this.instancedAttributes={buffer:null,views:[],attributes:[]},this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._device=void 0,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._localDataUpdated=!0,this._localData=new Float32Array(Ep.COUNT),this._localBuffer=null,this._instMatWorldIdx=-1,this._lightmap=null,this._lightmapUVParam=new Oi,this._worldBoundBuffer=null,this._receiveShadow=!1,this._castShadow=!1,this._enabled=!0,this._visFlags=Jf.Enum.NONE,this._device=c.director.root.device}_setReceiveShadow(e){this._receiveShadow=e,this._nativeObj.setReceiveShadow(e)}_init(){this._nativeObj=new Vi}initialize(){this._inited||(this._init(),this._setReceiveShadow(!0),this.castShadow=!1,this.enabled=!0,this.visFlags=Jf.Enum.NONE,this._inited=!0)}_destroySubmodel(e){e.destroy()}_destroy(){this._nativeObj=null}destroy(){const e=this._subModels;for(let t=0;t<e.length;t++){const e=this._subModels[t];this._destroySubmodel(e)}this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._worldBoundBuffer&&(this._worldBoundBuffer.destroy(),this._worldBoundBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._localDataUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1,this._destroy()}attachToScene(e){this.scene=e,this._localDataUpdated=!0}detachFromScene(){this.scene=null}updateTransform(e){const t=this.transform;if(t.hasChangedFlags||t._dirtyFlags){t.updateWorldTransform(),this._localDataUpdated=!0;const e=this._worldBounds;this._modelBounds&&e&&this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,e)}}updateWorldBound(){const e=this.transform;if(null!==e){e.updateWorldTransform(),this._localDataUpdated=!0;const t=this._worldBounds;this._modelBounds&&t&&this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,t)}}_applyLocalData(){}_applyLocalBuffer(){this._nativeObj.setLocalBuffer(this._localBuffer)}_applyWorldBoundBuffer(){this._nativeObj.setWorldBoundBuffer(this._worldBoundBuffer)}updateUBOs(e){const t=this._subModels;for(let e=0;e<t.length;e++)t[e].update();if(this._updateStamp=e,!this._localDataUpdated)return;this._localDataUpdated=!1;const n=this.transform._mat,i=this._instMatWorldIdx;if(i>=0){const e=this.instancedAttributes.views;!function(e,t,n,i){t[0]=e.m00,t[1]=e.m01,t[2]=e.m02,t[3]=e.m12,n[0]=e.m04,n[1]=e.m05,n[2]=e.m06,n[3]=e.m13,i[0]=e.m08,i[1]=e.m09,i[2]=e.m10,i[3]=e.m14}(n,e[i],e[i+1],e[i+2])}else this._localBuffer&&(Ei.toArray(this._localData,n,Ep.MAT_WORLD_OFFSET),Ei.inverseTranspose(Qm,n),Ei.toArray(this._localData,Qm,Ep.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._applyLocalData(),this._applyLocalBuffer())}_updateNativeBounds(){this._nativeObj.setBounds(this._worldBounds.native)}createBoundingShape(e,t){e&&t&&(this._modelBounds=dc.fromPoints(dc.create(),e,t),this._worldBounds=dc.clone(this._modelBounds),this._updateNativeBounds())}_createSubModel(){return new Xm}initSubModel(e,t,n){this.initialize(),null==this._subModels[e]?this._subModels[e]=this._createSubModel():this._subModels[e].destroy(),this._subModels[e].initialize(t,n.passes,this.getMacroPatches(e)),this._subModels[e].initPlanarShadowShader(),this._subModels[e].initPlanarShadowInstanceShader(),this._updateAttributesAndBinding(e),this._nativeObj.setSubModel(e,this._subModels[e].native)}setSubModelMesh(e,t){this._subModels[e]&&(this._subModels[e].subMesh=t)}setSubModelMaterial(e,t){this._subModels[e]&&(this._subModels[e].passes=t.passes,this._updateAttributesAndBinding(e))}onGlobalPipelineStateChanged(){const e=this._subModels;for(let t=0;t<e.length;t++)e[t].onPipelineStateChanged()}onMacroPatchesStateChanged(){const e=this._subModels;for(let t=0;t<e.length;t++)e[t].onMacroPatchesStateChanged(this.getMacroPatches(t))}updateLightingmap(e,t){Oi.toArray(this._localData,t,Ep.LIGHTINGMAP_UVPARAM),this._localDataUpdated=!0,this._lightmap=e,this._lightmapUVParam=t,null===e&&(e=Bm.get("empty-texture"));const n=e.getGFXTexture();if(n){const i=this._device.getSampler(e.mipmaps.length>1?$m:Km),o=this._subModels;for(let e=0;e<o.length;e++){const{descriptorSet:t}=o[e];t.bindTexture(qp,n),t.bindSampler(qp,i),t.update()}this._nativeObj.updateLightingmap(t,i,n)}}getMacroPatches(e){return this.receiveShadow?Zm:null}_updateAttributesAndBinding(e){const t=this._subModels[e];if(!t)return;this._initLocalDescriptors(e),this._updateLocalDescriptors(e,t.descriptorSet),this._initWorldBoundDescriptors(e),this._updateWorldBoundDescriptors(e,t.worldBoundDescriptorSet);const n=t.passes[0].getShaderVariant(t.patches);this._updateInstancedAttributes(n.attributes,t.passes[0])}_getInstancedAttributeIndex(e){const{attributes:t}=this.instancedAttributes;for(let n=0;n<t.length;n++)if(t[n].name===e)return n;return-1}_setInstMatWorldIdx(e){this._instMatWorldIdx=e,this._nativeObj.setInstMatWorldIdx(e)}_updateInstancedAttributes(e,t){if(!t.device.hasFeature(Uo.INSTANCED_ARRAYS))return;let n=0;for(let t=0;t<e.length;t++){const i=e[t];i.isInstanced&&(n+=Pr[i.format].size)}const i=this.instancedAttributes;i.buffer=new Uint8Array(n),i.views.length=i.attributes.length=0;let o=0;for(let t=0;t<e.length;t++){const n=e[t];if(!n.isInstanced)continue;const a=new ir;a.format=n.format,a.name=n.name,a.isNormalized=n.isNormalized,a.location=n.location,i.attributes.push(a);const r=Pr[n.format],s=new(Fr(r))(i.buffer.buffer,o,r.count);i.views.push(s),o+=r.size}t.batchingScheme===Wm.INSTANCING&&t.getInstancedBuffer().destroy(),this._setInstMatWorldIdx(this._getInstancedAttributeIndex("a_matWorld0")),this._localDataUpdated=!0,this._nativeObj.setInstancedAttrBlock(i.buffer.buffer,i.views,i.attributes)}_initLocalDescriptors(e){this._localBuffer||(this._localBuffer=this._device.createBuffer(new ka(Ho.UNIFORM|Ho.TRANSFER_DST,Yo.DEVICE,Ep.SIZE,Ep.SIZE)),this._applyLocalBuffer())}_initWorldBoundDescriptors(e){this._worldBoundBuffer||(this._worldBoundBuffer=this._device.createBuffer(new ka(Ho.UNIFORM|Ho.TRANSFER_DST,Yo.DEVICE,Tp.SIZE,Tp.SIZE)),this._applyWorldBoundBuffer())}_updateLocalDescriptors(e,t){this._localBuffer&&t.bindBuffer(Ep.BINDING,this._localBuffer)}_updateWorldBoundDescriptors(e,t){this._worldBoundBuffer&&t.bindBuffer(Tp.BINDING,this._worldBoundBuffer)}}let tA,nA;e("bL",eA),function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD"}(tA||(tA={})),function(e){e[e.NONE=0]="NONE",e[e.POSITION=1]="POSITION",e[e.ROTATION=2]="ROTATION",e[e.SCALE=4]="SCALE",e[e.RS=e.ROTATION|e.SCALE]="RS",e[e.TRS=e.POSITION|e.ROTATION|e.SCALE]="TRS",e[e.TRS_MASK=~e.TRS]="TRS_MASK"}(nA||(nA=e("c2",{}))),c.internal.TransformBit=nA;class iA{get root(){return this._root}get name(){return this._name}get cameras(){return this._cameras}get mainLight(){return this._mainLight}get sphereLights(){return this._sphereLights}get spotLights(){return this._spotLights}get models(){return this._models}get native(){return this._nativeObj}get batches(){return this._batches}static registerCreateFunc(e){e._createSceneFun=e=>new iA(e)}constructor(e){this._root=void 0,this._name="",this._cameras=[],this._models=[],this._batches=[],this._directionalLights=[],this._sphereLights=[],this._spotLights=[],this._mainLight=null,this._modelId=0,this._root=e,this._createNativeObject()}initialize(e){return this._name=e.name,!0}activate(){this._nativeObj.activate()}update(e){{const t=[];for(let e=0,n=this._batches.length;e<n;++e)t.push(this._batches[e].native);return this._nativeObj.updateBatches(t),void this._nativeObj.update(e)}}_destroy(){this._nativeObj=null}destroy(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeModels(),this._destroy()}addCamera(e){e.attachToScene(this),this._cameras.push(e)}removeCamera(e){for(let t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return this._cameras.splice(t,1),void e.detachFromScene()}removeCameras(){for(const e of this._cameras)e.detachFromScene();this._cameras.splice(0)}setMainLight(e){this._mainLight=e,this._nativeObj.setMainLight(e?e.native:null)}unsetMainLight(e){if(this._mainLight===e){const e=this._directionalLights;if(e.length)return this.setMainLight(e[e.length-1]),void(this._mainLight.node&&(this._mainLight.node.hasChangedFlags|=nA.ROTATION));this.setMainLight(null)}}addDirectionalLight(e){e.attachToScene(this),this._directionalLights.push(e)}removeDirectionalLight(e){for(let t=0;t<this._directionalLights.length;++t)if(this._directionalLights[t]===e)return e.detachFromScene(),void this._directionalLights.splice(t,1)}addSphereLight(e){e.attachToScene(this),this._sphereLights.push(e),this._nativeObj.addSphereLight(e.native)}removeSphereLight(e){for(let t=0;t<this._sphereLights.length;++t)if(this._sphereLights[t]===e)return e.detachFromScene(),this._sphereLights.splice(t,1),void this._nativeObj.removeSphereLight(e.native)}addSpotLight(e){e.attachToScene(this),this._spotLights.push(e),this._nativeObj.addSpotLight(e.native)}removeSpotLight(e){for(let t=0;t<this._spotLights.length;++t)if(this._spotLights[t]===e)return e.detachFromScene(),this._spotLights.splice(t,1),void this._nativeObj.removeSpotLight(e.native)}removeSphereLights(){for(let e=0;e<this._sphereLights.length;++e)this._sphereLights[e].detachFromScene();this._sphereLights.length=0,this._nativeObj.removeSphereLights()}removeSpotLights(){for(let e=0;e<this._spotLights.length;++e)this._spotLights[e].detachFromScene();this._spotLights=[],this._nativeObj.removeSpotLights()}addModel(e){switch(e.attachToScene(this),this._models.push(e),e.type){case Jm.SKINNING:this._nativeObj.addSkinningModel(e.native);break;case Jm.BAKED_SKINNING:this._nativeObj.addBakedSkinningModel(e.native);break;case Jm.DEFAULT:default:this._nativeObj.addModel(e.native)}}removeModel(e){for(let t=0;t<this._models.length;++t)if(this._models[t]===e)return e.detachFromScene(),this._models.splice(t,1),void this._nativeObj.removeModel(t)}removeModels(){for(const e of this._models)e.detachFromScene(),e.destroy();this._models.length=0,this._nativeObj.removeModels()}addBatch(e){this._batches.push(e)}removeBatch(e){for(let t=0;t<this._batches.length;++t)if(this._batches[t]===e)return this._batches.splice(t,1),void this._nativeObj.removeBatch(t)}removeBatches(){this._batches.length=0,this._nativeObj.removeBatches()}onGlobalPipelineStateChanged(){for(const e of this._models)e.onGlobalPipelineStateChanged()}generateModelId(){return this._modelId++}_createNativeObject(){this._nativeObj||(this._nativeObj=new io)}}var oA,aA,rA,sA,cA,lA,_A,uA;let hA=e("eM",Uc("cc.EffectAsset")((uA=_A=class e extends __{constructor(...e){super(...e),Tc(this,"techniques",rA,this),Tc(this,"shaders",sA,this),Tc(this,"combinations",cA,this),Tc(this,"hideInEditor",lA,this)}static register(t){e._effects[t.name]=t}static remove(t){if("string"!=typeof t)e._effects[t.name]&&e._effects[t.name].equals(t)&&delete e._effects[t.name];else{if(e._effects[t])return void delete e._effects[t];for(const n in e._effects)if(e._effects[n]._uuid===t)return void delete e._effects[n]}}static get(t){if(e._effects[t])return e._effects[t];for(const n in e._effects)if(e._effects[n]._uuid===t)return e._effects[n];return null}static getAll(){return e._effects}onLoaded(){Lm.register(this),e.register(this),c.game.once(c.Game.EVENT_ENGINE_INITED,this._precompile,this)}_precompile(){const e=c.director.root;for(let t=0;t<this.shaders.length;t++){const n=this.shaders[t],i=this.combinations[t];i&&Object.keys(i).reduce(((e,t)=>e.reduce(((e,n)=>{const o=i[t];for(let i=0;i<o.length;++i){const a={...n};a[t]=o[i],e.push(a)}return e}),[])),[{}]).forEach((t=>Lm.getGFXShader(e.device,n.name,t,e.pipeline)))}}destroy(){return e.remove(this),super.destroy()}initDefault(t){super.initDefault(t);const n=e.get("unlit");this.name="unlit",this.shaders=n.shaders,this.combinations=n.combinations,this.techniques=n.techniques}validate(){return this.techniques.length>0&&this.shaders.length>0}},_A._effects={},rA=Pc((aA=uA).prototype,"techniques",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sA=Pc(aA.prototype,"shaders",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cA=Pc(aA.prototype,"combinations",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lA=Pc(aA.prototype,"hideInEditor",[qc,Xc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),oA=aA))||oA);function fA(e,t){e.x=t.x*t.x,e.y=t.y*t.y,e.z=t.z*t.z}var pA,dA,mA,AA,vA,gA,xA,yA,bA;c.EffectAsset=hA;const SA=new Oi;let CA=e("cF",(pA=Uc("cc.Material"),dA=vl(hA),pA((vA=Pc((AA=class e extends __{static getHash(e){let t=0;for(const n of e.passes)t^=n.hash;return t}constructor(){super(),Tc(this,"_effectAsset",vA,this),Tc(this,"_techIdx",gA,this),Tc(this,"_defines",xA,this),Tc(this,"_states",yA,this),Tc(this,"_props",bA,this),this._passes=[],this._hash=0}get effectAsset(){return this._effectAsset}get effectName(){return this._effectAsset?this._effectAsset.name:""}get technique(){return this._techIdx}get passes(){return this._passes}get hash(){return this._hash}get parent(){return null}get owner(){return null}initialize(e){this._passes.length?w(12005):(this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),this._fillInfo(e),this._update())}reset(e){this.initialize(e)}destroy(){return this._doDestroy(),super.destroy()}recompileShaders(e,t){console.warn(`Shaders in material asset '${this.name}' cannot be modified at runtime, please instantiate the material first.`)}overridePipelineStates(e,t){console.warn(`Pipeline states in material asset '${this.name}' cannot be modified at runtime, please instantiate the material first.`)}onLoaded(){this._update()}resetUniforms(e=!0){this._props.length=this._passes.length;for(let e=0;e<this._props.length;e++)this._props[e]={};if(e)for(const e of this._passes)e.resetUBOs(),e.resetTextures()}setProperty(e,t,n){let i=!1;if(void 0===n){const n=this._passes,o=n.length;for(let a=0;a<o;a++){const o=n[a];this._uploadProperty(o,e,t)&&(this._props[o.propertyIndex][e]=t,i=!0)}}else{if(n>=this._passes.length)return void console.warn(`illegal pass index: ${n}.`);const o=this._passes[n];this._uploadProperty(o,e,t)&&(this._props[o.propertyIndex][e]=t,i=!0)}i||console.warn(`illegal property name: ${e}.`)}getProperty(e,t){if(void 0===t){const t=this._props,n=t.length;for(let i=0;i<n;i++){const n=t[i];if(e in n)return n[e]}}else{if(t>=this._props.length)return console.warn(`illegal pass index: ${t}.`),null;const n=this._props[this._passes[t].propertyIndex];if(e in n)return n[e]}return null}copy(e,t){this._techIdx=e._techIdx,this._props.length=e._props.length;for(let t=0;t<e._props.length;t++)this._props[t]={...e._props[t]};this._defines.length=e._defines.length;for(let t=0;t<e._defines.length;t++)this._defines[t]={...e._defines[t]};this._states.length=e._states.length;for(let t=0;t<e._states.length;t++)this._states[t]={...e._states[t]};this._effectAsset=e._effectAsset,t&&this._fillInfo(t),this._update()}_fillInfo(e){void 0!==e.technique&&(this._techIdx=e.technique),e.effectAsset?this._effectAsset=e.effectAsset:e.effectName&&(this._effectAsset=hA.get(e.effectName)),e.defines&&this._prepareInfo(e.defines,this._defines),e.states&&this._prepareInfo(e.states,this._states)}_prepareInfo(e,t){let n=e;if(!Array.isArray(n)){const e=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;n=Array(e).fill(n)}for(let e=0;e<n.length;++e)Object.assign(t[e]||(t[e]={}),n[e])}_createPasses(){const e=this._effectAsset.techniques[this._techIdx||0];if(!e)return[];const t=e.passes.length,n=[];for(let i=0;i<t;++i){const t=e.passes[i],o=t.passIndex=i,a=t.defines=this._defines[o]||(this._defines[o]={});if(t.stateOverrides=this._states[o]||(this._states[o]={}),void 0!==t.propertyIndex&&Object.assign(a,this._defines[t.propertyIndex]),void 0!==t.embeddedMacros&&Object.assign(a,t.embeddedMacros),t.switch&&!a[t.switch])continue;const r=new qm(c.director.root);r.initialize(t),n.push(r)}return n}_update(t=!0){if(this._effectAsset){this._passes=this._createPasses();const e=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=e,t)this._passes.forEach(((e,t)=>{let n=this._props[t];n||(n=this._props[t]={}),void 0!==e.propertyIndex&&Object.assign(n,this._props[e.propertyIndex]);for(const t in n)this._uploadProperty(e,t,n[t])}));else for(let e=0;e<this._props.length;e++)this._props[e]={}}this._hash=e.getHash(this)}_uploadProperty(e,t,n){const i=e.getHandle(t);if(!i)return!1;if(qm.getTypeFromHandle(i)<Vo.SAMPLER1D)if(Array.isArray(n))e.setUniformArray(i,n);else if(null!==n){var o;if(null===(o=e.properties[t])||void 0===o?void 0:o.linear){const e=n;fA(SA,e),SA.w=e.w,n=SA}e.setUniform(i,n)}else e.resetUniform(t);else if(Array.isArray(n))for(let t=0;t<n.length;t++)this._bindTexture(e,i,n[t],t);else n?this._bindTexture(e,i,n):e.resetTexture(t);return!0}_bindTexture(e,t,n,i){const o=qm.getBindingFromHandle(t);if(n instanceof Qr)e.bindTexture(o,n,i);else if(n instanceof Vd){const t=n.getGFXTexture();if(!t||!t.width||!t.height)return;e.bindTexture(o,t,i),e.bindSampler(o,n.getGFXSampler(),i)}}_doDestroy(){if(this._passes&&this._passes.length)for(const e of this._passes)e.destroy();this._passes.length=0}initDefault(e){super.initDefault(e),this.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),this.setProperty("mainColor",new ri("#ff00ff"))}validate(){return!!this._effectAsset&&!this._effectAsset.isDefault&&this.passes.length>0}}).prototype,"_effectAsset",[dA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gA=Pc(AA.prototype,"_techIdx",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xA=Pc(AA.prototype,"_defines",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yA=Pc(AA.prototype,"_states",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bA=Pc(AA.prototype,"_props",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mA=AA))||mA));c.Material=CA;const EA=ke({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048}),TA=ke({Planar:0,ShadowMap:1}),PA=ke({HARD:0,SOFT:1,SOFT_2X:2}),wA=TA.ShadowMap+1;class IA{get enabled(){return this._enabled}set enabled(e){this._setEnable(e),this.activate()}get normal(){return this._normal}set normal(e){_i.copy(this._normal,e),this._nativeObj.normal=this._normal}get distance(){return this._distance}set distance(e){this._distance=e,this._nativeObj.distance=e}get shadowColor(){return this._shadowColor}set shadowColor(e){this._shadowColor=e,this._nativeObj.color=e}get invisibleOcclusionRange(){return this._invisibleOcclusionRange}set invisibleOcclusionRange(e){this._invisibleOcclusionRange=e,this._nativeObj.invisibleOcclusionRange=e}get shadowDistance(){return this._shadowDistance}set shadowDistance(e){this._shadowDistance=e,this._nativeObj.shadowDistance=e}get type(){return this._type}set type(e){this._setType(e),this.activate()}get near(){return this._near}set near(e){this._near=e,this._nativeObj.nearValue=e}get far(){return this._far}set far(e){this._far=e,this._nativeObj.farValue=e}get orthoSize(){return this._orthoSize}set orthoSize(e){this._orthoSize=e,this._nativeObj.orthoSize=e}get size(){return this._size}set size(e){this._size.set(e),this._nativeObj.size=e}get pcf(){return this._pcf}set pcf(e){this._pcf=e,this._nativeObj.pcfType=e}get shadowMapDirty(){return this._shadowMapDirty}set shadowMapDirty(e){this._shadowMapDirty=e,this._nativeObj.shadowMapDirty=e}get bias(){return this._bias}set bias(e){this._bias=e,this._nativeObj.bias=e}get normalBias(){return this._normalBias}set normalBias(e){this._normalBias=e,this._nativeObj.normalBias=e}get saturation(){return this._saturation}set saturation(e){this._saturation=e,this._nativeObj.saturation=e}get fixedArea(){return this._fixedArea}set fixedArea(e){this._fixedArea=e,this._nativeObj.fixedArea=e}get matLight(){return this._matLight}get material(){return this._material}get instancingMaterial(){return this._instancingMaterial}get native(){return this._nativeObj}constructor(){this.fixedSphere=new Oo(0,0,0,.01),this.maxReceived=4,this.firstSetCSM=!1,this.shadowCameraFar=0,this.matShadowView=new Ei,this.matShadowProj=new Ei,this.matShadowViewProj=new Ei,this._normal=new _i(0,1,0),this._shadowColor=new ri(0,0,0,76),this._matLight=new Ei,this._material=null,this._instancingMaterial=null,this._size=new Ii(512,512),this._enabled=!1,this._distance=0,this._type=wA,this._near=.1,this._far=10,this._invisibleOcclusionRange=200,this._shadowDistance=100,this._orthoSize=1,this._pcf=0,this._shadowMapDirty=!1,this._bias=0,this._normalBias=0,this._fixedArea=!1,this._saturation=.75,this._nativeObj=new $i}getPlanarShader(e){return this._material||(this._material=new CA,this._material.initialize({effectName:"planar-shadow"}),this._nativeObj.planarPass=this._material.passes[0].native),this._material.passes[0].getShaderVariant(e)}getPlanarInstanceShader(e){return this._instancingMaterial||(this._instancingMaterial=new CA,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}),this._nativeObj.instancePass=this._instancingMaterial.passes[0].native),this._instancingMaterial.passes[0].getShaderVariant(e)}_setEnable(e){this._enabled=e,this._nativeObj.enabled=e,e||this._setType(wA)}_setType(e){this._type=this.enabled?e:wA,this._nativeObj.shadowType=this._type}initialize(e){this.near=e.near,this.far=e.far,this.invisibleOcclusionRange=e.invisibleOcclusionRange,this.shadowDistance=e.shadowDistance,this.orthoSize=e.orthoSize,this.size=e.size,this.pcf=e.pcf,this.normal=e.normal,this.distance=e.distance,this.shadowColor=e.shadowColor,this.bias=e.bias,this.normalBias=e.normalBias,this.maxReceived=e.maxReceived,this.fixedArea=e.fixedArea,this._setEnable(e.enabled),this._setType(e.type),this.saturation=e.saturation}activate(){this.enabled&&this.type===TA.Planar&&this._updatePlanarInfo()}_updatePlanarInfo(){this._material||(this._material=new CA,this._material.initialize({effectName:"planar-shadow"}),this._nativeObj.planarPass=this._material.passes[0].native),this._instancingMaterial||(this._instancingMaterial=new CA,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}),this._nativeObj.instancePass=this._instancingMaterial.passes[0].native)}_destroy(){this._nativeObj=null}destroy(){this._destroy(),this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this.fixedSphere.destroy()}}IA.MAX_FAR=2e3,IA.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),c.Shadows=IA,wn(iA.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),wn(iA.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]);const RA={};wn(RA,"CameraVisFlags",[{name:"GENERAL"}]),Pn(RA,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:Jf.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Jf.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Jf.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Jf.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Jf.BitMask,targetName:"UI_2D"}]),c.CameraVisFlags=RA;const DA={};function NA(e,t){t<1e3?t=1e3:t>15e3&&(t=15e3);const n=t*t,i=(.860117757+.000154118254*t+1.28641212e-7*n)/(1+.000842420235*t+7.08145163e-7*n),o=(.317398726+422806245e-13*t+4.20481691e-8*n)/(1-289741816e-13*t+1.61456053e-7*n),a=2*i-8*o+4,r=3*i/a,s=2*o/a,c=1/s*r,l=1/s*(1-r-s);e.x=3.2404542*c-1.5371385+-.4985314*l,e.y=-.969266*c+1.8760108+.041556*l,e.z=.0556434*c-.2040259+1.0572252*l}let OA;wn(DA,"VisibilityFlags",[{name:"GENERAL"}]),Pn(DA,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:Jf.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:Jf.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Jf.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Jf.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Jf.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Jf.Enum,targetName:"UI_2D"}]),c.VisibilityFlags=DA,Pn(qm.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),wn(gd.prototype,"Camera.prototype",[{name:"getSplitFrustum"},{name:"setMatView"},{name:"setMatViewInv"},{name:"setMatProjInv"},{name:"setMatViewProjInv"},{name:"setMatProj"},{name:"setMatViewProj"},{name:"getMatViewInv"}]),wn(IA.prototype,"Shadows.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"}]),function(e){e[e.DIRECTIONAL=0]="DIRECTIONAL",e[e.SPHERE=1]="SPHERE",e[e.SPOT=2]="SPOT",e[e.UNKNOWN=3]="UNKNOWN"}(OA||(OA=e("c7",{})));const MA=e("ch",(e=>4*Math.PI*Math.PI*e*e));class zA{constructor(){this._baked=!1,this._color=new _i(1,1,1),this._colorTemp=6550,this._colorTempRGB=new _i(1,1,1),this._scene=null,this._node=null,this._name=null,this._useColorTemperature=!1,this._type=OA.UNKNOWN}_init(){switch(this._type){case OA.DIRECTIONAL:this._nativeObj=new Yi;break;case OA.SPHERE:this._nativeObj=new Qi;break;case OA.SPOT:this._nativeObj=new Xi}this._nativeObj.setType(this._type)}_destroy(){this._nativeObj=null}get baked(){return this._baked}set baked(e){this._baked=e,this._nativeObj.setBaked(e)}set color(e){this._color.set(e),this._nativeObj.setColor(e)}get color(){return this._color}set useColorTemperature(e){this._useColorTemperature=e,this._nativeObj.setUseColorTemperature(e)}get useColorTemperature(){return this._useColorTemperature}set colorTemperature(e){this._colorTemp=e,NA(this._colorTempRGB,this._colorTemp),this._nativeObj.setColorTemperatureRGB(this._colorTempRGB)}get colorTemperature(){return this._colorTemp}get colorTemperatureRGB(){return this._colorTempRGB}set node(e){this._node=e,this._node&&(this._node.hasChangedFlags|=nA.ROTATION,this._nativeObj.setNode(e?e.native:null))}get node(){return this._node}get type(){return this._type}get name(){return this._name}set name(e){this._name=e}get scene(){return this._scene}get native(){return this._nativeObj}initialize(){this._init(),this.color=new _i(1,1,1),this.colorTemperature=6550}attachToScene(e){this._scene=e}detachFromScene(){this._scene=null}destroy(){this._name=null,this._node=null,this._destroy()}update(){}}e("cc",zA);const LA=new _i(0,0,-1),FA=new _i;class BA extends zA{set direction(e){_i.normalize(this._dir,e),this._nativeObj.setDirection(e)}get direction(){return this._dir}get illuminance(){return c.director.root.pipeline.pipelineSceneData.isHDR?this._illuminanceHDR:this._illuminanceLDR}set illuminance(e){c.director.root.pipeline.pipelineSceneData.isHDR?this.illuminanceHDR=e:this.illuminanceLDR=e}get illuminanceHDR(){return this._illuminanceHDR}set illuminanceHDR(e){this._illuminanceHDR=e,this._nativeObj.setIlluminanceHDR(e)}get illuminanceLDR(){return this._illuminanceLDR}set illuminanceLDR(e){this._illuminanceLDR=e,this._nativeObj.setIlluminanceLDR(e)}constructor(){super(),this._dir=new _i(1,-1,-1),this._illuminanceHDR=_o.SUN_ILLUM,this._illuminanceLDR=1,this._type=OA.DIRECTIONAL}initialize(){super.initialize(),this.illuminance=_o.SUN_ILLUM,this.direction=new _i(1,-1,-1)}update(){this._node&&this._node.hasChangedFlags&&(this.direction=_i.transformQuat(FA,LA,this._node.worldRotation))}}e("cf",BA);class kA extends qm{get parent(){return this._parent}constructor(e,t){super(e.root),this._parent=void 0,this._owner=void 0,this._dontNotify=!1,this._parent=e,this._owner=t,this._doInit(this._parent,!0);for(let e=0;e<this._shaderInfo.blocks.length;e++){const t=this._shaderInfo.blocks[e],n=this._blocks[t.binding],i=this._parent.blocks[t.binding];n.set(i)}this._setRootBufferDirty(!0);const n=this._parent;for(let e=0;e<this._shaderInfo.samplerTextures.length;e++){const t=this._shaderInfo.samplerTextures[e];for(let e=0;e<t.count;e++){const i=n._descriptorSet.getSampler(t.binding,e),o=n._descriptorSet.getTexture(t.binding,e);this._descriptorSet.bindSampler(t.binding,i,e),this._descriptorSet.bindTexture(t.binding,o,e)}}super.tryCompile()}overridePipelineStates(e,t){this._bs.reset(),this._rs.reset(),this._dss.reset(),qm.fillPipelineInfo(this,e),qm.fillPipelineInfo(this,t),this._onStateChange()}tryCompile(e){if(e&&!wm(this._defines,e))return!1;const t=super.tryCompile();return this._onStateChange(),t}beginChangeStatesSilently(){this._dontNotify=!0}endChangeStatesSilently(){this._dontNotify=!1}_syncBatchingScheme(){this._defines.USE_BATCHING=this._defines.USE_INSTANCING=!1,this._setBatchingScheme(Wm.NONE)}_onStateChange(){this._setHash(qm.getPassHash(this)),this._owner.onPassStateChange(this._dontNotify)}}class UA extends CA{get parent(){return this._parent}get owner(){return this._owner}constructor(e){super(),this._passes=[],this._parent=void 0,this._owner=void 0,this._subModelIdx=0,this._parent=e.parent,this._owner=e.owner||null,this._subModelIdx=e.subModelIdx||0,this.copy(this._parent)}recompileShaders(e,t){if(this._passes&&this.effectAsset)if(void 0===t)for(const t of this._passes)t.tryCompile(e);else this._passes[t].tryCompile(e)}overridePipelineStates(e,t){if(!this._passes||!this.effectAsset)return;const n=this.effectAsset.techniques[this.technique].passes;if(void 0===t)for(let t=0;t<this._passes.length;t++){const i=this._passes[t],o=this._states[t]||(this._states[t]={});for(const t in e)o[t]=e[t];i.overridePipelineStates(n[i.passIndex],o)}else{const i=this._states[t]||(this._states[t]={});for(const t in e)i[t]=e[t];this._passes[t].overridePipelineStates(n[t],i)}}destroy(){return this._doDestroy(),!0}onPassStateChange(e){this._hash=CA.getHash(this),!e&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)}_createPasses(){const e=[],t=this._parent.passes;if(!t)return e;for(let n=0;n<t.length;++n)e.push(new kA(t[n],this));return e}}e("da",UA);let GA=null,jA=null;class VA{get model(){return this._model}get enabled(){return this._enabled}set enabled(e){this._setEnabled(e),e?this.activate():this._updatePipeline()}get useHDR(){return this._useHDR}set useHDR(e){this._setUseHDR(e),this.setEnvMaps(this._envmapHDR,this._envmapLDR)}get useIBL(){return this._useIBL}set useIBL(e){this._setUseIBL(e),this._updatePipeline()}get useDiffuseMap(){return this._useDiffuseMap}set useDiffuseMap(e){this._useDiffuseMap=e,this.setDiffuseMaps(null,null)}get isRGBE(){return!!this.envmap&&this.envmap.isRGBE}get envmap(){return c.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR}set envmap(e){c.director.root.pipeline.pipelineSceneData.isHDR?this.setEnvMaps(e,this._envmapLDR):this.setEnvMaps(this._envmapHDR,e)}get diffuseMap(){return c.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR}set diffuseMap(e){c.director.root.pipeline.pipelineSceneData.isHDR?this.setDiffuseMaps(e,this._diffuseMapLDR):this.setDiffuseMaps(this._diffuseMapHDR,e)}get native(){return this._nativeObj}constructor(){this._envmapLDR=null,this._envmapHDR=null,this._diffuseMapLDR=null,this._diffuseMapHDR=null,this._globalDSManager=null,this._model=null,this._default=null,this._enabled=!1,this._useIBL=!1,this._useHDR=!0,this._useDiffuseMap=!1,this._nativeObj=new Zi}_setEnabled(e){this._enabled=e,this._nativeObj.enabled=e}_setUseIBL(e){this._useIBL=e,this._nativeObj.useIBL=e}_setUseHDR(e){this._useHDR=e,this._nativeObj.useHDR=e}_setUseDiffuseMap(e){this._useDiffuseMap=e,this._nativeObj.useDiffuseMap=e}initialize(e){this._setEnabled(e.enabled),this._setUseIBL(e.useIBL),this._setUseDiffuseMap(e.applyDiffuseMap),this._setUseHDR(e.useHDR)}setEnvMaps(e,t){this._envmapHDR=e,this._envmapLDR=t;const n=c.director.root;n.pipeline.pipelineSceneData.isHDR?e&&(n.pipeline.pipelineSceneData.ambient.mipmapCount=e.mipmapLevel):t&&(n.pipeline.pipelineSceneData.ambient.mipmapCount=t.mipmapLevel),this._updateGlobalBinding(),this._updatePipeline()}setDiffuseMaps(e,t){this._diffuseMapHDR=e,this._diffuseMapLDR=t,this._updateGlobalBinding(),this._updatePipeline()}activate(){const e=c.director.root.pipeline;this._globalDSManager=e.globalDSManager,this._default=Bm.get("default-cube-texture"),this._model||(this._model=c.director.root.createModel(c.renderer.scene.Model),this._model._initLocalDescriptors=()=>{},this._model._initWorldBoundDescriptors=()=>{},this._nativeObj.model=this._model.native);let t=this._default.isRGBE;if(this.envmap&&(t=this.envmap.isRGBE),!jA){const e=new CA;e.initialize({effectName:"skybox",defines:{USE_RGBE_CUBEMAP:t}}),jA=new UA({parent:e})}this.enabled&&(GA||(GA=c.utils.createMesh(c.primitives.box({width:2,height:2,length:2}))),this._model.initSubModel(0,GA.renderingSubMeshes[0],jA)),this.envmap||(this.envmap=this._default),this.diffuseMap||(this.diffuseMap=this._default),this._updateGlobalBinding(),this._updatePipeline()}_updatePipeline(){this._nativeObj.isRGBE=this.isRGBE;const e=c.director.root,t=e.pipeline,n=this.useIBL?this.isRGBE?2:1:0,i=this.useIBL&&this.useDiffuseMap&&this.diffuseMap?this.isRGBE?2:1:0,o=this.useHDR;t.macros.CC_USE_IBL===n&&t.macros.CC_USE_DIFFUSEMAP===i&&t.macros.CC_USE_HDR===o||(t.macros.CC_USE_IBL=n,t.macros.CC_USE_DIFFUSEMAP=i,t.macros.CC_USE_HDR=o,e.onGlobalPipelineStateChanged()),this.enabled&&jA&&jA.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE}),this._model&&this._model.setSubModelMaterial(0,jA)}_updateGlobalBinding(){if(this._globalDSManager){const e=c.director.root.device,t=this.envmap?this.envmap:this._default;if(t){const n=t.getGFXTexture(),i=e.getSampler(t.getSamplerInfo());this._globalDSManager.bindSampler(mp,i),this._globalDSManager.bindTexture(mp,n)}const n=this.diffuseMap?this.diffuseMap:this._default;if(n){const t=n.getGFXTexture(),i=e.getSampler(n.getSamplerInfo());this._globalDSManager.bindSampler(gp,i),this._globalDSManager.bindTexture(gp,t)}this._globalDSManager.update()}}_destroy(){this._nativeObj=null}destroy(){this._destroy()}}c.Skybox=VA;class HA extends zA{_init(){super._init(),this._nativeObj.setPosition(this._pos),this._nativeObj.setAABB(this._aabb.native)}_destroy(){super._destroy()}get position(){return this._pos}set size(e){this._size=e,this._nativeObj.setSize(e)}get size(){return this._size}set range(e){this._range=e,this._nativeObj.setRange(e),this._needUpdate=!0}get range(){return this._range}get luminance(){return c.director.root.pipeline.pipelineSceneData.isHDR?this._luminanceHDR:this._luminanceLDR}set luminance(e){c.director.root.pipeline.pipelineSceneData.isHDR?this.luminanceHDR=e:this.luminanceLDR=e}get luminanceHDR(){return this._luminanceHDR}set luminanceHDR(e){this._luminanceHDR=e,this._nativeObj.setLuminanceHDR(e)}set luminanceLDR(e){this._luminanceLDR=e,this._nativeObj.setLuminanceLDR(e)}get aabb(){return this._aabb}constructor(){super(),this._needUpdate=!1,this._size=.15,this._range=1,this._luminanceHDR=0,this._luminanceLDR=0,this._pos=void 0,this._aabb=void 0,this._aabb=dc.create(),this._pos=new _i,this._type=OA.SPHERE}initialize(){super.initialize(),this.size=.15,this.range=1,this.luminance=1700/MA(.15),this.luminanceLDR=1}update(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);const e=this._range;dc.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,e,e,e),this._needUpdate=!1}}}e("ci",HA);const WA=new _i(0,0,-1),qA=new Ai,YA=new Ei,XA=new Ei,QA=new Ei,ZA=new Ei;class JA extends zA{_init(){super._init();{const e=this._nativeObj;e.setAABB(this._aabb.native),e.setFrustum(this._frustum),e.setDirection(this._dir),e.setPosition(this._pos)}}_destroy(){super._destroy()}_setDirection(e){this._dir.set(e),this._nativeObj.setDirection(e)}get position(){return this._pos}set size(e){this._size=e,this._nativeObj.setSize(e)}get size(){return this._size}set range(e){this._range=e,this._nativeObj.setRange(e),this._needUpdate=!0}get range(){return this._range}get luminance(){return c.director.root.pipeline.pipelineSceneData.isHDR?this._luminanceHDR:this._luminanceLDR}set luminance(e){c.director.root.pipeline.pipelineSceneData.isHDR?this.luminanceHDR=e:this.luminanceLDR=e}get luminanceHDR(){return this._luminanceHDR}set luminanceHDR(e){this._luminanceHDR=e,this._nativeObj.setLuminanceHDR(e)}get luminanceLDR(){return this._luminanceLDR}set luminanceLDR(e){this._luminanceLDR=e,this._nativeObj.setLuminanceLDR(e)}get direction(){return this._dir}get spotAngle(){return this._spotAngle}set spotAngle(e){this._angle=e,this._spotAngle=Math.cos(.5*e),this._nativeObj.setAngle(this._spotAngle),this._needUpdate=!0}get angle(){return this._angle}set aspect(e){this._aspect=e,this._nativeObj.setAspect(e),this._needUpdate=!0}get aspect(){return this._aspect}get aabb(){return this._aabb}get frustum(){return this._frustum}constructor(){super(),this._dir=new _i(1,-1,-1),this._range=5,this._spotAngle=Math.cos(Math.PI/6),this._pos=void 0,this._aabb=void 0,this._frustum=void 0,this._angle=0,this._needUpdate=!1,this._size=.15,this._luminanceHDR=0,this._luminanceLDR=0,this._aspect=0,this._aabb=dc.create(),this._frustum=Ec.create(),this._pos=new _i,this._type=OA.SPOT}initialize(){super.initialize(),this.size=.15,this.aspect=1,this.luminance=1700/MA(.15),this.luminanceLDR=1,this.range=Math.cos(Math.PI/6),this._setDirection(new _i(1,-1,-1))}update(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),_i.transformQuat(this._dir,WA,this._node.getWorldRotation(qA)),_i.normalize(this._dir,this._dir),dc.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(YA),Ei.invert(YA,YA),Ei.perspective(XA,this._angle,1,.001,this._range),Ei.multiply(QA,XA,YA),this._frustum.update(QA,ZA),this._needUpdate=!1)}}e("ck",JA);var KA=Object.freeze({__proto__:null,Ambient:_o,Octree:uo,get CameraFOVAxis(){return rd},get CameraProjection(){return sd},get CameraAperture(){return cd},get CameraISO(){return ld},get CameraShutter(){return _d},SKYBOX_FLAG:Ad,Camera:gd,CameraVisFlags:RA,VisibilityFlags:DA,DirectionalLight:BA,ColorTemperatureToRGB:NA,get LightType(){return OA},nt2lm:MA,Light:zA,get ModelType(){return Jm},Model:eA,ShadowSize:EA,ShadowType:TA,PCFType:PA,Shadows:IA,RenderScene:iA,Skybox:VA,SphereLight:HA,SpotLight:JA,SubModel:Xm,NativeNode:Gi,NativeScene:ji,NativeModel:Vi,NativeSkinningModel:Hi,NativeBakedSkinningModel:Wi,NativeLight:qi,NativeDirectionalLight:Yi,NativeSpotLight:Xi,NativeSphereLight:Qi,NaitveSkybox:Zi,NativeFog:Ji,NativeAmbient:Ki,NativeShadow:$i,NativeOctree:eo,NativeCamera:to,NativeRenderWindow:no,NativeRenderScene:io,NativeDrawBatch2D:oo,NativePass:ao,NativeSubModel:ro,NativeRoot:so,NativePipelineSharedSceneData:co,NativeAABB:lo});let $A,ev;function tv(e){return--e,e|=e>>16,e|=e>>8,e|=e>>4,e|=e>>2,e|=e>>1,++e}function nv(e,t){return Math.ceil(e/t)*t}!function(e){e[e.OPAQUE=0]="OPAQUE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OVERLAY=2]="OVERLAY"}($A||($A={})),function(e){e[e.DEFAULT=1]="DEFAULT",e[e.FORWARD=2]="FORWARD",e[e.SHADOWCAST=4]="SHADOWCAST"}(ev||(ev={}));class iv{constructor(e){this._device=void 0,this._format=Go.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new Oa,this._region1=new Oa,this._region2=new Oa,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=e}initialize(e){const t=Pr[e.format];this._format=e.format,this._formatSize=t.size,this._channels=t.count,this._bufferViewCtor=Fr(t),this._roundUpFn=e.roundUpFn||null,this._alignment=e.alignment||1,e.inOrderFree&&(this.alloc=this._McDonaldAlloc)}destroy(){for(let e=0;e<this._chunkCount;++e)this._chunks[e].texture.destroy();this._chunks.length=0,this._handles.length=0}alloc(e,t){e=nv(e,this._alignment);let n=-1,i=-1;if(void 0!==t&&(n=t,i=this._findAvailableSpace(e,n)),i<0)for(let t=0;t<this._chunkCount&&(n=t,i=this._findAvailableSpace(e,n),!(i>=0));++t);if(i>=0){const t=this._chunks[n];t.start+=e;const o={chunkIdx:n,start:i,end:i+e,texture:t.texture};return this._handles.push(o),o}const o=Math.sqrt(e/this._formatSize),a=this._roundUpFn&&this._roundUpFn(o,this._formatSize)||Math.max(1024,tv(o)),r=this._chunks[this.createChunk(a)];r.start+=e;const s={chunkIdx:this._chunkCount-1,start:0,end:e,texture:r.texture};return this._handles.push(s),s}free(e){for(let t=0;t<this._handles.length;++t)if(this._handles[t]===e)return this._chunks[e.chunkIdx].end=e.end,void this._handles.splice(t,1)}createChunk(e){const t=e*e*this._formatSize;y(`TextureBufferPool: Allocate chunk ${this._chunkCount}, size: ${t}, format: ${this._format}`);const n={texture:this._device.createTexture(new Ha(Xo.TEX2D,Qo.SAMPLED|Qo.TRANSFER_DST,this._format,e,e)),size:t,start:0,end:t};return this._chunks[this._chunkCount]=n,this._chunkCount++}update(e,t){const n=[],i=[],o=e.start/this._formatSize;let a=t.byteLength/this._formatSize,r=o%e.texture.width,s=Math.floor(o/e.texture.width),c=Math.min(e.texture.width-r,a),l=0;r>0&&(this._region0.texOffset.x=r,this._region0.texOffset.y=s,this._region0.texExtent.width=c,this._region0.texExtent.height=1,n.push(new this._bufferViewCtor(t,l*this._formatSize,c*this._channels)),i.push(this._region0),r=0,s+=1,a-=c,l+=c),a>0&&(this._region1.texOffset.x=r,this._region1.texOffset.y=s,a>e.texture.width?(this._region1.texExtent.width=e.texture.width,this._region1.texExtent.height=Math.floor(a/e.texture.width),c=this._region1.texExtent.width*this._region1.texExtent.height):(c=a,this._region1.texExtent.width=c,this._region1.texExtent.height=1),n.push(new this._bufferViewCtor(t,l*this._formatSize,c*this._channels)),i.push(this._region1),r=0,s+=this._region1.texExtent.height,a-=c,l+=c),a>0&&(this._region2.texOffset.x=r,this._region2.texOffset.y=s,this._region2.texExtent.width=a,this._region2.texExtent.height=1,n.push(new this._bufferViewCtor(t,l*this._formatSize,a*this._channels)),i.push(this._region2)),this._device.copyBuffersToTexture(n,e.texture,i)}_findAvailableSpace(e,t){const n=this._chunks[t];let i=!1,o=n.start;if(o+e<=n.size)i=!0;else{o=0;const a=this._handles.filter((e=>e.chunkIdx===t)).sort(((e,t)=>e.start-t.start));for(let t=0;t<a.length;t++){const n=a[t];if(o+e<=n.start){i=!0;break}o=n.end}!i&&o+e<=n.size&&(i=!0)}return i?o:-1}_McDonaldAlloc(e){e=nv(e,this._alignment);for(let t=0;t<this._chunkCount;++t){const n=this._chunks[t];let i=!1,o=n.start;if(o+e<=n.end?i=!0:o>n.end?o+e<=n.size?i=!0:e<=n.end&&(n.start=o=0,i=!0):o===n.end&&(n.start=o=0,n.end=n.size,e<=n.end&&(i=!0)),i){n.start+=e;const i={chunkIdx:t,start:o,end:o+e,texture:n.texture};return this._handles.push(i),i}}const t=Math.sqrt(e/this._formatSize),n=this._roundUpFn&&this._roundUpFn(t,this._formatSize)||Math.max(1024,tv(t)),i=this._chunks[this.createChunk(n)];i.start+=e;const o={chunkIdx:this._chunkCount,start:0,end:e,texture:i.texture};return this._handles.push(o),o}}e("co",iv);const ov=gn.addStage;var av=Object.freeze({__proto__:null,addStage:ov,scene:KA,createIA:function(e,t){if(!t.positions)return console.error("The data must have positions field"),null;const n=[],i=t.positions.length/3;for(let e=0;e<i;++e)n.push(t.positions[3*e],t.positions[3*e+1],t.positions[3*e+2]),t.normals&&n.push(t.normals[3*e],t.normals[3*e+1],t.normals[3*e+2]),t.uvs&&n.push(t.uvs[2*e],t.uvs[2*e+1]),t.colors&&n.push(t.colors[3*e],t.colors[3*e+1],t.colors[3*e+2]);const o=[];o.push(new ir(Sa.ATTR_POSITION,Go.RGB32F)),t.normals&&o.push(new ir(Sa.ATTR_NORMAL,Go.RGB32F)),t.uvs&&o.push(new ir(Sa.ATTR_TEX_COORD,Go.RG32F)),t.colors&&o.push(new ir(Sa.ATTR_COLOR,Go.RGB32F));const a=e.createBuffer(new ka(Ho.VERTEX|Ho.TRANSFER_DST,Yo.DEVICE,4*n.length,4*n.length/i));a.update(new Float32Array(n));let r=null;return t.indices&&(r=e.createBuffer(new ka(Ho.INDEX|Ho.TRANSFER_DST,Yo.DEVICE,2*t.indices.length,2)),r.update(new Uint16Array(t.indices))),e.createInputAssembler(new ar(o,[a],r))},get RenderQueue(){return $A},get PassStage(){return ev},genHandle:vm,getTypeFromHandle:gm,getBindingFromHandle:xm,getCountFromHandle:ym,getOffsetFromHandle:bm,customizeType:Sm,type2reader:Cm,type2writer:Em,getDefaultFromType:Pm,overrideMacros:wm,get BatchingSchemes(){return Wm},Pass:qm,getDeviceShaderVersion:zm,programLib:Lm,nearestPOT:tv,TextureBufferPool:iv,MaterialInstance:UA,PassInstance:kA,get PoolType(){return Zs},NULL_HANDLE:0,get NodeView(){return Js},NodePool:ec,get PassView(){return tc},PassPool:oc,get AABBView(){return ac},AABBPool:cc});e("f3",av);const rv=new _i,sv=(new _i,new _i,new _i),cv=new Ei,lv=new dc,_v=new dc;let uv=!1;const hv=Oo.create(0,0,0,1),fv=new Oo,pv=new Ec;pv.accurate=!0;let dv=new Ec;dv.accurate=!0;const mv=new Ec,Av=new Ei,vv=new Ei,gv=new Ei,xv=new Ei,yv=new Ei,bv=new Ei,Sv=new Ei,Cv=new _i,Ev=new Ii,Tv=new _i,Pv=new _i,wv=new _i(0,0,0),Iv=(new dc,new ze((()=>({model:null,depth:0})),128)),Rv=new ze((()=>({model:null,depth:0})),128),Dv=new ze((()=>({model:null,depth:0})),128);function Nv(e,t){let n=0;e.node&&(_i.subtract(rv,e.node.worldPosition,t.position),n=_i.dot(rv,t.forward));const i=Iv.alloc();return i.model=e,i.depth=n,i}function Ov(e,t){let n=0;e.node&&(_i.subtract(rv,e.node.worldPosition,t.position),n=_i.dot(rv,t.forward));const i=Rv.alloc();return i.model=e,i.depth=n,i}function Mv(e,t){let n=0;e.node&&(_i.subtract(rv,e.node.worldPosition,t.position),n=_i.dot(rv,t.forward));const i=Dv.alloc();return i.model=e,i.depth=n,i}function zv(e,t){const n=e.pipelineSceneData.validPunctualLights;n.length=0;const{spotLights:i}=t.scene;for(let e=0;e<i.length;e++){const o=i[e];o.baked||(Oo.set(hv,o.position.x,o.position.y,o.position.z,o.range),Gs.sphereFrustum(hv,t.frustum)&&n.push(o))}const{sphereLights:o}=t.scene;for(let e=0;e<o.length;e++){const i=o[e];i.baked||(Oo.set(hv,i.position.x,i.position.y,i.position.z,i.range),Gs.sphereFrustum(hv,t.frustum)&&n.push(i))}}function Lv(e,t){const n=t.scene,i=n.mainLight,o=e.pipelineSceneData,a=o.shadows,r=o.skybox,s=o.renderObjects;Iv.freeArray(s),s.length=0;const c=o.castShadowObjects;Dv.freeArray(c),c.length=0,uv=!1;let l=null;if(a.enabled&&(e.pipelineUBO.updateShadowUBORange(hp.SHADOW_COLOR_OFFSET,a.shadowColor),a.type===TA.ShadowMap))if(l=e.pipelineSceneData.dirShadowObjects,Rv.freeArray(l),l.length=0,i&&i.node)!function(e,t,n,i,o){const a=t.device;if(o.fixedArea){const t=o.orthoSize,i=o.orthoSize,r=o.near,s=o.far;Ei.fromRT(Av,n.node.getWorldRotation(),n.node.getWorldPosition()),Ei.invert(vv,Av),Ei.ortho(xv,-t,t,-i,i,r,s,a.capabilities.clipSpaceMinZ,a.capabilities.clipSpaceSignY),Ei.multiply(yv,xv,vv),Ei.invert(gv,vv),o.matShadowView=vv,o.matShadowProj=xv,o.matShadowViewProj=yv,Ec.createOrtho(e,2*t,2*i,r,s,gv)}else{const t=o.invisibleOcclusionRange,r=o.size.x;!function(e,t){if(!t.node)return;const n=t.node,i=n.getWorldPosition(),o=n.getWorldRotation();Ei.fromRT(e,o,i),e.m08*=-1,e.m09*=-1,e.m10*=-1}(cv,i),Ec.split(pv,i,cv,.1,o.shadowDistance),dv=Ec.clone(pv),Ei.fromRT(Av,n.node.rotation,wv),Ei.invert(vv,Av),Ei.invert(gv,vv);const s=vv.clone();dv.transform(vv),dc.fromPoints(lv,new _i(1e7,1e7,1e7),new _i(-1e7,-1e7,-1e7)),lv.mergeFrustum(dv);const c=2*lv.halfExtents.z;sv.set(lv.center.x,lv.center.y,lv.center.z+lv.halfExtents.z+t),_i.transformMat4(sv,sv,gv),Ei.fromRT(Av,n.node.rotation,sv),Ei.invert(vv,Av),Ei.invert(gv,vv);const l=_i.distance(pv.vertices[0],pv.vertices[6]);fv.center.set(0,0,0),fv.radius=-1,fv.mergePoints(pv.vertices);const _=.8*l+.4*fv.radius;o.shadowCameraFar=c+t;const u=.5*_;if(Ei.ortho(xv,-u,u,-u,u,.1,o.shadowCameraFar,a.capabilities.clipSpaceMinZ,a.capabilities.clipSpaceSignY),r>0){Ei.multiply(bv,xv,s),_i.transformMat4(Cv,sv,bv);const t=2/r;Ev.set(t,t);const i=Cv.x%Ev.x,a=Cv.y%Ev.y;Tv.set(Cv.x-i,Cv.y-a,Cv.z),Ei.invert(Sv,bv),_i.transformMat4(Pv,Tv,Sv),Ei.fromRT(Av,n.node.rotation,Pv),Ei.invert(vv,Av),Ei.invert(gv,vv),Ec.createOrtho(e,_,_,.1,o.shadowCameraFar,gv)}else{for(let t=0;t<8;t++)e.vertices[t].set(0,0,0);e.updatePlanes()}Ei.multiply(yv,xv,vv),o.matShadowView=vv,o.matShadowProj=xv,o.matShadowViewProj=yv}}(mv,e,i,t,a);else{for(let e=0;e<8;e++)mv.vertices[e].set(0,0,0);mv.updatePlanes()}i&&a.type===TA.Planar&&function(e,t){const n=e.pipelineSceneData.shadows,i=t.direction,o=n.normal,a=n.distance+.001,r=1/_i.dot(o,i),s=i.x*r,c=i.y*r,l=i.z*r,_=o.x,u=o.y,h=o.z,f=n.matLight;f.m00=1-_*s,f.m01=-_*c,f.m02=-_*l,f.m03=0,f.m04=-u*s,f.m05=1-u*c,f.m06=-u*l,f.m07=0,f.m08=-h*s,f.m09=-h*c,f.m10=1-h*l,f.m11=0,f.m12=s*a,f.m13=c*a,f.m14=l*a,f.m15=1,e.pipelineUBO.updateShadowUBORange(hp.MAT_LIGHT_PLANE_PROJ_OFFSET,n.matLight)}(e,i),r.enabled&&r.model&&t.clearFlag&Ad&&s.push(Nv(r.model,t));const _=n.models,u=t.visibility;for(let e=0;e<_.length;e++){const n=_[e];if(n.enabled&&(n.castShadow&&c.push(Mv(n,t)),a.firstSetCSM&&n.worldBounds&&(uv||(_v.copy(n.worldBounds),uv=!0),dc.merge(_v,_v,n.worldBounds)),n.node&&(u&n.node.layer)===n.node.layer||u&n.visFlags)){if(null!=l&&n.castShadow&&n.worldBounds&&Gs.aabbFrustum(n.worldBounds,mv)&&l.push(Ov(n,t)),n.worldBounds&&!Gs.aabbFrustum(n.worldBounds,t.frustum))continue;s.push(Nv(n,t))}}a.firstSetCSM&&(a.shadowDistance=2*_v.halfExtents.length(),a.firstSetCSM=!1)}const Fv=new qa($o.LINEAR,$o.LINEAR,$o.NONE,ea.CLAMP,ea.CLAMP,ea.CLAMP),Bv=new qa($o.POINT,$o.POINT,$o.NONE,ea.CLAMP,ea.CLAMP,ea.CLAMP);class kv{get descriptorSetMap(){return this._descriptorSetMap}get linearSampler(){return this._linearSampler}get pointSampler(){return this._pointSampler}get descriptorSetLayout(){return this._descriptorSetLayout}get globalDescriptorSet(){return this._globalDescriptorSet}constructor(e){this._device=void 0,this._descriptorSetMap=new Map,this._globalDescriptorSet=void 0,this._descriptorSetLayout=void 0,this._linearSampler=void 0,this._pointSampler=void 0,this._device=e.device,this._linearSampler=this._device.getSampler(Fv),this._pointSampler=this._device.getSampler(Bv);const t=new dr(ep.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(t),this._globalDescriptorSet=this._device.createDescriptorSet(new mr(this._descriptorSetLayout))}bindBuffer(e,t){this._globalDescriptorSet.bindBuffer(e,t);const n=this._descriptorSetMap.values();let i=n.next();for(;!i.done;)i.value.bindBuffer(e,t),i=n.next()}bindSampler(e,t){this._globalDescriptorSet.bindSampler(e,t);const n=this._descriptorSetMap.values();let i=n.next();for(;!i.done;)i.value.bindSampler(e,t),i=n.next()}bindTexture(e,t){this._globalDescriptorSet.bindTexture(e,t);const n=this._descriptorSetMap.values();let i=n.next();for(;!i.done;)i.value.bindTexture(e,t),i=n.next()}update(){this._globalDescriptorSet.update();const e=this._descriptorSetMap.values();let t=e.next();for(;!t.done;)t.value.update(),t=e.next()}getOrCreateDescriptorSet(e){const t=this._device;if(!this._descriptorSetMap.has(e)){const n=this._globalDescriptorSet,i=t.createDescriptorSet(new mr(this._descriptorSetLayout));this._descriptorSetMap.set(e,i);for(let e=np.UBO_GLOBAL;e<np.COUNT;e++)i.bindBuffer(e,n.getBuffer(e)),i.bindSampler(e,n.getSampler(e)),i.bindTexture(e,n.getTexture(e));const o=t.createBuffer(new ka(Ho.UNIFORM|Ho.TRANSFER_DST,Yo.HOST|Yo.DEVICE,hp.SIZE,hp.SIZE));i.bindBuffer(hp.BINDING,o),i.update()}return this._descriptorSetMap.get(e)}destroy(){this._descriptorSetLayout.destroy()}}const Uv=new Ei,Gv=new Ei,jv=new Ei,Vv=new Oi,Hv=new Oi(0,0,1,0);class Wv{constructor(){this._globalUBO=new Float32Array(_p.COUNT),this._cameraUBO=new Float32Array(up.COUNT),this._shadowUBO=new Float32Array(hp.COUNT)}static updateGlobalUBOView(e,t){const n=c.director.root,i=t,o=Math.floor(e.width),a=Math.floor(e.height);i[_p.TIME_OFFSET]=n.cumulativeTime,i[_p.TIME_OFFSET+1]=n.frameTime,i[_p.TIME_OFFSET+2]=c.director.getTotalFrames(),i[_p.SCREEN_SIZE_OFFSET]=o,i[_p.SCREEN_SIZE_OFFSET+1]=a,i[_p.SCREEN_SIZE_OFFSET+2]=1/o,i[_p.SCREEN_SIZE_OFFSET+3]=1/a,i[_p.NATIVE_SIZE_OFFSET]=o,i[_p.NATIVE_SIZE_OFFSET+1]=a,i[_p.NATIVE_SIZE_OFFSET+2]=1/i[_p.NATIVE_SIZE_OFFSET],i[_p.NATIVE_SIZE_OFFSET+3]=1/i[_p.NATIVE_SIZE_OFFSET+1]}static updateCameraUBOView(e,t,n){const i=(n.scene?n.scene:c.director.getScene().renderScene).mainLight,o=e.pipelineSceneData,a=o.ambient,r=o.fog,s=o.shadows,l=t,_=n.exposure,u=o.isHDR;if(l[up.SCREEN_SCALE_OFFSET]=o.shadingScale,l[up.SCREEN_SCALE_OFFSET+1]=o.shadingScale,l[up.SCREEN_SCALE_OFFSET+2]=1/l[up.SCREEN_SCALE_OFFSET],l[up.SCREEN_SCALE_OFFSET+3]=1/l[up.SCREEN_SCALE_OFFSET+1],l[up.EXPOSURE_OFFSET]=_,l[up.EXPOSURE_OFFSET+1]=1/_,l[up.EXPOSURE_OFFSET+2]=u?1:0,l[up.EXPOSURE_OFFSET+3]=0,i){const e=s.enabled&&s.type===TA.ShadowMap?1:0,t=i.direction;if(Hv.set(t.x,t.y,t.z,e),Oi.toArray(l,Hv,up.MAIN_LIT_DIR_OFFSET),_i.toArray(l,i.color,up.MAIN_LIT_COLOR_OFFSET),i.useColorTemperature){const e=i.colorTemperatureRGB;l[up.MAIN_LIT_COLOR_OFFSET]*=e.x,l[up.MAIN_LIT_COLOR_OFFSET+1]*=e.y,l[up.MAIN_LIT_COLOR_OFFSET+2]*=e.z}l[up.MAIN_LIT_COLOR_OFFSET+3]=u?i.illuminance*_:i.illuminance}else Hv.set(0,0,1,0),Oi.toArray(l,Hv,up.MAIN_LIT_DIR_OFFSET),Oi.toArray(l,Oi.ZERO,up.MAIN_LIT_COLOR_OFFSET);const h=a.skyColor;h.w=u?a.skyIllum*_:a.skyIllum,l[up.AMBIENT_SKY_OFFSET+0]=h.x,l[up.AMBIENT_SKY_OFFSET+1]=h.y,l[up.AMBIENT_SKY_OFFSET+2]=h.z,l[up.AMBIENT_SKY_OFFSET+3]=h.w,l[up.AMBIENT_GROUND_OFFSET+0]=a.groundAlbedo.x,l[up.AMBIENT_GROUND_OFFSET+1]=a.groundAlbedo.y,l[up.AMBIENT_GROUND_OFFSET+2]=a.groundAlbedo.z,l[up.AMBIENT_GROUND_OFFSET+3]=a.mipmapCount,Ei.toArray(l,n.matView,up.MAT_VIEW_OFFSET),Ei.toArray(l,n.node.worldMatrix,up.MAT_VIEW_INV_OFFSET),_i.toArray(l,n.position,up.CAMERA_POS_OFFSET),Ei.toArray(l,n.matProj,up.MAT_PROJ_OFFSET),Ei.toArray(l,n.matProjInv,up.MAT_PROJ_INV_OFFSET),Ei.toArray(l,n.matViewProj,up.MAT_VIEW_PROJ_OFFSET),Ei.toArray(l,n.matViewProjInv,up.MAT_VIEW_PROJ_INV_OFFSET),l[up.CAMERA_POS_OFFSET+3]=this.getCombineSignY();const f=r.colorArray;l[up.GLOBAL_FOG_COLOR_OFFSET]=f.x,l[up.GLOBAL_FOG_COLOR_OFFSET+1]=f.y,l[up.GLOBAL_FOG_COLOR_OFFSET+2]=f.z,l[up.GLOBAL_FOG_COLOR_OFFSET+3]=f.z,l[up.GLOBAL_FOG_BASE_OFFSET]=r.fogStart,l[up.GLOBAL_FOG_BASE_OFFSET+1]=r.fogEnd,l[up.GLOBAL_FOG_BASE_OFFSET+2]=r.fogDensity,l[up.GLOBAL_FOG_ADD_OFFSET]=r.fogTop,l[up.GLOBAL_FOG_ADD_OFFSET+1]=r.fogRange,l[up.GLOBAL_FOG_ADD_OFFSET+2]=r.fogAtten,l[up.NEAR_FAR_OFFSET]=n.nearClip,l[up.NEAR_FAR_OFFSET+1]=n.farClip,l[up.VIEW_PORT_OFFSET]=o.shadingScale*n.window.width*n.viewport.x,l[up.VIEW_PORT_OFFSET+1]=o.shadingScale*n.window.height*n.viewport.y,l[up.VIEW_PORT_OFFSET+2]=o.shadingScale*n.window.width*n.viewport.z,l[up.VIEW_PORT_OFFSET+3]=o.shadingScale*n.window.height*n.viewport.w}static updateShadowUBOView(e,t,n){const i=e.device,o=n.scene.mainLight,a=e.pipelineSceneData.shadows,r=t;if(a.enabled){if(o&&a.type===TA.ShadowMap){let e=.1,n=0;const o=a.matShadowView,s=a.matShadowProj,c=a.matShadowViewProj;a.fixedArea?(e=a.near,n=a.far):(e=.1,n=a.shadowCameraFar),Ei.toArray(t,o,hp.MAT_LIGHT_VIEW_OFFSET),r[hp.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=s.m10,r[hp.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=s.m14,r[hp.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=s.m11,r[hp.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=s.m15,r[hp.SHADOW_PROJ_INFO_OFFSET+0]=s.m00,r[hp.SHADOW_PROJ_INFO_OFFSET+1]=s.m05,r[hp.SHADOW_PROJ_INFO_OFFSET+2]=1/s.m00,r[hp.SHADOW_PROJ_INFO_OFFSET+3]=1/s.m05,Ei.toArray(t,c,hp.MAT_LIGHT_VIEW_PROJ_OFFSET);const l=0,_=ad(i)?0:1;r[hp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+0]=e,r[hp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+1]=n,r[hp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+2]=l,r[hp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+3]=1-a.saturation,r[hp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=a.size.x,r[hp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=a.size.y,r[hp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=a.pcf,r[hp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=a.bias,r[hp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=0,r[hp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=_,r[hp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=a.normalBias,r[hp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0}else o&&a.type===TA.Planar&&(function(e,t,n){const i=t.direction,o=e.normal,a=e.distance+.001,r=1/_i.dot(o,i),s=i.x*r,c=i.y*r,l=i.z*r,_=o.x,u=o.y,h=o.z,f=e.matLight;f.m00=1-_*s,f.m01=-_*c,f.m02=-_*l,f.m03=0,f.m04=-u*s,f.m05=1-u*c,f.m06=-u*l,f.m07=0,f.m08=-h*s,f.m09=-h*c,f.m10=1-h*l,f.m11=0,f.m12=s*a,f.m13=c*a,f.m14=l*a,f.m15=1,Ei.toArray(n,f,hp.MAT_LIGHT_PLANE_PROJ_OFFSET)}(a,o,r),function(e,t){_i.normalize(rv,e.normal),t[hp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+0]=rv.x,t[hp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+1]=rv.y,t[hp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+2]=rv.z,t[hp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+3]=e.distance}(a,r));ri.toArray(r,a.shadowColor,hp.SHADOW_COLOR_OFFSET)}}static updateShadowUBOLightView(e,t,n){const i=e.device,o=e.pipelineSceneData.shadows,a=t,r=ad(i)?0:1;let s=.1,c=0;const l=o.matShadowView,_=o.matShadowProj,u=o.matShadowViewProj;switch(n.type){case OA.DIRECTIONAL:o.fixedArea?(s=o.near,c=o.far):(s=.1,c=o.shadowCameraFar),Ei.toArray(t,l,hp.MAT_LIGHT_VIEW_OFFSET),a[hp.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=_.m10,a[hp.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=_.m14,a[hp.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=_.m11,a[hp.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=_.m15,a[hp.SHADOW_PROJ_INFO_OFFSET+0]=_.m00,a[hp.SHADOW_PROJ_INFO_OFFSET+1]=_.m05,a[hp.SHADOW_PROJ_INFO_OFFSET+2]=1/_.m00,a[hp.SHADOW_PROJ_INFO_OFFSET+3]=1/_.m05,Ei.toArray(t,u,hp.MAT_LIGHT_VIEW_PROJ_OFFSET),Vv.set(s,c,0,1-o.saturation),Oi.toArray(a,Vv,hp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET),Vv.set(0,r,o.normalBias,0),Oi.toArray(a,Vv,hp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET);break;case OA.SPOT:Ei.invert(Uv,n.node.getWorldMatrix()),Ei.toArray(a,Uv,hp.MAT_LIGHT_VIEW_OFFSET),Ei.perspective(Gv,n.angle,n.aspect,.001,n.range),Ei.multiply(jv,Gv,Uv),Ei.toArray(a,jv,hp.MAT_LIGHT_VIEW_PROJ_OFFSET),Vv.set(.01,n.range,0,1-o.saturation),Oi.toArray(a,Vv,hp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET),Vv.set(1,r,o.normalBias,0),Oi.toArray(a,Vv,hp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET)}Vv.set(o.size.x,o.size.y,o.pcf,o.bias),Oi.toArray(a,Vv,hp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET),ri.toArray(a,o.shadowColor,hp.SHADOW_COLOR_OFFSET)}static getCombineSignY(){return Wv._combineSignY}_initCombineSignY(){const e=this._device;Wv._combineSignY=.5*e.capabilities.screenSpaceSignY+.5<<1|.5*e.capabilities.clipSpaceSignY+.5}activate(e,t){this._device=e,this._pipeline=t;const n=this._pipeline.descriptorSet;this._initCombineSignY();const i=e.createBuffer(new ka(Ho.UNIFORM|Ho.TRANSFER_DST,Yo.HOST|Yo.DEVICE,_p.SIZE,_p.SIZE));n.bindBuffer(_p.BINDING,i);const o=e.createBuffer(new ka(Ho.UNIFORM|Ho.TRANSFER_DST,Yo.HOST|Yo.DEVICE,up.SIZE,up.SIZE));n.bindBuffer(up.BINDING,o);const a=e.createBuffer(new ka(Ho.UNIFORM|Ho.TRANSFER_DST,Yo.HOST|Yo.DEVICE,hp.SIZE,hp.SIZE));n.bindBuffer(hp.BINDING,a)}updateGlobalUBO(e){const t=this._pipeline.globalDSManager,n=this._pipeline.descriptorSet,i=this._pipeline.commandBuffers;n.update(),Wv.updateGlobalUBOView(e,this._globalUBO),i[0].updateBuffer(n.getBuffer(_p.BINDING),this._globalUBO),t.bindBuffer(_p.BINDING,n.getBuffer(_p.BINDING)),t.update()}updateCameraUBO(e){const t=this._pipeline.globalDSManager,n=this._pipeline.descriptorSet,i=this._pipeline.commandBuffers;Wv.updateCameraUBOView(this._pipeline,this._cameraUBO,e),i[0].updateBuffer(n.getBuffer(up.BINDING),this._cameraUBO),t.bindBuffer(up.BINDING,n.getBuffer(up.BINDING)),t.update()}updateShadowUBO(e){const t=this._pipeline.pipelineSceneData;if(!t.shadows.enabled)return;const n=this._pipeline.descriptorSet,i=this._pipeline.commandBuffers,o=t.shadowFrameBufferMap,a=e.scene.mainLight;a&&o.has(a)&&n.bindTexture(fp,o.get(a).colorTextures[0]),Wv.updateShadowUBOView(this._pipeline,this._shadowUBO,e),n.update(),i[0].updateBuffer(n.getBuffer(hp.BINDING),this._shadowUBO)}updateShadowUBOLight(e,t){Wv.updateShadowUBOLightView(this._pipeline,this._shadowUBO,t),e.bindTexture(fp,Bm.get("default-texture").getGFXTexture()),e.bindTexture(bp,Bm.get("default-texture").getGFXTexture()),e.update(),e.getBuffer(hp.BINDING).update(this._shadowUBO)}updateShadowUBORange(e,t){t instanceof Ei?Ei.toArray(this._shadowUBO,t,e):t instanceof ri&&ri.toArray(this._shadowUBO,t,e)}destroy(){}}var qv,Yv,Xv,Qv,Zv,Jv,Kv,$v,eg;Wv._combineSignY=0;let tg=(qv=Uc("RenderStage"),Yv=hl(),Xv=hl(),Qv=hl(),qv((Kv=Pc((Jv=class{constructor(){Tc(this,"_name",Kv,this),Tc(this,"_priority",$v,this),this._enabled=!0,Tc(this,"_tag",eg,this)}get name(){return this._name}get priority(){return this._priority}get tag(){return this._tag}set enabled(e){this._enabled=e}get enabled(){return this._enabled}initialize(e){return this._name=e.name,this._priority=e.priority,e.tag&&(this._tag=e.tag),!0}activate(e,t){this._pipeline=e,this._flow=t}}).prototype,"_name",[Yv,qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$v=Pc(Jv.prototype,"_priority",[Xv,qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eg=Pc(Jv.prototype,"_tag",[Qv,qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Zv=Jv))||Zv);var ng,ig,og,ag,rg,sg,cg,lg,_g,ug,hg,fg;c.RenderStage=tg;let pg,dg=(ng=Uc("RenderFlow"),ig=hl(),og=hl(),ag=hl(),rg=hl(),sg=vl([tg]),ng((_g=Pc((lg=class{constructor(){Tc(this,"_name",_g,this),Tc(this,"_priority",ug,this),Tc(this,"_tag",hg,this),Tc(this,"_stages",fg,this)}get name(){return this._name}get priority(){return this._priority}get tag(){return this._tag}get stages(){return this._stages}get pipeline(){return this._pipeline}initialize(e){return this._name=e.name,this._priority=e.priority,this._stages=e.stages,e.tag&&(this._tag=e.tag),!0}activate(e){this._pipeline=e,this._stages.sort(((e,t)=>e.priority-t.priority));for(let t=0,n=this._stages.length;t<n;t++)this._stages[t].activate(e,this)}render(e){for(let t=0,n=this._stages.length;t<n;t++)this._stages[t].enabled&&this._stages[t].render(e)}destroy(){for(let e=0,t=this._stages.length;e<t;e++)this._stages[e].destroy();this._stages.length=0}}).prototype,"_name",[ig,qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ug=Pc(lg.prototype,"_priority",[og,qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hg=Pc(lg.prototype,"_tag",[ag,qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fg=Pc(lg.prototype,"_stages",[rg,sg,qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cg=lg))||cg);c.RenderFlow=dg,function(e){e.RENDER_FRAME_BEGIN="render-frame-begin",e.RENDER_FRAME_END="render-frame-end",e.RENDER_CAMERA_BEGIN="render-camera-begin",e.RENDER_CAMERA_END="render-camera-end",e.ATTACHMENT_SCALE_CAHNGED="attachment-scale-changed"}(pg||(pg=e("eS",{})));class mg extends Yt{constructor(...e){super(...e),this.eventTargetOn=super.on,this.eventTargetOnce=super.once}on(e,t,n,i){return this.eventTargetOn(e,t,n,i)}once(e,t,n){return this.eventTargetOnce(e,t,n)}}var Ag,vg,gg,xg,yg,bg,Sg,Cg;e("ga",mg);const Eg=new Pa,Tg=new Ma;class Pg{constructor(){this.renderPass=null,this.sampler=null,this.prefiterTex=null,this.downsampleTexs=[],this.upsampleTexs=[],this.combineTex=null,this.prefilterFramebuffer=null,this.downsampleFramebuffers=[],this.upsampleFramebuffers=[],this.combineFramebuffer=null}}class wg{constructor(){this.quadIB=null,this.quadVB=null,this.quadIA=null}}let Ig=(Ag=Uc("cc.RenderPipeline"),vg=hl(),gg=hl(),xg=vl([dg]),Ag((Sg=Pc((bg=class extends __{constructor(...e){super(...e),Tc(this,"_tag",Sg,this),Tc(this,"_flows",Cg,this),this._quadIB=null,this._quadVBOnscreen=null,this._quadVBOffscreen=null,this._quadIAOnscreen=null,this._quadIAOffscreen=null,this._eventProcessor=new mg,this._commandBuffers=[],this._pipelineUBO=new Wv,this._macros={},this._constantMacros="",this._profiler=null,this._pipelineRenderData=null,this._renderPasses=new Map,this._width=0,this._height=0,this._lastUsedRenderArea=new Pa,this._clusterEnabled=!1,this._bloomEnabled=!1}get tag(){return this._tag}get flows(){return this._flows}get quadIAOnscreen(){return this._quadIAOnscreen}get quadIAOffscreen(){return this._quadIAOffscreen}getPipelineRenderData(){return this._pipelineRenderData}get constantMacros(){return this._constantMacros}get macros(){return this._macros}get device(){return this._device}get globalDSManager(){return this._globalDSManager}get descriptorSetLayout(){return this._globalDSManager.descriptorSetLayout}get descriptorSet(){return this._descriptorSet}get commandBuffers(){return this._commandBuffers}get pipelineUBO(){return this._pipelineUBO}get pipelineSceneData(){return this._pipelineSceneData}set profiler(e){this._profiler=e}get profiler(){return this._profiler}set clusterEnabled(e){this._clusterEnabled=e}get clusterEnabled(){return this._clusterEnabled}set bloomEnabled(e){this._bloomEnabled=e}get bloomEnabled(){return this._bloomEnabled}initialize(e){return this._flows=e.flows,e.tag&&(this._tag=e.tag),!0}createRenderPass(e,t,n){const i=this._device,o=new rr,a=new sr;o.format=t,a.format=n,a.stencilStoreOp=ca.DISCARD,a.depthStoreOp=ca.DISCARD,e&ba.COLOR||(e&Ad?o.loadOp=sa.DISCARD:(o.loadOp=sa.LOAD,o.beginAccesses=[la.COLOR_ATTACHMENT_WRITE])),(e&ba.DEPTH_STENCIL)!==ba.DEPTH_STENCIL&&(e&ba.DEPTH||(a.depthLoadOp=sa.LOAD),e&ba.STENCIL||(a.stencilLoadOp=sa.LOAD)),a.beginAccesses=[la.DEPTH_STENCIL_ATTACHMENT_WRITE];const r=new _r([o],a);return i.createRenderPass(r)}getRenderPass(e,t){let n=this._renderPasses.get(e);return n||(n=this.createRenderPass(e,t.colorTextures[0].format,t.depthStencilTexture.format),this._renderPasses.set(e,n),n)}applyFramebufferRatio(e){const t=this.pipelineSceneData,n=this._width*t.shadingScale,i=this._height*t.shadingScale,o=e.colorTextures;for(let e=0;e<o.length;e++)o[e].resize(n,i);e.depthStencilTexture&&e.depthStencilTexture.resize(n,i),e.destroy(),e.initialize(new fr(e.renderPass,o,e.depthStencilTexture))}generateRenderArea(e,t){const n=e.viewport,i=e.window.width,o=e.window.height;t.x=n.x*i,t.y=n.y*o,t.width=n.width*i,t.height=n.height*o}generateViewport(e,t){this.generateRenderArea(e,Eg),t||(t=Tg);const n=this.pipelineSceneData.shadingScale;return t.left=Eg.x*n,t.top=Eg.y*n,t.width=Eg.width*n,t.height=Eg.height*n,t}generateScissor(e,t){t||(t=Eg),this.generateRenderArea(e,t);const n=this.pipelineSceneData.shadingScale;return t.x*=n,t.y*=n,t.width*=n,t.height*=n,t}activate(e){const t=c.director.root;this._device=t.device,this._generateConstantMacros(),this._globalDSManager=new kv(this),this._descriptorSet=this._globalDSManager.globalDescriptorSet,this._pipelineUBO.activate(this._device,this),this._macros.CC_USE_HDR=this._pipelineSceneData.isHDR,this._generateConstantMacros(),this._pipelineSceneData.activate(this._device,this);for(let e=0;e<this._flows.length;e++)this._flows[e].activate(this);return!0}_ensureEnoughSize(e){}render(e){if(0!==e.length){this._commandBuffers[0].begin(),this.emit(pg.RENDER_FRAME_BEGIN,e),this._ensureEnoughSize(e),function(e){for(let t=e.length-1;t>=0;--t)if(e[t].window.swapchain)return}(e);for(let t=0;t<e.length;t++){const n=e[t];if(n.scene){this.emit(pg.RENDER_CAMERA_BEGIN,n),zv(this,n),Lv(this,n),this._pipelineUBO.updateGlobalUBO(n.window),this._pipelineUBO.updateCameraUBO(n);for(let e=0;e<this._flows.length;e++)this._flows[e].render(n);this.emit(pg.RENDER_CAMERA_END,n)}}this.emit(pg.RENDER_FRAME_END,e),this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)}}_destroyQuadInputAssembler(){this._quadIB&&(this._quadIB.destroy(),this._quadIB=null),this._quadVBOnscreen&&(this._quadVBOnscreen.destroy(),this._quadVBOnscreen=null),this._quadVBOffscreen&&(this._quadVBOffscreen.destroy(),this._quadVBOffscreen=null),this._quadIAOnscreen&&(this._quadIAOnscreen.destroy(),this._quadIAOnscreen=null),this._quadIAOffscreen&&(this._quadIAOffscreen.destroy(),this._quadIAOffscreen=null)}_destroyBloomData(){var e;const t=this._pipelineRenderData.bloom;if(null!==t){t.prefiterTex&&t.prefiterTex.destroy(),t.prefilterFramebuffer&&t.prefilterFramebuffer.destroy();for(let e=0;e<t.downsampleTexs.length;++e)t.downsampleTexs[e].destroy(),t.downsampleFramebuffers[e].destroy();t.downsampleTexs.length=0,t.downsampleFramebuffers.length=0;for(let e=0;e<t.upsampleTexs.length;++e)t.upsampleTexs[e].destroy(),t.upsampleFramebuffers[e].destroy();t.upsampleTexs.length=0,t.upsampleFramebuffers.length=0,t.combineTex&&t.combineTex.destroy(),t.combineFramebuffer&&t.combineFramebuffer.destroy(),null===(e=t.renderPass)||void 0===e||e.destroy(),this._pipelineRenderData.bloom=null}}_genQuadVertexData(e,t){const n=new Float32Array(16),i=t.x/this._width,o=(t.x+t.width)/this._width;let a=t.y/this._height,r=(t.y+t.height)/this._height;if(this.device.capabilities.screenSpaceSignY>0){const e=r;r=a,a=e}let s=0;switch(e){case ko.IDENTITY:s=0,n[s++]=-1,n[s++]=-1,n[s++]=i,n[s++]=r,n[s++]=1,n[s++]=-1,n[s++]=o,n[s++]=r,n[s++]=-1,n[s++]=1,n[s++]=i,n[s++]=a,n[s++]=1,n[s++]=1,n[s++]=o,n[s++]=a;break;case ko.ROTATE_90:s=0,n[s++]=-1,n[s++]=-1,n[s++]=o,n[s++]=r,n[s++]=1,n[s++]=-1,n[s++]=o,n[s++]=a,n[s++]=-1,n[s++]=1,n[s++]=i,n[s++]=r,n[s++]=1,n[s++]=1,n[s++]=i,n[s++]=a;break;case ko.ROTATE_180:s=0,n[s++]=-1,n[s++]=-1,n[s++]=i,n[s++]=a,n[s++]=1,n[s++]=-1,n[s++]=o,n[s++]=a,n[s++]=-1,n[s++]=1,n[s++]=i,n[s++]=r,n[s++]=1,n[s++]=1,n[s++]=o,n[s++]=r;break;case ko.ROTATE_270:s=0,n[s++]=-1,n[s++]=-1,n[s++]=i,n[s++]=a,n[s++]=1,n[s++]=-1,n[s++]=i,n[s++]=r,n[s++]=-1,n[s++]=1,n[s++]=o,n[s++]=a,n[s++]=1,n[s++]=1,n[s++]=o,n[s++]=r}return n}_createQuadInputAssembler(){const e=new wg,t=4*Float32Array.BYTES_PER_ELEMENT,n=4*t,i=this._device.createBuffer(new ka(Ho.VERTEX|Ho.TRANSFER_DST,Yo.DEVICE|Yo.HOST,n,t));if(!i)return e;const o=Uint8Array.BYTES_PER_ELEMENT,a=6*o,r=this._device.createBuffer(new ka(Ho.INDEX|Ho.TRANSFER_DST,Yo.DEVICE,a,o));if(!r)return e;const s=new Uint8Array(6);s[0]=0,s[1]=1,s[2]=2,s[3]=1,s[4]=3,s[5]=2,r.update(s);const c=new Array(2);c[0]=new ir("a_position",Go.RG32F),c[1]=new ir("a_texCoord",Go.RG32F);const l=this._device.createInputAssembler(new ar(c,[i],r));return e.quadIB=r,e.quadVB=i,e.quadIA=l,e}updateQuadVertexData(e,t){const n=this._lastUsedRenderArea;if(n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height)return;const i=this._genQuadVertexData(ko.IDENTITY,e);this._quadVBOffscreen.update(i);const o=this._genQuadVertexData(t.swapchain&&t.swapchain.surfaceTransform||ko.IDENTITY,e);this._quadVBOnscreen.update(o),n.copy(e)}destroy(){var e,t;for(let e=0;e<this._flows.length;e++)this._flows[e].destroy();this._flows.length=0,this._descriptorSet&&this._descriptorSet.destroy(),null===(e=this._globalDSManager)||void 0===e||e.destroy();for(let e=0;e<this._commandBuffers.length;e++)this._commandBuffers[e].destroy();return this._commandBuffers.length=0,this._pipelineUBO.destroy(),null===(t=this._pipelineSceneData)||void 0===t||t.destroy(),super.destroy()}_generateConstantMacros(){let e="";e+=`#define CC_DEVICE_SUPPORT_FLOAT_TEXTURE ${this.device.hasFeature(Uo.TEXTURE_FLOAT)?1:0}\n`,e+=`#define CC_ENABLE_CLUSTERED_LIGHT_CULLING ${this._clusterEnabled?1:0}\n`,e+=`#define CC_DEVICE_MAX_VERTEX_UNIFORM_VECTORS ${this.device.capabilities.maxVertexUniformVectors}\n`,e+=`#define CC_DEVICE_MAX_FRAGMENT_UNIFORM_VECTORS ${this.device.capabilities.maxFragmentUniformVectors}\n`,e+=`#define CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT ${this.device.hasFeature(Uo.INPUT_ATTACHMENT_BENEFIT)?1:0}\n`,e+=`#define CC_PLATFORM_ANDROID_AND_WEBGL ${nn.os===Jt.ANDROID&&nn.isBrowser?1:0}\n`,e+=`#define CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES ${He.ENABLE_WEBGL_HIGHP_STRUCT_VALUES?1:0}\n`,this._constantMacros=e}generateBloomRenderData(){if(null!=this._pipelineRenderData.bloom)return;const e=this._pipelineRenderData.bloom=new Pg,t=this.device,n=new rr;n.format=Go.RGBA8,n.loadOp=sa.CLEAR,n.storeOp=ca.STORE,n.endAccesses=[la.COLOR_ATTACHMENT_WRITE],e.renderPass=t.createRenderPass(new _r([n]));let i=this._width,o=this._height;e.prefiterTex=t.createTexture(new Ha(Xo.TEX2D,Qo.COLOR_ATTACHMENT|Qo.SAMPLED,Go.RGBA8,i>>1,o>>1)),e.prefilterFramebuffer=t.createFramebuffer(new fr(e.renderPass,[e.prefiterTex])),i>>=1,o>>=1;for(let n=0;n<6;++n)e.downsampleTexs.push(t.createTexture(new Ha(Xo.TEX2D,Qo.COLOR_ATTACHMENT|Qo.SAMPLED,Go.RGBA8,i>>1,o>>1))),e.downsampleFramebuffers[n]=t.createFramebuffer(new fr(e.renderPass,[e.downsampleTexs[n]])),e.upsampleTexs.push(t.createTexture(new Ha(Xo.TEX2D,Qo.COLOR_ATTACHMENT|Qo.SAMPLED,Go.RGBA8,i,o))),e.upsampleFramebuffers[n]=t.createFramebuffer(new fr(e.renderPass,[e.upsampleTexs[n]])),i>>=1,o>>=1;e.combineTex=t.createTexture(new Ha(Xo.TEX2D,Qo.COLOR_ATTACHMENT|Qo.SAMPLED,Go.RGBA8,this._width,this._height)),e.combineFramebuffer=t.createFramebuffer(new fr(e.renderPass,[e.combineTex])),e.sampler=this.globalDSManager.linearSampler}on(e,t,n,i){return this._eventProcessor.on(e,t,n,i)}once(e,t,n){return this._eventProcessor.once(e,t,n)}off(e,t,n){this._eventProcessor.off(e,t,n)}emit(e,t,n,i,o,a){this._eventProcessor.emit(e,t,n,i,o,a)}targetOff(e){this._eventProcessor.targetOff(e)}removeAll(e){this._eventProcessor.removeAll(e)}hasEventListener(e,t,n){return this._eventProcessor.hasEventListener(e,t,n)}}).prototype,"_tag",[vg,qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Cg=Pc(bg.prototype,"_flows",[gg,xg,qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yg=bg))||yg);function Rg(e,t){for(const n of t)Array.isArray(n)?Rg(e,n):e.push(n)}function Dg(e){const t=[];return Rg(t,e),t.join("")}c.RenderPipeline=Ig;const Ng=Lt.Flags.Destroyed,Og=Lt.Flags.PersistentMask,Mg=Rt.IDENTIFIER_RE,zg="var ",Lg="o",Fg={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},Bg=Rt.escapeForJS;class kg{constructor(e,t){this.varName=void 0,this.expression=void 0,this.varName=e,this.expression=t}toString(){return`${zg+this.varName}=${this.expression};`}}function Ug(e,t){return t instanceof kg?new kg(t.varName,e+t.expression):e+t}function Gg(e,t,n){Array.isArray(n)?(n[0]=Ug(t,n[0]),e.push(n)):e.push(`${Ug(t,n)};`)}class jg{constructor(e){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=e}append(e,t){this._exps.push([e,t])}writeCode(e){let t;if(this._exps.length>1)e.push(`t=${this._targetExp};`),t="t";else{if(1!==this._exps.length)return;t=this._targetExp}for(let n=0;n<this._exps.length;n++){const i=this._exps[n];Gg(e,`${t+Vg(i[0])}=`,i[1])}}}function Vg(e){return Mg.test(e)?`.${e}`:`[${Bg(e)}]`}jg.pool=void 0,jg.pool=new Re((e=>{e._exps.length=0,e._targetExp=null}),1),jg.pool.get=function(e){const t=this._get()||new jg;return t._targetExp=e,t};class Hg{constructor(e,t){let n;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=t,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=ne(),fe(this.funcModuleCache,Fg),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{",`o=R=new ${this.getFuncModule(e.constructor,!0)}();`,"}"),e._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(e),this.enumerateObject(this.codeArray,e),this.globalVariables.length>0&&(n=`${zg+this.globalVariables.join(",")};`);const i=Dg(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",i)(this.objs,this.funcs);for(let e=0,t=this.objsToClear_iN$t.length;e<t;++e)this.objsToClear_iN$t[e]._iN$t=null;this.objsToClear_iN$t.length=0}getFuncModule(e,t){const n=ie(e);if(n){const t=this.funcModuleCache[n];if(t)return t;if(void 0===t){let t=-1!==n.indexOf(".");if(t)try{if(t=e===Function(`return ${n}`)(),t)return this.funcModuleCache[n]=n,n}catch(e){}}}let i=this.funcs.indexOf(e);i<0&&(i=this.funcs.length,this.funcs.push(e));let o=`F[${i}]`;return t&&(o=`(${o})`),this.funcModuleCache[n]=o,o}getObjRef(e){let t=this.objs.indexOf(e);return t<0&&(t=this.objs.length,this.objs.push(e)),`O[${t}]`}setValueType(e,t,n,i){const o=jg.pool.get(i);let a=t.constructor.__props__;a||(a=Object.keys(t));for(let e=0;e<a.length;e++){const i=a[e],r=n[i];if(t[i]===r)continue;const s=this.enumerateField(n,i,r);o.append(i,s)}o.writeCode(e),jg.pool.put(o)}enumerateCCClass(e,t,n){const i=n.__values__,o=st(n);for(let n=0;n<i.length;n++){const a=i[n],r=t[a];let s=o[a+"$_$default"];if(!Wg(s,r))if("object"==typeof r&&r instanceof c.ValueType&&(s=Rt.getDefault(s),s&&s.constructor===r.constructor)){const t=Lg+Vg(a);this.setValueType(e,s,r,t)}else this.setObjProp(e,t,a,r)}}instantiateArray(e){if(0===e.length)return"[]";const t="a"+ ++this.localVariableId,n=[new kg(t,`new Array(${e.length})`)];e._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(e);for(let i=0;i<e.length;++i)Gg(n,`${t}[${i}]=`,this.enumerateField(e,i,e[i]));return n}instantiateTypedArray(e){const t=e.constructor.name;if(0===e.length)return`new ${t}`;const n="a"+ ++this.localVariableId,i=[new kg(n,`new ${t}(${e.length})`)];e._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(e);for(let t=0;t<e.length;++t)0!==e[t]&&Gg(i,`${n}[${t}]=`,e[t]);return i}enumerateField(e,t,n){if("object"==typeof n&&n){const e=n._iN$t;if(e){let t=e.globalVar;if(!t){t=e.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(t);const n=e.source[0];e.source[0]=Ug(`${t}=`,n)}return t}return ArrayBuffer.isView(n)?this.instantiateTypedArray(n):Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?Bg(n):("_objFlags"===t&&e instanceof Lt&&(n&=Og),n)}setObjProp(e,t,n,i){Gg(e,`${Lg+Vg(n)}=`,this.enumerateField(t,n,i))}enumerateObject(e,t){const n=t.constructor;if(c.Class._isCCClass(n))this.enumerateCCClass(e,t,n);else for(const n in t){if(!t.hasOwnProperty(n)||95===n.charCodeAt(0)&&95===n.charCodeAt(1)&&"__type__"!==n)continue;const i=t[n];"object"==typeof i&&i&&i===t._iN$t||this.setObjProp(e,t,n,i)}}instantiateObj(e){if(e instanceof c.ValueType)return Rt.getNewValueTypeCode(e);if(e instanceof c.Asset)return this.getObjRef(e);if(e._objFlags&Ng)return null;let t;const n=e.constructor;if(c.Class._isCCClass(n)){if(this.parent)if(this.parent instanceof c.Component){if(e instanceof c._BaseNode||e instanceof c.Component)return this.getObjRef(e)}else if(this.parent instanceof c._BaseNode)if(e instanceof c._BaseNode){if(!e.isChildOf(this.parent))return this.getObjRef(e)}else if(e instanceof c.Component){var i;if(!(null===(i=e.node)||void 0===i?void 0:i.isChildOf(this.parent)))return this.getObjRef(e)}t=new kg(Lg,`new ${this.getFuncModule(n,!0)}()`)}else if(n===Object)t=new kg(Lg,"{}");else{if(n)return this.getObjRef(e);t=new kg(Lg,"Object.create(null)")}const o=[t];return e._iN$t={globalVar:"",source:o},this.objsToClear_iN$t.push(e),this.enumerateObject(o,e),["(function(){",o,"return o;})();"]}}function Wg(e,t){if("function"==typeof e)try{e=e()}catch(e){return!1}if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t&&e.constructor===t.constructor)if(e instanceof c.ValueType){if(e.equals(t))return!0}else{if(Array.isArray(e))return 0===e.length&&0===t.length;if(e.constructor===Object)return J(e)&&J(t)}return!1}class qg{get uiTransformComp(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp}set uiTransformComp(e){this._uiTransformComp=e}get uiComp(){return this._uiComp}set uiComp(e){this._uiComp&&e?w(12002):this._uiComp=e}get opacity(){return this._opacity}get localOpacity(){return this._localOpacity}set localOpacity(e){this._localOpacity=e,this.colorDirty=!0}constructor(e){this._uiComp=null,this._opacity=1,this._localOpacity=1,this.colorDirty=!0,this._uiTransformComp=null,this._node=void 0,this._node=e}applyOpacity(e){this._opacity=this._localOpacity*e}static markOpacityTree(e,t=!0){}}let Yg;var Xg,Qg,Zg,Jg,Kg,$g,ex,tx,nx;Lt.Flags.Destroying,function(e){e.TOUCH_START="touch-start",e.TOUCH_MOVE="touch-move",e.TOUCH_END="touch-end",e.TOUCH_CANCEL="touch-cancel",e.MOUSE_DOWN="mouse-down",e.MOUSE_MOVE="mouse-move",e.MOUSE_UP="mouse-up",e.MOUSE_WHEEL="mouse-wheel",e.MOUSE_ENTER="mouse-enter",e.MOUSE_LEAVE="mouse-leave",e.KEY_DOWN="keydown",e.KEY_UP="keyup",e.DEVICEMOTION="devicemotion",e.TRANSFORM_CHANGED="transform-changed",e.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",e.SIZE_CHANGED="size-changed",e.ANCHOR_CHANGED="anchor-changed",e.COLOR_CHANGED="color-changed",e.CHILD_ADDED="child-added",e.CHILD_REMOVED="child-removed",e.PARENT_CHANGED="parent-changed",e.NODE_DESTROYED="node-destroyed",e.LAYER_CHANGED="layer-changed",e.SIBLING_ORDER_CHANGED="sibling-order-changed",e.ACTIVE_IN_HIERARCHY_CHANGED="active-in-hierarchy-changed"}(Yg||(Yg=e("d0",{})));const ix=Lt.Flags.Destroying,ox=Lt.Flags.DontDestroy,ax=Lt.Flags.Deactivating,rx=new W("Node");function sx(e){return e?"string"==typeof e?we(e):e:(R(3804),null)}let cx=e("gh",Uc("cc.BaseNode")((nx=tx=class e extends Lt{get components(){return this._components}get _persistNode(){return(this._objFlags&ox)>0}set _persistNode(e){e?this._objFlags|=ox:this._objFlags&=~ox}get name(){return this._name}set name(e){this._name=e}get uuid(){return this._id}get children(){return this._children}get active(){return this._active}set active(e){if(this._active!==e){this._active=e;const t=this._parent;t&&t._activeInHierarchy&&c.director._nodeActivator.activateNode(this,e)}}get activeInHierarchy(){return this._activeInHierarchy}get parent(){return this._parent}set parent(e){this.setParent(e)}get scene(){return this._scene}get eventProcessor(){return this._eventProcessor}static _setScene(e){e._updateScene()}static _findComponent(e,t){const n=t,i=e._components;if(n._sealed)for(let e=0;e<i.length;++e){const n=i[e];if(n.constructor===t)return n}else for(let e=0;e<i.length;++e){const n=i[e];if(n instanceof t)return n}return null}static _findComponents(e,t,n){const i=t,o=e._components;if(i._sealed)for(let e=0;e<o.length;++e){const i=o[e];i.constructor===t&&n.push(i)}else for(let e=0;e<o.length;++e){const i=o[e];i instanceof t&&n.push(i)}}static _findChildComponent(t,n){for(let i=0;i<t.length;++i){const o=t[i];let a=e._findComponent(o,n);if(a)return a;if(o._children.length>0&&(a=e._findChildComponent(o._children,n),a))return a}return null}static _findChildComponents(t,n,i){for(let o=0;o<t.length;++o){const a=t[o];e._findComponents(a,n,i),a._children.length>0&&e._findChildComponents(a._children,n,i)}}_updateScene(){null==this._parent?g("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene}constructor(e){super(e),Tc(this,"_parent",Zg,this),Tc(this,"_children",Jg,this),Tc(this,"_active",Kg,this),Tc(this,"_components",$g,this),Tc(this,"_prefab",ex,this),this._scene=null,this._activeInHierarchy=!1,this._id=rx.getNewId(),this._name=void 0,this._eventProcessor=new c.NodeEventProcessor(this),this._eventMask=0,this._siblingIndex=0,this._originalSceneId="",this._registerIfAttached=void 0,this._name=void 0!==e?e:"New Node"}attr(e){fe(this,e)}getParent(){return this._parent}setParent(e,t=!1){if(this._parent===e)return;const n=this._parent,i=e;if(this._parent=i,this._siblingIndex=0,this._onSetParent(n,t),this.emit&&this.emit(Yg.PARENT_CHANGED,n),n&&!(n._objFlags&ix)){const e=n._children.indexOf(this);n._children.splice(e,1),n._updateSiblingIndex(),n.emit&&n.emit(Yg.CHILD_REMOVED,this)}i&&(i._children.push(this),this._siblingIndex=i._children.length-1,i.emit&&i.emit(Yg.CHILD_ADDED,this)),this._onHierarchyChanged(n)}getChildByUuid(e){if(!e)return A("Invalid uuid"),null;const t=this._children;for(let n=0,i=t.length;n<i;n++)if(t[n]._id===e)return t[n];return null}getChildByName(e){if(!e)return A("Invalid name"),null;const t=this._children;for(let n=0,i=t.length;n<i;n++)if(t[n]._name===e)return t[n];return null}getChildByPath(e){const t=e.split("/");let n=this;for(let e=0;e<t.length;++e){const i=t[e];if(0===i.length)continue;const o=n.children.find((e=>e.name===i));if(!o)return null;n=o}return n}addChild(e){e.setParent(this)}insertChild(e,t){e.parent=this,e.setSiblingIndex(t)}getSiblingIndex(){return this._siblingIndex}setSiblingIndex(e){if(!this._parent)return;if(this._parent._objFlags&ax)return void R(3821);const t=this._parent._children;e=-1!==e?e:t.length-1;const n=t.indexOf(this);e!==n&&(t.splice(n,1),e<t.length?t.splice(e,0,this):t.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(e))}walk(t,n){let i=1,o=null,a=null,r=0,s=e._stacks[e._stackId];s||(s=[],e._stacks.push(s)),e._stackId++,s.length=0,s[0]=this;let c=null,l=!1;for(;i;)if(i--,a=s[i],a)if(!l&&t?t(a):l&&n&&n(a),s[i]=null,l){if(c===this._parent)break;if(l=!1,o)if(r++,o[r])s[i]=o[r],i++;else if(c&&(s[i]=c,i++,l=!0,c._parent?(o=c._parent._children,r=o.indexOf(c),c=c._parent):(c=null,o=null),r<0))break}else a._children.length>0?(c=a,o=a._children,r=0,s[i]=o[r],i++):(s[i]=a,i++,l=!0);s.length=0,e._stackId--}removeFromParent(){this._parent&&this._parent.removeChild(this)}removeChild(e){this._children.indexOf(e)>-1&&(e.parent=null)}removeAllChildren(){const e=this._children;for(let t=e.length-1;t>=0;t--){const n=e[t];n&&(n.parent=null)}this._children.length=0}isChildOf(e){let t=this;do{if(t===e)return!0;t=t._parent}while(t);return!1}getComponent(t){const n=sx(t);return n?e._findComponent(this,n):null}getComponents(t){const n=sx(t),i=[];return n&&e._findComponents(this,n,i),i}getComponentInChildren(t){const n=sx(t);return n?e._findChildComponent(this._children,n):null}getComponentsInChildren(t){const n=sx(t),i=[];return n&&(e._findComponents(this,n,i),e._findChildComponents(this._children,n,i)),i}addComponent(e){let t;if("string"==typeof e){if(t=we(e),!t)throw c._RF.peek()&&R(3808,e),TypeError(M(3807,e))}else{if(!e)throw TypeError(M(3804));t=e}if("function"!=typeof t)throw TypeError(M(3809));if(!me(t,c.Component))throw TypeError(M(3810));const n=t._requireComponent;if(n)if(Array.isArray(n))for(let e=0;e<n.length;e++){const t=n[e];this.getComponent(t)||this.addComponent(t)}else{const e=n;this.getComponent(e)||this.addComponent(e)}const i=new t;return i.node=this,this._components.push(i),this._activeInHierarchy&&c.director._nodeActivator.activateComp(i),i}removeComponent(e){if(!e)return void R(3813);let t=null;t=e instanceof R_?e:this.getComponent(e),t&&t.destroy()}on(e,t,n,i=!1){switch(e){case Yg.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(e,t,n,i)}off(e,t,n,i=!1){if(this._eventProcessor.off(e,t,n,i),!this._eventProcessor.hasEventListener(e))switch(e){case Yg.TRANSFORM_CHANGED:this._eventMask&=-2}}once(e,t,n,i){this._eventProcessor.once(e,t,n,i)}emit(e,t,n,i,o,a){this._eventProcessor.emit(e,t,n,i,o,a)}dispatchEvent(e){this._eventProcessor.dispatchEvent(e)}hasEventListener(e,t,n){return this._eventProcessor.hasEventListener(e,t,n)}targetOff(e){this._eventProcessor.targetOff(e),1&this._eventMask&&!this._eventProcessor.hasEventListener(Yg.TRANSFORM_CHANGED)&&(this._eventMask&=-2)}destroy(){return!!super.destroy()&&(this.active=!1,!0)}destroyAllChildren(){const e=this._children;for(let t=0;t<e.length;++t)e[t].destroy()}_removeComponent(e){if(e){if(!(this._objFlags&ix)){const t=this._components.indexOf(e);-1!==t?this._components.splice(t,1):e.node!==this&&R(3815)}}else R(3814)}_updateSiblingIndex(){for(let e=0;e<this._children.length;++e)this._children[e]._siblingIndex=e;this.emit(Yg.SIBLING_ORDER_CHANGED)}_onSetParent(t,n=!1){this._parent&&(null!=t&&t._scene===this._parent._scene||null==this._parent._scene||this.walk(e._setScene))}_onPostActivated(e){}_onBatchCreated(e){this._parent&&(this._siblingIndex=this._parent.children.indexOf(this))}_onPreDestroy(){this._onPreDestroyBase()}_onHierarchyChanged(e){return this._onHierarchyChangedBase(e)}_instantiate(e,t){return e||(e=c.instantiate._clone(this,this)),e._prefab,e._parent=null,e._onBatchCreated(t),e}_onHierarchyChangedBase(e){const t=this._parent;!this._persistNode||t instanceof c.Scene||c.game.removePersistRootNode(this);const n=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==n&&c.director._nodeActivator.activateNode(this,n)}_onPreDestroyBase(){this._objFlags|=ix;const e=this._parent,t=!!e&&0!=(e._objFlags&ix);if(!t&&i&&this._registerIfAttached(!1),this._persistNode&&c.game.removePersistRootNode(this),!t&&e){this.emit(Yg.PARENT_CHANGED,this);const t=e._children.indexOf(this);e._children.splice(t,1),this._siblingIndex=0,e._updateSiblingIndex(),e.emit&&e.emit(Yg.CHILD_REMOVED,this)}this.emit(Yg.NODE_DESTROYED,this),this._eventProcessor.destroy();const n=this._children;for(let e=0;e<n.length;++e)n[e]._destroyImmediate();const o=this._components;for(let e=0;e<o.length;++e)o[e]._destroyImmediate();return t}},tx.idGenerator=rx,tx._stacks=[[]],tx._stackId=0,Pc((Qg=nx).prototype,"_persistNode",[Hc],Object.getOwnPropertyDescriptor(Qg.prototype,"_persistNode"),Qg.prototype),Pc(Qg.prototype,"name",[il],Object.getOwnPropertyDescriptor(Qg.prototype,"name"),Qg.prototype),Pc(Qg.prototype,"children",[il],Object.getOwnPropertyDescriptor(Qg.prototype,"children"),Qg.prototype),Pc(Qg.prototype,"active",[il],Object.getOwnPropertyDescriptor(Qg.prototype,"active"),Qg.prototype),Pc(Qg.prototype,"activeInHierarchy",[il],Object.getOwnPropertyDescriptor(Qg.prototype,"activeInHierarchy"),Qg.prototype),Pc(Qg.prototype,"parent",[il],Object.getOwnPropertyDescriptor(Qg.prototype,"parent"),Qg.prototype),Zg=Pc(Qg.prototype,"_parent",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jg=Pc(Qg.prototype,"_children",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kg=Pc(Qg.prototype,"_active",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$g=Pc(Qg.prototype,"_components",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ex=Pc(Qg.prototype,"_prefab",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xg=Qg))||Xg);var lx,_x,ux,hx,fx,px,dx,mx,Ax,vx,gx;c._BaseNode=cx;const xx=new _i,yx=new Ai,bx=new Ai,Sx=new Ai,Cx=new pi,Ex=new pi,Tx=new Ei,Px=[],wx=[],Ix=[];class Rx{constructor(){this._chunks=[],this._freelists=[],this._createChunk()}alloc(){const e=this._freelists.length;for(let t=0;t<e;++t)if(this._freelists[t].length)return this._createView(t);return this._createChunk(),this._createView(e)}free(e,t){const n=this._freelists.length;for(let i=0;i<n;++i)if(this._chunks[i]===e)return void this._freelists[i].push(t)}clear(){const e=this._chunks.length;for(let t=0;t<e;++t)this._chunks[t].fill(0)}_createChunk(){this._chunks.push(new Uint32Array(Rx.CAPACITY_PER_CHUNK));const e=[];for(let t=Rx.CAPACITY_PER_CHUNK-1;t>=0;t--)e.push(t);this._freelists.push(e)}_createView(e){return Ix[0]=this._chunks[e],Ix[1]=this._freelists[e].pop(),Ix}}Rx.CAPACITY_PER_CHUNK=256;const Dx=new Rx,Nx=Symbol("ReserveContentsForAllSyncablePrefab");let Ox=e("cE",(lx=Uc("cc.Node"),_x=vl(_i),lx((gx=vx=class e extends cx{get _dirtyFlags(){return this._dirtyFlagsPri}set _dirtyFlags(e){this._dirtyFlagsPri=e,this._nativeDirtyFlag[0]=e}_init(){const[e,t]=Dx.alloc();this._hasChangedFlagsChunk=e,this._hasChangedFlagsOffset=t;const n=new Uint32Array(e.buffer,e.byteOffset+4*t,1);this._hasChangedFlags=n,this._nodeHandle=ec.alloc(),this._pos=new _i(ec.getTypedArray(this._nodeHandle,Js.WORLD_POSITION)),this._rot=new Ai(ec.getTypedArray(this._nodeHandle,Js.WORLD_ROTATION)),this._scale=new _i(ec.getTypedArray(this._nodeHandle,Js.WORLD_SCALE)),this._lpos=new _i(ec.getTypedArray(this._nodeHandle,Js.LOCAL_POSITION)),this._lrot=new Ai(ec.getTypedArray(this._nodeHandle,Js.LOCAL_ROTATION)),this._lscale=new _i(ec.getTypedArray(this._nodeHandle,Js.LOCAL_SCALE)),this._mat=new Ei(ec.getTypedArray(this._nodeHandle,Js.WORLD_MATRIX)),this._nativeLayer=ec.getTypedArray(this._nodeHandle,Js.LAYER),this._nativeDirtyFlag=ec.getTypedArray(this._nodeHandle,Js.DIRTY_FLAG),this._scale.set(1,1,1),this._lscale.set(1,1,1),this._nativeLayer[0]=this._layer,this._nativeObj=new Gi,this._nativeObj.initWithData(ec.getBuffer(this._nodeHandle),n,wx)}constructor(e){super(e),this._uiProps=new qg(this),this._static=!1,Tc(this,"_lpos",fx,this),Tc(this,"_lrot",px,this),Tc(this,"_lscale",dx,this),Tc(this,"_layer",mx,this),Tc(this,"_euler",Ax,this),this._dirtyFlagsPri=nA.NONE,this._eulerDirty=!1,this._nodeHandle=0,this._init()}static isNode(t){return t instanceof e&&(t.constructor===e||!(t instanceof c.Scene))}_onPreDestroy(){const e=this._onPreDestroyBase();return this._nodeHandle&&(ec.free(this._nodeHandle),this._nodeHandle=0),this._nativeObj=null,Dx.free(this._hasChangedFlagsChunk,this._hasChangedFlagsOffset),e}get native(){return this._nativeObj}get position(){return this._lpos}set position(e){this.setPosition(e)}get worldPosition(){return this.updateWorldTransform(),this._pos}set worldPosition(e){this.setWorldPosition(e)}get rotation(){return this._lrot}set rotation(e){this.setRotation(e)}set eulerAngles(e){this.setRotationFromEuler(e.x,e.y,e.z)}get eulerAngles(){return this._eulerDirty&&(Ai.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler}get angle(){return this._euler.z}set angle(e){_i.set(this._euler,0,0,e),Ai.fromAngleZ(this._lrot,e),this._eulerDirty=!1,this.invalidateChildren(nA.ROTATION),1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,nA.ROTATION)}get worldRotation(){return this.updateWorldTransform(),this._rot}set worldRotation(e){this.setWorldRotation(e)}get scale(){return this._lscale}set scale(e){this.setScale(e)}get worldScale(){return this.updateWorldTransform(),this._scale}set worldScale(e){this.setWorldScale(e)}set matrix(e){Ei.toRTS(e,this._lrot,this._lpos,this._lscale),this.invalidateChildren(nA.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,nA.TRS)}get worldMatrix(){return this.updateWorldTransform(),this._mat}get forward(){return _i.transformQuat(new _i,_i.FORWARD,this.worldRotation)}set forward(e){const t=e.length();_i.multiplyScalar(xx,e,-1/t),Ai.fromViewUp(yx,xx),this.setWorldRotation(yx)}get up(){return _i.transformQuat(new _i,_i.UP,this.worldRotation)}get right(){return _i.transformQuat(new _i,_i.RIGHT,this.worldRotation)}set layer(e){this._layer=e,this._nativeLayer[0]=this._layer,this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.markForUpdateRenderData()),this.emit(Yg.LAYER_CHANGED,this._layer)}get layer(){return this._layer}get hasChangedFlags(){return this._hasChangedFlagsChunk[this._hasChangedFlagsOffset]}set hasChangedFlags(e){this._hasChangedFlagsChunk[this._hasChangedFlagsOffset]=e}[G_](e,t){e.writeThis()}setParent(e,t=!1){t&&this.updateWorldTransform(),super.setParent(e,t),this._nativeObj.setParent(this.parent?this.parent.native:null)}_onSetParent(e,t){if(super._onSetParent(e,t),t){const e=this._parent;e?(e.updateWorldTransform(),Ei.multiply(Tx,Ei.invert(Tx,e._mat),this._mat),Ei.toRTS(Tx,this._lrot,this._lpos,this._lscale)):(_i.copy(this._lpos,this._pos),Ai.copy(this._lrot,this._rot),_i.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(nA.TRS)}_onHierarchyChanged(e){this.eventProcessor.reattach(),super._onHierarchyChangedBase(e)}_onBatchCreated(e){var t;this._nativeLayer[0]=this._layer,this._nativeObj.setParent(null===(t=this.parent)||void 0===t?void 0:t.native),this.hasChangedFlags=nA.TRS,this._dirtyFlags|=nA.TRS;const n=this._children.length;for(let t=0;t<n;++t)this._children[t]._siblingIndex=t,this._children[t]._onBatchCreated(e)}_onBeforeSerialize(){this.eulerAngles}_onPostActivated(e){e?(this._eventProcessor.setEnabled(!0),this.invalidateChildren(nA.TRS),this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.setTextureDirty(),this._uiProps.uiComp.markForUpdateRenderData())):this._eventProcessor.setEnabled(!1)}translate(e,t){const n=t||tA.LOCAL;if(n===tA.LOCAL)_i.transformQuat(xx,e,this._lrot),this._lpos.x+=xx.x,this._lpos.y+=xx.y,this._lpos.z+=xx.z;else if(n===tA.WORLD)if(this._parent){Ai.invert(yx,this._parent.worldRotation),_i.transformQuat(xx,e,yx);const t=this.worldScale;this._lpos.x+=xx.x/t.x,this._lpos.y+=xx.y/t.y,this._lpos.z+=xx.z/t.z}else this._lpos.x+=e.x,this._lpos.y+=e.y,this._lpos.z+=e.z;this.invalidateChildren(nA.POSITION),1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,nA.POSITION)}rotate(e,t){const n=t||tA.LOCAL;if(Ai.normalize(yx,e),n===tA.LOCAL)Ai.multiply(this._lrot,this._lrot,yx);else if(n===tA.WORLD){const e=this.worldRotation;Ai.multiply(bx,yx,e),Ai.invert(yx,e),Ai.multiply(bx,yx,bx),Ai.multiply(this._lrot,this._lrot,bx)}this._eulerDirty=!0,this.invalidateChildren(nA.ROTATION),1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,nA.ROTATION)}lookAt(e,t){this.getWorldPosition(xx),_i.subtract(xx,xx,e),_i.normalize(xx,xx),Ai.fromViewUp(yx,xx,t),this.setWorldRotation(yx)}_setDirtyNode(e,t){Px[e]=t,wx[e]=t.native}invalidateChildren(e){let t,n,i,o=0,a=0,r=0,s=0,c=0;const l=e|nA.POSITION;for(Px[0]=this,wx[0]=this.native;o>=0;){if(t=Px[o--],c=t._hasChangedFlags[0],s=t._dirtyFlagsPri,t.isValid&&(s&c&e)!==e)for(s|=e,t._dirtyFlagsPri=s,t._nativeDirtyFlag[0]=s,t._hasChangedFlags[0]=c|e,i=t._children,r=i.length,a=0;a<r;a++)n=i[a],Px[++o]=n,wx[o]=n.native;e=l}}updateWorldTransform(){if(!this._dirtyFlags)return;let e,t=this,n=0;for(;t&&t._dirtyFlags;)this._setDirtyNode(n++,t),t=t._parent;let i=0;for(;n;)e=Px[--n],i|=e._dirtyFlags,t?(i&nA.POSITION&&(_i.transformMat4(e._pos,e._lpos,t._mat),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z),i&nA.RS&&(Ei.fromRTS(e._mat,e._lrot,e._lpos,e._lscale),Ei.multiply(e._mat,t._mat,e._mat),i&nA.ROTATION&&Ai.multiply(e._rot,t._rot,e._lrot),pi.fromQuat(Cx,Ai.conjugate(Sx,e._rot)),pi.multiplyMat4(Cx,Cx,e._mat),e._scale.x=Cx.m00,e._scale.y=Cx.m04,e._scale.z=Cx.m08)):(i&nA.POSITION&&(_i.copy(e._pos,e._lpos),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z),i&nA.RS&&(i&nA.ROTATION&&Ai.copy(e._rot,e._lrot),i&nA.SCALE&&(_i.copy(e._scale,e._lscale),Ei.fromRTS(e._mat,e._rot,e._pos,e._scale)))),e._dirtyFlags=nA.NONE,t=e}setPosition(e,t,n){void 0===t&&void 0===n?_i.copy(this._lpos,e):void 0===n?_i.set(this._lpos,e,t,this._lpos.z):_i.set(this._lpos,e,t,n),this.invalidateChildren(nA.POSITION),1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,nA.POSITION)}getPosition(e){return e?_i.set(e,this._lpos.x,this._lpos.y,this._lpos.z):_i.copy(new _i,this._lpos)}setRotation(e,t,n,i){void 0===t||void 0===n||void 0===i?Ai.copy(this._lrot,e):Ai.set(this._lrot,e,t,n,i),this._eulerDirty=!0,this.invalidateChildren(nA.ROTATION),1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,nA.ROTATION)}setRotationFromEuler(e,t,n){const i=void 0===n?this._euler.z:n;void 0===t?(_i.copy(this._euler,e),Ai.fromEuler(this._lrot,e.x,e.y,e.z)):(_i.set(this._euler,e,t,i),Ai.fromEuler(this._lrot,e,t,i)),this._eulerDirty=!1,this.invalidateChildren(nA.ROTATION),1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,nA.ROTATION)}getRotation(e){return e?Ai.set(e,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):Ai.copy(new Ai,this._lrot)}setScale(e,t,n){void 0===t&&void 0===n?_i.copy(this._lscale,e):void 0===n?_i.set(this._lscale,e,t,this._lscale.z):_i.set(this._lscale,e,t,n),this.invalidateChildren(nA.SCALE),1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,nA.SCALE)}getScale(e){return e?_i.set(e,this._lscale.x,this._lscale.y,this._lscale.z):_i.copy(new _i,this._lscale)}inverseTransformPoint(e,t){_i.copy(e,t);let n=this,i=0;for(;n._parent;)this._setDirtyNode(i++,n),n=n._parent;for(;i>=0;)_i.transformInverseRTS(e,e,n._lrot,n._lpos,n._lscale),n=Px[--i];return e}setWorldPosition(e,t,n){void 0===t||void 0===n?_i.copy(this._pos,e):_i.set(this._pos,e,t,n);const i=this._parent,o=this._lpos;i?(i.updateWorldTransform(),_i.transformMat4(o,this._pos,Ei.invert(Tx,i._mat))):_i.copy(o,this._pos),this.invalidateChildren(nA.POSITION),1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,nA.POSITION)}getWorldPosition(e){return this.updateWorldTransform(),e?_i.copy(e,this._pos):_i.copy(new _i,this._pos)}setWorldRotation(e,t,n,i){void 0===t||void 0===n||void 0===i?Ai.copy(this._rot,e):Ai.set(this._rot,e,t,n,i),this._parent?(this._parent.updateWorldTransform(),Ai.multiply(this._lrot,Ai.conjugate(this._lrot,this._parent._rot),this._rot)):Ai.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(nA.ROTATION),1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,nA.ROTATION)}setWorldRotationFromEuler(e,t,n){Ai.fromEuler(this._rot,e,t,n),this._parent?(this._parent.updateWorldTransform(),Ai.multiply(this._lrot,Ai.conjugate(this._lrot,this._parent._rot),this._rot)):Ai.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(nA.ROTATION),1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,nA.ROTATION)}getWorldRotation(e){return this.updateWorldTransform(),e?Ai.copy(e,this._rot):Ai.copy(new Ai,this._rot)}setWorldScale(e,t,n){void 0===t||void 0===n?_i.copy(this._scale,e):_i.set(this._scale,e,t,n);const i=this._parent;i?(i.updateWorldTransform(),pi.fromQuat(Cx,Ai.conjugate(Sx,i._rot)),pi.multiplyMat4(Cx,Cx,i._mat),Ex.m00=this._scale.x,Ex.m04=this._scale.y,Ex.m08=this._scale.z,pi.multiply(Cx,Ex,pi.invert(Cx,Cx)),this._lscale.x=_i.set(xx,Cx.m00,Cx.m01,Cx.m02).length(),this._lscale.y=_i.set(xx,Cx.m03,Cx.m04,Cx.m05).length(),this._lscale.z=_i.set(xx,Cx.m06,Cx.m07,Cx.m08).length()):_i.copy(this._lscale,this._scale),this.invalidateChildren(nA.SCALE),1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,nA.SCALE)}getWorldScale(e){return this.updateWorldTransform(),e?_i.copy(e,this._scale):_i.copy(new _i,this._scale)}getWorldMatrix(e){this.updateWorldTransform();const t=e||new Ei;return Ei.copy(t,this._mat)}getWorldRS(e){this.updateWorldTransform();const t=e||new Ei;return Ei.copy(t,this._mat),t.m12=0,t.m13=0,t.m14=0,t}getWorldRT(e){this.updateWorldTransform();const t=e||new Ei;return Ei.fromRT(t,this._rot,this._pos)}setRTS(e,t,n){let i=0;e&&(i|=nA.ROTATION,void 0!==e.w?(Ai.copy(this._lrot,e),this._eulerDirty=!0):(_i.copy(this._euler,e),Ai.fromEuler(this._lrot,e.x,e.y,e.z),this._eulerDirty=!1)),t&&(_i.copy(this._lpos,t),i|=nA.POSITION),n&&(_i.copy(this._lscale,n),i|=nA.SCALE),i&&(this.invalidateChildren(i),1&this._eventMask&&this.emit(Yg.TRANSFORM_CHANGED,i))}pauseSystemEvents(e){this._eventProcessor.setEnabled(!1,e)}resumeSystemEvents(e){this._eventProcessor.setEnabled(!0,e)}static resetHasChangedFlags(){Dx.clear()}static clearNodeArray(){e.ClearFrame<e.ClearRound&&!i?e.ClearFrame++:(e.ClearFrame=0,Px.length=0,wx.length=0)}},vx.EventType=Yg,vx.NodeSpace=tA,vx.TransformDirtyBit=nA,vx.TransformBit=nA,vx.reserveContentsForAllSyncablePrefabTag=Nx,vx.ClearFrame=0,vx.ClearRound=1e3,fx=Pc((hx=gx).prototype,"_lpos",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),px=Pc(hx.prototype,"_lrot",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ai}}),dx=Pc(hx.prototype,"_lscale",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(1,1,1)}}),mx=Pc(hx.prototype,"_layer",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Jf.Enum.DEFAULT}}),Ax=Pc(hx.prototype,"_euler",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),Pc(hx.prototype,"eulerAngles",[_x],Object.getOwnPropertyDescriptor(hx.prototype,"eulerAngles"),hx.prototype),Pc(hx.prototype,"angle",[il],Object.getOwnPropertyDescriptor(hx.prototype,"angle"),hx.prototype),Pc(hx.prototype,"layer",[il],Object.getOwnPropertyDescriptor(hx.prototype,"layer"),hx.prototype),ux=hx))||ux));var Mx,zx,Lx,Fx,Bx,kx,Ux,Gx,jx,Vx,Hx,Wx,qx,Yx,Xx,Qx,Zx,Jx,Kx,$x,ey,ty,ny,iy,oy,ay,ry,sy,cy,ly,_y,uy,hy,fy,py,dy,my,Ay,vy,gy,xy,yy,by,Sy,Cy,Ey,Ty,Py,wy,Iy,Ry,Dy,Ny,Oy,My,zy,Ly,Fy,By,ky,Uy,Gy,jy,Vy,Hy;c.Node=Ox;let Wy=Uc("cc.TargetInfo")((Lx=Pc((zx=class{constructor(){Tc(this,"localID",Lx,this)}}).prototype,"localID",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Mx=zx))||Mx,qy=(Fx=Uc("cc.TargetOverrideInfo"),Bx=vl(Lt),kx=vl(Wy),Ux=vl(Ox),Gx=vl(Wy),Fx((Hx=Pc((Vx=class{constructor(){Tc(this,"source",Hx,this),Tc(this,"sourceInfo",Wx,this),Tc(this,"propertyPath",qx,this),Tc(this,"target",Yx,this),Tc(this,"targetInfo",Xx,this)}}).prototype,"source",[qc,Bx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wx=Pc(Vx.prototype,"sourceInfo",[qc,kx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qx=Pc(Vx.prototype,"propertyPath",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yx=Pc(Vx.prototype,"target",[qc,Ux],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xx=Pc(Vx.prototype,"targetInfo",[qc,Gx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jx=Vx))||jx),Yy=Uc("cc.CompPrefabInfo")((Jx=Pc((Zx=class{constructor(){Tc(this,"fileId",Jx,this)}}).prototype,"fileId",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Qx=Zx))||Qx,Xy=(Kx=Uc("CCPropertyOverrideInfo"),$x=vl(Wy),Kx((ny=Pc((ty=class{constructor(){Tc(this,"targetInfo",ny,this),Tc(this,"propertyPath",iy,this),Tc(this,"value",oy,this)}isTarget(e,t){}}).prototype,"targetInfo",[qc,$x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iy=Pc(ty.prototype,"propertyPath",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oy=Pc(ty.prototype,"value",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ey=ty))||ey),Qy=(ay=Uc("cc.MountedChildrenInfo"),ry=vl(Wy),sy=vl([Ox]),ay((_y=Pc((ly=class{constructor(){Tc(this,"targetInfo",_y,this),Tc(this,"nodes",uy,this)}isTarget(e){}}).prototype,"targetInfo",[qc,ry],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uy=Pc(ly.prototype,"nodes",[qc,sy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cy=ly))||cy),Zy=(hy=Uc("cc.MountedComponentsInfo"),fy=vl(Wy),py=vl([R_]),hy((Ay=Pc((my=class{constructor(){Tc(this,"targetInfo",Ay,this),Tc(this,"components",vy,this)}isTarget(e){}}).prototype,"targetInfo",[qc,fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vy=Pc(my.prototype,"components",[qc,py],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dy=my))||dy),Jy=(gy=Uc("cc.PrefabInstance"),xy=vl(Ox),yy=vl([Qy]),by=vl([Zy]),Sy=vl([Xy]),Cy=vl([Wy]),gy((Py=Pc((Ty=class{constructor(){Tc(this,"fileId",Py,this),Tc(this,"prefabRootNode",wy,this),Tc(this,"mountedChildren",Iy,this),Tc(this,"mountedComponents",Ry,this),Tc(this,"propertyOverrides",Dy,this),Tc(this,"removedComponents",Ny,this),this.targetMap={}}findPropertyOverride(e,t){}removePropertyOverride(e,t){}}).prototype,"fileId",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),wy=Pc(Ty.prototype,"prefabRootNode",[qc,xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iy=Pc(Ty.prototype,"mountedChildren",[qc,yy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ry=Pc(Ty.prototype,"mountedComponents",[qc,by],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Dy=Pc(Ty.prototype,"propertyOverrides",[qc,Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ny=Pc(Ty.prototype,"removedComponents",[qc,Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ey=Ty))||Ey),Ky=(Oy=Uc("cc.PrefabInfo"),My=vl(Ox),zy=vl(Jy),Ly=vl([qy]),Oy((ky=Pc((By=class{constructor(){Tc(this,"root",ky,this),Tc(this,"asset",Uy,this),Tc(this,"fileId",Gy,this),Tc(this,"instance",jy,this),Tc(this,"targetOverrides",Vy,this),Tc(this,"nestedPrefabInstanceRoots",Hy,this)}}).prototype,"root",[qc,My],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uy=Pc(By.prototype,"asset",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gy=Pc(By.prototype,"fileId",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),jy=Pc(By.prototype,"instance",[qc,zy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vy=Pc(By.prototype,"targetOverrides",[qc,Ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hy=Pc(By.prototype,"nestedPrefabInstanceRoots",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fy=By))||Fy);function $y(e){const t=e._prefab;if(!t)return;if(!t.instance)return;if(!t.asset)return R(3701,e.name),void(t.instance=void 0);const n=e._objFlags,i=e._parent,o=e._id,a=e._prefab;e[Ot],c.game._isCloning=!0,t.asset._doInstantiate(e),c.game._isCloning=!1,e._objFlags=n,e._parent=i,e._id=o,e._prefab&&(e._prefab.instance=null==a?void 0:a.instance)}function eb(e,t,n){var i;if(!t)return;if(!e)return;let o=t;const a=null===(i=e._prefab)||void 0===i?void 0:i.instance;!n&&a&&(t[a.fileId]={},o=t[a.fileId]);const r=e._prefab;r&&(o[r.fileId]=e);const s=e.components;for(let e=0;e<s.length;e++){const t=s[e];t.__prefab&&(o[t.__prefab.fileId]=t)}for(let t=0;t<e.children.length;t++)eb(e.children[t],o,!1)}function tb(e,t){if(!e)return null;let n=null,i=t;for(let t=0;t<e.length;t++){if(!i)return null;i=i[e[t]]}return n=i,n}function nb(e,t,n){if(t)for(let e=0;e<t.length;e++){const i=t[e];if(i&&i.targetInfo){const e=tb(i.targetInfo.localID,n);if(!e)continue;let t=n;const o=i.targetInfo.localID;if(o.length>0)for(let e=0;e<o.length-1;e++)t=t[o[e]];if(i.nodes)for(let n=0;n<i.nodes.length;n++){const o=i.nodes[n];o&&(e._children.push(o),o._parent=e,eb(o,t,!1),o._siblingIndex=e._children.length-1,sb(o,!0))}}}}function ib(e,t,n){if(t)for(let e=0;e<t.length;e++){const i=t[e];if(i&&i.targetInfo){const e=tb(i.targetInfo.localID,n);if(!e)continue;if(i.components)for(let t=0;t<i.components.length;t++){const n=i.components[t];n&&(n.node=e,e._components.push(n))}}}}function ob(e,t,n){if(t)for(let e=0;e<t.length;e++){const i=t[e];if(i){const e=tb(i.localID,n);if(!e||!e.node)continue;const t=e.node.components.indexOf(e);t>=0&&e.node._components.splice(t,1)}}}function ab(e,t,n){if(t.length<=0)return;let i=null;for(let e=0;e<t.length;e++){const o=t[e];if(o&&o.targetInfo){if(i=tb(o.targetInfo.localID,n),!i)continue;let e=i;const t=o.propertyPath.slice();if(t.length>0){const n=t.pop();if(!n)continue;for(let n=0;n<t.length&&(e=e[t[n]],e);n++);if(!e)continue;if(Array.isArray(e))if("length"===n)e[n]=o.value;else{const t=Number.parseInt(n);Number.isInteger(t)&&t<e.length&&(e[n]=o.value)}else e[n]instanceof Ve?e[n].set(o.value):e[n]=o.value}}}}function rb(e){var t;const n=null===(t=e._prefab)||void 0===t?void 0:t.targetOverrides;if(n)for(let e=0;e<n.length;e++){var i,o;const t=n[e];let s=t.source;const c=t.sourceInfo;if(c){var a,r;const e=null===(a=t.source)||void 0===a||null===(r=a._prefab)||void 0===r?void 0:r.instance;e&&e.targetMap&&(s=tb(c.localID,e.targetMap))}if(!s)continue;let l=null;const _=t.targetInfo;if(!_)continue;const u=null===(i=t.target)||void 0===i||null===(o=i._prefab)||void 0===o?void 0:o.instance;if(!u||!u.targetMap)continue;if(l=tb(_.localID,u.targetMap),!l)continue;const h=t.propertyPath.slice();let f=s;if(h.length>0){const e=h.pop();if(!e)return;for(let e=0;e<h.length&&(f=f[h[e]],f);e++);if(!f)continue;f[e]=l}}}function sb(e,t=!1){const n=e._prefab,i=null==n?void 0:n.instance;if(i){$y(e);const t={};i.targetMap=t,eb(e,t,!0),nb(0,i.mountedChildren,t),ob(0,i.removedComponents,t),ib(0,i.mountedComponents,t),ab(0,i.propertyOverrides,t)}t&&e&&e.children&&e.children.forEach((e=>{sb(e,!0)}))}function cb(e){const t=e._prefab;t&&t.nestedPrefabInstanceRoots&&t.nestedPrefabInstanceRoots.forEach((e=>{sb(e)}))}c._PrefabInfo=Ky;var lb,_b,ub,hb,fb,pb,db,mb=Object.freeze({__proto__:null,TargetInfo:Wy,TargetOverrideInfo:qy,CompPrefabInfo:Yy,PropertyOverrideInfo:Xy,MountedChildrenInfo:Qy,MountedComponentsInfo:Zy,PrefabInstance:Jy,PrefabInfo:Ky,createNodeWithPrefab:$y,generateTargetMap:eb,getTarget:tb,applyMountedChildren:nb,applyMountedComponents:ib,applyRemovedComponents:ob,applyPropertyOverrides:ab,applyTargetOverrides:rb,expandPrefabInstanceNode:sb,expandNestedPrefabInstanceNode:cb});const Ab=ke({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2});let vb=e("fI",Uc("cc.Prefab")((db=pb=class e extends __{constructor(){super(),Tc(this,"data",ub,this),Tc(this,"optimizationPolicy",hb,this),Tc(this,"persistent",fb,this),this._createFunction=void 0,this._instantiatedTimes=void 0,this._createFunction=null,this._instantiatedTimes=0}createNode(e){const t=c.instantiate(this);t.name=this.name,e(null,t)}compileCreateFunction(){this._createFunction=function(e){const t=e instanceof c._BaseNode&&e;return new Hg(e,t).result}(this.data)}_doInstantiate(e){return this.data._prefab||w(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(e)}_instantiate(){let t,n=!1;return n=this.optimizationPolicy!==Ab.SINGLE_INSTANCE&&(this.optimizationPolicy===Ab.MULTI_INSTANCE||this._instantiatedTimes+1>=e.OptimizationPolicyThreshold),n?(t=this._doInstantiate(),this.data._instantiate(t)):t=this.data._instantiate(),++this._instantiatedTimes,t}initDefault(e){super.initDefault(e),this.data=new Ox,this.data.name="(Missing Node)";const t=new c._PrefabInfo;t.asset=this,t.root=this.data,this.data._prefab=t}validate(){return!!this.data}onLoaded(){const e=this.data;cb(e),rb(e)}},pb.OptimizationPolicy=Ab,pb.OptimizationPolicyThreshold=3,ub=Pc((_b=db).prototype,"data",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hb=Pc(_b.prototype,"optimizationPolicy",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ab.AUTO}}),fb=Pc(_b.prototype,"persistent",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lb=_b))||lb);var gb,xb,yb,bb,Sb,Cb;Ne.value(vb,"_utils",mb),c.Prefab=vb,oe(c,"cc._Prefab","Prefab"),e("fv",(gb=Uc("cc.PrefabLink"),xb=vl(vb),yb=ol(),gb((Cb=Pc((Sb=class extends R_{constructor(...e){super(...e),Tc(this,"prefab",Cb,this)}}).prototype,"prefab",[xb,qc,yb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bb=Sb))||bb));const Eb=new _i;function Tb(e,t,n,i){i||(i=new _i),e.convertToUINode(t,n,i);const o=n.position;return i.add(o),i}function Pb(e,t,n){return n||(n=new _i),e.worldToScreen(t,n),n.x/=c.view.getScaleX(),n.y/=c.view.getScaleY(),n}const wb=e("fz",{WorldNode3DToLocalNodeUI:Tb,WorldNode3DToWorldNodeUI:Pb});var Ib;c.pipelineUtils=wb,Pn(c.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction(...e){const t=e[0],n=e[3]||Eb;return t.convertToUINode(e[1],e[2],n),n.add(e[2].position),e[3]||n.clone()}}]);const Rb=new rr;Rb.format=Go.RGBA8,Rb.beginAccesses=[la.FRAGMENT_SHADER_READ_TEXTURE],Rb.endAccesses=[la.FRAGMENT_SHADER_READ_TEXTURE];const Db=new sr;Db.format=Go.DEPTH_STENCIL;const Nb=new _r([Rb],Db),Ob={width:1,height:1,renderPassInfo:Nb};let Mb=e("db",Uc("cc.RenderTexture")(Ib=class extends Vd{constructor(...e){super(...e),this._window=null}get window(){return this._window}initialize(e){this._name=e.name||"",this._width=e.width,this._height=e.height,this._initWindow(e)}reset(e){this.initialize(e)}destroy(){if(this._window){const e=c.director.root;null==e||e.destroyWindow(this._window),this._window=null}return super.destroy()}resize(e,t){this._width=Math.floor(Gn(e,1,2048)),this._height=Math.floor(Gn(t,1,2048)),this._window&&this._window.resize(this._width,this._height),this.emit("resize",this._window)}_serialize(e){return{}}_deserialize(e,t){const n=e;this._width=n.w,this._height=n.h,this._name=n.n,super._deserialize(n.base,t)}getGFXTexture(){return this._window&&this._window.framebuffer.colorTextures[0]}onLoaded(){this._initWindow()}_initWindow(e){const t=c.director.root;Ob.title=this._name,Ob.width=this._width,Ob.height=this._height,Ob.renderPassInfo=e&&e.passInfo?e.passInfo:Nb,this._window?(this._window.destroy(),this._window.initialize(t.device,Ob)):this._window=t.createWindow(Ob)}initDefault(e){super.initDefault(e),this._width=this._height=1,this._initWindow()}validate(){return this.width>=1&&this.width<=2048&&this.height>=1&&this.height<=2048}readPixels(e=0,t=0,n,i,o){n=n||this.width,i=i||this.height;const a=this.getGFXTexture();if(!a)return R(7606),null;const r=4*n*i;if(void 0===o)o=new Uint8Array(r);else if(o.length<r)return R(7607,r),null;const s=this._getGFXDevice(),c=[],l=[],_=new Oa;return _.texOffset.x=e,_.texOffset.y=t,_.texExtent.width=n,_.texExtent.height=i,l.push(_),c.push(o),null==s||s.copyTextureToBuffers(a,c,l),o}})||Ib);var zb,Lb;c.RenderTexture=Mb,wn(Vd.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),Pn(Mb.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction(){return this._window}}]);let Fb=e("fH",Uc("cc.BufferAsset")((Pc((Lb=class extends __{constructor(...e){super(...e),this._buffer=null}get _nativeAsset(){return this._buffer}set _nativeAsset(e){e instanceof ArrayBuffer?this._buffer=e:this._buffer=e.buffer}buffer(){return this._buffer}validate(){return!!this.buffer}}).prototype,"_nativeAsset",[gl],Object.getOwnPropertyDescriptor(Lb.prototype,"_nativeAsset"),Lb.prototype),zb=Lb))||zb);c.BufferAsset=Fb;const Bb={[jo.UNORM]:"Uint",[jo.SNORM]:"Int",[jo.UINT]:"Uint",[jo.INT]:"Int",[jo.UFLOAT]:"Float",[jo.FLOAT]:"Float",default:"Uint"};function kb(e){return`${Bb[e.type]||Bb.default}${e.size/e.count*8}`}function Ub(e,t,n=Go.R32F,i=0,o=e.byteLength-i,a=0,r){r||(r=new DataView(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)));const s=Pr[n];a||(a=s.size);const c=`set${kb(s)}`,l=`get${kb(s)}`,_=s.size/s.count,u=Math.floor(o/a),h=U_.isLittleEndian;for(let n=0;n<u;++n){const o=i+a*n;for(let n=0;n<s.count;++n){const i=o+_*n,a=e[l](i,h);r[c](i,t(a,n,e),h)}}return r}class Gb{_init(){}constructor(e,t,n,i=null,o=null){this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._attributes=t,this._vertexBuffers=e,this._indexBuffer=i,this._indirectBuffer=o,this._primitiveMode=n,this._iaInfo=new ar(t,e,i,o),this._init()}get attributes(){return this._attributes}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get indirectBuffer(){return this._indirectBuffer}get primitiveMode(){return this._primitiveMode}get geometricInfo(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:_i.ZERO,max:_i.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:_i.ZERO,max:_i.ZERO}};const{mesh:e}=this,t=this.subMeshIdx,n=e.readAttribute(t,Sa.ATTR_POSITION),i=e.readIndices(t),o=new _i,a=new _i,r=this.attributes.find((e=>e.name===Sa.ATTR_POSITION));if(r){const e=Pr[r.format].count;2===e?(o.set(n[0],n[1],0),a.set(n[0],n[1],0)):(o.set(n[0],n[1],n[2]),a.set(n[0],n[1],n[2]));for(let t=0;t<n.length;t+=e)2===e?(o.x=n[t]>o.x?n[t]:o.x,o.y=n[t+1]>o.y?n[t+1]:o.y,a.x=n[t]<a.x?n[t]:a.x,a.y=n[t+1]<a.y?n[t+1]:a.y):(o.x=n[t]>o.x?n[t]:o.x,o.y=n[t+1]>o.y?n[t+1]:o.y,o.z=n[t+2]>o.z?n[t+2]:o.z,a.x=n[t]<a.x?n[t]:a.x,a.y=n[t+1]<a.y?n[t+1]:a.y,a.z=n[t+2]<a.z?n[t+2]:a.z)}return this._geometricInfo={positions:n,indices:i,boundingBox:{max:o,min:a}},this._geometricInfo}get flatBuffers(){return this._flatBuffers}genFlatBuffers(){if(this._flatBuffers.length||!this.mesh||void 0===this.subMeshIdx)return;const{mesh:e}=this;let t=0;const n=e.struct.primitives[this.subMeshIdx];n.indexView&&(t=n.indexView.count);for(let i=0;i<n.vertexBundelIndices.length;i++){const o=n.vertexBundelIndices[i],a=e.struct.vertexBundles[o],r=n.indexView?n.indexView.count:a.view.count,s=a.view.stride,c=s*r,l=new Uint8Array(e.data.buffer,a.view.offset,a.view.length),_=new Uint8Array(n.indexView?c:a.view.length);if(!n.indexView){_.set(e.data.subarray(a.view.offset,a.view.offset+a.view.length)),this._flatBuffers.push({stride:s,count:r,buffer:_});continue}const u=e.readIndices(this.subMeshIdx);for(let e=0;e<t;++e){const t=e*s,n=u[e]*s;for(let e=0;e<s;++e)_[t+e]=l[n+e]}this._flatBuffers.push({stride:s,count:r,buffer:_})}}get jointMappedBuffers(){if(this._jointMappedBuffers)return this._jointMappedBuffers;const e=this._jointMappedBuffers=[],t=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;const{struct:n}=this.mesh,i=n.primitives[this.subMeshIdx];if(!n.jointMaps||void 0===i.jointMapIndex||!n.jointMaps[i.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;let o,a;const{device:r}=c.director.root;for(let s=0;s<i.vertexBundelIndices.length;s++){const c=n.vertexBundles[i.vertexBundelIndices[s]];a=0,o=Go.UNKNOWN;for(let e=0;e<c.attributes.length;e++){const t=c.attributes[e];if(t.name===Sa.ATTR_JOINTS){o=t.format;break}a+=Pr[t.format].size}if(o){const l=new Uint8Array(this.mesh.data.buffer,c.view.offset,c.view.length),_=new DataView(l.slice().buffer),u=n.jointMaps[i.jointMapIndex];Ub(_,(e=>u.indexOf(e)),o,a,c.view.length,c.view.stride,_);const h=r.createBuffer(new ka(Ho.VERTEX|Ho.TRANSFER_DST,Yo.DEVICE,c.view.length,c.view.stride));h.update(_.buffer),e.push(h),t.push(s)}else e.push(this.vertexBuffers[i.vertexBundelIndices[s]])}return this._vertexIdChannel&&e.push(this._allocVertexIdBuffer(r)),e}get iaInfo(){return this._iaInfo}destroy(){for(let e=0;e<this.vertexBuffers.length;e++)this.vertexBuffers[e].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(let e=0;e<this._jointMappedBufferIndices.length;e++)this._jointMappedBuffers[this._jointMappedBufferIndices[e]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null)}enableVertexIdChannel(e){if(this._vertexIdChannel)return;const t=this.vertexBuffers.length,n=this.attributes.length,i=this._allocVertexIdBuffer(e);this._vertexBuffers.push(i),this._attributes.push(new ir("a_vertexId",Go.R32F,!1,t)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:t,index:n}}_allocVertexIdBuffer(e){const t=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,n=new Float32Array(t);for(let e=0;e<t;++e)n[e]=e+.5;const i=e.createBuffer(new ka(Ho.VERTEX|Ho.TRANSFER_DST,Yo.DEVICE,n.byteLength,n.BYTES_PER_ELEMENT));return i.update(n),i}}let jb,Vb;e("d7",Gb),function(e){e.TOUCH_START="touch-start",e.TOUCH_MOVE="touch-move",e.TOUCH_END="touch-end",e.TOUCH_CANCEL="touch-cancel",e.MOUSE_DOWN="mouse-down",e.MOUSE_MOVE="mouse-move",e.MOUSE_UP="mouse-up",e.MOUSE_WHEEL="mouse-wheel",e.MOUSE_ENTER="mouse-enter",e.MOUSE_LEAVE="mouse-leave",e.KEY_DOWN="keydown",e.KEY_UP="keyup",e.DEVICEMOTION="devicemotion",e.TRANSFORM_CHANGED="transform-changed",e.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",e.SIZE_CHANGED="size-changed",e.ANCHOR_CHANGED="anchor-changed",e.COLOR_CHANGED="color-changed",e.CHILD_ADDED="child-added",e.CHILD_REMOVED="child-removed",e.PARENT_CHANGED="parent-changed",e.NODE_DESTROYED="node-destroyed",e.LAYER_CHANGED="layer-changed",e.SIBLING_ORDER_CHANGED="sibling-order-changed"}(jb||(jb=e("dN",{}))),function(e){e.TOUCH_START="touch-start",e.TOUCH_MOVE="touch-move",e.TOUCH_END="touch-end",e.TOUCH_CANCEL="touch-cancel",e.MOUSE_DOWN="mouse-down",e.MOUSE_MOVE="mouse-move",e.MOUSE_UP="mouse-up",e.MOUSE_WHEEL="mouse-wheel",e.KEY_DOWN="keydown",e.KEY_PRESSING="key-pressing",e.KEY_UP="keyup",e.DEVICEMOTION="devicemotion"}(Vb||(Vb=e("du",{}))),c.SystemEventType=jb;const Hb=new Array(16);let Wb=null,qb=new Ii;const Yb=[Yg.TOUCH_START,Yg.TOUCH_MOVE,Yg.TOUCH_END,Yg.TOUCH_CANCEL],Xb=[Yg.MOUSE_DOWN,Yg.MOUSE_ENTER,Yg.MOUSE_MOVE,Yg.MOUSE_LEAVE,Yg.MOUSE_UP,Yg.MOUSE_WHEEL];let Qb;!function(e){e[e.ADD_POINTER_EVENT_PROCESSOR=0]="ADD_POINTER_EVENT_PROCESSOR",e[e.REMOVE_POINTER_EVENT_PROCESSOR=1]="REMOVE_POINTER_EVENT_PROCESSOR",e[e.MARK_LIST_DIRTY=2]="MARK_LIST_DIRTY"}(Qb||(Qb=e("dt",{})));class Zb{get isEnabled(){return this._isEnabled}setEnabled(e,t=!1){if(this._isEnabled===e)return;this._isEnabled=e;const n=this.node.children;if(e&&this._attachMask(),Zb.callbacksInvoker.emit(Qb.MARK_LIST_DIRTY),t&&n.length>0)for(let t=0;t<n.length;++t)n[t]._eventProcessor.setEnabled(e,!0)}get node(){return this._node}constructor(e){this._isEnabled=!1,this.claimedTouchIdList=[],this.maskList=null,this.cachedCameraPriority=0,this.previousMouseIn=!1,this.bubblingTarget=null,this.capturingTarget=null,this.shouldHandleEventMouse=!1,this.shouldHandleEventTouch=!1,this._node=void 0,this._node=e}_searchComponentsInParent(e){const t=this.node;if(e){let n=0,i=[];for(let o=t;o&&Ox.isNode(o);o=o.parent,++n){const t=o.getComponent(e);if(t){const e={index:n,comp:t};i?i.push(e):i=[e]}}return i.length>0?i:null}return null}_attachMask(){this.maskList=this._searchComponentsInParent(Zb._maskComp)}reattach(){let e;this.node.walk((t=>{e||(e=this._searchComponentsInParent(Zb._maskComp)),t.eventProcessor.maskList=e}))}destroy(){Wb===this._node&&(Wb=null),this.capturingTarget&&this.capturingTarget.clear(),this.bubblingTarget&&this.bubblingTarget.clear(),Zb.callbacksInvoker.emit(Qb.REMOVE_POINTER_EVENT_PROCESSOR,this)}_isTouchEvent(e){return-1!==Yb.indexOf(e)}_isMouseEvent(e){return-1!==Xb.indexOf(e)}_hasTouchListeners(){for(let e=0;e<Yb.length;++e){const t=Yb[e];if(this.hasEventListener(t))return!0}return!1}_hasMouseListeners(){for(let e=0;e<Xb.length;++e){const t=Xb[e];if(this.hasEventListener(t))return!0}return!1}_hasPointerListeners(){return!!this._hasTouchListeners()||this._hasMouseListeners()}_tryEmittingAddEvent(e){const t=this._isTouchEvent(e),n=this._isMouseEvent(e);t?this.shouldHandleEventTouch=!0:n&&(this.shouldHandleEventMouse=!0),!t&&!n||this._hasPointerListeners()||Zb.callbacksInvoker.emit(Qb.ADD_POINTER_EVENT_PROCESSOR,this)}_newCallbacksInvoker(){const e=new Wt;return e._registerOffCallback((()=>{this.shouldHandleEventTouch&&!this._hasTouchListeners()&&(this.shouldHandleEventTouch=!1),this.shouldHandleEventMouse&&!this._hasMouseListeners()&&(this.shouldHandleEventMouse=!1),this._hasPointerListeners()||Zb.callbacksInvoker.emit(Qb.REMOVE_POINTER_EVENT_PROCESSOR,this)})),e}on(e,t,n,i){let o;var a,r;return this._tryEmittingAddEvent(e),o=(i=!!i)?null!==(a=this.capturingTarget)&&void 0!==a?a:this.capturingTarget=this._newCallbacksInvoker():null!==(r=this.bubblingTarget)&&void 0!==r?r:this.bubblingTarget=this._newCallbacksInvoker(),o.on(e,t,n),t}once(e,t,n,i){let o;var a,r;return this._tryEmittingAddEvent(e),o=(i=!!i)?null!==(a=this.capturingTarget)&&void 0!==a?a:this.capturingTarget=this._newCallbacksInvoker():null!==(r=this.bubblingTarget)&&void 0!==r?r:this.bubblingTarget=this._newCallbacksInvoker(),o.on(e,t,n,!0),t}off(e,t,n,i){var o;let a;a=(i=!!i)?this.capturingTarget:this.bubblingTarget,null===(o=a)||void 0===o||o.off(e,t,n)}targetOff(e){var t,n;null===(t=this.capturingTarget)||void 0===t||t.removeAll(e),null===(n=this.bubblingTarget)||void 0===n||n.removeAll(e),this.shouldHandleEventTouch&&!this._hasTouchListeners()&&(this.shouldHandleEventTouch=!1),this.shouldHandleEventMouse&&!this._hasMouseListeners()&&(this.shouldHandleEventMouse=!1),this._hasPointerListeners()||Zb.callbacksInvoker.emit(Qb.REMOVE_POINTER_EVENT_PROCESSOR,this)}emit(e,t,n,i,o,a){var r;null===(r=this.bubblingTarget)||void 0===r||r.emit(e,t,n,i,o,a)}dispatchEvent(e){const t=this.node;let n,i=0;for(e.target=t,Hb.length=0,this.getCapturingTargets(e.type,Hb),e.eventPhase=1,i=Hb.length-1;i>=0;--i)if(n=Hb[i],n.eventProcessor.capturingTarget&&(e.currentTarget=n,n.eventProcessor.capturingTarget.emit(e.type,e,Hb),e.propagationStopped))return void(Hb.length=0);if(Hb.length=0,e.eventPhase=2,e.currentTarget=t,this.capturingTarget&&this.capturingTarget.emit(e.type,e),!e.propagationImmediateStopped&&this.bubblingTarget&&this.bubblingTarget.emit(e.type,e),!e.propagationStopped&&e.bubbles)for(this.getBubblingTargets(e.type,Hb),e.eventPhase=3,i=0;i<Hb.length;++i)if(n=Hb[i],n.eventProcessor.bubblingTarget&&(e.currentTarget=n,n.eventProcessor.bubblingTarget.emit(e.type,e),e.propagationStopped))return void(Hb.length=0);Hb.length=0}hasEventListener(e,t,n){let i=!1;return this.bubblingTarget&&(i=this.bubblingTarget.hasEventListener(e,t,n)),!i&&this.capturingTarget&&(i=this.capturingTarget.hasEventListener(e,t,n)),i}getCapturingTargets(e,t){let n=this._node.parent;for(;n;){var i;(null===(i=n.eventProcessor.capturingTarget)||void 0===i?void 0:i.hasEventListener(e))&&t.push(n),n=n.parent}}getBubblingTargets(e,t){let n=this._node.parent;for(;n;){var i;(null===(i=n.eventProcessor.bubblingTarget)||void 0===i?void 0:i.hasEventListener(e))&&t.push(n),n=n.parent}}_handleEventMouse(e){switch(e.type){case Vb.MOUSE_DOWN:return this._handleMouseDown(e);case Vb.MOUSE_MOVE:return this._handleMouseMove(e);case Vb.MOUSE_UP:return this._handleMouseUp(e);case Vb.MOUSE_WHEEL:return this._handleMouseWheel(e);default:return!1}}_handleMouseDown(e){const t=this._node;return!(!t||!t._uiProps.uiTransformComp||(qb=e.getUILocation(),!t._uiProps.uiTransformComp.isHit(qb)||(e.type=Yg.MOUSE_DOWN,e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0,0)))}_handleMouseMove(e){const t=this._node;return!(!t||!t._uiProps.uiTransformComp)&&(qb=e.getUILocation(),t._uiProps.uiTransformComp.isHit(qb)?(this.previousMouseIn||(Wb&&Wb!==t&&(e.type=Yg.MOUSE_LEAVE,Wb.dispatchEvent(e),Wb.eventProcessor.previousMouseIn=!1),Wb=t,e.type=Yg.MOUSE_ENTER,t.dispatchEvent(e),this.previousMouseIn=!0),e.type=Yg.MOUSE_MOVE,e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0,!0):(this.previousMouseIn&&(e.type=Yg.MOUSE_LEAVE,t.dispatchEvent(e),this.previousMouseIn=!1,Wb=null),!1))}_handleMouseUp(e){const t=this._node;return!(!t||!t._uiProps.uiTransformComp||(qb=e.getUILocation(),!t._uiProps.uiTransformComp.isHit(qb)||(e.type=Yg.MOUSE_UP,e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0,0)))}_handleMouseWheel(e){const t=this._node;return!(!t||!t._uiProps.uiTransformComp||(qb=e.getUILocation(),!t._uiProps.uiTransformComp.isHit(qb)||(e.type=Yg.MOUSE_WHEEL,e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0,0)))}_handleEventTouch(e){switch(e.type){case Vb.TOUCH_START:return this._handleTouchStart(e);case Vb.TOUCH_MOVE:return this._handleTouchMove(e);case Vb.TOUCH_END:return this._handleTouchEnd(e);case Vb.TOUCH_CANCEL:return this._handleTouchCancel(e);default:return!1}}_handleTouchStart(e){const t=this.node;return!(!t||!t._uiProps.uiTransformComp||(e.getUILocation(qb),!t._uiProps.uiTransformComp.isHit(qb)||(e.type=Yg.TOUCH_START,e.bubbles=!0,t.dispatchEvent(e),0)))}_handleTouchMove(e){const t=this.node;return!(!t||!t._uiProps.uiTransformComp||(e.type=Yg.TOUCH_MOVE,e.bubbles=!0,t.dispatchEvent(e),0))}_handleTouchEnd(e){const t=this.node;t&&t._uiProps.uiTransformComp&&(e.getUILocation(qb),t._uiProps.uiTransformComp.isHit(qb)?e.type=Yg.TOUCH_END:e.type=Yg.TOUCH_CANCEL,e.bubbles=!0,t.dispatchEvent(e))}_handleTouchCancel(e){const t=this.node;t&&t._uiProps.uiTransformComp&&(e.type=Yg.TOUCH_CANCEL,e.bubbles=!0,t.dispatchEvent(e))}}e("d8",Zb),Zb._maskComp=null,Zb.callbacksInvoker=new Wt,c.NodeEventProcessor=Zb;const Jb=new Oi,Kb=ke({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),$b=Kb.LAYERED+1;class eS{set enabled(e){this._setEnable(e),e?this.activate():(this._type=$b,this._updatePipeline())}get enabled(){return this._enabled}set accurate(e){this._setAccurate(e),this._updatePipeline()}get accurate(){return this._accurate}set fogColor(e){this._fogColor.set(e),Jb.set(e.x,e.y,e.z,e.w),fA(this._colorArray,Jb),this._nativeObj.color=this._fogColor}get fogColor(){return this._fogColor}get type(){return this._type}set type(e){this._setType(e),this.enabled&&this._updatePipeline()}get fogDensity(){return this._fogDensity}set fogDensity(e){this._fogDensity=e,this._nativeObj.density=e}get fogStart(){return this._fogStart}set fogStart(e){this._fogStart=e,this._nativeObj.start=e}get fogEnd(){return this._fogEnd}set fogEnd(e){this._fogEnd=e,this._nativeObj.end=e}get fogAtten(){return this._fogAtten}set fogAtten(e){this._fogAtten=e,this._nativeObj.atten=e}get fogTop(){return this._fogTop}set fogTop(e){this._fogTop=e,this._nativeObj.top=e}get fogRange(){return this._fogRange}set fogRange(e){this._fogRange=e,this._nativeObj.range=e}get colorArray(){return this._colorArray}get native(){return this._nativeObj}constructor(){this._fogColor=new ri("#C8C8C8"),this._colorArray=new Oi(.2,.2,.2,1),this._enabled=!1,this._accurate=!1,this._type=0,this._fogDensity=.3,this._fogStart=.5,this._fogEnd=300,this._fogAtten=5,this._fogTop=1.5,this._fogRange=1.2,this._nativeObj=new Ji}_setType(e){this._type=this.enabled?e:$b,this._nativeObj.type=this._type}_setEnable(e){this._enabled=e,this._nativeObj.enabled=e}_setAccurate(e){this._accurate=e,this._nativeObj.accurate=e}initialize(e){this.fogColor=e.fogColor,this._setEnable(e.enabled),this._setAccurate(e.accurate),this._setType(e.type),this.fogDensity=e.fogDensity,this.fogStart=e.fogStart,this.fogEnd=e.fogEnd,this.fogAtten=e.fogAtten,this.fogTop=e.fogTop,this.fogRange=e.fogRange}activate(){this._updatePipeline()}_updatePipeline(){const e=c.director.root,t=this.enabled?this.type:$b,n=this.accurate?1:0,i=e.pipeline;i.macros.CC_USE_FOG===t&&i.macros.CC_USE_ACCURATE_FOG===n||(i.macros.CC_USE_FOG=t,i.macros.CC_USE_ACCURATE_FOG=n,e.onGlobalPipelineStateChanged())}_destroy(){this._nativeObj=null}destroy(){this._destroy()}}var tS,nS,iS,oS,aS,rS,sS,cS,lS,_S,uS,hS,fS,pS,dS,mS,AS,vS,gS,xS,yS,bS,SS,CS,ES,TS,PS,wS,IS,RS,DS,NS,OS,MS,zS,LS,FS,BS,kS,US,GS,jS,VS,HS,WS,qS,YS,XS,QS,ZS,JS,KS,$S,eC,tC,nC,iC,oC,aC,rC,sC,cC,lC,_C,uC,hC,fC,pC,dC,mC,AC,vC,gC,xC,yC,bC,SC,CC,EC,TC,PC,wC,IC,RC,DC,NC,OC,MC,zC,LC,FC,BC,kC,UC,GC,jC,VC,HC,WC,qC,YC,XC,QC,ZC,JC,KC,$C,eE,tE,nE,iE,oE,aE,rE,sE,cE,lE,_E,uE,hE,fE,pE,dE,mE,AE,vE,gE,xE,yE,bE,SE,CE,EE,TE,PE,wE,IE,RE,DE,NE,OE,ME,zE,LE,FE,BE,kE,UE,GE,jE,VE,HE,WE,qE,YE,XE,QE,ZE,JE,KE,$E,eT,tT,nT,iT,oT,aT,rT,sT,cT,lT,_T,uT,hT,fT,pT,dT,mT,AT,vT,gT,xT,yT,bT,ST,CT,ET,TT,PT,wT;c.Fog=eS;const IT=new _i(0,1,0),RT=new _i,DT=new Oi,NT=new ri,OT=new Ai,MT=e=>{const t=1/Math.max(Math.max(Math.max(e.x,e.y),e.z),1e-4);t<1&&(e.x*=t,e.y*=t,e.z*=t)};let zT=(tS=Uc("cc.AmbientInfo"),nS=nl(),iS=Yc("_skyColor"),oS=Yc("_skyIllum"),aS=Yc("_groundAlbedo"),rS=ol(),sS=sl(),cS=vl(ut),lS=sl(),_S=ol(),uS=sl(),tS(hS=nS((pS=Pc((fS=class{constructor(){Tc(this,"_skyColorHDR",pS,this),Tc(this,"_skyIllumHDR",dS,this),Tc(this,"_groundAlbedoHDR",mS,this),Tc(this,"_skyColorLDR",AS,this),Tc(this,"_skyIllumLDR",vS,this),Tc(this,"_groundAlbedoLDR",gS,this),this._resource=null}get skyColorHDR(){return this._skyColorHDR}get groundAlbedoHDR(){return this._groundAlbedoHDR}get skyIllumHDR(){return this._skyIllumHDR}get skyColorLDR(){return this._skyColorLDR}get groundAlbedoLDR(){return this._groundAlbedoLDR}get skyIllumLDR(){return this._skyIllumLDR}set skyLightingColor(e){DT.set(e.x,e.y,e.z,e.w),c.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(DT):this._skyColorLDR.set(DT),this._resource&&this._resource.skyColor.set(DT)}get skyLightingColor(){const e=c.director.root.pipeline.pipelineSceneData.isHDR;return DT.set(e?this._skyColorHDR:this._skyColorLDR),MT(DT),NT.set(255*DT.x,255*DT.y,255*DT.z,255)}set skyColor(e){c.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(e):this._skyColorLDR.set(e),this._resource&&this._resource.skyColor.set(e)}set skyIllum(e){c.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=e:this._skyIllumLDR=e,this._resource&&(this._resource.skyIllum=e)}get skyIllum(){return c.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR}set groundLightingColor(e){DT.set(e.x,e.y,e.z,e.w),c.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(DT):this._groundAlbedoLDR.set(DT),this._resource&&this._resource.groundAlbedo.set(DT)}get groundLightingColor(){const e=c.director.root.pipeline.pipelineSceneData.isHDR;return DT.set(e?this._groundAlbedoHDR:this._groundAlbedoLDR),MT(DT),NT.set(255*DT.x,255*DT.y,255*DT.z,255)}set groundAlbedo(e){c.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(e):this._groundAlbedoLDR.set(e),this._resource&&this._resource.groundAlbedo.set(e)}activate(e){this._resource=e,this._resource.initialize(this)}}).prototype,"_skyColorHDR",[qc,iS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oi(.2,.5,.8,1)}}),dS=Pc(fS.prototype,"_skyIllumHDR",[qc,oS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _o.SKY_ILLUM}}),mS=Pc(fS.prototype,"_groundAlbedoHDR",[qc,aS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oi(.2,.2,.2,1)}}),AS=Pc(fS.prototype,"_skyColorLDR",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oi(.2,.5,.8,1)}}),vS=Pc(fS.prototype,"_skyIllumLDR",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _o.SKY_ILLUM}}),gS=Pc(fS.prototype,"_groundAlbedoLDR",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oi(.2,.2,.2,1)}}),Pc(fS.prototype,"skyLightingColor",[rS,il,sS],Object.getOwnPropertyDescriptor(fS.prototype,"skyLightingColor"),fS.prototype),Pc(fS.prototype,"skyIllum",[il,cS,lS],Object.getOwnPropertyDescriptor(fS.prototype,"skyIllum"),fS.prototype),Pc(fS.prototype,"groundLightingColor",[_S,il,uS],Object.getOwnPropertyDescriptor(fS.prototype,"groundLightingColor"),fS.prototype),hS=fS))||hS)||hS);c.AmbientInfo=zT;let LT=(xS=Uc("cc.SkyboxInfo"),yS=nl(),bS=vl(hm),SS=Yc("_envmap"),CS=vl(hm),ES=vl(hm),TS=vl(hm),PS=ol(),wS=sl(),IS=hl(),RS=sl(),DS=sl(),NS=sl(),OS=vl(hm),MS=sl(),zS=ol(),LS=vl(hm),FS=hl(),xS(BS=yS((US=Pc((kS=class{constructor(){Tc(this,"_applyDiffuseMap",US,this),Tc(this,"_envmapHDR",GS,this),Tc(this,"_envmapLDR",jS,this),Tc(this,"_diffuseMapHDR",VS,this),Tc(this,"_diffuseMapLDR",HS,this),Tc(this,"_enabled",WS,this),Tc(this,"_useIBL",qS,this),Tc(this,"_useHDR",YS,this),this._resource=null}set applyDiffuseMap(e){this._applyDiffuseMap=e,this._resource&&(this._resource.useDiffuseMap=e)}get applyDiffuseMap(){return this._applyDiffuseMap}set enabled(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=this._enabled))}get enabled(){return this._enabled}set useIBL(e){this._useIBL=e,this._resource&&(this._resource.useIBL=this._useIBL)}get useIBL(){return this._useIBL}set useHDR(e){c.director.root.pipeline.pipelineSceneData.isHDR=e,this._useHDR=e,this._resource&&(this.envmap=this._resource.envmap,this.diffuseMap=this._resource.diffuseMap,null==this.diffuseMap&&(this.applyDiffuseMap=!1)),this._resource&&(this._resource.useHDR=this._useHDR)}get useHDR(){return c.director.root.pipeline.pipelineSceneData.isHDR=this._useHDR,this._useHDR}set envmap(e){c.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR=e:this._envmapLDR=e,this._envmapHDR||(this._diffuseMapHDR=null,this._applyDiffuseMap=!1,this.useIBL=!1),this._resource&&(this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.useDiffuseMap=this._applyDiffuseMap,this._resource.envmap=e)}get envmap(){return c.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR}set diffuseMap(e){c.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR=e:this._diffuseMapLDR=e,this._resource&&this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR)}get diffuseMap(){return c.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR}activate(e){this._resource=e,this._resource.initialize(this),this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.activate()}}).prototype,"_applyDiffuseMap",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),GS=Pc(kS.prototype,"_envmapHDR",[qc,bS,SS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jS=Pc(kS.prototype,"_envmapLDR",[qc,CS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VS=Pc(kS.prototype,"_diffuseMapHDR",[qc,ES],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HS=Pc(kS.prototype,"_diffuseMapLDR",[qc,TS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),WS=Pc(kS.prototype,"_enabled",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qS=Pc(kS.prototype,"_useIBL",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),YS=Pc(kS.prototype,"_useHDR",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Pc(kS.prototype,"applyDiffuseMap",[PS,il,wS,IS],Object.getOwnPropertyDescriptor(kS.prototype,"applyDiffuseMap"),kS.prototype),Pc(kS.prototype,"enabled",[il,RS],Object.getOwnPropertyDescriptor(kS.prototype,"enabled"),kS.prototype),Pc(kS.prototype,"useIBL",[il,DS],Object.getOwnPropertyDescriptor(kS.prototype,"useIBL"),kS.prototype),Pc(kS.prototype,"useHDR",[il,NS],Object.getOwnPropertyDescriptor(kS.prototype,"useHDR"),kS.prototype),Pc(kS.prototype,"envmap",[il,OS,MS],Object.getOwnPropertyDescriptor(kS.prototype,"envmap"),kS.prototype),Pc(kS.prototype,"diffuseMap",[zS,il,al,LS,FS],Object.getOwnPropertyDescriptor(kS.prototype,"diffuseMap"),kS.prototype),BS=kS))||BS)||BS);c.SkyboxInfo=LT;let FT=(XS=Uc("cc.FogInfo"),QS=nl(),ZS=sl(),JS=hl(),KS=sl(),$S=hl(),eC=sl(),tC=vl(Kb),nC=hl(),iC=sl(),oC=ol(),aC=vl(ut),rC=cl(),sC=_l(),cC=sl(),lC=ol(),_C=vl(ut),uC=_l(),hC=sl(),fC=ol(),pC=vl(ut),dC=_l(),mC=sl(),AC=ol(),vC=vl(ut),gC=ll(),xC=_l(),yC=sl(),bC=ol(),SC=vl(ut),CC=_l(),EC=sl(),TC=ol(),PC=vl(ut),wC=_l(),IC=sl(),XS(RC=QS((VC=jC=class{constructor(){Tc(this,"_type",NC,this),Tc(this,"_fogColor",OC,this),Tc(this,"_enabled",MC,this),Tc(this,"_fogDensity",zC,this),Tc(this,"_fogStart",LC,this),Tc(this,"_fogEnd",FC,this),Tc(this,"_fogAtten",BC,this),Tc(this,"_fogTop",kC,this),Tc(this,"_fogRange",UC,this),Tc(this,"_accurate",GC,this),this._resource=null}set enabled(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))}get enabled(){return this._enabled}set accurate(e){this._accurate!==e&&(this._accurate=e,this._resource&&(this._resource.accurate=e,e&&(this._resource.type=this._type)))}get accurate(){return this._accurate}set fogColor(e){this._fogColor.set(e),this._resource&&(this._resource.fogColor=this._fogColor)}get fogColor(){return this._fogColor}get type(){return this._type}set type(e){this._type=e,this._resource&&(this._resource.type=e)}get fogDensity(){return this._fogDensity}set fogDensity(e){this._fogDensity=e,this._resource&&(this._resource.fogDensity=e)}get fogStart(){return this._fogStart}set fogStart(e){this._fogStart=e,this._resource&&(this._resource.fogStart=e)}get fogEnd(){return this._fogEnd}set fogEnd(e){this._fogEnd=e,this._resource&&(this._resource.fogEnd=e)}get fogAtten(){return this._fogAtten}set fogAtten(e){this._fogAtten=e,this._resource&&(this._resource.fogAtten=e)}get fogTop(){return this._fogTop}set fogTop(e){this._fogTop=e,this._resource&&(this._resource.fogTop=e)}get fogRange(){return this._fogRange}set fogRange(e){this._fogRange=e,this._resource&&(this._resource.fogRange=e)}activate(e){this._resource=e,this._resource.initialize(this),this._resource.activate()}},jC.FogType=Kb,NC=Pc((DC=VC).prototype,"_type",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Kb.LINEAR}}),OC=Pc(DC.prototype,"_fogColor",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ri("#C8C8C8")}}),MC=Pc(DC.prototype,"_enabled",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),zC=Pc(DC.prototype,"_fogDensity",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),LC=Pc(DC.prototype,"_fogStart",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),FC=Pc(DC.prototype,"_fogEnd",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),BC=Pc(DC.prototype,"_fogAtten",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),kC=Pc(DC.prototype,"_fogTop",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),UC=Pc(DC.prototype,"_fogRange",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),GC=Pc(DC.prototype,"_accurate",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Pc(DC.prototype,"enabled",[il,ZS,JS],Object.getOwnPropertyDescriptor(DC.prototype,"enabled"),DC.prototype),Pc(DC.prototype,"accurate",[il,KS,$S],Object.getOwnPropertyDescriptor(DC.prototype,"accurate"),DC.prototype),Pc(DC.prototype,"fogColor",[il,eC],Object.getOwnPropertyDescriptor(DC.prototype,"fogColor"),DC.prototype),Pc(DC.prototype,"type",[il,tC,nC,iC],Object.getOwnPropertyDescriptor(DC.prototype,"type"),DC.prototype),Pc(DC.prototype,"fogDensity",[oC,aC,rC,sC,ul,cC],Object.getOwnPropertyDescriptor(DC.prototype,"fogDensity"),DC.prototype),Pc(DC.prototype,"fogStart",[lC,_C,uC,hC],Object.getOwnPropertyDescriptor(DC.prototype,"fogStart"),DC.prototype),Pc(DC.prototype,"fogEnd",[fC,pC,dC,mC],Object.getOwnPropertyDescriptor(DC.prototype,"fogEnd"),DC.prototype),Pc(DC.prototype,"fogAtten",[AC,vC,gC,xC,yC],Object.getOwnPropertyDescriptor(DC.prototype,"fogAtten"),DC.prototype),Pc(DC.prototype,"fogTop",[bC,SC,CC,EC],Object.getOwnPropertyDescriptor(DC.prototype,"fogTop"),DC.prototype),Pc(DC.prototype,"fogRange",[TC,PC,wC,IC],Object.getOwnPropertyDescriptor(DC.prototype,"fogRange"),DC.prototype),RC=DC))||RC)||RC),BT=(HC=Uc("cc.ShadowsInfo"),WC=nl(),qC=sl(),YC=vl(TA),XC=ol(),QC=ol(),ZC=sl(),JC=vl(ut),KC=sl(),$C=ol(),eE=cl(),tE=vl(ut),nE=sl(),iE=ol(),oE=vl(PA),aE=sl(),rE=ol(),sE=vl(_t),cE=ol(),lE=vl(ut),_E=sl(),uE=ol(),hE=vl(ut),fE=sl(),pE=ol(),dE=vl(EA),mE=sl(),AE=ol(),vE=vl(ht),gE=sl(),xE=ol(),yE=vl(ut),bE=sl(),SE=ol(),CE=vl(ut),EE=sl(),TE=ol(),PE=cl(),wE=vl(ut),IE=sl(),RE=ol(),DE=cl(),NE=vl(ut),OE=sl(),ME=ol(),zE=vl(ut),LE=sl(),FE=ol(),HC(BE=WC((UE=Pc((kE=class{constructor(){Tc(this,"_type",UE,this),Tc(this,"_enabled",GE,this),Tc(this,"_normal",jE,this),Tc(this,"_distance",VE,this),Tc(this,"_shadowColor",HE,this),Tc(this,"_firstSetCSM",WE,this),Tc(this,"_fixedArea",qE,this),Tc(this,"_pcf",YE,this),Tc(this,"_bias",XE,this),Tc(this,"_normalBias",QE,this),Tc(this,"_near",ZE,this),Tc(this,"_far",JE,this),Tc(this,"_shadowDistance",KE,this),Tc(this,"_invisibleOcclusionRange",$E,this),Tc(this,"_orthoSize",eT,this),Tc(this,"_maxReceived",tT,this),Tc(this,"_size",nT,this),Tc(this,"_saturation",iT,this),this._resource=null}set enabled(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))}get enabled(){return this._enabled}set type(e){this._type=e,this._resource&&(this._resource.type=e)}get type(){return this._type}set shadowColor(e){this._shadowColor.set(e),this._resource&&(this._resource.shadowColor=e)}get shadowColor(){return this._shadowColor}set normal(e){_i.copy(this._normal,e),this._resource&&(this._resource.normal=e)}get normal(){return this._normal}set distance(e){this._distance=e,this._resource&&(this._resource.distance=e)}get distance(){return this._distance}set saturation(e){e>1?(this._saturation=e/e,this._resource&&(this._resource.saturation=e/e)):(this._saturation=e,this._resource&&(this._resource.saturation=e))}get saturation(){return this._saturation}set pcf(e){this._pcf=e,this._resource&&(this._resource.pcf=e)}get pcf(){return this._pcf}set maxReceived(e){this._maxReceived=e,this._resource&&(this._resource.maxReceived=e)}get maxReceived(){return this._maxReceived}set bias(e){this._bias=e,this._resource&&(this._resource.bias=e)}get bias(){return this._bias}set normalBias(e){this._normalBias=e,this._resource&&(this._resource.normalBias=e)}get normalBias(){return this._normalBias}set shadowMapSize(e){this._size.set(e,e),this._resource&&(this._resource.size.set(e,e),this._resource.shadowMapDirty=!0)}get shadowMapSize(){return this._size.x}get size(){return this._size}set fixedArea(e){this._fixedArea=e,this._resource&&(this._resource.fixedArea=e)}get fixedArea(){return this._fixedArea}set near(e){this._near=e,this._resource&&(this._resource.near=e)}get near(){return this._near}set far(e){this._far=Math.min(e,IA.MAX_FAR),this._resource&&(this._resource.far=this._far)}get far(){return this._far}set invisibleOcclusionRange(e){this._invisibleOcclusionRange=Math.min(e,IA.MAX_FAR),this._resource&&(this._resource.invisibleOcclusionRange=this._invisibleOcclusionRange)}get invisibleOcclusionRange(){return this._invisibleOcclusionRange}set shadowDistance(e){this._shadowDistance=Math.min(e,IA.MAX_FAR),this._resource&&(this._resource.shadowDistance=this._shadowDistance)}get shadowDistance(){return this._shadowDistance}set orthoSize(e){this._orthoSize=e,this._resource&&(this._resource.orthoSize=e)}get orthoSize(){return this._orthoSize}setPlaneFromNode(e){e.getWorldRotation(OT),this.normal=_i.transformQuat(RT,IT,OT),e.getWorldPosition(RT),this.distance=_i.dot(this._normal,RT)}activate(e){this.pcf=Math.min(this._pcf,PA.SOFT_2X),this._resource=e,this._resource.initialize(this),this._resource.activate()}}).prototype,"_type",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return TA.Planar}}),GE=Pc(kE.prototype,"_enabled",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),jE=Pc(kE.prototype,"_normal",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(0,1,0)}}),VE=Pc(kE.prototype,"_distance",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),HE=Pc(kE.prototype,"_shadowColor",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ri(0,0,0,76)}}),WE=Pc(kE.prototype,"_firstSetCSM",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qE=Pc(kE.prototype,"_fixedArea",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),YE=Pc(kE.prototype,"_pcf",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return PA.HARD}}),XE=Pc(kE.prototype,"_bias",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e-5}}),QE=Pc(kE.prototype,"_normalBias",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ZE=Pc(kE.prototype,"_near",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),JE=Pc(kE.prototype,"_far",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),KE=Pc(kE.prototype,"_shadowDistance",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),$E=Pc(kE.prototype,"_invisibleOcclusionRange",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),eT=Pc(kE.prototype,"_orthoSize",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),tT=Pc(kE.prototype,"_maxReceived",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),nT=Pc(kE.prototype,"_size",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ii(512,512)}}),iT=Pc(kE.prototype,"_saturation",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.75}}),Pc(kE.prototype,"enabled",[il,qC],Object.getOwnPropertyDescriptor(kE.prototype,"enabled"),kE.prototype),Pc(kE.prototype,"type",[il,YC],Object.getOwnPropertyDescriptor(kE.prototype,"type"),kE.prototype),Pc(kE.prototype,"shadowColor",[XC],Object.getOwnPropertyDescriptor(kE.prototype,"shadowColor"),kE.prototype),Pc(kE.prototype,"normal",[QC,ZC],Object.getOwnPropertyDescriptor(kE.prototype,"normal"),kE.prototype),Pc(kE.prototype,"distance",[JC,KC,$C],Object.getOwnPropertyDescriptor(kE.prototype,"distance"),kE.prototype),Pc(kE.prototype,"saturation",[il,eE,ul,tE,nE,iE],Object.getOwnPropertyDescriptor(kE.prototype,"saturation"),kE.prototype),Pc(kE.prototype,"pcf",[oE,aE,rE],Object.getOwnPropertyDescriptor(kE.prototype,"pcf"),kE.prototype),Pc(kE.prototype,"maxReceived",[sE,cE],Object.getOwnPropertyDescriptor(kE.prototype,"maxReceived"),kE.prototype),Pc(kE.prototype,"bias",[lE,_E,uE],Object.getOwnPropertyDescriptor(kE.prototype,"bias"),kE.prototype),Pc(kE.prototype,"normalBias",[hE,fE,pE],Object.getOwnPropertyDescriptor(kE.prototype,"normalBias"),kE.prototype),Pc(kE.prototype,"shadowMapSize",[dE,mE,AE],Object.getOwnPropertyDescriptor(kE.prototype,"shadowMapSize"),kE.prototype),Pc(kE.prototype,"fixedArea",[vE,gE,xE],Object.getOwnPropertyDescriptor(kE.prototype,"fixedArea"),kE.prototype),Pc(kE.prototype,"near",[yE,bE,SE],Object.getOwnPropertyDescriptor(kE.prototype,"near"),kE.prototype),Pc(kE.prototype,"far",[CE,EE,TE],Object.getOwnPropertyDescriptor(kE.prototype,"far"),kE.prototype),Pc(kE.prototype,"invisibleOcclusionRange",[il,PE,ul,wE,IE,RE],Object.getOwnPropertyDescriptor(kE.prototype,"invisibleOcclusionRange"),kE.prototype),Pc(kE.prototype,"shadowDistance",[il,DE,ul,NE,OE,ME],Object.getOwnPropertyDescriptor(kE.prototype,"shadowDistance"),kE.prototype),Pc(kE.prototype,"orthoSize",[zE,LE,FE],Object.getOwnPropertyDescriptor(kE.prototype,"orthoSize"),kE.prototype),BE=kE))||BE)||BE);c.ShadowsInfo=BT;const kT=new _i(-1024,-1024,-1024),UT=new _i(1024,1024,1024);let GT=(oT=Uc("cc.OctreeInfo"),aT=nl(),rT=sl(),sT=sl(),cT=rl(),lT=sl(),_T=rl(),uT=cl(),hT=vl(_t),fT=sl(),oT(pT=aT((mT=Pc((dT=class{constructor(){Tc(this,"_enabled",mT,this),Tc(this,"_minPos",AT,this),Tc(this,"_maxPos",vT,this),Tc(this,"_depth",gT,this),this._resource=null}set enabled(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e))}get enabled(){return this._enabled}set minPos(e){this._minPos=e,this._resource&&(this._resource.minPos=e)}get minPos(){return this._minPos}set maxPos(e){this._maxPos=e,this._resource&&(this._resource.maxPos=e)}get maxPos(){return this._maxPos}set depth(e){this._depth=e,this._resource&&(this._resource.depth=e)}get depth(){return this._depth}activate(e){this._resource=e,this._resource.initialize(this)}}).prototype,"_enabled",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),AT=Pc(dT.prototype,"_minPos",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(kT)}}),vT=Pc(dT.prototype,"_maxPos",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(UT)}}),gT=Pc(dT.prototype,"_depth",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),Pc(dT.prototype,"enabled",[il,rT],Object.getOwnPropertyDescriptor(dT.prototype,"enabled"),dT.prototype),Pc(dT.prototype,"minPos",[il,sT,cT],Object.getOwnPropertyDescriptor(dT.prototype,"minPos"),dT.prototype),Pc(dT.prototype,"maxPos",[il,lT,_T],Object.getOwnPropertyDescriptor(dT.prototype,"maxPos"),dT.prototype),Pc(dT.prototype,"depth",[il,uT,hT,fT],Object.getOwnPropertyDescriptor(dT.prototype,"depth"),dT.prototype),pT=dT))||pT)||pT),jT=(xT=Uc("cc.SceneGlobals"),yT=vl(LT),xT((CT=Pc((ST=class{constructor(){Tc(this,"ambient",CT,this),Tc(this,"shadows",ET,this),Tc(this,"_skybox",TT,this),Tc(this,"fog",PT,this),Tc(this,"octree",wT,this)}get skybox(){return this._skybox}set skybox(e){this._skybox=e}activate(){const e=c.director.root.pipeline.pipelineSceneData;this.skybox.activate(e.skybox),this.ambient.activate(e.ambient),this.shadows.activate(e.shadows),this.fog.activate(e.fog),this.octree.activate(e.octree)}}).prototype,"ambient",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zT}}),ET=Pc(ST.prototype,"shadows",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new BT}}),TT=Pc(ST.prototype,"_skybox",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new LT}}),PT=Pc(ST.prototype,"fog",[il,qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new FT}}),Pc(ST.prototype,"skybox",[il,yT],Object.getOwnPropertyDescriptor(ST.prototype,"skybox"),ST.prototype),wT=Pc(ST.prototype,"octree",[il,qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new GT}}),bT=ST))||bT);c.SceneGlobals=jT;class VT{constructor(e,t){this.type=void 0,this.bubbles=void 0,this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=e,this.bubbles=!!t}unuse(){this.type=VT.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=VT.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1}reuse(e,t){this.type=e,this.bubbles=t||!1}isStopped(){return this.propagationStopped||this.propagationImmediateStopped}getCurrentTarget(){return this.currentTarget}getType(){return this.type}}e("dO",VT),VT.NO_TYPE="no_type",VT.TOUCH="touch",VT.MOUSE="mouse",VT.KEYBOARD="keyboard",VT.ACCELERATION="acceleration",VT.NONE=0,VT.CAPTURING_PHASE=1,VT.AT_TARGET=2,VT.BUBBLING_PHASE=3,c.Event=VT;class HT extends VT{constructor(e,t){super(jb.DEVICEMOTION,t),this.acc=void 0,this.acc=e}}e("gK",HT),VT.EventAcceleration=HT;class WT extends VT{get isPressed(){return this._isPressed}constructor(e,t,n){"boolean"==typeof t&&(t=t?jb.KEY_DOWN:jb.KEY_UP),super(t,n),this.keyCode=void 0,this.rawEvent=void 0,this._isPressed=void 0,this._isPressed=t!==jb.KEY_UP,"number"==typeof e?this.keyCode=e:(this.keyCode=e.keyCode,this.rawEvent=e)}}e("gL",WT),VT.EventKeyboard=WT;class qT extends VT{get eventType(){return this._eventType}constructor(e,t,n){super(e,t),this.movementX=0,this.movementY=0,this.preventSwallow=!1,this._eventType=void 0,this._button=qT.BUTTON_MISSING,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0,this._eventType=e,n&&(this._prevX=n.x,this._prevY=n.y)}setScrollData(e,t){this._scrollX=e,this._scrollY=t}getScrollX(){return this._scrollX}getScrollY(){return this._scrollY}setLocation(e,t){this._x=e,this._y=t}getLocation(e){return e||(e=new Ii),Ii.set(e,this._x,this._y),e}getLocationInView(e){return e||(e=new Ii),Ii.set(e,this._x,c.view._designResolutionSize.height-this._y),e}getUILocation(e){return e||(e=new Ii),Ii.set(e,this._x,this._y),c.view._convertToUISpace(e),e}getPreviousLocation(e){return e||(e=new Ii),Ii.set(e,this._prevX,this._prevY),e}getUIPreviousLocation(e){return e||(e=new Ii),Ii.set(e,this._prevX,this._prevY),c.view._convertToUISpace(e),e}getDelta(e){return e||(e=new Ii),Ii.set(e,this._x-this._prevX,this._y-this._prevY),e}getDeltaX(){return this._x-this._prevX}getDeltaY(){return this._y-this._prevY}getUIDelta(e){return e||(e=new Ii),Ii.set(e,(this._x-this._prevX)/c.view.getScaleX(),(this._y-this._prevY)/c.view.getScaleY()),e}getUIDeltaX(){return(this._x-this._prevX)/c.view.getScaleX()}getUIDeltaY(){return(this._y-this._prevY)/c.view.getScaleY()}setButton(e){this._button=e}getButton(){return this._button}getLocationX(){return this._x}getLocationY(){return this._y}getUILocationX(){const e=c.view.getViewportRect();return(this._x-e.x)/c.view.getScaleX()}getUILocationY(){const e=c.view.getViewportRect();return(this._y-e.y)/c.view.getScaleY()}}e("gM",qT),qT.BUTTON_MISSING=-1,qT.BUTTON_LEFT=0,qT.BUTTON_RIGHT=2,qT.BUTTON_MIDDLE=1,qT.BUTTON_4=3,qT.BUTTON_5=4,qT.BUTTON_6=5,qT.BUTTON_7=6,qT.BUTTON_8=7,VT.EventMouse=qT;const YT=new Ii;class XT extends VT{constructor(e,t,n,i=[]){super(n,t),this.touch=null,this.simulate=!1,this.preventSwallow=!1,this._eventCode=void 0,this._touches=void 0,this._allTouches=void 0,this._eventCode=n,this._touches=e||[],this._allTouches=i}getEventCode(){return this._eventCode}getTouches(){return this._touches}getAllTouches(){return this._allTouches}setLocation(e,t){this.touch&&this.touch.setTouchInfo(this.touch.getID(),e,t)}getLocation(e){return this.touch?this.touch.getLocation(e):new Ii}getUILocation(e){return this.touch?this.touch.getUILocation(e):new Ii}getLocationInView(e){return this.touch?this.touch.getLocationInView(e):new Ii}getPreviousLocation(e){return this.touch?this.touch.getPreviousLocation(e):new Ii}getStartLocation(e){return this.touch?this.touch.getStartLocation(e):new Ii}getUIStartLocation(e){return this.touch?this.touch.getUIStartLocation(e):new Ii}getID(){return this.touch?this.touch.getID():null}getDelta(e){return this.touch?this.touch.getDelta(e):new Ii}getUIDelta(e){return this.touch?this.touch.getUIDelta(e):new Ii}getDeltaX(){return this.touch?this.touch.getDelta(YT).x:0}getDeltaY(){return this.touch?this.touch.getDelta(YT).y:0}getLocationX(){return this.touch?this.touch.getLocationX():0}getLocationY(){return this.touch?this.touch.getLocationY():0}}e("dM",XT),XT.MAX_TOUCHES=5,VT.EventTouch=XT;class QT{constructor(e=0,t=0,n=0,i=0){this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=e,this.y=t,this.z=n,this.timestamp=i}}let ZT;e("gN",QT),function(e){e[e.NONE=0]="NONE",e[e.MOBILE_BACK=6]="MOBILE_BACK",e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.ENTER=13]="ENTER",e[e.SHIFT_LEFT=16]="SHIFT_LEFT",e[e.CTRL_LEFT=17]="CTRL_LEFT",e[e.ALT_LEFT=18]="ALT_LEFT",e[e.PAUSE=19]="PAUSE",e[e.CAPS_LOCK=20]="CAPS_LOCK",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.ARROW_LEFT=37]="ARROW_LEFT",e[e.ARROW_UP=38]="ARROW_UP",e[e.ARROW_RIGHT=39]="ARROW_RIGHT",e[e.ARROW_DOWN=40]="ARROW_DOWN",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.DIGIT_0=48]="DIGIT_0",e[e.DIGIT_1=49]="DIGIT_1",e[e.DIGIT_2=50]="DIGIT_2",e[e.DIGIT_3=51]="DIGIT_3",e[e.DIGIT_4=52]="DIGIT_4",e[e.DIGIT_5=53]="DIGIT_5",e[e.DIGIT_6=54]="DIGIT_6",e[e.DIGIT_7=55]="DIGIT_7",e[e.DIGIT_8=56]="DIGIT_8",e[e.DIGIT_9=57]="DIGIT_9",e[e.KEY_A=65]="KEY_A",e[e.KEY_B=66]="KEY_B",e[e.KEY_C=67]="KEY_C",e[e.KEY_D=68]="KEY_D",e[e.KEY_E=69]="KEY_E",e[e.KEY_F=70]="KEY_F",e[e.KEY_G=71]="KEY_G",e[e.KEY_H=72]="KEY_H",e[e.KEY_I=73]="KEY_I",e[e.KEY_J=74]="KEY_J",e[e.KEY_K=75]="KEY_K",e[e.KEY_L=76]="KEY_L",e[e.KEY_M=77]="KEY_M",e[e.KEY_N=78]="KEY_N",e[e.KEY_O=79]="KEY_O",e[e.KEY_P=80]="KEY_P",e[e.KEY_Q=81]="KEY_Q",e[e.KEY_R=82]="KEY_R",e[e.KEY_S=83]="KEY_S",e[e.KEY_T=84]="KEY_T",e[e.KEY_U=85]="KEY_U",e[e.KEY_V=86]="KEY_V",e[e.KEY_W=87]="KEY_W",e[e.KEY_X=88]="KEY_X",e[e.KEY_Y=89]="KEY_Y",e[e.KEY_Z=90]="KEY_Z",e[e.NUM_0=96]="NUM_0",e[e.NUM_1=97]="NUM_1",e[e.NUM_2=98]="NUM_2",e[e.NUM_3=99]="NUM_3",e[e.NUM_4=100]="NUM_4",e[e.NUM_5=101]="NUM_5",e[e.NUM_6=102]="NUM_6",e[e.NUM_7=103]="NUM_7",e[e.NUM_8=104]="NUM_8",e[e.NUM_9=105]="NUM_9",e[e.NUM_MULTIPLY=106]="NUM_MULTIPLY",e[e.NUM_PLUS=107]="NUM_PLUS",e[e.NUM_SUBTRACT=109]="NUM_SUBTRACT",e[e.NUM_DECIMAL=110]="NUM_DECIMAL",e[e.NUM_DIVIDE=111]="NUM_DIVIDE",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NUM_LOCK=144]="NUM_LOCK",e[e.SCROLL_LOCK=145]="SCROLL_LOCK",e[e.SEMICOLON=186]="SEMICOLON",e[e.EQUAL=187]="EQUAL",e[e.COMMA=188]="COMMA",e[e.DASH=189]="DASH",e[e.PERIOD=190]="PERIOD",e[e.SLASH=191]="SLASH",e[e.BACK_QUOTE=192]="BACK_QUOTE",e[e.BRACKET_LEFT=219]="BRACKET_LEFT",e[e.BACKSLASH=220]="BACKSLASH",e[e.BRACKET_RIGHT=221]="BRACKET_RIGHT",e[e.QUOTE=222]="QUOTE",e[e.SHIFT_RIGHT=2e3]="SHIFT_RIGHT",e[e.CTRL_RIGHT=2001]="CTRL_RIGHT",e[e.ALT_RIGHT=2002]="ALT_RIGHT",e[e.NUM_ENTER=2003]="NUM_ENTER"}(ZT||(ZT=e("dH",{})));const JT=new Ii;class KT{get lastModified(){return this._lastModified}constructor(e,t,n=0){this._point=new Ii,this._prevPoint=new Ii,this._lastModified=0,this._id=0,this._startPoint=new Ii,this._startPointCaptured=!1,this.setTouchInfo(n,e,t)}getLocation(e){return e||(e=new Ii),e.set(this._point.x,this._point.y),e}getLocationX(){return this._point.x}getLocationY(){return this._point.y}getUILocation(e){return e||(e=new Ii),e.set(this._point.x,this._point.y),c.view._convertToUISpace(e),e}getUILocationX(){const e=c.view.getViewportRect();return(this._point.x-e.x)/c.view.getScaleX()}getUILocationY(){const e=c.view.getViewportRect();return(this._point.y-e.y)/c.view.getScaleY()}getPreviousLocation(e){return e||(e=new Ii),e.set(this._prevPoint.x,this._prevPoint.y),e}getUIPreviousLocation(e){return e||(e=new Ii),e.set(this._prevPoint.x,this._prevPoint.y),c.view._convertToUISpace(e),e}getStartLocation(e){return e||(e=new Ii),e.set(this._startPoint.x,this._startPoint.y),e}getUIStartLocation(e){return e||(e=new Ii),e.set(this._startPoint.x,this._startPoint.y),c.view._convertToUISpace(e),e}getDelta(e){return e||(e=new Ii),e.set(this._point),e.subtract(this._prevPoint),e}getUIDelta(e){return e||(e=new Ii),JT.set(this._point),JT.subtract(this._prevPoint),e.set(c.view.getScaleX(),c.view.getScaleY()),Ii.divide(e,JT,e),e}getLocationInView(e){return e||(e=new Ii),e.set(this._point.x,c.view._designResolutionSize.height-this._point.y),e}getPreviousLocationInView(e){return e||(e=new Ii),e.set(this._prevPoint.x,c.view._designResolutionSize.height-this._prevPoint.y),e}getStartLocationInView(e){return e||(e=new Ii),e.set(this._startPoint.x,c.view._designResolutionSize.height-this._startPoint.y),e}getID(){return this._id}setTouchInfo(e=0,t,n){this._prevPoint=this._point,this._point=new Ii(t||0,n||0),this._id=e,this._startPointCaptured||(this._startPoint=new Ii(this._point),this._startPointCaptured=!0)}setPoint(e,t){"object"==typeof e?(this._point.x=e.x,this._point.y=e.y):(this._point.x=e||0,this._point.y=t||0),this._lastModified=c.game.frameStartTime}setPrevPoint(e,t){this._prevPoint="object"==typeof e?new Ii(e.x,e.y):new Ii(e||0,t||0),this._lastModified=c.game.frameStartTime}}e("gO",KT),c.Touch=KT;class $T{constructor(){this._intervalInSeconds=.2,this._intervalId=void 0,this._isEnabled=!1,this._eventTarget=new Yt,this._didAccelerateFunc=void 0,this._didAccelerateFunc=this._didAccelerate.bind(this)}_didAccelerate(){const e=jsb.device.getDeviceMotionValue();let t=.1*e[3],n=.1*e[4];const i=.1*e[5],o=B_.orientation,a=t;o===z_.LANDSCAPE_RIGHT?(t=-n,n=a):o===z_.LANDSCAPE_LEFT?(t=n,n=-a):o===z_.PORTRAIT_UPSIDE_DOWN&&(t=-t,n=-n),nn.os!==Jt.ANDROID&&nn.os!==Jt.OHOS||(t=-t,n=-n);const r=performance.now(),s=new QT(t,n,i,r),c=new HT(s);this._eventTarget.emit(Vb.DEVICEMOTION,c)}start(){this._intervalId&&clearInterval(this._intervalId),this._intervalId=setInterval(this._didAccelerateFunc,1e3*this._intervalInSeconds),jsb.device.setAccelerometerInterval(this._intervalInSeconds),jsb.device.setAccelerometerEnabled(!0),this._isEnabled=!0}stop(){this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),jsb.device.setAccelerometerEnabled(!1),this._isEnabled=!1}setInterval(e){this._intervalInSeconds=e/1e3,jsb.device.setAccelerometerInterval(this._intervalInSeconds),this._isEnabled&&(jsb.device.setAccelerometerEnabled(!1),jsb.device.setAccelerometerEnabled(!0))}on(e,t,n){this._eventTarget.on(e,t,n)}}const eP={12:ZT.NUM_LOCK,10048:ZT.NUM_0,10049:ZT.NUM_1,10050:ZT.NUM_2,10051:ZT.NUM_3,10052:ZT.NUM_4,10053:ZT.NUM_5,10054:ZT.NUM_6,10055:ZT.NUM_7,10056:ZT.NUM_8,10057:ZT.NUM_9,20013:ZT.NUM_ENTER,20016:ZT.SHIFT_RIGHT,20017:ZT.CTRL_RIGHT,20018:ZT.ALT_RIGHT};function tP(e){return eP[e]||e}class nP{constructor(){this._eventTarget=new Yt,this._keyStateMap={},this._registerEvent()}_registerEvent(){jsb.onKeyDown=e=>{const t=tP(e.keyCode);if(this._keyStateMap[t]){const t=this._getInputEvent(e,Vb.KEY_PRESSING);this._eventTarget.emit(Vb.KEY_PRESSING,t)}else{const t=this._getInputEvent(e,Vb.KEY_DOWN);this._eventTarget.emit(Vb.KEY_DOWN,t)}this._keyStateMap[t]=!0},jsb.onKeyUp=e=>{const t=tP(e.keyCode),n=this._getInputEvent(e,Vb.KEY_UP);this._keyStateMap[t]=!1,this._eventTarget.emit(Vb.KEY_UP,n)}}_getInputEvent(e,t){const n=tP(e.keyCode);return new WT(n,t)}on(e,t,n){this._eventTarget.on(e,t,n)}}class iP{constructor(){this._eventTarget=new Yt,this._preMousePos=new Ii,this._isPressed=!1,this._registerEvent()}_getLocation(e){const t=B_.windowSize,n=B_.devicePixelRatio,i=e.x*n,o=t.height-e.y*n;return new Ii(i,o)}_registerEvent(){jsb.onMouseDown=this._createCallback(Vb.MOUSE_DOWN),jsb.onMouseMove=this._createCallback(Vb.MOUSE_MOVE),jsb.onMouseUp=this._createCallback(Vb.MOUSE_UP),jsb.onMouseWheel=this._handleMouseWheel.bind(this)}_createCallback(e){return t=>{const n=this._getLocation(t);let i=t.button;switch(e){case Vb.MOUSE_DOWN:this._isPressed=!0;break;case Vb.MOUSE_UP:this._isPressed=!1;break;case Vb.MOUSE_MOVE:this._isPressed||(i=qT.BUTTON_MISSING)}const o=new qT(e,!1,this._preMousePos);o.setLocation(n.x,n.y),o.setButton(i),o.movementX=n.x-this._preMousePos.x,o.movementY=this._preMousePos.y-n.y,this._preMousePos.set(n.x,n.y),this._eventTarget.emit(e,o)}}_handleMouseWheel(e){const t=Vb.MOUSE_WHEEL,n=this._getLocation(e),i=e.button,o=new qT(t,!1,this._preMousePos);o.setLocation(n.x,n.y),o.setButton(i),o.movementX=n.x-this._preMousePos.x,o.movementY=this._preMousePos.y-n.y,o.setScrollData(120*e.wheelDeltaX,120*e.wheelDeltaY),this._preMousePos.set(n.x,n.y),this._eventTarget.emit(t,o)}on(e,t,n){this._eventTarget.on(e,t,n)}}const oP=new Ii,aP=new class{constructor(){this._touchMap=void 0,this._maxTouches=8,this._touchMap=new Map}_cloneTouch(e){const t=e.getID();e.getStartLocation(oP);const n=new KT(oP.x,oP.y,t);return e.getLocation(oP),n.setPoint(oP.x,oP.y),e.getPreviousLocation(oP),n.setPrevPoint(oP),n}_createTouch(e,t,n){if(this._touchMap.has(e))return void console.log("Cannot create the same touch object.");if(this._checkTouchMapSizeMoreThanMax(e))return void console.log("The touches is more than MAX_TOUCHES.");const i=new KT(t,n,e);return this._touchMap.set(e,i),this._updateTouch(i,t,n),this._cloneTouch(i)}releaseTouch(e){this._touchMap.has(e)&&this._touchMap.delete(e)}getTouch(e,t,n){let i=this._touchMap.get(e);return i?this._updateTouch(i,t,n):i=this._createTouch(e,t,n),i?this._cloneTouch(i):void 0}getAllTouches(){const e=[];return this._touchMap.forEach((t=>{if(t){const n=this._cloneTouch(t);e.push(n)}})),e}_updateTouch(e,t,n){e.getLocation(oP),e.setPrevPoint(oP),e.setPoint(t,n)}_checkTouchMapSizeMoreThanMax(e){if(this._touchMap.has(e))return!1;const t=He.ENABLE_MULTI_TOUCH?this._maxTouches:1;if(this._touchMap.size<t)return!1;const n=performance.now();return this._touchMap.forEach((e=>{n-e.lastModified>He.TOUCH_TIMEOUT&&(console.log(`The touches is more than MAX_TOUCHES, release touch id ${e.getID()}.`),this.releaseTouch(e.getID()))})),t>=this._touchMap.size}};class rP{constructor(){this._eventTarget=new Yt,this._registerEvent()}_registerEvent(){jsb.onTouchStart=this._createCallback(Vb.TOUCH_START),jsb.onTouchMove=this._createCallback(Vb.TOUCH_MOVE),jsb.onTouchEnd=this._createCallback(Vb.TOUCH_END),jsb.onTouchCancel=this._createCallback(Vb.TOUCH_CANCEL)}_createCallback(e){return t=>{const n=[],i=t.length,o=B_.windowSize;for(let a=0;a<i;++a){const i=t[a],r=i.identifier;if(null===r)continue;const s=this._getLocation(i,o),c=aP.getTouch(r,s.x,s.y);c&&(e!==Vb.TOUCH_END&&e!==Vb.TOUCH_CANCEL||aP.releaseTouch(r),n.push(c))}if(n.length>0){const t=new XT(n,!1,e,He.ENABLE_MULTI_TOUCH?aP.getAllTouches():n);this._eventTarget.emit(e,t)}}}_getLocation(e,t){const n=B_.devicePixelRatio,i=e.clientX*n,o=t.height-e.clientY*n;return new Ii(i,o)}on(e,t,n){this._eventTarget.on(e,t,n)}}let sP;!function(e){e[e.GLOBAL=0]="GLOBAL",e[e.UI=1]="UI"}(sP||(sP=e("dr",{})));class cP{constructor(e){this.priority=sP.GLOBAL,this._inputEventTarget=void 0,this._inputEventTarget=e}dispatchEvent(e){return this._inputEventTarget.emit(e.type,e),!0}}const lP={[Vb.MOUSE_DOWN]:Vb.TOUCH_START,[Vb.MOUSE_MOVE]:Vb.TOUCH_MOVE,[Vb.MOUSE_UP]:Vb.TOUCH_END};class _P{constructor(){this._dispatchImmediately=!1,this._eventTarget=new Yt,this._touchInput=new rP,this._mouseInput=new iP,this._keyboardInput=new nP,this._accelerometerInput=new $T,this._eventTouchList=[],this._eventMouseList=[],this._eventKeyboardList=[],this._eventAccelerationList=[],this._needSimulateTouchMoveEvent=!1,this._inputEventDispatcher=void 0,this._eventDispatcherList=[],this._registerEvent(),this._inputEventDispatcher=new cP(this._eventTarget),this._registerEventDispatcher(this._inputEventDispatcher)}on(e,t,n){return this._eventTarget.on(e,t,n),t}once(e,t,n){return this._eventTarget.once(e,t,n),t}off(e,t,n){this._eventTarget.off(e,t,n)}setAccelerometerEnabled(e){e?this._accelerometerInput.start():this._accelerometerInput.stop()}setAccelerometerInterval(e){this._accelerometerInput.setInterval(e)}_simulateEventTouch(e){const t=lP[e.type],n=aP.getTouch(0,e.getLocationX(),e.getLocationY());if(!n)return;const i=[n],o=new XT(i,!1,t,i);t===Vb.TOUCH_END&&aP.releaseTouch(0),this._dispatchOrPushEventTouch(o,this._eventTouchList)}_registerEventDispatcher(e){this._eventDispatcherList.push(e),this._eventDispatcherList.sort(((e,t)=>t.priority-e.priority))}_emitEvent(e){const t=this._eventDispatcherList.length;for(let n=0;n<t&&this._eventDispatcherList[n].dispatchEvent(e);++n);}_registerEvent(){if(U_.hasFeature(U_.Feature.INPUT_TOUCH)){const e=this._eventTouchList;this._touchInput.on(Vb.TOUCH_START,(t=>{this._dispatchOrPushEventTouch(t,e)})),this._touchInput.on(Vb.TOUCH_MOVE,(t=>{this._dispatchOrPushEventTouch(t,e)})),this._touchInput.on(Vb.TOUCH_END,(t=>{this._dispatchOrPushEventTouch(t,e)})),this._touchInput.on(Vb.TOUCH_CANCEL,(t=>{this._dispatchOrPushEventTouch(t,e)}))}if(U_.hasFeature(U_.Feature.EVENT_MOUSE)){const e=this._eventMouseList;this._mouseInput.on(Vb.MOUSE_DOWN,(t=>{this._needSimulateTouchMoveEvent=!0,this._simulateEventTouch(t),this._dispatchOrPushEvent(t,e)})),this._mouseInput.on(Vb.MOUSE_MOVE,(t=>{this._needSimulateTouchMoveEvent&&this._simulateEventTouch(t),this._dispatchOrPushEvent(t,e)})),this._mouseInput.on(Vb.MOUSE_UP,(t=>{this._needSimulateTouchMoveEvent=!1,this._simulateEventTouch(t),this._dispatchOrPushEvent(t,e)})),this._mouseInput.on(Vb.MOUSE_WHEEL,(t=>{this._dispatchOrPushEvent(t,e)}))}if(U_.hasFeature(U_.Feature.EVENT_KEYBOARD)){const e=this._eventKeyboardList;this._keyboardInput.on(Vb.KEY_DOWN,(t=>{this._dispatchOrPushEvent(t,e)})),this._keyboardInput.on(Vb.KEY_PRESSING,(t=>{this._dispatchOrPushEvent(t,e)})),this._keyboardInput.on(Vb.KEY_UP,(t=>{this._dispatchOrPushEvent(t,e)}))}if(U_.hasFeature(U_.Feature.EVENT_ACCELEROMETER)){const e=this._eventAccelerationList;this._accelerometerInput.on(Vb.DEVICEMOTION,(t=>{this._dispatchOrPushEvent(t,e)}))}}_clearEvents(){this._eventMouseList.length=0,this._eventTouchList.length=0,this._eventKeyboardList.length=0,this._eventAccelerationList.length=0}_dispatchOrPushEvent(e,t){this._dispatchImmediately?this._emitEvent(e):t.push(e)}_dispatchOrPushEventTouch(e,t){if(this._dispatchImmediately){const t=e.getTouches(),n=t.length;for(let i=0;i<n;++i)e.touch=t[i],e.propagationStopped=e.propagationImmediateStopped=!1,this._emitEvent(e)}else t.push(e)}_frameDispatchEvents(){const e=this._eventMouseList;for(let t=0,n=e.length;t<n;++t){const n=e[t];this._emitEvent(n)}const t=this._eventTouchList;for(let e=0,n=t.length;e<n;++e){const n=t[e],i=n.getTouches(),o=i.length;for(let e=0;e<o;++e)n.touch=i[e],n.propagationStopped=n.propagationImmediateStopped=!1,this._emitEvent(n)}const n=this._eventKeyboardList;for(let e=0,t=n.length;e<t;++e){const t=n[e];this._emitEvent(t)}const i=this._eventAccelerationList;for(let e=0,t=i.length;e<t;++e){const t=i[e];this._emitEvent(t)}this._clearEvents()}}e("dq",_P),_P.EventType=Vb;const uP=e("ds",new _P);class hP extends Yt{constructor(){super(),uP.on(Vb.MOUSE_DOWN,(e=>{this.emit(jb.MOUSE_DOWN,e)})),uP.on(Vb.MOUSE_MOVE,(e=>{this.emit(jb.MOUSE_MOVE,e)})),uP.on(Vb.MOUSE_UP,(e=>{this.emit(jb.MOUSE_UP,e)})),uP.on(Vb.MOUSE_WHEEL,(e=>{this.emit(jb.MOUSE_WHEEL,e)})),uP.on(Vb.TOUCH_START,(e=>{this.emit(jb.TOUCH_START,e.touch,e)})),uP.on(Vb.TOUCH_MOVE,(e=>{this.emit(jb.TOUCH_MOVE,e.touch,e)})),uP.on(Vb.TOUCH_END,(e=>{this.emit(jb.TOUCH_END,e.touch,e)})),uP.on(Vb.TOUCH_CANCEL,(e=>{this.emit(jb.TOUCH_CANCEL,e.touch,e)})),uP.on(Vb.KEY_DOWN,(e=>{this.emit(jb.KEY_DOWN,e)})),uP.on(Vb.KEY_PRESSING,(e=>{this.emit(jb.KEY_DOWN,e)})),uP.on(Vb.KEY_UP,(e=>{this.emit(jb.KEY_UP,e)})),uP.on(Vb.DEVICEMOTION,(e=>{this.emit(jb.DEVICEMOTION,e)}))}setAccelerometerEnabled(e){uP.setAccelerometerEnabled(e)}setAccelerometerInterval(e){uP.setAccelerometerInterval(e)}on(e,t,n,i){return super.on(e,t,n,i),t}off(e,t,n){super.off(e,t,n)}}e("gQ",hP),hP.EventType=jb,c.SystemEvent=hP;const fP=e("gP",new hP);var pP;c.systemEvent=fP,Pn(jb,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]),Pn(VT,"Event",[{name:"ACCELERATION",newName:"DEVICEMOTION",target:hP.EventType,targetName:"SystemEvent.EventType"}]),In(VT,"Event",[{name:"TOUCH",suggest:"please use SystemEvent.EventType.TOUCH_START, SystemEvent.EventType.TOUCH_MOVE, SystemEvent.EventType.TOUCH_END and SystemEvent.EventType.TOUCH_CANCEL instead"},{name:"MOUSE",suggest:"please use SystemEvent.EventType.MOUSE_DOWN, SystemEvent.EventType.MOUSE_MOVE, SystemEvent.EventType.MOUSE_UP, SystemEvent.EventType.MOUSE_WHEEL, Node.EventType.MOUSE_ENTER and Node.EventType.MOUSE_LEAVE instead"},{name:"KEYBOARD",suggest:"please use SystemEvent.EventType.KEY_DOWN and SystemEvent.EventType.KEY_UP instead"}]),Pn(qT,"EventMouse",["DOWN","UP","MOVE"].map((e=>({name:e,newName:`MOUSE_${e}`,target:hP.EventType,targetName:"SystemEvent.EventType"})))),Pn(qT,"EventMouse",[{name:"SCROLL",newName:"MOUSE_WHEEL",target:hP.EventType,targetName:"SystemEvent.EventType"}]),In(qT.prototype,"EventMouse.prototype",[{name:"eventType",suggest:"please use EventMouse.prototype.type instead"}]),Pn(XT,"EventTouch",[{name:"BEGAN",newName:"TOUCH_START",target:hP.EventType,targetName:"SystemEvent.EventType"}]),Pn(XT,"EventTouch",[{name:"MOVED",newName:"TOUCH_MOVE",target:hP.EventType,targetName:"SystemEvent.EventType"}]),Pn(XT,"EventTouch",[{name:"ENDED",newName:"TOUCH_END",target:hP.EventType,targetName:"SystemEvent.EventType"}]),Pn(XT,"EventTouch",[{name:"CANCELLED",newName:"TOUCH_CANCEL",target:hP.EventType,targetName:"SystemEvent.EventType"}]),In(XT.prototype,"EventTouch.prototype",[{name:"getEventCode",suggest:"please use EventTouch.prototype.type instead"}]),Pn(XT.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:XT,targetName:"EventTouch"}]),In(He.KEY,"macro.KEY",["back","menu","0","1","2","3","4","5","6","7","8","9","0","*","+","-","/",";","=",",",".","[","]","dpadLeft","dpadRight","dpadUp","dpadDown","dpadCenter"].map((e=>({name:e})))),In(He.KEY,"macro.KEY",[{name:"shift",suggest:"please use KeyCode.SHIFT_LEFT instead"}]),In(He.KEY,"macro.KEY",[{name:"ctrl",suggest:"please use KeyCode.CTRL_LEFT instead"}]),In(He.KEY,"macro.KEY",[{name:"alt",suggest:"please use KeyCode.ALT_LEFT instead"}]),In(He,"macro",[{name:"KEY",suggest:"please use KeyCode instead"}]),Pn(cx.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter(){return this.children.length}}]),Pn(Ox.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter(){return this._uiProps.uiTransformComp.width},customSetter(e){this._uiProps.uiTransformComp.width=e}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter(){return this._uiProps.uiTransformComp.height},customSetter(e){this._uiProps.uiTransformComp.height=e}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter(){return this._uiProps.uiTransformComp.anchorX},customSetter(e){this._uiProps.uiTransformComp.anchorX=e}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter(){return this._uiProps.uiTransformComp.anchorY},customSetter(e){this._uiProps.uiTransformComp.anchorY=e}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction(e){return e||(e=new Ii),e.set(this._uiProps.uiTransformComp.anchorPoint),e}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction(e,t){this._uiProps.uiTransformComp.setAnchorPoint(e,t)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction(e){return e||(e=new Li),e.set(this._uiProps.uiTransformComp.contentSize),e}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction(e,t){"number"==typeof e?this._uiProps.uiTransformComp.setContentSize(e,t):this._uiProps.uiTransformComp.setContentSize(e)}}]),wn(jT.prototype,"SceneGlobals.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"}]),wn(Ox.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),Pn(qg.prototype,"NodeUIProperties",[{name:"opacityDirty",newName:"colorDirty"}]),wn(Jf,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),Pn(Jf,"Layers",[{name:"Default",newName:"DEFAULT",target:Jf.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:Jf.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:Jf.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:Jf.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:Jf.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:Jf.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:Jf.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:Jf.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:Jf,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:Jf,targetName:"Layers"}]),wn(Jf.Enum,"Layers.Enum",[{name:"ALWAYS"}]),wn(Jf.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);const dP=Lt.Flags.HideInHierarchy,mP=Lt.Flags.DontSave;let AP=e("gj",Uc("cc.PrivateNode")(pP=class extends Ox{constructor(e){super(e),w(12003,this.name),this.hideFlags|=mP|dP}})||pP);var vP,gP,xP,yP;Pn(jb,"SystemEventType",["MOUSE_ENTER","MOUSE_LEAVE","TRANSFORM_CHANGED","SCENE_CHANGED_FOR_PERSISTS","SIZE_CHANGED","ANCHOR_CHANGED","COLOR_CHANGED","CHILD_ADDED","CHILD_REMOVED","PARENT_CHANGED","NODE_DESTROYED","LAYER_CHANGED","SIBLING_ORDER_CHANGED"].map((e=>({name:e,target:Ox.EventType,targetName:"Node.EventType"})))),Pn(Ox.EventType,"Node.EventType",[{name:"DEVICEMOTION",target:hP.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_DOWN",target:hP.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_UP",target:hP.EventType,targetName:"SystemEvent.EventType"}]),c.PrivateNode=AP;let bP=e("dP",Uc("cc.Scene")((Pc((gP=class extends cx{get renderScene(){return this._renderScene}get globals(){return this._globals}_updateScene(){this._scene=this}get native(){return this._nativeObj}_init(){this._nativeObj=new ji}constructor(e){super(e),Tc(this,"autoReleaseAssets",xP,this),Tc(this,"_globals",yP,this),this.dependAssets=null,this._renderScene=null,this._inited=void 0,this._prefabSyncedInLiveReload=!1,this._pos=_i.ZERO,this._rot=Ai.IDENTITY,this._scale=_i.ONE,this._mat=Ei.IDENTITY,this._dirtyFlags=0,this._lpos=_i.ZERO,this._lrot=Ai.IDENTITY,this._lscale=_i.ONE,this._activeInHierarchy=!1,c.director&&c.director.root&&(this._renderScene=c.director.root.createScene({})),this._inited=!c.game||!c.game._isCloning,this._init()}destroy(){const e=Lt.prototype.destroy.call(this);if(e){const e=this._children;for(let t=0;t<e.length;++t)e[t].active=!1}return this._renderScene&&c.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,e}addComponent(){throw new Error(M(3822))}_onHierarchyChanged(){}_onBatchCreated(e){super._onBatchCreated(e);const t=this._children.length;for(let n=0;n<t;++n)this.children[n]._siblingIndex=n,this._children[n]._onBatchCreated(e)}getPosition(e){return _i.copy(e||new _i,_i.ZERO)}getRotation(e){return Ai.copy(e||new Ai,Ai.IDENTITY)}getScale(e){return _i.copy(e||new _i,_i.ONE)}getWorldPosition(e){return _i.copy(e||new _i,_i.ZERO)}getWorldRotation(e){return Ai.copy(e||new Ai,Ai.IDENTITY)}getWorldScale(e){return _i.copy(e||new _i,_i.ONE)}getWorldMatrix(e){return Ei.copy(e||new Ei,Ei.IDENTITY)}getWorldRS(e){return Ei.copy(e||new Ei,Ei.IDENTITY)}getWorldRT(e){return Ei.copy(e||new Ei,Ei.IDENTITY)}get position(){return _i.ZERO}get worldPosition(){return _i.ZERO}get rotation(){return Ai.IDENTITY}get worldRotation(){return Ai.IDENTITY}get scale(){return _i.ONE}get worldScale(){return _i.ONE}get eulerAngles(){return _i.ZERO}get worldMatrix(){return Ei.IDENTITY}updateWorldTransform(){}_instantiate(){}_load(){this._inited||(cb(this),rb(this),this._onBatchCreated(i),this._inited=!0),this.walk(cx._setScene)}_activate(e){e=!1!==e,c.director._nodeActivator.activateNode(this,e),this._globals.activate(),this._renderScene&&this._renderScene.activate()}}).prototype,"globals",[il],Object.getOwnPropertyDescriptor(gP.prototype,"globals"),gP.prototype),xP=Pc(gP.prototype,"autoReleaseAssets",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yP=Pc(gP.prototype,"_globals",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new jT}}),vP=gP))||vP);function SP(e,t){if(!t){const e=c.director.getScene();if(!e)return null;t=e}return t.getChildByPath(e)}c.Scene=bP,c.find=SP;const CP=De.fastRemoveAt,EP=Lt.Flags.IsStartCalled,TP=Lt.Flags.IsOnEnableCalled;function PP(e,t){const n=t.constructor._executionOrder,i=t._id;let o=0;for(let t=e.length-1,a=t>>>1;o<=t;a=o+t>>>1){const r=e[a],s=r.constructor._executionOrder;if(s>n)t=a-1;else if(s<n)o=a+1;else{const e=r._id;if(e>i)t=a-1;else{if(!(e<i))return a;o=a+1}}}return~o}function wP(e,t){const n=e.array;let i=e.i+1;for(;i<n.length;){const o=n[i];o.node._activeInHierarchy?++i:(e.removeAt(i),t&&(o._objFlags&=~t))}}Lt.Flags.IsEditorOnEnableCalled;class IP{constructor(e){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;const t=B;this._zero=new t([]),this._neg=new t([]),this._pos=new t([]),this._invoke=e}}function RP(e,t){return e.constructor._executionOrder-t.constructor._executionOrder}IP.stableRemoveInactive=wP;class DP extends IP{add(e){const t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).array.push(e)}remove(e){const t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).fastRemove(e)}cancelInactive(e){wP(this._zero,e),wP(this._neg,e),wP(this._pos,e)}invoke(){const e=this._neg;e.array.length>0&&(e.array.sort(RP),this._invoke(e),e.array.length=0),this._invoke(this._zero),this._zero.array.length=0;const t=this._pos;t.array.length>0&&(t.array.sort(RP),this._invoke(t),t.array.length=0)}}class NP extends IP{add(e){const t=e.constructor._executionOrder;if(0===t)this._zero.array.push(e);else{const n=t<0?this._neg.array:this._pos.array,i=PP(n,e);i<0&&n.splice(~i,0,e)}}remove(e){const t=e.constructor._executionOrder;if(0===t)this._zero.fastRemove(e);else{const n=t<0?this._neg:this._pos,i=PP(n.array,e);i>=0&&n.removeAt(i)}}invoke(e){this._neg.array.length>0&&this._invoke(this._neg,e),this._invoke(this._zero,e),this._pos.array.length>0&&this._invoke(this._pos,e)}}function OP(e,t,n){const i=`var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];${e}}`,o=t?Function("it","dt",i):Function("it",i);return function(e,t,n){return(i,o)=>{try{t(i,o)}catch(t){c._throw(t);const a=i.array;for(n&&(a[i.i]._objFlags|=n),++i.i;i.i<a.length;++i.i)try{e(a[i.i],o)}catch(e){c._throw(e),n&&(a[i.i]._objFlags|=n)}}}}(Function("c","dt",e),o,n)}const MP=OP(`c.start();c._objFlags|=${EP}`,!1,EP),zP=OP("c.update(dt)",!0),LP=OP("c.lateUpdate(dt)",!0),FP=e=>{const t=c.director._compScheduler,n=e.array;for(e.i=0;e.i<n.length;++e.i){const i=n[e.i];i._enabled&&(i.onEnable(),!i.node._activeInHierarchy||t._onEnabled(i))}};class BP{constructor(){this._deferredComps=[],this.unscheduleAll()}unscheduleAll(){this.startInvoker=new DP(MP),this.updateInvoker=new NP(zP),this.lateUpdateInvoker=new NP(LP),this._updating=!1}_onEnabled(e){c.director.getScheduler().resumeTarget(e),e._objFlags|=TP,this._updating?this._deferredComps.push(e):this._scheduleImmediate(e)}_onDisabled(e){c.director.getScheduler().pauseTarget(e),e._objFlags&=~TP;const t=this._deferredComps.indexOf(e);t>=0?CP(this._deferredComps,t):(!e.start||e._objFlags&EP||this.startInvoker.remove(e),e.update&&this.updateInvoker.remove(e),e.lateUpdate&&this.lateUpdateInvoker.remove(e))}enableComp(e,t){if(!(e._objFlags&TP)){if(e.onEnable){if(t)return void t.add(e);if(e.onEnable(),!e.node._activeInHierarchy)return}this._onEnabled(e)}}disableComp(e){e._objFlags&TP&&(e.onDisable&&e.onDisable(),this._onDisabled(e))}startPhase(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()}updatePhase(e){this.updateInvoker.invoke(e)}lateUpdatePhase(e){this.lateUpdateInvoker.invoke(e),this._updating=!1,this._startForNewComps()}_startForNewComps(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())}_scheduleImmediate(e){"function"!=typeof e.start||e._objFlags&EP||this.startInvoker.add(e),"function"==typeof e.update&&this.updateInvoker.add(e),"function"==typeof e.lateUpdate&&this.lateUpdateInvoker.add(e)}_deferredSchedule(){const e=this._deferredComps;for(let t=0,n=e.length;t<n;t++)this._scheduleImmediate(e[t]);e.length=0}}const kP=Lt.Flags.IsPreloadStarted,UP=Lt.Flags.IsOnLoadStarted,GP=Lt.Flags.IsOnLoadCalled,jP=Lt.Flags.Deactivating;class VP extends IP{add(e){this._zero.array.push(e)}remove(e){this._zero.fastRemove(e)}cancelInactive(e){IP.stableRemoveInactive(this._zero,e)}invoke(){this._invoke(this._zero),this._zero.array.length=0}}const HP=OP("c.__preload();"),WP=OP(`c.onLoad();c._objFlags|=${GP}`,!1,GP),qP=new Re(4);function YP(e,t,n){R(3817,e.name,n),console.log("Corrupted component value:",t),t?e._removeComponent(t):De.removeAt(e._components,n)}qP.get=function(){const e=this._get()||{preload:new VP(HP),onLoad:new DP(WP),onEnable:new DP(FP)};e.preload._zero.i=-1;let t=e.onLoad;return t._zero.i=-1,t._neg.i=-1,t._pos.i=-1,t=e.onEnable,t._zero.i=-1,t._neg.i=-1,t._pos.i=-1,e};class XP{constructor(){this.resetComp=void 0,this.reset()}reset(){this._activatingStack=[]}activateNode(e,t){if(t){const t=qP.get();this._activatingStack.push(t),this._activateNodeRecursively(e,t.preload,t.onLoad,t.onEnable),t.preload.invoke(),t.onLoad.invoke(),t.onEnable.invoke(),this._activatingStack.pop(),qP.put(t)}else{this._deactivateNodeRecursively(e);const t=this._activatingStack;for(const e of t)e.preload.cancelInactive(kP),e.onLoad.cancelInactive(UP),e.onEnable.cancelInactive()}e.emit(Yg.ACTIVE_IN_HIERARCHY_CHANGED,e)}activateComp(e,t,n,i){if(Bt(e,!0)&&(e._objFlags&kP||(e._objFlags|=kP,e.__preload&&(t?t.add(e):e.__preload())),e._objFlags&UP||(e._objFlags|=UP,e.onLoad?n?n.add(e):(e.onLoad(),e._objFlags|=GP):e._objFlags|=GP),e._enabled)){if(!e.node._activeInHierarchy)return;c.director._compScheduler.enableComp(e,i)}}destroyComp(e){c.director._compScheduler.disableComp(e),e.onDestroy&&e._objFlags&GP&&e.onDestroy()}_activateNodeRecursively(e,t,n,i){if(e._objFlags&jP)return void R(3816,e.name);e._activeInHierarchy=!0;let o=e._components.length;for(let a=0;a<o;++a){const r=e._components[a];r instanceof c.Component?this.activateComp(r,t,n,i):(YP(e,r,a),--a,--o)}for(let o=0,a=e._children.length;o<a;++o){const a=e._children[o];a._active&&this._activateNodeRecursively(a,t,n,i)}e._onPostActivated(!0)}_deactivateNodeRecursively(e){e._objFlags|=jP,e._activeInHierarchy=!1;const t=e._components.length;for(let n=0;n<t;++n){const t=e._components[n];if(t._enabled&&(c.director._compScheduler.disableComp(t),e._activeInHierarchy))return void(e._objFlags&=~jP)}for(let t=0,n=e._children.length;t<n;++t){const n=e._children[t];if(n._activeInHierarchy&&(this._deactivateNodeRecursively(n),e._activeInHierarchy))return void(e._objFlags&=~jP)}e._onPostActivated(!1),e._objFlags&=~jP}}var QP,ZP,JP;e("gi",XP);let KP=e("fJ",Uc("cc.SceneAsset")((JP=Pc((ZP=class extends __{constructor(...e){super(...e),Tc(this,"scene",JP,this)}initDefault(e){super.initDefault(e),this.scene=new bP("New Scene")}validate(){return!!this.scene}}).prototype,"scene",[il,qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QP=ZP))||QP);var $P,ew,tw;c.SceneAsset=KP;let nw=e("e$",Uc("cc.TextAsset")((tw=Pc((ew=class extends __{constructor(...e){super(...e),Tc(this,"text",tw,this)}toString(){return this.text}}).prototype,"text",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$P=ew))||$P);var iw,ow,aw;c.TextAsset=nw;let rw,sw=e("fK",Uc("cc.JsonAsset")((aw=Pc((ow=class extends __{constructor(...e){super(...e),Tc(this,"json",aw,this)}}).prototype,"json",[qc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iw=ow))||iw);c.JsonAsset=sw;class cw{_init(){this._nativeObj=new co,this._nativeObj.fog=this.fog.native,this._nativeObj.ambient=this.ambient.native,this._nativeObj.skybox=this.skybox.native,this._nativeObj.shadow=this.shadows.native,this._nativeObj.octree=this.octree.native}get native(){return this._nativeObj}get isHDR(){return this._isHDR}set isHDR(e){this._isHDR=e,this._nativeObj.isHDR=e}get shadingScale(){return this._shadingScale}set shadingScale(e){this._shadingScale!==e&&(this._shadingScale=e,this._nativeObj.shadingScale=e,this._pipeline.emit(pg.ATTACHMENT_SCALE_CAHNGED,e))}constructor(){this.fog=new eS,this.ambient=new _o,this.skybox=new VA,this.shadows=new IA,this.octree=new uo,this.validPunctualLights=[],this.renderObjects=[],this.castShadowObjects=[],this.dirShadowObjects=[],this.shadowFrameBufferMap=new Map,this._occlusionQueryVertexBuffer=null,this._occlusionQueryIndicesBuffer=null,this._occlusionQueryInputAssembler=null,this._occlusionQueryMaterial=null,this._occlusionQueryShader=null,this._isHDR=!0,this._shadingScale=1,this._init(),this.shadingScale=1}activate(e,t){return this._device=e,this._pipeline=t,this.initOcclusionQuery(),!0}initOcclusionQuery(){if(this._occlusionQueryInputAssembler||(this._occlusionQueryInputAssembler=this._createOcclusionQueryIA(),this._nativeObj.occlusionQueryInputAssembler=this._occlusionQueryInputAssembler),!this._occlusionQueryMaterial){const e=new CA;e._uuid="default-occlusion-query-material",e.initialize({effectName:"occlusion-query"}),this._occlusionQueryMaterial=e,this._occlusionQueryShader=e.passes[0].getShaderVariant(),this._nativeObj.occlusionQueryPass=this._occlusionQueryMaterial.passes[0].native,this._nativeObj.occlusionQueryShader=this._occlusionQueryShader}}getOcclusionQueryPass(){return this._occlusionQueryMaterial.passes[0]}onGlobalPipelineStateChanged(){}destroy(){var e,t,n;this.ambient.destroy(),this.skybox.destroy(),this.fog.destroy(),this.shadows.destroy(),this.octree.destroy(),this.validPunctualLights.length=0,null===(e=this._occlusionQueryInputAssembler)||void 0===e||e.destroy(),this._occlusionQueryInputAssembler=null,null===(t=this._occlusionQueryVertexBuffer)||void 0===t||t.destroy(),this._occlusionQueryVertexBuffer=null,null===(n=this._occlusionQueryIndicesBuffer)||void 0===n||n.destroy(),this._occlusionQueryIndicesBuffer=null,this._nativeObj=null}_createOcclusionQueryIA(){const e=this._device,t=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1]),n=3*Float32Array.BYTES_PER_ELEMENT,i=8*n;this._occlusionQueryVertexBuffer=e.createBuffer(new ka(Ho.VERTEX|Ho.TRANSFER_DST,Yo.DEVICE,i,n)),this._occlusionQueryVertexBuffer.update(t);const o=new Uint16Array([0,2,1,1,2,3,4,5,6,5,7,6,1,3,7,1,7,5,0,4,6,0,6,2,0,1,5,0,5,4,2,6,7,2,7,3]),a=Uint16Array.BYTES_PER_ELEMENT,r=36*a;this._occlusionQueryIndicesBuffer=e.createBuffer(new ka(Ho.INDEX|Ho.TRANSFER_DST,Yo.DEVICE,r,a)),this._occlusionQueryIndicesBuffer.update(o);const s=[new ir("a_position",Go.RGB32F)],c=new ar(s,[this._occlusionQueryVertexBuffer],this._occlusionQueryIndicesBuffer);return e.createInputAssembler(c)}}!function(e){e[e.NONE=0]="NONE",e[e.FXAA=1]="FXAA"}(rw||(rw={}));class lw extends cw{constructor(...e){super(...e),this._antiAliasing=rw.NONE}set antiAliasing(e){if(this._antiAliasing=e,this._postprocessMaterial){const t=this._postprocessMaterial.passes[0].defines;Object.assign(t,{ANTIALIAS_TYPE:e});const n=new CA;n.initialize({effectAsset:this._postprocessMaterial.effectAsset,defines:t});for(let e=0;e<n.passes.length;++e)n.passes[e].tryCompile();this._postprocessMaterial=n}}get antiAliasing(){return this._antiAliasing}get bloomMaterial(){return this._bloomMaterial}set bloomMaterial(e){this._bloomMaterial!==e&&e&&(this._bloomMaterial=e,this.updatePipelinePassInfo())}get postprocessMaterial(){return this._postprocessMaterial}set postprocessMaterial(e){this._postprocessMaterial!==e&&e&&(this._postprocessMaterial=e,this.updatePipelinePassInfo())}onGlobalPipelineStateChanged(){this.updatePipelinePassInfo()}updateBloomPass(){if(!this._bloomMaterial)return;const e=this._bloomMaterial.passes[0];e.beginChangeStatesSilently(),e.tryCompile(),e.endChangeStatesSilently();const t=[],n=[];for(let e=0;e<6;++e){const i=this._bloomMaterial.passes[1+e];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently();const o=this._bloomMaterial.passes[7+e];o.beginChangeStatesSilently(),o.tryCompile(),o.endChangeStatesSilently(),t.push(i.native),n.push(o.native)}const i=this._bloomMaterial.passes[13];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently(),this._nativeObj.bloomPrefilterPassShader=e.getShaderVariant(),this._nativeObj.bloomPrefilterPass=e.native,this._nativeObj.bloomDownsamplePassShader=this._bloomMaterial.passes[1].getShaderVariant(),this._nativeObj.bloomDownsamplePass=t,this._nativeObj.bloomUpsamplePassShader=this._bloomMaterial.passes[7].getShaderVariant(),this._nativeObj.bloomUpsamplePass=n,this._nativeObj.bloomCombinePassShader=i.getShaderVariant(),this._nativeObj.bloomCombinePass=i.native}updatePostProcessPass(){if(!this.postprocessMaterial)return;const e=this.postprocessMaterial.passes[0];e.beginChangeStatesSilently(),e.tryCompile(),e.endChangeStatesSilently(),this._nativeObj.pipelinePostPassShader=e.getShaderVariant(),this._nativeObj.pipelinePostPass=e.native}initPipelinePassInfo(){const e=new CA;e._uuid="builtin-deferred-material",e.initialize({effectName:"deferred-lighting"});for(let t=0;t<e.passes.length;++t)e.passes[t].tryCompile();this._deferredLightingMaterial=e;const t=new CA;t._uuid="builtin-bloom-material",t.initialize({effectName:"bloom"});for(let e=0;e<t.passes.length;++e)t.passes[e].tryCompile();this._bloomMaterial=t;const n=new CA;n._uuid="builtin-post-process-material",He.ENABLE_ANTIALIAS_FXAA&&(this._antiAliasing=rw.FXAA),n.initialize({effectName:"post-process",defines:{ANTIALIAS_TYPE:this._antiAliasing}});for(let e=0;e<n.passes.length;++e)n.passes[e].tryCompile();this._postprocessMaterial=n,this.updatePipelinePassInfo()}get deferredLightingMaterial(){return this._deferredLightingMaterial}set deferredLightingMaterial(e){this._deferredLightingMaterial!==e&&e&&(this._deferredLightingMaterial=e,this.updatePipelinePassInfo())}updatePipelinePassInfo(){this.updateBloomPass(),this.updatePostProcessPass(),this.updateDeferredPassInfo()}activate(e,t){return super.activate(e,t),this.initPipelinePassInfo(),!0}updateDeferredPassInfo(){this.updateDeferredLightPass()}updateDeferredLightPass(){if(!this._deferredLightingMaterial)return;this.shadows.enabled&&(this._pipeline.macros.CC_RECEIVE_SHADOW=1);const e=this._deferredLightingMaterial.passes[0];e.beginChangeStatesSilently(),e.tryCompile(),e.endChangeStatesSilently(),this._nativeObj.deferredLightPassShader=e.getShaderVariant(),this._nativeObj.deferredLightPass=e.native}}nr.getPhaseID=km;const _w=e("fU",nr.RenderPipeline),uw=(e("fV",nr.RenderFlow),e("fW",nr.RenderStage),e("fX",nr.InstancedBuffer),e("fY",nr.PipelineStateManager));nr.InstancedBuffer.get;let hw=nr.PipelineStateManager.getOrCreatePipelineState;function fw(){const e=new pw;return e.init(),e}nr.PipelineStateManager.getOrCreatePipelineState=function(e,t,n,i,o){return hw.call(e,t.native,n,i,o)};class pw extends nr.ForwardPipeline{constructor(){super(),this.pipelineSceneData=new cw,this._tag=0,this._flows=[],this.renderTextures=[],this.materials=[]}on(e,t,n,i){}once(e,t,n){}off(e,t,n){}emit(e,t,n,i,o,a){}targetOff(e){}removeAll(e){}hasEventListener(e,t,n){return!1}init(){this.setPipelineSharedSceneData(this.pipelineSceneData.native);for(let e=0;e<this._flows.length;e++)this._flows[e].init(this);const e=new nr.RenderPipelineInfo(this._tag,this._flows);this.initialize(e)}activate(e){return super.activate(e)&&this.pipelineSceneData.activate(c.director.root.device,this)}render(e){let t=[];for(let n=0,i=e.length;n<i;++n)t.push(e[n].native);super.render(t)}set profiler(e){this.setProfiler(e&&e.native)}destroy(){this.pipelineSceneData.destroy(),super.destroy()}}e("f_",pw),he(pw.prototype,__.prototype);const dw=pw.prototype.onLoaded;pw.prototype.onLoaded=function(){dw&&dw.call(this),this.init()};class mw extends nr.ForwardFlow{constructor(){super(),this._name=0,this._priority=0,this._tag=0,this._stages=[]}init(e){for(let t=0;t<this._stages.length;t++)this._stages[t].init(e);const t=new nr.RenderFlowInfo(this._name,this._priority,this._tag,this._stages);this.initialize(t)}}e("f$",mw);class Aw extends nr.ShadowFlow{constructor(){super(),this._name=0,this._priority=0,this._tag=0,this._stages=[]}init(e){for(let t=0;t<this._stages.length;t++)this._stages[t].init(e);const t=new nr.RenderFlowInfo(this._name,this._priority,this._tag,this._stages);this.initialize(t)}}e("g0",Aw);class vw extends nr.ForwardStage{constructor(){super(),this._name=0,this._priority=0,this._tag=0,this.renderQueues=[]}init(e){const t=[];for(let e=0;e<this.renderQueues.length;e++)t.push(this.renderQueues[e].init());const n=new nr.RenderStageInfo(this._name,this._priority,this._tag,t);this.initialize(n)}}e("g1",vw);class gw extends nr.ShadowStage{constructor(){super(),this._name=0,this._priority=0,this._tag=0}init(e){const t=new nr.RenderStageInfo(this._name,this._priority,this._tag,[]);this.initialize(t)}}e("g2",gw);class xw{constructor(){this.isTransparent=!1,this.sortMode=0,this.stages=[],this.isTransparent=!1,this.sortMode=0,this.stages=[]}init(){return new nr.RenderQueueDesc(this.isTransparent,this.sortMode,this.stages)}}e("g3",xw);class yw extends nr.DeferredPipeline{constructor(){super(),this.pipelineSceneData=new lw,this._tag=0,this._flows=[],this.renderTextures=[],this.materials=[]}on(e,t,n,i){}once(e,t,n){}off(e,t,n){}emit(e,t,n,i,o,a){}targetOff(e){}removeAll(e){}hasEventListener(e,t,n){return!1}init(){this.setPipelineSharedSceneData(this.pipelineSceneData.native);for(let e=0;e<this._flows.length;e++)this._flows[e].init(this);let e=new nr.RenderPipelineInfo(this._tag,this._flows);this.initialize(e)}activate(e){return super.activate(e)&&this.pipelineSceneData.activate(c.director.root.device,this)}render(e){let t=[];for(let n=0,i=e.length;n<i;++n)t.push(e[n].native);super.render(t)}set profiler(e){this.setProfiler(e&&e.native)}destroy(){this.fog.destroy(),this.ambient.destroy(),this.skybox.destroy(),this.shadows.destroy(),this.pipelineSceneData.destroy(),super.destroy()}}e("g4",yw),he(yw.prototype,__.prototype);const bw=yw.prototype.onLoaded;yw.prototype.onLoaded=function(){bw&&bw.call(this),this.init()};class Sw extends nr.MainFlow{constructor(){super(),this._name=0,this._priority=0,this._tag=0,this._stages=[]}init(e){for(let t=0;t<this._stages.length;t++)this._stages[t].init(e);let t=new nr.RenderFlowInfo(this._name,this._priority,this._tag,this._stages);this.initialize(t)}}e("g5",Sw);class Cw extends nr.GbufferStage{constructor(){super(),this._name=0,this._priority=0,this._tag=0,this.renderQueues=[]}init(e){const t=[];for(let e=0;e<this.renderQueues.length;e++)t.push(this.renderQueues[e].init());let n=new nr.RenderStageInfo(this._name,this._priority,this._tag,t);this.initialize(n)}}e("g6",Cw);class Ew extends nr.LightingStage{constructor(){super(),this._name=0,this._priority=0,this._tag=0,this.renderQueues=[],this._deferredMaterial=null}init(e){const t=[];for(let e=0;e<this.renderQueues.length;e++)t.push(this.renderQueues[e].init());e.pipelineSceneData.deferredLightingMaterial=this._deferredMaterial;let n=new nr.RenderStageInfo(this._name,this._priority,this._tag,t);this.initialize(n)}}e("g7",Ew);class Tw extends nr.BloomStage{constructor(){super(),this._name=0,this._priority=0,this._tag=0,this.renderQueues=[],this._bloomMaterial=null}init(e){const t=[];for(let e=0;e<this.renderQueues.length;e++)t.push(this.renderQueues[e].init());e.pipelineSceneData.bloomMaterial=this._bloomMaterial;let n=new nr.RenderStageInfo(this._name,this._priority,this._tag,t);this.initialize(n)}}e("g8",Tw);class Pw extends nr.PostProcessStage{constructor(){super(),this._name=0,this._priority=0,this._tag=0,this.renderQueues=[],this._postProcessMaterial=null}init(e){const t=[];for(let e=0;e<this.renderQueues.length;e++)t.push(this.renderQueues[e].init());e.pipelineSceneData.postprocessMaterial=this._postProcessMaterial;let n=new nr.RenderStageInfo(this._name,this._priority,this._tag,t);this.initialize(n)}}e("g9",Pw),Ce("DeferredPipeline",yw),Ce("MainFlow",Sw),Ce("GbufferStage",Cw),Ce("LightingStage",Ew),Ce("BloomStage",Tw),Ce("PostProcessStage",Pw),Ce("ForwardPipeline",pw),Ce("ForwardFlow",mw),Ce("ShadowFlow",Aw),Ce("ForwardStage",vw),Ce("ShadowStage",gw),Ce("RenderQueueDesc",xw);const ww=new Ii;class Iw{set splashFinish(e){this._splashFinish=e,this._tryToStart()}set loadFinish(e){this._loadFinish=e,this._tryToStart()}pauseRendering(){this.isPause=!0}resumeRendering(){this.isPause=!1}main(e){if(null!=e){if(window._CCSettings&&window._CCSettings.splashScreen){const e=this.settings=window._CCSettings.splashScreen;e.totalTime=null!=this.settings.totalTime?this.settings.totalTime:3e3,e.base64src=this.settings.base64src||"",e.effect=this.settings.effect||"FADE-INOUT",e.clearColor=this.settings.clearColor||new za(.88,.88,.88,1),e.displayRatio=null!=this.settings.displayRatio?this.settings.displayRatio:.4,e.displayWatermark=null==this.settings.displayWatermark||this.settings.displayWatermark}else this.settings={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new za(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.settings.base64src||this.settings.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.settings=null,this._directCall=!0;else{c.view.resizeWithBrowserSize(!0);const t=window._CCSettings.designResolution;t?c.view.setDesignResolutionSize(t.width,t.height,t.policy):c.view.setDesignResolutionSize(960,640,4),this.device=e.device,this.swapchain=e.mainWindow.swapchain,this.framebuffer=e.mainWindow.framebuffer,c.game.once(c.Game.EVENT_GAME_INITED,(()=>{c.director._lateUpdate=performance.now()}),c.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.preInit(),this.logoImage=new Image,this.logoImage.onload=this.init.bind(this),this.logoImage.src=this.settings.base64src}}else g("RENDER ROOT IS NULL.")}setOnFinish(e){if(this._directCall&&e)return Iw._ins=void 0,void e();this.callBack=e}_tryToStart(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),c.game.resume())}preInit(){const e=this.settings.clearColor;this.clearColors=[new za(e.x,e.y,e.z,e.w)];const{device:t,swapchain:n}=this;this.renderArea=new Pa(0,0,n.width,n.height),this.cmdBuff=t.commandBuffer;const i=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),o=4*Float32Array.BYTES_PER_ELEMENT,a=4*o;this.vertexBuffers=t.createBuffer(new ka(Ho.VERTEX|Ho.TRANSFER_DST,Yo.DEVICE,a,o)),this.vertexBuffers.update(i);const r=new Uint16Array([0,1,2,1,3,2]),s=Uint16Array.BYTES_PER_ELEMENT,c=6*s;this.indicesBuffers=t.createBuffer(new ka(Ho.INDEX|Ho.TRANSFER_DST,Yo.DEVICE,c,s)),this.indicesBuffers.update(r);const l=[new ir("a_position",Go.RG32F),new ir("a_texCoord",Go.RG32F)],_=new ar(l,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=t.createInputAssembler(_),this.projection=new Ei,Ei.ortho(this.projection,-1,1,-1,1,-1,1,t.capabilities.clipSpaceMinZ,t.capabilities.clipSpaceSignY,n.surfaceTransform)}init(){this.initLogo(),this.settings.displayWatermark&&this.initWarterMark();const e=t=>{if(this.cancelAnimate)return;const n=this.settings,{device:i,swapchain:o}=this;Ei.ortho(this.projection,-1,1,-1,1,-1,1,i.capabilities.clipSpaceMinZ,i.capabilities.clipSpaceSignY,o.surfaceTransform);const a=o.width,r=o.height,s=a<r?a:r;this.startTime<0&&(this.startTime=t);const c=t-this.startTime;let l=Vu(jn(c/n.totalTime));"NONE"===n.effect&&(l=1);const _=this.logoTexture.width,u=this.logoTexture.height,h=s*n.displayRatio;let f=h*_/u,p=h;if(o.surfaceTransform!==ko.ROTATE_90&&o.surfaceTransform!==ko.ROTATE_270||(f=h*a/r,p=h*u/_*r/a),this.logoMat.setProperty("resolution",ww.set(a,r),0),this.logoMat.setProperty("scale",ww.set(f,p),0),this.logoMat.setProperty("translate",ww.set(.5*a,.5*r),0),this.logoMat.setProperty("percent",l),this.logoMat.setProperty("u_projection",this.projection),this.logoMat.passes[0].update(),n.displayWatermark&&this.watermarkMat){const e=.5*s,t=this.watermarkTexture.width;let n=e,i=e*this.watermarkTexture.height/t;o.surfaceTransform!==ko.ROTATE_90&&o.surfaceTransform!==ko.ROTATE_270||(n=.5*e,i=e*a/r*.5),this.watermarkMat.setProperty("resolution",ww.set(a,r),0),this.watermarkMat.setProperty("scale",ww.set(n,i),0),this.watermarkMat.setProperty("translate",ww.set(.5*a,.1*r),0),this.watermarkMat.setProperty("percent",l),this.watermarkMat.setProperty("u_projection",this.projection),this.watermarkMat.passes[0].update()}this.isPause||(this.frame(),c>n.totalTime&&(this.splashFinish=!0)),requestAnimationFrame(e)};c.game.pause(),this.handle=requestAnimationFrame(e)}hide(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))}initLogo(){const e=this.device;this.logoMat=new CA,this.logoMat.initialize({effectName:"splash-screen"});const t=new qa;t.addressU=ea.CLAMP,t.addressV=ea.CLAMP,t.addressW=ea.CLAMP,this.sampler=e.getSampler(t),this.logoTexture=e.createTexture(new Ha(Xo.TEX2D,Qo.SAMPLED|Qo.TRANSFER_DST,Go.RGBA8,this.logoImage.width,this.logoImage.height));const n=this.logoMat.passes[0],i=n.getBinding("mainTexture");n.bindTexture(i,this.logoTexture),this.shader=n.getShaderVariant();const o=n.descriptorSet;o.bindSampler(i,this.sampler),o.update();const a=new Oa;a.texExtent.width=this.logoImage.width,a.texExtent.height=this.logoImage.height,a.texExtent.depth=1,e.copyTexImagesToTexture([this.logoImage],this.logoTexture,[a])}initWarterMark(){const e=document.createElement("canvas");e.width=330,e.height=30,e.style.width=`${e.width}`,e.style.height=`${e.height}`;const t=e.getContext("2d");t.font="18px Arial",t.textBaseline="top",t.textAlign="left",t.fillStyle="`#424242`";const n="Powered by Cocos Creator",i=t.measureText(n);t.fillText(n,(330-i.width)/2,6);const o=new Oa;o.texExtent.width=e.width,o.texExtent.height=e.height,o.texExtent.depth=1,this.watermarkTexture=this.device.createTexture(new Ha(Xo.TEX2D,Qo.SAMPLED|Qo.TRANSFER_DST,Go.RGBA8,e.width,e.height)),this.device.copyTexImagesToTexture([e],this.watermarkTexture,[o]),this.watermarkMat=new CA,this.watermarkMat.initialize({effectName:"splash-screen"});const a=this.watermarkMat.passes[0],r=a.getBinding("mainTexture");a.bindTexture(r,this.watermarkTexture),a.descriptorSet.update()}frame(){const{device:e,swapchain:t}=this;e.acquire([t]);const n=this.cmdBuff,i=this.framebuffer,o=this.renderArea;o.width=t.width,o.height=t.height,n.begin(),n.beginRenderPass(i.renderPass,i,o,this.clearColors,1,0);const a=this.logoMat.passes[0],r=uw.getOrCreatePipelineState(e,a,this.shader,i.renderPass,this.quadAssmebler);if(n.bindPipelineState(r),n.bindDescriptorSet(cp.MATERIAL,a.descriptorSet),n.bindInputAssembler(this.quadAssmebler),n.draw(this.quadAssmebler),this.settings.displayWatermark&&this.watermarkMat){const t=this.watermarkMat.passes[0],o=uw.getOrCreatePipelineState(e,t,this.shader,i.renderPass,this.quadAssmebler);n.bindPipelineState(o),n.bindDescriptorSet(cp.MATERIAL,t.descriptorSet),n.bindInputAssembler(this.quadAssmebler),n.draw(this.quadAssmebler)}n.endRenderPass(),n.end(),e.flushCommands([n]),e.queue.submit([n]),e.present()}destroy(){this.callBack=null,this.device=null,this.swapchain=null,this.clearColors=null,this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null,this.framebuffer=null,this.renderArea=null,this.cmdBuff=null,this.shader=null,this.logoMat.destroy(),this.logoMat=null,this.logoTexture.destroy(),this.logoTexture=null,this.quadAssmebler.destroy(),this.quadAssmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler=null,this.watermarkTexture&&(this.watermarkMat.destroy(),this.watermarkMat=null,this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null,Iw._ins=void 0}static get instance(){return Iw._ins||(Iw._ins=new Iw),Iw._ins}constructor(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.isPause=!1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}}Iw._ins=void 0,c.internal.SplashScreen=Iw;class Rw{constructor(){this._id="",this._priority=0,this._executeInEditMode=!1}set priority(e){this._priority=e}get priority(){return this._priority}set id(e){this._id=e}get id(){return this._id}static sortByPriority(e,t){return e._priority<t._priority?1:e._priority>t.priority?-1:0}init(){}update(e){}postUpdate(e){}}e("eu",Rw),Rw.Priority=ke({LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:1<<31>>>0});const Dw=new W("Scheduler");class Nw{constructor(e,t,n,i){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=e,this.priority=t,this.paused=n,this.markedForDeletion=i}}Nw.get=(e,t,n,i)=>{let o=Nw._listEntries.pop();return o?(o.target=e,o.priority=t,o.paused=n,o.markedForDeletion=i):o=new Nw(e,t,n,i),o},Nw.put=e=>{Nw._listEntries.length<20&&(e.target=null,Nw._listEntries.push(e))},Nw._listEntries=[];class Ow{constructor(e,t,n,i){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=e,this.entry=t,this.target=n,this.callback=i}}Ow.get=(e,t,n,i)=>{let o=Ow._hashUpdateEntries.pop();return o?(o.list=e,o.entry=t,o.target=n,o.callback=i):o=new Ow(e,t,n,i),o},Ow.put=e=>{Ow._hashUpdateEntries.length<20&&(e.list=e.entry=e.target=e.callback=null,Ow._hashUpdateEntries.push(e))},Ow._hashUpdateEntries=[];class Mw{constructor(e,t,n,i,o,a){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=e,this.target=t,this.timerIndex=n,this.currentTimer=i,this.currentTimerSalvaged=o,this.paused=a}}Mw.get=(e,t,n,i,o,a)=>{let r=Mw._hashTimerEntries.pop();return r?(r.timers=e,r.target=t,r.timerIndex=n,r.currentTimer=i,r.currentTimerSalvaged=o,r.paused=a):r=new Mw(e,t,n,i,o,a),r},Mw.put=e=>{Mw._hashTimerEntries.length<20&&(e.timers=e.target=e.currentTimer=null,Mw._hashTimerEntries.push(e))},Mw._hashTimerEntries=[];class zw{constructor(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}initWithCallback(e,t,n,i,o,a){return this._lock=!1,this._scheduler=e,this._target=n,this._callback=t,this._elapsed=-1,this._interval=i,this._delay=a,this._useDelay=this._delay>0,this._repeat=o,this._runForever=this._repeat===c.macro.REPEAT_FOREVER,!0}getInterval(){return this._interval}setInterval(e){this._interval=e}update(e){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=e,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))}getCallback(){return this._callback}trigger(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)}cancel(){this._scheduler.unschedule(this._callback,this._target)}}zw._timers=[],zw.get=()=>zw._timers.pop()||new zw,zw.put=e=>{zw._timers.length<20&&!e._lock&&(e._scheduler=e._target=e._callback=null,zw._timers.push(e))};class Lw extends Rw{static enableForTarget(e){let t=!1;(e.uuid||e.id)&&(t=!0),t||(e.__instanceId?w(1513):e.id=Dw.getNewId())}constructor(){super(),this._timeScale=void 0,this._updatesNegList=void 0,this._updates0List=void 0,this._updatesPosList=void 0,this._hashForUpdates=void 0,this._hashForTimers=void 0,this._currentTarget=void 0,this._currentTargetSalvaged=void 0,this._updateHashLocked=void 0,this._arrayForTimers=void 0,this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates=ne(!0),this._hashForTimers=ne(!0),this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]}setTimeScale(e){this._timeScale=e}getTimeScale(){return this._timeScale}update(e){let t,n,i,o,a;for(this._updateHashLocked=!0,1!==this._timeScale&&(e*=this._timeScale),t=0,n=this._updatesNegList,i=n.length;t<i;t++)o=n[t],o.paused||o.markedForDeletion||o.target.update(e);for(t=0,n=this._updates0List,i=n.length;t<i;t++)o=n[t],o.paused||o.markedForDeletion||o.target.update(e);for(t=0,n=this._updatesPosList,i=n.length;t<i;t++)o=n[t],o.paused||o.markedForDeletion||o.target.update(e);const r=this._arrayForTimers;for(t=0;t<r.length;t++){if(a=r[t],this._currentTarget=a,this._currentTargetSalvaged=!1,!a.paused)for(a.timerIndex=0;a.timerIndex<a.timers.length;++a.timerIndex)a.currentTimer=a.timers[a.timerIndex],a.currentTimerSalvaged=!1,a.currentTimer.update(e),a.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,n=this._updatesNegList;t<n.length;)o=n[t],o.markedForDeletion?this._removeUpdateFromHash(o):t++;for(t=0,n=this._updates0List;t<n.length;)o=n[t],o.markedForDeletion?this._removeUpdateFromHash(o):t++;for(t=0,n=this._updatesPosList;t<n.length;)o=n[t],o.markedForDeletion?this._removeUpdateFromHash(o):t++;this._updateHashLocked=!1,this._currentTarget=null}schedule(e,t,n,i,o,a){if("function"!=typeof e){const n=e;e=t,t=n}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(a=!!i,i=c.macro.REPEAT_FOREVER,o=0),N(t,1502);const r=t.uuid||t.id;if(!r)return void R(1510);let s,l,_=this._hashForTimers[r];if(_?_.paused!==a&&w(1511):(_=Mw.get(null,t,0,null,null,a),this._arrayForTimers.push(_),this._hashForTimers[r]=_),null==_.timers)_.timers=[];else for(l=0;l<_.timers.length;++l)if(s=_.timers[l],s&&e===s._callback)return T(1507,s.getInterval(),n),void(s._interval=n);s=zw.get(),s.initWithCallback(this,e,t,n,i,o),_.timers.push(s),this._currentTarget===_&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}scheduleUpdate(e,t,n){const i=e.uuid||e.id;if(!i)return void R(1510);const o=this._hashForUpdates[i];if(o&&o.entry){if(o.entry.priority===t)return o.entry.markedForDeletion=!1,void(o.entry.paused=n);if(this._updateHashLocked)return T(1506),o.entry.markedForDeletion=!1,void(o.entry.paused=n);this.unscheduleUpdate(e)}const a=Nw.get(e,t,n,!1);let r;0===t?(r=this._updates0List,this._appendIn(r,a)):(r=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(r,a,t)),this._hashForUpdates[i]=Ow.get(r,a,e,null)}unschedule(e,t){if(!t||!e)return;const n=t.uuid||t.id;if(!n)return void R(1510);const i=this._hashForTimers[n];if(i){const t=i.timers;for(let n=0,o=t.length;n<o;n++){const o=t[n];if(e===o._callback)return o!==i.currentTimer||i.currentTimerSalvaged||(i.currentTimerSalvaged=!0),t.splice(n,1),zw.put(o),i.timerIndex>=n&&i.timerIndex--,void(0===t.length&&(this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)))}}}unscheduleUpdate(e){if(!e)return;const t=e.uuid||e.id;if(!t)return void R(1510);const n=this._hashForUpdates[t];n&&(this._updateHashLocked?n.entry.markedForDeletion=!0:this._removeUpdateFromHash(n.entry))}unscheduleAllForTarget(e){if(!e)return;const t=e.uuid||e.id;if(!t)return void R(1510);const n=this._hashForTimers[t];if(n){const e=n.timers;e.indexOf(n.currentTimer)>-1&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0);for(let t=0,n=e.length;t<n;t++)zw.put(e[t]);e.length=0,this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)}this.unscheduleUpdate(e)}unscheduleAll(){this.unscheduleAllWithMinPriority(Rw.Priority.SCHEDULER)}unscheduleAllWithMinPriority(e){let t,n;const i=this._arrayForTimers;for(t=i.length-1;t>=0;t--)n=i[t],this.unscheduleAllForTarget(n.target);let o,a=0;if(e<0)for(t=0;t<this._updatesNegList.length;)a=this._updatesNegList.length,o=this._updatesNegList[t],o&&o.priority>=e&&this.unscheduleUpdate(o.target),a===this._updatesNegList.length&&t++;if(e<=0)for(t=0;t<this._updates0List.length;)a=this._updates0List.length,o=this._updates0List[t],o&&this.unscheduleUpdate(o.target),a===this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)a=this._updatesPosList.length,o=this._updatesPosList[t],o&&o.priority>=e&&this.unscheduleUpdate(o.target),a===this._updatesPosList.length&&t++}isScheduled(e,t){N(e,1508),N(t,1509);const n=t.uuid||t.id;if(!n)return R(1510),!1;const i=this._hashForTimers[n];if(!i)return!1;if(null==i.timers)return!1;{const t=i.timers;for(let n=0;n<t.length;++n)if(e===t[n]._callback)return!0;return!1}}pauseAllTargets(){return this.pauseAllTargetsWithMinPriority(Rw.Priority.SCHEDULER)}pauseAllTargetsWithMinPriority(e){const t=[];let n;const i=this._arrayForTimers;let o,a,r;for(o=0,a=i.length;o<a;o++)n=i[o],n&&(n.paused=!0,t.push(n.target));if(e<0)for(o=0;o<this._updatesNegList.length;o++)r=this._updatesNegList[o],r&&r.priority>=e&&(r.paused=!0,t.push(r.target));if(e<=0)for(o=0;o<this._updates0List.length;o++)r=this._updates0List[o],r&&(r.paused=!0,t.push(r.target));for(o=0;o<this._updatesPosList.length;o++)r=this._updatesPosList[o],r&&r.priority>=e&&(r.paused=!0,t.push(r.target));return t}resumeTargets(e){if(e)for(let t=0;t<e.length;t++)this.resumeTarget(e[t])}pauseTarget(e){N(e,1503);const t=e.uuid||e.id;if(!t)return void R(1510);const n=this._hashForTimers[t];n&&(n.paused=!0);const i=this._hashForUpdates[t];i&&(i.entry.paused=!0)}resumeTarget(e){N(e,1504);const t=e.uuid||e.id;if(!t)return void R(1510);const n=this._hashForTimers[t];n&&(n.paused=!1);const i=this._hashForUpdates[t];i&&(i.entry.paused=!1)}isTargetPaused(e){N(e,1505);const t=e.uuid||e.id;if(!t)return R(1510),!1;const n=this._hashForTimers[t];if(n)return n.paused;const i=this._hashForUpdates[t];return!!i&&i.entry.paused}_removeHashElement(e){const t=e.target.uuid||e.target.id;delete this._hashForTimers[t];const n=this._arrayForTimers;for(let t=0,i=n.length;t<i;t++)if(n[t]===e){n.splice(t,1);break}Mw.put(e)}_removeUpdateFromHash(e){const t=e.target.uuid||e.target.id,n=this._hashForUpdates[t];if(n){const e=n.list,i=n.entry;for(let t=0,n=e.length;t<n;t++)if(e[t]===i){e.splice(t,1);break}delete this._hashForUpdates[t],Nw.put(i),Ow.put(n)}}_priorityIn(e,t,n){for(let i=0;i<e.length;i++)if(n<e[i].priority)return void e.splice(i,0,t);e.push(t)}_appendIn(e,t){e.push(t)}}e("f1",Lw),Lw.ID="scheduler",c.Scheduler=Lw;const Fw={[z_.PORTRAIT]:ko.IDENTITY,[z_.LANDSCAPE_RIGHT]:ko.ROTATE_90,[z_.PORTRAIT_UPSIDE_DOWN]:ko.ROTATE_180,[z_.LANDSCAPE_LEFT]:ko.ROTATE_270};class Bw{get width(){return this._width}get height(){return this._height}get swapchain(){return this._swapchain}get framebuffer(){return this._framebuffer}get cameras(){return this._cameras}static registerCreateFunc(e){e._createWindowFun=e=>new Bw(e)}get native(){return this._nativeObj}constructor(e){this._title="",this._width=1,this._height=1,this._swapchain=null,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._cameras=[],this._hasOnScreenAttachments=!1,this._hasOffScreenAttachments=!1,this._framebuffer=null}initialize(e,t){if(this._init(),void 0!==t.title&&(this._title=t.title),void 0!==t.swapchain&&(this._swapchain=t.swapchain),this._width=t.width,this._height=t.height,this._renderPass=e.createRenderPass(t.renderPassInfo),t.swapchain)this._setSwapchain(t.swapchain),this._colorTextures.push(t.swapchain.colorTexture),this._depthStencilTexture=t.swapchain.depthStencilTexture;else{for(let n=0;n<t.renderPassInfo.colorAttachments.length;n++)this._colorTextures.push(e.createTexture(new Ha(Xo.TEX2D,Qo.COLOR_ATTACHMENT|Qo.SAMPLED|Qo.TRANSFER_SRC,t.renderPassInfo.colorAttachments[n].format,this._width,this._height)));t.renderPassInfo.depthStencilAttachment.format!==Go.UNKNOWN&&(this._depthStencilTexture=e.createTexture(new Ha(Xo.TEX2D,Qo.DEPTH_STENCIL_ATTACHMENT|Qo.SAMPLED,t.renderPassInfo.depthStencilAttachment.format,this._width,this._height)))}return this._setFrameBuffer(e.createFramebuffer(new fr(this._renderPass,this._colorTextures,this._depthStencilTexture))),!0}destroy(){this.clearCameras(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(let e=0;e<this._colorTextures.length;e++){const t=this._colorTextures[e];t&&t.destroy()}this._colorTextures.length=0,this._destroy()}resize(e,t){if(this._swapchain)this._swapchain.resize(e,t,Fw[B_.orientation]),this._width=this._swapchain.width,this._height=this._swapchain.height;else{for(let n=0;n<this._colorTextures.length;n++)this._colorTextures[n].resize(e,t);this._depthStencilTexture&&this._depthStencilTexture.resize(e,t),this._width=e,this._height=t}this.framebuffer&&(this.framebuffer.destroy(),this.framebuffer.initialize(new fr(this._renderPass,this._colorTextures,this._depthStencilTexture)));for(const n of this._cameras)n.resize(e,t)}extractRenderCameras(e){for(let t=0;t<this._cameras.length;t++){const n=this._cameras[t];n.enabled&&(n.update(),e.push(n))}}attachCamera(e){for(let t=0;t<this._cameras.length;t++)if(this._cameras[t]===e)return;this._cameras.push(e),this.sortCameras()}detachCamera(e){for(let t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return void this._cameras.splice(t,1)}clearCameras(){this._cameras.length=0}sortCameras(){this._cameras.sort(((e,t)=>e.priority-t.priority))}_init(){this._nativeObj=new no}_destroy(){this._nativeObj=null}_setSwapchain(e){this._swapchain=e,this._nativeObj.swapchain=e}_setFrameBuffer(e){this._framebuffer=e,this._nativeObj.frameBuffer=e}}class kw{_init(){this._naitveObj=new so}_destroy(){this._naitveObj=null}_setCumulativeTime(e){this._cumulativeTime+=e,this._naitveObj.cumulativeTime=this._cumulativeTime}_setFrameTime(e){this._frameTime=e,this._naitveObj.frameTime=e}get device(){return this._device}get mainWindow(){return this._mainWindow}set curWindow(e){this._curWindow=e}get curWindow(){return this._curWindow}set tempWindow(e){this._tempWindow=e}get tempWindow(){return this._tempWindow}get windows(){return this._windows}get pipeline(){return this._pipeline}get batcher2D(){return this._batcher}get scenes(){return this._scenes}get cumulativeTime(){return this._cumulativeTime}get frameTime(){return this._frameTime}get frameCount(){return this._frameCount}get fps(){return this._fps}set fixedFPS(e){e>0?(this._fixedFPS=e,this._fixedFPSFrameTime=1e3/e):this._fixedFPSFrameTime=0}get fixedFPS(){return this._fixedFPS}get dataPoolManager(){return this._dataPoolMgr}get useDeferredPipeline(){return this._useDeferredPipeline}constructor(e){this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._useDeferredPipeline=!1,this._fixedFPSFrameTime=0,this._cumulativeTime=0,this._frameTime=0,this._device=e,this._dataPoolMgr=c.internal.DataPoolManager&&new c.internal.DataPoolManager(e),iA.registerCreateFunc(this),Bw.registerCreateFunc(this),this._cameraPool=new ze((()=>new gd(this._device)),4,(e=>e.destroy()))}initialize(e){this._init();const t=c.game._swapchain,n=new rr;n.format=t.colorTexture.format;const i=new sr;i.format=t.depthStencilTexture.format,i.depthStoreOp=ca.DISCARD,i.stencilStoreOp=ca.DISCARD;const o=new _r([n],i);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:t.width,height:t.height,renderPassInfo:o,swapchain:t}),this._curWindow=this._mainWindow,Promise.resolve(Bm.initBuiltinRes(this._device))}destroy(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._destroy()}resize(e,t){for(const n of this._windows)n.swapchain&&n.resize(e,t)}setRenderPipeline(e){e instanceof yw&&(this._useDeferredPipeline=!0);let t=!1;if(e||(e=fw(),t=!0),this._pipeline=e,this._useDeferredPipeline&&this.device.hasFeature(Uo.COMPUTE_SHADER)||(this._pipeline.clusterEnabled=!1),this._pipeline.bloomEnabled=!1,!this._pipeline.activate(this._mainWindow.swapchain))return t&&this._pipeline.destroy(),this._pipeline=null,!1;const n=c.director.getScene();return n&&n.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&c.internal.Batcher2D&&(this._batcher=new c.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))}onGlobalPipelineStateChanged(){for(let e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged();this._pipeline.pipelineSceneData.onGlobalPipelineStateChanged()}activeWindow(e){this._curWindow=e}resetCumulativeTime(){this._setCumulativeTime(0)}frameMove(e){this._setFrameTime(e),++this._frameCount,this._setCumulativeTime(e),this._fpsTime+=e,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(let e=0;e<this._scenes.length;++e)this._scenes[e].removeBatches();const t=this._windows,n=[];for(let e=0;e<t.length;e++)t[e].extractRenderCameras(n);if(this._pipeline&&n.length>0){this._device.acquire([c.game._swapchain]);const e=this._scenes,t=c.director.getTotalFrames();this._batcher&&(this._batcher.update(),this._batcher.uploadBuffers());for(let n=0;n<e.length;n++)e[n].update(t);c.director.emit(c.Director.EVENT_BEFORE_COMMIT),n.sort(((e,t)=>e.priority-t.priority)),this._pipeline.render(n),this._device.present()}this._batcher&&this._batcher.reset()}createWindow(e){const t=this._createWindowFun(this);return t.initialize(this.device,e),this._windows.push(t),t}destroyWindow(e){for(let t=0;t<this._windows.length;++t)if(this._windows[t]===e)return e.destroy(),void this._windows.splice(t,1)}destroyWindows(){for(const e of this._windows)e.destroy();this._windows.length=0}createScene(e){const t=this._createSceneFun(this);return t.initialize(e),this._scenes.push(t),t}destroyScene(e){for(let t=0;t<this._scenes.length;++t)if(this._scenes[t]===e)return e.destroy(),void this._scenes.splice(t,1)}destroyScenes(){for(const e of this._scenes)e.destroy();this._scenes.length=0}createModel(e){let t=this._modelPools.get(e);t||(this._modelPools.set(e,new ze((()=>new e),10,(e=>e.destroy()))),t=this._modelPools.get(e));const n=t.alloc();return n.initialize(),n}destroyModel(e){const t=this._modelPools.get(e.constructor);t?(t.free(e),e.scene&&e.scene.removeModel(e)):w(1300,e.constructor.name),e.destroy()}createCamera(){return this._cameraPool.alloc()}createLight(e){let t=this._lightPools.get(e);t||(this._lightPools.set(e,new ze((()=>new e),4,(e=>e.destroy()))),t=this._lightPools.get(e));const n=t.alloc();return n.initialize(),n}destroyLight(e){const t=this._lightPools.get(e.constructor);if(t&&(t.free(e),e.scene))switch(e.type){case OA.SPHERE:e.scene.removeSphereLight(e);break;case OA.SPOT:e.scene.removeSpotLight(e)}e.destroy()}}c.Root=kw;class Uw extends Yt{constructor(...e){super(...e),this.frame=null,this.container=null,this.canvas=null,this.renderType=-1,this.eventTargetOn=super.on,this.eventTargetOnce=super.once,this.config={},this.onStart=null,this.frameTime=1e3/60,this.collisionMatrix=[],this.groupList=[],this._persistRootNodes={},this._gfxDevice=null,this._swapchain=null,this._configLoaded=!1,this._isCloning=!1,this._inited=!1,this._engineInited=!1,this._rendererInitialized=!1,this._paused=!0,this._frameRate=60,this._intervalId=0,this._initTime=0,this._startTime=0,this._deltaTime=0,this._onEngineInitedCallback=[]}get inited(){return this._inited}get frameRate(){return this._frameRate}set frameRate(e){"number"!=typeof e&&(e=parseInt(e,10),Number.isNaN(e)&&(e=60)),this._frameRate=e,this.frameTime=1e3/e,this._setAnimFrame()}get deltaTime(){return this._deltaTime}get totalTime(){return performance.now()-this._initTime}get frameStartTime(){return this._startTime}setFrameRate(e){this.frameRate=e}getFrameRate(){return this.frameRate}step(){c.director.tick(this.frameTime/1e3)}pause(){this._paused||(this._paused=!0,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0))}resume(){this._paused&&(uP._clearEvents(),this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0),this._paused=!1,this._updateCallback(),this._intervalId=window.rAF(this._frameCB))}isPaused(){return this._paused}restart(){return new Promise((e=>c.director.once(c.Director.EVENT_END_FRAME,(()=>e())))).then((()=>{for(const e in this._persistRootNodes)this.removePersistRootNode(this._persistRootNodes[e]);return c.director.getScene().destroy(),c.Object._deferredDestroy(),c.director.reset(),c.profiler.reset(),this.pause(),this._setRenderPipelineNShowSplash().then((()=>{this.resume(),this._safeEmit(Uw.EVENT_RESTART)}))}))}end(){nn.close()}on(e,t,n,i){return(this._engineInited&&e===Uw.EVENT_ENGINE_INITED||this._inited&&e===Uw.EVENT_GAME_INITED||this._rendererInitialized&&e===Uw.EVENT_RENDERER_INITED)&&t.call(n),this.eventTargetOn(e,t,n,i)}once(e,t,n){return this._engineInited&&e===Uw.EVENT_ENGINE_INITED?t.call(n):this.eventTargetOnce(e,t,n)}init(e){if(this._initConfig(e),this.config.assetOptions&&c.assetManager.init(this.config.assetOptions),this.config.layers){const e=this.config.layers;for(let t=0;t<e.length;t++){const n=e[t],i=bn(n.value);Jf.addLayer(n.name,i)}}return this._initEngine().then((()=>(this._initEvents(),c.director.root&&c.director.root.dataPoolManager&&c.director.root.dataPoolManager.jointTexturePool.registerCustomTextureLayouts(e.customJointTextureLayouts),this._engineInited)))}run(e,t){let n;return"function"!=typeof e&&e?(n=this.init(e),this.onStart=null!=t?t:null):this.onStart=null!=e?e:null,i_.init(),Promise.resolve(n).then((()=>this._setRenderPipelineNShowSplash())).then((()=>{k_._init({configOrientation:"auto",exactFitScreen:!0})}))}addPersistRootNode(e){if(!c.Node.isNode(e)||!e.uuid)return void w(3800);const t=e.uuid;if(!this._persistRootNodes[t]){const n=c.director._scene;if(c.isValid(n))if(e.parent){if(!(e.parent instanceof c.Scene))return void w(3801);if(e.parent!==n)return void w(3802);e._originalSceneId=n.uuid}else e.parent=n;this._persistRootNodes[t]=e,e._persistNode=!0,c.assetManager._releaseManager._addPersistNodeRef(e)}}removePersistRootNode(e){const t=e.uuid||"";e===this._persistRootNodes[t]&&(delete this._persistRootNodes[t],e._persistNode=!1,e._originalSceneId="",c.assetManager._releaseManager._removePersistNodeRef(e))}isPersistRootNode(e){return!!e._persistNode}onEngineInitedAsync(e){this._onEngineInitedCallback.push(e)}_initEngine(){this._initDevice();const e=c.director;return Promise.resolve(e._init()).then((()=>{c.view.init(),A(`Cocos Creator v${l}`),this.emit(Uw.EVENT_ENGINE_INITED),this._engineInited=!0,c.internal.dynamicAtlasManager&&(c.internal.dynamicAtlasManager.enabled=!He.CLEANUP_IMAGE_CACHE)})).then((()=>{const e=this._onEngineInitedCallback.map((e=>e())).filter(Boolean);return this._onEngineInitedCallback.length=0,Promise.all(e)}))}_setAnimFrame(){const e=this._frameRate;jsb.setPreferredFramesPerSecond(e),window.rAF=window.requestAnimationFrame,window.cAF=window.cancelAnimationFrame}_stTime(e){const t=performance.now(),n=Math.max(0,t-this._startTime),i=Math.max(0,this.frameTime-n);return window.setTimeout(e,i)}_ctTime(e){window.clearTimeout(e)}_calculateDT(e){return e||(e=performance.now()),this._deltaTime=e>this._startTime?(e-this._startTime)/1e3:0,this._deltaTime>Uw.DEBUG_DT_THRESHOLD&&(this._deltaTime=this.frameTime/1e3),this._startTime=e,this._deltaTime}_updateCallback(){const e=c.director;let t;t=t=>{e.tick(this._calculateDT(t)),this._intervalId=window.rAF(this._frameCB)},this._frameCB=t}_runMainLoop(){if(!this._inited||i)return;const e=this.config,t=c.director;L(!!e.showFPS),t.startAnimation(),this.resume()}_initConfig(e){"number"!=typeof e.debugMode&&(e.debugMode=O.NONE),e.exposeClassName=!!e.exposeClassName,"number"!=typeof e.frameRate&&(e.frameRate=60);const t=e.renderMode;("number"!=typeof t||t>3||t<0)&&(e.renderMode=0),e.showFPS=!!e.showFPS,b(e.debugMode),this.config=e,this._configLoaded=!0,this.frameRate=e.frameRate}_determineRenderType(){const e=this.config,t=parseInt(e.renderMode,10);this.renderType=Uw.RENDER_TYPE_CANVAS;let n=!1;if(1===t?(this.renderType=Uw.RENDER_TYPE_CANVAS,n=!0):0===t||2===t?(this.renderType=Uw.RENDER_TYPE_WEBGL,n=!0):3===t&&(this.renderType=Uw.RENDER_TYPE_HEADLESS,n=!0),!n)throw new Error(M(3820,t))}_initDevice(){if(this._rendererInitialized)return;const e=this.config.adapter;if(e&&(this.canvas=e.canvas,this.frame=e.frame,this.container=e.container),this._determineRenderType(),this.renderType===Uw.RENDER_TYPE_WEBGL){const e=new Ba(lp);if(window.gfx)this._gfxDevice=gfx.DeviceManager.create(e);else{let t=!!window.WebGL2RenderingContext;const n=window.navigator.userAgent.toLowerCase();(-1!==n.indexOf("safari")&&-1===n.indexOf("chrome")||U_.browserType===Xt.UC)&&(t=!1);const i=[];t&&c.WebGL2Device&&i.push(c.WebGL2Device),c.WebGLDevice&&i.push(c.WebGLDevice),c.EmptyDevice&&i.push(c.EmptyDevice),Wr.canvas=this.canvas;for(let t=0;t<i.length&&(this._gfxDevice=new i[t],!this._gfxDevice.initialize(e));t++);}}else this.renderType===Uw.RENDER_TYPE_HEADLESS&&c.EmptyDevice&&(this._gfxDevice=new c.EmptyDevice,this._gfxDevice.initialize(new Ba(lp)));if(!this._gfxDevice)return g("can not support canvas rendering in 3D"),void(this.renderType=Uw.RENDER_TYPE_CANVAS);const t=new Fa(this.canvas),n=k_.windowSize;t.width=n.width,t.height=n.height,this._swapchain=this._gfxDevice.createSwapchain(t),this.canvas.oncontextmenu=()=>!1}_initEvents(){nn.on("show",this._onShow,this),nn.on("hide",this._onHide,this)}_onHide(){this.emit(Uw.EVENT_HIDE),this.pause()}_onShow(){this.emit(Uw.EVENT_SHOW),this.resume()}_setRenderPipelineNShowSplash(){return Promise.resolve(this._setupRenderPipeline()).then((()=>Promise.resolve(this._showSplashScreen()).then((()=>{this._inited=!0,this._initTime=performance.now(),this._runMainLoop(),this._safeEmit(Uw.EVENT_GAME_INITED),this.onStart&&this.onStart()}))))}_setupRenderPipeline(){const{renderPipeline:e}=this.config;return e?new Promise(((t,n)=>{c.assetManager.loadAny(e,((e,i)=>!e&&i instanceof _w?t(i):n(e)))})).then((e=>{this._setRenderPipeline(e)})).catch((t=>{v(t),v(`Failed load render pipeline: ${e}, engine failed to initialize, will fallback to default pipeline`),this._setRenderPipeline()})):this._setRenderPipeline()}_showSplashScreen(){if(c.internal.SplashScreen){const e=c.internal.SplashScreen.instance;return e.main(c.director.root),new Promise((t=>{e.setOnFinish((()=>t())),e.loadFinish=!0}))}return null}_setRenderPipeline(e){c.director.root.setRenderPipeline(e)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(Uw.EVENT_RENDERER_INITED)}_safeEmit(e){this.emit(e)}}e("em",Uw),Uw.EVENT_HIDE="game_on_hide",Uw.EVENT_SHOW="game_on_show",Uw.EVENT_LOW_MEMORY="game_on_low_memory",Uw.EVENT_GAME_INITED="game_inited",Uw.EVENT_ENGINE_INITED="engine_inited",Uw.EVENT_RENDERER_INITED="renderer_inited",Uw.EVENT_RESTART="game_on_restart",Uw.RENDER_TYPE_CANVAS=0,Uw.RENDER_TYPE_WEBGL=1,Uw.RENDER_TYPE_OPENGL=2,Uw.RENDER_TYPE_HEADLESS=3,Uw.DEBUG_DT_THRESHOLD=1,c.Game=Uw;const Gw=e("dE",c.game=new Uw);class jw extends Yt{constructor(){super(),this._compScheduler=void 0,this._nodeActivator=void 0,this._invalid=void 0,this._paused=void 0,this._root=void 0,this._loadingScene=void 0,this._scene=void 0,this._totalFrames=void 0,this._scheduler=void 0,this._systems=void 0,this._invalid=!1,this._paused=!1,this._root=null,this._loadingScene="",this._scene=null,this._totalFrames=0,this._scheduler=new Lw,this._compScheduler=new BP,this._nodeActivator=new XP,this._systems=[],Gw.once(Uw.EVENT_RENDERER_INITED,this._initOnRendererInitialized,this)}calculateDeltaTime(e){}end(){this.once(jw.EVENT_END_FRAME,(()=>{this.purgeDirector()}))}pause(){this._paused||(this._paused=!0)}purgeDirector(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),c.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),c.assetManager.releaseAll()}reset(){this.purgeDirector(),this.emit(jw.EVENT_RESET),this.startAnimation()}runSceneImmediate(e,t,n){e instanceof KP&&(e=e.scene),N(e instanceof bP,1216),e._load();const i=Object.keys(Gw._persistRootNodes).map((e=>Gw._persistRootNodes[e]));for(let t=0;t<i.length;t++){const n=i[t];n.emit(c.Node.SCENE_CHANGED_FOR_PERSISTS,e.renderScene);const o=e.uuid===n._originalSceneId&&e.getChildByUuid(n.uuid);if(o){const t=o.getSiblingIndex();o._destroyImmediate(),e.insertChild(n,t)}else n.parent=e}const o=this._scene;c.isValid(o)&&o.destroy(),c.assetManager._releaseManager._autoRelease(o,e,Gw._persistRootNodes),this._scene=null,Lt._deferredDestroy(),t&&t(),this.emit(c.Director.EVENT_BEFORE_SCENE_LAUNCH,e),this._scene=e,e._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),n&&n(null,e),this.emit(c.Director.EVENT_AFTER_SCENE_LAUNCH,e)}runScene(e,t,n){e instanceof KP&&(e=e.scene),N(e,1205),N(e instanceof bP,1216),e._load(),this.once(c.Director.EVENT_END_FRAME,(()=>{this.runSceneImmediate(e,t,n)}))}loadScene(e,t,n){if(this._loadingScene)return w(1208,e,this._loadingScene),!1;const i=c.assetManager.bundles.find((t=>!!t.getSceneInfo(e)));return i?(this.emit(c.Director.EVENT_BEFORE_SCENE_LOADING,e),this._loadingScene=e,console.time(`LoadScene ${e}`),i.loadScene(e,((i,o)=>{console.timeEnd(`LoadScene ${e}`),this._loadingScene="",i?(g(i),t&&t(i)):this.runSceneImmediate(o,n,t)})),!0):(R(1209,e),!1)}preloadScene(e,t,n){const i=c.assetManager.bundles.find((t=>!!t.getSceneInfo(e)));if(i)i.preloadScene(e,null,t,n);else{const t=`Can not preload the scene "${e}" because it is not in the build settings.`;n&&n(new Error(t)),g(`preloadScene: ${t}`)}}resume(){this._paused&&(this._paused=!1)}get root(){return this._root}getScene(){return this._scene}getDeltaTime(){return Gw.deltaTime}getTotalTime(){return Gw.totalTime}getCurrentTime(){return Gw.frameStartTime}getTotalFrames(){return this._totalFrames}isPaused(){return this._paused}getScheduler(){return this._scheduler}setScheduler(e){this._scheduler!==e&&(this.unregisterSystem(this._scheduler),this._scheduler=e,this.registerSystem(Lw.ID,e,200))}registerSystem(e,t,n){t.id=e,t.priority=n,t.init(),this._systems.push(t),this._systems.sort(Rw.sortByPriority)}unregisterSystem(e){De.fastRemove(this._systems,e),this._systems.sort(Rw.sortByPriority)}getSystem(e){return this._systems.find((t=>t.id===e))}getAnimationManager(){return this.getSystem(c.AnimationManager.ID)}startAnimation(){this._invalid=!1}stopAnimation(){this._invalid=!0}mainLoop(e){let t;t=Gw._calculateDT(e),this.tick(t)}tick(e){if(!this._invalid){if(this.emit(jw.EVENT_BEGIN_FRAME),uP._frameDispatchEvents(),!this._paused){this.emit(jw.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(e);for(let t=0;t<this._systems.length;++t)this._systems[t].update(e);this._compScheduler.lateUpdatePhase(e),this.emit(jw.EVENT_AFTER_UPDATE),Lt._deferredDestroy();for(let t=0;t<this._systems.length;++t)this._systems[t].postUpdate(e)}this.emit(jw.EVENT_BEFORE_DRAW),this._root.frameMove(e),this.emit(jw.EVENT_AFTER_DRAW),Ox.resetHasChangedFlags(),Ox.clearNodeArray(),Oe.update(e),this.emit(jw.EVENT_END_FRAME),this._totalFrames++}}_initOnRendererInitialized(){this._totalFrames=0,this._paused=!1,this.registerSystem(Lw.ID,this._scheduler,200),this.emit(jw.EVENT_INIT)}_init(){return this._root=new kw(Gw._gfxDevice),this._root.initialize({}).catch((e=>(R(1217),Promise.reject(e))))}}e("c_",jw),jw.EVENT_INIT="director_init",jw.EVENT_RESET="director_reset",jw.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",jw.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",jw.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",jw.EVENT_BEFORE_UPDATE="director_before_update",jw.EVENT_AFTER_UPDATE="director_after_update",jw.EVENT_BEFORE_DRAW="director_before_draw",jw.EVENT_AFTER_DRAW="director_after_draw",jw.EVENT_BEFORE_COMMIT="director_before_commit",jw.EVENT_BEFORE_PHYSICS="director_before_physics",jw.EVENT_AFTER_PHYSICS="director_after_physics",jw.EVENT_BEGIN_FRAME="director_begin_frame",jw.EVENT_END_FRAME="director_end_frame",jw.instance=void 0,c.Director=jw;const Vw=e("cZ",jw.instance=c.director=new jw),Hw={};Pn(Hw,"vmath",[{name:"vec2",newName:"Vec2",target:Ui,targetName:"math"},{name:"vec3",newName:"Vec3",target:Ui,targetName:"math"},{name:"vec4",newName:"Vec4",target:Ui,targetName:"math"},{name:"quat",newName:"Quat",target:Ui,targetName:"math"},{name:"mat3",newName:"Mat3",target:Ui,targetName:"math"},{name:"mat4",newName:"Mat4",target:Ui,targetName:"math"},{name:"color4",newName:"Color",target:Ui,targetName:"math"},{name:"rect",newName:"Rect",target:Ui,targetName:"math"},{name:"approx",newName:"approx",target:Ui,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:Ui,targetName:"math"},{name:"equals",newName:"equals",target:Ui,targetName:"math"},{name:"clamp",newName:"clamp",target:Ui,targetName:"math"},{name:"clamp01",newName:"clamp01",target:Ui,targetName:"math"},{name:"lerp",newName:"lerp",target:Ui,targetName:"math"},{name:"toRadian",newName:"toRadian",target:Ui,targetName:"math"},{name:"toDegree",newName:"toDegree",target:Ui,targetName:"math"},{name:"random",newName:"random",target:Ui,targetName:"math"},{name:"randomRange",newName:"randomRange",target:Ui,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:Ui,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:Ui,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:Ui,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:Ui,targetName:"math"},{name:"repeat",newName:"repeat",target:Ui,targetName:"math"},{name:"pingPong",newName:"pingPong",target:Ui,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:Ui,targetName:"math"}]),c.vmath=Hw,Pn(Lw.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:Lw,targetName:"Scheduler"}]),Pn(Lw,"Scheduler",[{name:"PRIORITY_SYSTEM",newName:"System.Priority.SCHEDULER",customGetter:()=>Rw.Priority.SCHEDULER}]),wn(Lw,"Scheduler",[{name:"PRIORITY_NON_SYSTEM",suggest:"Use enum` System.Priority` instead"}]),Pn(Xm.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),wn(Xm.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),Pn(kw.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]),In(Gw,"game",[{name:"collisionMatrix"},{name:"groupList"}]),In(jw.prototype,"director",[{name:"calculateDeltaTime"},{name:"getDeltaTime",suggest:"Use game.deltaTime instead"},{name:"getTotalTime",suggest:"Use game.totalTime instead"},{name:"getCurrentTime",suggest:"Use game.frameStartTime instead"}]),wn(jw.prototype,"director",[{name:"setAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getRunningScene",suggest:"please use getScene instead"},{name:"setDepthTest",suggest:"please use camera API instead"},{name:"setClearColor",suggest:"please use camera API instead"},{name:"getWinSize",suggest:"please use view.getVisibleSize instead"},{name:"getWinSizeInPixels"},{name:"purgeCachedData",suggest:"please use assetManager.releaseAll instead"},{name:"convertToGL"},{name:"convertToUI"}]);const Ww=e("d1",{topLeft:c.v2(0,0),topRight:c.v2(0,0),top:c.v2(0,0),bottomLeft:c.v2(0,0),bottomRight:c.v2(0,0),bottom:c.v2(0,0),center:c.v2(0,0),left:c.v2(0,0),right:c.v2(0,0),width:0,height:0,init(e){const t=this.width=e.width,n=this.height=e.height,i=e.x,o=e.y,a=o+n,r=i+t;this.topLeft.x=i,this.topLeft.y=a,this.topRight.x=r,this.topRight.y=a,this.top.x=i+t/2,this.top.y=a,this.bottomLeft.x=i,this.bottomLeft.y=o,this.bottomRight.x=r,this.bottomRight.y=o,this.bottom.x=i+t/2,this.bottom.y=o,this.center.x=i+t/2,this.center.y=o+n/2,this.left.x=i,this.left.y=o+n/2,this.right.x=r,this.right.y=o+n/2}});c.visibleRect=Ww;const qw=new Li,Yw={[He.ORIENTATION_AUTO]:z_.AUTO,[He.ORIENTATION_LANDSCAPE]:z_.LANDSCAPE,[He.ORIENTATION_PORTRAIT]:z_.PORTRAIT};class Xw extends Yt{constructor(){super(),this._designResolutionSize=void 0,this._scaleX=void 0,this._scaleY=void 0,this._viewportRect=void 0,this._visibleRect=void 0,this._autoFullScreen=void 0,this._retinaEnabled=void 0,this._resizeCallback=void 0,this._resolutionPolicy=void 0,this._rpExactFit=void 0,this._rpShowAll=void 0,this._rpNoBorder=void 0,this._rpFixedHeight=void 0,this._rpFixedWidth=void 0;const e=Qw,t=Zw;this._designResolutionSize=new Li(0,0),this._scaleX=1,this._scaleY=1,this._viewportRect=new Bi(0,0,0,0),this._visibleRect=new Bi(0,0,0,0),this._autoFullScreen=!1,this._retinaEnabled=!1,this._resizeCallback=null,this._rpExactFit=new Jw(e.EQUAL_TO_FRAME,t.EXACT_FIT),this._rpShowAll=new Jw(e.EQUAL_TO_FRAME,t.SHOW_ALL),this._rpNoBorder=new Jw(e.EQUAL_TO_FRAME,t.NO_BORDER),this._rpFixedHeight=new Jw(e.EQUAL_TO_FRAME,t.FIXED_HEIGHT),this._rpFixedWidth=new Jw(e.EQUAL_TO_FRAME,t.FIXED_WIDTH),this._resolutionPolicy=this._rpShowAll}init(){const e=k_.windowSize,t=e.width,n=e.height;this._designResolutionSize.width=t,this._designResolutionSize.height=n,this._viewportRect.width=t,this._viewportRect.height=n,this._visibleRect.width=t,this._visibleRect.height=n,qw.width=this._visibleRect.width,qw.height=this._visibleRect.height,Ww&&Ww.init(this._visibleRect),B_.on("window-resize",this._updateAdaptResult,this),B_.on("orientation-change",this._updateAdaptResult,this),B_.on("fullscreen-change",this._updateAdaptResult,this)}resizeWithBrowserSize(e){B_.handleResizeEvent=e}setResizeCallback(e){"function"!=typeof e&&null!=e||(this._resizeCallback=e)}setOrientation(e){B_.orientation=Yw[e]}adjustViewportMeta(e){}enableRetina(e){this._retinaEnabled=!!e}isRetinaEnabled(){return this._retinaEnabled}enableAutoFullScreen(e){e!==this._autoFullScreen&&(this._autoFullScreen=e,e&&k_.requestFullScreen().catch((()=>{})))}isAutoFullScreenEnabled(){return this._autoFullScreen}setCanvasSize(e,t){B_.resolutionScale=1;const n=B_.devicePixelRatio,i=new Li(e*n,t*n);k_.windowSize=i}getCanvasSize(){return k_.windowSize}getFrameSize(){const e=B_.devicePixelRatio,t=k_.windowSize;return t.width/=e,t.height/=e,t}setFrameSize(e,t){const n=B_.devicePixelRatio;k_.windowSize=new Li(e*n,t*n)}getVisibleSize(){return new Li(this._visibleRect.width,this._visibleRect.height)}getVisibleSizeInPixel(){return new Li(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)}getVisibleOrigin(){return new Ii(this._visibleRect.x,this._visibleRect.y)}getVisibleOriginInPixel(){return new Ii(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)}getResolutionPolicy(){return this._resolutionPolicy}_updateResolutionPolicy(e){if(e instanceof Jw)this._resolutionPolicy=e;else{const t=Jw;e===t.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),e===t.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),e===t.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),e===t.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),e===t.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}}setResolutionPolicy(e){this._updateResolutionPolicy(e);const t=Kw.getDesignResolutionSize();Kw.setDesignResolutionSize(t.width,t.height,e)}setDesignResolutionSize(e,t,n){if(!(e>0&&t>0))return void R(2200);this._updateResolutionPolicy(n);const i=this._resolutionPolicy;i&&i.preApply(this),this._designResolutionSize.width=e,this._designResolutionSize.height=t;const o=i.apply(this,this._designResolutionSize);if(o.scale&&2===o.scale.length&&(this._scaleX=o.scale[0],this._scaleY=o.scale[1]),o.viewport){const e=this._viewportRect,t=this._visibleRect,n=o.viewport;e.x=n.x,e.y=n.y,e.width=n.width,e.height=n.height,t.x=0,t.y=0,t.width=n.width/this._scaleX,t.height=n.height/this._scaleY}i.postApply(this),qw.width=this._visibleRect.width,qw.height=this._visibleRect.height,Ww&&Ww.init(this._visibleRect),this.emit("design-resolution-changed")}getDesignResolutionSize(){return new Li(this._designResolutionSize.width,this._designResolutionSize.height)}setRealPixelResolution(e,t,n){this.setDesignResolutionSize(e,t,n)}getViewportRect(){return this._viewportRect}getScaleX(){return this._scaleX}getScaleY(){return this._scaleY}getDevicePixelRatio(){return B_.devicePixelRatio}convertToLocationInView(e,t,n,i=new Ii){const o=B_.devicePixelRatio*(e-n.left),a=B_.devicePixelRatio*(n.top+n.height-t);return B_.isFrameRotated?(i.x=k_.windowSize.width-a,i.y=o):(i.x=o,i.y=a),i}_convertToUISpace(e){const t=this._viewportRect;e.x=(e.x-t.x)/this._scaleX,e.y=(e.y-t.y)/this._scaleY}_updateAdaptResult(){var e;c.director.root.resize(k_.windowSize.width,k_.windowSize.height);const t=this._designResolutionSize.width,n=this._designResolutionSize.height;t>0&&this.setDesignResolutionSize(t,n,this._resolutionPolicy),this.emit("canvas-resize"),null===(e=this._resizeCallback)||void 0===e||e.call(this)}}e("dS",Xw),Xw.instance=void 0;class Qw{constructor(){this.name="ContainerStrategy"}preApply(e){}apply(e,t){}postApply(e){}_setupCanvas(){const e=Gw.canvas;if(e){const t=k_.windowSize;e.width=t.width,e.height=t.height}}}Qw.EQUAL_TO_FRAME=void 0,Qw.PROPORTION_TO_FRAME=void 0;class Zw{constructor(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}preApply(e){}apply(e,t){return{scale:[1,1]}}postApply(e){}_buildResult(e,t,n,i,o,a){Math.abs(e-n)<2&&(n=e),Math.abs(t-i)<2&&(i=t);const r=new Bi(Math.round((e-n)/2),Math.round((t-i)/2),n,i);return this._result.scale=[o,a],this._result.viewport=r,this._result}}Zw.EXACT_FIT=void 0,Zw.SHOW_ALL=void 0,Zw.NO_BORDER=void 0,Zw.FIXED_HEIGHT=void 0,Zw.FIXED_WIDTH=void 0,Qw.EQUAL_TO_FRAME=new class extends Qw{constructor(...e){super(...e),this.name="EqualToFrame"}apply(e,t){B_.isProportionalToFrame=!1,this._setupCanvas()}},Qw.PROPORTION_TO_FRAME=new class extends Qw{constructor(...e){super(...e),this.name="ProportionalToFrame"}apply(e,t){B_.isProportionalToFrame=!0,this._setupCanvas()}},Zw.EXACT_FIT=new class extends Zw{constructor(...e){super(...e),this.name="ExactFit"}apply(e,t){const n=k_.windowSize,i=n.width,o=n.height,a=i/t.width,r=o/t.height;return this._buildResult(i,o,i,o,a,r)}},Zw.SHOW_ALL=new class extends Zw{constructor(...e){super(...e),this.name="ShowAll"}apply(e,t){const n=k_.windowSize,i=n.width,o=n.height,a=t.width,r=t.height,s=i/a,c=o/r;let l,_,u=0;return s<c?(u=s,l=i,_=r*u):(u=c,l=a*u,_=o),this._buildResult(i,o,l,_,u,u)}},Zw.NO_BORDER=new class extends Zw{constructor(...e){super(...e),this.name="NoBorder"}apply(e,t){const n=k_.windowSize,i=n.width,o=n.height,a=t.width,r=t.height,s=i/a,c=o/r;let l,_,u;return s<c?(l=c,_=a*l,u=o):(l=s,_=i,u=r*l),this._buildResult(i,o,_,u,l,l)}},Zw.FIXED_HEIGHT=new class extends Zw{constructor(...e){super(...e),this.name="FixedHeight"}apply(e,t){const n=k_.windowSize,i=n.width,o=n.height,a=o/t.height,r=i,s=o;return this._buildResult(i,o,r,s,a,a)}},Zw.FIXED_WIDTH=new class extends Zw{constructor(...e){super(...e),this.name="FixedWidth"}apply(e,t){const n=k_.windowSize,i=n.width,o=n.height,a=i/t.width,r=i,s=o;return this._buildResult(i,o,r,s,a,a)}};class Jw{constructor(e,t){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(e),this.setContentStrategy(t)}get canvasSize(){return k_.windowSize}preApply(e){this._contentStrategy.preApply(e)}apply(e,t){return this._containerStrategy.apply(e,t),this._contentStrategy.apply(e,t)}postApply(e){this._contentStrategy.postApply(e)}setContainerStrategy(e){e instanceof Qw&&(this._containerStrategy=e)}setContentStrategy(e){e instanceof Zw&&(this._contentStrategy=e)}}e("fT",Jw),Jw.EXACT_FIT=0,Jw.NO_BORDER=1,Jw.SHOW_ALL=2,Jw.FIXED_HEIGHT=3,Jw.FIXED_WIDTH=4,Jw.UNKNOWN=5,Jw.ContainerStrategy=Qw,Jw.ContentStrategy=Zw,c.ResolutionPolicy=Jw;const Kw=e("dd",Xw.instance=c.view=new Xw);c.winSize=qw,wn(Xw.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),In(Xw.prototype,"View.prototype",[{name:"adjustViewportMeta"},{name:"enableAutoFullScreen",suggest:"use screen.requestFullScreen() instead."},{name:"isAutoFullScreenEnabled"},{name:"setCanvasSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getCanvasSize",suggest:"please use screen.windowSize instead."},{name:"getFrameSize",suggest:"getting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"setFrameSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getDevicePixelRatio",suggest:"use screen.devicePixelRatio instead."},{name:"convertToLocationInView"},{name:"enableRetina"},{name:"isRetinaEnabled"}]),In(c,"cc",[{name:"winSize",suggest:"please use view.getVisibleSize() instead."}]),In(U_,"sys",[{name:"capabilities",suggest:"please use sys.hasFeature() method instead."}]),Pn(U_,"sys",["UNKNOWN","ENGLISH","CHINESE","FRENCH","ITALIAN","GERMAN","SPANISH","DUTCH","RUSSIAN","KOREAN","JAPANESE","HUNGARIAN","PORTUGUESE","ARABIC","NORWEGIAN","POLISH","TURKISH","UKRAINIAN","ROMANIAN","BULGARIAN"].map((e=>({name:`LANGUAGE_${e}`,newName:e,target:U_.Language,targetName:"sys.Language"})))),Pn(U_,"sys",["UNKNOWN","IOS","ANDROID","WINDOWS","LINUX","OSX"].map((e=>({name:`OS_${e}`,newName:e,target:U_.OS,targetName:"sys.OS"})))),Pn(U_,"sys",["UNKNOWN","WECHAT","ANDROID","IE","EDGE","QQ","MOBILE_QQ","UC","UCBS","BAIDU_APP","BAIDU","MAXTHON","OPERA","OUPENG","MIUI","FIREFOX","SAFARI","CHROME","LIEBAO","QZONE","SOUGOU","HUAWEI"].map((e=>({name:`BROWSER_TYPE_${e}`,newName:e,target:U_.BrowserType,targetName:"sys.BrowserType"})))),Pn(U_,"sys",[{name:"BROWSER_TYPE_360",newName:"BROWSER_360",target:U_.BrowserType,targetName:"sys.BrowserType"}]),Pn(U_,"sys",["UNKNOWN","EDITOR_PAGE","EDITOR_CORE","MOBILE_BROWSER","DESKTOP_BROWSER","WIN32","MACOS","IOS","ANDROID","OHOS","WECHAT_GAME","BAIDU_MINI_GAME","XIAOMI_QUICK_GAME","ALIPAY_MINI_GAME","BYTEDANCE_MINI_GAME","OPPO_MINI_GAME","VIVO_MINI_GAME","HUAWEI_QUICK_GAME","COCOSPLAY","LINKSURE_MINI_GAME","QTT_MINI_GAME"].map((e=>({name:e,target:U_.Platform,targetName:"sys.Platform"})))),Pn(U_,"sys",[{name:"IPHONE",newName:"IOS",target:U_.Platform,targetName:"sys.Platform"},{name:"IPAD",newName:"IOS",target:U_.Platform,targetName:"sys.Platform"}]),wn(U_,"sys",["LINUX","BLACKBERRY","NACL","EMSCRIPTEN","TIZEN","WINRT","WP8","QQ_PLAY","FB_PLAYABLE_ADS"].map((e=>({name:e})))),Pn(U_,"sys",[{name:"windowPixelResolution",target:k_,targetName:"screen",newName:"windowSize"}]),In(k_,"screen",[{name:"autoFullScreen",suggest:"please use screen.requestFullScreen() instead."},{name:"disableAutoFullScreen"}]);class $w{constructor(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new Nl,this.scenes=new Nl,this.paths=new Nl}init(e){(e=>{let t=e.uuids;const n=e.paths,i=e.types,o=e.deps,a=e.paths=Object.create(null);if(!1===e.debug){for(let e=0,n=t.length;e<n;e++)t[e]=Ql(t[e]);for(const e in n){const t=n[e],o=t[1];t[1]=i[o]}}else{const e=Object.create(null);for(let n=0,i=t.length;n<i;n++){const i=t[n];t[n]=e[i]=Ql(i)}t=e}for(const e in n){const i=n[e];a[t[e]]=i}const r=e.scenes;for(const e in r){const n=r[e];r[e]=t[n]}const s=e.packs;for(const e in s){const n=s[e];for(let e=0;e<n.length;++e)n[e]=t[n[e]]}const c=e.versions;if(c)for(const e in c){const n=c[e];for(let e=0;e<n.length;e+=2){const i=n[e];n[e]=t[i]||i}}const l=e.redirect;if(l)for(let e=0;e<l.length;e+=2)l[e]=t[l[e]],l[e+1]=o[l[e+1]];if(e.extensionMap)for(const n in e.extensionMap)Object.prototype.hasOwnProperty.call(e.extensionMap,n)&&e.extensionMap[n].forEach(((i,o)=>{e.extensionMap[n][o]=t[i]||i}))})(e),this.importBase=e.importBase||"",this.nativeBase=e.nativeBase||"",this.base=e.base||"",this.name=e.name||"",this.deps=e.deps||[],this._initUuid(e.uuids),this._initPath(e.paths),this._initScene(e.scenes),this._initPackage(e.packs),this._initVersion(e.versions),this._initRedirect(e.redirect);for(const t in e.extensionMap)Object.prototype.hasOwnProperty.call(e.extensionMap,t)&&e.extensionMap[t].forEach((e=>{const n=this.assetInfos.get(e);n&&(n.extension=t)}))}getInfoWithPath(e,t){if(!e)return null;e=e_(e);const n=this.paths.get(e);if(n){if(!t)return n[0];for(let e=0,i=n.length;e<i;e++){const i=n[e];if(Ne.isChildClassOf(i.ctor,t))return i}}return null}getDirWithPath(e,t,n){"/"===(e=e_(e))[e.length-1]&&(e=e.slice(0,-1));const i=n||[];return this.paths.forEach(((n,o)=>{if(o.startsWith(e)&&((e,t)=>!(e.length>t.length)||47===e.charCodeAt(t.length))(o,e)||!e)for(let e=0,o=n.length;e<o;e++){const o=n[e];t&&!Ne.isChildClassOf(o.ctor,t)||i.push(o)}})),i}getAssetInfo(e){return this.assetInfos.get(e)||null}getSceneInfo(e){return e.endsWith(".scene")||(e+=".scene"),"/"===e[0]||e.startsWith("db://")||(e=`/${e}`),this.scenes.find(((t,n)=>n.endsWith(e)))}destroy(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()}_initUuid(e){if(e){this.assetInfos.clear();for(let t=0,n=e.length;t<n;t++){const n=e[t];this.assetInfos.add(n,{uuid:n})}}}_initPath(e){if(!e)return;const t=this.paths;t.clear();for(const n in e){const i=e[n],o=i[0],a=i[1],r=3===i.length,s=this.assetInfos.get(n);s.path=o,s.ctor=Ne._getClassById(a),t.has(o)?r?t.get(o).push(s):t.get(o).unshift(s):t.add(o,[s])}}_initScene(e){if(!e)return;const t=this.scenes;t.clear();const n=this.assetInfos;for(const i in e){const o=e[i],a=n.get(o);a.url=i,t.add(i,a)}}_initPackage(e){if(!e)return;const t=this.assetInfos;for(const n in e){const i=e[n],o={uuid:n,packedUuids:i,ext:".json"};t.add(n,o);for(let e=0,n=i.length;e<n;e++){const a=i[e],r=t.get(a),s=r.packs;s?1===n?s.unshift(o):s.push(o):r.packs=[o]}}}_initVersion(e){if(!e)return;const t=this.assetInfos;let n=e.import;if(n)for(let e=0,i=n.length;e<i;e+=2){const i=n[e];t.get(i).ver=n[e+1]}if(n=e.native,n)for(let e=0,i=n.length;e<i;e+=2){const i=n[e];t.get(i).nativeVer=n[e+1]}}_initRedirect(e){if(!e)return;const t=this.assetInfos;for(let n=0,i=e.length;n<i;n+=2){const i=e[n];t.get(i).redirect=e[n+1]}}}function eI(e,t){e._uuid&&t.push(e._uuid)}function tI(e,t){const n=Object.getOwnPropertyNames(e);for(let i=0;i<n.length;i++){const o=n[i];if("node"===o||"__eventTargets"===o)continue;const a=e[o];if("object"==typeof a&&a)if(Array.isArray(a))for(let e=0;e<a.length;e++){const n=a[e];n instanceof __&&eI(n,t)}else if(a.constructor&&a.constructor!==Object)a instanceof __&&eI(a,t);else{const e=Object.getOwnPropertyNames(a);for(let n=0;n<e.length;n++){const i=a[e[n]];i instanceof __&&eI(i,t)}}}}function nI(e,t){for(let n=0;n<e._components.length;n++)tI(e._components[n],t);for(let n=0;n<e._children.length;n++)nI(e._children[n],t)}function iI(e,t,n,i){n.push(e._uuid);const o=Qd.getDeps(e._uuid);for(let e=0,a=o.length;e<a;e++){const a=Ml.get(o[e]);if(!a)continue;const r=a._uuid;r in t?t[r]+=i:t[r]=a.refCount+i,n.includes(r)||iI(a,t,n,i)}}const oI=[];var aI=new class{constructor(){this._persistNodeDeps=new Nl,this._toDelete=new Nl,this._eventListener=!1}init(){this._persistNodeDeps.clear(),this._toDelete.clear()}_addPersistNodeRef(e){const t=[];nI(e,t);for(let e=0,n=t.length;e<n;e++){const n=Ml.get(t[e]);n&&n.addRef()}this._persistNodeDeps.add(e.uuid,t)}_removePersistNodeRef(e){if(!this._persistNodeDeps.has(e.uuid))return;const t=this._persistNodeDeps.get(e.uuid);for(let e=0,n=t.length;e<n;e++){const n=Ml.get(t[e]);n&&n.decRef()}this._persistNodeDeps.remove(e.uuid)}_autoRelease(e,t,n){if(e){const n=Qd.getDeps(e.uuid);for(let t=0,i=n.length;t<i;t++){const i=Ml.get(n[t]);i&&i.decRef(e.autoReleaseAssets)}const i=Qd._depends.get(e.uuid);if(i&&i.persistDeps){const t=i.persistDeps;for(let n=0,i=t.length;n<i;n++){const i=Ml.get(t[n]);i&&i.decRef(e.autoReleaseAssets)}}e.uuid!==t.uuid&&Qd.remove(e.uuid)}const i=Qd._depends.get(t.uuid);i&&(i.persistDeps=[]);for(const e in n){const t=n[e],o=this._persistNodeDeps.get(t.uuid);for(const e of o){const t=Ml.get(e);t&&t.addRef()}i&&i.persistDeps.push(...o)}}tryRelease(e,t=!1){e instanceof __&&(t?this._free(e,t):(this._toDelete.add(e._uuid,e),this._eventListener||(this._eventListener=!0,Ke(this._freeAssets.bind(this)))))}_freeAssets(){this._eventListener=!1,this._toDelete.forEach((e=>{this._free(e)})),this._toDelete.clear()}_free(e,t=!1){const n=e._uuid;if(this._toDelete.remove(n),!Bt(e,!0))return;if(!t&&e.refCount>0&&function(e){const t=Object.create(null);if(t[e._uuid]=e.refCount,iI(e,t,oI,-1),oI.length=0,0!==t[e._uuid])return t[e._uuid];for(const e in t)0!==t[e]&&iI(Ml.get(e),t,oI,1);return oI.length=0,t[e._uuid]}(e)>0)return;Ml.remove(n);const i=Qd.getDeps(n);for(let e=0,t=i.length;e<t;e++){const t=Ml.get(i[e]);t&&(t.decRef(!1),this._free(t,!1))}e.destroy(),Qd.remove(n)}};let rI=null;function sI(e,t){for(let n=0,i=e.input.length;n<i;n++){const i=e.input[n];t&&!i.isNative&&i.content instanceof __&&i.content.decRef(!1),i.recycle()}e.input=null}function cI(e,t){return t?/\?/.test(e)?`${e}&_t=${Date.now()}`:`${e}?_t=${Date.now()}`:e}function lI(e,t,n,i,o=0){e(o,((a,r)=>{o++,!a||o>t?i&&i(a,r):setTimeout((()=>{lI(e,t,n,i,o)}),n)}))}function _I(e,t,n,i,o){try{const a=Qd.parse(e,t);for(let e=0,t=a.deps.length;e<t;e++){const t=a.deps[e];t in n||(n[t]=!0,i.push({uuid:t,bundle:o&&o.name}))}a.nativeDep&&(o&&(a.nativeDep.bundle=o.name),i.push({...a.nativeDep}))}catch(e){g(e.message,e.stack)}}function uI(e,t,n){t&&(n=void 0!==n?n:c.assetManager.cacheAsset,$l(t)||!n||t.isDefault||Ml.add(e,t))}function hI(e,t,n){let i=0;const o=[],a=e.length;0===a&&n&&n(o);const r=e=>{e&&o.push(e),i++,i===a&&n&&n(o)};for(let n=0;n<a;n++)t(e[n],r)}function fI(e,t,n){let i=e,o=t,a=n;if(void 0===n){const n="function"==typeof e;t?(a=t,n||(o=null)):void 0===t&&n&&(a=e,i=null,o=null),void 0!==t&&n&&(o=e,i=null)}return{options:i||Object.create(null),onProgress:o,onComplete:a}}function pI(e,t,n){let i=e,o=t,a=n;if(void 0===n){const n=Ne.isChildClassOf(e,__);t?(a=t,n&&(o=null)):void 0!==t||n||(a=e,o=null,i=null),void 0===t||n||(o=e,i=null)}return{type:i,onProgress:o||rI,onComplete:a}}function dI(e,t,n,i={}){if(!n[t]||i[t])return!1;i[t]=!0;let o=!1;const a=Qd.getDeps(t);if(a)for(let t=0,r=a.length;t<r;t++){const r=a[t];if(r===e||dI(e,r,n,i)){o=!0;break}}return o}function mI(e){return(t,n)=>{if(!e)return;const i=[];Array.isArray(n)?n.forEach((e=>e instanceof __&&i.push(e.addRef()))):n instanceof __&&i.push(n.addRef()),Ke((()=>{i.forEach((e=>e.decRef(!1))),e(t,n)}))}}class AI{constructor(){this._config=new $w}get config(){return this._config}get name(){return this._config.name}get deps(){return this._config.deps}get base(){return this._config.base}getInfoWithPath(e,t){return this._config.getInfoWithPath(e,t)}getDirWithPath(e,t,n){return this._config.getDirWithPath(e,t,n)}getAssetInfo(e){return this._config.getAssetInfo(e)}getSceneInfo(e){return this._config.getSceneInfo(e)}init(e){this._config.init(e),Fl.add(e.name,this)}load(e,t,n,i){const{type:o,onProgress:a,onComplete:r}=pI(t,n,i),s={__requestType__:Gl.PATH,type:o,bundle:this.name,__outputAsArray__:Array.isArray(e)};c.assetManager.loadAny(e,s,a,r)}preload(e,t,n,i){const{type:o,onProgress:a,onComplete:r}=pI(t,n,i);c.assetManager.preloadAny(e,{__requestType__:Gl.PATH,type:o,bundle:this.name},a,r)}loadDir(e,t,n,i){const{type:o,onProgress:a,onComplete:r}=pI(t,n,i);c.assetManager.loadAny(e,{__requestType__:Gl.DIR,type:o,bundle:this.name,__outputAsArray__:!0},a,r)}preloadDir(e,t,n,i){const{type:o,onProgress:a,onComplete:r}=pI(t,n,i);c.assetManager.preloadAny(e,{__requestType__:Gl.DIR,type:o,bundle:this.name},a,r)}loadScene(e,t,n,i){const{options:o,onProgress:a,onComplete:r}=fI(t,n,i);o.preset=o.preset||"scene",o.bundle=this.name,c.assetManager.loadAny({scene:e},o,a,((e,t)=>{if(e)g(e.message,e.stack);else if(t instanceof KP&&t.scene){const e=t.scene;e._id=t._uuid,e.name=t.name}else e=new Error(`The asset ${t._uuid} is not a scene`);r&&r(e,t)}))}preloadScene(e,t,n,i){const{options:o,onProgress:a,onComplete:r}=fI(t,n,i);o.bundle=this.name,c.assetManager.preloadAny({scene:e},o,a,(t=>{t&&R(1210,e,t.message),r&&r(t)}))}get(e,t){const n=this.getInfoWithPath(e,t);return n&&Ml.get(n.uuid)||null}release(e,t){const n=this.get(e,t);n&&aI.tryRelease(n,!0)}releaseUnusedAssets(){Ml.forEach((e=>{const t=this.getAssetInfo(e._uuid);t&&!t.redirect&&aI.tryRelease(e)}))}releaseAll(){Ml.forEach((e=>{const t=this.getAssetInfo(e._uuid);t&&!t.redirect&&aI.tryRelease(e,!0)}))}_destroy(){this._config.destroy()}}const vI=e("gc",new AI);function gI(e,t,n){const i=new Image;function o(){i.removeEventListener("load",o),i.removeEventListener("error",a),n&&n(null,i)}function a(){i.removeEventListener("load",o),i.removeEventListener("error",a),n&&n(new Error(M(4930,e)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.addEventListener("load",o),i.addEventListener("error",a),i.src=e,i}function xI(e,t,n,i){const o=new XMLHttpRequest,a=`download failed: ${e}, status: `;if(o.open("GET",e,!0),void 0!==t.xhrResponseType&&(o.responseType=t.xhrResponseType),void 0!==t.xhrWithCredentials&&(o.withCredentials=t.xhrWithCredentials),void 0!==t.xhrMimeType&&o.overrideMimeType&&o.overrideMimeType(t.xhrMimeType),void 0!==t.xhrTimeout&&(o.timeout=t.xhrTimeout),t.xhrHeader)for(const e in t.xhrHeader)o.setRequestHeader(e,t.xhrHeader[e]);return o.onload=()=>{200===o.status||0===o.status?i&&i(null,o.response):i&&i(new Error(`${a}${o.status}(no response)`))},n&&(o.onprogress=e=>{e.lengthComputable&&n(e.loaded,e.total)}),o.onerror=()=>{i&&i(new Error(`${a}${o.status}(error)`))},o.ontimeout=()=>{i&&i(new Error(`${a}${o.status}(time out)`))},o.onabort=()=>{i&&i(new Error(`${a}${o.status}(abort)`))},o.send(null),o}c.resources=vI;const yI={};function bI(e,t,n){if(yI[e])return n&&n(null),null;const i=document.createElement("script");function o(){i.parentNode.removeChild(i),i.removeEventListener("load",o,!1),i.removeEventListener("error",a,!1),yI[e]=!0,n&&n(null)}function a(){i.parentNode.removeChild(i),i.removeEventListener("load",o,!1),i.removeEventListener("error",a,!1),n&&n(new Error(M(4928,e)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.async=t.scriptAsyncLoading||!1,i.src=e,i.addEventListener("load",o,!1),i.addEventListener("error",a,!1),document.body.appendChild(i),i}const SI=/^(?:\w+:\/\/|\.+\/).+/,CI=(e,t,n)=>{(U_.hasFeature(U_.Feature.IMAGE_BITMAP)&&c.assetManager.allowImageBitmap?EI:gI)(e,t,n)},EI=(e,t,n)=>{t.xhrResponseType="blob",xI(e,t,t.onFileProgress,n)},TI=(e,t,n)=>{t.xhrResponseType="json",xI(e,t,t.onFileProgress,n)},PI=(e,t,n)=>{t.xhrResponseType="arraybuffer",xI(e,t,t.onFileProgress,n)},wI=(e,t,n)=>{TI(e,t,((t,i)=>{if(t)return void n(t);const o=H_(i);Promise.all(o.chunks.map((n=>new Promise(((i,o)=>{PI(`${ln(e)}${n}`,{},((e,n)=>{t?o(t):i(new Uint8Array(n))}))}))))).then((e=>{const t=new V_(o.document,e);n(null,t)})).catch((e=>{n(e)}))}))},II=(e,t,n)=>{PI(e,t,((e,t)=>{if(e)n(e);else try{const e=W_(new Uint8Array(t));n(null,e)}catch(e){n(e)}}))},RI=(e,t,n)=>{t.xhrResponseType="text",xI(e,t,t.onFileProgress,n)},DI=(e,t,n)=>{const i=_n(e);let o=e;SI.test(o)||(o=-1!==NI.remoteBundles.indexOf(i)?`${NI.remoteServerAddress}remote/${i}`:`assets/${i}`);const a=t.version||NI.bundleVers[i];let r=0,s=null,c=null;TI(`${o}/config.${a?`${a}.`:""}json`,t,((e,t)=>{c=e,s=t,s&&(s.base=`${o}/`),2==++r&&n(c,s)})),bI(`${o}/index.${a?`${a}.`:""}js`,t,(e=>{c=e,2==++r&&n(e,s)}))},NI=e("dy",new class{constructor(){this.maxConcurrency=6,this.maxRequestsPerFrame=6,this.maxRetryCount=3,this.appendTimeStamp=!!i,this.limited=!i,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=gI,this.downloadDomAudio=null,this.downloadFile=xI,this.downloadScript=bI,this._downloaders={".png":CI,".jpg":CI,".bmp":CI,".jpeg":CI,".gif":CI,".ico":CI,".tiff":CI,".webp":CI,".image":CI,".pvr":PI,".pkm":PI,".astc":PI,".txt":RI,".xml":RI,".vsh":RI,".fsh":RI,".atlas":RI,".tmx":RI,".tsx":RI,".json":TI,".ExportJson":TI,".plist":RI,".ccon":wI,".cconb":II,".fnt":RI,".binary":PI,".bin":PI,".dbbin":PI,".skel":PI,".js":bI,bundle:DI,default:RI},this._downloading=new Nl,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}get remoteServerAddress(){return this._remoteServerAddress}init(e="",t={},n=[]){this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=e,this.bundleVers=t,this.remoteBundles=n}register(e,t){"object"==typeof e?fe(this._downloaders,e):this._downloaders[e]=t}download(e,t,n,i,o){const a=zl.get(e);if(a)return void o(null,a);const r=this._downloading.get(e);if(r){r.push(o);const t=this._queue.find((t=>t.id===e));if(!t)return;const n=i.priority||0;return void(t.priority<n&&(t.priority=n,this._queueDirty=!0))}const s=void 0!==i.maxRetryCount?i.maxRetryCount:this.maxRetryCount,c=void 0!==i.maxConcurrency?i.maxConcurrency:this.maxConcurrency,l=void 0!==i.maxRequestsPerFrame?i.maxRequestsPerFrame:this.maxRequestsPerFrame,_=this._downloaders[n]||this._downloaders.default;lI(((n,a)=>{if(0===n&&this._downloading.add(e,[o]),!this.limited)return void _(cI(t,this.appendTimeStamp),i,a);this._updateTime();const r=(e,t)=>{this._totalNum--,this._handleQueueInNextFrame(c,l),a(e,t)};this._totalNum<c&&this._totalNumThisPeriod<l?(_(cI(t,this.appendTimeStamp),i,r),this._totalNum++,this._totalNumThisPeriod++):(this._queue.push({id:e,priority:i.priority||0,url:t,options:i,done:r,handler:_}),this._queueDirty=!0,this._totalNum<c&&this._handleQueueInNextFrame(c,l))}),s,this.retryInterval,((t,n)=>{t||zl.add(e,n);const i=this._downloading.remove(e);for(let e=0,o=i.length;e<o;e++)i[e](t,n)}))}loadSubpackage(e,t){c.assetManager.loadBundle(e,null,t)}_updateTime(){const e=performance.now(),t=c.game.deltaTime,n=t>this._maxInterval?this._maxInterval:t;e-this._lastDate>1e3*n&&(this._totalNumThisPeriod=0,this._lastDate=e)}_handleQueue(e,t){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<e&&this._totalNumThisPeriod<t;){this._queueDirty&&(this._queue.sort(((e,t)=>e.priority-t.priority)),this._queueDirty=!1);const e=this._queue.pop();if(!e)break;this._totalNum++,this._totalNumThisPeriod++,e.handler(cI(e.url,this.appendTimeStamp),e.options,e.done)}this._handleQueueInNextFrame(e,t)}_handleQueueInNextFrame(e,t){!this._checkNextPeriod&&this._queue.length>0&&(Ke(this._handleQueue.bind(this),e,t),this._checkNextPeriod=!0)}});function OI(e,t,n,i){let o=null,a=null;try{o=new Id,o._nativeUrl=e,o._nativeAsset=t}catch(e){a=e}i(a,o)}function MI(e,t,n,i){const o=new sw;o.json=t,i(null,o)}function zI(e,t,n,i){const o=new nw;o.text=t,i(null,o)}function LI(e,t,n,i){const o=new Fb;o._nativeUrl=e,o._nativeAsset=t,i(null,o)}function FI(e,t,n,i){const o=new __;o._nativeUrl=e,o._nativeAsset=t,i(null,o)}function BI(e,n,i,o){let a=Fl.get(n.name);a||(a=n.name===Vl.RESOURCES?vI:new AI,n.base=n.base||`${e}/`,a.init(n)),t.import(`virtual:///prerequisite-imports/${a.name}`).then((()=>{o(null,a)})).catch(o)}var kI=e("dz",new class{constructor(){this._creating=new Nl,this._producers={".png":OI,".jpg":OI,".bmp":OI,".jpeg":OI,".gif":OI,".ico":OI,".tiff":OI,".webp":OI,".image":OI,".pvr":OI,".pkm":OI,".txt":zI,".xml":zI,".vsh":zI,".fsh":zI,".atlas":zI,".tmx":zI,".tsx":zI,".fnt":zI,".json":MI,".ExportJson":MI,".binary":LI,".bin":LI,".dbbin":LI,".skel":LI,bundle:BI,default:FI}}register(e,t){"object"==typeof e?Ne.mixin(this._producers,e):this._producers[e]=t}create(e,t,n,i,o){const a=this._producers[n]||this._producers.default,r=Ml.get(e);if(!i.reloadAsset&&r)return void o(null,r);const s=this._creating.get(e);s?s.push(o):(this._creating.add(e,[o]),a(e,t,i,((t,n)=>{!t&&n instanceof __&&(n._uuid=e,uI(e,n,i.cacheAsset));const o=this._creating.remove(e);for(let e=0,i=o.length;e<i;e++)o[e](t,n)})))}}),UI=new class{constructor(){this._loading=new Nl,this._unpackers={".json":this.unpackJson}}unpackJson(e,t,n,i){let o=Ne.createMap(!0),a=null;if(Array.isArray(t)){(t=function(e){if(e[0]<1)throw new Error(M(5304,e[0]));uu(e,!0,void 0,fu.reportMissingClass),hu(e);const t=new pu(e[0]),n=e[1],i=e[2],o=e[3],a=e[4],r=e[5];for(let e=0;e<r.length;++e)r[e].unshift(t,n,i,o,a);return r}(t)).length!==e.length&&R(4915);for(let n=0;n<e.length;n++)o[`${e[n]}@import`]=t[n]}else{const n=Ne._getClassId(om),i=Ne._getClassId(Id);if(t.type===n&&t.data){const i=t.data;i.length!==e.length&&R(4915);for(let t=0;t<e.length;t++)o[`${e[t]}@import`]=du(n,{base:i[t][0],mipmaps:i[t][1]})}else if(t.type===i&&t.data){const n=t.data;n.length!==e.length&&R(4915);for(let t=0;t<e.length;t++)o[`${e[t]}@import`]=n[t]}else a=new Error("unmatched type pack!"),o=null}i(a,o)}init(){this._loading.clear()}register(e,t){"object"==typeof e?Ne.mixin(this._unpackers,e):this._unpackers[e]=t}unpack(e,t,n,i,o){t?(0,this._unpackers[n])(e,t,i,o):o(new Error("package data is wrong!"))}load(e,t,n){if(e.isNative||!e.info||!e.info.packs)return void NI.download(e.id,e.url,e.ext,e.options,n);if(zl.has(e.id))return void n(null,zl.get(e.id));const i=e.info.packs;let o=i.find((e=>this._loading.has(e.uuid)));if(o)return void this._loading.get(o.uuid).push({onComplete:n,id:e.id});o=i[0],this._loading.add(o.uuid,[{onComplete:n,id:e.id}]);const a=t_(o.uuid,{ext:o.ext,bundle:e.config.name});NI.download(o.uuid,a,o.ext,e.options,((t,n)=>{zl.remove(o.uuid),t&&g(t.message,t.stack),this.unpack(o.packedUuids,n,o.ext,e.options,((e,n)=>{if(!e)for(const e in n)zl.add(e,n[e]);const i=this._loading.remove(o.uuid);for(let o=0,a=i.length;o<a;o++){const a=i[o];if(t||e){a.onComplete(t||e);continue}const r=n[a.id];r?a.onComplete(null,r):a.onComplete(new Error("can not retrieve data from package"))}}))}))}};function GI(e,t){let n=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},n=!0);const{options:i,progress:o}=e,a=[],r=o.total,s=i.__exclude__=i.__exclude__||Object.create(null);e.output=[],hI(e.input,((i,l)=>{if(!i.isNative&&Ml.has(i.uuid)){const t=Ml.get(i.uuid);return i.content=t.addRef(),e.output.push(i),o.canInvoke&&e.dispatch("progress",++o.finish,o.total,i),void l()}UI.load(i,e.options,((_,u)=>{_?e.isFinish||(!c.assetManager.force||n?(g(_.message,_.stack),o.canInvoke=!1,t(_)):(e.output.push(i),o.canInvoke&&e.dispatch("progress",++o.finish,o.total,i))):e.isFinish||(i.file=u,e.output.push(i),i.isNative||(s[i.uuid]=!0,_I(i.uuid,u,s,a,i.config),o.total=r+a.length),o.canInvoke&&e.dispatch("progress",++o.finish,o.total,i)),l()}))}),(()=>{if(e.isFinish)return sI(e,!0),void e.dispatch("error");if(a.length>0){const r=Hl.create({input:a,progress:o,options:i,onProgress:e.onProgress,onError:Hl.prototype.recycle,onComplete:i=>{i||(e.output.push(...r.output),r.recycle()),n&&jI(e),t(i)}});kl.async(r)}else n&&jI(e),t()}))}function jI(e){const t=e.output;for(let e=0,n=t.length;e<n;e++)t[e].content&&t[e].content.decRef(!1)}class VI{constructor(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}parse(e){return this._parseXML(e)}_parseXML(e){if(this._parser)return this._parser.parseFromString(e,"text/xml");throw new Error("Dom parser is not supported in this platform!")}}e("eZ",VI);const HI=new class extends VI{parse(e){const t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return w(5100),{};let n=null;for(let e=0,i=t.childNodes.length;e<i&&(n=t.childNodes[e],1!==n.nodeType);e++);return this._parseNode(n)}_parseNode(e){let t=null;const n=e.tagName;if("dict"===n)t=this._parseDict(e);else if("array"===n)t=this._parseArray(e);else if("string"===n)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(let n=0;n<e.childNodes.length;n++)t+=e.childNodes[n].nodeValue}else"false"===n?t=!1:"true"===n?t=!0:"real"===n?t=parseFloat(e.firstChild.nodeValue):"integer"===n&&(t=parseInt(e.firstChild.nodeValue,10));return t}_parseArray(e){const t=[];for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];1===i.nodeType&&t.push(this._parseNode(i))}return t}_parseDict(e){const t={};let n="";for(let i=0,o=e.childNodes.length;i<o;i++){const o=e.childNodes[i];1===o.nodeType&&("key"===o.tagName?n=o.firstChild.nodeValue:t[n]=this._parseNode(o))}return t}};function WI(e,t){return e[t]<<8|e[t+1]}var qI=new class{constructor(){this._parsing=new Nl,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.parseImport,".ccon":this.parseImport,".cconb":this.parseImport}}parseImage(e,t,n){e instanceof HTMLImageElement?n(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((e=>{n(null,e)}),(e=>{n(e,null)}))}parsePVRTex(e,t,n){let i=null,o=null;try{const t=e instanceof ArrayBuffer?e:e.buffer,n=new Int32Array(t,0,13);if(55727696===n[0]){const e=n[7],i=n[6],a=n[12]+52;o={_data:new Uint8Array(t,a),_compressed:!0,width:e,height:i,format:0}}else{if(559044176!==n[11])throw new Error("Invalid magic number in PVR header");{const e=n[0],i=n[1],a=n[2];o={_data:new Uint8Array(t,e),_compressed:!0,width:a,height:i,format:0}}}}catch(e){i=e}n(i,o)}parsePKMTex(e,t,n){let i=null,o=null;try{const t=e instanceof ArrayBuffer?e:e.buffer,n=new Uint8Array(t),i=WI(n,6);if(0!==i&&1!==i&&3!==i)throw new Error("Invalid magic number in ETC header");const a=WI(n,12),r=WI(n,14);WI(n,8),WI(n,10),o={_data:new Uint8Array(t,16),_compressed:!0,width:a,height:r,format:0}}catch(e){i=e}n(i,o)}parseASTCTex(e,t,n){let i=null,o=null;try{const t=e instanceof ArrayBuffer?e:e.buffer,n=new Uint8Array(t);if(1554098963!==n[0]+(n[1]<<8)+(n[2]<<16)+(n[3]<<24))throw new Error("Invalid magic number in ASTC header");const i=n[4],a=n[5],r=n[6];if((i<3||i>6||a<3||a>6||r<3||r>6)&&(i<4||7===i||9===i||11===i||i>12||a<4||7===a||9===a||11===a||a>12||1!==r))throw new Error("Invalid block number in ASTC header");const s=function(e,t){return 4===e?xd.RGBA_ASTC_4x4:5===e?4===t?xd.RGBA_ASTC_5x4:xd.RGBA_ASTC_5x5:6===e?5===t?xd.RGBA_ASTC_6x5:xd.RGBA_ASTC_6x6:8===e?5===t?xd.RGBA_ASTC_8x5:6===t?xd.RGBA_ASTC_8x6:xd.RGBA_ASTC_8x8:10===e?5===t?xd.RGBA_ASTC_10x5:6===t?xd.RGBA_ASTC_10x6:8===t?xd.RGBA_ASTC_10x8:xd.RGBA_ASTC_10x10:10===t?xd.RGBA_ASTC_12x10:xd.RGBA_ASTC_12x12}(i,a),c=n[7]+(n[8]<<8)+(n[9]<<16),l=n[10]+(n[11]<<8)+(n[12]<<16);n[13],n[14],n[15],o={_data:new Uint8Array(t,16),_compressed:!0,width:c,height:l,format:s}}catch(e){i=e}n(i,o)}parsePlist(e,t,n){let i=null;const o=HI.parse(e);o||(i=new Error("parse failed")),n(i,o)}parseImport(e,t,n){if(!e)return void n(new Error(`The json file of asset ${t.__uuid__} is empty or missing`));let i=null,o=null;try{i=Yd(e,t)}catch(e){o=e}n(o,i)}init(){this._parsing.clear()}register(e,t){"object"==typeof e?fe(this._parsers,e):this._parsers[e]=t}parse(e,t,n,i,o){const a=Ll.get(e);if(a)return void o(null,a);const r=this._parsing.get(e);if(r)return void r.push(o);const s=this._parsers[n];s?(this._parsing.add(e,[o]),s(t,i,((t,n)=>{t?zl.remove(e):$l(n)||Ll.add(e,n);const i=this._parsing.remove(e);for(let e=0,o=i.length;e<o;e++)i[e](t,n)}))):o(null,t)}};function YI(e,t){let n=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},n=!0);const{options:i,progress:o}=e;i.__exclude__=i.__exclude__||Object.create(null),e.output=[],hI(e.input,((a,r)=>{const s=Hl.create({input:a,onProgress:e.onProgress,options:i,progress:o,onComplete:(i,l)=>{i&&!e.isFinish&&(!c.assetManager.force||n?(g(i.message,i.stack),o.canInvoke=!1,t(i)):o.canInvoke&&e.dispatch("progress",++o.finish,o.total,a)),e.output.push(l),s.recycle(),r(null)}});XI.async(s)}),(()=>{if(i.__exclude__=null,e.isFinish)return sI(e,!0),void e.dispatch("error");!function(e){const t=e.source;if(e.options.__outputAsArray__||1!==t.length){const n=e.output=[];for(let e=0,i=t.length;e<i;e++)n.push(t[e].content)}else e.output=t[0].content}(e),sI(e,!0),t()}))}const XI=new Ol("loadOneAsset",[function(e,t){const n=e.output=e.input,{options:i,isNative:o,uuid:a,file:r}=n,{reloadAsset:s}=i;r||!s&&!o&&Ml.has(a)?t():UI.load(n,e.options,((e,i)=>{n.file=i,t(e)}))},function(e,t){const n=e.output=e.input,i=e.progress,o=e.options.__exclude__,{id:a,file:r,options:s}=n;if(n.isNative)qI.parse(a,r,n.ext,s,((o,r)=>{o?t(o):(n.content=r,i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),zl.remove(a),Ll.remove(a),t())}));else{const{uuid:c}=n;if(c in o){const{finish:a,content:r,err:s,callbacks:l}=o[c];i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),a||dI(c,c,o)?(r&&r.addRef(),n.content=r,t(s)):l.push({done:t,item:n})}else if(!s.reloadAsset&&Ml.has(c)){const o=Ml.get(c);n.content=o.addRef(),i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),t()}else s.__uuid__=c,qI.parse(a,r,"import",s,((n,i)=>{n?t(n):function(e,t,n){const{input:i,progress:o}=e,{uuid:a,id:r,options:s,config:c}=i,{cacheAsset:l}=s,_=[];t.addRef&&t.addRef(),_I(a,t,Object.create(null),_,c),o.canInvoke&&e.dispatch("progress",++o.finish,o.total+=_.length,i);const u=e.options.__exclude__[a]={content:t,finish:!1,callbacks:[{done:n,item:i}]},h=Hl.create({input:_,options:e.options,onProgress:e.onProgress,onError:Hl.prototype.recycle,progress:o,onComplete:e=>{if(t.decRef&&t.decRef(!1),u.finish=!0,u.err=e,!e){const e=Array.isArray(h.output)?h.output:[h.output],n=Object.create(null);for(const t of e)t&&(n[t instanceof __?`${t._uuid}@import`:`${a}@native`]=t);!function(e,t,n){let i=!1;const o=Hd.get(t);if(o){for(let e=0,t=o.length;e<t;e++){const t=o[e],a=n[`${t.uuid}@import`];if(a)t.owner[t.prop]=a.addRef();else{if(g(`The asset ${t.uuid} is missing!`),t.type&&t.type!==__){const e=new t.type;e.initDefault(t.uuid),t.owner[t.prop]=e}i=!0}}Hd.delete(t)}Wd.has(t)&&(n[`${e}@native`]?t._nativeAsset=n[`${e}@native`]:(i=!0,console.error(`the native asset of ${e} is missing!`)),Wd.delete(t))}(a,t,n);try{"function"!=typeof t.onLoaded||qd.has(t)||Wd.has(t)||(t.onLoaded(),qd.add(t))}catch(e){g(`The asset ${a} is invalid for some reason, detail message: ${e.message}, stack: ${e.stack}`)}zl.remove(r),Ll.remove(r),uI(a,t,l),h.recycle()}const n=u.callbacks;for(let i=0,o=n.length;i<o;i++){const o=n[i];t.addRef&&t.addRef(),o.item.content=t,o.done(e)}n.length=0}});Bl.async(h)}(e,i,t)}))}}]);function QI(e,t){const n=e.options,i=Object.create(null),o=Object.create(null);for(const e in n)switch(e){case Gl.PATH:case Gl.UUID:case Gl.DIR:case Gl.SCENE:case Gl.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":i[e]=n[e];break;case"__exclude__":case"__outputAsArray__":o[e]=n[e];break;default:i[e]=n[e],o[e]=n[e]}e.options=o;const a=Hl.create({input:e.input,options:i});let r=null;try{e.output=e.source=Ul.sync(a)}catch(e){r=e;for(let e=0,t=a.output.length;e<t;e++)a.output[e].recycle()}a.recycle(),t(r)}class ZI{constructor(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}get id(){return this._id||(this._id=`${this.uuid}@${this.isNative?"native":"import"}`),this._id}static create(){let e;return e=0!==ZI._deadPool.length?ZI._deadPool.pop():new ZI,e}recycle(){ZI._deadPool.length!==ZI.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),ZI._deadPool.push(this))}}ZI.MAX_DEAD_NUM=500,ZI._deadPool=[];const JI=[];function KI(e){var t;const n=e.options,i=Array.isArray(e.input)?e.input:[e.input];e.output=[];for(let a=0;a<i.length;a++){let r=i[a],s=ZI.create(),c=null,l=null;if("string"==typeof r&&(r=Object.create(null),r[n.__requestType__||Gl.UUID]=i[a]),"object"==typeof r){he(r,n),r.preset&&he(r,jl[r.preset]);for(const e in r){switch(e){case Gl.UUID:{var o;const e=s.uuid=Ql(r.uuid);if(!r.bundle){const t=Fl.find((t=>!!t.getAssetInfo(e)));r.bundle=t&&t.name}if(Fl.has(r.bundle)){if(c=Fl.get(r.bundle).config,l=c.getAssetInfo(e),l&&l.redirect){if(!Fl.has(l.redirect))throw new Error(`Please load bundle ${l.redirect} first`);c=Fl.get(l.redirect).config,l=c.getAssetInfo(e)}s.config=c,s.info=l}s.ext=r.ext||(null===(o=l)||void 0===o?void 0:o.extension)||".json";break}case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case Gl.DIR:if(Fl.has(r.bundle)){Fl.get(r.bundle).config.getDirWithPath(r.dir,r.type,JI);for(const e of JI)i.push({uuid:e.uuid,__isNative__:!1,ext:e.extension||".json",bundle:r.bundle});JI.length=0}s.recycle(),s=null;break;case Gl.PATH:if(Fl.has(r.bundle)){if(c=Fl.get(r.bundle).config,l=c.getInfoWithPath(r.path,r.type),l&&l.redirect){if(!Fl.has(l.redirect))throw new Error(`you need to load bundle ${l.redirect} first`);c=Fl.get(l.redirect).config,l=c.getAssetInfo(l.uuid)}if(!l)throw s.recycle(),new Error(`Bundle ${r.bundle} doesn't contain ${r.path}`);s.config=c,s.uuid=l.uuid,s.info=l}s.ext=r.ext||(null===(t=l)||void 0===t?void 0:t.extension)||".json";break;case Gl.SCENE:if(!r.bundle){const e=Fl.find((e=>!!e.getSceneInfo(r.scene)));r.bundle=e&&e.name}if(Fl.has(r.bundle)){if(c=Fl.get(r.bundle).config,l=c.getSceneInfo(r.scene),l&&l.redirect){if(!Fl.has(l.redirect))throw new Error(`you need to load bundle ${l.redirect} first`);c=Fl.get(l.redirect).config,l=c.getAssetInfo(l.uuid)}if(!l)throw s.recycle(),new Error(`Bundle ${c.name} doesn't contain scene ${r.scene}`);s.config=c,s.uuid=l.uuid,s.info=l}break;case"__isNative__":s.isNative=r.__isNative__;break;case Gl.URL:s.url=r.url,s.uuid=r.uuid||r.url,s.ext=r.ext||cn(r.url),s.isNative=void 0===r.__isNative__||r.__isNative__;break;default:s.options[e]=r[e]}if(!s)break}}if(s&&(e.output.push(s),!s.uuid&&!s.url))throw new Error(`Can not parse this input:${JSON.stringify(r)}`)}return null}function $I(e){const t=e.output=e.input;for(let e=0;e<t.length;e++){const n=t[e];if(n.url)continue;let i="",o="";const a=n.config;o=n.isNative?a&&a.nativeBase?a.base+a.nativeBase:c.assetManager.generalNativeBase:a&&a.importBase?a.base+a.importBase:c.assetManager.generalImportBase;const r=n.uuid;let s="";n.info&&(s=n.isNative?n.info.nativeVer?`.${n.info.nativeVer}`:"":n.info.ver?`.${n.info.ver}`:""),i=".ttf"===n.ext?`${o}/${r.slice(0,2)}/${r}${s}/${n.options.__nativeName__}`:`${o}/${r.slice(0,2)}/${r}${s}${n.ext}`,n.url=i}return null}class eR{constructor(){this.pipeline=Bl.append(QI).append(YI),this.fetchPipeline=kl.append(QI).append(GI),this.transformPipeline=Ul.append(KI).append($I),this.bundles=Fl,this.assets=Ml,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=Qd,this.force=!1,this.allowImageBitmap=!U_.isMobile,this.utils=n_,this.downloader=NI,this.parser=qI,this.packManager=UI,this.cacheAsset=!0,this.cacheManager=null,this.presets=jl,this.factory=kI,this.preprocessPipe=QI,this.fetchPipe=GI,this.loadPipe=YI,this.references=null,this._releaseManager=aI,this._files=zl,this._parsed=Ll,this._parsePipeline=null}get main(){return Fl.get(Vl.MAIN)||null}get resources(){return Fl.get(Vl.RESOURCES)||null}init(e={}){this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e.server,e.bundleVers,e.remoteBundles),this.parser.init(),this.dependUtil.init();let t=e.importBase||"";t&&t.endsWith("/")&&(t=t.substr(0,t.length-1));let n=e.nativeBase||"";n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),this.generalImportBase=t,this.generalNativeBase=n}getBundle(e){return Fl.get(e)||null}removeBundle(e){e._destroy(),Fl.remove(e.name)}loadAny(e,t,n,i){const{options:o,onProgress:a,onComplete:r}=fI(t,n,i);o.preset=o.preset||"default",e=Array.isArray(e)?e.slice():e;const s=Hl.create({input:e,onProgress:a,onComplete:mI(r),options:o});Bl.async(s)}preloadAny(e,t,n,i){const{options:o,onProgress:a,onComplete:r}=fI(t,n,i);o.preset=o.preset||"preload",e=Array.isArray(e)?e.slice():e;const s=Hl.create({input:e,onProgress:a,onComplete:mI(r),options:o});kl.async(s)}loadRemote(e,t,n){const{options:i,onComplete:o}=fI(t,void 0,n);i.reloadAsset||!this.assets.has(e)?(i.__isNative__=!0,i.preset=i.preset||"remote",this.loadAny({url:e},i,null,((t,n)=>{t?(g(t.message,t.stack),o&&o(t,n)):kI.create(e,n,i.ext||cn(e),i,((e,t)=>{o&&o(e,t)}))}))):mI(o)(null,this.assets.get(e))}loadBundle(e,t,n){const{options:i,onComplete:o}=fI(t,void 0,n),a=_n(e);this.bundles.has(a)?mI(o)(null,this.getBundle(a)):(i.preset=i.preset||"bundle",i.ext="bundle",i.__isNative__=!0,this.loadAny({url:e},i,null,((t,n)=>{t?(g(t.message,t.stack),o&&o(t,n)):kI.create(e,n,"bundle",i,((e,t)=>{o&&o(e,t)}))})))}releaseAsset(e){aI.tryRelease(e,!0)}releaseUnusedAssets(){Ml.forEach((e=>{aI.tryRelease(e)}))}releaseAll(){Ml.forEach((e=>{aI.tryRelease(e,!0)}))}loadWithJson(e,t,n,i){throw new Error("Only valid in Editor")}}e("gb",eR),eR.Pipeline=Ol,eR.Task=Hl,eR.Cache=Nl,eR.RequestItem=ZI,eR.Bundle=AI,eR.BuiltinBundleName=Vl;var tR=e("eA",c.assetManager=new eR);c.AssetManager=eR;const nR=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],iR=[".mp3",".ogg",".wav",".m4a"];function oR(){return!0}const aR={transformURL(e){const t=Jl(e);if(!t)return e;const n=Fl.find((e=>!!e.getAssetInfo(t)));if(!n)return e;let i="";const o=n.getAssetInfo(t);if(i=e.startsWith(n.base+n.config.nativeBase)?o.nativeVer||"":o.ver||"",!i||-1!==e.indexOf(i))return e;let a=!1;if(".ttf"===cn(e)&&(a=!0),a){const t=un(e),n=_n(e);e=`${t}.${i}/${n}`}else e=e.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,})/,(e=>`${e}.${i}`));return e}};class rR{constructor(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=pI}set onProgress(e){rI=e}get _cache(){if(Ml instanceof Nl)return Ml._map;{const e={};return Ml.forEach(((t,n)=>{e[n]=t})),e}}load(e,t,n){void 0===n&&void 0!==t&&(n=t,t=null);const i=Array.isArray(e)?e:[e];for(let e=0;e<i.length;e++){const t=i[e];"string"==typeof t?i[e]={url:t,__isNative__:!0}:(t.type&&(t.ext=`.${t.type}`,t.type=void 0),t.url&&(t.__isNative__=!0))}const o=[],a=[];tR.loadAny(i,null,((e,n,i)=>{i.content&&(nR.includes(i.ext)?o.push(i.content):iR.includes(i.ext)&&a.push(i.content)),t&&t(e,n,i)}),((e,t)=>{let r=null;if(!e){t=Array.isArray(t)?t:[t];for(let e=0;e<t.length;e++){const n=t[e];if(!(n instanceof __)){let r=n;const s=i[e].url;o.includes(r)?kI.create(s,n,".png",{},((n,i)=>{r=t[e]=i})):a.includes(r)&&kI.create(s,n,".mp3",{},((n,i)=>{r=t[e]=i})),Ml.add(s,r)}}if(t.length>1){const e=Object.create(null);t.forEach((t=>{e[t._uuid]=t})),r={isCompleted:oR,_map:e}}else r=t[0]}n&&n(e,r)}))}getXMLHttpRequest(){return new XMLHttpRequest}getItem(e){return tR.assets.has(e)?{content:tR.assets.get(e)}:null}loadRes(e,t,n,i){const{type:o,onProgress:a,onComplete:r}=this._parseLoadResArgs(t,n,i),s=cn(e);s&&!vI.getInfoWithPath(e,o)&&(e=e.slice(0,-s.length)),vI.load(e,o,a,r)}loadResArray(e,t,n,i){const{type:o,onProgress:a,onComplete:r}=this._parseLoadResArgs(t,n,i);e.forEach(((t,n)=>{const i=cn(t);i&&!vI.getInfoWithPath(t,o)&&(e[n]=t.slice(0,-i.length))})),vI.load(e,o,a,r)}loadResDir(e,t,n,i){const{type:o,onProgress:a,onComplete:r}=this._parseLoadResArgs(t,n,i);vI.loadDir(e,o,a,((t,n)=>{let i=[];t||(i=vI.getDirWithPath(e,o).map((e=>e.path))),r&&r(t,n,i)}))}getRes(e,t){return Ml.has(e)?Ml.get(e):vI.get(e,t)}getResCount(){return Ml.count}getDependsRecursively(e){if(!e)return[];const t="string"==typeof e?e:e._uuid;return Qd.getDepsRecursively(t).concat([t])}get md5Pipe(){return aR}get downloader(){return NI}get loader(){return tR.parser}addDownloadHandlers(e){const t=Object.create(null);for(const n in e){const i=e[n];t[`.${n}`]=(e,t,n)=>{i({url:e},n)}}NI.register(t)}addLoadHandlers(e){const t=Object.create(null);for(const n in e){const i=e[n];t[`.${n}`]=(e,t,n)=>{i({content:e},n)}}qI.register(t)}release(e){if(Array.isArray(e))for(let t=0;t<e.length;t++){let n=e[t];"string"==typeof n&&(n=Ml.get(n)),tR.releaseAsset(n)}else e&&("string"==typeof e&&(e=Ml.get(e)),tR.releaseAsset(e))}releaseAsset(e){tR.releaseAsset(e)}releaseRes(e,t){vI.release(e,t)}releaseAll(){tR.releaseAll(),Ml.clear()}removeItem(e){return!!Ml.remove(e)}setAutoRelease(e,t){"object"==typeof e&&(e=e._uuid),this._autoReleaseSetting[e]=!!t}setAutoReleaseRecursively(e,t){"object"==typeof e&&(e=e._uuid),t=!!t,this._autoReleaseSetting[e]=t;const n=Qd.getDepsRecursively(e);for(let e=0;e<n.length;e++)this._autoReleaseSetting[n[e]]=t}isAutoRelease(e){return"object"==typeof e&&(e=e._uuid),!!this._autoReleaseSetting[e]}}e("gd",rR);const sR=e("ge",new rR),cR=e("gf",{init(e){e.importBase=e.libraryPath,e.nativeBase=e.rawAssetsBase,tR.init(e),e.rawAssets&&vI.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:Vl.RESOURCES,importBase:e.importBase,nativeBase:e.nativeBase,paths:e.rawAssets.assets,uuids:Object.keys(e.rawAssets.assets),extensionMap:{}})},loadAsset(e,t,n){tR.loadAny(e,t)}}),lR=e("gg",{});Pn(lR,"url",[{name:"normalize",target:tR.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:e=>e.startsWith("resources/")?t_({path:hn(e.substr(10)),bundle:Vl.RESOURCES,__isNative__:!0,ext:cn(e)}):""}]),wn(cR,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),wn(sR,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),Pn(c,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:()=>sR},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:()=>cR},{name:"Pipeline",target:eR,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:()=>lR}]),wn(c,"cc",[{name:"LoadingItems",suggest:M(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),Pn(He,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:NI,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),Pn(Vw,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:e=>{var t;return tR.main?null===(t=tR.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),Pn(Gw,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:()=>{const e=[];return tR.main&&tR.main.config.scenes.forEach((t=>{e.push(t)})),e}}]);const _R=aI._autoRelease;var uR,hR,fR,pR,dR,mR,AR,vR,gR,xR,yR,bR,SR;aI._autoRelease=function(e,t,n){_R.call(aI,e,t,n);const i=sR._autoReleaseSetting,o=Object.keys(i);for(let e=0;e<o.length;e++){const t=o[e];if(!0===i[t]){const e=Ml.get(t);e&&aI.tryRelease(e)}}};let CR=e("dA",(uR=Uc("cc.ClickEvent"),hR=vl(c.Node),fR=sl(),pR=sl(),dR=sl(),mR=sl(),uR((gR=Pc((vR=class e{constructor(){Tc(this,"target",gR,this),Tc(this,"component",xR,this),Tc(this,"_componentId",yR,this),Tc(this,"handler",bR,this),Tc(this,"customEventData",SR,this)}get _componentName(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)}set _componentName(e){this._componentId=this._compName2Id(e)}static emitEvents(t,...n){for(let i=0,o=t.length;i<o;i++){const o=t[i];o instanceof e&&o.emit(n)}}emit(e){const t=this.target;if(!c.isValid(t))return;this._genCompIdIfNeeded();const n=c.js._getClassById(this._componentId),i=t.getComponent(n);if(!c.isValid(i))return;const o=i[this.handler];"function"==typeof o&&(null!=this.customEventData&&""!==this.customEventData&&(e=e.slice()).push(this.customEventData),o.apply(i,e))}_compName2Id(e){const t=c.js.getClassByName(e);return c.js._getClassId(t)}_compId2Name(e){const t=c.js._getClassById(e);return c.js.getClassName(t)}_genCompIdIfNeeded(){this._componentId||(this._componentName=this.component,this.component="")}}).prototype,"target",[qc,hR,qc,fR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xR=Pc(vR.prototype,"component",[qc,il,pR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),yR=Pc(vR.prototype,"_componentId",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),bR=Pc(vR.prototype,"handler",[qc,il,dR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),SR=Pc(vR.prototype,"customEventData",[qc,il,mR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),AR=vR))||AR));var ER,TR,PR,wR,IR,RR,DR,NR,OR,MR,zR,LR,FR,BR,kR,UR,GR,jR,VR,HR,WR,qR,YR,XR,QR,ZR,JR,KR,$R,eD,tD,nD,iD,oD,aD,rD,sD,cD,lD,_D,uD,hD,fD,pD,dD,mD,AD,vD,gD,xD,yD,bD,SD,CD,ED,TD,PD,wD,ID,RD,DD,ND,OD,MD,zD,LD,FD;c.Component.EventHandler=CR;const BD=new _i,kD=ke(sd),UD=ke(rd),GD=ke(cd),jD=ke(_d),VD=ke(ld),HD=ke({SKYBOX:Ad|ba.DEPTH_STENCIL,SOLID_COLOR:ba.ALL,DEPTH_ONLY:ba.DEPTH_STENCIL,DONT_CLEAR:ba.NONE});let WD=e("dc",(ER=Uc("cc.Camera"),TR=nl(),PR=Kc(),wR=hl(),IR=sl(),RR=vl(Jf.BitMask),DR=hl(),NR=sl(),OR=vl(HD),MR=hl(),zR=sl(),LR=hl(),FR=sl(),BR=hl(),kR=sl(),UR=hl(),GR=sl(),jR=vl(kD),VR=hl(),HR=sl(),WR=vl(UD),qR=hl(),YR=sl(),XR=hl(),QR=sl(),ZR=hl(),JR=sl(),KR=hl(),$R=sl(),eD=hl(),tD=sl(),nD=vl(GD),iD=hl(),oD=sl(),aD=vl(jD),rD=hl(),sD=sl(),cD=vl(VD),lD=hl(),_D=sl(),uD=hl(),hD=sl(),fD=vl(Mb),pD=hl(),dD=sl(),ER(mD=TR(mD=PR(mD=Jc((FD=LD=class e extends R_{constructor(...e){super(...e),Tc(this,"_projection",vD,this),Tc(this,"_priority",gD,this),Tc(this,"_fov",xD,this),Tc(this,"_fovAxis",yD,this),Tc(this,"_orthoHeight",bD,this),Tc(this,"_near",SD,this),Tc(this,"_far",CD,this),Tc(this,"_color",ED,this),Tc(this,"_depth",TD,this),Tc(this,"_stencil",PD,this),Tc(this,"_clearFlags",wD,this),Tc(this,"_rect",ID,this),Tc(this,"_aperture",RD,this),Tc(this,"_shutter",DD,this),Tc(this,"_iso",ND,this),Tc(this,"_screenScale",OD,this),Tc(this,"_visibility",MD,this),Tc(this,"_targetTexture",zD,this),this._camera=null,this._inEditorMode=!1,this._flows=void 0}get camera(){return this._camera}get priority(){return this._priority}set priority(e){this._priority=e,this._camera&&(this._camera.priority=e)}get visibility(){return this._visibility}set visibility(e){this._visibility=e,this._camera&&(this._camera.visibility=e)}get clearFlags(){return this._clearFlags}set clearFlags(e){this._clearFlags=e,this._camera&&(this._camera.clearFlag=e)}get clearColor(){return this._color}set clearColor(e){this._color.set(e),this._camera&&(this._camera.clearColor=this._color)}get clearDepth(){return this._depth}set clearDepth(e){this._depth=e,this._camera&&(this._camera.clearDepth=e)}get clearStencil(){return this._stencil}set clearStencil(e){this._stencil=e,this._camera&&(this._camera.clearStencil=e)}get projection(){return this._projection}set projection(e){this._projection=e,this._camera&&(this._camera.projectionType=e)}get fovAxis(){return this._fovAxis}set fovAxis(e){e!==this._fovAxis&&(this._fovAxis=e,this._camera&&(this._camera.fovAxis=e,e===rd.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}get fov(){return this._fov}set fov(e){this._fov=e,this._camera&&(this._camera.fov=Hn(e))}get orthoHeight(){return this._orthoHeight}set orthoHeight(e){this._orthoHeight=e,this._camera&&(this._camera.orthoHeight=e)}get near(){return this._near}set near(e){this._near=e,this._camera&&(this._camera.nearClip=e)}get far(){return this._far}set far(e){this._far=e,this._camera&&(this._camera.farClip=e)}get aperture(){return this._aperture}set aperture(e){this._aperture=e,this._camera&&(this._camera.aperture=e)}get shutter(){return this._shutter}set shutter(e){this._shutter=e,this._camera&&(this._camera.shutter=e)}get iso(){return this._iso}set iso(e){this._iso=e,this._camera&&(this._camera.iso=e)}get rect(){return this._rect}set rect(e){this._rect=e,this._camera&&this._camera.setViewportInOrientedSpace(e)}get targetTexture(){return this._targetTexture}set targetTexture(t){if(this._targetTexture===t)return;const n=this._targetTexture;this._targetTexture=t,this._checkTargetTextureEvent(n),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0),this.node.emit(e.TARGET_TEXTURE_CHANGE,this)}get screenScale(){return this._screenScale}set screenScale(e){this._screenScale=e,this._camera&&(this._camera.screenScale=e)}get inEditorMode(){return this._inEditorMode}set inEditorMode(e){this._inEditorMode=e,this._camera&&this._camera.changeTargetWindow(e?c.director.root&&c.director.root.mainWindow:c.director.root&&c.director.root.tempWindow)}onLoad(){this._createCamera()}onEnable(){this.node.hasChangedFlags|=nA.POSITION,this._camera&&this._attachToScene()}onDisable(){this._camera&&this._detachFromScene()}onDestroy(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")}screenPointToRay(e,t,n){return n||(n=Po.create()),this._camera&&this._camera.screenPointToRay(n,e,t),n}worldToScreen(e,t){return t||(t=new _i),this._camera&&this._camera.worldToScreen(t,e),t}screenToWorld(e,t){return t||(t=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(t,e),t}convertToUINode(e,t,n){if(n||(n=new _i),!this._camera)return n;this.worldToScreen(e,BD);const i=t.getComponent("cc.UITransform"),o=Kw.getVisibleSize(),a=BD.x-.5*this._camera.width,r=BD.y-.5*this._camera.height;return BD.x=a/c.view.getScaleX()+.5*o.width,BD.y=r/c.view.getScaleY()+.5*o.height,i&&i.convertToNodeSpaceAR(BD,n),n}_createCamera(){this._camera||(this._camera=c.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?c.director.root&&c.director.root.mainWindow:c.director.root&&c.director.root.tempWindow,priority:this._priority}),this._camera.setViewportInOrientedSpace(this._rect),this._camera.fovAxis=this._fovAxis,this._camera.fov=Hn(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()}_attachToScene(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))}_detachFromScene(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)}_checkTargetTextureEvent(e){e&&e.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(e=>{this._camera&&this._camera.setFixedSize(e.width,e.height)}),this)}_updateTargetTexture(){if(this._camera&&this._targetTexture){const e=this._targetTexture.window;this._camera.changeTargetWindow(e),this._camera.setFixedSize(e.width,e.height)}}},LD.ProjectionType=kD,LD.FOVAxis=UD,LD.ClearFlag=HD,LD.Aperture=GD,LD.Shutter=jD,LD.ISO=VD,LD.TARGET_TEXTURE_CHANGE="tex-change",vD=Pc((AD=FD).prototype,"_projection",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kD.PERSPECTIVE}}),gD=Pc(AD.prototype,"_priority",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xD=Pc(AD.prototype,"_fov",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),yD=Pc(AD.prototype,"_fovAxis",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return UD.VERTICAL}}),bD=Pc(AD.prototype,"_orthoHeight",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),SD=Pc(AD.prototype,"_near",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),CD=Pc(AD.prototype,"_far",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),ED=Pc(AD.prototype,"_color",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ri("#333333")}}),TD=Pc(AD.prototype,"_depth",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),PD=Pc(AD.prototype,"_stencil",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wD=Pc(AD.prototype,"_clearFlags",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return HD.SOLID_COLOR}}),ID=Pc(AD.prototype,"_rect",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Bi(0,0,1,1)}}),RD=Pc(AD.prototype,"_aperture",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return GD.F16_0}}),DD=Pc(AD.prototype,"_shutter",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return jD.D125}}),ND=Pc(AD.prototype,"_iso",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return VD.ISO100}}),OD=Pc(AD.prototype,"_screenScale",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),MD=Pc(AD.prototype,"_visibility",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return od}}),zD=Pc(AD.prototype,"_targetTexture",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pc(AD.prototype,"priority",[wR,IR],Object.getOwnPropertyDescriptor(AD.prototype,"priority"),AD.prototype),Pc(AD.prototype,"visibility",[RR,DR,NR],Object.getOwnPropertyDescriptor(AD.prototype,"visibility"),AD.prototype),Pc(AD.prototype,"clearFlags",[OR,MR,zR],Object.getOwnPropertyDescriptor(AD.prototype,"clearFlags"),AD.prototype),Pc(AD.prototype,"clearColor",[LR,FR],Object.getOwnPropertyDescriptor(AD.prototype,"clearColor"),AD.prototype),Pc(AD.prototype,"clearDepth",[BR,kR],Object.getOwnPropertyDescriptor(AD.prototype,"clearDepth"),AD.prototype),Pc(AD.prototype,"clearStencil",[UR,GR],Object.getOwnPropertyDescriptor(AD.prototype,"clearStencil"),AD.prototype),Pc(AD.prototype,"projection",[jR,VR,HR],Object.getOwnPropertyDescriptor(AD.prototype,"projection"),AD.prototype),Pc(AD.prototype,"fovAxis",[WR,qR,YR],Object.getOwnPropertyDescriptor(AD.prototype,"fovAxis"),AD.prototype),Pc(AD.prototype,"fov",[XR,QR],Object.getOwnPropertyDescriptor(AD.prototype,"fov"),AD.prototype),Pc(AD.prototype,"orthoHeight",[ZR,JR],Object.getOwnPropertyDescriptor(AD.prototype,"orthoHeight"),AD.prototype),Pc(AD.prototype,"near",[KR,$R],Object.getOwnPropertyDescriptor(AD.prototype,"near"),AD.prototype),Pc(AD.prototype,"far",[eD,tD],Object.getOwnPropertyDescriptor(AD.prototype,"far"),AD.prototype),Pc(AD.prototype,"aperture",[nD,iD,oD],Object.getOwnPropertyDescriptor(AD.prototype,"aperture"),AD.prototype),Pc(AD.prototype,"shutter",[aD,rD,sD],Object.getOwnPropertyDescriptor(AD.prototype,"shutter"),AD.prototype),Pc(AD.prototype,"iso",[cD,lD,_D],Object.getOwnPropertyDescriptor(AD.prototype,"iso"),AD.prototype),Pc(AD.prototype,"rect",[uD,hD],Object.getOwnPropertyDescriptor(AD.prototype,"rect"),AD.prototype),Pc(AD.prototype,"targetTexture",[fD,pD,dD],Object.getOwnPropertyDescriptor(AD.prototype,"targetTexture"),AD.prototype),mD=AD))||mD)||mD)||mD)||mD));var qD,YD,XD,QD,ZD,JD,KD,$D,eN;c.Camera=WD;const tN={parent:null,owner:null,subModelIdx:0};let nN=e("b$",(qD=Uc("cc.RenderableComponent"),YD=vl([CA]),XD=vl(CA),QD=hl(),ZD=rl(),qD(($D=Pc((KD=class extends R_{constructor(...e){super(...e),Tc(this,"_materials",$D,this),Tc(this,"_visFlags",eN,this),this._materialInstances=[],this._models=[]}get visibility(){return this._visFlags}set visibility(e){this._visFlags=e,this._onVisibilityChange(e)}get sharedMaterials(){return this._materials}set sharedMaterials(e){for(let t=0;t<e.length;t++)e[t]!==this._materials[t]&&this.setMaterial(e[t],t);if(e.length<this._materials.length){for(let t=e.length;t<this._materials.length;t++)this.setMaterial(null,t);this._materials.splice(e.length)}}get materials(){for(let e=0;e<this._materials.length;e++)this._materialInstances[e]=this.getMaterialInstance(e);return this._materialInstances}set materials(e){const t=e.length-this._materials.length;if(t>0)this._materials.length=e.length,this._materialInstances.length=e.length;else if(t<0)for(let e=this._materials.length-t;e<this._materials.length;++e)this.setMaterialInstance(null,e);for(let t=0;t<this._materialInstances.length;t++)this._materialInstances[t]!=e[t]&&this.setMaterialInstance(e[t],t)}get sharedMaterial(){return this.getMaterial(0)}getMaterial(e){return e<0||e>=this._materials.length?null:this._materials[e]}setMaterial(e,t){e&&e instanceof UA&&console.error("Can't set a material instance to a sharedMaterial slot"),this._materials[t]=e;const n=this._materialInstances[t];n&&(n.destroy(),this._materialInstances[t]=null),this._onMaterialModified(t,this._materials[t])}get material(){return this.getMaterialInstance(0)}set material(e){(1!==this._materials.length||this._materialInstances[0]||this._materials[0]!==e)&&this.setMaterialInstance(e,0)}getMaterialInstance(e){if(!this._materials[e])return null;if(!this._materialInstances[e]){tN.parent=this._materials[e],tN.owner=this,tN.subModelIdx=e;const t=new UA(tN);tN.parent=null,tN.owner=null,tN.subModelIdx=0,this.setMaterialInstance(t,e)}return this._materialInstances[e]}setMaterialInstance(e,t){if("number"==typeof e){w(12007);const n=e;e=t,t=n}const n=this._materialInstances[t];e&&e.parent?e!==n&&(this._materialInstances[t]=e,this._onMaterialModified(t,e)):(e!==this._materials[t]||n)&&this.setMaterial(e,t)}getRenderMaterial(e){return this._materialInstances[e]||this._materials[e]}_collectModels(){return this._models}_attachToScene(){}_detachFromScene(){}_onMaterialModified(e,t){}_onRebuildPSO(e,t){}_clearMaterials(){}_onVisibilityChange(e){}}).prototype,"_materials",[YD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eN=Pc(KD.prototype,"_visFlags",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Jf.Enum.NONE}}),Pc(KD.prototype,"sharedMaterials",[XD,QD,ZD],Object.getOwnPropertyDescriptor(KD.prototype,"sharedMaterials"),KD.prototype),JD=KD))||JD));var iN,oN,aN,rN,sN,cN;function lN(e){return"string"==typeof e||"number"==typeof e}c.RenderableComponent=nN,Pn(WD,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),Pn(WD.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),c.CameraComponent=WD,Ne.setClassAlias(WD,"cc.CameraComponent");let _N=e("bh",Uc("cc.animation.HierarchyPath")((aN=Pc((oN=class{constructor(e){Tc(this,"path",aN,this),this.path=e||""}get(e){if(!(e instanceof Ox))return w(3925),null;return e.getChildByPath(this.path)||(w(3926,e.name,this.path),null)}}).prototype,"path",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),iN=oN))||iN),uN=e("bi",Uc("cc.animation.ComponentPath")((cN=Pc((sN=class{constructor(e){Tc(this,"component",cN,this),this.component=e||""}get(e){if(!(e instanceof Ox))return w(3927),null;return e.getComponent(this.component)||(w(3928,e.name,this.component),null)}}).prototype,"component",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),rN=sN))||rN);var hN,fN,pN,dN,mN;let AN=e("b3",Uc("cc.animation.UniformProxyFactory")((pN=Pc((fN=class{constructor(e,t){Tc(this,"passIndex",pN,this),Tc(this,"uniformName",dN,this),Tc(this,"channelIndex",mN,this),this.passIndex=t||0,this.uniformName=e||""}forTarget(e){const t=e.passes[this.passIndex],n=t.getHandle(this.uniformName);if(!n)throw new Error(`Material "${e.name}" has no uniform "${this.uniformName}"`);if(qm.getTypeFromHandle(n)<Vo.SAMPLER1D){const i=void 0===this.channelIndex?n:t.getHandle(this.uniformName,this.channelIndex,Vo.FLOAT);if(!i)throw new Error(`Uniform "${this.uniformName} (in material ${e.name}) has no channel ${this.channelIndex}"`);return function(e,t){for(const n of e.shaderInfo.blocks)for(const e of n.members)if(e.name===t)return e.count>1;return!1}(t,this.uniformName)?{set:e=>{t.setUniformArray(i,e)}}:{set:e=>{t.setUniform(i,e)}}}{const e=qm.getBindingFromHandle(n),i=t.properties[this.uniformName],o=i&&i.value?`${i.value}-texture`:Pm(i.type);let a=Bm.get(o);return a||(v(`Illegal texture default value: ${o}.`),a=Bm.get("default-texture")),{set:n=>{n||(n=a);const i=n.getGFXTexture();i&&i.width&&i.height&&(t.bindTexture(e,i),n instanceof Vd&&t.bindSampler(e,c.game._gfxDevice.getSampler(n.getSamplerInfo())))}}}}}).prototype,"passIndex",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dN=Pc(fN.prototype,"uniformName",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),mN=Pc(fN.prototype,"channelIndex",[dl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),hN=fN))||hN);var vN,gN,xN,yN,bN,SN,CN,EN,TN,PN,wN,IN,RN;function DN(e,t,n,i){var o,a,r,s,c;let l=new t,_=new t,u=new t,h=Uc(e)((r=Pc((a=class{constructor(e,n,i){Tc(this,"dataPoint",r,this),Tc(this,"inTangent",s,this),Tc(this,"outTangent",c,this),this.dataPoint=e||new t,this.inTangent=n||new t,this.outTangent=i||new t}lerp(e,t,o){const a=this.dataPoint,r=e.dataPoint;_=n(_,this.inTangent,o),u=n(u,e.outTangent,o);const s=t*t*t,c=t*t,h=s-2*c+t,f=-2*s+3*c,p=s-c;return l=n(l,a,2*s-3*c+1),l=i(l,l,_,h),l=i(l,l,r,f),l=i(l,l,u,p),l}getNoLerp(){return this.dataPoint}}).prototype,"dataPoint",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),s=Pc(a.prototype,"inTangent",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),c=Pc(a.prototype,"outTangent",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),o=a))||o;if(t===Ai){const e=h.prototype.lerp;h.prototype.lerp=function(t,n,i){const o=e.call(this,t,n,i);return Ai.normalize(o,o),o}}return h}e("b4",Uc("cc.animation.MorphWeightValueProxy")((xN=Pc((gN=class{constructor(){Tc(this,"subMeshIndex",xN,this),Tc(this,"shapeIndex",yN,this)}forTarget(e){return{set:t=>{e.setWeight(t,this.subMeshIndex,this.shapeIndex)}}}}).prototype,"subMeshIndex",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yN=Pc(gN.prototype,"shapeIndex",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vN=gN))||vN),e("b5",Uc("cc.animation.MorphWeightsValueProxy")((CN=Pc((SN=class{constructor(){Tc(this,"subMeshIndex",CN,this)}forTarget(e){return{set:t=>{e.setWeights(t,this.subMeshIndex)}}}}).prototype,"subMeshIndex",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bN=SN))||bN),e("b6",Uc("cc.animation.MorphWeightsAllValueProxy")(EN=class{forTarget(e){return{set:t=>{var n,i;const o=null!==(n=null===(i=e.mesh)||void 0===i?void 0:i.struct.primitives.length)&&void 0!==n?n:0;for(let n=0;n<o;++n)e.setWeights(t,n)}}}})||EN);const NN=e("bj",DN("cc.CubicSplineVec2Value",Ii,Ii.multiplyScalar,Ii.scaleAndAdd));c.CubicSplineVec2Value=NN;const ON=e("bk",DN("cc.CubicSplineVec3Value",_i,_i.multiplyScalar,_i.scaleAndAdd));c.CubicSplineVec3Value=ON;const MN=e("bl",DN("cc.CubicSplineVec4Value",Oi,Oi.multiplyScalar,Oi.scaleAndAdd));c.CubicSplineVec4Value=MN;const zN=e("bm",DN("cc.CubicSplineQuatValue",Ai,Ai.multiplyScalar,Ai.scaleAndAdd));c.CubicSplineQuatValue=zN;let LN=e("bn",Uc("cc.CubicSplineNumberValue")((wN=Pc((PN=class{constructor(e,t,n){Tc(this,"dataPoint",wN,this),Tc(this,"inTangent",IN,this),Tc(this,"outTangent",RN,this),this.dataPoint=e,this.inTangent=t,this.outTangent=n}lerp(e,t,n){const i=this.dataPoint,o=e.dataPoint,a=t*t*t,r=t*t;return i*(2*a-3*r+1)+this.outTangent*n*(a-2*r+t)+o*(-2*a+3*r)+e.inTangent*n*(a-r)}getNoLerp(){return this.dataPoint}}).prototype,"dataPoint",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),IN=Pc(PN.prototype,"inTangent",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),RN=Pc(PN.prototype,"outTangent",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),TN=PN))||TN);c.CubicSplineNumberValue=LN;const FN=Symbol("CreateEval");var BN,kN,UN,GN,jN,VN,HN,WN,qN,YN,XN,QN,ZN,JN,KN,$N;const eO=Symbol("NormalizedFollow"),tO=Symbol("ConvertAsTrsPath"),nO=Symbol("TrackBinding");let iO=e("b8",Uc("cc.animation.TrackPath")((UN=Pc((kN=class e{constructor(){Tc(this,"_paths",UN,this)}get length(){return this._paths.length}toProperty(e){return this._paths.push(e),this}toElement(e){return this._paths.push(e),this}toHierarchy(e){return this._paths.push(new _N(e)),this}toComponent(e){const t=new uN("string"==typeof e?e:Ne.getClassName(e));return this._paths.push(t),this}toCustomized(e){return this._paths.push(e),this}append(...e){const t=this._paths.concat(...e.map((e=>e._paths)));return this._paths=t,this}isPropertyAt(e){return"string"==typeof this._paths[e]}parsePropertyAt(e){return this._paths[e]}isElementAt(e){return"number"==typeof this._paths[e]}parseElementAt(e){return this._paths[e]}isHierarchyAt(e){return this._paths[e]instanceof _N}parseHierarchyAt(e){return this.isHierarchyAt(e),this._paths[e].path}isComponentAt(e){return this._paths[e]instanceof uN}parseComponentAt(e){return this.isComponentAt(e),this._paths[e].component}slice(t,n){const i=new e;return i._paths=this._paths.slice(t,n),i}trace(e,t,n){var i,o;return null!==(i=t)&&void 0!==i||(t=0),null!==(o=n)&&void 0!==o||(n=this._paths.length),this[eO](e,t,n)}[tO](){const{_paths:e}=this,t=e.length;let n,i=0,o="";for(;i<t;++i){const t=e[i];if(!(t instanceof _N))break;t.path&&(o?o+=`/${t.path}`:o=t.path)}if(i===t)return null;if(i!==t-1)return null;switch(e[i]){case"position":case"scale":case"rotation":case"eulerAngles":n=e[i];break;default:return null}return{node:o,property:n}}[eO](e,t,n){const{_paths:i}=this;let o=e;for(let e=t;e<n;++e){const t=i[e];if(lN(t)){if(!(t in o))return w(3929,t),null;o=o[t]}else o=t.get(o);if(null===o)break}return o}}).prototype,"_paths",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),BN=kN))||BN),oO=Uc("cc.animation.TrackBinding")(GN=Zc((VN=Pc((jN=class{constructor(){Tc(this,"path",VN,this),Tc(this,"proxy",HN,this)}parseTrsPath(){return this.proxy?null:this.path[tO]()}createRuntimeBinding(e,t,n){const{path:i,proxy:o}=this,a=i.length,r=a-1;if(0===a||!i.isPropertyAt(r)&&!i.isElementAt(r)||o){if(o){const t=i[eO](e,0,a);if(null===t)return null;const n=o.forTarget(t),r={setValue:e=>{n.set(e)}},s=n.get;return s&&(r.getValue=()=>s.call(n)),r}return R(3921),null}{const o=i.isPropertyAt(r)?i.parsePropertyAt(r):i.parseElementAt(r),c=i[eO](e,0,a-1);return null===c?null:t&&c instanceof Ox&&("position"===(s=o)||"rotation"===s||"scale"===s||"eulerAngles"===s)?t.createPoseWriter(c,o,n):{setValue:e=>{c[o]=e},getValue:()=>c[o]}}var s}}).prototype,"path",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new iO}}),HN=Pc(jN.prototype,"proxy",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GN=jN))||GN)||GN,aO=e("b7",Uc("cc.animation.Track")((YN=Pc((qN=class{constructor(){Tc(this,"_binding",YN,this)}get path(){return this._binding.path}set path(e){this._binding.path=e}get proxy(){return this._binding.proxy}set proxy(e){this._binding.proxy=e}get[nO](){return this._binding}channels(){return[]}range(){const e={min:1/0,max:-1/0};for(const t of this.channels())e.min=Math.min(e.min,t.curve.rangeMin),e.max=Math.max(e.max,t.curve.rangeMax);return e}}).prototype,"_binding",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new oO}}),WN=qN))||WN),rO=Uc("cc.animation.Channel")((ZN=Pc((QN=class{constructor(e){this.name="",Tc(this,"_curve",ZN,this),this._curve=e}get curve(){return this._curve}}).prototype,"_curve",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XN=QN))||XN,sO=Uc("cc.animation.SingleChannelTrack")(($N=Pc((KN=class extends aO{constructor(){super(),Tc(this,"_channel",$N,this),this._channel=new rO(this.createCurve())}get channel(){return this._channel}channels(){return[this._channel]}createCurve(){throw new Error("Not impl")}[FN](e){const{curve:t}=this._channel;return new cO(t)}}).prototype,"_channel",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JN=KN))||JN;class cO{constructor(e){this._curve=e}evaluate(e){return this._curve.evaluate(e)}}var lO;let _O=e("b9",Uc("cc.animation.RealTrack")(lO=class extends sO{createCurve(){return new Gh}})||lO);function uO(e){return 0===e.keyFramesCount?void 0:e}var hO,fO,pO,dO;const mO=["X","Y","Z","W"];let AO=e("ba",Uc("cc.animation.VectorTrack")((pO=Pc((fO=class extends aO{constructor(){super(),Tc(this,"_channels",pO,this),Tc(this,"_nComponents",dO,this),this._channels=new Array(4);for(let e=0;e<this._channels.length;++e){const t=new rO(new Gh);t.name=mO[e],this._channels[e]=t}}get componentsCount(){return this._nComponents}set componentsCount(e){this._nComponents=e}channels(){return this._channels}[FN](){switch(this._nComponents){default:case 2:return new vO(uO(this._channels[0].curve),uO(this._channels[1].curve));case 3:return new gO(uO(this._channels[0].curve),uO(this._channels[1].curve),uO(this._channels[2].curve));case 4:return new xO(uO(this._channels[0].curve),uO(this._channels[1].curve),uO(this._channels[2].curve),uO(this._channels[3].curve))}}}).prototype,"_channels",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dO=Pc(fO.prototype,"_nComponents",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),hO=fO))||hO);class vO{constructor(e,t){this._result=new Ii,this._x=e,this._y=t}evaluate(e,t){return this._x&&this._y||!t.getValue||Ii.copy(this._result,t.getValue()),this._x&&(this._result.x=this._x.evaluate(e)),this._y&&(this._result.y=this._y.evaluate(e)),this._result}}class gO{constructor(e,t,n){this._result=new _i,this._x=e,this._y=t,this._z=n}evaluate(e,t){return this._x&&this._y&&this._z||!t.getValue||_i.copy(this._result,t.getValue()),this._x&&(this._result.x=this._x.evaluate(e)),this._y&&(this._result.y=this._y.evaluate(e)),this._z&&(this._result.z=this._z.evaluate(e)),this._result}}class xO{constructor(e,t,n,i){this._result=new Oi,this._x=e,this._y=t,this._z=n,this._w=i}evaluate(e,t){return this._x&&this._y&&this._z&&this._w||!t.getValue||Oi.copy(this._result,t.getValue()),this._x&&(this._result.x=this._x.evaluate(e)),this._y&&(this._result.y=this._y.evaluate(e)),this._z&&(this._result.z=this._z.evaluate(e)),this._w&&(this._result.w=this._w.evaluate(e)),this._result}}var yO;let bO=e("bb",Uc("cc.animation.QuatTrack")(yO=class extends sO{createCurve(){return new Tf}[FN](){return new SO(this.channels()[0].curve)}})||yO);class SO{constructor(e){this._result=new Ai,this._curve=e}evaluate(e){return this._curve.evaluate(e,this._result),this._result}}var CO,EO,TO;const PO=["Red","Green","Blue","Alpha"];let wO=e("bc",Uc("cc.animation.ColorTrack")((TO=Pc((EO=class extends aO{constructor(){super(),Tc(this,"_channels",TO,this),this._channels=new Array(4);for(let e=0;e<this._channels.length;++e){const t=new rO(new Gh);t.name=PO[e],this._channels[e]=t}}channels(){return this._channels}[FN](){return new IO(uO(this._channels[0].curve),uO(this._channels[1].curve),uO(this._channels[2].curve),uO(this._channels[3].curve))}}).prototype,"_channels",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CO=EO))||CO);class IO{constructor(e,t,n,i){this._result=new ri,this._x=e,this._y=t,this._z=n,this._w=i}evaluate(e,t){return this._x&&this._y&&this._z&&this._w||!t.getValue||ri.copy(this._result,t.getValue()),this._x&&(this._result.r=this._x.evaluate(e)),this._y&&(this._result.g=this._y.evaluate(e)),this._z&&(this._result.b=this._z.evaluate(e)),this._w&&(this._result.a=this._w.evaluate(e)),this._result}}var RO,DO,NO;const OO=["Width","Height"];let MO=e("bd",Uc("cc.animation.SizeTrack")((NO=Pc((DO=class extends aO{constructor(){super(),Tc(this,"_channels",NO,this),this._channels=new Array(2);for(let e=0;e<this._channels.length;++e){const t=new rO(new Gh);t.name=OO[e],this._channels[e]=t}}channels(){return this._channels}[FN](){return new zO(uO(this._channels[0].curve),uO(this._channels[1].curve))}}).prototype,"_channels",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RO=DO))||RO);class zO{constructor(e,t){this._result=new Li,this._width=e,this._height=t}evaluate(e,t){if((!this._width||!this._height)&&t.getValue){const e=t.getValue();this._result.x=e.x,this._result.y=e.y}return this._width&&(this._result.width=this._width.evaluate(e)),this._height&&(this._result.height=this._height.evaluate(e)),this._result}}var LO;let FO=e("be",Uc("cc.animation.ObjectTrack")(LO=class extends sO{createCurve(){return new Ff}})||LO);const BO=Symbol("[[Owner]]");function kO(e){e[BO]}class UO extends Error{constructor(e){super(`${e} transition is invalid`),this.name="TransitionRejectError"}}class GO extends Error{constructor(e){super(`Graph variable ${e} is not defined`)}}class jO extends Error{constructor(e,t,n){super(`Expect graph variable ${e} to have type '${t}' instead of received '${null!=n?n:typeof n}'`)}}const VO=Symbol("[[createEval]]");var HO,WO,qO,YO,XO,QO;const ZO=Symbol("[[Outgoing transitions]]"),JO=Symbol("[[Incoming transitions]]");let KO=Uc("cc.animation.State")((qO=Pc((WO=class extends Rl{constructor(){super(),Tc(this,"name",qO,this),this[ZO]=[],this[JO]=[]}}).prototype,"name",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),HO=WO))||HO,$O=Uc("cc.animation.InteractiveState")((QO=Pc((XO=class extends KO{constructor(...e){super(...e),Tc(this,"_components",QO,this)}get components(){return this._components}addComponent(e){const t=new e;return this._components.push(t),t}removeComponent(e){G(this._components,e)}instantiateComponents(){return this._components.map((e=>gu(e)))}}).prototype,"_components",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YO=XO))||YO;var eM,tM,nM,iM,oM,aM,rM,sM;let cM;!function(e){e[e.FLOAT=0]="FLOAT",e[e.BOOLEAN=1]="BOOLEAN",e[e.TRIGGER=2]="TRIGGER",e[e.INTEGER=3]="INTEGER"}(cM||(cM=e("bp",{})));let lM=Uc("cc.animation.BindableNumber")((nM=Pc((tM=class e{constructor(e=0){Tc(this,"variable",nM,this),Tc(this,"value",iM,this),this.value=e}clone(){const t=new e;return t.value=this.value,t.variable=this.variable,t}}).prototype,"variable",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),iM=Pc(tM.prototype,"value",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eM=tM))||eM,_M=Uc("cc.animation.BindableBoolean")((rM=Pc((aM=class e{constructor(e=!1){Tc(this,"variable",rM,this),Tc(this,"value",sM,this),this.value=e}clone(){const t=new e;return t.value=this.value,t.variable=this.variable,t}}).prototype,"variable",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),sM=Pc(aM.prototype,"value",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),oM=aM))||oM;function uM(e,t,n,i,o,...a){const{variable:r,value:s}=t;if(!r)return s;const c=e.getVar(r);if(!fM(c,r))return s;if(c.type!==n)throw new jO(r,"number");return c.bind(i,o,...a)}function hM(e,t,n,i,o,...a){const{variable:r,value:s}=t;if(!r)return s;const c=e.getVar(r);if(!fM(c,r))return s;if(n!==cM.FLOAT&&n!==cM.INTEGER)throw new jO(r,"number or integer");return c.bind(i,o,...a)}function fM(e,t){if(e)return!0;throw new GO(t)}var pM,dM,mM,AM;let vM=Uc("cc.animation.Motion")((mM=Pc((dM=class e extends $O{constructor(...e){super(...e),Tc(this,"motion",mM,this),Tc(this,"speed",AM,this)}clone(){var t,n;const i=new e;return i.motion=null!==(t=null===(n=this.motion)||void 0===n?void 0:n.clone())&&void 0!==t?t:null,i.speed=this.speed.clone(),i}}).prototype,"motion",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),AM=Pc(dM.prototype,"speed",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lM(1)}}),pM=dM))||pM;const gM=Symbol("[[OnAfterDeserialized]]");var xM,yM,bM,SM,CM,EM,TM,PM,wM,IM,RM,DM,NM,OM,MM,zM,LM,FM,BM,kM,UM,GM,jM,VM,HM,WM,qM,YM,XM,QM,ZM,JM,KM,$M,ez,tz;let nz=Uc("cc.animation.Transition")((bM=Pc((yM=class extends Rl{constructor(e,t,n){super(),Tc(this,"from",bM,this),Tc(this,"to",SM,this),Tc(this,"conditions",CM,this),this[BO]=void 0,this.from=e,this.to=t,n&&(this.conditions=n)}}).prototype,"from",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SM=Pc(yM.prototype,"to",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CM=Pc(yM.prototype,"conditions",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xM=yM))||xM,iz=Uc("cc.animation.AnimationTransition")((PM=Pc((TM=class extends nz{constructor(...e){super(...e),Tc(this,"duration",PM,this),Tc(this,"relativeDuration",wM,this),Tc(this,"exitConditionEnabled",IM,this),Tc(this,"_exitCondition",RM,this)}get exitCondition(){return this._exitCondition}set exitCondition(e){this._exitCondition=e}}).prototype,"duration",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),wM=Pc(TM.prototype,"relativeDuration",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),IM=Pc(TM.prototype,"exitConditionEnabled",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),RM=Pc(TM.prototype,"_exitCondition",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),EM=TM))||EM;function oz(e){return e instanceof iz}let az,rz=Uc("cc.animation.StateMachine")((OM=Pc((NM=class e extends Rl{__callOnAfterDeserializeRecursive(){this[gM]();const e=this._states.length;for(let t=0;t<e;++t){const e=this._states[t];e instanceof sz&&e.stateMachine.__callOnAfterDeserializeRecursive()}}constructor(){super(),Tc(this,"_states",OM,this),Tc(this,"_transitions",MM,this),Tc(this,"_entryState",zM,this),Tc(this,"_exitState",LM,this),Tc(this,"_anyState",FM,this),this._entryState=this._addState(new KO),this._entryState.name="Entry",this._exitState=this._addState(new KO),this._exitState.name="Exit",this._anyState=this._addState(new KO),this._anyState.name="Any"}[gM](){this._states.forEach((()=>{})),this._transitions.forEach((e=>{e.from[ZO].push(e),e.to[JO].push(e)}))}[VO](e){throw new Error("Method not implemented.")}get entryState(){return this._entryState}get exitState(){return this._exitState}get anyState(){return this._anyState}states(){return this._states}transitions(){return this._transitions}getTransitionsBetween(e,t){return kO(e),kO(t),e[ZO].filter((e=>e.to===t))}getOutgoings(e){return kO(e),e[ZO]}getIncomings(e){return kO(e),e[JO]}addMotion(){return this._addState(new vM)}addSubStateMachine(){return this._addState(new sz)}remove(e){kO(e),e!==this.entryState&&e!==this.exitState&&e!==this.anyState&&(this.eraseTransitionsIncludes(e),G(this._states,e))}connect(e,t,n){if(kO(e),kO(t),t===this.entryState)throw new UO("to-entry");if(t===this.anyState)throw new UO("to-any");if(e===this.exitState)throw new UO("from-exit");const i=e instanceof vM||e===this._anyState?new iz(e,t,n):new nz(e,t,n);return this._transitions.push(i),e[ZO].push(i),t[JO].push(i),i}disconnect(e,t){kO(e),kO(t);const n=e[ZO],i=t[JO],o=this._transitions,a=n.filter((e=>e.to===t)),r=a.length;for(let e=0;e<r;++e){const t=a[e];G(n,t),G(o,t),j(i,(e=>e===t))}}removeTransition(e){G(this._transitions,e),j(e.from[ZO],(t=>t===e)),j(e.to[JO],(t=>t===e))}eraseOutgoings(e){kO(e);const t=e[ZO];for(let e=0;e<t.length;++e){const n=t[e],i=n.to;G(this._transitions,n),j(i[JO],(e=>e===n))}t.length=0}eraseIncomings(e){kO(e);const t=e[JO];for(let e=0;e<t.length;++e){const n=t[e],i=n.from;G(this._transitions,n),j(i[ZO],(e=>e===n))}t.length=0}eraseTransitionsIncludes(e){this.eraseIncomings(e),this.eraseOutgoings(e)}clone(){const t=new e,n=new Map;for(const e of this._states)switch(e){case this._entryState:n.set(e,t._entryState);break;case this._exitState:n.set(e,t._exitState);break;case this._anyState:n.set(e,t._anyState);break;default:if(e instanceof vM||e instanceof sz){const i=e.clone();t._addState(i),n.set(e,i)}}for(const e of this._transitions){const i=n.get(e.from),o=n.get(e.to),a=t.connect(i,o);a.conditions=e.conditions.map((e=>e.clone())),a instanceof iz&&(a.duration=e.duration,a.exitConditionEnabled=e.exitConditionEnabled,a.exitCondition=e.exitCondition)}return t}_addState(e){return this._states.push(e),e}}).prototype,"_states",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),MM=Pc(NM.prototype,"_transitions",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zM=Pc(NM.prototype,"_entryState",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LM=Pc(NM.prototype,"_exitState",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FM=Pc(NM.prototype,"_anyState",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DM=NM))||DM,sz=Uc("cc.animation.SubStateMachine")((UM=Pc((kM=class e extends $O{constructor(...e){super(...e),Tc(this,"_stateMachine",UM,this)}get stateMachine(){return this._stateMachine}clone(){const t=new e;return t._stateMachine=this._stateMachine.clone(),t}}).prototype,"_stateMachine",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rz}}),BM=kM))||BM,cz=Uc("cc.animation.Layer")((VM=Pc((jM=class{constructor(){this[BO]=void 0,Tc(this,"_stateMachine",VM,this),Tc(this,"name",HM,this),Tc(this,"weight",WM,this),Tc(this,"mask",qM,this),Tc(this,"blending",YM,this),this._stateMachine=new rz}get stateMachine(){return this._stateMachine}}).prototype,"_stateMachine",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HM=Pc(jM.prototype,"name",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),WM=Pc(jM.prototype,"weight",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),qM=Pc(jM.prototype,"mask",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),YM=Pc(jM.prototype,"blending",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return az.additive}}),GM=jM))||GM;!function(e){e[e.override=0]="override",e[e.additive=1]="additive"}(az||(az={}));let lz=Uc("cc.animation.Variable")((ZM=Pc((QM=class{constructor(e){if(Tc(this,"_type",ZM,this),Tc(this,"_value",JM,this),void 0!==e)switch(this._type=e,e){default:break;case cM.FLOAT:case cM.INTEGER:this._value=0;break;case cM.BOOLEAN:case cM.TRIGGER:this._value=!1}}get type(){return this._type}get value(){return this._value}set value(e){this._value=e}}).prototype,"_type",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cM.FLOAT}}),JM=Pc(QM.prototype,"_value",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XM=QM))||XM,_z=Uc("cc.animation.AnimationGraph")((ez=Pc(($M=class extends __{constructor(){super(),Tc(this,"_layers",ez,this),Tc(this,"_variables",tz,this)}onLoaded(){const{_layers:e}=this,t=e.length;for(let n=0;n<t;++n)e[n].stateMachine.__callOnAfterDeserializeRecursive()}get layers(){return this._layers}get variables(){return Object.entries(this._variables)}addLayer(){const e=new cz;return this._layers.push(e),e}removeLayer(e){De.removeAt(this._layers,e)}moveLayer(e,t){!function(e,t,n){if(Be(e,t),Be(e,n),t===n)return e;const i=e[t];if(t<n)for(let i=t+1;i<=n;++i)e[i-1]=e[i];else for(let i=t;i!==n;--i)e[i]=e[i-1];e[n]=i}(this._layers,e,t)}addVariable(e,t,n){const i=new lz(t);void 0!==n&&(i.value=n),this._variables[e]=i}removeVariable(e){delete this._variables[e]}getVariable(e){return this._variables[e]}}).prototype,"_layers",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tz=Pc($M.prototype,"_variables",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),KM=$M))||KM;const uz=Symbol("BakeNodeCurves");class hz{static getOrExtract(e){let t=hz.pool.get(e);if(!t||t.samples!==e.sample){t&&c.director.root.dataPoolManager.releaseAnimationClip(e);const n=Math.ceil(e.sample*e.duration)+1,i=e.sample;t=e[uz](0,i,n),hz.pool.set(e,t)}return t}static destroy(e){hz.pool.delete(e)}}e("cq",hz),hz.pool=new Map;class fz{constructor(e){let t,n;this.ratios=void 0,this._findRatio=void 0,this.ratios=e;let i=!0;for(let o=1,a=e.length;o<a;o++)if(t=e[o]-e[o-1],1===o)n=t;else if(Math.abs(t-n)>1e-6){i=!1;break}this._findRatio=i?Az:Dc}sample(e){return this._findRatio(this.ratios,e)}}e("gw",fz),c.RatioSampler=fz;class pz{static Bezier(e){return e}constructor(e,t){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=t,this._values=e.values;const n=e=>"string"==typeof e?e:Array.isArray(e)?e[0]===e[1]&&e[2]===e[3]?pz.Linear:pz.Bezier(e):pz.Linear;if(void 0!==e.easingMethod)this.type=n(e.easingMethod);else if(Array.isArray(e.easingMethods))this.types=e.easingMethods.map(n);else if(void 0!==e.easingMethods){this.types=new Array(this._values.length).fill(null);for(const t of Object.keys(e.easingMethods))this.types[t]=n(e.easingMethods[t])}else this.type=null;const i=e.values[0];(void 0===e.interpolate||e.interpolate)&&(this._lerp=vz(i)),void 0!==e._arrayLength&&(this._array=new Array(e._arrayLength))}hasLerp(){return!!this._lerp}valueAt(e){if(void 0===this._array){const t=this._values[e];return t&&t.getNoLerp?t.getNoLerp():t}for(let t=0;t<this._array.length;++t)this._array[t]=this._values[this._array.length*e+t];return this._array}valueBetween(e,t,n,i,o){if(this._lerp){const a=this.types?this.types[t]:this.type,r=o-n;let s=(e-n)/r;if(a&&(s=mz(s,a)),void 0===this._array){const e=this._values[t],n=this._values[i];return this._lerp(e,n,s,r*this._duration)}for(let e=0;e<this._array.length;++e){const n=this._values[this._array.length*t+e],o=this._values[this._array.length*i+e];this._array[e]=this._lerp(n,o,s,r*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(t);for(let e=0;e<this._array.length;++e)this._array[e]=this._values[this._array.length*t+e];return this._array}empty(){return 0===this._values.length}constant(){return 1===this._values.length}}function dz(e,t,n){let i=t.sample(n);if(i<0)if(i=~i,i<=0)i=0;else{if(!(i>=t.ratios.length))return e.valueBetween(n,i-1,t.ratios[i-1],i,t.ratios[i]);i=t.ratios.length-1}return e.valueAt(i)}function mz(e,t){if("string"==typeof t){const n=wh[t];n?e=n(e):R(3906,t)}else Array.isArray(t)&&(e=ff(t,e));return e}function Az(e,t){const n=e.length-1;if(0===n)return 0;const i=e[0];if(t<i)return 0;const o=e[n];if(t>o)return n;const a=(t=(t-i)/(o-i))/(1/n),r=0|a,s=1e-6;return a-r<s?r:r+1-a<s?r+1:~(r+1)}e("gx",pz),pz.Linear=null,c.AnimCurve=pz,e("gy",class{constructor(){this.events=[]}add(e,t){this.events.push({func:e||"",params:t||[]})}}),c.sampleAnimationCurve=dz;const vz=(()=>{function e(e,t,n,i){return e.lerp(t,n,i)}return t=>{if(null!==t){if("number"==typeof t)return Vn;if("object"==typeof t&&t.constructor){if(t instanceof Ai)return function(){const e=new Ai;return(t,n,i)=>Ai.slerp(e,t,n,i)}();if(t instanceof Ve)return function(e){const t=new e;return(n,i,o)=>(e.lerp(t,n,i,o),t)}(t.constructor);if(t.constructor===Number)return Vn;if("function"==typeof t.lerp)return e}}}})();var gz,xz,yz,bz,Sz,Cz;let Ez=Uc("cc.animation.UntypedTrackChannel")((yz=Pc((xz=class extends rO{constructor(){super(new Gh),Tc(this,"property",yz,this)}}).prototype,"property",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),gz=xz))||gz,Tz=Uc("cc.animation.UntypedTrack")((Cz=Pc((Sz=class extends aO{constructor(...e){super(...e),Tc(this,"_channels",Cz,this)}channels(){return this._channels}[FN](e){if(!e.getValue)throw new Error(M(3930));const t=e=>{var t;return null===(t=this._channels.find((t=>t.property===e)))||void 0===t?void 0:t.curve},n=e.getValue();switch(!0){default:throw new Error(M(3931));case n instanceof Ii:return new vO(t("x"),t("y"));case n instanceof _i:return new gO(t("x"),t("y"),t("z"));case n instanceof Oi:return new xO(t("x"),t("y"),t("z"),t("w"));case n instanceof ri:return new IO(t("r"),t("g"),t("b"),t("a"));case n instanceof Li:return new zO(t("width"),t("height"))}}addChannel(e){const t=new Ez;return t.property=e,this._channels.push(t),t}upgrade(e){const t=(e,t)=>{const n=this.channels().find((t=>t.property===e));n&&(t.name=n.name,t.curve.assignSorted(Array.from(n.curve.times()),Array.from(n.curve.values())))},n=e(this.path,this.proxy);switch(n){default:break;case"vec2":case"vec3":case"vec4":{const e=new AO;e.path=this.path,e.proxy=this.proxy,e.componentsCount="vec2"===n?2:"vec3"===n?3:4;const[i,o,a,r]=e.channels();switch(n){case"vec4":t("w",r);case"vec3":t("z",a);default:case"vec2":t("x",i),t("y",o)}return e}case"color":{const e=new wO,[n,i,o,a]=e.channels();return t("r",n),t("g",i),t("b",o),t("a",a),t("x",n),t("y",i),t("z",o),t("w",a),e}case"size":}return null}}).prototype,"_channels",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bz=Sz))||bz;class Pz{constructor(e){this._keys=[],this._curves=[],this._commonTargets=[],this._ratioSamplers=[],this._runtimeCurves=void 0,this._data=null,this._duration=void 0,this._duration=e}get keys(){return this._keys}set keys(e){this._keys=e}get curves(){return this._curves}set curves(e){this._curves=e,delete this._runtimeCurves}get commonTargets(){return this._commonTargets}set commonTargets(e){this._commonTargets=e}get data(){return this._data}getPropertyCurves(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves}toTracks(){const e=[],{keys:t,curves:n,commonTargets:i}=this,o=(e,t,n)=>{const i=new iO;for(const e of t)"string"==typeof e?i.toProperty(e):"number"==typeof e?i.toElement(e):e instanceof _N?i.toHierarchy(e.path):e instanceof uN?i.toComponent(e.component):i.toCustomized(e);e.path=i,e.proxy=n},a=i.map((t=>{const n=new Tz;return o(n,t.modifiers,t.valueAdapter),e.push(n),n}));for(const i of n){var r;const n=i.data,s=n.values;if(0===s.length)continue;const c=n.keys<0?[0]:t[n.keys],l=s[0],_=null===(r=n.interpolate)||void 0===r||r;n._arrayLength;const u=new Iz(n,c.length),h=e=>{o(e,i.modifiers,i.valueAdapter)};let f;if("number"==typeof i.commonTarget){if(!s.every((e=>"number"==typeof e))){w(3932);continue}if(i.valueAdapter||1!==i.modifiers.length||"string"!=typeof i.modifiers[0]){w(3933);continue}const e=i.modifiers[0],t=a[i.commonTarget],{curve:n}=t.addChannel(e);f=n}(()=>{if("number"==typeof l){if(!s.every((e=>"number"==typeof e)))return void w(3934);let t;if(f)t=f;else{const n=new _O;h(n),e.push(n),t=n.channel.curve}const n=_?El.LINEAR:El.CONSTANT;return t.assignSorted(c,s.map((e=>({value:e,interpolationMode:n})))),void u.convert(t)}if("object"==typeof l)switch(!0){default:break;case wz(s,Ii):case wz(s,_i):case wz(s,Oi):{const t=l instanceof Ii?2:l instanceof _i?3:4,n=new AO;h(n),n.componentsCount=t;const[{curve:i},{curve:o},{curve:a},{curve:r}]=n.channels(),f=_?El.LINEAR:El.CONSTANT,p=e=>({value:e,interpolationMode:f});switch(t){case 4:r.assignSorted(c,s.map((e=>p(e.w)))),u.convert(r);case 3:a.assignSorted(c,s.map((e=>p(e.z)))),u.convert(a);default:i.assignSorted(c,s.map((e=>p(e.x)))),u.convert(i),o.assignSorted(c,s.map((e=>p(e.y)))),u.convert(o)}return void e.push(n)}case wz(s,Ai):{const t=new bO;h(t);const n=_?Sf.SLERP:Sf.CONSTANT;return t.channel.curve.assignSorted(c,s.map((e=>({value:Ai.clone(e),interpolationMode:n})))),u.convertQuatCurve(t.channel.curve),void e.push(t)}case wz(s,ri):{const t=new wO;h(t);const[{curve:n},{curve:i},{curve:o},{curve:a}]=t.channels(),r=_?El.LINEAR:El.CONSTANT,l=e=>({value:e,interpolationMode:r});return n.assignSorted(c,s.map((e=>l(e.r)))),u.convert(n),i.assignSorted(c,s.map((e=>l(e.g)))),u.convert(i),o.assignSorted(c,s.map((e=>l(e.b)))),u.convert(o),a.assignSorted(c,s.map((e=>l(e.a)))),u.convert(a),void e.push(t)}case wz(s,Li):{const t=new MO;h(t);const[{curve:n},{curve:i}]=t.channels(),o=_?El.LINEAR:El.CONSTANT,a=e=>({value:e,interpolationMode:o});return n.assignSorted(c,s.map((e=>a(e.width)))),u.convert(n),i.assignSorted(c,s.map((e=>a(e.height)))),u.convert(i),void e.push(t)}case wz(s,LN):{const t=new _O;h(t);const n=_?El.CUBIC:El.CONSTANT;return t.channel.curve.assignSorted(c,s.map((e=>({value:e.dataPoint,leftTangent:e.inTangent,rightTangent:e.outTangent,interpolationMode:n})))),void e.push(t)}case wz(s,NN):case wz(s,ON):case wz(s,MN):{const t=l instanceof NN?2:l instanceof ON?3:4,n=new AO;h(n),n.componentsCount=t;const[i,o,a,r]=n.channels(),u=_?El.LINEAR:El.CONSTANT,f=(e,t,n)=>({value:e,leftTangent:t,rightTangent:n,interpolationMode:u});switch(t){case 4:r.curve.assignSorted(c,s.map((e=>f(e.dataPoint.w,e.inTangent.w,e.outTangent.w))));case 3:a.curve.assignSorted(c,s.map((e=>f(e.dataPoint.z,e.inTangent.z,e.outTangent.z))));default:i.curve.assignSorted(c,s.map((e=>f(e.dataPoint.y,e.inTangent.y,e.outTangent.y)))),o.curve.assignSorted(c,s.map((e=>f(e.dataPoint.x,e.inTangent.x,e.outTangent.x))))}return void e.push(n)}case s.every((e=>e instanceof zN)):w(3935)}const t=new FO;h(t),t.channel.curve.assignSorted(c,s),e.push(t)})()}return e}_createPropertyCurves(){this._ratioSamplers=this._keys.map((e=>new fz(e.map((e=>e/this._duration))))),this._runtimeCurves=this._curves.map((e=>({curve:new pz(e.data,this._duration),modifiers:e.modifiers,valueAdapter:e.valueAdapter,sampler:this._ratioSamplers[e.data.keys],commonTarget:e.commonTarget})))}}function wz(e,t){return e.every((e=>e instanceof t))}class Iz{constructor(e,t){this._easingMethods=void 0;const{easingMethods:n}=e;Array.isArray(n)?0===n.length&&0!==t?this._easingMethods=new Array(t).fill(null):this._easingMethods=n:this._easingMethods=void 0===n?new Array(t).fill(e.easingMethod):Array.from({length:t},((e,t)=>{var i;return null!==(i=n[t])&&void 0!==i?i:null}))}get nil(){return!this._easingMethods||this._easingMethods.every((e=>null==e))}convert(e){const{_easingMethods:t}=this;if(!t)return;const n=e.keyFramesCount;if(e.keyFramesCount<2)return;Array.isArray(t)&&t.length;const i=n-1;for(let n=0;n<i;++n){const i=t[n];i&&(Array.isArray(i)?Oz(i,e.getKeyframeTime(n),e.getKeyframeValue(n),e.getKeyframeTime(n+1),e.getKeyframeValue(n+1)):Rz(i,e,n))}}convertQuatCurve(e){const{_easingMethods:t}=this;if(!t)return;const n=e.keyFramesCount;if(e.keyFramesCount<2)return;Array.isArray(t)&&t.length;const i=n-1;for(let n=0;n<i;++n){const i=t[n];i&&(Array.isArray(i)?e.getKeyframeValue(n).easingMethod=i.slice():Dz(i,e,n))}}}function Rz(e,t,n){t.keyFramesCount;const i=t.getKeyframeValue(n),o=Nz[e];o===Ih.CONSTANT?i.interpolationMode=El.CONSTANT:(i.interpolationMode=El.LINEAR,i.easingMethod=o)}function Dz(e,t,n){t.keyFramesCount;const i=t.getKeyframeValue(n),o=Nz[e];i.easingMethod=o}const Nz={constant:Ih.CONSTANT,linear:Ih.LINEAR,quadIn:Ih.QUAD_IN,quadOut:Ih.QUAD_OUT,quadInOut:Ih.QUAD_IN_OUT,quadOutIn:Ih.QUAD_OUT_IN,cubicIn:Ih.CUBIC_IN,cubicOut:Ih.CUBIC_OUT,cubicInOut:Ih.CUBIC_IN_OUT,cubicOutIn:Ih.CUBIC_OUT_IN,quartIn:Ih.QUART_IN,quartOut:Ih.QUART_OUT,quartInOut:Ih.QUART_IN_OUT,quartOutIn:Ih.QUART_OUT_IN,quintIn:Ih.QUINT_IN,quintOut:Ih.QUINT_OUT,quintInOut:Ih.QUINT_IN_OUT,quintOutIn:Ih.QUINT_OUT_IN,sineIn:Ih.SINE_IN,sineOut:Ih.SINE_OUT,sineInOut:Ih.SINE_IN_OUT,sineOutIn:Ih.SINE_OUT_IN,expoIn:Ih.EXPO_IN,expoOut:Ih.EXPO_OUT,expoInOut:Ih.EXPO_IN_OUT,expoOutIn:Ih.EXPO_OUT_IN,circIn:Ih.CIRC_IN,circOut:Ih.CIRC_OUT,circInOut:Ih.CIRC_IN_OUT,circOutIn:Ih.CIRC_OUT_IN,elasticIn:Ih.ELASTIC_IN,elasticOut:Ih.ELASTIC_OUT,elasticInOut:Ih.ELASTIC_IN_OUT,elasticOutIn:Ih.ELASTIC_OUT_IN,backIn:Ih.BACK_IN,backOut:Ih.BACK_OUT,backInOut:Ih.BACK_IN_OUT,backOutIn:Ih.BACK_OUT_IN,bounceIn:Ih.BOUNCE_IN,bounceOut:Ih.BOUNCE_OUT,bounceInOut:Ih.BOUNCE_IN_OUT,bounceOutIn:Ih.BOUNCE_OUT_IN,smooth:Ih.SMOOTH,fade:Ih.FADE};function Oz(e,t,n,i,o){const[a,r,s,c]=e,{value:l}=n,{value:_}=o,u=3*(i-t),h=3*(_-l),f=a*u,p=r*h,d=(1-s)*u,m=(1-c)*h,A=1/3,v=p/f,g=Math.sqrt(f*f+p*p)*A,x=m/d,y=Math.sqrt(d*d+m*m)*A;var b;n.interpolationMode=El.CUBIC,n.tangentWeightMode=(b=n.tangentWeightMode)===Pl.NONE?Pl.RIGHT:b===Pl.LEFT?Pl.BOTH:b,n.rightTangent=v,n.rightTangentWeight=g,o.tangentWeightMode=function(e){return e===Pl.NONE?Pl.LEFT:e===Pl.RIGHT?Pl.BOTH:e}(o.tangentWeightMode),o.leftTangent=x,o.leftTangentWeight=y}var Mz,zz,Lz,Fz,Bz,kz,Uz,Gz,jz,Vz,Hz,Wz,qz,Yz,Xz,Qz,Zz,Jz,Kz,$z,eL,tL,nL,iL;function oL(){throw new Error("split() only valid in Editor.")}Uc("cc.animation.ExoticAnimation")((zz=Pc((Mz=class{constructor(){Tc(this,"_nodeAnimations",zz,this)}createEvaluator(e){return new hL(this._nodeAnimations,e)}addNodeAnimation(e){const t=new aL(e);return this._nodeAnimations.push(t),t}collectAnimatedJoints(){return Array.from(new Set(this._nodeAnimations.map((({path:e})=>e))))}split(e,t){return oL()}toHashString(){return this._nodeAnimations.map((e=>e.toHashString())).join("\n")}}).prototype,"_nodeAnimations",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Mz));let aL=Uc("cc.animation.ExoticNodeAnimation")((Bz=Pc((Fz=class{constructor(e){Tc(this,"_path",Bz,this),Tc(this,"_position",kz,this),Tc(this,"_rotation",Uz,this),Tc(this,"_scale",Gz,this),this._path=e}createPosition(e,t){this._position=new uL(e,new lL(t))}createRotation(e,t){this._rotation=new uL(e,new _L(t))}createScale(e,t){this._scale=new uL(e,new lL(t))}createEvaluator(e){return new fL(this._path,this._position,this._rotation,this._scale,e)}split(e,t,n){return oL()}get path(){return this._path}toHashString(){var e,t,n,i,o,a;return`${this._path}\n${null!==(e=null===(t=this._position)||void 0===t?void 0:t.toHashString())&&void 0!==e?e:""}${null!==(n=null===(i=this._scale)||void 0===i?void 0:i.toHashString())&&void 0!==n?n:""}${null!==(o=null===(a=this._rotation)||void 0===a?void 0:a.toHashString())&&void 0!==o?o:""}`}}).prototype,"_path",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),kz=Pc(Fz.prototype,"_position",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uz=Pc(Fz.prototype,"_rotation",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gz=Pc(Fz.prototype,"_scale",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lz=Fz))||Lz;function rL(e){return e.toPrecision(2)}function sL(e){return e.map(rL).join(" ")}let cL=Uc("cc.animation.ExoticVectorLikeTrackValues")((Hz=Pc((Vz=class{constructor(e){Tc(this,"_values",Hz,this),Tc(this,"_isQuantized",Wz,this),this._values=e,this._isQuantized=!1}get precision(){return this._isQuantized?this._values.originalPrecision:AL(this._values)}quantize(e){this._isQuantized,this._values=function(e,t){const n=dL[t],i=1<<n.BYTES_PER_ELEMENT;let o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;e.forEach((e=>{o=Math.min(e,o),a=Math.max(e,a)}));const r=a-o,s=n.from(e,(e=>(e-o)/r*i));return new vL(AL(e),s,r,o)}(this._values,e),this._isQuantized=!0}toHashString(){const{_isQuantized:e,_values:t}=this;return`${e} ${e?t.toHashString():sL(t)}`}}).prototype,"_values",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wz=Pc(Vz.prototype,"_isQuantized",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jz=Vz))||jz,lL=Uc("cc.animation.ExoticVec3TrackValues")(qz=class e extends cL{static imitate(t,n){const i=new e(t);return n._isQuantized&&i.quantize(n._values.quantizationType),i}get(e,t){const{_values:n,_isQuantized:i}=this;i?yL(n,e,t):_i.fromArray(t,n,3*e)}lerp(e,t,n,i,o,a){const{_values:r,_isQuantized:s}=this;s?(yL(r,e,i),yL(r,t,o)):(_i.fromArray(i,r,3*e),_i.fromArray(o,r,3*t)),_i.lerp(a,i,o,n)}})||qz,_L=Uc("cc.animation.ExoticQuatTrackValues")(Yz=class e extends cL{static imitate(t,n){const i=new e(t);return n._isQuantized&&i.quantize(n._values.quantizationType),i}get(e,t){const{_values:n,_isQuantized:i}=this;i?bL(n,e,t):Ai.fromArray(t,n,4*e)}lerp(e,t,n,i,o,a){const{_values:r,_isQuantized:s}=this;s?(bL(r,e,i),bL(r,t,o)):(Ai.fromArray(i,r,4*e),Ai.fromArray(o,r,4*t)),Ai.slerp(a,i,o,n)}})||Yz,uL=Uc("cc.animation.ExoticTrack")((Zz=Pc((Qz=class{constructor(e,t){Tc(this,"times",Zz,this),Tc(this,"values",Jz,this),this.times=e,this.values=t}toHashString(){const{times:e,values:t}=this;return`times: ${sL(e)}; values: ${t.toHashString()}`}}).prototype,"times",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jz=Pc(Qz.prototype,"values",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xz=Qz))||Xz;class hL{constructor(e,t){this._nodeEvaluations=void 0,this._nodeEvaluations=e.map((e=>e.createEvaluator(t)))}evaluate(e){this._nodeEvaluations.forEach((t=>{t.evaluate(e)}))}}class fL{constructor(e,t,n,i,o){this._position=null,this._rotation=null,this._scale=null,t&&(this._position=xL(t.times,t.values,_i,e,"position",o)),n&&(this._rotation=xL(n.times,n.values,Ai,e,"rotation",o)),i&&(this._scale=xL(i.times,i.values,_i,e,"scale",o))}evaluate(e){if(this._position){const t=this._position.evaluator.evaluate(e);this._position.runtimeBinding.setValue(t)}if(this._rotation){const t=this._rotation.evaluator.evaluate(e);this._rotation.runtimeBinding.setValue(t)}if(this._scale){const t=this._scale.evaluator.evaluate(e);this._scale.runtimeBinding.setValue(t)}}}class pL{constructor(e,t,n){this._times=void 0,this._inputSampleResultCache={just:!1,index:-1,nextIndex:-1,ratio:0},this._values=void 0,this._prevValue=void 0,this._nextValue=void 0,this._resultValue=void 0,this._times=e,this._values=t,this._prevValue=new n,this._nextValue=new n,this._resultValue=new n}evaluate(e){const{_times:t,_values:n,_resultValue:i}=this;if(0===t.length)return i;const o=function(e,t,n){const i=e.length,o=e[0],a=e[i-1];if(t<o)n.just=!0,n.index=0;else if(t>a)n.just=!0,n.index=i-1;else{const i=Dc(e,t);if(i>=0)n.just=!0,n.index=i;else{const o=~i,a=o-1,r=e[a],s=e[o],c=(t-e[a])/(s-r);n.just=!1,n.index=a,n.nextIndex=o,n.ratio=c}}return n}(t,e,this._inputSampleResultCache);return o.just?n.get(o.index,i):n.lerp(o.index,o.nextIndex,o.ratio,this._prevValue,this._nextValue,i),i}}const dL={uint8:Uint8Array,uint16:Uint16Array};var mL;function AL(e){switch(e.BYTES_PER_ELEMENT){default:case 4:return mL.FLOAT_32;case 8:return mL.FLOAT_64}}!function(e){e[e.FLOAT_32=0]="FLOAT_32",e[e.FLOAT_64=1]="FLOAT_64"}(mL||(mL={}));let vL=Uc("cc.animation.QuantizedFloatArray")((eL=Pc(($z=class{get quantizationType(){switch(this.values.BYTES_PER_ELEMENT){default:case 1:return"uint8";case 2:return"uint16"}}constructor(e,t,n,i=0){Tc(this,"originalPrecision",eL,this),Tc(this,"min",tL,this),Tc(this,"extent",nL,this),Tc(this,"values",iL,this),this.originalPrecision=e,this.values=t,this.extent=n,this.min=i}toHashString(){const{originalPrecision:e,min:t,extent:n,values:i}=this;return`${e} ${rL(t)} ${rL(n)} ${i.join(" ")}`}}).prototype,"originalPrecision",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tL=Pc($z.prototype,"min",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nL=Pc($z.prototype,"extent",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iL=Pc($z.prototype,"values",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kz=$z))||Kz;function gL(e,t){return e.values[t]/(1<<e.values.BYTES_PER_ELEMENT)*e.extent+e.min}function xL(e,t,n,i,o,a){const r=new oO;r.path=(new iO).toHierarchy(i).toProperty(o);const s=a(r);return s?{runtimeBinding:s,evaluator:new pL(e,t,n)}:null}function yL(e,t,n){_i.set(n,gL(e,3*t+0),gL(e,3*t+1),gL(e,3*t+2))}function bL(e,t,n){Ai.set(n,gL(e,4*t+0),gL(e,4*t+1),gL(e,4*t+2),gL(e,4*t+3))}var SL,CL,EL,TL,PL,wL,IL,RL,DL,NL,OL,ML,zL;const LL=Symbol("SearchForRootBonePath"),FL=Symbol("ExoticAnimation");let BL=e("gt",Uc("cc.AnimationClip")((zL=ML=class e extends __{constructor(...e){super(...e),Tc(this,"sample",EL,this),Tc(this,"speed",TL,this),Tc(this,"wrapMode",PL,this),Tc(this,"enableTrsBlending",wL,this),Tc(this,"_duration",IL,this),Tc(this,"_hash",RL,this),this.frameRate=0,Tc(this,"_tracks",DL,this),Tc(this,"_exoticAnimation",NL,this),this._legacyData=void 0,this._legacyDataDirty=!1,Tc(this,"_events",OL,this),this._runtimeEvents={ratios:[],eventGroups:[]}}static createWithSpriteFrames(t,n){const i=new e;i.sample=n||i.sample,i.duration=t.length/i.sample;const o=1/i.sample,a=new FO;return a.path=(new iO).toComponent("cc.Sprite").toProperty("spriteFrame"),a.channels()[0].curve.assignSorted(t.map(((e,t)=>[o*t,e]))),i.addTrack(a),i}get duration(){return this._duration}set duration(e){this._duration=e}get tracksCount(){return this._tracks.length}get tracks(){return this._tracks}get hash(){var e,t;if(this._hash)return this._hash;const n=`Exotic:${null!==(e=null===(t=this._exoticAnimation)||void 0===t?void 0:t.toHashString())&&void 0!==e?e:""}`;return this._hash=Xr(n,666)}get events(){return this._events}set events(e){this._events=e;const t=[],n=[],i=this.events.sort(((e,t)=>e.frame-t.frame)),o=i.length;for(let e=0;e<o;++e){const o=i[e],a=o.frame/this._duration;let r=t.findIndex((e=>e===a));r<0&&(r=t.length,t.push(a),n.push({events:[]})),n[r].events.push({functionName:o.func,parameters:o.params})}this._runtimeEvents={ratios:t,eventGroups:n}}get[FL](){return this._exoticAnimation}set[FL](e){this._exoticAnimation=e}onLoaded(){this.frameRate=this.sample,this.events=this._events}range(){const e={min:1/0,max:-1/0},{_tracks:t}=this,n=t.length;for(let i=0;i<n;++i){const n=t[i].range();e.min=Math.min(e.min,n.min),e.max=Math.max(e.max,n.max)}return e}getTrack(e){return this._tracks[e]}addTrack(e){const t=this._tracks.length;return this._tracks.push(e),t}removeTrack(e){this._tracks.splice(e,1)}clearTracks(){this._tracks.length=0}createEventEvaluator(e){return new qL(e,this._runtimeEvents.ratios,this._runtimeEvents.eventGroups,this.wrapMode)}createEvaluator(e){const{target:t}=e;return this._createEvalWithBinder(t,(n=>{const i=n.createRuntimeBinding(t,this.enableTrsBlending?e.pose:void 0,!1);return null!=i?i:void 0}),e.rootMotion)}destroy(){var e;return(null===(e=c.director.root)||void 0===e?void 0:e.dataPoolManager)&&c.director.root.dataPoolManager.releaseAnimationClip(this),hz.destroy(this),super.destroy()}[uz](e,t,n){const i=1/t,o=this._collectAnimatedJoints(),a=o.length,r={};for(let e=0;e<a;++e)r[o[e]]={transforms:Array.from({length:n},(()=>new Ei))};const s=o.reduce(((e,t)=>(e[t]=new GL,e)),{});for(const e in s){const t=s[e],n=e.lastIndexOf("/");if(n>=0){const i=e.substring(0,n),o=s[i];o&&(t.parent=o)}}const c=this._createEvalWithBinder(void 0,(e=>{const t=e.parseTrsPath();if(!t)return;const n=s[t.node];return n?WL(n,t.property):void 0}),void 0);for(let t=0;t<n;++t){const n=e+i*t;c.evaluate(n);for(let e=0;e<a;++e){const n=o[e];Ei.copy(r[n].transforms[t],s[n].globalTransform)}for(let e=0;e<a;++e){const t=o[e];s[t].invalidate()}}return{samples:t,frames:n,joints:r}}upgradeUntypedTracks(e){const t=[],n=[],{_tracks:i}=this,o=i.length;for(let a=0;a<o;++a){const o=i[a];if(!(o instanceof Tz))continue;const r=o.upgrade(e);r&&(t.push(r),n.push(o))}const a=n.length;for(let e=0;e<a;++e)De.remove(i,n[e]);i.push(...t)}[LL](){return this._searchForRootBonePath()}get keys(){return this._getLegacyData().keys}set keys(e){this._legacyDataDirty=!0,this._getLegacyData().keys=e}get curves(){return this._legacyDataDirty=!0,this._getLegacyData().curves}set curves(e){this._getLegacyData().curves=e}get commonTargets(){return this._getLegacyData().commonTargets}set commonTargets(e){this._legacyDataDirty=!0,this._getLegacyData().commonTargets=e}get data(){return this._getLegacyData().data}getPropertyCurves(){return this._getLegacyData().getPropertyCurves()}get eventGroups(){return this._runtimeEvents.eventGroups}updateEventDatas(){this.events=this._events}hasEvents(){return 0!==this.events.length}syncLegacyData(){this._legacyData&&(this._fromLegacy(this._legacyData),this._legacyData=void 0)}_createEvalWithBinder(e,t,n){this._legacyDataDirty&&(this._legacyDataDirty=!1,this.syncLegacyData());const i=[];let o;n&&(o=this._createRootMotionEvaluation(e,n,i));const a=[];let r;const{_tracks:s}=this,c=s.length;for(let e=0;e<c;++e){const n=s[e];if(i.includes(n))continue;if(Array.from(n.channels()).every((({curve:e})=>0===e.keyFramesCount)))continue;const o=t(n[nO]);if(!o)continue;const r=n[FN](o);a.push({binding:o,trackEval:r})}return this._exoticAnimation&&(r=this._exoticAnimation.createEvaluator(t)),new kL(a,r,o)}_createRootMotionEvaluation(e,t,n){if(!(e instanceof Ox))return void R(3920);const i=this._searchForRootBonePath();if(!i)return void w(3923);const o=e.getChildByPath(i);if(!o)return void w(3924);const a=new UL,r=[],{_tracks:s}=this,c=s.length;for(let e=0;e<c;++e){const t=s[e],{[nO]:o}=t,c=o.parseTrsPath();if(!c)continue;if(c.node!==i)continue;n.push(t);const l=WL(a,c.property);if(!l)continue;const _=t[FN](l);r.push({binding:l,trackEval:_})}return new VL(o,this._duration,a,r)}_searchForRootBonePath(){const e=this._tracks.map((e=>{const t=e[nO].parseTrsPath();if(t){const e=t.node;return{path:e,rank:e.split("/").length}}return{path:"",rank:0}}));e.sort(((e,t)=>e.rank-t.rank));const t=e.findIndex((e=>0!==e.rank));if(t<0)return"";const n=e.length,i=e[t];let o=!0;for(let a=t+1;a<n;++a){const t=e[a];if(t.rank!==i.rank)break;if(t.path!==i.path){o=!1;break}}return o?i.path:""}_getLegacyData(){return this._legacyData||(this._legacyData=this._toLegacy()),this._legacyData}_toLegacy(){const e=new Pz(this._duration);return e.keys=[],e.curves=[],e.commonTargets=[],e}_fromLegacy(e){const t=e.toTracks(),n=t.length;for(let e=0;e<n;++e)this.addTrack(t[e])}_collectAnimatedJoints(){const e=new Set,{_tracks:t}=this,n=t.length;for(let i=0;i<n;++i){const n=t[i][nO].parseTrsPath();n&&e.add(n.node)}if(this._exoticAnimation){const t=this._exoticAnimation.collectAnimatedJoints(),n=t.length;for(let i=0;i<n;++i)e.add(t[i])}return Array.from(e)}},ML.WrapMode=Ic,EL=Pc((CL=zL).prototype,"sample",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),TL=Pc(CL.prototype,"speed",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),PL=Pc(CL.prototype,"wrapMode",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ic.Normal}}),wL=Pc(CL.prototype,"enableTrsBlending",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),IL=Pc(CL.prototype,"_duration",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),RL=Pc(CL.prototype,"_hash",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),DL=Pc(CL.prototype,"_tracks",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),NL=Pc(CL.prototype,"_exoticAnimation",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),OL=Pc(CL.prototype,"_events",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SL=CL))||SL);c.AnimationClip=BL;class kL{constructor(e,t,n){this._exoticAnimationEvaluator=void 0,this._trackEvalStatues=[],this._rootMotionEvaluation=void 0,this._trackEvalStatues=e,this._exoticAnimationEvaluator=t,this._rootMotionEvaluation=n}evaluate(e){const{_trackEvalStatues:t,_exoticAnimationEvaluator:n}=this,i=t.length;for(let n=0;n<i;++n){const{trackEval:i,binding:o}=t[n],a=i.evaluate(e,o);o.setValue(a)}n&&n.evaluate(e)}evaluateRootMotion(e,t){const{_rootMotionEvaluation:n}=this;n&&n.evaluate(e,t)}}class UL{constructor(){this.position=new _i,this.scale=new _i(1,1,1),this.rotation=new Ai,this.eulerAngles=new _i}getTransform(e){Ei.fromRTS(e,this.rotation,this.position,this.scale)}}class GL extends UL{constructor(...e){super(...e),this.parent=null,this._dirty=!0,this._transform=new Ei}get globalTransform(){const e=this._transform;return this._dirty&&(this._dirty=!1,Ei.fromRTS(e,this.rotation,this.position,this.scale),this.parent&&Ei.multiply(e,this.parent.globalTransform,e)),this._transform}invalidate(){this._dirty=!0}}const jL=new Ei;class VL{constructor(e,t,n,i){this._initialTransformCache=new Ei,this._clipEndTransformCache=new Ei,this._startTransformCache=new Ei,this._endTransformCache=new Ei,this._motionTransformCache=new Ei,this._translationMotionCache=new _i,this._rotationMotionCache=new Ai,this._scaleMotionCache=new _i,this._rootBone=e,this._duration=t,this._boneTransform=n,this._trackEvalStatuses=i}evaluate(e,t){const n=this._calcMotionTransform(e,t,this._motionTransformCache),{_translationMotionCache:i,_rotationMotionCache:o,_scaleMotionCache:a,_rootBone:r}=this;Ei.toRTS(n,o,i,a),_i.add(i,i,r.position),r.setPosition(i),Ai.multiply(o,o,r.rotation),r.setRotation(o),_i.multiply(a,a,r.scale),r.setScale(a)}_calcMotionTransform(e,t,n){const{_duration:i}=this,o=i-e,a=this._evaluateAt(e,this._startTransformCache);if(t<o){const i=this._evaluateAt(e+t,this._endTransformCache);HL(n,a,i)}else{Ei.identity(n);const e=(e,t)=>{HL(jL,e,t),Ei.multiply(n,n,jL)},r=t-o,s=Math.floor(r/i),c=r-s*i,l=this._evaluateAt(0,this._initialTransformCache),_=this._evaluateAt(i,this._clipEndTransformCache),u=this._evaluateAt(c,this._endTransformCache);e(a,_),HL(jL,l,_);for(let e=0;e<s;++e)Ei.multiply(n,n,jL);e(l,u)}return n}_evaluateAt(e,t){const{_trackEvalStatuses:n}=this,i=n.length;for(let t=0;t<i;++t){const{trackEval:i,binding:o}=n[t],a=i.evaluate(e,o);o.setValue(a)}return this._boneTransform.getTransform(t),t}}function HL(e,t,n){Ei.invert(e,t),Ei.multiply(e,n,e)}function WL(e,t){switch(t){default:return;case"position":return{setValue(t){_i.copy(e.position,t)}};case"rotation":return{setValue(t){Ai.copy(e.rotation,t)}};case"scale":return{setValue(t){_i.copy(e.scale,t)}};case"eulerAngles":return{setValue(t){_i.copy(e.eulerAngles,t)}}}}class qL{constructor(e,t,n,i){this._lastFrameIndex=-1,this._lastIterations=0,this._lastDirection=0,this._ignoreIndex=-1,this._sampled=!1,this._targetNode=e,this._ratios=t,this._eventGroups=n,this._wrapMode=i}setWrapMode(e){this._wrapMode=e}ignore(e,t){this._ignoreIndex=-1,this._sampled=!1;let n=XL(e,this._ratios);n<0&&(n=~n-1,t<0&&(n+=1),this._ignoreIndex=n)}sample(e,t,n){const i=this._eventGroups.length;let o=XL(e,this._ratios);if(o<0&&(o=~o-1,t<0&&(o+=1)),this._ignoreIndex!==o&&(this._ignoreIndex=-1),!this._sampled)return this._sampled=!0,this._doFire(o,!1),this._lastFrameIndex=o,this._lastIterations=n,void(this._lastDirection=t);const a=this._wrapMode,r=YL(n);let s=YL(this._lastIterations),c=this._lastFrameIndex;const l=this._lastDirection,_=-1!==s&&r!==s;if(c===o&&_&&1===i)this._doFire(0,!1);else if(c!==o||_){t=l;do{if(c!==o){if(-1===t&&0===c&&o>0?((a&wc.PingPong)===wc.PingPong?t*=-1:c=i,s++):1===t&&c===i-1&&o<i-1&&((a&wc.PingPong)===wc.PingPong?t*=-1:c=-1,s++),c===o)break;if(s>r)break}c+=t,this._doFire(c,!0)}while(c!==o&&c>-1&&c<i)}this._lastFrameIndex=o,this._lastIterations=n,this._lastDirection=t}_doFire(e,t){t?c.director.getAnimationManager().pushDelayEvent(this._checkAndFire,this,[e]):this._checkAndFire(e)}_checkAndFire(e){if(!this._targetNode||!this._targetNode.isValid)return;const{_eventGroups:t}=this;if(e<0||e>=t.length||this._ignoreIndex===e)return;const n=t[e],i=this._targetNode.components,o=n.events.length;for(let e=0;e<o;++e){const t=n.events[e],{functionName:o}=t,a=i.length;for(let e=0;e<a;++e){const n=i[e],a=n[o];"function"==typeof a&&a.apply(n,t.parameters)}}}}function YL(e){return e-(0|e)==0&&(e-=1),0|e}function XL(e,t){return Dc(t,e)}class QL{constructor(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get isMotionless(){return!this.isPlaying||this.isPaused}play(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(M(3912)):(this._isPlaying=!0,this.onPlay())}stop(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)}pause(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())}resume(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())}step(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()}update(e){}onPlay(){}onPause(){}onResume(){}onStop(){}onError(e){}}class ZL{constructor(e){this.weight=0,this._pose=void 0,this._blendStateWriters=[],this._pose=e}destroy(){for(let e=0;e<this._blendStateWriters.length;++e)this._pose.destroyWriter(this._blendStateWriters[e]);this._blendStateWriters.length=0}createPoseWriter(e,t,n){const i=this._pose.createWriter(e,t,this,n);return this._blendStateWriters.push(i),i}}let JL;!function(e){e.PLAY="play",e.STOP="stop",e.PAUSE="pause",e.RESUME="resume",e.LASTFRAME="lastframe",e.FINISHED="finished"}(JL||(JL={})),je(JL);class KL extends QL{get clip(){return this._clip}get name(){return this._name}get length(){return this.duration}get wrapMode(){return this._wrapMode}set wrapMode(e){var t;this._wrapMode=e,this.time=0,e&wc.Loop?this.repeatCount=1/0:this.repeatCount=1,null===(t=this._clipEventEval)||void 0===t||t.setWrapMode(e)}get repeatCount(){return this._repeatCount}set repeatCount(e){this._repeatCount=e;const t=this._wrapMode&wc.ShouldWrap,n=(this.wrapMode&wc.Reverse)===wc.Reverse;this._useSimpleProcess=e===1/0&&!t&&!n}get delay(){return this._delay}set delay(e){this._delayTime=this._delay=e}get playbackRange(){return this._playbackRange}set playbackRange(e){e.max,e.min,this._playbackRange.min=Math.max(e.min,0),this._playbackRange.max=Math.min(e.max,this.duration),this._playbackDuration=this._playbackRange.max-this._playbackRange.min,this.setTime(0)}get current(){return this.getWrappedInfo(this.time).time}get ratio(){return this.current/this.duration}get weight(){return this._weight}set weight(e){this._weight=e,this._poseOutput&&(this._poseOutput.weight=e)}constructor(e,t=""){super(),this.duration=1,this.speed=1,this.time=0,this.frameRate=0,this._targetNode=null,this._curveLoaded=!1,this._clip=void 0,this._useSimpleProcess=!1,this._target=null,this._wrapMode=Ic.Normal,this._repeatCount=1,this._delay=0,this._delayTime=0,this._currentFramePlayed=!1,this._name=void 0,this._lastIterations=NaN,this._lastWrapInfo=null,this._wrappedInfo=new Rc,this._allowLastFrame=!1,this._blendStateWriterHost={weight:0},this._playbackDuration=0,this._invDuration=1,this._poseOutput=null,this._weight=1,this._clipEval=void 0,this._clipEventEval=void 0,this._doNotCreateEval=!1,this._clip=e,this._name=t||e&&e.name,this._playbackRange={min:0,max:e.duration},this._playbackDuration=e.duration,e.duration||y(`Clip ${e.name} has zero duration.`)}get curveLoaded(){return this._curveLoaded}initialize(e,t,n){if(this._curveLoaded)return;this._curveLoaded=!0,this._poseOutput&&(this._poseOutput.destroy(),this._poseOutput=null),this._clipEval&&(this._clipEval=void 0),this._targetNode=e;const i=this._clip;if(this.duration=i.duration,this._invDuration=1/this.duration,this.speed=i.speed,this.wrapMode=i.wrapMode,this.frameRate=i.sample,this._playbackRange.min=0,this._playbackRange.max=i.duration,this._playbackDuration=i.duration,(this.wrapMode&wc.Loop)===wc.Loop?this.repeatCount=1/0:this.repeatCount=1,!this._doNotCreateEval){var o,a,r;const n=null!==(o=null!=t?t:null===(a=c.director.getAnimationManager())||void 0===a?void 0:a.blendState)&&void 0!==o?o:null;n&&(this._poseOutput=new ZL(n)),this._clipEval=i.createEvaluator({target:e,pose:null!==(r=this._poseOutput)&&void 0!==r?r:void 0})}this._clipEventEval=i.createEventEvaluator(this._targetNode)}destroy(){this.isMotionless||c.director.getAnimationManager().removeAnimation(this),this._poseOutput&&(this._poseOutput.destroy(),this._poseOutput=null),this._clipEval=void 0}emit(...e){c.director.getAnimationManager().pushDelayEvent(this._emit,this,e)}on(e,t,n){return this._target&&this._target.isValid?this._target.on(e,t,n):null}once(e,t,n){return this._target&&this._target.isValid?this._target.once(e,t,n):null}off(e,t,n){this._target&&this._target.isValid&&this._target.off(e,t,n)}allowLastFrameEvent(e){this._allowLastFrame=e}_setEventTarget(e){this._target=e}setTime(e){this._currentFramePlayed=!1,this.time=e||0;{var t;const n=this.getWrappedInfo(e,this._wrappedInfo);null===(t=this._clipEventEval)||void 0===t||t.ignore(n.ratio,n.direction)}}update(e){this._delayTime>0&&(this._delayTime-=e,this._delayTime>0)||(this._currentFramePlayed?this.time+=e*this.speed:this._currentFramePlayed=!0,this._process())}sample(){const e=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(e.time),this._sampleEvents(e),e}onPlay(){this.setTime(this._getPlaybackStart()),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(JL.PLAY,this)}onStop(){this.isPaused||this._onPauseOrStop(),this.emit(JL.STOP,this)}onResume(){this._onReplayOrResume(),this.emit(JL.RESUME,this)}onPause(){this._onPauseOrStop(),this.emit(JL.PAUSE,this)}_sampleCurves(e){const{_poseOutput:t,_clipEval:n}=this;t&&(t.weight=this.weight),n&&n.evaluate(e)}_process(){this._useSimpleProcess?this.simpleProcess():this.process()}process(){const e=this.sample();if(this._allowLastFrame){let t;t=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new Rc(e),this.repeatCount>1&&(0|e.iterations)>(0|t.iterations)&&this.emit(JL.LASTFRAME,this),t.set(e)}e.stopped&&(this.stop(),this.emit(JL.FINISHED,this))}simpleProcess(){const e=this._playbackRange.min,t=this._playbackDuration;let n=this.time%t;n<0&&(n+=t);const i=(e+n)*this._invDuration;this._sampleCurves(e+n),this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(Number.isNaN(this._lastIterations)&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit(JL.LASTFRAME,this),this._lastIterations=i)}_needReverse(e){const t=this.wrapMode;let n=!1;return(t&wc.PingPong)===wc.PingPong&&(e-(0|e)==0&&e>0&&(e-=1),1&e&&(n=!n)),(t&wc.Reverse)===wc.Reverse&&(n=!n),n}getWrappedInfo(e,t){t=t||new Rc;const n=this._getPlaybackStart(),i=this._getPlaybackEnd()-n;let o=!1;const a=this.repeatCount;let r=(e-=n)>0?e/i:-e/i;if(r>=a){r=a,o=!0;let t=a-(0|a);0===t&&(t=1),e=t*i*(e>0?1:-1)}if(e>i){const t=e%i;e=0===t?i:t}else e<0&&0!=(e%=i)&&(e+=i);let s=!1;const c=this._wrapMode&wc.ShouldWrap;c&&(s=this._needReverse(r));let l=s?-1:1;return this.speed<0&&(l*=-1),c&&s&&(e=i-e),t.time=n+e,t.ratio=t.time/this.duration,t.direction=l,t.stopped=o,t.iterations=r,t}_getPlaybackStart(){return this._playbackRange.min}_getPlaybackEnd(){return this._playbackRange.max}_sampleEvents(e){var t;null===(t=this._clipEventEval)||void 0===t||t.sample(e.ratio,e.direction,e.iterations)}_emit(e,t){this._target&&this._target.isValid&&this._target.emit(e,e,t)}_onReplayOrResume(){c.director.getAnimationManager().addAnimation(this)}_onPauseOrStop(){c.director.getAnimationManager().removeAnimation(this)}}e("cM",KL),c.AnimationState=KL;const $L=tF,eF=tF;function tF(){}var nF,iF,oF,aF,rF,sF,cF,lF,_F,uF;nF=Uc("cc.animation.ClipMotion"),iF=vl(BL),nF((aF=Pc((oF=class e extends Rl{constructor(...e){super(...e),Tc(this,"clip",aF,this)}[VO](e){return this.clip?new hF(e,this.clip):null}clone(){const t=new e;return t.clip=this.clip,t}}).prototype,"clip",[iF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oF));class hF{constructor(e,t){this.duration=t.duration,this._state=new KL(t),this._state.initialize(e.node,e.blendBuffer)}getClipStatuses(e){let t=!1;return{next:()=>t?{done:!0,value:void 0}:(t=!0,{done:!1,value:{__DEBUG_ID__:this.__DEBUG__ID__,clip:this._state.clip,weight:e}})}}get progress(){return this._state.time/this.duration}sample(e,t){if(0===t)return;this._state.name;const n=this._state.duration*e;this._state.time=n,this._state.weight=t,this._state.sample(),this._state.weight=0}}let fF=Uc("cc.animation.AnimationBlendItem")((cF=Pc((sF=class e{constructor(){Tc(this,"motion",cF,this)}clone(){const t=new e;return this._assign(t),t}_assign(e){var t,n;return e.motion=null!==(t=null===(n=this.motion)||void 0===n?void 0:n.clone())&&void 0!==t?t:null,e}}).prototype,"motion",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rF=sF))||rF,pF=Uc("cc.animation.AnimationBlend")((uF=Pc((_F=class extends Rl{constructor(...e){super(...e),Tc(this,"name",uF,this)}}).prototype,"name",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),lF=_F))||lF;class dF{constructor(e,t,n){this._childEvaluators=t.map((t=>{var n,i;return null!==(n=null===(i=t.motion)||void 0===i?void 0:i[VO](e))&&void 0!==n?n:null})),this._weights=new Array(this._childEvaluators.length).fill(0),this._inputs=[...n]}get duration(){let e=0;for(let i=0;i<this._childEvaluators.length;++i){var t,n;e+=(null!==(t=null===(n=this._childEvaluators[i])||void 0===n?void 0:n.duration)&&void 0!==t?t:0)*this._weights[i]}return e}getClipStatuses(e){const{_childEvaluators:t,_weights:n}=this,i=t.length;let o,a=0;return{next(){for(;;){if(o){const e=o.next();if(!e.done)return e}if(a>=i)return{done:!0,value:void 0};{const i=t[a];o=null==i?void 0:i.getClipStatuses(e*n[a]),++a}}}}}sample(e,t){for(let i=0;i<this._childEvaluators.length;++i){var n;null===(n=this._childEvaluators[i])||void 0===n||n.sample(e,t*this._weights[i])}}setInput(e,t){this._inputs[t]=e,this.doEval()}doEval(){this.eval(this._weights,this._inputs)}eval(e,t){}}var mF,AF,vF,gF,xF,yF,bF,SF;let CF=Uc("cc.animation.AnimationBlend1DItem")((vF=Pc((AF=class e extends fF{constructor(...e){super(...e),Tc(this,"threshold",vF,this)}clone(){const t=new e;return this._assign(t),t}_assign(e){return super._assign(e),e.threshold=this.threshold,e}}).prototype,"threshold",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mF=AF))||mF;Uc("cc.animation.AnimationBlend1D")((SF=bF=class e extends pF{constructor(...e){super(...e),Tc(this,"_items",xF,this),Tc(this,"param",yF,this)}get items(){return this._items}set items(e){this._items=Array.from(e).sort((({threshold:e},{threshold:t})=>e-t))}clone(){const t=new e;return t._items=this._items.map((e=>e.clone())),t.param=this.param.clone(),t}[VO](e){const t=new EF(e,this._items,this._items.map((({threshold:e})=>e)),0),n=uM(e,this.param,cM.FLOAT,t.setInput,t,0);return t.setInput(n,0),t}},bF.Item=CF,xF=Pc((gF=SF).prototype,"_items",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yF=Pc(gF.prototype,"param",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lM}}),gF));class EF extends dF{constructor(e,t,n,i){super(e,t,[i]),this._thresholds=n,this.doEval()}eval(e,[t]){!function(e,t,n){if(e.fill(0),0===t.length);else if(n<=t[0])e[0]=1;else if(n>=t[t.length-1])e[e.length-1]=1;else{let i=0;for(let e=1;e<t.length;++e)if(t[e]>n){i=e;break}const o=t[i-1],a=t[i],r=a-o;e[i-1]=(a-n)/r,e[i]=(n-o)/r}}(e,this._thresholds,t)}}const TF=(()=>{const e=new Ii,t={wA:0,wB:0};return function(n,i,o){if(n.length,i.length,0===i.length)return;if(1===i.length)return void(n[0]=1);if(Ii.strictEquals(o,Ii.ZERO)){const e=i.findIndex((e=>Ii.strictEquals(e,Ii.ZERO)));return void(e>=0?n[e]=1:n.fill(1/i.length))}let a=-1,r=-1,s=-1,c=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const{x:_,y:u}=o;for(let t=0;t<i.length;++t){const n=i[t];if(Ii.equals(n,Ii.ZERO)){s=t;continue}const h=Ii.normalize(e,n),f=Ii.dot(h,o);h.x*u-h.y*_>0?f>=l&&(l=f,a=t):f>=c&&(c=f,r=t)}let h=0;if(a<0||r<0)h=1;else{const{wA:e,wB:s}=function(e,t,n,i){const o=Ii.cross(e,t);return o?(i.wA=Ii.cross(n,t)/o,i.wB=Ii.cross(n,e)/-o):(i.wA=0,i.wB=0),i}(i[a],i[r],o,t);let c=0,l=0;const _=e+s;_>1?(c=e/_,l=s/_):_<0?(c=0,l=0,h=1):(c=e,l=s,h=1-_),n[a]=c,n[r]=l}if(h>0)if(s>=0)n[s]=h;else{const e=h/n.length;for(let t=0;t<n.length;++t)n[t]+=e}}})();function PF(e,t,n,i){e.fill(0);const o=new Ii(0,0),a=new Ii(0,0);let r=0;const s=t.length;for(let c=0;c<s;++c){let l=Number.MAX_VALUE,_=!1;for(let e=0;e<s;++e){if(c===e)continue;i(t[c],t[e],n,o,a);const r=1-Ii.dot(o,a)/Ii.lengthSqr(a);if(r<0){_=!0;break}l=Math.min(l,r)}_||(e[c]=l,r+=l)}r>0&&e.forEach(((t,n)=>e[n]=t/r))}const wF=(e,t,n,i,o)=>{Ii.subtract(i,n,e),Ii.subtract(o,t,e)},IF=(()=>{const e=new _i(0,0,0),t=new _i(0,0,0),n=new _i(0,0,0),i=new _i(0,0,0),o=new _i(0,0,0),a=new _i(0,0,0);return(r,s,c,l,_)=>{let u=0,h=0,f=2;_i.set(n,c.x,c.y,0),Ii.equals(r,Ii.ZERO)?(u=Ii.angle(c,s),h=0,f=1):Ii.equals(s,Ii.ZERO)?(u=Ii.angle(c,r),h=u,f=1):(u=Ii.angle(r,s),u<=0?h=0:Ii.equals(c,Ii.ZERO)?h=u:(_i.set(i,r.x,r.y,0),_i.set(o,s.x,s.y,0),_i.set(a,c.x,c.y,0),_i.cross(e,i,o),_i.projectOnPlane(n,a,e),h=_i.angle(i,n),u<.99*Math.PI&&_i.dot(_i.cross(t,i,n),e)<0&&(h=-h)));const p=Ii.len(r),d=Ii.len(s),m=(d+p)/2;Ii.set(_,(d-p)/m,u*f),Ii.set(l,(_i.len(n)-p)/m,h*f)}})();var RF,DF,NF,OF,MF,zF,LF,FF,BF,kF,UF;!function(e){e[e.SIMPLE_DIRECTIONAL=0]="SIMPLE_DIRECTIONAL",e[e.FREEFORM_CARTESIAN=1]="FREEFORM_CARTESIAN",e[e.FREEFORM_DIRECTIONAL=2]="FREEFORM_DIRECTIONAL"}(UF||(UF={})),je(UF);let GF=Uc("cc.animation.AnimationBlend2DItem")((NF=Pc((DF=class e extends fF{constructor(...e){super(...e),Tc(this,"threshold",NF,this)}clone(){const t=new e;return this._assign(t),t}_assign(e){return super._assign(e),Ii.copy(e.threshold,this.threshold),e}}).prototype,"threshold",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ii}}),RF=DF))||RF;Uc("cc.animation.AnimationBlend2D")((kF=BF=class e extends pF{constructor(...e){super(...e),Tc(this,"algorithm",MF,this),Tc(this,"_items",zF,this),Tc(this,"paramX",LF,this),Tc(this,"paramY",FF,this)}get items(){return this._items}set items(e){this._items=Array.from(e)}clone(){const t=new e;return t._items=this._items.map((e=>{var t;return null!==(t=null==e?void 0:e.clone())&&void 0!==t?t:null})),t.paramX=this.paramX.clone(),t.paramY=this.paramY.clone(),t}[VO](e){const t=new jF(e,this._items,this._items.map((({threshold:e})=>e)),this.algorithm,[0,0]),n=uM(e,this.paramX,cM.FLOAT,t.setInput,t,0),i=uM(e,this.paramY,cM.FLOAT,t.setInput,t,1);return t.setInput(n,0),t.setInput(i,1),t}},BF.Algorithm=UF,BF.Item=GF,MF=Pc((OF=kF).prototype,"algorithm",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return UF.SIMPLE_DIRECTIONAL}}),zF=Pc(OF.prototype,"_items",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),LF=Pc(OF.prototype,"paramX",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lM}}),FF=Pc(OF.prototype,"paramY",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lM}}),OF));class jF extends dF{constructor(e,t,n,i,o){super(e,t,o),this._thresholds=void 0,this._algorithm=void 0,this._value=new Ii,this._thresholds=n,this._algorithm=i,this.doEval()}eval(e,[t,n]){switch(Ii.set(this._value,t,n),e.fill(0),this._algorithm){case UF.SIMPLE_DIRECTIONAL:TF(e,this._thresholds,this._value);break;case UF.FREEFORM_CARTESIAN:!function(e,t,n){PF(e,t,n,wF)}(e,this._thresholds,this._value);break;case UF.FREEFORM_DIRECTIONAL:!function(e,t,n){PF(e,t,n,IF)}(e,this._thresholds,this._value)}}}var VF,HF,WF,qF,YF,XF,QF;let ZF=Uc("cc.animation.AnimationBlendDirectItem")((WF=Pc((HF=class e extends fF{constructor(...e){super(...e),Tc(this,"weight",WF,this)}clone(){const t=new e;return this._assign(t),t}_assign(e){return super._assign(e),e.weight=this.weight,e}}).prototype,"weight",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),VF=HF))||VF;Uc("cc.animation.AnimationBlendDirect")((QF=XF=class e extends pF{constructor(...e){super(...e),Tc(this,"_items",YF,this)}get items(){return this._items}set items(e){this._items=Array.from(e)}clone(){const t=new e;return t._items=this._items.map((e=>{var t;return null!==(t=null==e?void 0:e.clone())&&void 0!==t?t:null})),t}[VO](e){return new JF(e,this._items,this._items.map((({weight:e})=>e)))}},XF.Item=ZF,YF=Pc((qF=QF).prototype,"_items",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qF));class JF extends dF{constructor(...e){super(...e),this.doEval()}eval(e,t){const n=e.length;for(let i=0;i<n;++i)e[i]=t[i]}}var KF,$F,eB,tB,nB,iB,oB,aB,rB,sB,cB,lB,_B,uB,hB,fB;!function(e){e[e.EQUAL_TO=0]="EQUAL_TO",e[e.NOT_EQUAL_TO=1]="NOT_EQUAL_TO",e[e.LESS_THAN=2]="LESS_THAN",e[e.LESS_THAN_OR_EQUAL_TO=3]="LESS_THAN_OR_EQUAL_TO",e[e.GREATER_THAN=4]="GREATER_THAN",e[e.GREATER_THAN_OR_EQUAL_TO=5]="GREATER_THAN_OR_EQUAL_TO"}(hB||(hB={})),Uc("cc.animation.BinaryCondition")((iB=nB=class e{constructor(){Tc(this,"operator",$F,this),Tc(this,"lhs",eB,this),Tc(this,"rhs",tB,this)}clone(){const t=new e;return t.operator=this.operator,t.lhs=this.lhs.clone(),t.rhs=this.rhs.clone(),t}[VO](e){const{operator:t,lhs:n,rhs:i}=this,o=new pB(t,0,0),a=hM(e,n,cM.FLOAT,o.setLhs,o),r=hM(e,i,cM.FLOAT,o.setRhs,o);return o.reset(a,r),o}},nB.Operator=hB,$F=Pc((KF=iB).prototype,"operator",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hB.EQUAL_TO}}),eB=Pc(KF.prototype,"lhs",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lM}}),tB=Pc(KF.prototype,"rhs",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lM}}),KF));class pB{constructor(e,t,n){this._operator=e,this._lhs=t,this._rhs=n,this._eval()}reset(e,t){this._lhs=e,this._rhs=t,this._eval()}setLhs(e){this._lhs=e,this._eval()}setRhs(e){this._rhs=e,this._eval()}eval(){return this._result}_eval(){const{_lhs:e,_rhs:t}=this;switch(this._operator){default:case hB.EQUAL_TO:this._result=e===t;break;case hB.NOT_EQUAL_TO:this._result=e!==t;break;case hB.LESS_THAN:this._result=e<t;break;case hB.LESS_THAN_OR_EQUAL_TO:this._result=e<=t;break;case hB.GREATER_THAN:this._result=e>t;break;case hB.GREATER_THAN_OR_EQUAL_TO:this._result=e>=t}}}!function(e){e[e.TRUTHY=0]="TRUTHY",e[e.FALSY=1]="FALSY"}(fB||(fB={})),Uc("cc.animation.UnaryCondition")((cB=sB=class e{constructor(){Tc(this,"operator",aB,this),Tc(this,"operand",rB,this)}clone(){const t=new e;return t.operator=this.operator,t.operand=this.operand.clone(),t}[VO](e){const{operator:t,operand:n}=this,i=new dB(t,!1),o=uM(e,n,cM.BOOLEAN,i.setOperand,i);return i.reset(o),i}},sB.Operator=fB,aB=Pc((oB=cB).prototype,"operator",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fB.TRUTHY}}),rB=Pc(oB.prototype,"operand",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _M}}),oB));class dB{constructor(e,t){this._operator=e,this._operand=t,this._eval()}reset(e){this.setOperand(e)}setOperand(e){this._operand=e,this._eval()}eval(){return this._result}_eval(){const{_operand:e}=this;switch(this._operator){default:case fB.TRUTHY:this._result=!!e;break;case fB.FALSY:this._result=!e}}}let mB=Uc("cc.animation.TriggerCondition")((uB=Pc((_B=class e{constructor(){Tc(this,"trigger",uB,this)}clone(){const t=new e;return t.trigger=this.trigger,t}[VO](e){const t=new AB(!1),n=e.getVar(this.trigger);return fM(n,this.trigger)&&(function(e,t,n){if(e!==t)throw new jO(n,"number")}(n.type,cM.TRIGGER,this.trigger),t.setTrigger(n.bind(t.setTrigger,t))),t}}).prototype,"trigger",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),lB=_B))||lB;class AB{constructor(e){this._triggered=!1,this._triggered=e}setTrigger(e){this._triggered=e}eval(){return this._triggered}}class vB{constructor(){this._nodeBlendStates=new Map}createWriter(e,t,n,i){const o=this.ref(e,t);return new gB(e,t,o,n,i)}destroyWriter(e){const t=e;this.deRef(t.node,t.property)}ref(e,t){let n=this._nodeBlendStates.get(e);return n||(n=new SB,this._nodeBlendStates.set(e,n)),n.refProperty(t)}deRef(e,t){const n=this._nodeBlendStates.get(e);n&&(n.deRefProperty(t),n.empty&&this._nodeBlendStates.delete(e))}apply(){this._nodeBlendStates.forEach(((e,t)=>{e.apply(t)}))}}class gB{constructor(e,t,n,i,o){this._node=e,this._property=t,this._propertyBlendState=n,this._host=i,this._constants=o}get node(){return this._node}get property(){return this._property}getValue(){return this._node[this._property]}setValue(e){const{_propertyBlendState:t,_host:n}=this,i=n.weight;t.blend(e,i)}}class xB{constructor(e){this.blendedWeight=0,this.blendedValue=void 0,this.refCount=0,this.blendedValue=e}}class yB extends xB{constructor(){super(new _i)}blend(e,t){const{blendedValue:n}=this;1===t?_i.copy(n,e):_i.scaleAndAdd(n,n,e,t),this.blendedWeight+=t}reset(){this.blendedWeight=0,_i.zero(this.blendedValue)}}class bB extends xB{constructor(){super(new Ai)}blend(e,t){if(0===t)return;const{blendedValue:n,blendedWeight:i}=this;if(1===t)Ai.copy(n,e);else{const o=t/(i+t);Ai.slerp(n,n,e,o)}this.blendedWeight+=t}reset(){this.blendedWeight=0,Ai.identity(this.blendedValue)}}class SB{constructor(){this._properties={}}get empty(){const{_properties:e}=this;return!(e.position||e.rotation||e.eulerAngles||e.scale)}refProperty(e){var t,n;const{_properties:i}=this;let o;switch(e){default:case"position":case"scale":case"eulerAngles":o=null!==(t=i[e])&&void 0!==t?t:i[e]=new yB;break;case"rotation":o=null!==(n=i[e])&&void 0!==n?n:i[e]=new bB}return++o.refCount,o}deRefProperty(e){const{_properties:t}=this,n=t[e];n&&(--n.refCount,n.refCount>0||delete t[e])}apply(e){const{_properties:{position:t,scale:n,rotation:i,eulerAngles:o}}=this;let a,r,s,c=!1,l=!1,_=!1,u=!1;t&&t.blendedWeight&&(c=!0,t.blendedWeight<1&&t.blend(e.position,1-t.blendedWeight),a=t.blendedValue),n&&n.blendedWeight&&(l=!0,n.blendedWeight<1&&n.blend(e.scale,1-n.blendedWeight),r=n.blendedValue),o&&o.blendedWeight&&(u=!0,o.blendedWeight<1&&o.blend(e.eulerAngles,1-o.blendedWeight),s=o.blendedValue),i&&i.blendedWeight&&(_=!0,i.blendedWeight<1&&i.blend(e.rotation,1-i.blendedWeight),s=i.blendedValue),(s||a||r)&&e.setRTS(s,a,r),c&&t.reset(),l&&n.reset(),_&&i.reset(),u&&o.reset()}}var CB;let EB=e("bq",Uc("cc.animation.StateMachineComponent")(CB=class{onMotionStateEnter(e,t){}onMotionStateExit(e,t){}onMotionStateUpdate(e,t){}onStateMachineEnter(e){}onStateMachineExit(e){}})||CB);class TB{constructor(e,t,n){this._blendBuffer=new vB,this._currentTransitionCache={duration:0,time:0},this._varInstances={};for(const[t,{type:n,value:i}]of e.variables)this._varInstances[t]=new _k(n,i);const i={controller:n,blendBuffer:this._blendBuffer,node:t,getVar:e=>this._varInstances[e],triggerResetFn:e=>{this.setValue(e,!1)}};this._layerEvaluations=Array.from(e.layers).map((e=>{var t;return new PB(e,{...i,mask:null!==(t=e.mask)&&void 0!==t?t:void 0})}))}update(e){for(const t of this._layerEvaluations)t.update(e);this._blendBuffer.apply()}getVariables(){return Object.entries(this._varInstances)}getCurrentStateStatus(e){return this._layerEvaluations[e].getCurrentStateStatus()}getCurrentClipStatuses(e){return this._layerEvaluations[e].getCurrentClipStatuses()}getCurrentTransition(e){const{_layerEvaluations:t,_currentTransitionCache:n}=this;return t[e].getCurrentTransition(n)?n:null}getNextStateStatus(e){return this._layerEvaluations[e].getNextStateStatus()}getNextClipStatuses(e){return this.getCurrentTransition(e),this._layerEvaluations[e].getNextClipStatuses()}getValue(e){const t=this._varInstances[e];return t?t.value:void 0}setValue(e,t){const n=this._varInstances[e];n&&(n.value=t)}}class PB{constructor(e,t){this._weight=void 0,this._nodes=[],this._topLevelEntry=void 0,this._topLevelExit=void 0,this._currentNode=void 0,this._currentTransitionToNode=null,this._currentTransitionPath=[],this._transitionProgress=0,this._fromWeight=0,this._toWeight=0,this._fromUpdated=!1,this._toUpdated=!1,this.name=e.name,this._controller=t.controller,this._weight=e.weight;const{entry:n,exit:i}=this._addStateMachine(e.stateMachine,null,{...t},e.name);this._topLevelEntry=n,this._topLevelExit=i,this._currentNode=n,this._resetTrigger=t.triggerResetFn}get exited(){return this._currentNode===this._topLevelExit}update(e){this.exited||(this._fromWeight=1,this._toWeight=0,this._eval(e),this._sample())}getCurrentStateStatus(){const{_currentNode:e}=this;return e.kind===MB.animation?e.getFromPortStatus():null}getCurrentClipStatuses(){const{_currentNode:e}=this;return e.kind===MB.animation?e.getClipStatuses(this._fromWeight):IB}getCurrentTransition(e){const{_currentTransitionPath:t}=this;if(0!==t.length){if(t[t.length-1].to.kind!==MB.animation)return!1;const{duration:n,normalizedDuration:i}=t[0],o=e.duration=i?n*(this._currentNode.kind===MB.animation?this._currentNode.duration:0):n;return e.time=this._transitionProgress*o,!0}return!1}getNextStateStatus(){return this._currentTransitionToNode,this._currentTransitionToNode.getToPortStatus()}getNextClipStatuses(){var e;const{_currentTransitionPath:t}=this,n=t[t.length-1].to;return n.kind,MB.animation,null!==(e=n.getClipStatuses(this._toWeight))&&void 0!==e?e:IB}_addStateMachine(e,t,n,i){const o=Array.from(e.states());let a,r,s;const c=o.map((t=>t instanceof vM?new rk(t,n):t===e.entryState?a=new lk(t,MB.entry,t.name):t===e.exitState?s=new lk(t,MB.exit,t.name):t===e.anyState?r=new lk(t,MB.any,t.name):null)),l={components:null,parent:t,entry:a,exit:s,any:r};for(let e=0;e<o.length;++e){const t=c[e];t&&(t.stateMachine=l)}const _=o.map((e=>{if(e instanceof sz){const t=this._addStateMachine(e.stateMachine,l,n,`${i}/${e.name}`);return t.components=new ak(e),t}return null}));for(let t=0;t<o.length;++t){const i=o[t],a=e.getOutgoings(i),r=[];let s;s=i instanceof sz?_[t].exit:c[t];for(const e of a){const t=e.to,i=o.findIndex((t=>t===e.to));let a;a=t instanceof sz?_[i].entry:c[i];const s={to:a,conditions:e.conditions.map((e=>e[VO](n))),duration:oz(e)?e.duration:0,normalizedDuration:!!oz(e)&&e.relativeDuration,exitConditionEnabled:!!oz(e)&&e.exitConditionEnabled,exitCondition:oz(e)?e.exitCondition:0,triggers:void 0};s.conditions.forEach(((t,n)=>{const i=e.conditions[n];var o;i instanceof mB&&i.trigger&&(null!==(o=s.triggers)&&void 0!==o?o:s.triggers=[]).push(i.trigger)})),r.push(s)}s.outgoingTransitions=r}return l}_eval(e){if(this.exited,eF(`[Layer ${this.name}]: UpdateStart ${e}s`),this._continueDanglingTransition())return 0;let t=e;for(let e=!0,n=0;e||t>0;){if(e=!1,100===n){w(14e3,100);break}if(++n,this._currentTransitionPath.length>0){if(t-=this._updateCurrentTransition(t),this._currentNode.kind===MB.exit)break;0===this._currentTransitionPath.length&&(e=!0);continue}const{_currentNode:i}=this,o=this._matchCurrentNodeTransition(t);if(o){const{transition:n,requires:a}=o;if($L(`[SubStateMachine ${this.name}]: CurrentNodeUpdate: ${i.name}`),t-=a,i.kind===MB.animation&&(i.updateFromPort(a),this._fromUpdated=!0),this._switchTo(n))break;e=!0}else $L(`[SubStateMachine ${this.name}]: CurrentNodeUpdate: ${i.name}`),i.kind===MB.animation&&(i.updateFromPort(t),this._fromUpdated=!0,t=0)}return $L(`[SubStateMachine ${this.name}]: UpdateEnd`),this._fromUpdated&&this._currentNode.kind===MB.animation&&(this._fromUpdated=!1,this._currentNode.triggerFromPortUpdate(this._controller)),this._currentTransitionToNode&&this._toUpdated&&this._currentNode.kind===MB.animation&&(this._toUpdated=!1,this._currentTransitionToNode.triggerToPortUpdate(this._controller)),t}_sample(){const{_currentNode:e,_currentTransitionToNode:t,_fromWeight:n}=this;e.kind===MB.animation&&e.sampleFromPort(n),t&&t.kind===MB.animation&&t.sampleToPort(this._toWeight)}_matchCurrentNodeTransition(e){const t=this._currentNode;let n=1/0,i=null;const o=this._matchTransition(t,t,e,NB);if(o&&({requires:n,transition:i}=o),t.kind===MB.animation)for(let o=t.stateMachine;null!==o;o=o.parent){const a=this._matchTransition(o.any,t,e,OB);a&&a.requires<n&&({requires:n,transition:i}=a)}return i?DB.set(i,n):null}_matchTransition(e,t,n,i){e===t||(e.kind,MB.any);const{outgoingTransitions:o}=e,a=o.length;let r=1/0,s=null;for(let c=0;c<a;++c){const a=o[c],{conditions:l}=a,_=l.length;if(0===_){if(e.kind===MB.entry||e.kind===MB.exit)return i.set(a,0);if(!a.exitConditionEnabled)continue}let u=0;if(t.kind===MB.animation&&a.exitConditionEnabled){const e=t.duration*a.exitCondition;if(u=Math.max(e-t.fromPortTime,0),u>n)continue}let h=!0;for(let e=0;e<_;++e)if(!l[e].eval()){h=!1;break}if(h){if(0===u)return i.set(a,0);u<r&&(r=u,s=a)}}return s?i.set(s,r):null}_switchTo(e){const{_currentNode:t}=this;eF(`[SubStateMachine ${this.name}]: STARTED ${t.name} -> ${e.to.name}.`);const{_currentTransitionPath:n}=this;this._consumeTransition(e),n.push(e);const i=this._matchTransitionPathUntilMotion();return!i||(this._doTransitionToMotion(i),!1)}_continueDanglingTransition(){const{_currentTransitionPath:e}=this,t=e.length;if(0===t)return!1;if(e[t-1].to.kind!==MB.animation){const e=this._matchTransitionPathUntilMotion();return!e||(this._doTransitionToMotion(e),!1)}return!1}_matchTransitionPathUntilMotion(){const{_currentTransitionPath:e}=this;let t=e[e.length-1].to;for(;t.kind!==MB.animation;){const n=this._matchTransition(t,t,0,DB);if(!n)break;const i=n.transition;this._consumeTransition(i),e.push(i),t=i.to}return t.kind===MB.animation?t:null}_consumeTransition(e){const{to:t}=e;t.kind===MB.entry&&this._callEnterMethods(t)}_resetTriggersAlongThePath(){const{_currentTransitionPath:e}=this,t=e.length;for(let n=0;n<t;++n){const t=e[n];this._resetTriggersOnTransition(t)}}_doTransitionToMotion(e){this._resetTriggersAlongThePath(),this._transitionProgress=0,this._currentTransitionToNode=e,this._toUpdated=!1,e.resetToPort(),this._callEnterMethods(e)}_updateCurrentTransition(e){var t;const{_currentTransitionPath:n,_currentTransitionToNode:i}=this;n.length;const o=n[0],{duration:a,normalizedDuration:r}=o,s=this._currentNode,c=i;let l=0,_=0;if(a<=0)l=0,_=1;else{s.kind,MB.animation;const{_transitionProgress:t}=this,n=r?a*s.duration:a,i=t*n,o=n-i;l=Math.min(o,e),_=this._transitionProgress=(i+l)/n}const u=null!==(t=null==c?void 0:c.name)&&void 0!==t?t:"<Empty>",h=this._weight;eF(`[SubStateMachine ${this.name}]: TransitionUpdate: ${s.name} -> ${u}with ratio ${_} in base weight ${this._weight}.`),this._fromWeight=h*(1-_),this._toWeight=h*_;const f=0!==l,p=1===_;if(s.kind===MB.animation&&f&&(eF(`Update ${s.name}`),s.updateFromPort(l),this._fromUpdated=!0),c&&f&&(eF(`Update ${c.name}`),c.updateToPort(l),this._toUpdated=!0),p){$L(`[SubStateMachine ${this.name}]: Transition finished:  ${s.name} -> ${u}.`),this._callExitMethods(s);const{_currentTransitionPath:e}=this,t=e.length;for(let n=0;n<t;++n){const{to:t}=e[n];t.kind===MB.exit&&this._callExitMethods(t)}this._fromUpdated=this._toUpdated,this._toUpdated=!1,c.finishTransition(),this._currentNode=c,this._currentTransitionToNode=null,this._currentTransitionPath.length=0,this._fromWeight=1,this._toWeight=0}return l}_resetTriggersOnTransition(e){const{triggers:t}=e;if(t){const e=t.length;for(let n=0;n<e;++n){const e=t[n];this._resetTrigger(e)}}}_resetTrigger(e){const{_triggerReset:t}=this;t(e)}_callEnterMethods(e){var t;const{_controller:n}=this;switch(e.kind){default:break;case MB.animation:e.components.callMotionStateEnterMethods(n,e.getToPortStatus());break;case MB.entry:null===(t=e.stateMachine.components)||void 0===t||t.callStateMachineEnterMethods(n)}}_callExitMethods(e){var t;const{_controller:n}=this;switch(e.kind){default:break;case MB.animation:e.components.callMotionStateExitMethods(n,e.getFromPortStatus());break;case MB.exit:null===(t=e.stateMachine.components)||void 0===t||t.callStateMachineExitMethods(n)}}}const wB=Object.freeze({next:()=>({done:!0,value:void 0})}),IB=Object.freeze({[Symbol.iterator]:()=>wB});class RB{constructor(){this.transition=null,this.requires=0}set(e,t){return this.transition=e,this.requires=t,this}}const DB=new RB,NB=new RB,OB=new RB;var MB,zB,LB,FB,BB,kB,UB,GB,jB,VB,HB,WB,qB,YB,XB,QB,ZB,JB,KB,$B,ek,tk,nk,ik;!function(e){e[e.entry=0]="entry",e[e.exit=1]="exit",e[e.any=2]="any",e[e.animation=3]="animation"}(MB||(MB={}));class ok{constructor(e){this.name=void 0,this.outgoingTransitions=[],this.name=e.name}}class ak{constructor(e){this._components=e.instantiateComponents()}callMotionStateEnterMethods(e,t){this._callMotionStateCallbackIfNonDefault("onMotionStateEnter",e,t)}callMotionStateUpdateMethods(e,t){this._callMotionStateCallbackIfNonDefault("onMotionStateUpdate",e,t)}callMotionStateExitMethods(e,t){this._callMotionStateCallbackIfNonDefault("onMotionStateExit",e,t)}callStateMachineEnterMethods(e){this._callStateMachineCallbackIfNonDefault("onStateMachineEnter",e)}callStateMachineExitMethods(e){this._callStateMachineCallbackIfNonDefault("onStateMachineExit",e)}_callMotionStateCallbackIfNonDefault(e,t,n){const{_components:i}=this,o=i.length;for(let a=0;a<o;++a){const o=i[a];o[e]!==EB.prototype[e]&&o[e](t,n)}}_callStateMachineCallbackIfNonDefault(e,t){const{_components:n}=this,i=n.length;for(let o=0;o<i;++o){const i=n[o];i[e]!==EB.prototype[e]&&i[e](t)}}}class rk extends ok{constructor(e,t){var n,i;super(e),this.kind=MB.animation,this._source=null,this._speed=1,this._fromPort={progress:0,statusCache:{progress:0}},this._toPort={progress:0,statusCache:{progress:0}};const o=uM(t,e.speed,cM.FLOAT,this._setSpeed,this);this._speed=o;const a={...t},r=null!==(n=null===(i=e.motion)||void 0===i?void 0:i[VO](a))&&void 0!==n?n:null;r&&Object.defineProperty(r,"__DEBUG_ID__",{value:this.name}),this._source=r,this.components=new ak(e)}get duration(){var e,t;return null!==(e=null===(t=this._source)||void 0===t?void 0:t.duration)&&void 0!==e?e:0}get fromPortTime(){return this._fromPort.progress*this.duration}updateFromPort(e){this._fromPort.progress=sk(this._fromPort.progress,this.duration,e*this._speed)}updateToPort(e){this._toPort.progress=sk(this._toPort.progress,this.duration,e*this._speed)}triggerFromPortUpdate(e){this.components.callMotionStateUpdateMethods(e,this.getFromPortStatus())}triggerToPortUpdate(e){this.components.callMotionStateUpdateMethods(e,this.getToPortStatus())}getFromPortStatus(){const{statusCache:e}=this._fromPort;return e.progress=ck(this._fromPort.progress),e}getToPortStatus(){const{statusCache:e}=this._toPort;return e.progress=ck(this._toPort.progress),e}resetToPort(){this._toPort.progress=0}finishTransition(){this._fromPort.progress=this._toPort.progress}sampleFromPort(e){var t;null===(t=this._source)||void 0===t||t.sample(this._fromPort.progress,e)}sampleToPort(e){var t;null===(t=this._source)||void 0===t||t.sample(this._toPort.progress,e)}getClipStatuses(e){const{_source:t}=this;return t?{[Symbol.iterator]:()=>t.getClipStatuses(e)}:IB}_setSpeed(e){this._speed=e}}function sk(e,t,n){return 0===t?0:e+n/t}function ck(e){return e-Math.trunc(e)}class lk extends ok{constructor(e,t,n){super(e),this.kind=void 0,this.kind=t}}class _k{constructor(e,t){this.type=void 0,this._value=void 0,this._refs=[],this.type=e,this._value=t}get value(){return this._value}set value(e){this._value=e;for(const{fn:t,thisArg:n,args:i}of this._refs)t.call(n,e,...i)}bind(e,t,...n){return this._refs.push({fn:e,thisArg:t,args:n}),this._value}}e("bo",(zB=Uc("cc.animation.AnimationController"),LB=Kc(),FB=Hc(_z),zB(BB=LB((UB=Pc((kB=class extends R_{constructor(...e){super(...e),Tc(this,"graph",UB,this),this._graphEval=null}start(){this.graph&&(this._graphEval=new TB(this.graph,this.node,this))}update(e){var t;null===(t=this._graphEval)||void 0===t||t.update(e)}getVariables(){const{_graphEval:e}=this;return e.getVariables()}setValue(e,t){const{_graphEval:n}=this;n.setValue(e,t)}getValue(e){const{_graphEval:t}=this;return t.getValue(e)}getCurrentStateStatus(e){const{_graphEval:t}=this;return t.getCurrentStateStatus(e)}getCurrentClipStatuses(e){const{_graphEval:t}=this;return t.getCurrentClipStatuses(e)}getCurrentTransition(e){const{_graphEval:t}=this;return t.getCurrentTransition(e)}getNextStateStatus(e){const{_graphEval:t}=this;return t.getNextStateStatus(e)}getNextClipStatuses(e){const{_graphEval:t}=this;return t.getNextClipStatuses(e)}}).prototype,"graph",[FB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BB=kB))||BB)||BB));class uk extends QL{constructor(e){super(),this._managedStates=[],this._fadings=[],this._scheduled=!1,this._scheduler=null!=e?e:c.director.getAnimationManager()}update(e){if(this.isMotionless)return;const t=this._managedStates,n=this._fadings;if(1===t.length&&1===n.length){const e=t[0].state;e&&(e.weight=1)}else this._calculateWeights(e);1===t.length&&1===n.length&&this._unscheduleThis()}crossFade(e,t){var n;0===this._managedStates.length&&(t=0),0===t&&this.clear();let i=this._managedStates.find((t=>t.state===e));i?(null===(n=i.state)||void 0===n?void 0:n.isMotionless)&&i.state.play():(i={state:e,reference:0},e&&e.play(),this._managedStates.push(i)),++i.reference,this._fadings.unshift({easeDuration:t,easeTime:0,target:i}),this.isMotionless||this._scheduleThis()}clear(){for(let e=0;e<this._managedStates.length;++e){const t=this._managedStates[e].state;t&&t.stop()}this._managedStates.length=0,this._fadings.length=0}onPlay(){super.onPlay(),this._scheduleThis()}onPause(){super.onPause();for(let e=0;e<this._managedStates.length;++e){const t=this._managedStates[e].state;t&&t.pause()}this._unscheduleThis()}onResume(){super.onResume();for(let e=0;e<this._managedStates.length;++e){const t=this._managedStates[e].state;t&&t.resume()}this._scheduleThis()}onStop(){super.onStop(),this.clear()}_calculateWeights(e){const t=this._managedStates,n=this._fadings;for(let e=0;e<t.length;++e){const n=t[e].state;n&&(n.weight=0)}let i=1,o=n.length;for(let t=0;t<n.length;++t){const a=n[t];a.easeTime+=e;const r=0===a.easeDuration?1:jn(a.easeTime/a.easeDuration),s=r*i;if(i*=1-r,a.target.state&&(a.target.state.weight+=s),a.easeTime>=a.easeDuration){o=t+1,a.easeTime=a.easeDuration;break}}if(o!==n.length){for(let e=o;e<n.length;++e){const t=n[e];--t.target.reference,t.target.reference<=0&&(t.target.state&&t.target.state.stop(),G(this._managedStates,t.target))}n.splice(o)}}_scheduleThis(){this._scheduled||(this._scheduler.addCrossFade(this),this._scheduled=!0)}_unscheduleThis(){this._scheduled&&(this._scheduler.removeCrossFade(this),this._scheduled=!1)}}let hk=e("cN",(GB=Uc("cc.Animation"),jB=nl(),VB=jc(99),HB=Kc(),WB=vl([BL]),qB=sl(),YB=vl(BL),XB=sl(),QB=sl(),ZB=vl([BL]),GB(JB=jB(JB=VB(JB=Jc(JB=HB((ik=nk=class extends(qt(R_)){constructor(...e){super(...e),Tc(this,"playOnLoad",$B,this),this._crossFade=new uk,this._nameToState=ne(!0),Tc(this,"_clips",ek,this),Tc(this,"_defaultClip",tk,this),this._hasBeenPlayed=!1}get clips(){return this._clips}set clips(e){this._crossFade&&this._crossFade.clear();for(const e of this._clips)e&&this._removeStateOfAutomaticClip(e);for(const t of e)t&&this.createState(t);const t=e.find((e=>fk(e,this._defaultClip)));this._defaultClip=t||null,this._clips=e}get defaultClip(){return this._defaultClip}set defaultClip(e){this._defaultClip=e,e&&(this._clips.findIndex((t=>fk(t,e)))>=0||(this._clips.push(e),this.createState(e)))}onLoad(){this.clips=this._clips;for(const e in this._nameToState)this._nameToState[e].initialize(this.node)}start(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)}onEnable(){this._crossFade.resume()}onDisable(){this._crossFade.pause()}onDestroy(){this._crossFade.stop();for(const e in this._nameToState)this._nameToState[e].destroy();this._nameToState=ne(!0)}play(e){if(this._hasBeenPlayed=!0,!e){if(!this._defaultClip)return;e=this._defaultClip.name}this.crossFade(e,0)}crossFade(e,t=.3){this._hasBeenPlayed=!0;const n=this._nameToState[e];n&&this.doPlayOrCrossFade(n,t)}pause(){this._crossFade.pause()}resume(){this._crossFade.resume()}stop(){this._crossFade.stop()}getAnimationState(e){return this.getState(e)}getState(e){const t=this._nameToState[e];return t&&!t.curveLoaded&&t.initialize(this.node),t||null}createState(e,t){return t=t||e.name,this.removeState(t),this._doCreateState(e,t)}removeState(e){const t=this._nameToState[e];t&&(t.allowLastFrameEvent(!1),t.stop(),delete this._nameToState[e])}addClip(e,t){return V(this._clips,e)||this._clips.push(e),this.createState(e,t)}removeClip(e,t){let n;for(const t in this._nameToState){const i=this._nameToState[t];if(i.clip===e){n=i;break}}if(e===this._defaultClip){if(!t)return void w(3902);this._defaultClip=null}if(n&&n.isPlaying){if(!t)return void w(3903);n.stop()}this._clips=this._clips.filter((t=>t!==e)),n&&delete this._nameToState[n.name]}on(e,t,n,i){const o=super.on(e,t,n,i);return e===JL.LASTFRAME&&this._syncAllowLastFrameEvent(),o}once(e,t,n){const i=super.once(e,t,n);return e===JL.LASTFRAME&&this._syncAllowLastFrameEvent(),i}off(e,t,n){super.off(e,t,n),e===JL.LASTFRAME&&this._syncDisallowLastFrameEvent()}_createState(e,t){return new KL(e,t)}_doCreateState(e,t){const n=this._createState(e,t);return n._setEventTarget(this),n.allowLastFrameEvent(this.hasEventListener(JL.LASTFRAME)),this.node&&n.initialize(this.node),this._nameToState[n.name]=n,n}doPlayOrCrossFade(e,t){this._crossFade.play(),this._crossFade.crossFade(e,t)}_removeStateOfAutomaticClip(e){for(const t in this._nameToState){const n=this._nameToState[t];fk(e,n.clip)&&(n.stop(),delete this._nameToState[t])}}_syncAllowLastFrameEvent(){if(this.hasEventListener(JL.LASTFRAME))for(const e in this._nameToState)this._nameToState[e].allowLastFrameEvent(!0)}_syncDisallowLastFrameEvent(){if(!this.hasEventListener(JL.LASTFRAME))for(const e in this._nameToState)this._nameToState[e].allowLastFrameEvent(!1)}},nk.EventType=JL,Pc((KB=ik).prototype,"clips",[WB,qB],Object.getOwnPropertyDescriptor(KB.prototype,"clips"),KB.prototype),Pc(KB.prototype,"defaultClip",[YB,XB],Object.getOwnPropertyDescriptor(KB.prototype,"defaultClip"),KB.prototype),$B=Pc(KB.prototype,"playOnLoad",[qc,QB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ek=Pc(KB.prototype,"_clips",[ZB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tk=Pc(KB.prototype,"_defaultClip",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JB=KB))||JB)||JB)||JB)||JB)||JB));function fk(e,t){return e===t||!!e&&!!t&&e._uuid===t._uuid&&e._uuid}c.Animation=hk,Pn(hk.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction(...e){const t=e[0];return hk.prototype.removeState.call(this,t.name)}}]),c.AnimationComponent=hk,Ne.setClassAlias(hk,"cc.AnimationComponent");const pk=[],dk=new Map;function mk(e,t){let n=0,i=Ei.IDENTITY;for(;e;){if(e.stamp===t||e.stamp+1===t&&!e.node.hasChangedFlags){i=e.world,e.stamp=t;break}e.stamp=t,pk[n++]=e,e=e.parent}for(;n>0;){e=pk[--n],pk[n]=null;const t=e.node;Ei.fromRTS(e.local,t.rotation,t.position,t.scale),i=Ei.multiply(e.world,i,e.local)}return i}function Ak(e,t){let n,i=null,o=0;for(;e!==t;){const t=e.uuid;if(dk.has(t)){i=dk.get(t);break}i={node:e,local:new Ei,world:new Ei,stamp:-1,parent:null},dk.set(t,i),pk[o++]=i,e=e.parent,i=null}for(;o>0;)n=pk[--o],pk[o]=null,n.parent=i,i=n;return i}function vk(e){let t=dk.get(e.uuid)||null;for(;t;)dk.delete(t.node.uuid),t=t.parent}var gk,xk,yk;let bk=e("gB",Uc((yk=xk=class extends Rw{constructor(...e){super(...e),this._anims=new B([]),this._crossFades=new B([]),this._delayEvents=[],this._blendStateBuffer=new vB,this._sockets=[]}get blendState(){return this._blendStateBuffer}addCrossFade(e){-1===this._crossFades.array.indexOf(e)&&this._crossFades.push(e)}removeCrossFade(e){const t=this._crossFades.array.indexOf(e);t>=0?this._crossFades.fastRemoveAt(t):R(3907)}update(e){const{_delayEvents:t,_crossFades:n,_sockets:i}=this;{const t=n.array;for(n.i=0;n.i<t.length;++n.i)t[n.i].update(e)}const o=this._anims,a=o.array;for(o.i=0;o.i<a.length;++o.i){const t=a[o.i];t.isMotionless||t.update(e)}this._blendStateBuffer.apply();const r=c.director.getTotalFrames();for(let e=0,t=i.length;e<t;e++){const{target:t,transform:n}=i[e];t.matrix=mk(n,r)}for(let e=0,n=t.length;e<n;e++){const n=t[e];n.fn.apply(n.thisArg,n.args)}t.length=0}destruct(){}addAnimation(e){-1===this._anims.array.indexOf(e)&&this._anims.push(e)}removeAnimation(e){const t=this._anims.array.indexOf(e);t>=0?this._anims.fastRemoveAt(t):R(3907)}pushDelayEvent(e,t,n){this._delayEvents.push({fn:e,thisArg:t,args:n})}addSockets(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(this._sockets.find((e=>e.target===i.target)))continue;const o=e.getChildByPath(i.path),a=i.target&&o&&Ak(o,e);a&&this._sockets.push({target:i.target,transform:a})}}removeSockets(e,t){for(let e=0;e<t.length;++e){const n=t[e];for(let e=0;e<this._sockets.length;++e){const t=this._sockets[e];if(t.target===n.target){vk(t.transform.node),this._sockets[e]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}}}},xk.ID="animation",gk=yk))||gk);Vw.on(jw.EVENT_INIT,(()=>{const e=new bk;Vw.registerSystem(bk.ID,e,Rw.Priority.HIGH)})),c.AnimationManager=bk;const Sk=new Ei;var Ck,Ek,Tk,Pk;c.easing=wh;let wk=e("gm",Uc("cc.HierachyModifier")(Ck=class extends _N{})||Ck);c.HierachyModifier=wk;let Ik=e("gn",Uc("cc.ComponentModifier")(Ek=class extends uN{})||Ek);c.ComponentModifier=Ik;let Rk=e("go",Uc("cc.CurveValueAdapter")(Tk=class{forTarget(e){return{set:()=>{}}}})||Tk);c.CurveValueAdapter=Rk;let Dk=e("gp",Uc("cc.UniformCurveValueAdapter")(Pk=class extends AN{})||Pk);function Nk(e){return"string"==typeof e}function Ok(e){return"number"==typeof e}function Mk(e,t){return e instanceof t}c.UniformCurveValueAdapter=Dk,c.isPropertyModifier=Nk,c.isElementModifier=Ok,c.isCustomTargetModifier=Mk,c.math=Ui,c.geometry=Qf;class zk{constructor(e){this.poolHandlerComp=void 0,this._pool=void 0,this.poolHandlerComp=e,this._pool=[]}size(){return this._pool.length}clear(){const e=this._pool.length;for(let t=0;t<e;++t)this._pool[t].destroy();this._pool.length=0}put(e){if(e&&-1===this._pool.indexOf(e)){e.removeFromParent();const t=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;t&&t.unuse&&t.unuse(),this._pool.push(e)}}get(...e){const t=this._pool.length-1;if(t<0)return null;{const e=this._pool[t];this._pool.length=t;const n=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;return n&&n.reuse&&n.reuse(arguments),e}}}e("gJ",zk),c.NodePool=zk,c.renderer=av;class Lk{constructor(){this._arrayBufferOrPaddings=[],this._length=0}setNextAlignment(e){if(0!==e){const t=this._length%e;if(0!==t){const n=e-t;this._arrayBufferOrPaddings.push(n),this._length+=n}}}addBuffer(e){const t=this._length;return this._arrayBufferOrPaddings.push(e),this._length+=e.byteLength,t}getLength(){return this._length}getCombined(){const e=new Uint8Array(this._length);let t=0;return this._arrayBufferOrPaddings.forEach((n=>{"number"==typeof n?t+=n:(e.set(new Uint8Array(n),t),t+=n.byteLength)})),e.buffer}}e("bI",Lk);class Fk{constructor(e,t){if(this._mesh=void 0,this._subMeshRenderings=[],this._mesh=e,!this._mesh.struct.morph)return;const n=this._mesh.struct.primitives.length;this._subMeshRenderings=new Array(n).fill(null);for(let e=0;e<n;++e){const n=this._mesh.struct.morph.subMeshMorphs[e];n&&(n.targets.length>Np.MAX_MORPH_TARGET_COUNT?this._subMeshRenderings[e]=new kk(this._mesh,e,this._mesh.struct.morph,t):this._subMeshRenderings[e]=new Bk(this._mesh,e,this._mesh.struct.morph,t))}}createInstance(){const e=this._mesh.struct.primitives.length,t=new Array(e);for(let o=0;o<e;++o){var n,i;t[o]=null!==(n=null===(i=this._subMeshRenderings[o])||void 0===i?void 0:i.createInstance())&&void 0!==n?n:null}return{setWeights(e,n){var i;null===(i=t[e])||void 0===i||i.setWeights(n)},requiredPatches:e=>{this._mesh.struct.morph;const n=this._mesh.struct.morph.subMeshMorphs[e],i=t[e];if(null===i)return null;const o=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:n.targets.length}];return n.attributes.includes(Sa.ATTR_POSITION)&&o.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),n.attributes.includes(Sa.ATTR_NORMAL)&&o.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),n.attributes.includes(Sa.ATTR_TANGENT)&&o.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),o.push(...i.requiredPatches()),o},adaptPipelineState:(e,n)=>{var i;null===(i=t[e])||void 0===i||i.adaptPipelineState(n)},destroy:()=>{for(const e of t)null==e||e.destroy()}}}}class Bk{constructor(e,t,n,i){this._gfxDevice=void 0,this._subMeshMorph=void 0,this._textureInfo=void 0,this._attributes=void 0,this._verticesCount=void 0,this._gfxDevice=i;const o=n.subMeshMorphs[t];this._subMeshMorph=o,Vk(e,t,i);const a=e.struct.vertexBundles[e.struct.primitives[t].vertexBundelIndices[0]].view.count;this._verticesCount=a;const r=o.targets.length,s=jk(i,a*r);this._textureInfo={width:s.width,height:s.height},this._attributes=o.attributes.map(((t,n)=>{const i=s.create(),r=i.valueView;return o.targets.forEach(((t,i)=>{const o=t.displacements[n],s=new Float32Array(e.data.buffer,e.data.byteOffset+o.offset,o.count),c=a*i*4;for(let e=0;e<a;++e)r[c+4*e+0]=s[3*e+0],r[c+4*e+1]=s[3*e+1],r[c+4*e+2]=s[3*e+2]})),i.updatePixels(),{name:t,morphTexture:i}}))}destroy(){for(const e of this._attributes)e.morphTexture.destroy()}createInstance(){const e=new Gk(this._gfxDevice,this._subMeshMorph.targets.length);return e.setMorphTextureInfo(this._textureInfo.width,this._textureInfo.height),e.setVerticesCount(this._verticesCount),e.commit(),{setWeights:t=>{e.setWeights(t),e.commit()},requiredPatches:()=>[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}],adaptPipelineState:t=>{for(const e of this._attributes){let n;switch(e.name){case Sa.ATTR_POSITION:n=Fp;break;case Sa.ATTR_NORMAL:n=Up;break;case Sa.ATTR_TANGENT:n=Vp;break;default:v("Unexpected attribute!")}void 0!==n&&(t.bindSampler(n,e.morphTexture.sampler),t.bindTexture(n,e.morphTexture.texture))}t.bindBuffer(Np.BINDING,e.buffer),t.update()},destroy:()=>{}}}}class kk{constructor(e,t,n,i){this._gfxDevice=void 0,this._attributes=[],this._gfxDevice=i;const o=n.subMeshMorphs[t];Vk(e,t,i),this._attributes=o.attributes.map(((t,n)=>({name:t,targets:o.targets.map((t=>({displacements:new Float32Array(e.data.buffer,e.data.byteOffset+t.displacements[n].offset,t.displacements[n].count)})))})))}get data(){return this._attributes}createInstance(){return new Uk(this,this._attributes[0].targets[0].displacements.length/3,this._gfxDevice)}}class Uk{constructor(e,t,n){this._attributes=void 0,this._owner=void 0,this._morphUniforms=void 0,this._owner=e,this._morphUniforms=new Gk(n,0);const i=jk(n,t);this._morphUniforms.setMorphTextureInfo(i.width,i.height),this._morphUniforms.commit(),this._attributes=this._owner.data.map((e=>{const t=i.create();return{attributeName:e.name,morphTexture:t}}))}setWeights(e){for(let t=0;t<this._attributes.length;++t){const n=this._attributes[t],i=n.morphTexture.valueView,o=this._owner.data[t];e.length,o.targets.length;for(let t=0;t<o.targets.length;++t){const n=o.targets[t].displacements,a=e[t],r=n.length/3;if(0===t)for(let e=0;e<r;++e)i[4*e+0]=n[3*e+0]*a,i[4*e+1]=n[3*e+1]*a,i[4*e+2]=n[3*e+2]*a;else if(0!==a)for(let e=0;e<r;++e)i[4*e+0]+=n[3*e+0]*a,i[4*e+1]+=n[3*e+1]*a,i[4*e+2]+=n[3*e+2]*a}n.morphTexture.updatePixels()}}requiredPatches(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]}adaptPipelineState(e){for(const t of this._attributes){let n;switch(t.attributeName){case Sa.ATTR_POSITION:n=Fp;break;case Sa.ATTR_NORMAL:n=Up;break;case Sa.ATTR_TANGENT:n=Vp;break;default:v("Unexpected attribute!")}void 0!==n&&(e.bindSampler(n,t.morphTexture.sampler),e.bindTexture(n,t.morphTexture.texture))}e.bindBuffer(Np.BINDING,this._morphUniforms.buffer),e.update()}destroy(){this._morphUniforms.destroy();for(let e=0;e<this._attributes.length;++e)this._attributes[e].morphTexture.destroy()}}class Gk{constructor(e,t){this._targetCount=void 0,this._localBuffer=void 0,this._remoteBuffer=void 0,this._targetCount=t,this._localBuffer=new DataView(new ArrayBuffer(Np.SIZE)),this._remoteBuffer=e.createBuffer(new ka(Ho.UNIFORM|Ho.TRANSFER_DST,Yo.HOST|Yo.DEVICE,Np.SIZE,Np.SIZE))}destroy(){this._remoteBuffer.destroy()}get buffer(){return this._remoteBuffer}setWeights(e){e.length,this._targetCount;for(let t=0;t<e.length;++t)this._localBuffer.setFloat32(Np.OFFSET_OF_WEIGHTS+4*t,e[t],c.sys.isLittleEndian)}setMorphTextureInfo(e,t){this._localBuffer.setFloat32(Np.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH,e,c.sys.isLittleEndian),this._localBuffer.setFloat32(Np.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT,t,c.sys.isLittleEndian)}setVerticesCount(e){this._localBuffer.setFloat32(Np.OFFSET_OF_VERTICES_COUNT,e,c.sys.isLittleEndian)}commit(){this._remoteBuffer.update(this._localBuffer.buffer)}}function jk(e,t){let n,i,o,a;e.hasFeature(Uo.TEXTURE_FLOAT)?(n=t,o=16,i=om.PixelFormat.RGBA32F,a=Float32Array):(n=4*t,o=4,i=om.PixelFormat.RGBA8888,a=Uint8Array);const{width:r,height:s}=function(e){e<5&&(e=5);const t=bn(Cn(e)),n=t>>1;return{width:1<<(1&t?n+1:n),height:1<<n}}(n);return{width:r,height:s,create:()=>{const t=new ArrayBuffer(r*s*o),n=new Float32Array(t),c=a===Float32Array?n:new a(t),l=new Id({width:r,height:s,_data:c,_compressed:!1,format:i}),_=new om;_.setFilters(om.Filter.NEAREST,om.Filter.NEAREST),_.setMipFilter(om.Filter.NONE),_.setWrapMode(om.WrapMode.CLAMP_TO_EDGE,om.WrapMode.CLAMP_TO_EDGE,om.WrapMode.CLAMP_TO_EDGE),_.image=l,_.getGFXTexture()||v("Unexpected: failed to create morph texture?");const u=e.getSampler(_.getSamplerInfo());return{get texture(){return _.getGFXTexture()},get sampler(){return u},get valueView(){return n},destroy(){_.destroy()},updatePixels(){_.uploadData(c)}}}}}function Vk(e,t,n){e.renderingSubMeshes[t].enableVertexIdChannel(n)}var Hk,Wk,qk,Yk;function Xk(e){switch(e){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}}const Qk=new _i,Zk=new _i,Jk=new Uint8Array;let Kk=e("bH",Uc("cc.Mesh")((qk=Pc((Wk=class extends __{get _nativeAsset(){return this._data.buffer}set _nativeAsset(e){this._data=new Uint8Array(e)}get subMeshCount(){const e=this.renderingSubMeshes;return e?e.length:0}get minPosition(){return this.struct.minPosition}get maxPosition(){return this.struct.maxPosition}get struct(){return this._struct}get data(){return this._data}get hash(){return this._hash||(this._hash=Xr(this._data,666)),this._hash}get jointBufferIndices(){return this._jointBufferIndices?this._jointBufferIndices:this._jointBufferIndices=this._struct.primitives.map((e=>e.jointMapIndex||0))}get renderingSubMeshes(){return this.initialize(),this._renderingSubMeshes}constructor(){super(),this.morphRendering=null,Tc(this,"_struct",qk,this),Tc(this,"_hash",Yk,this),this._data=Jk,this._initialized=!1,this._renderingSubMeshes=null,this._boneSpaceBounds=new Map,this._jointBufferIndices=null}onLoaded(){this.initialize()}initialize(){if(this._initialized)return;this._initialized=!0;const{buffer:e}=this._data,t=c.director.root.device,n=this._createVertexBuffers(t,e),i=[];for(let o=0;o<this._struct.primitives.length;o++){const a=this._struct.primitives[o];if(0===a.vertexBundelIndices.length)continue;let r=null,s=null;if(a.indexView){const n=a.indexView;let i=n.stride,o=n.length;if(4===i&&!t.hasFeature(Uo.ELEMENT_INDEX_UINT)){const e=this._struct.vertexBundles[a.vertexBundelIndices[0]].view.count;if(e>=65536){w(10001,e,65536);continue}i>>=1,o>>=1}r=t.createBuffer(new ka(Ho.INDEX,Yo.DEVICE,o,i)),s=new(Xk(n.stride))(e,n.offset,n.count),n.stride!==i&&(s=Xk(i).from(s)),r.update(s)}const c=a.vertexBundelIndices.map((e=>n[e])),l=[];if(a.vertexBundelIndices.length>0){const e=a.vertexBundelIndices[0],t=this._struct.vertexBundles[e].attributes;for(let e=0;e<t.length;++e){const n=t[e];l[e]=new ir(n.name,n.format,n.isNormalized,n.stream,n.isInstanced,n.location)}}const _=new Gb(c,l,a.primitiveMode,r);_.mesh=this,_.subMeshIdx=o,i.push(_)}this._renderingSubMeshes=i,this._struct.morph&&(this.morphRendering=function(e,t){return new Fk(e,t)}(this,t))}destroy(){return this.destroyRenderingMesh(),super.destroy()}destroyRenderingMesh(){if(this._renderingSubMeshes){for(let e=0;e<this._renderingSubMeshes.length;e++)this._renderingSubMeshes[e].destroy();this._renderingSubMeshes=null,this._initialized=!1}}assign(e,t){this.reset({struct:e,data:t})}reset(e){this.destroyRenderingMesh(),this._struct=e.struct,this._data=e.data,this._hash=0}getBoneSpaceBounds(e){if(this._boneSpaceBounds.has(e.hash))return this._boneSpaceBounds.get(e.hash);const t=[];this._boneSpaceBounds.set(e.hash,t);const n=[],{bindposes:i}=e;for(let e=0;e<i.length;e++)t.push(new dc(1/0,1/0,1/0,-1/0,-1/0,-1/0)),n.push(!1);const{primitives:o}=this._struct;for(let e=0;e<o.length;e++){const o=this.readAttribute(e,Sa.ATTR_JOINTS),a=this.readAttribute(e,Sa.ATTR_WEIGHTS),r=this.readAttribute(e,Sa.ATTR_POSITION);if(!o||!a||!r)continue;const s=Math.min(o.length/4,a.length/4,r.length/3);for(let e=0;e<s;e++){_i.set(Qk,r[3*e+0],r[3*e+1],r[3*e+2]);for(let r=0;r<4;++r){const s=4*e+r,c=o[s];if(0===a[s]||c>=i.length)continue;_i.transformMat4(Zk,Qk,i[c]),n[c]=!0;const l=t[c];_i.min(l.center,l.center,Zk),_i.max(l.halfExtents,l.halfExtents,Zk)}}}for(let e=0;e<i.length;e++){const i=t[e];n[e]?dc.fromPoints(i,i.center,i.halfExtents):t[e]=null}return t}merge(e,t,n){if(n&&!this.validateMergingMesh(e))return!1;const i=new _i,o=t&&new Ai,a=t&&new dc;if(o&&t.getRotation(o),!this._initialized){const n=JSON.parse(JSON.stringify(e._struct)),r=e._data.slice();if(t){n.maxPosition&&n.minPosition&&(_i.add(a.center,n.maxPosition,n.minPosition),_i.multiplyScalar(a.center,a.center,.5),_i.subtract(a.halfExtents,n.maxPosition,n.minPosition),_i.multiplyScalar(a.halfExtents,a.halfExtents,.5),dc.transform(a,a,t),_i.add(n.maxPosition,a.center,a.halfExtents),_i.subtract(n.minPosition,a.center,a.halfExtents));for(let e=0;e<n.vertexBundles.length;e++){const a=n.vertexBundles[e];for(let e=0;e<a.attributes.length;e++)if(a.attributes[e].name===Sa.ATTR_POSITION||a.attributes[e].name===Sa.ATTR_NORMAL){const{format:n}=a.attributes[e],s=new DataView(r.buffer,a.view.offset+$k(a.attributes,e)),c=nU(s,n),l=iU(s,n);if(!c||!l)continue;const _=a.view.count,u=a.view.stride,h=tU(n);for(let n=0;n<_;n++){const r=n*u,s=r+h,_=s+h;switch(i.set(c(r),c(s),c(_)),a.attributes[e].name){case Sa.ATTR_POSITION:i.transformMat4(t);break;case Sa.ATTR_NORMAL:_i.transformQuat(i,i,o)}l(r,i.x),l(s,i.y),l(_,i.z)}}}}return this.reset({struct:n,data:r}),this.initialize(),!0}const r=new Lk;let s,c,l,_,u,h=0,f=0,p=0,d=0,m=0,A=0,v=0,g=0,x=!1;const y=new Array(this._struct.vertexBundles.length);for(let n=0;n<this._struct.vertexBundles.length;++n){const a=this._struct.vertexBundles[n],b=e._struct.vertexBundles[n];p=a.view.offset,d=b.view.offset,f=a.view.stride,h=a.view.count+b.view.count,s=new ArrayBuffer(h*f),c=new Uint8Array(s),l=this._data.subarray(p,p+a.view.length),p+=l.length,_=e._data.subarray(d,d+b.view.length),d+=_.length,c.set(l),m=0;for(const e of a.attributes){v=0,x=!1;for(const t of b.attributes){if(e.name===t.name&&e.format===t.format){x=!0;break}v+=Pr[t.format].size}if(x){g=Pr[e.format].size,A=a.view.length+m;for(let n=0;n<b.view.count;++n){if(u=_.subarray(v,v+g),c.set(u,A),(e.name===Sa.ATTR_POSITION||e.name===Sa.ATTR_NORMAL)&&t){const n=new Float32Array(c.buffer,A,3);switch(i.set(n[0],n[1],n[2]),e.name){case Sa.ATTR_POSITION:i.transformMat4(t);break;case Sa.ATTR_NORMAL:_i.transformQuat(i,i,o)}n[0]=i.x,n[1]=i.y,n[2]=i.z}A+=a.view.stride,v+=b.view.stride}}m+=Pr[e.format].size}y[n]={attributes:a.attributes,view:{offset:r.getLength(),length:s.byteLength,count:h,stride:f}},r.addBuffer(s)}let b,S,C,E=0,T=2,P=0;const w=new Array(this._struct.primitives.length);for(let t=0;t<this._struct.primitives.length;++t){const n=this._struct.primitives[t],i=e._struct.primitives[t];w[t]={primitiveMode:n.primitiveMode,vertexBundelIndices:n.vertexBundelIndices};for(const e of n.vertexBundelIndices)P=Math.max(P,this._struct.vertexBundles[e].view.count);if(n.indexView&&i.indexView){E=n.indexView.count,E+=i.indexView.count,p=n.indexView.offset,d=i.indexView.offset,T=E<256?1:E<65536?2:4;const o=new ArrayBuffer(E*T);if(b=2===T?new Uint16Array(o):1===T?new Uint8Array(o):new Uint32Array(o),S=2===n.indexView.stride?new Uint16Array(this._data.buffer,p,n.indexView.count):1===n.indexView.stride?new Uint8Array(this._data.buffer,p,n.indexView.count):new Uint32Array(this._data.buffer,p,n.indexView.count),T===n.indexView.stride)b.set(S);else for(let e=0;e<n.indexView.count;++e)b[e]=S[e];p+=n.indexView.length,C=2===i.indexView.stride?new Uint16Array(e._data.buffer,d,i.indexView.count):1===i.indexView.stride?new Uint8Array(e._data.buffer,d,i.indexView.count):new Uint32Array(e._data.buffer,d,i.indexView.count);for(let e=0;e<i.indexView.count;++e)b[n.indexView.count+e]=P+C[e];d+=i.indexView.length,w[t].indexView={offset:r.getLength(),length:o.byteLength,count:E,stride:T},r.setNextAlignment(T),r.addBuffer(o)}}const I={vertexBundles:y,primitives:w,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return I.minPosition&&e._struct.minPosition&&I.maxPosition&&e._struct.maxPosition&&(t?(_i.add(a.center,e._struct.maxPosition,e._struct.minPosition),_i.multiplyScalar(a.center,a.center,.5),_i.subtract(a.halfExtents,e._struct.maxPosition,e._struct.minPosition),_i.multiplyScalar(a.halfExtents,a.halfExtents,.5),dc.transform(a,a,t),_i.add(i,a.center,a.halfExtents),_i.max(I.maxPosition,I.maxPosition,i),_i.subtract(i,a.center,a.halfExtents),_i.min(I.minPosition,I.minPosition,i)):(_i.min(I.minPosition,I.minPosition,e._struct.minPosition),_i.max(I.maxPosition,I.maxPosition,e._struct.maxPosition))),this.reset({struct:I,data:new Uint8Array(r.getCombined())}),this.initialize(),!0}validateMergingMesh(e){if(this._struct.vertexBundles.length!==e._struct.vertexBundles.length)return!1;for(let t=0;t<this._struct.vertexBundles.length;++t){const n=this._struct.vertexBundles[t],i=e._struct.vertexBundles[t];if(n.attributes.length!==i.attributes.length)return!1;for(let e=0;e<n.attributes.length;++e)if(n.attributes[e].format!==i.attributes[e].format)return!1}if(this._struct.primitives.length!==e._struct.primitives.length)return!1;for(let t=0;t<this._struct.primitives.length;++t){const n=this._struct.primitives[t],i=e._struct.primitives[t];if(n.vertexBundelIndices.length!==i.vertexBundelIndices.length)return!1;for(let e=0;e<n.vertexBundelIndices.length;++e)if(n.vertexBundelIndices[e]!==i.vertexBundelIndices[e])return!1;if(n.primitiveMode!==i.primitiveMode)return!1;if(n.indexView){if(void 0===i.indexView)return!1}else if(i.indexView)return!1}return!0}readAttribute(e,t){let n=null;return this._accessAttribute(e,t,((e,t)=>{const i=e.view.count,{format:o}=e.attributes[t],a=Fr(Pr[o]);if(0===i)return;const r=new DataView(this._data.buffer,e.view.offset+$k(e.attributes,t)),s=Pr[o],c=nU(r,o);if(!a||!c)return;const l=s.count,_=new a(i*l),u=e.view.stride;for(let e=0;e<i;++e)for(let t=0;t<l;++t)_[l*e+t]=c(u*e+_.BYTES_PER_ELEMENT*t);n=_})),n}copyAttribute(e,t,n,i,o){let a=!1;return this._accessAttribute(e,t,((e,t)=>{const r=e.view.count;if(0===r)return void(a=!0);const{format:s}=e.attributes[t],c=new DataView(this._data.buffer,e.view.offset+$k(e.attributes,t)),l=new DataView(n,o),_=Pr[s],u=nU(c,s),h=iU(l,s);if(!u||!h)return;const f=_.count,p=e.view.stride,d=tU(s),m=i,A=d;for(let e=0;e<r;++e)for(let t=0;t<f;++t)h(m*e+A*t,u(p*e+d*t));a=!0})),a}readIndices(e){if(e>=this._struct.primitives.length)return null;const t=this._struct.primitives[e];if(!t.indexView)return null;const{stride:n}=t.indexView;return new(1===n?Uint8Array:2===n?Uint16Array:Uint32Array)(this._data.buffer,t.indexView.offset,t.indexView.count)}copyIndices(e,t){if(e>=this._struct.primitives.length)return!1;const n=this._struct.primitives[e];if(!n.indexView)return!1;const i=n.indexView.count,o=1===n.indexView.stride?Go.R8UI:2===n.indexView.stride?Go.R16UI:Go.R32UI,a=nU(new DataView(this._data.buffer),o);for(let e=0;e<i;++e)t[e]=a(n.indexView.offset+Pr[o].size*e);return!0}_accessAttribute(e,t,n){if(e>=this._struct.primitives.length)return;const i=this._struct.primitives[e];for(const e of i.vertexBundelIndices){const i=this._struct.vertexBundles[e],o=i.attributes.findIndex((e=>e.name===t));if(!(o<0)){n(i,o);break}}}_createVertexBuffers(e,t){return this._struct.vertexBundles.map((n=>{const i=e.createBuffer(new ka(Ho.VERTEX,Yo.DEVICE,n.view.length,n.view.stride)),o=new Uint8Array(t,n.view.offset,n.view.length);return i.update(o),i}))}initDefault(e){super.initDefault(e),this.reset({struct:{vertexBundles:[],primitives:[]},data:Jk})}}).prototype,"_struct",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{vertexBundles:[],primitives:[]}}}),Yk=Pc(Wk.prototype,"_hash",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Hk=Wk))||Hk);function $k(e,t){let n=0;for(let i=0;i<t;++i){const t=e[i];n+=Pr[t.format].size}return n}c.Mesh=Kk;const{isLittleEndian:eU}=U_;function tU(e){const t=Pr[e];return t.size/t.count}function nU(e,t){const n=Pr[t],i=n.size/n.count;switch(n.type){case jo.UNORM:switch(i){case 1:return t=>e.getUint8(t);case 2:return t=>e.getUint16(t,eU);case 4:return t=>e.getUint32(t,eU)}break;case jo.SNORM:case jo.INT:switch(i){case 1:return t=>e.getInt8(t);case 2:return t=>e.getInt16(t,eU);case 4:return t=>e.getInt32(t,eU)}break;case jo.UINT:switch(i){case 1:return t=>e.getUint8(t);case 2:return t=>e.getUint16(t,eU);case 4:return t=>e.getUint32(t,eU)}break;case jo.FLOAT:return t=>e.getFloat32(t,eU)}return null}function iU(e,t){const n=Pr[t],i=n.size/n.count;switch(n.type){case jo.UNORM:switch(i){case 1:return(t,n)=>e.setUint8(t,n);case 2:return(t,n)=>e.setUint16(t,n,eU);case 4:return(t,n)=>e.setUint32(t,n,eU)}break;case jo.SNORM:case jo.INT:switch(i){case 1:return(t,n)=>e.setInt8(t,n);case 2:return(t,n)=>e.setInt16(t,n,eU);case 4:return(t,n)=>e.setInt32(t,n,eU)}break;case jo.UINT:switch(i){case 1:return(t,n)=>e.setUint8(t,n);case 2:return(t,n)=>e.setUint16(t,n,eU);case 4:return(t,n)=>e.setUint32(t,n,eU)}break;case jo.FLOAT:return(t,n)=>e.setFloat32(t,n,eU)}return null}var oU,aU,rU,sU,cU,lU,_U,uU;Pn(Kk.prototype,"Mesh.prototype",[{name:"renderingMesh",newName:"renderingSubMeshes"}]),wn(Kk.prototype,"Mesh.prototype",[{name:"hasFlatBuffers"},{name:"destroyFlatBuffers"}]);let hU,fU,pU,dU,mU,AU,vU,gU=e("cD",(oU=Uc("cc.Skeleton"),aU=vl([ft]),rU=vl([Ei]),oU((lU=Pc((cU=class extends __{constructor(...e){super(...e),Tc(this,"_joints",lU,this),Tc(this,"_bindposes",_U,this),Tc(this,"_hash",uU,this),this._invBindposes=null}get joints(){return this._joints}set joints(e){this._joints=e}get bindposes(){return this._bindposes}set bindposes(e){this._bindposes=e}get inverseBindposes(){if(!this._invBindposes){this._invBindposes=[];for(let e=0;e<this._bindposes.length;e++){const t=new Ei;Ei.invert(t,this._bindposes[e]),this._invBindposes.push(t)}}return this._invBindposes}get hash(){if(!this._hash){let e="";for(let t=0;t<this._bindposes.length;t++){const n=this._bindposes[t];e+=`${n.m00.toPrecision(2)} ${n.m01.toPrecision(2)} ${n.m02.toPrecision(2)} ${n.m03.toPrecision(2)} ${n.m04.toPrecision(2)} ${n.m05.toPrecision(2)} ${n.m06.toPrecision(2)} ${n.m07.toPrecision(2)} ${n.m08.toPrecision(2)} ${n.m09.toPrecision(2)} ${n.m10.toPrecision(2)} ${n.m11.toPrecision(2)} ${n.m12.toPrecision(2)} ${n.m13.toPrecision(2)} ${n.m14.toPrecision(2)} ${n.m15.toPrecision(2)}\n`}this._hash=Xr(e,666)}return this._hash}destroy(){var e,t;return null===(e=null===(t=c.director.root)||void 0===t?void 0:t.dataPoolManager)||void 0===e||e.releaseSkeleton(this),super.destroy()}validate(){return this.joints.length>0&&this.bindposes.length>0}}).prototype,"_joints",[aU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_U=Pc(cU.prototype,"_bindposes",[rU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),uU=Pc(cU.prototype,"_hash",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sU=cU))||sU));function xU(e){c._global.CC_PHYSICS_BUILTIN="builtin"===e,c._global.CC_PHYSICS_CANNON="cannon.js"===e,c._global.CC_PHYSICS_AMMO="ammo.js"===e}c.Skeleton=gU,function(e){e[e.DYNAMIC=1]="DYNAMIC",e[e.STATIC=2]="STATIC",e[e.KINEMATIC=4]="KINEMATIC"}(hU||(hU=e("ef",{}))),ke(hU),function(e){e[e.X_AXIS=0]="X_AXIS",e[e.Y_AXIS=1]="Y_AXIS",e[e.Z_AXIS=2]="Z_AXIS"}(fU||(fU=e("h7",{}))),ke(fU),function(e){e[e.VERTEX=1]="VERTEX",e[e.LINE=2]="LINE",e[e.TRIANGLE=3]="TRIANGLE",e[e.TETRAHEDRON=4]="TETRAHEDRON"}(pU||(pU={})),ke(pU),function(e){e[e.BOX=0]="BOX",e[e.SPHERE=1]="SPHERE",e[e.CAPSULE=2]="CAPSULE",e[e.CYLINDER=3]="CYLINDER",e[e.CONE=4]="CONE",e[e.MESH=5]="MESH",e[e.PLANE=6]="PLANE",e[e.SIMPLEX=7]="SIMPLEX",e[e.TERRAIN=8]="TERRAIN"}(dU||(dU=e("eh",{}))),ke(dU),function(e){e[e.POINT_TO_POINT=0]="POINT_TO_POINT",e[e.HINGE=1]="HINGE",e[e.CONE_TWIST=2]="CONE_TWIST"}(mU||(mU={})),ke(mU),function(e){e[e.DEFAULT=1]="DEFAULT"}(AU||(AU=e("ee",{}))),ke(AU);const yU=e("en",{id:"",switchTo:function(e){if(!yU.runInEditor)return;const t=yU;if(yU.physicsWorld&&e!==yU.id&&null!=yU.backend[e]?(yU.physicsWorld.destroy(),console.info(`[PHYSICS]: switch from ${yU.id} to ${e}.`),xU(e),t.id=e,t.wrapper=yU.backend[e],t.physicsWorld=TU()):(console.info(`[PHYSICS]: using ${e}.`),t.physicsWorld=TU()),vU){const e=t.physicsWorld;e.setGravity(vU.gravity),e.setAllowSleep(vU.allowSleep),e.setDefaultMaterial(vU.defaultMaterial)}},register:function(e,t){if(console.info(`[PHYSICS]: register ${e}.`),yU.backend[e]=t,!yU.physicsWorld||yU.id===e){xU(e);const n=yU;n.id=e,n.wrapper=t}},wrapper:{},backend:{},physicsWorld:null,runInEditor:!i}),bU=()=>0,SU={impl:null,setGravity:bU,setAllowSleep:bU,setDefaultMaterial:bU,step:bU,syncAfterEvents:bU,syncSceneToPhysics:bU,raycast:bU,raycastClosest:bU,emitEvents:bU,destroy:bU};var CU;function EU(e,t){return null==e&&(yU.id?v(`${yU.id} physics does not support ${CU[t]}`):R(9600),!0)}function TU(){return EU(yU.wrapper.PhysicsWorld,CU.World)?SU:new yU.wrapper.PhysicsWorld}!function(e){e[e.World=0]="World",e[e.RigidBody=1]="RigidBody",e[e.BoxCollider=2]="BoxCollider",e[e.SphereCollider=3]="SphereCollider",e[e.CapsuleCollider=4]="CapsuleCollider",e[e.MeshCollider=5]="MeshCollider",e[e.CylinderCollider=6]="CylinderCollider",e[e.ConeCollider=7]="ConeCollider",e[e.TerrainCollider=8]="TerrainCollider",e[e.SimplexCollider=9]="SimplexCollider",e[e.PlaneCollider=10]="PlaneCollider",e[e.PointToPointConstraint=11]="PointToPointConstraint",e[e.HingeConstraint=12]="HingeConstraint",e[e.ConeTwistConstraint=13]="ConeTwistConstraint"}(CU||(CU={}));const PU={impl:null,rigidBody:null,isAwake:!1,isSleepy:!1,isSleeping:!1,initialize:bU,onEnable:bU,onDisable:bU,onDestroy:bU,setType:bU,setMass:bU,setLinearDamping:bU,setAngularDamping:bU,useGravity:bU,setLinearFactor:bU,setAngularFactor:bU,setAllowSleep:bU,wakeUp:bU,sleep:bU,clearState:bU,clearForces:bU,clearVelocity:bU,setSleepThreshold:bU,getSleepThreshold:bU,getLinearVelocity:bU,setLinearVelocity:bU,getAngularVelocity:bU,setAngularVelocity:bU,applyForce:bU,applyLocalForce:bU,applyImpulse:bU,applyLocalImpulse:bU,applyTorque:bU,applyLocalTorque:bU,setGroup:bU,getGroup:bU,addGroup:bU,removeGroup:bU,setMask:bU,getMask:bU,addMask:bU,removeMask:bU,isUsingCCD:bU,useCCD:bU},wU={INITED:!1},IU={impl:null,collider:null,attachedRigidBody:null,initialize:bU,onLoad:bU,onEnable:bU,onDisable:bU,onDestroy:bU,setGroup:bU,getGroup:bU,addGroup:bU,removeGroup:bU,setMask:bU,getMask:bU,addMask:bU,removeMask:bU,setMaterial:bU,setAsTrigger:bU,setCenter:bU,getAABB:bU,getBoundingSphere:bU,updateSize:bU,updateRadius:bU,setRadius:bU,setCylinderHeight:bU,setDirection:bU,setHeight:bU,setShapeType:bU,setVertices:bU,setMesh:bU,setTerrain:bU,setNormal:bU,setConstant:bU,updateEventListener:bU};const RU={INITED:!1},DU={impl:null,initialize:bU,onLoad:bU,onEnable:bU,onDisable:bU,onDestroy:bU,setEnableCollision:bU,setConnectedBody:bU,setPivotA:bU,setPivotB:bU,setAxis:bU};function NU(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function OU(e,t){return e(t={exports:{}},t.exports),t.exports}e("ep","undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{});var MU,zU,LU,FU,BU,kU,UU,GU,jU=NU(OU((function(e,t){"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=function(e){for(var t,n=new Uint8Array(123),i=25;0<=i;--i)n[48+i]=52+i,n[65+i]=i,n[97+i]=26+i;function o(e,t,i){for(var o,a,r=0,s=t,c=i.length,l=t+(3*c>>2)-("="==i[c-2])-("="==i[c-1]);r<c;r+=4)o=n[i.charCodeAt(r+1)],a=n[i.charCodeAt(r+2)],e[s++]=n[i.charCodeAt(r)]<<2|o>>4,s<l&&(e[s++]=o<<4|a>>2),s<l&&(e[s++]=a<<6|n[i.charCodeAt(r+3)])}n[43]=62,n[47]=63;var a=new ArrayBuffer(16),r=new Int32Array(a),s=new Float32Array(a),c=new Float64Array(a);function l(e,t){r[e]=t}function _(){return c[0]}function u(e){c[0]=e}function h(e){s[2]=e}function f(){return s[2]}return function(e){var n=e.memory,i=n.buffer;n.grow=mi;var a=new Int8Array(i),s=new Int16Array(i),c=new Int32Array(i),p=new Uint8Array(i),d=new Uint16Array(i),m=new Uint32Array(i),A=new Float32Array(i),v=new Float64Array(i),g=Math.imul,x=Math.fround,y=Math.abs,b=Math.clz32,S=Math.min,C=Math.max,E=Math.floor,T=Math.sqrt,P=e.abort,w=e.syncPhysicsToGraphics,I=e.fd_close,R=e.fd_write,D=e.fd_seek,N=89792,O=0;function M(e){var t,n=0,i=0,o=0,a=0,r=0,s=0,l=0,_=0,u=0,h=0,f=0;N=t=N-16|0;e:{t:{n:{i:{o:{a:{r:{s:{c:{l:{_:{if(e>>>0<=236){if(3&(n=(r=c[5296])>>>(i=(s=e>>>0<11?16:e+19&-16)>>>3|0)|0)){e=(a=c[21232+(n=(o=1^(i|1&n))<<3)>>2])+8|0,(0|(i=c[a+8>>2]))!=(0|(n=n+21224|0))?(c[n+8>>2]=i,c[i+12>>2]=n):(f=fi(o)&r,c[5296]=f),c[a+4>>2]=3|(n=o<<3),c[4+(n=n+a|0)>>2]=1|c[n+4>>2];break e}if(s>>>0<=(u=c[5298])>>>0)break _;if(n){i=e=(n=(0-(e=(0-(e=2<<i)|e)&n<<i)&e)-1|0)>>>12&16,i|=e=(n=n>>>e|0)>>>5&8,i|=e=(n=n>>>e|0)>>>2&4,o=c[21232+(e=(i=((i|=e=(n=n>>>e|0)>>>1&2)|(e=(n=n>>>e|0)>>>1&1))+(n>>>e|0)|0)<<3)>>2],(0|(n=c[o+8>>2]))!=(0|(e=e+21224|0))?(c[e+8>>2]=n,c[n+12>>2]=e):(r=fi(i)&r,c[5296]=r),e=o+8|0,c[o+4>>2]=3|s,c[(n=i<<3)+o>>2]=a=n-s|0,c[4+(o=o+s|0)>>2]=1|a,u&&(i=21224+((n=u>>>3|0)<<3)|0,s=c[5301],n=(n=1<<n)&r?c[i+8>>2]:(c[5296]=n|r,i),c[n+12>>2]=s,c[i+8>>2]=s,c[s+12>>2]=i,c[s+8>>2]=n),c[5301]=o,c[5298]=a;break e}if(!(l=c[5297]))break _;for(i=e=(n=(0-l&l)-1|0)>>>12&16,i|=e=(n=n>>>e|0)>>>5&8,i|=e=(n=n>>>e|0)>>>2&4,n=c[21488+(((i|=e=(n=n>>>e|0)>>>1&2)|(e=(n=n>>>e|0)>>>1&1))+(n>>>e|0)<<2)>>2],o=(-8&c[n+4>>2])-s|0,i=n;e=(e=c[i+16>>2])||c[i+20>>2];)o=(a=(i=(-8&c[e+4>>2])-s|0)>>>0<o>>>0)?i:o,n=a?e:n,i=e;if(h=c[n+24>>2],(0|(a=c[n+12>>2]))!=(0|n)){e=c[n+8>>2],c[a+8>>2]=e,c[e+12>>2]=a;break t}if(!(e=c[(i=n+20|0)>>2])){if(!(e=c[n+16>>2]))break l;i=n+16|0}for(;_=i,(e=c[(i=(a=e)+20|0)>>2])||(i=a+16|0,e=c[a+16>>2]););c[_>>2]=0;break t}if(s=-1,!(4294967231<e>>>0)&&(s=-16&(e=e+19|0),l=c[5297])){i=0-s|0,(e=e>>>8|(_=0))&&(_=31,16777215<s>>>0||(e<<=n=e+1048320>>>16&8,_=28+((e=((e<<=r=e+520192>>>16&4)<<(o=e+245760>>>16&2)>>>15|0)-(o|n|r)|0)<<1|s>>>e+21&1)|0));u:{h:{if(o=c[21488+(_<<2)>>2])for(n=s<<(31==(0|_)?0:25-(_>>>1|0)|0),e=0;;){if(!(i>>>0<=(r=(-8&c[o+4>>2])-s|0)>>>0||(a=o,i=r))){i=0,e=o;break h}if(r=c[o+20>>2],o=c[16+((n>>>29&4)+o|0)>>2],e=r&&(0|r)!=(0|o)?r:e,n<<=0!=(0|o),!o)break}else e=0;if(!(e|a)){if(!(e=(0-(e=2<<_)|e)&l))break _;o=e=(n=(e&0-e)-1|0)>>>12&16,o|=e=(n=n>>>e|0)>>>5&8,o|=e=(n=n>>>e|0)>>>2&4,e=c[21488+(((o|=e=(n=n>>>e|0)>>>1&2)|(e=(n=n>>>e|0)>>>1&1))+(n>>>e|0)<<2)>>2]}if(!e)break u}for(;i=(o=(n=(-8&c[e+4>>2])-s|0)>>>0<i>>>0)?n:i,a=o?e:a,e=(n=c[e+16>>2])||c[e+20>>2];);}if(a&&!(c[5298]-s>>>0<=i>>>0)){if(_=c[a+24>>2],(0|a)!=(0|(n=c[a+12>>2]))){e=c[a+8>>2],c[n+8>>2]=e,c[e+12>>2]=n;break n}if(!(e=c[(o=a+20|0)>>2])){if(!(e=c[a+16>>2]))break c;o=a+16|0}for(;r=o,(e=c[(o=(n=e)+20|0)>>2])||(o=n+16|0,e=c[n+16>>2]););c[r>>2]=0;break n}}}if(s>>>0<=(i=c[5298])>>>0){o=c[5301],16<=(n=i-s|0)>>>0?(c[4+(e=o+s|0)>>2]=1|n,c[5298]=n,c[5301]=e,c[i+o>>2]=n,c[o+4>>2]=3|s):(c[o+4>>2]=3|i,c[4+(e=i+o|0)>>2]=1|c[e+4>>2],c[5301]=0,c[5298]=0),e=o+8|0;break e}if(s>>>0<(l=c[5299])>>>0){i=c[5302],c[4+(n=i+s|0)>>2]=1|(e=l-s|0),c[5299]=e,c[5302]=n,c[i+4>>2]=3|s,e=i+8|0;break e}if((i=(a=(n=_=s+71|(e=0))+(i=c[5414]?c[5416]:(c[5417]=-1,c[5418]=-1,c[5415]=65536,c[5416]=65536,c[5414]=12+t&-16^1431655768,c[5419]=0,c[5407]=0,65536))|0)&(o=0-i|0))>>>0<=s>>>0){c[5420]=48;break e}if((n=c[5406])&&!((r=(e=c[5404])+i|0)>>>0<=n>>>0&&e>>>0<r>>>0)){e=0,c[5420]=48;break e}if(4&p[21628])break a;_:{u:{if(r=c[5302])for(e=21632;;){if(r>>>0<(n=c[e>>2])+c[e+4>>2]>>>0&&n>>>0<=r>>>0)break u;if(!(e=c[e+8>>2]))break}if(-1==(0|(n=L(0))))break r;if(r=i,(r=(e=(o=c[5415])-1|0)&n?(i-n|0)+(e+n&0-o)|0:r)>>>0<=s>>>0)break r;if(2147483646<r>>>0)break r;if(o=c[5406]){if((a=(e=c[5404])+r|0)>>>0<=e>>>0)break r;if(o>>>0<a>>>0)break r}if((0|n)!=(0|(e=L(r))))break _;break o}if(2147483646<(r=o&a-l)>>>0)break r;if((0|(n=L(r)))==(c[e>>2]+c[e+4>>2]|0))break s;e=n}if(n=e,!(s+72>>>0<=r>>>0||2147483646<r>>>0||-1==(0|n))){if(2147483646<(e=(e=c[5416])+(_-r|0)&0-e)>>>0)break o;if(-1!=(0|L(e))){r=e+r|0;break o}L(0-r|0);break r}if(-1!=(0|n))break o;break r}a=0;break t}n=0;break n}if(-1!=(0|n))break o}c[5407]=4|c[5407]}if(2147483646<i>>>0)break i;if(n=L(i),(e=L(0))>>>0<=n>>>0)break i;if(-1==(0|n))break i;if(-1==(0|e))break i;if((r=e-n|0)>>>0<=s+56>>>0)break i}e=c[5404]+r|0,(c[5404]=e)>>>0>m[5405]&&(c[5405]=e);o:{a:{r:{if(l=c[5302]){for(e=21632;;){if(((i=c[e>>2])+(a=c[e+4>>2])|0)==(0|n))break r;if(!(e=c[e+8>>2]))break}break a}for((e=c[5300])>>>0<=n>>>0&&e||(c[5300]=n),e=0,c[5409]=r,c[5408]=n,c[5304]=-1,c[5305]=c[5414],c[5411]=0;c[e+21232>>2]=i=e+21224|0,c[e+21236>>2]=i,256!=(0|(e=e+8|0)););c[4+(o=(e=n+8&15?-8-n&15:0)+n|0)>>2]=1|(e=(i=r-56|0)-e|0),c[5303]=c[5418],c[5299]=e,c[5302]=o,c[4+(n+i|0)>>2]=56;break o}if(!(8&p[e+12|0]||n>>>0<=l>>>0||l>>>0<i>>>0)){i=c[5299]+r|0,c[4+(o=(n=l+8&15?-8-l&15:0)+l|0)>>2]=1|(n=i-n|0),c[e+4>>2]=a+r,c[5303]=c[5418],c[5299]=n,c[5302]=o,c[4+(i+l|0)>>2]=56;break o}}n>>>0<(a=c[5300])>>>0&&(c[5300]=n,a=0),i=n+r|0,e=21632;a:{r:{s:{c:{l:{_:{for(;(0|i)!=c[e>>2];)if(!(e=c[e+8>>2]))break _;if(!(8&p[e+12|0]))break l}for(e=21632;;){if((i=c[e>>2])>>>0<=l>>>0&&l>>>0<(a=i+c[e+4>>2]|0)>>>0)break c;e=c[e+8>>2]}}if(c[e>>2]=n,c[e+4>>2]=c[e+4>>2]+r,c[4+(h=(n+8&15?-8-n&15:0)+n|0)>>2]=3|s,e=((n=i+(i+8&15?-8-i&15:0)|0)-h|0)-s|0,_=s+h|0,(0|n)==(0|l)){c[5302]=_,e=c[5299]+e|0,c[5299]=e,c[_+4>>2]=1|e;break r}if(c[5301]==(0|n)){c[5301]=_,e=c[5298]+e|0,c[5298]=e,c[_+4>>2]=1|e,c[e+_>>2]=e;break r}if(1==(3&(i=c[n+4>>2]))){l=-8&i;l:if(i>>>0<=255)a=c[n+8>>2],i=i>>>3|0,(0|(o=c[n+12>>2]))!=(0|a)?(c[o+8>>2]=a,c[a+12>>2]=o):(f=c[5296]&fi(i),c[5296]=f);else{if(u=c[n+24>>2],(0|(r=c[n+12>>2]))==(0|n))if((s=c[(o=n+20|0)>>2])||(s=c[(o=n+16|0)>>2])){for(;i=o,(s=c[(o=(r=s)+20|0)>>2])||(o=r+16|0,s=c[r+16>>2]););c[i>>2]=0}else r=0;else i=c[n+8>>2],c[r+8>>2]=i,c[i+12>>2]=r;if(u){o=c[n+28>>2];_:{if(c[(i=21488+(o<<2)|0)>>2]==(0|n)){if(c[i>>2]=r)break _;f=c[5297]&fi(o),c[5297]=f;break l}if(!(c[u+(c[u+16>>2]==(0|n)?16:20)>>2]=r))break l}c[r+24>>2]=u,(i=c[n+16>>2])&&(c[r+16>>2]=i,c[i+24>>2]=r),(i=c[n+20>>2])&&(c[r+20>>2]=i,c[i+24>>2]=r)}}n=n+l|0,e=e+l|0}if(c[n+4>>2]=-2&c[n+4>>2],c[e+_>>2]=e,c[_+4>>2]=1|e,e>>>0<=255){n=21224+((e=e>>>3|0)<<3)|0,e=(i=c[5296])&(e=1<<e)?c[n+8>>2]:(c[5296]=e|i,n),c[e+12>>2]=_,c[n+8>>2]=_,c[_+12>>2]=n,c[_+8>>2]=e;break r}if((o=e>>>8|(n=0))&&(n=31,16777215<e>>>0||(n=o,n<<=o=o+1048320>>>16&8,n=28+((n=((n<<=s=n+520192>>>16&4)<<(a=n+245760>>>16&2)>>>15|0)-(a|o|s)|0)<<1|e>>>n+21&1)|0)),c[(r=i=_)+28>>2]=n,c[i+16>>2]=0,s=21488+(n<<2)|(c[i+20>>2]=0),!((a=c[5297])&(o=1<<n))){c[s>>2]=i,c[5297]=o|a,c[i+24>>2]=s,c[i+8>>2]=i,c[i+12>>2]=i;break r}for(o=e<<(31==(0|n)?0:25-(n>>>1|0)|0),n=c[s>>2];;){if((-8&c[(a=n)+4>>2])==(0|e))break s;if(n=o>>>29|0,o<<=1,!(n=c[(s=16+(a+(4&n)|0)|0)>>2]))break}c[s>>2]=i,c[i+24>>2]=a,c[i+12>>2]=i,c[i+8>>2]=i;break r}for(c[4+(o=(i=n+8&15?-8-n&15:0)+n|0)>>2]=1|(i=(e=r-56|0)-i|0),c[4+(e+n|0)>>2]=56,c[(_=(e=(a+(a-55&15?55-a&15:0)|0)-63|0)>>>0<l+16>>>0?l:e)+4>>2]=35,c[5303]=c[5418],c[5299]=i,c[5302]=o,e=c[5411],c[(i=_+16|0)>>2]=c[5410],c[i+4>>2]=e,e=c[5409],c[_+8>>2]=c[5408],c[_+12>>2]=e,c[5410]=_+8,c[5409]=r,c[5408]=n,e=_+36|(c[5411]=0);c[e>>2]=7,(e=e+4|0)>>>0<a>>>0;);if((0|l)==(0|_))break o;if(c[_+4>>2]=-2&c[_+4>>2],c[_>>2]=r=_-l|0,c[l+4>>2]=1|r,r>>>0<=255){n=21224+((e=r>>>3|0)<<3)|0,e=(i=c[5296])&(e=1<<e)?c[n+8>>2]:(c[5296]=e|i,n),c[e+12>>2]=l,c[n+8>>2]=l,c[l+12>>2]=n,c[l+8>>2]=e;break o}if(c[l+16>>2]=0,(n=r>>>8|(e=c[l+20>>2]=0))&&(e=31,16777215<r>>>0||(e=n,e<<=n=n+1048320>>>16&8,e=28+((e=((e<<=a=e+520192>>>16&4)<<(o=e+245760>>>16&2)>>>15|0)-(o|n|a)|0)<<1|r>>>e+21&1)|0)),o=21488+((c[(i=l+28|0)>>2]=e)<<2)|0,!((i=c[5297])&(n=1<<e))){c[o>>2]=l,c[5297]=n|i,c[l+24>>2]=o,c[l+8>>2]=l,c[l+12>>2]=l;break o}for(e=r<<(31==(0|e)?0:25-(e>>>1|0)|0),n=c[o>>2];;){if((0|r)==(-8&c[(i=n)+4>>2]))break a;if(n=e>>>29|0,e<<=1,!(n=c[(o=16+(i+(4&n)|0)|0)>>2]))break}c[o>>2]=l,c[l+24>>2]=i,c[l+12>>2]=l,c[l+8>>2]=l;break o}e=c[a+8>>2],c[a+8>>2]=i,c[e+12>>2]=i,c[i+24>>2]=0,c[i+8>>2]=e,c[i+12>>2]=a}e=h+8|0;break e}e=c[i+8>>2],c[i+8>>2]=l,c[e+12>>2]=l,c[l+24>>2]=0,c[l+8>>2]=e,c[l+12>>2]=i}if(!((e=c[5299])>>>0<=s>>>0)){i=c[5302],c[4+(n=i+s|0)>>2]=1|(e=e-s|0),c[5299]=e,c[5302]=n,c[i+4>>2]=3|s,e=i+8|0;break e}}e=0,c[5420]=48;break e}n:if(_){o=c[a+28>>2];i:{if(c[(e=21488+(o<<2)|0)>>2]==(0|a)){if(c[e>>2]=n)break i;l=fi(o)&l,c[5297]=l;break n}if(!(c[_+(c[_+16>>2]==(0|a)?16:20)>>2]=n))break n}c[n+24>>2]=_,(e=c[a+16>>2])&&(c[n+16>>2]=e,c[e+24>>2]=n),(e=c[a+20>>2])&&(c[n+20>>2]=e,c[e+24>>2]=n)}n:if(i>>>0<=15)c[a+4>>2]=3|(e=i+s|0),c[4+(e=e+a|0)>>2]=1|c[e+4>>2];else if(c[4+(o=a+s|0)>>2]=1|i,c[a+4>>2]=3|s,(c[i+o>>2]=i)>>>0<=255)n=21224+((e=i>>>3|0)<<3)|0,e=(i=c[5296])&(e=1<<e)?c[n+8>>2]:(c[5296]=e|i,n),c[e+12>>2]=o,c[n+8>>2]=o,c[o+12>>2]=n,c[o+8>>2]=e;else if(n=o,(o=i>>>8|(e=0))&&(e=31,16777215<i>>>0||(e=o,e<<=o=o+1048320>>>16&8,e=28+((e=((e<<=r=e+520192>>>16&4)<<(s=e+245760>>>16&2)>>>15|0)-(s|o|r)|0)<<1|i>>>e+21&1)|0)),c[(_=n)+28>>2]=e,c[n+16>>2]=0,s=21488+(e<<2)|(c[n+20>>2]=0),(o=1<<e)&l){e=i<<(31==(0|e)?0:25-(e>>>1|0)|0),s=c[s>>2];i:{for(;;){if((-8&c[(o=s)+4>>2])==(0|i))break i;if(s=e>>>29|0,e<<=1,!(s=c[(r=16+(o+(4&s)|0)|0)>>2]))break}c[r>>2]=n,c[n+24>>2]=o,c[n+12>>2]=n,c[n+8>>2]=n;break n}e=c[o+8>>2],c[o+8>>2]=n,c[e+12>>2]=n,c[n+24>>2]=0,c[n+8>>2]=e,c[n+12>>2]=o}else c[s>>2]=n,c[5297]=o|l,c[n+24>>2]=s,c[n+8>>2]=n,c[n+12>>2]=n;e=a+8|0;break e}t:if(h){i=c[n+28>>2];n:{if(c[(e=21488+(i<<2)|0)>>2]==(0|n)){if(c[e>>2]=a)break n;f=fi(i)&l,c[5297]=f;break t}if(!(c[h+(c[h+16>>2]==(0|n)?16:20)>>2]=a))break t}c[a+24>>2]=h,(e=c[n+16>>2])&&(c[a+16>>2]=e,c[e+24>>2]=a),(e=c[n+20>>2])&&(c[a+20>>2]=e,c[e+24>>2]=a)}o>>>0<=15?(c[n+4>>2]=3|(e=o+s|0),c[4+(e=e+n|0)>>2]=1|c[e+4>>2]):(c[4+(a=n+s|0)>>2]=1|o,c[n+4>>2]=3|s,c[o+a>>2]=o,u&&(i=21224+((e=u>>>3|0)<<3)|0,s=c[5301],e=(e=1<<e)&r?c[i+8>>2]:(c[5296]=e|r,i),c[e+12>>2]=s,c[i+8>>2]=s,c[s+12>>2]=i,c[s+8>>2]=e),c[5301]=a,c[5298]=o),e=n+8|0}return N=16+t|0,e}function z(e){var t=0,n=0,i=0,o=0,a=0,r=0,s=0,l=0;e:if(e){a=(n=e-8|0)+(o=-8&(e=c[e-4>>2]))|0;t:if(!(1&e)){if(!(3&e))break e;if((n=n-(e=c[n>>2])|0)>>>0<m[5300])break e;if(o=e+o|0,c[5301]==(0|n)){if(3==(3&(e=c[a+4>>2]))){c[a+4>>2]=-2&e,c[5298]=o,c[n+o>>2]=o,c[n+4>>2]=1|o;break e}}else if(e>>>0<=255)i=e>>>3|0,e=c[n+8>>2],(0|(t=c[n+12>>2]))!=(0|e)?(c[t+8>>2]=e,c[e+12>>2]=t):(l=c[5296]&fi(i),c[5296]=l);else{if(s=c[n+24>>2],(0|n)==(0|(e=c[n+12>>2])))if((i=c[(t=n+20|0)>>2])||(i=c[(t=n+16|0)>>2])){for(;r=t,(i=c[(t=(e=i)+20|0)>>2])||(t=e+16|0,i=c[e+16>>2]););c[r>>2]=0}else e=0;else t=c[n+8>>2],c[e+8>>2]=t,c[t+12>>2]=e;if(s){t=c[n+28>>2];n:{if(c[(i=21488+(t<<2)|0)>>2]==(0|n)){if(c[i>>2]=e)break n;l=c[5297]&fi(t),c[5297]=l;break t}if(!(c[s+(c[s+16>>2]==(0|n)?16:20)>>2]=e))break t}c[e+24>>2]=s,(t=c[n+16>>2])&&(c[e+16>>2]=t,c[t+24>>2]=e),(t=c[n+20>>2])&&(c[e+20>>2]=t,c[t+24>>2]=e)}}}if(!(a>>>0<=n>>>0)&&1&(e=c[a+4>>2])){t:{if(!(2&e)){if(c[5302]==(0|a)){if(c[5302]=n,e=c[5299]+o|0,c[5299]=e,c[n+4>>2]=1|e,c[5301]!=(0|n))break e;c[5298]=0,c[5301]=0;break e}if(c[5301]==(0|a)){c[5301]=n,e=c[5298]+o|0,c[5298]=e,c[n+4>>2]=1|e,c[e+n>>2]=e;break e}o=(-8&e)+o|0;n:if(e>>>0<=255)e=e>>>3|0,(0|(i=c[a+8>>2]))!=(0|(t=c[a+12>>2]))?(c[t+8>>2]=i,c[i+12>>2]=t):(l=c[5296]&fi(e),c[5296]=l);else{if(s=c[a+24>>2],(0|a)==(0|(e=c[a+12>>2])))if((i=c[(t=a+20|0)>>2])||(i=c[(t=a+16|0)>>2])){for(;r=t,(i=c[(t=(e=i)+20|0)>>2])||(t=e+16|0,i=c[e+16>>2]););c[r>>2]=0}else e=0;else t=c[a+8>>2],c[e+8>>2]=t,c[t+12>>2]=e;if(s){t=c[a+28>>2];i:{if(c[(i=21488+(t<<2)|0)>>2]==(0|a)){if(c[i>>2]=e)break i;l=c[5297]&fi(t),c[5297]=l;break n}if(!(c[s+(c[s+16>>2]==(0|a)?16:20)>>2]=e))break n}c[e+24>>2]=s,(t=c[a+16>>2])&&(c[e+16>>2]=t,c[t+24>>2]=e),(t=c[a+20>>2])&&(c[e+20>>2]=t,c[t+24>>2]=e)}}if(c[n+o>>2]=o,c[n+4>>2]=1|o,c[5301]!=(0|n))break t;c[5298]=o;break e}c[a+4>>2]=-2&e,c[n+o>>2]=o,c[n+4>>2]=1|o}if(o>>>0<=255)e=21224+((t=o>>>3|0)<<3)|0,t=(i=c[5296])&(t=1<<t)?c[e+8>>2]:(c[5296]=t|i,e),c[t+12>>2]=n,c[e+8>>2]=n,c[n+12>>2]=e,c[n+8>>2]=t;else{c[n+16>>2]=0,(t=o>>>8|(e=c[n+20>>2]=0))&&(e=31,16777215<o>>>0||(e=28+((e=((a=(t<<=r=t+1048320>>>16&8)<<(e=t+520192>>>16&4))<<(t=a+245760>>>16&2)>>>15|0)-(t|e|r)|0)<<1|o>>>e+21&1)|0)),i=21488+((c[(i=n+28|0)>>2]=e)<<2)|0;t:if((t=c[5297])&(r=1<<e)){t=o<<(31==(0|e)?0:25-(e>>>1|0)|0),e=c[i>>2];n:{for(;;){if((-8&c[(i=e)+4>>2])==(0|o))break n;if(e=t>>>29|0,t<<=1,!(e=c[(r=16+(i+(4&e)|0)|0)>>2]))break}c[r>>2]=n,c[n+24>>2]=i,c[n+12>>2]=n,c[n+8>>2]=n;break t}e=c[i+8>>2],c[i+8>>2]=n,c[e+12>>2]=n,c[n+24>>2]=0,c[n+8>>2]=e,c[n+12>>2]=i}else c[i>>2]=n,c[5297]=t|r,c[n+24>>2]=i,c[n+8>>2]=n,c[n+12>>2]=n;if(e=c[5304]-1|0,!(c[5304]=e)){for(n=21640;n=(e=c[n>>2])+8|0,e;);c[5304]=-1}}}}}function L(e){return e?65535&e||(0|e)<=-1?void P():-1==(0|(e=mi(e>>>16|0)))?(c[5420]=48,-1):e<<16:di()<<16}function F(e){var t,n=0,i=0;if(n=(n=c[5421])||(c[5421]=21692),32==(0|(i=c[5422]))){if((t=M(260))&&3&p[t-4|0]&&B(t,0,260),!t)return;i=0,c[5421]=t,c[t>>2]=n,c[5422]=0,n=t}c[5422]=i+1,c[132+(n=(i<<2)+n|0)>>2]=0,c[n+4>>2]=e}function B(e,t,n){var i,o,r,s;if(n&&(a[0|e]=t,a[(i=e+n|0)-1|0]=t,!(n>>>0<3||(a[e+2|0]=t,a[e+1|0]=t,a[i-3|0]=t,a[i-2|0]=t,n>>>0<7||(a[e+3|0]=t,a[i-4|0]=t,n>>>0<9||(r=(i=0-e&3)+e|0,t=g(255&t,16843009),c[r>>2]=t,c[(i=(n=n-i&-4)+r|0)-4>>2]=t,n>>>0<9||(c[8+r>>2]=t,c[4+r>>2]=t,c[i-8>>2]=t,c[i-12>>2]=t,n>>>0<25||(c[24+r>>2]=t,c[20+r>>2]=t,c[16+r>>2]=t,c[12+r>>2]=t,c[i-16>>2]=t,c[i-20>>2]=t,c[i-24>>2]=t,c[i-28>>2]=t,(n=n-(o=4&r|24)|0)>>>0<32))))))))for(s=i=t,t=r+o|0;c[t>>2]=s,c[t+4>>2]=i,c[(o=t+24|0)>>2]=s,c[4+o>>2]=i,c[(o=t+16|0)>>2]=s,c[4+o>>2]=i,c[(o=t+8|0)>>2]=s,c[4+o>>2]=i,t=t+32|0,31<(n=n-32|0)>>>0;);return e}function k(e,t,n){var i=0,o=0,r=0,s=0,l=0,_=0,u=0;e:if(n&&3&t)for(;;){if(a[0|e]=p[0|t],i=n-1|0,e=e+1|0,t=t+1|0,1==(0|n))break e;if(n=i,!(3&t))break}else i=n;e:{if(!(n=3&e)){if(i>>>0<16)n=i;else for(n=i-16|0;c[e>>2]=c[t>>2],c[e+4>>2]=c[t+4>>2],c[e+8>>2]=c[t+8>>2],c[e+12>>2]=c[t+12>>2],e=e+16|0,t=t+16|0,15<(i=i-16|0)>>>0;);if(8&n&&(i=c[t+4>>2],c[e>>2]=c[t>>2],c[e+4>>2]=i,t=t+8|0,e=e+8|0),4&n&&(c[e>>2]=c[t>>2],t=t+4|0,e=e+4|0),2&n&&(a[0|e]=p[0|t],a[e+1|0]=p[t+1|0],t=t+2|0,e=e+2|0),!(1&n))break e;return void(a[0|e]=p[0|t])}t:if(!(i>>>0<32||2<(n=n-1|0)>>>0)){switch(n-1|0){default:for(a[e+1|0]=p[t+1|0],o=c[t>>2],a[0|e]=o,a[e+2|0]=p[t+2|0],l=i-3|0,_=e+3|0,u=i-20&-16,n=0;r=c[4+(s=t+n|0)>>2],c[(e=n+_|0)>>2]=r<<8|o>>>24,o=c[s+8>>2],c[e+4>>2]=o<<8|r>>>24,r=c[s+12>>2],c[e+8>>2]=r<<8|o>>>24,o=c[s+16>>2],c[e+12>>2]=o<<8|r>>>24,n=n+16|0,16<(l=l-16|0)>>>0;);e=n+_|0,t=3+(t+n|0)|0,i=(i-u|0)-19|0;break t;case 0:for(o=c[t>>2],a[0|e]=o,a[e+1|0]=p[t+1|0],l=i-2|0,_=e+2|0,u=i-20&-16,n=0;r=c[4+(s=t+n|0)>>2],c[(e=n+_|0)>>2]=r<<16|o>>>16,o=c[s+8>>2],c[e+4>>2]=o<<16|r>>>16,r=c[s+12>>2],c[e+8>>2]=r<<16|o>>>16,o=c[s+16>>2],c[e+12>>2]=o<<16|r>>>16,n=n+16|0,17<(l=l-16|0)>>>0;);e=n+_|0,t=2+(t+n|0)|0,i=(i-u|0)-18|0;break t;case 1:}for(o=c[t>>2],a[0|e]=o,l=i-1|0,_=e+1|0,u=i-20&-16,n=0;r=c[4+(s=t+n|0)>>2],c[(e=n+_|0)>>2]=r<<24|o>>>8,o=c[s+8>>2],c[e+4>>2]=o<<24|r>>>8,r=c[s+12>>2],c[e+8>>2]=r<<24|o>>>8,o=c[s+16>>2],c[e+12>>2]=o<<24|r>>>8,n=n+16|0,18<(l=l-16|0)>>>0;);e=n+_|0,t=1+(t+n|0)|0,i=(i-u|0)-17|0}16&i&&(n=p[0|t]|p[t+1|0]<<8,a[0|e]=n,a[e+1|0]=n>>>8,a[e+2|0]=p[t+2|0],a[e+3|0]=p[t+3|0],a[e+4|0]=p[t+4|0],a[e+5|0]=p[t+5|0],a[e+6|0]=p[t+6|0],a[e+7|0]=p[t+7|0],a[e+8|0]=p[t+8|0],a[e+9|0]=p[t+9|0],a[e+10|0]=p[t+10|0],a[e+11|0]=p[t+11|0],a[e+12|0]=p[t+12|0],a[e+13|0]=p[t+13|0],a[e+14|0]=p[t+14|0],a[e+15|0]=p[t+15|0],t=t+16|0,e=e+16|0),8&i&&(a[0|e]=p[0|t],a[e+1|0]=p[t+1|0],a[e+2|0]=p[t+2|0],a[e+3|0]=p[t+3|0],a[e+4|0]=p[t+4|0],a[e+5|0]=p[t+5|0],a[e+6|0]=p[t+6|0],a[e+7|0]=p[t+7|0],t=t+8|0,e=e+8|0),4&i&&(a[0|e]=p[0|t],a[e+1|0]=p[t+1|0],a[e+2|0]=p[t+2|0],a[e+3|0]=p[t+3|0],t=t+4|0,e=e+4|0),2&i&&(a[0|e]=p[0|t],a[e+1|0]=p[t+1|0],t=t+2|0,e=e+2|0),1&i&&(a[0|e]=p[0|t])}}function U(e){var t,n,i,o=0,a=0,s=0;h(e);e:{if(1283457024<=(o=2147483647&(s=r[2]))>>>0){if(e!=e)break e;return x((0|s)<0?-1.570796251296997:1.570796251296997)}t:{if(o>>>0<=1054867455){if(a=-1,964689920<=o>>>0)break t;break e}e=x(y(e)),a=o>>>0<=1066926079?o>>>0<=1060110335?(e=x(x(x(e+e)+x(-1))/x(e+x(2))),0):(e=x(x(e+x(-1))/x(e+x(1))),1):o>>>0<=1075576831?(e=x(x(e+x(-1.5))/x(x(e*x(1.5))+x(1))),2):(e=x(x(-1)/e),3)}if(o=a,n=x(e*e),t=x(n*n),i=x(t*x(x(t*x(-.106480173766613))+x(-.19999158382415771))),t=x(n*x(x(t*x(x(t*x(.06168760731816292))+x(.14253635704517365)))+x(.333333283662796))),(0|o)<=-1)return x(e-x(e*x(i+t)));e=x(A[1024+(o<<=2)>>2]-x(x(x(e*x(i+t))-A[o+1040>>2])-e)),e=(0|s)<0?x(-e):e}return e}function G(e,t){var n,i,o,a,s=0,c=x(0);if(!(t==t&e==e))return x(e+t);if(h(t),1065353216==(0|(s=r[2])))return U(e);o=s>>>30&2,h(e),n=o|(a=r[2])>>>31;e:{t:{n:{i:{if(!(i=2147483647&a)){o:switch(n-2|0){case 0:break i;case 1:break o;default:break n}return x(-3.1415927410125732)}if(2139095040!=(0|(s&=2147483647))){if(!s)break e;if(!(i>>>0<=218103808+s>>>0&&2139095040!=(0|i)))break e;if(e=c=218103808+i>>>0<s>>>0&&(c=x(0),o)?c:U(x(y(x(e/t)))),n>>>0<=2){o:switch(n-1|0){case 0:return x(-e);case 1:break o;default:break n}return x(x(3.1415927410125732)-x(e+x(8.742277657347586e-8)))}return x(x(e+x(8.742277657347586e-8))+x(-3.1415927410125732))}if(2139095040==(0|i))break t;return A[1072+(n<<2)>>2]}e=x(3.1415927410125732)}return e}return A[1056+(n<<2)>>2]}return x((0|a)<0?-1.5707963705062866:1.5707963705062866)}function j(e){var t;for(c[12+(N=t=N-16|0)>>2]=e,c[12+t>>2]||(c[12+t>>2]=1);e=M(c[12+t>>2]),!(c[8+t>>2]=e)&&(c[12+(e=N-16|0)>>2]=21952,c[e+8>>2]=2,c[4+t>>2]=c[c[e+12>>2]>>2],c[4+t>>2]);)pi[c[4+t>>2]]();return N=16+t|0,c[8+t>>2]}function V(e){var t;c[12+(N=t=N-16|0)>>2]=e,z(c[12+t>>2]),N=16+t|0}function H(e,t,n){var i,o=0;return N=i=N-16|0,(0|n)<=(o=-1)?c[5420]=28:(e=0|R(0|e,0|t,0|n,12+i|0))?c[5420]=e:o=c[12+i>>2],N=16+i|0,o}function W(e){var t=0;if(t=c[e+60>>2],c[e+60>>2]=t-1|t,8&(t=c[e>>2]))return c[e>>2]=32|t,1;c[e+4>>2]=0,c[e+8>>2]=0,t=c[e+40>>2],c[e+24>>2]=t,c[e+20>>2]=t,c[e+16>>2]=t+c[e+44>>2]}function q(e,t,n){var i,o=0,a=0,r=0,s=0;e:{if(!(o=c[n+16>>2])){if(W(n))break e;o=c[n+16>>2]}if(o-(r=c[n+20>>2])>>>0<t>>>0)return void pi[c[n+32>>2]](n,e,t);t:if(!(c[n+64>>2]<0)){for(o=e;;){if((0|t)==(0|a))break t;if(a=a+1|0,i=t+o|0,o=s=o-1|0,10==p[i-1|0])break}if(pi[c[n+32>>2]](n,o=e,e=1+(t-a|0)|0)>>>0<e>>>0)break e;e=1+(t+s|0)|0,r=c[n+20>>2],t=a-1|0}k(r,e,t),c[n+20>>2]=c[n+20>>2]+t}}function Y(e,t){if(!e)return 0;if(e)e:if(t>>>0<=127)a[0|e]=t,e=1;else{t:{if(!c[5491]){if(57216!=(-128&t))break t;a[0|e]=t,e=1;break e}if(t>>>0<=2047){a[e+1|0]=63&t|128,a[0|e]=t>>>6|192,e=2;break e}if(!(57344!=(-8192&t)&&55296<=t>>>0)){a[e+2|0]=63&t|128,a[0|e]=t>>>12|224,a[e+1|0]=t>>>6&63|128,e=3;break e}if(t-65536>>>0<=1048575){a[e+3|0]=63&t|128,a[0|e]=t>>>18|240,a[e+2|0]=t>>>6&63|128,a[e+1|0]=t>>>12&63|128,e=4;break e}}c[5420]=25,e=-1}else e=1;return e}function X(e,t,n){var i,o,a=0;if(c[204+(N=o=N-208|0)>>2]=n,c[(i=192+o|0)>>2]=0,c[4+i>>2]=0,c[(i=184+o|0)>>2]=0,c[4+i>>2]=0,c[(i=176+o|0)>>2]=0,c[4+i>>2]=0,c[168+o>>2]=0,c[172+o>>2]=0,c[160+o>>2]=0,c[164+o>>2]=0,c[200+o>>2]=n,0<=(0|Q(0,t,200+o|0,80+o|0,160+o|0))){i=c[e>>2],c[e+60>>2]<=0&&(c[e>>2]=-33&i);e:{t:{if(c[e+44>>2]){if(c[e+16>>2])break t}else c[e+44>>2]=80,c[e+24>>2]=0,c[e+16>>2]=0,c[e+20>>2]=0,a=c[e+40>>2],c[e+40>>2]=o;if(W(e))break e}Q(e,t,200+o|0,80+o|0,160+o|0)}a&&(pi[c[e+32>>2]](e,0,0),c[e+44>>2]=0,c[e+40>>2]=a,c[e+24>>2]=0,c[e+16>>2]=0,c[e+20>>2]=0),c[e>>2]=c[e>>2]|32&i}N=208+o|0}function Q(e,t,n,i,o){var h,f=0,d=0,m=0,A=0,x=0,b=0,S=0,C=0,E=0,T=0,P=0,w=0,I=0,R=0,D=0,M=0,z=0,L=0,F=0,k=0,U=0,G=0,j=0,V=0,H=0,W=0,X=336+(N=h=N-880|0)|8,Q=55+h|0,J=-338-h|0,K=336+h|9,$=656+h|0,ee=336+h|0,te=-336-h|0,ne=56+h|0;e:{t:{n:for(;;){i:if(A=t,!((2147483647-M|0)<(0|f))){M=f+M|0;o:{a:{r:{if(f=p[0|A])for(;;){s:{c:if(f&=255){if(37!=(0|f))break s;for(f=d=t;;){if(37!=p[f+1|0]){t=f;break c}if(d=d+1|0,m=p[f+2|0],f=t=f+2|0,37!=(0|m))break}}else d=t;if((0|(z=2147483647-M|0))<(0|(f=d-A|0)))break i;if(e&&(32&p[0|e]||q(A,f,e)),f)continue n;m=-1,9<(b=(x=a[f=t+1|0])-48|0)>>>0||(f=(d=36==p[t+2|0])?t+3|0:f,U=d?1:U,x=a[(d?3:1)+t|0],m=d?b:-1);c:if(31<(t=x-32|(d=0))>>>0)t=f;else if(75913&(S=1<<t))for(;;){if(d|=S,31<(b=(x=a[t=f+1|0])-32|0)>>>0)break c;if(f=t,!(75913&(S=1<<b)))break}else t=f;c:if(42!=(0|x))if(9<(S=x-48|(T=0))>>>0)b=t;else{for(f=0;T=-1,x=a[t+1|0],t=b=t+1|0,f=T=f>>>0<=214748364?(2147483647-(f=g(f,10))|0)<(0|S)?-1:f+S|0:T,(S=x-48|0)>>>0<10;);if((0|T)<0)break i}else{if(9<(f=a[t+1|0]-48|0)>>>0||36!=p[t+2|0]){if(U)break r;if(b=t+1|0,!e){T=U=0;break c}t=c[n>>2],c[n>>2]=t+4,U=0,T=c[t>>2]}else c[(f<<2)+o>>2]=10,b=t+3|0,T=c[((a[t+(U=1)|0]<<3)+i|0)-384>>2];-1<(0|T)||(T=0-T|0,d|=8192)}if(x=-1,46==p[(f=0)|b])if(42!=(0|(x=a[b+1|0])))if(t=b+1|0,9<(E=x-48|0)>>>0)R=1,x=0;else for(b=0,S=t;x=-1,b>>>0<=214748364&&(x=(2147483647-(t=g(b,10))|0)<(0|E)?-1:t+E|0),C=a[S+(R=1)|0],S=t=S+1|0,b=x,(E=C-48|0)>>>0<10;);else{if(9<(t=a[b+2|0]-48|0)>>>0||36!=p[b+3|0]){if(U)break r;t=b+2|0,x=0,e&&(b=c[n>>2],c[n>>2]=b+4,x=c[b>>2])}else c[(t<<2)+o>>2]=10,t=b+4|0,x=c[((a[b+2|0]<<3)+i|0)-384>>2];R=(-1^x)>>>31|0}else t=b,R=0;for(;;){if(S=f,57<(f=a[0|t]-65|0)>>>0)break r;if(t=t+1|0,!((f=p[2816+(f+g(S,58)|0)|0])-1>>>0<8))break}if(!f)break r;c:{l:{_:{if(27==(0|f)){if((0|m)<=-1)break _;break r}if((0|m)<0)break l;c[(m<<2)+o>>2]=f,m=c[4+(f=(m<<3)+i|0)>>2],c[56+h>>2]=c[f>>2],c[60+h>>2]=m}if(f=0,!e)continue n;break c}if(!e){M=0;break e}Z(56+h|0,f,n)}m=-65537&d,P=8192&d?m:d;c:{l:{_:if(f=a[t-1|0],!(55<(f=(b=S&&3==(15&f)?-33&f:f)-65|0)>>>0)){u:{h:{f:{p:{d:{m:{A:{v:{g:{x:{y:{b:switch(f-1|0){case 51:C=0,S=c[56+h>>2],f=c[60+h>>2],E=2790;break y;case 44:if(7<(d=255&S)>>>(f=0))continue n;switch(d-1|0){default:case 0:c[c[56+h>>2]>>2]=M;continue n;case 1:d=c[56+h>>2],c[d>>2]=M,c[d+4>>2]=M>>31;continue n;case 2:s[c[56+h>>2]>>1]=M;continue n;case 3:a[c[56+h>>2]]=M;continue n;case 5:c[c[56+h>>2]>>2]=M;continue n;case 4:continue n;case 6:}d=c[56+h>>2],c[d>>2]=M,c[d+4>>2]=M>>31;continue n;case 46:x=8<x>>>0?x:8,P|=8,b=120;case 22:case 54:if(C=0,E=2790,!((f=d=c[60+h>>2])|(S=c[56+h>>2]))){A=ne;break x}for(m=32&b,A=ne;a[0|(A=A-1|0)]=m|p[3424+(15&S)|0],(S=(15&(d=f))<<28|S>>>4)|(f=f>>>4|0););if(!(8&P))break x;if(!(c[56+h>>2]|c[60+h>>2]))break x;E=2790+(b>>4)|0,C=2;break x;case 45:if(A=ne,(f=d=c[60+h>>2])|(S=c[56+h>>2]))for(;a[0|(A=A-1|0)]=7&S|48,(S=(7&(d=f))<<29|S>>>3)|(f=f>>>3|0););if(C=0,E=2790,!(8&P))break x;x=(0|(f=ne-A|0))<(0|x)?x:f+1|0;break x;case 0:case 2:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 18:case 19:case 20:case 21:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 32:case 38:case 40:case 41:case 42:case 47:case 48:case 50:case 52:case 53:break _;case 1:break p;case 17:break d;case 49:break A;case 43:break v;case 33:break g;case 34:case 39:break b;default:break u}d=c[60+h>>2],S=c[56+h>>2],(0|(f=d))<-1||(0|f)<=-1?(f=0-((0!=(0|S))+f|0)|0,c[56+h>>2]=S=0-S|0,c[60+h>>2]=f,C=1,E=2790):E=2048&P?(C=1,2791):(C=1&P)?2792:2790}if(f>>>0<1)d=S,A=ne;else for(A=ne;H=A=A-1|0,W=S-ui(d=hi(S,f,10),m=b=O,10,0)|48,a[0|H]=W,b=9<f>>>0,S=d,f=m,b;);if(f=d)for(;a[0|(A=A-1|0)]=f-g(d=(f>>>0)/10|0,10)|48,m=9<f>>>0,f=d,m;);}if((0|x)<0&&R)break i;if(P=R?-65537&P:P,f=c[56+h>>2],d=c[60+h>>2],!(x||f|d)){f=A=ne,x=0;break o}x=(0|(f=!(f|d)+(ne-A|0)|0))<(0|x)?x:f;break l}a[55+h|0]=c[56+h>>2],C=0,E=2790,x=1,A=Q,f=ne,P=m;break o}A=c[5420],f=0,c[5497]||(c[5497]=21964);v:{g:{for(;(0|A)!=p[f+1136|0];)if((d=77)==(0|(f=f+1|0)))break g;if(!(d=f)){A=1216;break v}}for(f=1216;b=p[0|f],f=A=f+1|0,b||(f=A,d=d-1|0););}break m}A=(f=c[56+h>>2])||2800}b=E=A,P=(C=0)!=(0|(d=R=(0|x)<0?2147483647:x));m:{A:{v:{g:if(d)if(3&b)for(;;){if(!p[0|b]){f=d;break v}if(P=1!=(0|d),f=d-1|0,b=b+1|0,1==(0|d))break g;if(d=f,!(3&b))break}else f=d;else f=d;if(!P)break A}v:if(p[0|b]&&!(f>>>0<4)){for(d=3&(S=f-4|0),S=4+((-4&S)+b|0)|0;;){if((-1^(P=c[b>>2]))&P-16843009&-2139062144)break v;if(b=b+4|0,!(3<(f=f-4|0)>>>0))break}f=d,b=S}if(f)for(;;){if(!p[0|b])break m;if(b=b+1|0,!(f=f-1|0))break}}b=0}if(f=(d=b?b-A|0:R)+E|0,E=2790,(0|x)<=-1)break c;P=m,x=d;break o}if(d=A=c[56+h>>2],x)break f;f=0;break h}c[12+h>>2]=0,c[8+h>>2]=c[56+h>>2],c[56+h>>2]=8+h,x=-1,d=8+h|0}f=0,A=d;f:{for(;;){if(!(m=c[d>>2]))break f;if((b=(0|(m=Y(4+h|0,m)))<0)||x-f>>>0<m>>>0)break;if(d=d+4|0,!((f=f+m|0)>>>0<x>>>0))break f}if(b)break t}if((0|f)<0)break i}h:if(!((b=73728&P)||(0|T)<=(0|f))){if(B(h+64|0,32,(d=(E=T-f|0)>>>0<256)?E:256),m=32&(S=c[e>>2]),d){if(m)break h}else{for(d=!m,m=E;1&d&&(q(h+64|0,256,e),S=c[e>>2]),d=!(x=32&S),255<(m=m-256|0)>>>0;);if(x)break h;E&=255}q(h+64|0,E,e)}h:if(f)for(d=0;;){if(!(m=c[A>>2]))break h;if(f>>>0<(d=(m=Y(4+h|0,m))+d|0)>>>0)break h;if(32&p[0|e]||q(4+h|0,m,e),A=A+4|0,!(d>>>0<f>>>0))break}h:if(8192==(0|b)&&!((0|T)<=(0|f))){if(B(h+64|0,32,(d=(x=T-f|0)>>>0<256)?x:256),m=32&(A=c[e>>2]),d){if(m)break h}else{for(d=!m,m=x;1&d&&(q(h+64|0,256,e),A=c[e>>2]),d=!(b=32&A),255<(m=m-256|0)>>>0;);if(b)break h;x&=255}q(h+64|0,x,e)}f=(0|f)<(0|T)?T:f;continue n}if(R&&(0|x)<=-1)break i;I=v[56+h>>3],c[364+h>>2]=0,u(+I),D=(0|(f=0|r[1]))<-1||(0|f)<=-1?(I=-I,z=1,3440):2048&P?(z=1,3443):(z=1&P)?3446:3441;u:if(Infinity!=(F=y(I))&F==F)if(I=function e(t,n){var i,o,a;if(u(+t),o=0|r[1],a=0|r[0],2047!=(0|(i=o>>>20&2047))){if(!i)return 0==t?c[n>>2]=0:(t=e(0x10000000000000000*t,n),c[n>>2]=c[n>>2]+-64),t;c[n>>2]=i-1022,l(0,0|a),l(1,-2146435073&o|1071644672),t=+_()}return t}(I,364+h|0),0!=(I+=I)&&(c[364+h>>2]=c[364+h>>2]-1),97!=(0|(k=32|b))){for(f=(0|x)<0,0!=I?(A=c[364+h>>2]-28|0,c[364+h>>2]=A,I*=268435456):A=c[364+h>>2],C=f?6:x,m=R=(0|A)<0?368+h|0:$;m=(d=m)+4|0,0!=(I=1e9*(I-((c[d>>2]=f=I<4294967296&0<=I?~~I>>>0:0)>>>0))););if((0|A)<1)f=m,d=R;else for(d=R;;){if(x=(0|A)<29?A:29,!((f=m-4|0)>>>0<d>>>0)){for(A=x,S=0;V=S,S=c[(E=f)>>2],f=31&A,L=32<=(63&A)>>>0?(w=S<<f,0):(w=(1<<f)-1&S>>>32-f,S<<f),f=w,H=E,W=(w=S=V+L|0)-ui(S=hi(S,S>>>0<L>>>0?f+1|0:f,1e9),O,1e9,0)|0,c[H>>2]=W,d>>>0<=(f=E-4|0)>>>0;);S&&(c[(d=d-4|0)>>2]=S)}for(;d>>>0<(f=m)>>>0&&!c[(m=f-4|0)>>2];);if(A=c[364+h>>2]-x|0,m=f,!(0<(0|(c[364+h>>2]=A))))break}if((0|A)<=-1)for(S=1+((C+25>>>0)/9|0)|0;;){if(x=(0|A)<-9?9:0-A|0,f>>>0<=d>>>0)d=c[d>>2]?d:d+4|0;else{for(E=1e9>>>x|0,w=-1<<x^-1,A=0,m=d;L=A,A=c[m>>2],c[m>>2]=L+(A>>>x|0),A=g(E,A&w),(m=m+4|0)>>>0<f>>>0;);d=c[d>>2]?d:d+4|0,A&&(c[f>>2]=A,f=f+4|0)}if(A=x+c[364+h>>2]|0,f=(0|S)<f-(m=102==(0|k)?R:d)>>2?m+(S<<2)|0:f,!((0|(c[364+h>>2]=A))<0))break}if(!(f>>>(m=0)<=d>>>0||(m=g(R-d>>2,9),(x=c[d>>2])>>>0<10)))for(A=10;m=m+1|0,(A=g(A,10))>>>0<=x>>>0;);if((0|(A=(C-(S=102==(0|k)?0:m)|0)-(E=(k=103==(0|k))&0!=(0|C))|0))<(g(f-R>>2,9)-9|0)){if(x=(j=R+((L=(0|(w=A+9216|0))/9|0)<<2)|0)-4092|0,A=10,((V=w)-(w=g(L,9))|0)<=7)for(S=9215+(((C-E|0)-S|0)-w|0)|0;A=g(A,10),(0|(S=S+1|0))<7;);if(L=x+4|0,(S=(E=c[x>>2])-g(A,w=(E>>>0)/(A>>>0)|0)|0)||(0|L)!=(0|f)){h:{if(!(1&w)){if(I=9007199254740992,x>>>0<=d>>>0)break h;if(1e9!=(0|A))break h;if(!(1&a[x-4|0]))break h}I=9007199254740994}if(F=S>>>0<(w=A>>>1|0)>>>0?.5:(0|f)==(0|L)&&(0|w)==(0|S)?1:1.5,z&&45==p[0|D]&&(F=-F,I=-I),c[x>>2]=S=E-S|0,I+F!=I){if(1e9<=(c[x>>2]=A=A+S|0)>>>0){for(m=j-4096|0;m>>>(c[m+4>>2]=0)<d>>>0&&(c[(d=d-4|0)>>2]=0),A=c[m>>2]+1|0,c[m>>2]=A,m=m-4|0,999999999<A>>>0;);x=m+4|0}if(m=g(R-d>>2,9),!((S=c[d>>2])>>>0<10))for(A=10;m=m+1|0,(A=g(A,10))>>>0<=S>>>0;);}}f=(A=x+4|0)>>>0<f>>>0?A:f}h:{for(;;){if((S=f)>>>(x=0)<=d>>>0)break h;if(c[(f=S-4|0)>>2])break}x=1}if(k){if(C=((A=(0|m)<(0|(f=C||1))&-5<(0|m))?-1^m:-1)+f|0,b=(A?-1:-2)+b|0,!(E=8&P)){if(f=9,x&&(E=c[S-4>>2])&&!((E>>>(f=0))%10|0))for(A=10;f=f+1|0,!((E>>>0)%((A=g(A,10))>>>0)|0););A=g(S-R>>2,9)-9|0,C=102!=(32|b)?((E=0)|C)<(0|(f=0<(0|(f=(m+A|0)-f|0))?f:0))?C:f:((E=0)|C)<(0|(f=0<(0|(f=A-f|0))?f:0))?C:f}}else E=8&P;if(f=-1,!((0|((L=C|E)?2147483645:2147483646))<(0|C))){if(k=1+((0!=(0|L))+C|0)|0,j=102!=(32|b)){if(A=ee,f=m>>31,f^=f+m)for(;a[0|(A=A-1|0)]=f-g(w=(f>>>0)/10|0,10)|48,G=9<f>>>0,f=w,G;);if((ee-A|0)<=1){for(f=A-1|0;a[0|f]=48,A=ee-f|0,f=w=f-1|0,(0|A)<2;);A=w+1|0}if(a[0|(G=A-2|0)]=b,f=-1,a[A-1|0]=(0|m)<0?45:43,(2147483647-k|0)<(0|(m=ee-G|0)))break u}else{if((2147483647-k|0)<(0|m))break u;m=0<(0|m)?m:0}if(!((2147483647^z)<(0|(A=m+k|0)))){w=A+z|0;h:if(!((P&=73728)||(0|T)<=(0|w))){if(B(h+64|0,32,(f=(b=T-w|0)>>>0<256)?b:256),m=32&(A=c[e>>2]),f){if(m)break h}else{for(f=!m,m=b;1&f&&(q(h+64|0,256,e),A=c[e>>2]),f=!(k=32&A),255<(m=m-256|0)>>>0;);if(k)break h;b&=255}q(h+64|0,b,e)}32&p[0|e]||q(D,z,e);h:if(65536==(0|P)&&!((0|T)<=(0|w))){if(B(h+64|0,48,(f=(b=T-w|0)>>>0<256)?b:256),m=32&(A=c[e>>2]),f){if(m)break h}else{for(f=!m,m=b;1&f&&(q(h+64|0,256,e),A=c[e>>2]),f=!(D=32&A),255<(m=m-256|0)>>>0;);if(D)break h;b&=255}q(h+64|0,b,e)}h:if(j){f:if(!((0|C)<0)){for(b=x?S:d+4|0,x=d;;){A=K;p:{if(f=c[x>>2]){for(m=0;a[344+(m+h|0)|0]=f-g(A=(f>>>0)/10|0,10)|48,m=m-1|0,S=9<f>>>0,f=A,S;);if(A=345+(m+h|0)|0,m)break p}a[0|(A=A-1|0)]=48}if((0|d)==(0|x))32&p[0|e]||q(A,1,e),A=A+1|0,(0|C)<1&&!E||32&p[0|e]||q(3475,1,e);else if(!(A>>>0<=336+h>>>0))for(B(336+h|0,48,A+te|0);336+h>>>0<(A=A-1|0)>>>0;);if(f=K-A|0,32&p[0|e]||q(A,(0|f)<(0|C)?f:C,e),x=x+4|0,!(-1<(0|(C=C-f|0))&&x>>>0<b>>>0))break}if(!((0|C)<1)){if(B(h+64|0,48,(d=C>>>0<256)?C:256),f=32&(m=c[e>>2]),d){if(f)break f}else{for(f=!f,d=C;1&f&&(q(h+64|0,256,e),m=c[e>>2]),f=!(A=32&m),255<(d=d-256|0)>>>0;);if(A)break f;C&=255}q(h+64|0,C,e)}}32&p[0|e]||q(G,ee-G|0,e)}else{for(x=m=R>>>0<d>>>0?R:d;;){if(f=c[x>>2])for(d=0;a[d+X|0]=f-g(A=(f>>>0)/10|0,10)|48,d=d-1|0,b=9<f>>>0,f=A,b;);else d=0;if(f=d+K|0,(0|m)==(0|x)?d||(a[0|(f=f-1|0)]=48):f>>>0<=336+h>>>0||(B(336+h|0,48,d+9|0),f=336+h|0),32&p[0|e]||q(f,K-f|0,e),!((x=x+4|0)>>>0<=R>>>0))break}L&&(32&p[0|e]||q(3475,1,e));f:if((0|C)<1)f=C;else if(S>>>0<=x>>>0)f=C;else for(;;){f=K;p:{if(d=c[x>>2]){for(;a[0|(f=f-1|0)]=d-g(A=(d>>>0)/10|0,10)|48,m=9<d>>>0,d=A,m;);if(f>>>0<=336+h>>>0)break p}for(B(336+h|0,48,f+te|0);336+h>>>0<(f=f-1|0)>>>0;);}if(32&p[0|e]||q(f,(0|C)<9?C:9,e),f=C-9|0,(0|C)<10)break f;if(C=f,!((x=x+4|0)>>>0<S>>>0))break}if(!((0|f)<1)){if(B(h+64|0,48,(m=f>>>0<256)?f:256),d=32&(A=c[e>>2]),m){if(d)break h}else{for(d=!d,m=f;1&d&&(q(h+64|0,256,e),A=c[e>>2]),d=!(b=32&A),255<(m=m-256|0)>>>0;);if(b)break h;f&=255}q(h+64|0,f,e)}}h:if(8192==(0|P)&&!((0|T)<=(0|w))){if(B(h+64|0,32,(f=(S=T-w|0)>>>0<256)?S:256),d=32&(m=c[e>>2]),f){if(d)break h}else{for(f=!d,d=S;1&f&&(q(h+64|0,256,e),m=c[e>>2]),f=!(A=32&m),255<(d=d-256|0)>>>0;);if(A)break h;S&=255}q(h+64|0,S,e)}f=(0|w)<(0|T)?T:w}}}else{if(d=D+9|0,f=D,C=(D=32&b)?d:f,!(11<x>>>0)&&12!=(0|x)){for(f=x-12|0,F=16;F*=16,(d=f)>>>0<=(f=f+1|0)>>>0;);I=45!=p[0|C]?I+F-F:-(F+(-I-F))}m=ee,f=(S=c[364+h>>2])>>31;h:{if(f^=f+S){for(d=0;a[335+(d+h|0)|0]=f-g(A=(f>>>0)/10|0,10)|48,d=d-1|0,m=9<f>>>0,f=A,m;);if(m=336+(d+h|0)|0,d)break h}a[0|(m=m-1|0)]=48}for(E=2|z,a[0|(R=m-2|0)]=b+15,a[m-1|0]=(0|S)<0?45:43,A=8&P,d=336+h|0;m=f=d,b=D,d=y(I)<2147483648?~~I:-2147483648,a[0|m]=b|p[d+3424|0],I=16*(I-(0|d)),1==((d=f+1|0)-(336+h|0)|0)&&(A||0<(0|x)||0!=I)&&(a[f+1|0]=46,d=f+2|0),0!=I;);if(f=-1,!((2147483645-(A=(D=ee-R|0)+E|0)|0)<(0|x))){S=d-(336+h|0)|0,A=(x=x&&(d+J|0)<(0|x)?x+2|0:S)+A|0;h:if(!((P&=73728)||(0|T)<=(0|A))){if(B(h+64|0,32,(f=(b=T-A|0)>>>0<256)?b:256),d=32&(m=c[e>>2]),f){if(d)break h}else{for(f=!d,d=b;1&f&&(q(h+64|0,256,e),m=c[e>>2]),f=!(w=32&m),255<(d=d-256|0)>>>0;);if(w)break h;b&=255}q(h+64|0,b,e)}32&p[0|e]||q(C,E,e);h:if(65536==(0|P)&&!((0|T)<=(0|A))){if(B(h+64|0,48,(f=(E=T-A|0)>>>0<256)?E:256),d=32&(m=c[e>>2]),f){if(d)break h}else{for(f=!d,d=E;1&f&&(q(h+64|0,256,e),m=c[e>>2]),f=!(b=32&m),255<(d=d-256|0)>>>0;);if(b)break h;E&=255}q(h+64|0,E,e)}32&p[0|e]||q(336+h|0,S,e);h:if(!((0|(x=x-S|0))<1)){if(B(h+64|0,48,(d=x>>>0<256)?x:256),f=32&(m=c[e>>2]),d){if(f)break h}else{for(f=!f,d=x;1&f&&(q(h+64|0,256,e),m=c[e>>2]),f=!(b=32&m),255<(d=d-256|0)>>>0;);if(b)break h;x&=255}q(h+64|0,x,e)}32&p[0|e]||q(R,D,e);h:if(8192==(0|P)&&!((0|T)<=(0|A))){if(B(h+64|0,32,(f=(x=T-A|0)>>>0<256)?x:256),d=32&(m=c[e>>2]),f){if(d)break h}else{for(f=!d,d=x;1&f&&(q(h+64|0,256,e),m=c[e>>2]),f=!(b=32&m),255<(d=d-256|0)>>>0;);if(b)break h;x&=255}q(h+64|0,x,e)}f=(0|A)<(0|T)?T:A}}else{A=z+3|0;h:if(!(8192&P||(0|T)<=(0|A))){if(B(h+64|0,32,(f=(x=T-A|0)>>>0<256)?x:256),d=32&(m=c[e>>2]),f){if(d)break h}else{for(f=!d,d=x;1&f&&(q(h+64|0,256,e),m=c[e>>2]),f=!(S=32&m),255<(d=d-256|0)>>>0;);if(S)break h;x&=255}q(h+64|0,x,e)}32&(f=c[e>>2])||(q(D,z,e),f=c[e>>2]),32&f||(f=(32&b)>>>5|0,q(I!=I?f?3467:3471:f?3459:3463,3,e));h:if(8192==(73728&P)&&!((0|T)<=(0|A))){if(B(h+64|0,32,(f=(x=T-A|0)>>>0<256)?x:256),d=32&(m=c[e>>2]),f){if(d)break h}else{for(f=!d,d=x;1&f&&(q(h+64|0,256,e),m=c[e>>2]),f=!(b=32&m),255<(d=d-256|0)>>>0;);if(b)break h;x&=255}q(h+64|0,x,e)}f=(0|A)<(0|T)?T:A}if(0<=(0|f))continue n;break i}C=0,E=2790}f=ne;break o}if(P=m,x=d,!p[0|f])break o;break i}f=p[t+1|0],t=t+1|0}if(e)break e;if(!U){M=0;break e}if(e=1,(t=c[o+4>>2])&&(Z(i+8|0,t,n),(t=c[o+8>>(e=2)])&&(Z(i+16|0,t,n),e=3,(t=c[o+12>>2])&&(Z(i+24|0,t,n),e=4,(t=c[o+16>>2])&&(Z(i+32|0,t,n),e=5,(t=c[o+20>>2])&&(Z(i+40|0,t,n),e=6,(t=c[o+24>>2])&&(Z(i+48|0,t,n),e=7,(t=c[o+28>>2])&&(Z(i+56|0,t,n),e=8,t=c[o+32>>2])))))))){if(Z(i- -64|0,t,n),e=c[o+36>>2])break a;e=9}for(f=e-1|0,t=(e<<2)+o|0;;){if(c[t>>2])break r;if(t=t+4|0,!((f=f+(M=1)|0)>>>0<=8))break}break e}c[5420]=28;break t}Z(i+72|0,e,n),M=1;break e}if(!((2147483647-C|0)<(0|(w=(0|x)<(0|(D=f-A|0))?D:x))||(0|z)<(0|(f=(0|T)<(0|(R=C+w|0))?R:T)))){o:if(!((P&=73728)||(0|T)<=(0|R))){if(B(h+64|0,32,(d=(b=f-R|0)>>>0<256)?b:256),m=32&(S=c[e>>2]),d){if(m)break o}else{for(d=!m,m=b;1&d&&(q(h+64|0,256,e),S=c[e>>2]),d=!(z=32&S),255<(m=m-256|0)>>>0;);if(z)break o;b&=255}q(h+64|0,b,e)}32&p[0|e]||q(E,C,e);o:if(65536==(0|P)&&!((0|T)<=(0|R))){if(B(h+64|0,48,(d=(C=f-R|0)>>>0<256)?C:256),m=32&(S=c[e>>2]),d){if(m)break o}else{for(d=!m,m=C;1&d&&(q(h+64|0,256,e),S=c[e>>2]),d=!(b=32&S),255<(m=m-256|0)>>>0;);if(b)break o;C&=255}q(h+64|0,C,e)}o:if(!((0|x)<=(0|D))){if(B(h+64|0,48,(d=(b=w-D|0)>>>0<256)?b:256),m=32&(S=c[e>>2]),d){if(m)break o}else{for(d=!m,m=b;1&d&&(q(h+64|0,256,e),S=c[e>>2]),d=!(x=32&S),255<(m=m-256|0)>>>0;);if(x)break o;b&=255}q(h+64|0,b,e)}if(32&p[0|e]||q(A,D,e),8192!=(0|P))continue;if((0|T)<=(0|R))continue;if(B(h+64|0,32,(d=(T=f-R|0)>>>0<256)?T:256),m=32&(A=c[e>>2]),d){if(m)continue}else{for(d=!m,m=T;1&d&&(q(h+64|0,256,e),A=c[e>>2]),d=!(b=32&A),255<(m=m-256|0)>>>0;);if(b)continue;T&=255}q(h+64|0,T,e);continue}}break}c[5420]=61}M=-1}return N=880+h|0,M}function Z(e,t,n){var i,o,r=0,l=0,_=0;e:{t:{n:{if((t=t-9|0)>>>0<=17){switch(t-1|0){case 5:return t=c[n>>2],c[n>>2]=t+4,t=s[t>>1],c[e>>2]=t,void(c[e+4>>2]=t>>31);case 6:return t=c[n>>2],c[n>>2]=t+4,c[e>>2]=d[t>>1],void(c[e+4>>2]=0);case 7:return t=c[n>>2],c[n>>2]=t+4,t=a[0|t],c[e>>2]=t,void(c[e+4>>2]=t>>31);case 8:return t=c[n>>2],c[n>>2]=t+4,c[e>>2]=p[0|t],void(c[e+4>>2]=0);case 16:for(e=3276;!((-1^(n=c[(e=e+4|0)>>2]))&n-16843009&-2139062144););if(t=e-3280|0,255&n){for(;n=p[e+1|0],e=t=e+1|0,n;);t=t-3280|0}e=t,n=0,_=3280;i:{if(!(t=c[5272])){if(t=0,W(21072))break i;t=c[5272]}if(t-(l=c[5273])>>>0<e>>>0)t=0|pi[c[5276]](21072,3280,e);else{r=e;o:if(!(c[5284]<0)){for(i=e+3280|0,t=0;;){if(!((r=e)+t|0))break o;if(o=t+i|0,t=r=t-1|0,10==p[o-1|0])break}if((t=0|pi[c[5276]](21072,3280,n=1+(e+r|0)|0))>>>0<n>>>0)break i;_=1+(r+i|0)|0,l=c[5273],r^=-1}k(l,_,r),c[5273]=r+c[5273],t=n+r|0}}P();case 2:case 9:case 11:case 12:case 15:break e;case 1:case 4:case 10:case 14:break t;case 0:case 3:case 13:break n}t=c[n>>2],c[n>>2]=t+4,c[e>>2]=c[t>>2]}return}return t=c[n>>2],c[n>>2]=t+4,t=c[t>>2],c[e>>2]=t,void(c[e+4>>2]=t>>31)}return t=c[n>>2],c[n>>2]=t+4,c[e>>2]=c[t>>2],void(c[e+4>>2]=0)}t=c[n>>2]+7&-8,c[n>>2]=t+8,n=c[t+4>>2],c[e>>2]=c[t>>2],c[e+4>>2]=n}function J(e,t){var n=0,i=0;i=p[0|t];e:if((n=p[0|e])&&(0|i)==(0|n))for(e=e+1|0,t=t+1|0;;){if(i=p[0|t],!(n=p[0|e]))break e;if(e=e+1|0,t=t+1|0,(0|i)!=(0|n))break}return n-i|0}function K(e){c[12+(N-16|0)>>2]=e|=0}function $(e){var t,n;return c[12+(N=n=N-16|0)>>2]=e|=0,N=e=N-16|0,t=c[12+n>>2],c[e+12>>2]=t,c[12+(N-16|0)>>2]=c[e+12>>2],N=e+16|0,N=16+n|0,0|t}function ee(e){var t;return c[12+(N=t=N-16|0)>>2]=e|=0,$(e=c[12+t>>2]),N=16+t|0,0|e}function te(e){var t;c[12+(N=t=N-16|0)>>2]=e|=0,ee(e=c[12+t>>2]),V(e),N=16+t|0}function ne(e,t,n){var i;return c[8+(N=i=N-16|0)>>2]=e,c[4+i>>2]=t,a[3+i|0]=n,1&a[3+i|0]?(e=c[8+(n=i)>>2]!=c[4+i>>2]?(c[8+(e=N-16|0)>>2]=c[8+i>>2],c[e+12>>2]=c[c[e+8>>2]+4>>2],t=c[e+12>>2],c[8+(e=N-16|0)>>2]=c[4+i>>2],c[e+12>>2]=c[c[e+8>>2]+4>>2],!J(t,c[e+12>>2])):1,a[n+15|0]=e):(t=c[4+i>>2],c[4+(N=e=N-16|0)>>2]=c[8+i>>2],c[e>>2]=t,t=c[c[e>>2]+4>>2],c[e+12>>2]=c[c[e+4>>2]+4>>2],c[e+8>>2]=t,t=1,c[e+12>>2]!=c[e+8>>2]&&(t=!J(c[e+12>>2],c[e+8>>2])),N=e+16|0,a[15+i|0]=1&t),N=16+i|0,1&a[15+i|0]}function ie(e,t,n,i){var o;c[12+(o=N-16|0)>>2]=e,c[8+o>>2]=t,c[4+o>>2]=n,c[o>>2]=i,c[c[8+o>>2]+16>>2]?c[c[8+o>>2]+16>>2]!=c[4+o>>2]?(e=c[8+o>>2],c[e+36>>2]=c[e+36>>2]+1,c[c[8+o>>2]+24>>2]=2,a[c[8+o>>2]+54|0]=1):2==c[c[8+o>>2]+24>>2]&&(c[c[8+o>>2]+24>>2]=c[o>>2]):(c[c[8+o>>2]+16>>2]=c[4+o>>2],c[c[8+o>>2]+24>>2]=c[o>>2],c[c[8+o>>2]+36>>2]=1)}function oe(e,t,n,i){var o,a;c[28+(N=a=N-32|0)>>2]=e,c[24+a>>2]=t,c[20+a>>2]=n,c[16+a>>2]=i,e=c[28+a>>2],c[12+a>>2]=0,c[20+a>>2]&&(c[12+a>>2]=c[e+4>>2]>>8,1&c[e+4>>2]&&(c[8+a>>2]=c[c[20+a>>2]>>2],c[12+a>>2]=c[c[8+a>>2]+c[12+a>>2]>>2])),t=c[e>>2],i=c[24+a>>2],o=c[20+a>>2]+c[12+a>>2]|0,e=2&c[e+4>>2]?c[16+a>>2]:2,pi[c[c[(n=t)>>2]+28>>2]](n,i,o,e),N=32+a|0}function ae(e,t,n,i,o){var r;c[28+(r=N-32|0)>>2]=e,c[24+r>>2]=t,c[20+r>>2]=n,c[16+r>>2]=i,c[12+r>>2]=o,a[c[24+r>>2]+53|0]=1,c[16+r>>2]==c[c[24+r>>2]+4>>2]&&(a[c[24+r>>2]+52|0]=1,c[c[24+r>>2]+16>>2]?c[c[24+r>>2]+16>>2]!=c[20+r>>2]?(e=c[24+r>>2],c[e+36>>2]=c[e+36>>2]+1,a[c[24+r>>2]+54|0]=1):(2==c[c[24+r>>2]+24>>2]&&(c[c[24+r>>2]+24>>2]=c[12+r>>2]),1==c[c[24+r>>2]+48>>2]&&1==c[c[24+r>>2]+24>>2]&&(a[c[24+r>>2]+54|0]=1)):(c[c[24+r>>2]+16>>2]=c[20+r>>2],c[c[24+r>>2]+24>>2]=c[12+r>>2],(c[c[24+r>>2]+36>>2]=1)==c[c[24+r>>2]+48>>2]&&1==c[c[24+r>>2]+24>>2]&&(a[c[24+r>>2]+54|0]=1)))}function re(e,t,n,i){var o;c[12+(o=N-16|0)>>2]=e,c[8+o>>2]=t,c[4+o>>2]=n,c[o>>2]=i,c[4+o>>2]==c[c[8+o>>2]+4>>2]&&1!=c[c[8+o>>2]+28>>2]&&(c[c[8+o>>2]+28>>2]=c[o>>2])}function se(e,t,n,i,o,r){var s;c[28+(N=s=N-32|0)>>2]=e,c[24+s>>2]=t,c[20+s>>2]=n,c[16+s>>2]=i,c[12+s>>2]=o,a[11+s|0]=r,e=c[28+s>>2],c[4+s>>2]=c[e+4>>2]>>8,1&c[e+4>>2]&&(c[s>>2]=c[c[16+s>>2]>>2],c[4+s>>2]=c[c[s>>2]+c[4+s>>2]>>2]),t=c[e>>2],i=c[24+s>>2],o=c[20+s>>2],r=c[16+s>>2]+c[4+s>>2]|0,e=2&c[e+4>>2]?c[12+s>>2]:2,pi[c[c[(n=t)>>2]+20>>2]](n,i,o,r,e,1&a[11+s|0]),N=32+s|0}function ce(e,t,n,i,o){var r;c[28+(N=r=N-32|0)>>2]=e,c[24+r>>2]=t,c[20+r>>2]=n,c[16+r>>2]=i,a[15+r|0]=o,e=c[28+r>>2],c[8+r>>2]=c[e+4>>2]>>8,1&c[e+4>>2]&&(c[4+r>>2]=c[c[20+r>>2]>>2],c[8+r>>2]=c[c[4+r>>2]+c[8+r>>2]>>2]),t=c[e>>2],i=c[24+r>>2],o=c[20+r>>2]+c[8+r>>2]|0,e=2&c[e+4>>2]?c[16+r>>2]:2,pi[c[c[(n=t)>>2]+24>>2]](n,i,o,e,1&a[15+r|0]),N=32+r|0}function le(e){var t,n;return x((t=e*e)*t*(n=t*e)*(2718311493989822e-21*t-.00019839334836096632)+(n*(.008333329385889463*t-.16666666641626524)+e))}function _e(e){var t;return x(-.499999997251031*(e*=e)+1+.04166662332373906*(t=e*e)+e*t*(2439044879627741e-20*e-.001388676377460993))}function ue(e,t){return 1024<=(0|t)?(e*=898846567431158e293,t=(0|t)<2047?t-1023|0:(e*=898846567431158e293,((0|t)<3069?t:3069)-2046|0)):-1023<(0|t)||(e*=2004168360008973e-307,t=-1992<(0|t)?t+969|0:(e*=2004168360008973e-307,(-2960<(0|t)?t:-2960)+1938|0)),l(0,0),l(1,t+1023<<20),e*+_()}function he(e,t){var n,i,o,a,s,_,u,p,d,m,A,b=0,S=0,C=0,T=0,P=0,w=0,I=0,R=0,D=0,O=0,M=0,z=0,L=0,F=0,B=0;if(N=m=N-16|0,h(e),(b=2147483647&(A=r[2]))>>>0<=1305022426)v[t>>3]=(O=+e)+-1.5707963109016418*(S=.6366197723675814*O+6755399441055744-6755399441055744)+-1.5893254773528196e-8*S,C=y(S)<2147483648?~~S:-2147483648;else if(2139095040<=b>>>0)v[t>>3]=x(e-e);else{if(v[8+m>>3]=(l(2,(P=b)-((b=(b>>>23|0)-150|0)<<23)|0),f()),L=8+m|0,N=n=N-560|0,M=b+g(o=0<(0|(P=(b-3|0)/24|0))?P:0,-24)|0,0<=(0|(i=c[956])))for(P=i+1|0,w=3840+((b=o)<<2)|0,T=320+n|0;v[T>>3]=(0|b)<0?0:+c[w>>2],T=T+8|0,w=w+4|0,b=b+1|0,P=P-1|0;);for(I=M-24|0,P=320+n|0;;){for(S=0,b=L,w=1,T=P;S+=v[b>>3]*v[T>>3],b=b+8|0,T=T-8|0,w=w-1|0;);if(v[(C<<3)+n>>3]=S,P=P+8|0,b=(0|C)<(0|i),C=C+1|0,!b)break}s=23-I|0,a=24-I|0,_=476+((i<<2)+n|0)|0,u=476+n|0,p=n-8|0,C=i;e:{for(;;){if(S=v[(b=C<<3)+n>>3],!(D=(0|C)<1))for(w=C+1|0,b=b+p|0,T=480+n|0;P=T,R=y(O=5.960464477539063e-8*(F=S))<2147483648?~~O:-2147483648,R=y(O=F+-16777216*(S=+(0|R)))<2147483648?~~O:-2147483648,c[P>>2]=R,T=T+4|0,S=v[b>>3]+S,b=b-8|0,1<(0|(w=w-1|0)););S=ue(S,I),S+=-8*E(.125*S),S-=0|(R=y(S)<2147483648?~~S:-2147483648);t:{n:{i:{if(w=(0|I)<1){if(I)break i;z=c[476+((C<<2)+n|0)>>2]>>23}else R=(b=(T=c[(P=476+((C<<2)+n|0)|0)>>2])>>a)+R|0,z=(c[(z=P)>>2]=P=T-(b<<a)|0)>>s;if((0|z)<1)break t;break n}if(z=2,!(.5<=S)){z=0;break t}}if(D)D=0;else for(b=480+n|(D=0),P=C;;){T=c[b>>2];n:{i:{if(d=b,D)B=16777215;else{if(!T)break i;D=1,B=16777216}c[d>>2]=B-T;break n}D=0}if(b=b+4|0,!(P=P-1|0))break}w||1<(b=I-1|0)>>>0||(c[(b=476+((C<<2)+n|0)|0)>>2]=1==(0|b)?4194303&c[b>>2]:8388607&c[b>>2]),R=R+1|0,2==(0|z)&&(S=1-S,z=2,D&&(S-=ue(1,I)))}if(0!=S)break;if(!((0|C)<=(0|i))){for(b=(C<<2)+u|0,T=0,w=C;T=c[b>>2]|T,b=b-4|0,(0|i)<(0|(w=w-1|0)););if(T){for(b=476+((C<<2)+n|0)|0,M=I;C=C-1|0,M=M-24|0,P=c[b>>2],b=b-4|0,!P;);break e}}for(b=_,P=C;P=P+1|0,T=c[b>>2],b=b-4|0,!T;);for(D=328+((C<<3)+n|0)|0;;){for(v[(b=328+((C<<3)+n|0)|0)>>3]=c[3840+(o+(C=C+1|0)<<2)>>2],S=0,b=L,T=D,w=1;S+=v[b>>3]*v[T>>3],b=b+8|0,T=T-8|0,w=w-1|0;);if(v[(C<<3)+n>>3]=S,D=D+8|0,!((0|C)<(0|P)))break}C=P}16777216<=(S=ue(S,0-I|0))?(T=(480+n|0)+(C<<2)|0,b=y(O=5.960464477539063e-8*(F=S))<2147483648?~~O:-2147483648,P=y(S=F+-16777216*(0|b))<2147483648?~~S:-2147483648,c[T>>2]=P,C=C+1|0):(b=y(S)<2147483648?~~S:-2147483648,M=I),c[(480+n|0)+(C<<2)>>2]=b}if(!((0|C)<0)){for(w=C+1|0,S=ue(1,M),b=(480+n|0)+(C<<2)|0,T=(C<<3)+n|0;v[T>>3]=S*+c[b>>2],b=b-4|0,T=T-8|0,S*=5.960464477539063e-8,0<(0|(w=w-1|0)););if(!((0|C)<0))for(P=(C<<3)+n|0,b=C;;){for(M=C-(I=b)|0,T=b=S=0;S+=v[b+6608>>3]*v[b+P>>3],!((0|i)<=(0|T))&&(b=b+8|0,L=T>>>0<M>>>0,T=T+1|0,L););if(v[(160+n|0)+(M<<3)>>3]=S,P=P-8|0,b=I-1|0,!(0<(0|I)))break}}if((0|C)<0)S=0;else for(T=C+1|0,b=(160+n|0)+(C<<3)|0,S=0;S+=v[b>>3],b=b-8|0,0<(0|(T=T-1|0)););v[m>>3]=z?-S:S,N=560+n|0,C=7&R,S=v[m>>3],(0|A)<=-1?(v[t>>3]=-S,C=0-C|0):v[t>>3]=S}return N=16+m|0,C}function fe(e){var t,n=0,i=0,o=0;N=t=N-16|0,h(e);e:if((n=2147483647&(o=r[2]))>>>0<=1061752794)n>>>0<964689920||(e=le(+e));else if(n>>>0<=1081824209)i=+e,e=n>>>0<=1075235811?(0|o)<=-1?x(-_e(i+1.5707963267948966)):_e(i+-1.5707963267948966):le(-(((0|o)<0?3.141592653589793:-3.141592653589793)+i));else if(n>>>0<=1088565717)i=+e,e=n>>>0<=1085271519?(0|o)<=-1?_e(i+4.71238898038469):x(-_e(i+-4.71238898038469)):le(((0|o)<0?6.283185307179586:-6.283185307179586)+i);else if(2139095040<=n>>>0)e=x(e-e);else if((n=3&he(e,8+t|0))>>>0<=2){switch(n-1|0){default:e=le(v[8+t>>3]);break e;case 0:e=_e(v[8+t>>3]);break e;case 1:}e=le(-v[8+t>>3])}else e=x(-_e(v[8+t>>3]));return N=16+t|0,e}function pe(e){var t,n,i=x(0),o=0,a=0;N=n=N-16|0,h(e);e:if((o=2147483647&(a=r[2]))>>>0<=1061752794)i=x(1),o>>>0<964689920||(i=_e(+e));else if(o>>>0<=1081824209)t=+e,i=1075235812<=o>>>0?x(-_e(((0|a)<0?3.141592653589793:-3.141592653589793)+t)):le((0|a)<=-1?1.5707963267948966+t:1.5707963267948966-t);else if(o>>>0<=1088565717)i=1085271520<=o>>>0?_e(+e+((0|a)<0?6.283185307179586:-6.283185307179586)):le((0|a)<=-1?-4.71238898038469-+e:+e-4.71238898038469);else if(i=x(e-e),!(2139095040<=o>>>0))if((o=3&he(e,8+n|0))>>>0<=2){switch(o-1|0){default:i=_e(v[8+n>>3]);break e;case 0:i=le(-v[8+n>>3]);break e;case 1:}i=x(-_e(v[8+n>>3]))}else i=le(v[8+n>>3]);return N=16+n|0,i}function de(e,t){var n,i,o=0,a=0,s=0,p=0,d=0,m=0,A=x(0);h(t),a=(m=(s=r[2])<<1)-1|0;e:{t:{n:{i:{h(e);o:{if((p=r[2])-8388608>>>0<=2130706431){if(4278190078<a>>>0)break o;break n}if(a>>>0<4278190079)break i}if(A=x(1),1065353216==(0|p))break t;if(!m)break t;if(o=p<<1,!(m>>>0<4278190081&&o>>>0<=4278190080))return x(e+t);if(2130706432==(0|o))break t;return x(((-1^s)>>>31|0)==(o>>>0<2130706432|0)?0:t*t)}if(4278190079<=(p<<1)-1>>>0){if(A=x(e*e),-1<(0|p)||23<(o=s>>>23&255)-127>>>0||(A=!((o=1<<150-o)&s)||s&o-1?A:x(-A)),-1<(0|s))break t;return x(x(1)/A)}if((0|p)<=-1){if((o=s>>>23&255)>>>0<127)break e;i:{if(o>>>0<=150){if(s&(a=1<<150-o)-1)break e;if(o=65536,a&s)break i}o=0}p&=2147483647}8388607<p>>>0||(p=(2147483647&(h(x(e*x(8388608))),r[2]))-192937984|0)}if(n=v[6672+(a=(m=p-1060306944|0)>>>15&240)>>3]*(l(2,p-(-8388608&m)|0),+f())-1,u(+(d=((v[867]+v[866]*n)*(d=n*n)*d+(d*(v[869]+v[868]*n)+(v[a+6680>>3]+ +(m>>23)+n*v[870])))*+t)),a=0|r[1],!(1079967744==(0|(a&=2147450880))|a>>>0<1079967744)){if(127.99999995700433<d)return x(x(o?-15845632502852868e13:15845632502852868e13)*x(15845632502852868e13));if(d<=-150)return x(x(o?-2524354896707238e-44:2524354896707238e-44)*x(2524354896707238e-44))}i=(n=d-((d+=n=v[903])-n))*n*(v[905]+v[904]*n)+n*v[906]+1,u(+d),m=o+(s=0|r[0])|0,o=c[(a=6968+((31&s)<<3)|0)>>2],a=c[a+4>>2]+(m<<=15)|0,l(0,0|o),l(1,0|(o>>>0<o>>>0?a+1|0:a)),A=x(i*+_())}return A}return e=x(e-e),x(e/e)}function me(e){var t,n=0,i=0,o=0,a=0;if(h(e),255==(0|(i=(t=r[2])>>>23&255)))return e=x(e*x(6.2831854820251465)),x(e/e);if(2173837238<(n=t<<1)>>>0){if(i)n=8388607&t|8388608;else{if((i=0)<=(0|(n=t<<9)))for(;i=i-1|0,-1<(0|(n<<=1)););n=t<<1-i}if(a=-1<(0|(o=n-13176795|0)),129<(0|i)){for(;;){if(1&a&&!(n=o))return x(e*x(0));if(a=-1<(0|(o=(n<<=1)-13176795|0)),!(129<(0|(i=i-1|0))))break}i=129}if(a&&!(n=o))return x(e*x(0));if(8388607<n>>>0)a=n;else for(;i=i-1|0,o=n>>>0<4194304,n=a=n<<1,o;);return l(2,(n=1<=(0|i)?a-8388608|i<<23:a>>>1-i|0)|(o=-2147483648&t)),f()}return-2121130058==(0|n)?x(e*x(0)):e}function Ae(){P()}function ve(e){V(e|=0)}function ge(e){var t=0;return c[(e|=0)>>2]=7508,(t=c[e+144>>2])&&p[e+148|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+144>>2]=0,c[e>>2]=7532,a[e+148|0]=1,c[(t=e+136|0)>>2]=0,c[t+4>>2]=0,(t=c[e+124>>2])&&p[e+128|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+124>>2]=0,a[e+128|0]=1,c[(t=e+116|0)>>2]=0,c[t+4>>2]=0,(t=c[e+104>>2])&&p[e+108|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+104>>2]=0,a[e+108|0]=1,c[(t=e+96|0)>>2]=0,c[t+4>>2]=0,(t=c[e+84>>2])&&p[e+88|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+84>>2]=0,a[e+88|0]=1,c[(t=e+76|0)>>2]=0,c[t+4>>2]=0,(t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+32>>2]=0,c[e>>2]=7328,a[e+36|0]=1,c[(t=e+24|0)>>2]=0,(c[t+4>>2]=0)|e}function xe(e,t,n){e|=0,t|=0,n|=0;var i=0,o=0,r=0,s=0,l=0,_=0,u=x(0),h=x(0),f=x(0),d=x(0),m=x(0);if(c[e+8>>2]=c[t>>2],(0|(i=c[e+24>>2]))==c[e+28>>2]&&!((0|(r=i?i<<1:1))<=(0|i))){if(r&&(c[5498]=c[5498]+1,(o=M(19+(r<<2)|0))&&(c[(s=o+19&-16)-4>>2]=o)),1<=(0|i))for(o=i;c[l+s>>2]=c[c[e+32>>2]+l>>2],l=l+4|0,o=o-1|0;);(o=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[o-4>>2]),i=c[e+24>>2]),c[e+32>>2]=s,c[e+28>>2]=r,a[e+36|0]=1}if(c[e+24>>2]=i+1,c[c[e+32>>2]+(i<<2)>>2]=c[t>>2],u=n?(m=A[t+16>>2],f=A[t+12>>2],h=A[t+8>>2],A[t+20>>2]):(d=A[t+8>>2],n=c[e+8>>2],h=A[t+12>>2],u=A[t+16>>2],m=x(x(x(d*A[n+36>>2])+x(h*A[n+40>>2]))+x(u*A[n+44>>2])),f=x(x(x(d*A[n+20>>2])+x(h*A[n+24>>2]))+x(u*A[n+28>>2])),h=x(x(x(A[n+4>>2]*d)+x(A[n+8>>2]*h))+x(A[n+12>>2]*u)),x(0)),(0|(o=c[e+76>>2]))==c[e+80>>2]&&!((0|(_=o?o<<1:1))<=(0|o))){if(n=0,_&&(c[5498]=c[5498]+1,(i=M(19+(_<<4)|0))&&(c[(n=i+19&-16)-4>>2]=i)),1<=(0|o))for(l=0;r=c[e+84>>2]+l|0,i=c[r+4>>2],c[(s=n+l|0)>>2]=c[r>>2],c[s+4>>2]=i,i=c[4+(r=r+8|0)>>2],c[(s=s+8|0)>>2]=c[r>>2],c[s+4>>2]=i,l=l+16|0,o=o-1|0;);(i=c[e+84>>2])&&p[e+88|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+84>>2]=n,c[e+80>>2]=_,a[e+88|0]=1,o=c[e+76>>2]}if(n=c[e+84>>2]+(o<<4)|0,A[n+12>>2]=u,A[n+8>>2]=m,A[n+4>>2]=f,A[n>>2]=h,c[e+76>>2]=c[e+76>>2]+1,f=A[t+24>>2],u=x(x(1)-f),d=x(x(u*A[e+48>>2])+x(f*A[e- -64>>2])),h=x(x(u*A[e+44>>2])+x(f*A[e+60>>2])),u=x(x(u*A[e+40>>2])+x(f*A[e+56>>2])),(0|(o=c[e+96>>2]))==c[e+100>>2]&&!((0|(_=o?o<<1:1))<=(0|o))){if(n=0,_&&(c[5498]=c[5498]+1,(i=M(19+(_<<4)|0))&&(c[(n=i+19&-16)-4>>2]=i)),1<=(0|o))for(l=0;r=c[e+104>>2]+l|0,i=c[r+4>>2],c[(s=n+l|0)>>2]=c[r>>2],c[s+4>>2]=i,i=c[4+(r=r+8|0)>>2],c[(s=s+8|0)>>2]=c[r>>2],c[s+4>>2]=i,l=l+16|0,o=o-1|0;);(i=c[e+104>>2])&&p[e+108|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+104>>2]=n,c[e+100>>2]=_,a[e+108|0]=1,o=c[e+96>>2]}if(n=c[e+104>>2]+(o<<4)|0,A[n+8>>2]=d,A[n+4>>2]=h,A[n>>2]=u,c[e+96>>2]=c[e+96>>2]+1,(0|(i=c[e+116>>2]))==c[e+120>>2]&&!((0|(_=i?i<<1:1))<=(0|i))){r=0,_&&(c[5498]=c[5498]+1,(n=M(19+(_<<2)|0))&&(c[(r=n+19&-16)-4>>2]=n)),n=c[e+124>>2];e:{if(1<=(0|i))for(l=r,o=n,s=i;A[l>>2]=A[o>>2],l=l+4|0,o=o+4|0,s=s-1|0;);else if(!n)break e;p[e+128|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2]),i=c[e+116>>2])}c[e+124>>2]=r,c[e+120>>2]=_,a[e+128|0]=1}return A[c[e+124>>2]+(i<<2)>>2]=A[t+24>>2],c[e+116>>2]=i+1,x(A[e+4>>2])}function ye(e){return 92+(e|=0)|0}function be(e){return 48+(e|=0)|0}function Se(e){return 0|e}function Ce(e){return c[204+(e|=0)>>2]}function Ee(e,t,n){n|=0;var i,o=0;return A[16+(t|=0)>>2]=A[4+(e|=0)>>2],A[t+20>>2]=A[e+8>>2],A[t+24>>2]=A[e+12>>2],A[t+28>>2]=A[e+16>>2],A[t+32>>2]=A[e+20>>2],A[t+36>>2]=A[e+24>>2],A[t+40>>2]=A[e+28>>2],A[t+44>>2]=A[e+32>>2],A[t+48>>2]=A[e+36>>2],A[t+52>>2]=A[e+40>>2],A[t+56>>2]=A[e+44>>2],A[t+60>>2]=A[e+48>>2],A[t+64>>2]=A[e+52>>2],A[t+68>>2]=A[e+56>>2],A[t+72>>2]=A[e+60>>2],A[t+76>>2]=A[e- -64>>2],A[t+80>>2]=A[e+68>>2],A[t+84>>2]=A[e+72>>2],A[t+88>>2]=A[e+76>>2],A[t+92>>2]=A[e+80>>2],A[t+96>>2]=A[e+84>>2],A[t+100>>2]=A[e+88>>2],A[t+104>>2]=A[e+92>>2],A[t+108>>2]=A[e+96>>2],A[t+112>>2]=A[e+100>>2],A[t+116>>2]=A[e+104>>2],A[t+120>>2]=A[e+108>>2],A[t+124>>2]=A[e+112>>2],A[t+128>>2]=A[e+116>>2],A[t+132>>2]=A[e+120>>2],A[t+136>>2]=A[e+124>>2],A[t+140>>2]=A[e+128>>2],A[t+144>>2]=A[e+132>>2],A[t+148>>2]=A[e+136>>2],A[t+152>>2]=A[e+140>>2],A[t+156>>2]=A[e+144>>2],A[t+160>>2]=A[e+148>>2],A[t+164>>2]=A[e+152>>2],A[t+168>>2]=A[e+156>>2],A[t+172>>2]=A[e+160>>2],A[t+176>>2]=A[e+164>>2],A[t+180>>2]=A[e+168>>2],A[t+184>>2]=A[e+172>>2],A[t+188>>2]=A[e+176>>2],c[t+232>>2]=c[e+180>>2],A[t+192>>2]=A[e+184>>2],o=(c[t>>2]=0)|pi[c[c[n>>2]+28>>2]](n,c[e+192>>2]),i=c[e+228>>2],c[t+196>>2]=c[e+224>>2],c[t+200>>2]=i,i=c[e+212>>2],c[t+240>>2]=c[e+208>>2],c[t+244>>2]=i,c[t+8>>2]=0,c[t+4>>2]=o,c[t+236>>2]=c[e+204>>2],c[t+248>>2]=c[e+220>>2],A[t+204>>2]=A[e+236>>2],A[t+208>>2]=A[e+244>>2],A[t+212>>2]=A[e+248>>2],A[t+216>>2]=A[e+232>>2],c[t+252>>2]=c[e+252>>2],o=0|pi[c[c[n>>2]+40>>2]](n,e),i=0|pi[c[c[n>>2]+28>>2]](n,o),(c[t+12>>2]=i)&&pi[c[c[n>>2]+48>>2]](n,o),A[t+220>>2]=A[e+268>>2],n=c[e+280>>2],o=c[e+276>>2],e=c[e+272>>2],c[t+260>>2]=0,c[t+224>>2]=e,c[t+228>>2]=o,c[t+256>>2]=n,7700}function Te(e){(e|=0)&&pi[c[c[e>>2]+4>>2]](e)}function Pe(e){return 4+(e|=0)|0}function we(e,t){pi[c[c[(e|=0)>>2]+8>>2]](e,t|=0)}function Ie(){return 12}function Re(e,t,n){e|=0,t|=0,n|=0;var i,o,a=x(0),r=x(0),s=x(0),l=x(0),_=x(0),u=0,h=0,f=x(0),p=0,d=x(0),m=x(0),v=0,g=x(0),y=x(0),b=x(0);N=o=N-48|0;e:{switch(c[t+4>>2]){case 8:c[e>>2]=0,c[e+4>>2]=0,c[(e=e+8|0)>>2]=0,c[e+4>>2]=0;break e;case 0:c[e+12>>2]=0,a=A[t+44>>2],A[e+8>>2]=A[n+8>>2]>=x(0)?a:x(-a),a=A[t+40>>2],A[e+4>>2]=A[n+4>>2]>=x(0)?a:x(-a),a=A[t+36>>2],A[e>>2]=A[n>>2]>=x(0)?a:x(-a);break e;case 1:c[e+12>>2]=0,a=A[n>>2],s=A[n+4>>2],r=A[n+8>>2],_=x(x(x(a*A[t+80>>2])+x(s*A[t+84>>2]))+x(r*A[t+88>>2])),l=x(x(x(a*A[t+96>>2])+x(s*A[t+100>>2]))+x(r*A[t+104>>2])),a=x(x(x(a*A[(n=t- -64|0)>>2])+x(s*A[t+68>>2]))+x(r*A[t+72>>2])),A[e+8>>2]=A[8+(t=((a<_?_<l?2:1:(a<l)<<1)<<4)+n|0)>>2],n=c[t+4>>2],c[e>>2]=c[t>>2],c[e+4>>2]=n;break e;case 13:v=c[4+(p=t+44|0)>>2],c[(u=40+o|0)>>2]=c[p>>2],c[u+4>>2]=v,p=c[4+(u=t+36|0)>>2],c[32+o>>2]=c[u>>2],c[36+o>>2]=p,c[28+o>>2]=0,A[16+o>>2]=A[n>>2],r=A[n+4>>2],A[20+o>>2]=r,a=A[n+8>>2],A[24+o>>2]=a;t:{n:{i:switch((t=c[t+60>>(u=2)])-(n=1)|0){case 1:break n;case 0:break i;default:break t}n=0,h=1;break t}n=0,h=2,u=1,a=r}r=A[(32+o|0)+(t<<2)>>2],_=A[((t=n<<2)|32+o)>>2],l=A[(t|16+o)>>2],(f=x(T(x(x(l*l)+x(a*a)))))==x(0)?(A[(n<<2|o)>>2]=_,A[(t=h<<2)+o>>2]=A[t+(16+o|0)>>2]<x(0)?x(-r):r):(s=x(_/f),A[(n<<2|o)>>2]=l*s,A[(t=h<<2)+o>>2]=A[t+(16+o|0)>>2]<x(0)?x(-r):r,s=x(a*s)),a=A[o>>2],A[(u<<2)+o>>2]=s,c[e+12>>2]=0,A[e>>2]=a,t=c[8+o>>2],c[e+4>>2]=c[4+o>>2],c[e+8>>2]=t;break e;case 10:u=c[t+60>>2],i=A[36+((h=u<<2)+t|0)>>2],a=x(1),s=A[n>>2],r=A[n+4>>2],_=A[n+8>>2],(l=x(x(x(s*s)+x(r*r))+x(_*_)))<x(14210854715202004e-30)||(a=x(x(1)/x(T(l))),g=x(_*a),y=x(r*a),a=x(s*a)),c[(t=40+o|0)>>2]=0,c[t+4>>2]=0,c[32+o>>2]=0,c[36+o>>2]=0,A[h+(32+o|0)>>2]=i,s=x(-0xde0b6b000000000),r=x(0),_=x(0),l=A[32+o>>2],f=A[36+o>>2],d=A[t>>2],(m=x(x(x(a*l)+x(y*f))+x(g*d)))>x(-0xde0b6b000000000)&&(r=f,_=d,b=l,s=m),c[t>>2]=0,c[t+4>>2]=0,c[32+o>>2]=0,c[36+o>>2]=0,A[(32+o|0)+(u<<2)>>2]=-i,l=A[t>>2],f=A[32+o>>2],d=A[36+o>>2],c[e+12>>2]=0,t=x(x(x(a*f)+x(y*d))+x(g*l))>s,A[e+8>>2]=t?l:_,A[e+4>>2]=t?d:r,A[e>>2]=t?f:b;break e;case 5:if(s=A[t+28>>2],r=A[t+24>>2],_=A[t+20>>2],u=c[t+100>>2],(0|(v=c[t+104>>2]))<1)h=-1;else for(l=x(A[n+8>>2]*s),f=x(A[n+4>>2]*r),d=x(A[n>>2]*_),n=0,h=-1,a=x(-34028234663852886e22),t=u;a=(p=a<(m=x(x(x(d*A[t>>2])+x(f*A[t+4>>2]))+x(l*A[t+8>>2]))))?m:a,h=p?n:h,t=t+16|0,(0|v)!=(0|(n=n+1|0)););c[e+12>>2]=0,A[e+8>>2]=s*A[8+(t=u+(h<<4)|0)>>2],A[e+4>>2]=r*A[t+4>>2],A[e>>2]=_*A[t>>2];break e;case 4:if(s=A[t+28>>2],r=A[t+24>>2],_=A[t+20>>2],u=c[t+112>>2],(0|(v=c[t+104>>2]))<1)h=-1;else for(l=x(A[n+8>>2]*s),f=x(A[n+4>>2]*r),d=x(A[n>>2]*_),n=0,h=-1,a=x(-34028234663852886e22),t=u;a=(p=a<(m=x(x(x(d*A[t>>2])+x(f*A[t+4>>2]))+x(l*A[t+8>>2]))))?m:a,h=p?n:h,t=t+16|0,(0|v)!=(0|(n=n+1|0)););c[e+12>>2]=0,A[e+8>>2]=s*A[8+(t=u+(h<<4)|0)>>2],A[e+4>>2]=r*A[t+4>>2],A[e>>2]=_*A[t>>2];break e}pi[c[c[t>>2]+68>>2]](e,t,n)}N=48+o|0}function De(e,t,n){e|=0,t|=0,n|=0;var i,o,a=x(0),r=x(0),s=x(0);pi[c[c[t>>2]+68>>2]](e,t,n),x(pi[c[c[t>>2]+48>>2]](t))!=x(0)&&(r=A[n+4>>2],a=A[n>>2],s=A[n+8>>2],i=x(pi[c[c[t>>2]+48>>2]](t)),o=a=(t=x(x(x(a*a)+x(r*r))+x(s*s))<x(14210854715202004e-30))?x(-1):a,s=t?x(-1):s,r=t?x(-1):r,a=x(x(1)/x(T(x(x(s*s)+x(x(a*a)+x(r*r)))))),A[e>>2]=A[e>>2]+x(i*x(o*a)),A[e+4>>2]=A[e+4>>2]+x(i*x(r*a)),A[e+8>>2]=A[e+8>>2]+x(i*x(s*a)))}function Ne(e){var t,n,i=0,o=0,r=0;if(c[(e|=0)>>2]=7868,(i=c[e+56>>2])&&p[e+60|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+56>>2]=0,a[e+60|0]=1,c[(i=e+48|0)>>2]=0,1<=((c[i+4>>2]=0)|(r=c[e+28>>2])))for(i=8;o=c[e+36>>2]+i|0,(n=c[(t=o+4|0)>>2])&&p[o+8|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[t>>2]=0,a[o+8|0]=1,c[(o=o-4|0)>>2]=0,i=i+36|(c[o+4>>2]=0),r=r-1|0;);return(i=c[e+36>>2])&&p[e+40|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+36>>2]=0,c[e+28>>2]=0,c[e+32>>2]=0,a[e+40|0]=1,(i=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+16>>2]=0,a[e+20|0]=1,c[(i=e+8|0)>>2]=0,(c[i+4>>2]=0)|e}function Oe(e){var t=x(0),n=x(0),i=x(0),o=0,a=0,r=0,s=0,l=c[e+28>>2];for(s=1;;){e:{t:switch(0|a){case 0:t=x(A[e+88>>2]+A[e+72>>2]),n=x(A[e+84>>2]+A[e+68>>2]),i=x(A[e+80>>2]+A[e+64>>2]);break e;case 1:t=x(A[e+72>>2]-A[e+88>>2]),n=x(A[e+84>>2]+A[e+68>>2]),i=x(A[e+80>>2]+A[e+64>>2]);break e;case 2:t=x(A[e+88>>2]+A[e+72>>2]),n=x(A[e+68>>2]-A[e+84>>2]),i=x(A[e+80>>2]+A[e+64>>2]);break e;case 3:t=x(A[e+72>>2]-A[e+88>>2]),n=x(A[e+68>>2]-A[e+84>>2]),i=x(A[e+80>>2]+A[e+64>>2]);break e;case 4:t=x(A[e+88>>2]+A[e+72>>2]),n=x(A[e+84>>2]+A[e+68>>2]),i=x(A[e+64>>2]-A[e+80>>2]);break e;case 5:t=x(A[e+72>>2]-A[e+88>>2]),n=x(A[e+84>>2]+A[e+68>>2]),i=x(A[e+64>>2]-A[e+80>>2]);break e;case 6:t=x(A[e+88>>2]+A[e+72>>2]),n=x(A[e+68>>2]-A[e+84>>2]),i=x(A[e+64>>2]-A[e+80>>2]);break e;case 7:break t;default:break e}t=x(A[e+72>>2]-A[e+88>>2]),n=x(A[e+68>>2]-A[e+84>>2]),i=x(A[e+64>>2]-A[e+80>>2])}e:{if(1<=(0|l))for(o=c[e+36>>2]+32|0,r=l;;){if(x(A[o>>2]+x(x(x(i*A[o-12>>2])+x(n*A[o-8>>2]))+x(t*A[o-4>>2])))>x(0))break e;if(o=o+36|0,!(r=r-1|0))break}if(s=a>>>0<7,8!=(0|(a=a+1|0)))continue}break}return 1&(-1^s)}function Me(e){var t,n,i,o,r,l,_,u,h,f,m,v,b,S,C,E,P,w,I,R,D=0,N=0,O=0,L=0,F=0,k=x(0),U=0,G=0,j=x(0),V=x(0),H=0,W=x(0),q=x(0),Y=0,X=x(0),Q=0,Z=0,J=0,K=x(0),$=0,ee=0,te=x(0),ne=0,ie=0,oe=0,ae=x(0),re=0,se=x(0),ce=0,le=0,_e=0,ue=0;c[e+64>>2]=0,c[e+68>>2]=0,c[(N=e+72|0)>>2]=0;e:{if(!(((c[N+4>>2]=0)|(Q=c[e+28>>2]))<1)){for(;;){if(D=c[e+36>>2],l=g(ce,36),1<=(0|(_=c[4+(D+l|0)>>2]))){for(o=-65536|ce,le=0;;){N=c[12+(D+l|0)>>2],m=Z>>>0<=(Q=(f=(n=(F=(0|(O=s[N+(le<<2)>>1]))<(0|(G=s[N+(((u=(0|_)==(0|(le=le+1|0)))?0:le)<<2)>>1])))?G:O)+(h=(ee=F?O:G)<<16)|0)&U-1)>>>0,O=0;t:if(!m&&-1!=((O=0)|(D=c[(Q<<2)+J>>2]))){n:{for(;;){if(d[2+(O=(N=D<<2)+H|0)>>1]==(65535&ee)&&d[O>>1]==(65535&n))break n;if(-1==(0|(D=c[N+Y>>2])))break}O=0;break t}O=N+L|0}G=c[e+16>>2],k=x(A[8+(N=G+(ee<<4)|0)>>2]-A[8+(G=G+(n<<4)|0)>>2]),V=x(A[N>>2]-A[G>>2]),j=x(A[N+4>>2]-A[G+4>>2]),W=x(x(1)/x(T(x(x(x(V*V)+x(j*j))+x(k*k))))),k=x(k*W),j=x(j*W),V=x(V*W);t:{if(!(ne=(0|(N=c[e+48>>2]))<1))for(D=c[e+56>>2],F=N;;){if(W=A[D+8>>2],X=A[D+4>>2],K=A[D>>2],!(1e-6<+x(y(x(K-V)))||1e-6<+x(y(x(X-j)))||1e-6<+x(y(x(W-k)))))break t;if(!(1e-6<+x(y(x(V+K)))||1e-6<+x(y(x(j+X)))||1e-6<+x(y(x(k+W)))))break t;if(D=D+16|0,!(F=F-1|0))break}if(c[e+52>>2]==(0|N)&&!((0|(F=N?N<<1:1))<=(0|N))){if(G=0,F&&(c[5498]=c[5498]+1,(D=M(19+(F<<4)|0))&&(c[(G=D+19&-16)-4>>2]=D)),!ne)for(D=0;ne=c[e+56>>2]+D|0,r=c[ne+4>>2],c[(t=D+G|0)>>2]=c[ne>>2],c[4+t>>2]=r,r=c[4+(ne=ne+8|0)>>2],c[(t=8+t|0)>>2]=c[ne>>2],c[4+t>>2]=r,D=D+16|0,N=N-1|0;);(N=c[e+56>>2])&&p[e+60|0]&&(c[5499]=c[5499]+1,z(c[N-4>>2])),c[e+56>>2]=G,a[e+60|0]=1,c[e+52>>2]=F,N=c[e+48>>2]}N=c[e+56>>2]+(N<<4)|0,c[N+12>>2]=0,A[N+8>>2]=k,A[N+4>>2]=j,A[N>>2]=V,c[e+48>>2]=c[e+48>>2]+1}t:{if(O)s[O+2>>1]=ce;else{n:{if(!m&&-1!=(0|(D=c[(Q<<2)+J>>2])))for(;;){if(d[2+(O=(N=D<<2)+H|0)>>1]==(65535&ee)&&d[O>>1]==(65535&n))break n;if(-1==(0|(D=c[N+Y>>2])))break}if((0|U)==(0|ie)){i:if((0|(O=U?U<<1:1))<=(0|U))G=L,O=U;else{if(G=0,O&&(c[5498]=c[5498]+1,(N=M(19+(O<<2)|0))&&(c[(G=N+19&-16)-4>>2]=N)),1<=(0|U))for(D=G,F=L,N=U;ee=d[F>>1]|d[F+2>>1]<<16,s[D>>1]=ee,s[D+2>>1]=ee>>>16,D=D+4|0,F=F+4|0,N=N-1|0;);else if(!L)break i;c[5499]=c[5499]+1,z(c[L-4>>2])}L=U}else G=L,O=U,L=ie;s[(L=(L<<2)+G|0)>>1]=o,s[L+2>>1]=o>>>16;i:if((0|$)==(0|re))if((0|(re=$?$<<1:1))<=(0|$))re=$,N=H;else{if(N=0,re&&(c[5498]=c[5498]+1,(L=M(19+(re<<2)|0))&&(c[(N=L+19&-16)-4>>2]=L)),1<=(0|$))for(D=N,F=H,L=$;ee=d[F>>1]|d[F+2>>1]<<16,s[D>>1]=ee,s[D+2>>1]=ee>>>16,D=D+4|0,F=F+4|0,L=L-1|0;);else if(!H)break i;c[5499]=c[5499]+1,z(c[H-4>>2])}else N=H;if(s[(L=($<<2)+N|0)>>1]=H=65535&n|h,s[L+2>>1]=H>>>16,$=$+1|0,(0|U)<(0|O)&&(Q=O-1&f,(0|Z)<(0|O))){if((0|O)<=(0|_e))H=J;else{H=0,O&&(c[5498]=c[5498]+1,(L=M(19+(O<<2)|0))&&(c[(H=L+19&-16)-4>>2]=L));i:{if(1<=(0|Z))for(D=H,F=J,U=Z;c[D>>2]=c[F>>2],D=D+4|0,F=F+4|0,U=U-1|0;);else if(!J)break i;c[5499]=c[5499]+1,z(c[J-4>>2])}_e=O}if(B((Z<<2)+H|0,0,O-Z<<2),J=O<<2,(0|O)<=(0|oe))L=Y;else{if((0|O)<=(0|ue))L=Y;else{L=0,O&&(c[5498]=c[5498]+1,(U=M(16+(3|J)|0))&&(c[(L=U+19&-16)-4>>2]=U));i:{if(1<=(0|oe))for(D=L,F=Y,U=oe;c[D>>2]=c[F>>2],D=D+4|0,F=F+4|0,U=U-1|0;);else if(!Y)break i;c[5499]=c[5499]+1,z(c[Y-4>>2])}ue=O}B((oe<<2)+L|0,0,O-oe<<2)}if(1<=(0|O)&&(B(H,255,J),B(L,255,J)),1<=(0|Z))for(U=O-1|0,F=D=0;Y=((U&(d[2+(Y=D+N|0)>>1]<<16)+s[Y>>1])<<2)+H|0,c[D+L>>2]=c[Y>>2],D=D+4|0,(0|Z)!=(0|(F=(c[Y>>2]=F)+1|0)););J=H,Z=oe=O,Y=L}c[(ie<<2)+Y>>2]=c[(L=(Q<<2)+J|0)>>2],ie=(c[L>>2]=ie)+1|0;break t}s[(N=N+L|0)>>1]=o,s[N+2>>1]=o>>>16}G=L,O=U,N=H}if(u)break;D=c[e+36>>2],L=G,U=O,H=N}Q=c[e+28>>2],U=O,H=N,L=G}if(!((0|(ce=ce+1|0))<(0|Q)))break}if(!((0|Q)<1)){for(U=c[e+16>>2],$=c[e+36>>2],Z=0;;){if(O=$+g(Z,36)|0,3<=(0|(N=c[O+4>>2])))for(D=(O=c[O+12>>2])+4|0,re=8+(G=U+(c[O>>2]<<4)|0)|0,_e=G+4|0,V=A[e+72>>2],W=A[e+68>>2],X=A[e+64>>2],F=2;ie=U+(c[D>>2]<<4)|0,k=A[ie+8>>2],oe=U+(c[O+((0|F)%(0|N)<<2)>>2]<<4)|0,j=A[oe+8>>2],K=A[G>>2],v=A[ie>>2],b=x(K-v),q=A[_e>>2],S=A[oe+4>>2],i=x(q-S),C=A[ie+4>>2],te=x(q-C),E=A[oe>>2],P=x(K-E),se=x(x(b*i)-x(te*P)),R=te,te=A[re>>2],w=x(te-j),I=x(te-k),i=x(x(R*w)-x(I*i)),j=x(x(x(te+k)+j)*x(.3333333432674408)),k=x(x(I*P)-x(b*w)),k=x(x(T(x(x(se*se)+x(x(i*i)+x(k*k)))))*x(.5)),V=x(V+x(j*k)),A[e+72>>2]=V,W=x(W+x(x(x(S+x(q+C))*x(.3333333432674408))*k)),A[e+68>>2]=W,X=x(X+x(x(x(E+x(K+v))*x(.3333333432674408))*k)),A[e+64>>2]=X,ae=x(ae+k),D=D+4|0,(0|N)!=(0|(F=F+1|0)););if((0|Q)==(0|(Z=Z+(D=1)|0)))break}break e}}D=0}if(c[e+96>>2]=2139095039,k=x(x(1)/ae),V=x(k*A[e+64>>2]),A[e+64>>2]=V,W=x(k*A[e+68>>2]),A[e+68>>2]=W,X=x(k*A[e+72>>2]),A[e+72>>2]=X,K=x(34028234663852886e22),j=x(34028234663852886e22),D)for(D=c[e+36>>2]+32|0;(k=x(y(x(A[D>>2]+x(x(x(V*A[D-12>>2])+x(A[D-8>>2]*W))+x(A[D-4>>2]*X))))))<j&&(j=A[e+96>>2]=k),D=D+36|0,Q=Q-1|0;);if((0|(F=c[e+8>>2]))<1)k=x(-34028234663852886e22),V=x(34028234663852886e22),W=x(-34028234663852886e22),X=x(-34028234663852886e22),ae=x(34028234663852886e22);else for(D=c[e+16>>2],X=x(-34028234663852886e22),ae=x(34028234663852886e22),W=x(-34028234663852886e22),k=x(-34028234663852886e22),V=x(34028234663852886e22);X=X<(q=A[D+8>>2])?q:X,V=q<V?q:V,W=W<(q=A[D+4>>2])?q:W,K=q<K?q:K,k=k<(q=A[D>>2])?q:k,ae=q<ae?q:ae,D=D+16|0,F=F-1|0;);c[e+128>>2]=0,q=x(X-V),A[e+124>>2]=q,se=x(W-K),A[e+120>>2]=se,te=x(k-ae),A[e+116>>2]=te,j=x(j/x(1.7320507764816284)),A[e+88>>2]=j,c[e+112>>2]=0,A[e+108>>2]=V+X,A[e+104>>2]=K+W,A[e+100>>2]=k+ae,A[e+84>>2]=j,A[e+80>>2]=j,O=(N=(U=te<se?se<q?2:1:(te<q)<<1)<<2)+(e+80|0)|0,k=x(A[N+(e+116|0)>>2]*x(.5)),A[O>>2]=k,V=x(x(k-j)*x(.0009765625)),D=1024;e:{t:{for(;;){if(Oe(e))break t;if(k=x(k-V),A[O>>2]=k,!(D=D-1|0))break}A[e+84>>2]=j,A[e+88>>2]=j,A[e+80>>2]=j;break e}for(U=(O=e+80|0)+((N=1<<U&3)<<2)|0,k=A[(O=O+((1<<N&3)<<2)|0)>>2],V=x(x(A[e+96>>2]-j)*x(.0009765625)),N=1024;;){if(W=A[U>>2],A[U>>2]=V+W,j=x(V+A[O>>2]),A[O>>2]=j,Oe(e)){if(k=j,N=N-1|0)continue;break e}break}A[U>>2]=W,A[O>>2]=k}H&&(c[5499]=c[5499]+1,z(c[H-4>>2])),L&&(c[5499]=c[5499]+1,z(c[L-4>>2])),Y&&(c[5499]=c[5499]+1,z(c[Y-4>>2])),J&&(c[5499]=c[5499]+1,z(c[J-4>>2]))}function ze(e,t,n,i,o,a,r){var s,l,_,u,h=x(0),f=x(0),p=0,d=0;if(c[i>>2]=2139095039,c[o>>2]=-8388609,d=c[e+(p=8)>>2],h=x(-34028234663852886e22),!((0|d)<1)){for(;s=c[e+16>>2]+p|0,h=A[s-8>>2],f=A[s-4>>2],l=A[s>>2],_=x(x(x(x(h*A[t>>2])+x(f*A[t+4>>2]))+x(l*A[t+8>>2]))+A[t+48>>2]),u=x(x(x(x(h*A[t+16>>2])+x(f*A[t+20>>2]))+x(l*A[t+24>>2]))+A[t+52>>2]),f=x(x(x(x(h*A[t+32>>2])+x(f*A[t+36>>2]))+x(l*A[t+40>>2]))+A[t+56>>2]),(h=x(x(x(_*A[n>>2])+x(u*A[n+4>>2]))+x(f*A[n+8>>2])))<A[i>>2]&&(A[i>>2]=h,c[a+12>>2]=0,A[a+8>>2]=f,A[a+4>>2]=u,A[a>>2]=_),h>A[o>>2]&&(A[o>>2]=h,c[r+12>>2]=0,A[r+8>>2]=f,A[r+4>>2]=u,A[r>>2]=_),p=p+16|0,d=d-1|0;);h=A[o>>2]}h<(f=A[i>>2])&&(A[i>>2]=h,A[o>>2]=f,n=c[(e=a+8|0)>>2],i=c[e+4>>2],p=c[4+(t=r+8|0)>>2],c[e>>2]=c[t>>2],c[e+4>>2]=p,e=c[a>>2],o=c[a+4>>2],p=c[r+4>>2],c[a>>2]=c[r>>2],c[a+4>>2]=p,c[r>>2]=e,c[r+4>>2]=o,c[t>>2]=n,c[t+4>>2]=i)}function Le(e,t,n,i,o,a){var r,s,l,_,u,h,f=0,p=0;return(0|(f=c[a+16>>2]))!=(0|o)?o-f|0:o?(_=c[a+8>>2],s=ui(r=c[a+12>>2],f=0,u=e,0),e=O,p=t,l=ui(r,t=0,p,t),f=O,f=(r=e+l|0)>>>0<l>>>0?f+1|0:f,t=ui(p,0,_,0),e=f,f=e=(r=O+r|0)>>>0<O>>>0?e+1|0:e,f=(r=r+(e=(s=t+s|0)>>>0<t>>>0)|0)>>>0<e>>>0?f+1|0:f,p=r,e=s,s=ui(_,0,u,0),e=(t=e)+O|0,h=_=0+s|0,s=(u=t=p+(e=(0|t)==(0|(r=e=_>>>0<s>>>0?e+1|0:e))&0|e>>>0<t>>>0)|0)>>>0<e>>>0?f+1|0:f,e=c[a+4>>2],a=c[a>>2],n=ui(e,f=0,_=n,0),p=O,t=ui(e,0,i,0),e=O,e=(p=p+t|0)>>>0<t>>>0?e+1|0:e,t=ui(i,0,a,0),i=(f=p=(i=O)+p|0)>>>0<i>>>0?e+1|0:e,p=p+(f=e=(n=t+n|0)>>>0<t>>>0)|0,e=i,f=(i=p)>>>0<f>>>0?e+1|0:e,p=-1,l=i,e=n,n=ui(a,i=0,_,0),e=(t=e)+O|0,g(o,p=(0|(f=(n=l+(t=(e=(a=i+n|0)>>>0<n>>>0?e+1|0:e)>>>0<t>>>0)|0)>>>0<t>>>0?f+1|0:f))==(0|s)&u>>>0<(t=n)>>>0|s>>>0<f>>>0?p:(0|f)==(0|s)&n>>>0<u>>>0|f>>>0<s>>>0?1:(0|e)==(0|r)&h>>>0<a>>>0|r>>>0<e>>>0?-1:(0|e)==(0|r)&a>>>0<h>>>0|e>>>0<r>>>0)):0}function Fe(e,t,n){var i=0,o=0,a=0,r=0,s=0,l=0;if(!((r=c[e+56>>2])||((i=c[e+52>>2])?c[e+52>>2]=c[i+8>>2]:(a=c[5498],i=r=0,(o=M(31))&&(c[(i=o+19&-16)-4>>2]=o),c[i+8>>2]=0,c[5498]=a+2,o=c[e+60>>2],c[i+4>>2]=o,(o=M(g(o,24)+19|0))&&(c[(r=o+19&-16)-4>>2]=o),c[i>>2]=r,r=c[e+48>>2],c[e+48>>2]=i,c[i+8>>2]=r),r=c[i>>2],(0|(o=c[i+4>>2]))<1||(i=r+24|0,c[r>>2]=(a=1==(0|o))?0:i,a))))for(a=1;i=(l=i)+24|0,c[l>>2]=(0|(a=a+1|0))<(0|o)?i:0,(0|o)!=(0|a););if(c[e+56>>2]=c[r>>2],c[(i=r+8|0)>>2]=0,c[i+4>>2]=0,c[(i=r+16|0)>>2]=0,c[i+4>>2]=0,c[r>>2]=0,c[r+4>>2]=0,!((o=c[e+56>>2])||((i=c[e+52>>2])?c[e+52>>2]=c[i+8>>2]:(s=c[5498],i=a=0,(o=M(31))&&(c[(i=o+19&-16)-4>>2]=o),c[i+8>>2]=0,c[5498]=s+2,o=c[e+60>>2],c[i+4>>2]=o,(o=M(g(o,24)+19|0))&&(c[(a=o+19&-16)-4>>2]=o),c[i>>2]=a,o=c[e+48>>2],c[e+48>>2]=i,c[i+8>>2]=o),o=c[i>>2],(0|(s=c[i+4>>2]))<1||(i=o+24|0,c[o>>2]=(a=1==(0|s))?0:i,a))))for(a=1;i=(l=i)+24|0,c[l>>2]=(0|(a=a+1|0))<(0|s)?i:0,(0|a)!=(0|s););return c[e+56>>2]=c[o>>2],c[(i=o+8|0)>>2]=0,c[i+4>>2]=0,c[(a=o+16|0)>>2]=0,c[a+4>>2]=0,c[o>>2]=0,c[o+4>>2]=0,c[r+8>>2]=o,c[r+12>>2]=n,c[r+16>>2]=0,n=c[e+100>>2],c[r+20>>2]=n,c[i>>2]=r,c[o+12>>2]=t,c[a>>2]=0,c[o+20>>2]=n,t=c[e+116>>2],c[e+116>>2]=n=t+1|0,(0|t)>=c[e+120>>2]&&(c[e+120>>2]=n),r}function Be(e,t,n,i,o,a,r,s){var l,_,u,h,f,p,d,m=0;return m=c[e+4>>2],c[e>>2]==(0|t)?e=(0|t)==(0|m)?(m=c[t+12>>2],t=c[c[t+8>>2]+12>>2],u=c[t+96>>2],p=c[m+96>>2]-u|0,e=c[e+12>>2],l=c[t+92>>2],d=c[e+92>>2]-l|0,l=c[m+92>>2]-l|0,u=c[e+96>>2]-u|0,_=ui(_=g(p,d)-g(l,u)|0,_>>31,_=g(o,r)-g(i,s)|0,_>>31),f=O,h=l,l=c[e+88>>2],e=c[t+88>>2],m=c[m+88>>2]-e|0,i=ui(t=e=g(h,l=l-e|0)-g(m,d)|0,e>>31,e=g(i,a)-g(n,r)|0,e>>31),e=O+f|0,e=(t=i+_|0)>>>0<i>>>0?e+1|0:e,i=t,n=ui(r=t=g(m,u)-g(l,p)|0,t>>31,t=g(n,s)-g(o,a)|0,t>>31),e=O+e|0,(e=0<(0|(e=(t=i+n|0)>>>0<n>>>0?e+1|0:e))?1:0<=(0|e)?t:0)?2:1):2:(0|t)==(0|m)}function ke(e,t,n,i,o){var a,r,s,l,_,u,h,f,p,d,m,A,v,x,y,b=0,S=0,C=0,E=0,T=0,P=0,w=0,I=0,R=0,D=0,M=0,z=0,L=0,F=0,B=0,k=0,U=0,G=0,j=0,V=0,H=0,W=0,q=0,Y=0,X=N-32|0;if(N=X,L=c[o>>2],G=t,(q=c[i>>2])&&(G=c[q+12>>2]),H=c[G+96>>2],B=c[t+96>>2],h=c[(E=n)+96>>2]-B|0,w=c[(q||L)+12>>2],k=c[t+92>>2],D=c[w+92>>2]-k|0,f=c[n+92>>2]-k|0,I=c[w+96>>2]-B|0,n=ui(v=n=g(h,D)-g(f,I)|0,d=n>>31,h,C=h>>31),T=O,S=c[t+88>>2],b=c[w+88>>2]-S|0,p=c[E+88>>2]-S|0,t=ui(x=t=g(b,f)-g(D,p)|0,m=t>>31,p,R=p>>31),n=ui(a=n-t|0,r=T-(O+(n>>>0<t>>>0)|0)|0,t=W=c[G+92>>2],t>>31),w=O,t=ui(x,m,f,D=f>>31),T=O,F=n,n=ui(y=n=g(I,p)-g(b,h)|0,A=n>>31,h,C),t=ui(s=t-n|0,l=T-(O+(t>>>0<n>>>0)|0)|0,t=G=c[G+88>>2],t>>31),b=O+w|0,b=(n=F+t|0)>>>0<t>>>0?b+1|0:b,t=ui(p,R,y,A),T=O,C=n,n=ui(f,D,v,d),t=ui(_=t-n|0,u=T-(O+(t>>>0<n>>>0)|0)|0,H,H>>31),b=O+b|0,T=(D=n=C+t|0)>>>0<t>>>0?b+1|0:b,t=ui(v,d,S,S>>31),n=O,C=t,t=ui(x,m,B,B>>31),b=O+n|0,b=(w=C+t|0)>>>0<t>>>0?b+1|0:b,n=ui(y,A,k,k>>31),t=O+b|0,w=(R=w=n+w|0)>>>0<n>>>0?t+1|0:t,E=L?c[L+12>>2]:E,Y=c[E+96>>2],B=c[E+92>>2],k=c[E+88>>2],n=L,q&&c[q+12>>2]&&(t=c[c[q+8>>2]+4>>2],V=c[t+12>>2],b=ui(I=n=c[V+92>>2],C=n>>31,y,A),E=O,n=L,P=b,S=ui(F=b=c[V+88>>2],z=b>>31,v,d),b=O+E|0,b=(P=P+S|0)>>>0<S>>>0?b+1|0:b,S=ui(j=S=c[V+96>>2],M=S>>31,x,m),b=O+b|0,!(b=(0|(b=(E=S+P|0)>>>0<S>>>0?b+1|0:b))<(0|(S=w))?1:(0|b)<=(0|S)?E>>>0<R>>>0:0))){for(E=t+12|0;c[t+20>>2]!=(0|e)&&(n=ui(I,C,a,r),b=O,C=n,n=ui(F,z,s,l),b=O+b|0,b=(C=C+n|0)>>>0<n>>>0?b+1|0:b,n=ui(j,M,_,u),b=O+b|0,!((0|(n=b=(C=n+C|0)>>>0<n>>>0?b+1|0:b))<(0|T)||(0|b)<=(0|T)&&C>>>0<=D>>>0)&&(c[i>>2]=t,T=c[E>>2],H=c[T+96>>2],W=c[T+92>>2],G=c[T+88>>2],E=(t=c[c[t+8>>2]+4>>2])+12|0,D=C,T=n,P=c[t+12>>2],n=ui(I=n=c[P+92>>2],C=n>>31,y,A),b=O,S=n,n=ui(F=n=c[P+88>>2],z=n>>31,v,d),b=O+b|0,b=(S=S+n|0)>>>0<n>>>0?b+1|0:b,n=ui(j=n=c[P+96>>2],M=n>>31,x,m),b=O+b|0,b=(S=n+S|0)>>>0<n>>>0?b+1|0:b,n=S,(0|w)<(0|b)||(0|w)<=(0|b)&&R>>>0<=n>>>0)););n=c[o>>2]}t=ui(a,r,B,B>>31),b=O,C=t,t=ui(s,l,k,k>>31),b=O+b|0,b=(C=C+t|0)>>>0<t>>>0?b+1|0:b,t=ui(_,u,Y,Y>>31),b=O+b|0,C=(I=C=t+C|0)>>>0<t>>>0?b+1|0:b;e:if(n){if(c[n+12>>2]&&(E=c[c[n+8>>2]>>2],P=c[E+12>>2],t=ui(F=t=c[P+92>>2],z=t>>31,y,A),b=O,S=t,t=ui(j=t=c[P+88>>2],M=t>>31,v,d),b=O+b|0,b=(S=S+t|0)>>>0<t>>>0?b+1|0:b,t=ui(U=t=c[P+96>>2],P=t>>31,x,m),b=O+b|0,b=(S=t+S|0)>>>0<t>>>0?b+1|0:b,t=S,!((0|b)<(0|w)||(0|b)<=(0|w)&&t>>>0<R>>>0)))for(V=E+12|0;;){if(c[(S=E)+20>>2]==(0|e))break e;if(b=ui(F,z,a,r),t=O,E=b,b=ui(j,M,s,l),t=O+t|0,t=(E=E+b|0)>>>0<b>>>0?t+1|0:t,P=(b=E)+(E=ui(_,u,U,P))|0,b=O+t|0,b=P>>>0<E>>>0?b+1|0:b,P=t=P,E=(0|(E=b))<(0|C)?1:(0|E)<=(0|C)?P>>>0<=I>>>0:0)break e;if(c[o>>2]=S,n=c[V>>2],Y=c[n+96>>2],B=c[n+92>>2],k=c[n+88>>2],V=(E=c[c[S+8>>2]>>2])+12|0,I=t,C=b,n=S,P=c[E+12>>2],t=ui(F=t=c[P+92>>2],z=t>>31,y,A),b=O,S=t,t=ui(j=t=c[P+88>>2],M=t>>31,v,d),b=O+b|0,b=(S=S+t|0)>>>0<t>>>0?b+1|0:b,t=ui(U=t=c[P+96>>2],P=t>>31,x,m),b=O+b|0,b=(S=t+S|0)>>>0<t>>>0?b+1|0:b,t=S,!((0|w)<(0|b)||(0|w)<=(0|b)&&R>>>0<=t>>>0))break}}else n=0;e:{if(T=C-((I>>>0<D>>>0)+T|0)|0,t=D=I-D|0,t=0<(0|T)?1:0<=(0|T)?1<=t>>>0:0)for(;;){for(t=c[i>>2];;){t:if(z=(w=n=F=(g(B-W|0,f)+g(k-G|0,p)|0)+g(Y-H|0,h)|0)>>31,t&&c[t+12>>2]&&(M=c[c[t>>2]+8>>2],!(c[M+20>>2]<=(0|e)))){n=c[M+12>>2],I=c[n+92>>2],S=(C=c[n+88>>2])-G|0,E=(R=c[n+96>>2])-H|0,n=(g(b=I-W|0,f)+g(S,p)|0)+g(E,h)|0,L=ui(a,r,b,b>>31),b=O,P=L,L=ui(s,l,S,S>>31),b=O+b|0,b=(S=P+L|0)>>>0<L>>>0?b+1|0:b,L=ui(_,u,E,E>>31),b=O+b|0;n:{if(!((S=L+S|0)|(L=b=S>>>0<L>>>0?b+1|0:b))){if((0|n)<0)break n;break t}if(-1<(0|L))break t;if(j=0<(0|n),V=n>>>31|0,P=(b=(0|n)<0)?0-n|0:0,U=n>>31,E=b?0-(U+(0!=(0|n))|0)|0:0,b=1<=(0|F)?(c[8+X>>2]=w,c[12+X>>2]=z,-(c[24+X>>2]=1)):(0|F)<=-1?(c[24+X>>2]=-1,c[8+X>>2]=0-w,c[12+X>>2]=0-((0!=(0|w))+z|0),1):(c[8+X>>2]=0,c[12+X>>2]=0,c[24+X>>2]=0),V=j?-1:V,P=j?n:P,E=j?U:E,S=0-(n=S)|0,L=0-((0!=(0|n))+L|0)|0,n=D,(j=0<(0|(U=T))?1:0<=(0|T)?D:0)||-1<((U=n=0)|T)||(c[24+X>>2]=b,n=0-D|0,U=0-((0!=(0|D))+T|0)|0),c[16+X>>2]=n,c[20+X>>2]=U,(0|Le(P,E,S,L,V,8+X|0))<=-1)break t}c[i>>2]=t=(0|t)==(0|q)?0:M,n=ui(a,r,n=B-I|0,n>>31),T=O,D=(b=n)+(n=ui(s,l,n=k-C|0,n>>31))|0,b=O+T|0,b=D>>>0<n>>>0?b+1|0:b,n=ui(_,u,n=Y-R|0,n>>31),b=O+b|0,T=(D=T=n+D|0)>>>0<n>>>0?b+1|0:b,G=C,W=I,H=R;continue}break}if(!(t=c[o>>2]))break e;if(!c[t+12>>2])break e;if(M=c[c[t+8>>2]>>2],c[M+20>>2]<=(0|e))break e;if(I=c[M+12>>2],t=ui(P=t=V=(U=c[I+92>>2])-B|0,B=t>>31,y,A),R=O,C=t,n=ui(E=t=k=(b=c[I+88>>2])-k|0,S=t>>31,v,d),t=O+R|0,t=(C=C+n|0)>>>0<n>>>0?t+1|0:t,t=(0|(j=C))!=(0-(n=ui(x,m,L=n=R=(C=c[I+96>>2])-Y|0,I=n>>31))|0)?1:(0-(O+(0!=(0|n))|0)|0)!=(0|t))break e;if(t=ui(a,r,t=U-W|0,t>>31),n=O,U=t,t=ui(s,l,t=b-G|0,t>>31),b=O+n|0,b=(Y=U+t|0)>>>0<t>>>0?b+1|0:b,t=ui(_,u,t=C-H|0,t>>31),b=O+b|0,b=(n=t+Y|0)>>>0<t>>>0?b+1|0:b,t=n,C=(0|(n=b))<0?1:(0|n)<=0?t>>>0<1:0)break e;R=(g(V,f)+g(k,p)|0)+g(R,h)|0,C=ui(P,B,a,r),b=O,P=C,C=ui(E,S,s,l),b=O+b|0,b=(S=P+C|0)>>>0<C>>>0?b+1|0:b,C=ui(_,u,L,I),b=O+b|0;t:{if(!((I=C+S|0)|(C=b=I>>>0<C>>>0?b+1|0:b))){if((0|R)<0)break t;break e}if(-1<(0|C))break e;if(B=0<(0|R),E=R>>>31|0,S=(R=(0|(b=R))<0)?0-b|0:0,k=b>>31,L=R?0-(k+(0!=(0|b))|0)|0:0,R=1<=(0|F)?(c[8+X>>2]=w,c[12+X>>2]=z,-(c[24+X>>2]=1)):(0|F)<=-1?(c[24+X>>2]=-1,c[8+X>>2]=0-w,c[12+X>>2]=0-((0!=(0|w))+z|0),1):(c[8+X>>2]=0,c[12+X>>2]=0,c[24+X>>2]=0),E=B?-1:E,S=B?b:S,L=B?k:L,I=0-(w=I)|0,b=0-((0!=(0|w))+C|0)|0,C=w=T,T=D,(F=0<(0|C)?1:0<=(0|w)?T:0)||-1<((C=D=0)|w)||(c[24+X>>2]=R,D=0-T|0,C=0-((0!=(0|T))+w|0)|0),c[16+X>>2]=D,c[20+X>>2]=C,(0|Le(S,L,I,b,E,8+X|0))<=0)break e}c[o>>2]=M,T=c[M+12>>2],Y=c[T+96>>2],B=c[T+92>>2],k=c[T+88>>2],D=t,T=n}if(!(-1<(0|T)))for(;;){F=(w=t=q=(g(B-W|0,f)+g(k-G|0,p)|0)+g(Y-H|0,h)|0)>>31;t:if(n&&c[n+12>>2]&&(j=c[c[n+4>>2]+8>>2],!(c[j+20>>2]<=(0|e)))){R=c[j+12>>2],I=c[R+92>>2],S=(C=c[R+88>>2])-k|0,E=(R=c[R+96>>2])-Y|0,P=(g(t=I-B|0,f)+g(S,p)|0)+g(E,h)|0,b=ui(a,r,t,t>>31),t=O,U=b,b=ui(s,l,S,S>>31),t=O+t|0,t=(S=U+b|0)>>>0<b>>>0?t+1|0:t,E=(b=S)+(S=ui(_,u,E,E>>31))|0,b=O+t|0;n:{if(!(E|(S=b=E>>>0<S>>>0?b+1|0:b))){if(0<(0|P))break n;break t}if(-1<(0|S))break t;if(z=0<(0|P),U=P>>>31|0,V=(b=(0|(t=P))<0)?0-t|0:0,M=t>>31,P=b?0-(M+(0!=(0|t))|0)|0:0,b=1<=(0|q)?(c[8+X>>2]=w,c[12+X>>2]=F,-(c[24+X>>2]=1)):(0|q)<=-1?(c[24+X>>2]=-1,c[8+X>>2]=0-w,c[12+X>>2]=0-((0!=(0|w))+F|0),1):(c[8+X>>2]=0,c[12+X>>2]=0,c[24+X>>2]=0),U=z?-1:U,V=z?t:V,P=z?M:P,E=0-(t=E)|0,S=0-((0!=(0|t))+S|0)|0,t=D,(z=0<(0|(M=T))?1:0<=(0|T)?D:0)||-1<((M=t=0)|T)||(c[24+X>>2]=b,t=0-D|0,M=0-((0!=(0|D))+T|0)|0),c[16+X>>2]=t,c[20+X>>2]=M,1<=(0|Le(V,P,E,S,U,8+X|0)))break t}c[o>>2]=n=(0|n)==(0|L)?0:j,t=ui(a,r,t=I-W|0,t>>31),T=O,D=(b=t)+(t=ui(s,l,t=C-G|0,t>>31))|0,b=O+T|0,b=D>>>0<t>>>0?b+1|0:b,T=ui(_,u,t=R-H|0,t>>31),t=O+b|0,T=t=(D=T+D|0)>>>0<T>>>0?t+1|0:t,k=C,B=I,Y=R;continue}if(!(t=c[i>>2]))break e;if(!c[t+12>>2])break e;if(z=c[c[t+8>>2]+4>>2],c[z+20>>2]<=(0|e))break e;if(C=c[z+12>>2],t=ui(U=t=M=(j=c[C+92>>2])-W|0,V=t>>31,y,A),n=O,R=(b=t)+(t=ui(E=t=W=(P=c[C+88>>2])-G|0,S=t>>31,v,d))|0,b=O+n|0,b=R>>>0<t>>>0?b+1|0:b,t=(0|(n=R))!=(0-(t=ui(x,m,G=t=C=(R=c[C+96>>2])-H|0,I=t>>31))|0)?1:(0-(O+(0!=(0|t))|0)|0)!=(0|b))break e;if(t=ui(a,r,t=B-j|0,t>>31),n=O,H=(b=t)+(t=ui(s,l,t=k-P|0,t>>31))|0,b=O+n|0,b=H>>>0<t>>>0?b+1|0:b,t=ui(_,u,t=Y-R|0,t>>31),b=O+b|0,-1<(0|(t=(R=n=t+H|0)>>>0<t>>>0?b+1|0:b)))break e;if(n=(g(M,f)+g(W,p)|0)+g(C,h)|0,C=ui(U,V,a,r),b=O,P=C,C=ui(E,S,s,l),b=O+b|0,b=(S=P+C|0)>>>0<C>>>0?b+1|0:b,C=ui(_,u,G,I),b=O+b|0,(b=(I=C+S|0)>>>0<C>>>0?b+1|0:b)|(C=I)){if(-1<(0|b))break e;if(H=0<(0|n),W=n>>>31|0,G=(I=(0|n)<0)?0-n|0:0,E=n>>31,I=I?0-(E+(0!=(0|n))|0)|0:0,w=1<=(0|q)?(c[8+X>>2]=w,c[12+X>>2]=F,-(c[24+X>>2]=1)):(0|q)<=-1?(c[24+X>>2]=-1,c[8+X>>2]=0-w,c[12+X>>2]=0-((0!=(0|w))+F|0),1):(c[8+X>>2]=0,c[12+X>>2]=0,c[24+X>>2]=0),S=H?-1:W,G=H?n:G,I=H?E:I,C=0-(n=C)|0,b=0-((0!=(0|n))+b|0)|0,n=D,(F=0<(0|(E=T))?1:0<=(0|T)?n:0)||-1<((E=D=0)|T)||(c[24+X>>2]=w,D=0-n|0,E=0-((0!=(0|n))+T|0)|0),c[16+X>>2]=D,c[20+X>>2]=E,0<=(0|Le(G,I,C,b,S,8+X|0)))break e}else if((0|n)<=0)break e;c[i>>2]=z,T=c[z+12>>2],H=c[T+96>>2],W=c[T+92>>2],n=c[o>>2],G=c[T+88>>2],D=R,T=t}}N=32+X|0}function Ue(e,t,n,i,o,a,r){var s,l,_,u,h,f,p,d=0,m=0,A=0,v=0,g=0,x=0,y=0,b=0,S=0,C=0;if(!(d=c[n+8>>2]))return 0;for(f=i+8|0,p=i+4|0,y=d;;){if(c[y+20>>2]>c[e+100>>2]){m=c[y+12>>2],d=ui(A=d=l=c[m+92>>2]-c[n+92>>2]|0,v=d>>31,c[o+8>>2],c[o+12>>2]),g=O,x=d,s=ui(b=d=_=c[m+88>>2]-c[n+88>>2]|0,S=d>>31,c[o>>2],c[o+4>>2]),d=O+g|0,d=(x=x+s|0)>>>0<s>>>0?d+1|0:d,h=ui(g=m=s=c[m+96>>2]-c[n+96>>2]|0,u=m>>31,c[o+16>>2],c[o+20>>2]),m=O+d|0,m=(x=h+x|0)>>>0<h>>>0?m+1|0:m,d=ui(c[a+8>>2],c[a+12>>2],A,v),v=O,A=(b=ui(c[a>>2],c[a+4>>2],b,S))+d|0,d=O+v|0,d=A>>>0<b>>>0?d+1|0:d,v=ui(c[a+16>>2],c[a+20>>2],g,u),d=O+d|0,d=(A=v+A|0)>>>0<v>>>0?d+1|0:d,g=v=A,d=(d=0<(0|(A=d))?1:0<=(0|A)?g:0)?(g=-1,b=0,1):-1<(0|A)?(b=1,g=A=v=0):(v=0-(d=v)|0,A=0-((0!=(0|d))+A|0)|0,b=0,-(g=1));e:{if(!(S=0<(0|m)?1:0<=(0|m)?x:0))if((0|m)<-1||(0|m)<=-1)x=0-(d=x)|0,m=0-((0!=(0|d))+m|0)|0,d=g;else if(m=x=0,b)break e;!C||(0|(g=Le(v,A,x,m,d,r)))<=-1?(c[r+16>>2]=d,c[r+8>>2]=x,c[r+12>>2]=m,c[r>>2]=v,c[r+4>>2]=A,C=y):g||(C=2!=(0|Be(C,y,c[i>>2],c[p>>2],c[f>>2],_,l,s))^t?y:C)}d=c[n+8>>2]}if((0|(y=c[y>>2]))==(0|d))break}return C}function Ge(e){var t,n,i,o=0,a=x(0);return N=i=N-16|0,t=c[e+8>>2],o=c[e+12>>2],a=x(x(x(+(t>>>0)+4294967296*((n=o)>>>0))*x(0x10000000000000000))+x(+m[e>>2]+4294967296*+m[e+4>>2])),0<(0|o)||0<=(0|o)||(o=c[e+4>>2],e=c[e>>2],c[i>>2]=0-e,c[4+i>>2]=0-(o+(0!=(0|e))|0),t=(e=!(e|o))+(o=-1^t)|0,e=-1^n,c[8+i>>2]=t,c[12+i>>2]=t>>>0<o>>>0?e+1|0:e,a=x(-Ge(i))),N=16+i|0,a}function je(e,t,n){var i,o,r,s=0,l=0,_=0,u=0,h=x(0),f=x(0),d=0,m=0,v=0,b=x(0),S=0,C=x(0),E=0,T=0,P=0,w=x(0),I=x(0),R=x(0),D=0,L=x(0),F=x(0),k=0,U=0;if(N=r=N-176|0,(0|n)<=0)(t=c[e+12>>2])&&p[e+16|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+12>>2]=0,a[e+16|0]=1,c[e+4>>2]=0,c[e+8>>2]=0,(t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+32>>2]=0,a[e+36|0]=1,c[(t=e+24|0)>>2]=0,c[t+4>>2]=0,(t=c[e+52>>2])&&p[e+56|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+52>>2]=0,a[e+56|0]=1,c[(e=e+44|0)>>2]=0,c[e+4>>2]=0;else{for(a[104+r|0]=1,c[(s=80+r|0)>>2]=0,c[s+4>>2]=256,c[(s=r+64|0)>>2]=0,c[s+4>>2]=256,c[(s=48+r|0)>>2]=0,c[s+4>>2]=256,c[100+r>>2]=0,c[(s=92+r|0)>>2]=0,c[s+4>>2]=0,c[72+r>>2]=0,c[76+r>>2]=0,c[56+r>>2]=0,c[60+r>>2]=0,c[40+r>>2]=0,c[44+r>>2]=0,w=x(-1.0000000150474662e30),I=x(1.0000000150474662e30),l=n,s=t,R=x(1.0000000150474662e30),C=x(1.0000000150474662e30),L=x(-1.0000000150474662e30),F=x(-1.0000000150474662e30);w=w<(h=A[s+8>>2])?h:w,L=L<(f=A[s+4>>2])?f:L,I=h<I?h:I,R=f<R?f:R,F=F<(h=A[s>>2])?h:F,C=h<C?h:C,s=s+16|0,l=l-1|0;);if(s=1,o=x(w-I),f=x(L-R),(0|(u=(h=(b=x(F-C))<f?(c[120+r>>2]=l=f<o?2:1,s=0,b):(c[120+r>>2]=l=(b<o)<<1,f))<o?s:2))==(0|l)&&(u=(l+1>>>0)%3|0),c[36+r>>2]=s=0,A[32+r>>2]=x(w+I)*x(.5),A[28+r>>2]=x(L+R)*x(.5),c[5498]=c[5498]+1,c[20+r>>2]=0,A[24+r>>2]=x(F+C)*x(.5),c[112+r>>2]=u,c[116+r>>2]=_=(3^l)-u|0,h=x(o*x(9788566967472434e-20)),h=(l=((_+1|0)%3|0)==(0|l))?h:x(-h),A[16+r>>2]=h,f=x(f*x(9788566967472434e-20)),f=l?f:x(-f),A[12+r>>2]=f,b=x(b*x(9788566967472434e-20)),b=l?b:x(-b),A[8+r>>2]=b,(l=M(19+(n<<4)|0))&&(c[(s=l+19&-16)-4>>2]=l),c[164+r>>2]=s,a[168+r|0]=1,c[160+r>>2]=n,l=c[140+r>>2],c[s>>2]=c[136+r>>2],c[s+4>>2]=l,l=c[4+(_=144+r|0)>>2],c[(s=s+8|0)>>2]=c[_>>2],c[s+4>>2]=l,1!=(0|n))for(l=n-1|0,s=16;u=c[140+r>>2],m=c[164+r>>2]+s|0,c[m>>2]=c[136+r>>2],c[m+4>>2]=u,v=c[_+4>>2],c[(m=m+8|0)>>2]=c[_>>2],c[m+4>>2]=v,s=s+16|0,l=l-1|0;);for(h=h!=x(0)?x(x(1)/h):h,f=f!=x(0)?x(x(1)/f):f,b=b!=x(0)?x(x(1)/b):b,c[156+r>>2]=n,m=(136+r|0)+(c[112+r>>2]<<2)|0,v=(136+r|0)+(c[120+r>>2]<<2)|0,u=(136+r|0)+(c[116+r>>2]<<2)|0,s=c[164+r>>2],w=A[32+r>>2],I=A[28+r>>2],R=A[24+r>>2],l=0;c[s+12>>2]=l,c[148+r>>2]=0,A[136+r>>2]=b*x(A[t>>2]-R),A[144+r>>2]=h*x(A[t+8>>2]-w),A[140+r>>2]=f*x(A[t+4>>2]-I),_=s,C=A[u>>2],d=x(y(C))<x(2147483648)?~~C:-2147483648,c[_>>2]=d,d=s+4|0,C=A[v>>2],_=x(y(C))<x(2147483648)?~~C:-2147483648,c[d>>2]=_,d=s+8|0,C=A[m>>2],_=x(y(C))<x(2147483648)?~~C:-2147483648,c[d>>2]=_,t=t+16|0,s=s+16|0,(0|(l=l+1|0))!=(0|n););if(2<=(0|n)&&function e(t,n,i){var o,a,r,s,l,_=0,u=0,h=0,f=0,p=0,d=0,m=0;for(N=l=N-16|0,f=c[t+12>>2],s=c[8+(h=f+((n+i|0)/2<<4)|0)>>2],a=c[h+4>>2],r=c[h>>2],h=n,d=i;;){for(_=(h<<4)+f|0;;){e:{if(!((0|(u=c[_+4>>2]))<(0|a))){if((0|u)!=(0|a))break e;if(!((0|(u=c[_>>2]))<(0|r))){if((0|u)!=(0|r))break e;if(c[_+8>>2]>=(0|s))break e}}_=_+16|0,h=h+1|0;continue}break}for(m=d<<4;;){e:{if(!((0|a)<(0|(p=c[4+(u=f+m|0)>>2])))){if((0|p)!=(0|a))break e;if(!((0|r)<(0|(p=c[u>>2])))){if((0|p)!=(0|r))break e;if(c[u+8>>2]<=(0|s))break e}}m=m-16|0,d=d-1|0;continue}break}if((0|h)<=(0|d)&&(o=c[4+(p=_+8|0)>>2],c[(f=8+l|0)>>2]=c[p>>2],c[f+4>>2]=o,o=c[_+4>>2],c[l>>2]=c[_>>2],c[4+l>>2]=o,o=c[u+4>>2],c[_>>2]=c[u>>2],c[_+4>>2]=o,u=c[4+(_=u+8|0)>>2],c[p>>2]=c[_>>2],c[p+4>>2]=u,_=c[t+12>>2]+m|0,m=c[4+l>>2],c[_>>2]=c[l>>2],c[_+4>>2]=m,u=c[f+4>>2],c[(_=_+8|0)>>2]=c[f>>2],c[_+4>>2]=u,d=d-1|0,h=h+1|0),!((0|h)<=(0|d)))break;f=c[t+12>>2]}(0|n)<(0|d)&&e(t,n,d),(0|h)<(0|i)&&e(t,h,i),N=16+l|0}(152+r|0,0,n-1|0),c[48+r>>2]=0,c[44+r>>2]=c[40+r>>2],c[52+r>>2]=n,(0|(_=c[92+r>>2]))<(0|n)){if(c[96+r>>2]<(0|n)){if(l=0,c[5498]=c[5498]+1,(t=M(19+(n<<2)|0))&&(c[(l=t+19&-16)-4>>2]=t),1<=(0|_))for(s=0,t=_;c[s+l>>2]=c[c[100+r>>2]+s>>2],s=s+4|0,t=t-1|0;);(t=c[100+r>>2])&&p[104+r|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[100+r>>2]=l,a[104+r|0]=1,c[96+r>>2]=n}for(s=_<<2,t=n-_|0;s=s+4|(c[c[100+r>>2]+s>>2]=0),t=t-1|0;);}for(c[92+r>>2]=n,u=0;;){if(!((l=c[48+r>>2])||((s=c[44+r>>2])?c[44+r>>2]=c[s+8>>2]:(_=c[5498],s=t=0,(l=M(31))&&(c[(s=l+19&-16)-4>>2]=l),c[s+8>>2]=0,l=c[52+r>>2],c[s+4>>2]=l,c[5498]=_+2,(l=M(g(l,112)+19|0))&&(c[(t=l+19&-16)-4>>2]=l),c[s>>2]=t,c[s+8>>2]=c[40+r>>2],c[40+r>>2]=s),l=c[s>>2],(0|(_=c[s+4>>2]))<1||(s=l+112|0,c[l>>2]=(t=1==(0|_))?0:s,t))))for(t=1;s=(v=s)+112|0,c[v>>2]=(0|(t=t+1|0))<(0|_)?s:0,(0|t)!=(0|_););if(c[48+r>>2]=c[l>>2],c[(t=l+8|0)>>2]=0,c[t+4>>2]=0,c[l+16>>2]=0,c[l>>2]=0,c[l+4>>2]=0,c[l+104>>2]=-1,c[t>>2]=0,t=c[164+r>>2]+(u<<4)|0,s=c[t+4>>2],c[l+88>>2]=c[t>>2],c[l+92>>2]=s,_=c[4+(t=t+8|0)>>2],c[(s=l+96|0)>>2]=c[t>>2],c[s+4>>2]=_,c[l+104>>2]=-1,c[c[100+r>>2]+(u<<2)>>2]=l,(0|(u=u+1|0))==(0|n))break}if((t=c[164+r>>2])&&p[168+r|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[164+r>>2]=0,a[168+r|0]=1,c[156+r>>2]=0,c[160+r>>2]=0,c[124+r>>2]=0,c[128+r>>2]=0,c[64+r>>2]=0,c[60+r>>2]=c[56+r>>2],c[108+r>>2]=-3,c[68+r>>2]=g(n,6),c[(t=144+r|0)>>2]=0,c[t+4>>2]=0,c[136+r>>2]=0,function e(t,n,i,o){var a,r=0,s=0,l=0,_=0,u=0,h=0,f=0,p=0,d=0,m=0,A=0,v=0,x=0,y=0,b=0,S=0,C=0,E=0,T=0,P=0,w=0,I=0,R=0,D=0,M=0,z=0,L=0,F=0,B=0,k=0,U=0,G=0;N=a=N-144|0;e:{t:{n:{i:{o:switch(0|(r=i-n|0)){case 1:break n;case 2:break i;case 0:break o;default:break t}c[o>>2]=0,c[o+4>>2]=0,c[(t=o+8|0)>>2]=0,c[t+4>>2]=0;break e}if(i=c[c[t+92>>2]+(n<<2)>>2],r=c[i+204>>2],_=c[i+92>>2],(0|(s=c[i+88>>2]))!=(0|(l=c[i+200>>2]))||(0|r)!=(0|_)||(r=_,c[i+96>>2]!=c[i+208>>2])){n=i+112|0,(u=_-r|0)|(r=s-l|0)?(c[i+4>>2]=n,c[i>>2]=n,c[i+116>>2]=i,c[i+112>>2]=i,c[o+4>>2]=(r=(_=(0|r)<0)|(l=(0|u)<0)&!r)?n:i,c[o>>2]=r?i:n,r=_&!u||l?(c[o+8>>2]=i,n):(c[o+8>>2]=n,i)):(_=c[i+96>>2]>c[i+208>>2],c[o+8>>2]=r=_?n:i,c[o+4>>2]=r,c[o>>2]=r,c[r+4>>2]=r,n=_?i:n,i=c[r>>2]=r),c[o+12>>2]=r,i=Fe(t,o=i,n),c[o+8>>2]=i,t=c[i+8>>2],c[n+8>>2]=t,c[i+4>>2]=i,c[i>>2]=i,c[t+4>>2]=t,c[t>>2]=t;break e}c[i+8>>2]=0,c[o+12>>2]=i,c[o+8>>2]=i,c[o+4>>2]=i,c[o>>2]=i,c[i+4>>2]=i,c[i>>2]=i;break e}t=c[c[t+92>>2]+(n<<2)>>2],c[t+8>>2]=0,c[o+12>>2]=t,c[o+8>>2]=t,c[o+4>>2]=t,c[o>>2]=t,c[t+4>>2]=t,c[t>>2]=t;break e}t:if(!((0|i)<=(0|(s=_=(p=(0|r)/2|0)+n|0)))){for(r=c[t+92>>2],l=c[(r+(_<<2)|0)-4>>2],h=c[l+88>>2],u=c[l+96>>2],l=c[l+92>>2],r=r+(n+p<<2)|0,s=_;;){if(p=c[r>>2],(0|h)!=c[p+88>>2])break t;if((0|l)!=c[p+92>>2])break t;if((0|u)!=c[p+96>>2])break t;if(r=r+4|0,!((0|(s=s+1|0))<(0|i)))break}s=i}if(e(t,n,_,o),c[(n=16+a|0)>>2]=0,c[n+4>>2]=0,c[8+a>>2]=0,e(t,s,i,8+a|(c[12+a>>2]=0)),C=c[12+a>>2])if(x=c[o+4>>2]){B=c[(n=t+100|0)>>2]-1|0,c[n>>2]=B,E=c[o+12>>2],n=c[E+88>>2],p=c[16+a>>2];t:{n:if((0|n)==c[p+88>>2]&&(0|(w=c[E+92>>2]))==c[p+92>>2]){if((0|(i=c[p+4>>2]))==(0|p)){(i=c[p+8>>2])&&(p=c[i+12>>2],w=c[p+92>>2],n=c[p+88>>2]),T=n+1|0,C=c[p+96>>2];break t}if(n=c[p>>2],c[n+4>>2]=i,c[i>>2]=n,c[8+a>>2]==(0|p)&&((0|(l=c[(r=n)+88>>2]))<(0|(_=c[i+88>>2]))||(0|l)==(0|_)&&c[n+92>>2]<c[i+92>>2]||(r=i),c[8+a>>2]=r),(0|p)==(0|C)){i:{if((0|(_=c[n+88>>2]))<=(0|(r=c[i+88>>2]))){if((0|r)!=(0|_))break i;if(c[n+92>>2]<=c[i+92>>2])break i}C=c[12+a>>2]=n;break n}C=c[12+a>>2]=i}}for(v=c[o>>2],y=c[8+a>>2],r=x,n=C,_=i=0,m=l=1;;){p=_,E=i,_=c[n+88>>2],h=c[r+88>>2];n:if(1<=(0|(s=g(_-h|0,l))))for(b=c[n+92>>2],i=r;;){for(_=n,r=c[i+92>>2],h=s;;){i:if(A=b-r|0,(0|(s=c[(f=1&m?4:0)+i>>2]))!=(0|i)&&!(0<(0|(u=(n=c[s+92>>2])-r|0)))){if(r=c[s+88>>2],d=g(r-c[i+88>>2]|0,l)){if(-1<(0|d))break i;if((0|g(u,h))>(0|g(d,A)))break i}h=g(c[_+88>>2]-r|0,l),r=n,i=s;continue}break}if((0|_)==(0|(n=c[_+f>>2])))break n;if(-1<(0|(f=(r=c[n+92>>2])-b|0)))break n;if(u=c[n+88>>2],(0|(s=g(u-c[i+88>>2]|0,l)))<1)break n;if(b=r,r=g(u-c[_+88>>2]|0,l)){if(-1<(0|r))break n;if(!((0|g(h,f))<(0|g(r,A))))break}}else if((0|s)<=-1){u=c[r+92>>2],b=c[n+92>>2];i:for(;;){for(f=c[(D=1&m?0:4)+n>>2];;){i=r,d=s,M=b-u|0;o:if((0|n)!=(0|f)&&!((0|(s=(r=c[f+92>>2])-b|0))<0)){if(h=c[f+88>>2],_=g(h-_|0,l)){if(-1<(0|_))break o;if((0|g(s,d))>(0|g(_,M)))break o}s=g(h-c[i+88>>2]|0,l),_=h,b=r,n=f,r=i;continue i}if((0|(r=c[i+D>>2]))==(0|i)){_=n;break n}if((0|(I=(h=c[r+92>>2])-u|0))<1){_=n;break n}if(_=c[n+88>>2],A=c[r+88>>2],-1<(0|(s=g(_-A|0,l)))){_=n;break n}if(u=h,h=g(A-c[i+88>>2]|0,l)){if(-1<(0|h)){_=n;break n}if(!((0|g(d,I))<(0|g(h,M))))break}}break}_=n}else{s=c[r+92>>2];i:if(u=1&m)for(l=r;;){if((0|(l=c[(i=l)+4>>2]))==(0|r))break i;if((0|h)!=c[l+88>>2])break i;if(_=s,!((0|(s=c[l+92>>2]))<=(0|_)))break}else for(l=r;;){if((0|(l=c[(i=l)>>2]))==(0|r))break i;if((0|h)!=c[l+88>>2])break i;if(_=s,!((0|(s=c[l+92>>2]))<=(0|_)))break}if(l=c[n+92>>2],u)for(r=n;;){if((0|(r=c[(_=r)>>2]))==(0|n))break n;if((0|h)!=c[r+88>>2])break n;if(!((0|(s=l))<=(0|(l=c[r+92>>2]))))break}else for(r=n;;){if((0|(r=c[(_=r)+4>>2]))==(0|n))break n;if((0|h)!=c[r+88>>2])break n;if(!((0|(s=l))<=(0|(l=c[r+92>>2]))))break}}if(s=1&m,m=0,l=-1,r=v,n=y,!s)break}if(c[_>>2]=i,c[i+4>>2]=_,c[E>>2]=p,c[p+4>>2]=E,c[y+88>>2]<c[v+88>>2]&&(c[o>>2]=y),c[C+88>>2]>=c[x+88>>2]&&(c[o+4>>2]=C),c[o+12>>2]=c[20+a>>2],k=c[p+96>>2],S=c[E+96>>2],G=c[p+92>>2],U=c[E+92>>2],o=c[E+8>>2],M=c[p+88>>2],D=c[E+88>>2],y=ui(s=i=I=k-S|(c[104+a>>2]=n=0),l=i>>31,w=i=A=G-U|0,T=i>>31),x=O,i=ui(F=i=0-(R=M-D|0)|0,z=i>>31,R,R>>31),_=O,v=i-(r=ui(A,T,A,T))|0,m=_-(O+(i>>>0<r>>>0)|0)|0,C=0-(i=ui(s,l,F,z))|0,d=0-(O+(0!=(0|i))|0)|0,l=0,o){for(i=o;f=c[i+12>>2],r=ui(b=r=c[f+92>>2]-U|0,h=r>>31,F,z),_=O,(r=(0|r)!=(0-(r=ui(w,T,u=r=c[f+88>>2]-D|0,s=r>>31))|0)?1:(0-(O+(0!=(0|r))|0)|0)!=(0|_))||(r=ui(y,x,b,h),_=O,h=r,r=ui(C,d,u,s),u=O+_|0,u=(s=h+r|0)>>>0<r>>>0?u+1|0:u,_=(r=ui(v,m,r=c[f+96>>2]-S|0,r>>31))+s|0,s=O+u|0,s=_>>>0<r>>>0?s+1|0:s,r=_,(r=(0|s)<0?1:(0|s)<=0?r>>>0<1:0)||l&&1!=(0|Be(l,i,R,A,I,0,0,-1))||(l=i)),(0|o)!=(0|(i=c[i>>2])););c[104+a>>2]=l}if(o=c[p+8>>2],c[80+a>>2]=0,o){for(i=o;f=c[i+12>>2],r=ui(b=r=c[f+92>>2]-G|0,h=r>>31,F,z),_=O,(r=(0|r)!=(0-(r=ui(w,T,u=r=c[f+88>>2]-M|0,s=r>>31))|0)?1:(0-(O+(0!=(0|r))|0)|0)!=(0|_))||(r=ui(y,x,b,h),_=O,h=r,r=ui(C,d,u,s),u=O+_|0,u=(s=h+r|0)>>>0<r>>>0?u+1|0:u,_=(r=ui(v,m,r=c[f+96>>2]-k|0,r>>31))+s|0,s=O+u|0,s=_>>>0<r>>>0?s+1|0:s,r=_,(r=(0|s)<0?1:(0|s)<=0?r>>>0<1:0)||n&&2!=(0|Be(n,i,R,A,I,0,0,-1))||(n=i)),(0|o)!=(0|(i=c[i>>2])););c[80+a>>2]=n}n|l&&(ke(B,E,p,104+a|0,80+a|0),(n=c[104+a>>2])&&(E=c[n+12>>2]),(n=c[80+a>>2])&&(p=c[n+12>>2])),w=c[p+92>>2],T=c[p+88>>2],C=c[p+96>>2]+1|0}for(G=t+100|0,n=E,u=p,B=1,b=f=y=_=d=m=0;;){if(c[140+a>>2]=-1,s=c[(M=n+92|0)>>2],r=c[(U=u+92|0)>>2]-s|0,c[132+a>>2]=r,i=c[(I=n+96|0)>>2],o=c[(D=u+96|0)>>2]-i|0,c[136+a>>2]=o,v=c[n+88>>2],l=c[u+88>>2]-v|0,c[128+a>>2]=l,h=w-s|0,s=C-i|0,R=(i=g(h,o)-g(s,r)|0)>>31,c[104+a>>2]=k=i,c[108+a>>2]=R,F=(i=(i=g(s,l))-g(s=T-v|0,o)|0)>>31,c[112+a>>2]=S=i,c[116+a>>2]=F,z=(i=g(r,s)-g(l,h)|0)>>31,c[120+a>>2]=A=i,c[124+a>>2]=z,i=ui(S,F,l,x=l>>31),h=O,s=ui(k,R,r,v=r>>31),c[96+a>>2]=i-s,c[100+a>>2]=h-(O+(i>>>0<s>>>0)|0),i=ui(k,R,o,h=o>>31),s=O,l=ui(A,z,l,x),c[88+a>>2]=i-l,c[92+a>>2]=s-(O+(i>>>0<l>>>0)|0),i=ui(r,v,A,z),r=O,o=ui(S,F,o,h),c[80+a>>2]=i-o,c[84+a>>2]=r-(O+(i>>>0<o>>>0)|0),c[72+a>>2]=0,c[(i=64+a|0)>>2]=0,c[i+4>>2]=0,c[56+a>>2]=0,A=Ue(t,c[60+a>>2]=0,n,128+a|0,104+a|0,80+a|0,56+a|0),c[48+a>>2]=0,c[(i=40+a|0)>>2]=0,c[i+4>>2]=0,c[32+a>>2]=0,(x=Ue(t,1,u,128+a|(c[36+a>>2]=0),104+a|0,80+a|0,32+a|0))|A){S=A?-1:1,A&&x&&(S=Le(c[56+a>>2],c[60+a>>2],c[64+a>>2],c[68+a>>2],c[72+a>>2],32+a|0));t:{n:if(!B){i:{if(0<=(0|S)){if(-1<c[48+a>>2])break n;if(!(c[40+a>>2]|c[44+a>>2]))break i;break n}if(-1<c[72+a>>2])break n;if(c[64+a>>2]|c[68+a>>2])break n}o=m,h=d,v=y,r=f;break t}r=v=Fe(t,n,u),y&&(c[y+4>>2]=v,r=f),c[v>>2]=y,h=o=c[v+8>>2],m&&(c[m>>2]=o,h=d),c[o+4>>2]=m}if(c[28+a>>2]=A,m=c[24+a>>2]=x,S||(ke(c[G>>2],n,u,28+a|0,24+a|0),m=c[24+a>>2]),(0|S)<0||!m)d=h;else{t:{n:{if(P){if((0|x)!=(0|(i=c[P>>2])))for(;d=c[i+8>>2],((l=s=0)|(f=c[i>>2]))!=(0|i)&&(c[f+4>>2]=c[i+4>>2],l=c[c[i+4>>2]>>2]=f),c[c[d+12>>2]+8>>2]=l,(0|(l=c[d>>2]))!=(0|d)&&(c[l+4>>2]=c[d+4>>2],s=c[c[d+4>>2]>>2]=l),c[c[i+12>>2]+8>>2]=s,c[i+16>>2]=0,c[(l=i+8|0)>>2]=0,c[l+4>>2]=0,c[i>>2]=0,c[i+4>>2]=0,c[i>>2]=c[t+56>>2],c[t+56>>2]=i,c[d+16>>2]=0,c[(i=d+8|0)>>2]=0,c[i+4>>2]=0,c[d>>2]=0,c[d+4>>2]=0,c[d>>2]=c[t+56>>2],c[t+56>>2]=d,c[t+116>>2]=c[t+116>>2]-1,(0|x)!=(0|(i=f)););if(o)break n;break t}if(!o){_=x;break t}P=c[x+4>>2],_=h}c[P>>2]=h,c[h+4>>2]=P,c[o>>2]=x,c[x+4>>2]=o,m=c[24+a>>2],h=0}d=h,C=c[D>>2],w=c[U>>2],P=c[m+8>>2],T=c[u+88>>2],o=0,u=c[m+12>>2]}if(l=u,m=o,0<(0|S)||!(S=c[28+a>>2]))y=v;else{t:{n:{i:{o:{if(L){if((0|A)!=(0|(i=c[L+4>>2])))for(;f=c[i+8>>2],o=c[i+4>>2],((u=s=0)|(h=c[i>>2]))!=(0|i)&&(c[h+4>>2]=o,u=c[c[i+4>>2]>>2]=h),c[c[f+12>>2]+8>>2]=u,(0|(u=c[f>>2]))!=(0|f)&&(c[u+4>>2]=c[f+4>>2],s=c[c[f+4>>2]>>2]=u),c[c[i+12>>2]+8>>2]=s,c[i+16>>2]=0,c[(s=i+8|0)>>2]=0,c[s+4>>2]=0,c[i>>2]=0,c[i+4>>2]=0,c[i>>2]=c[t+56>>2],c[t+56>>2]=i,c[f+16>>2]=0,c[(i=f+8|0)>>2]=0,c[i+4>>2]=0,c[f>>2]=0,c[f+4>>2]=0,c[f>>2]=c[t+56>>2],c[t+56>>2]=f,c[t+116>>2]=c[t+116>>2]-1,(0|A)!=(0|(i=o)););if(v)break o;break t}if(v)break i;b=A;break t}i=(c[r>>2]=L)+4|0;break n}i=c[A>>2],i=(c[(b=r)>>2]=i)+4|0}c[i>>2]=r,c[A>>2]=v,c[v+4>>2]=A,S=c[28+a>>2],r=0}C=c[I>>2],w=c[M>>2],L=c[S+8>>2],T=c[n+88>>2],y=0,n=c[S+12>>2]}if(f=r,i=1,(0|n)!=(0|E)||(0|l)!=(0|p))u=l,B=0;else{if(L){if((0|b)!=(0|(i=c[L+4>>2])))for(;l=c[i+8>>2],o=c[i+4>>2],((u=s=0)|(r=c[i>>2]))!=(0|i)&&(c[r+4>>2]=o,u=c[c[i+4>>2]>>2]=r),c[c[l+12>>2]+8>>2]=u,(0|(r=c[l>>2]))!=(0|l)&&(c[r+4>>2]=c[l+4>>2],s=c[c[l+4>>2]>>2]=r),c[c[i+12>>2]+8>>2]=s,c[i+16>>2]=0,c[(r=i+8|0)>>2]=0,c[r+4>>2]=0,c[i>>2]=0,c[i+4>>2]=0,c[i>>2]=c[t+56>>2],c[t+56>>2]=i,c[l+16>>2]=0,c[(i=l+8|0)>>2]=0,c[i+4>>2]=0,c[l>>2]=0,c[l+4>>2]=0,c[l>>2]=c[t+56>>2],c[t+56>>2]=l,c[t+116>>2]=c[t+116>>2]-1,(0|b)!=(0|(i=o)););y&&(c[L+4>>2]=f,c[f>>2]=L,c[y+4>>2]=b,c[b>>2]=y)}else c[y+4>>2]=f,c[f>>2]=y,c[n+8>>2]=y;if(P){if((0|_)!=(0|(i=c[P>>2])))for(;u=c[i+8>>2],((l=s=0)|(o=c[i>>2]))!=(0|i)&&(c[o+4>>2]=c[i+4>>2],l=c[c[i+4>>2]>>2]=o),c[c[u+12>>2]+8>>2]=l,(0|(r=c[u>>2]))!=(0|u)&&(c[r+4>>2]=c[u+4>>2],s=c[c[u+4>>2]>>2]=r),c[c[i+12>>2]+8>>2]=s,c[i+16>>2]=0,c[(r=i+8|0)>>2]=0,c[r+4>>2]=0,c[i>>2]=0,c[i+4>>2]=0,c[i>>2]=c[t+56>>2],c[t+56>>2]=i,c[u+16>>2]=0,c[(i=u+8|0)>>2]=0,c[i+4>>2]=0,c[u>>2]=0,c[u+4>>2]=0,c[u>>2]=c[t+56>>2],c[t+56>>2]=u,c[t+116>>2]=c[t+116>>2]-1,(0|_)!=(0|(i=o)););i=0,m?(c[d+4>>2]=P,c[P>>2]=d,c[_+4>>2]=m,c[m>>2]=_,u=p):(u=p,m=0)}else c[d+4>>2]=m,c[m>>2]=d,c[p+8>>2]=m,u=p,i=P=0}}else o=Fe(t,n,u),c[n+8>>2]=o,i=c[o+8>>2],c[u+8>>2]=i,c[o+4>>2]=o,c[o>>2]=o,c[i+4>>2]=i,c[i>>2]=i,i=0;if(!i)break}}else t=c[12+a>>2],c[o>>2]=c[8+a>>2],c[o+4>>2]=t,t=c[4+(n=16+a|0)>>2],c[(i=o+8|0)>>2]=c[n>>2],c[i+4>>2]=t}N=144+a|0}(8+r|(c[140+r>>2]=0),0,n,136+r|0),c[132+r>>2]=c[136+r>>2],(t=c[164+r>>2])&&p[168+r|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),(0|(s=c[e+4>>2]))<=-1)for(c[e+8>>2]<=-1&&((t=c[e+12>>2])&&p[e+16|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),a[e+16|0]=1,c[e+8>>2]=0,c[e+12>>2]=0),t=s<<4;_=c[156+r>>2],n=c[e+12>>2]+t|0,c[(l=n)>>2]=c[152+r>>2],c[l+4>>2]=_,_=c[4+(l=160+r|0)>>2],c[(n=n+8|0)>>2]=c[l>>2],c[n+4>>2]=_,t=t+16|0,(n=s)>>>0<=(s=s+1|0)>>>0;);if(c[e+4>>2]=0,c[160+r>>2]=0,c[152+r>>2]=0,((c[156+r>>2]=0)|(s=c[e+24>>2]))<=-1)for(c[e+28>>2]<=-1&&((t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+28>>2]=0,c[e+32>>2]=0,a[e+36|0]=1),t=g(s,12);l=c[156+r>>2],n=c[e+32>>2]+t|0,c[n>>2]=c[152+r>>2],c[n+4>>2]=l,c[n+8>>2]=c[160+r>>2],t=t+12|0,(n=s)>>>0<=(s=s+1|0)>>>0;);if(((c[e+24>>2]=0)|(n=c[e+44>>2]))<=-1&&(t=c[e+52>>2],c[e+48>>2]<=-1&&(t&&p[e+56|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),a[e+56|0]=1,c[e+48>>2]=0,t=c[e+52>>2]=0),B((s=t)+(t=n<<2)|0,0,0-t|0)),c[e+44>>2]=0,_=c[132+r>>2],!(-1<c[_+104>>2])){for(c[_+104>>2]=0,c[5498]=c[5498]+1,t=M(23),c[(m=t+19&-16)>>2]=_,c[m-4>>2]=t,S=v=1;;){e:{t:{n:{i:{if(0<=c[_+100>>2])A[(152+r|0)+(c[116+r>>2]<<2)>>2]=c[_+88>>2];else if(h=Ge(_+24|0),f=Ge(t=_+72|0),A[(152+r|0)+(c[116+r>>2]<<2)>>2]=h/f,c[_+100>>2]<0)break i;A[(152+r|0)+(c[120+r>>2]<<2)>>2]=c[_+92>>2];break n}if(h=Ge(_+40|0),f=Ge(t),A[(152+r|0)+(c[120+r>>2]<<2)>>2]=h/f,c[_+100>>2]<0)break t}h=x(c[_+96>>2]);break e}h=x(Ge(_+56|0)/Ge(t))}if(A[(152+r|0)+(c[112+r>>2]<<2)>>2]=h,h=x(x(A[160+r>>2]*A[16+r>>2])+A[32+r>>2]),f=x(x(A[156+r>>2]*A[12+r>>2])+A[28+r>>2]),b=x(x(A[152+r>>2]*A[8+r>>2])+A[24+r>>2]),(0|(t=c[e+4>>2]))==c[e+8>>2]&&!((0|(n=t?t<<1:1))<=(0|t))){if(u=0,n&&(c[5498]=c[5498]+1,(s=M(19+(n<<4)|0))&&(c[(u=s+19&-16)-4>>2]=s)),1<=(0|t))for(s=0;d=c[e+12>>2]+s|0,D=c[d+4>>2],c[(l=s+u|0)>>2]=c[d>>2],c[l+4>>2]=D,D=c[4+(d=d+8|0)>>2],c[(l=l+8|0)>>2]=c[d>>2],c[l+4>>2]=D,s=s+16|0,t=t-1|0;);(t=c[e+12>>2])&&p[e+16|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+12>>2]=u,a[e+16|0]=1,c[e+8>>2]=n,t=c[e+4>>2]}if(t=c[e+12>>2]+(t<<4)|0,c[t+12>>2]=0,A[t+8>>2]=h,A[t+4>>2]=f,A[t>>2]=b,c[e+4>>2]=c[e+4>>2]+1,D=c[_+8>>2]){for(t=D,d=n=-1;;){if((0|(s=c[t+20>>2]))<=-1){if(_=c[e+24>>2],c[(i=160+r|0)>>2]=0,c[152+r>>2]=0,((c[156+r>>2]=0)|(s=_))==c[e+28>>2]&&!((0|(E=s?_<<1:1))<=(0|s))){if(u=0,E&&(c[5498]=c[5498]+1,(s=M(g(E,12)+19|0))&&(c[(u=s+19&-16)-4>>2]=s)),1<=(0|_))for(s=0,l=_;T=c[e+32>>2]+s|0,k=c[T+4>>2],c[(P=s+u|0)>>2]=c[T>>2],c[P+4>>2]=k,c[P+8>>2]=c[T+8>>2],s=s+12|0,l=l-1|0;);(s=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[s-4>>2])),c[e+32>>2]=u,a[e+36|0]=1,c[e+28>>2]=E,s=c[e+24>>2]}if(l=c[156+r>>2],s=c[e+32>>2]+g(s,12)|0,c[s>>2]=c[152+r>>2],c[s+4>>2]=l,c[s+8>>2]=c[i>>2],l=c[e+24>>2],c[e+24>>2]=s=l+1|0,c[i>>2]=0,c[152+r>>2]=0,c[156+r>>2]=0,c[e+28>>2]==(0|s)&&!((0|(E=s?s<<1:1))<=(0|s))){if(u=0,E&&(c[5498]=c[5498]+1,(s=M(g(E,12)+19|0))&&(c[(u=s+19&-16)-4>>2]=s)),0<=(0|l))for(l=l+1|0,s=0;T=c[e+32>>2]+s|0,k=c[T+4>>2],c[(P=s+u|0)>>2]=c[T>>2],c[P+4>>2]=k,c[P+8>>2]=c[T+8>>2],s=s+12|0,l=l-1|0;);(s=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[s-4>>2])),c[e+32>>2]=u,a[e+36|0]=1,c[e+28>>2]=E,s=c[e+24>>2]}if(l=c[156+r>>2],s=c[e+32>>2]+g(s,12)|0,c[s>>2]=c[152+r>>2],c[s+4>>2]=l,c[s+8>>2]=c[i>>2],c[e+24>>2]=c[e+24>>2]+1,c[t+20>>2]=_,c[c[t+8>>2]+20>>2]=P=_+1|0,i=(T=c[e+32>>2])+g(_,12)|0,c[4+i>>2]=1,c[16+i>>2]=-1,E=c[t+12>>2],-1<(0|(s=c[E+104>>2])))l=v,v=s;else{c[E+104>>2]=v;e:if((0|v)!=(0|S)||(0|(u=S?S<<1:1))<=(0|S))_=m,u=S;else{if(_=0,u&&(c[5498]=c[5498]+1,(s=M(19+(u<<2)|0))&&(c[(_=s+19&-16)-4>>2]=s)),1<=(0|S))for(s=_,l=m;c[s>>2]=c[l>>2],s=s+4|0,l=l+4|0,S=S-1|0;);else if(!m)break e;c[5499]=c[5499]+1,z(c[m-4>>2])}c[(v<<2)+_>>2]=E,l=v+1|0,m=_,S=u}c[8+(T+g(P,12)|0)>>2]=U,c[8+i>>2]=v,v=l,s=c[t+20>>2]}if(l=s,0<=(0|n)&&(c[c[e+32>>2]+g(s,12)>>2]=n-s,l=d),n=s,d=l,(0|D)==(0|(t=c[t>>2])))break}c[c[e+32>>2]+g(d,12)>>2]=n-d}if(!((0|(t=U+1|0))<(0|v)))break;_=c[(t<<2)+m>>2],U=t}for(S=0;;){if(v=c[c[(S<<2)+m>>2]+8>>2])for(t=v;;){if(0<=(0|(s=c[t+20>>2]))){if((0|(u=c[e+44>>2]))==c[e+48>>2]&&!((0|(d=u?u<<1:1))<=(0|u))){n=0,d&&(c[5498]=c[5498]+1,(s=M(19+(d<<2)|0))&&(c[(n=s+19&-16)-4>>2]=s)),_=c[e+52>>2];e:{if(1<=(0|u))for(s=n,l=_;c[s>>2]=c[l>>2],s=s+4|0,l=l+4|0,u=u-1|0;);else if(!_)break e;p[e+56|0]&&(c[5499]=c[5499]+1,z(c[_-4>>2])),u=c[e+44>>2]}c[e+48>>2]=d,c[e+52>>2]=n,a[e+56|0]=1,s=c[t+20>>2]}for(c[c[e+52>>2]+(u<<2)>>2]=s,c[e+44>>2]=c[e+44>>2]+1,s=t;c[s+20>>2]=-1,(0|(s=c[c[s+8>>2]+4>>2]))!=(0|t););}if((0|v)==(0|(t=c[t>>2])))break}if(t=(0|S)==(0|U),S=S+1|0,t)break}m&&(c[5499]=c[5499]+1,z(c[m-4>>2]))}if((e=c[100+r>>2])&&p[104+r|0]&&(c[5499]=c[5499]+1,z(c[e-4>>2])),c[100+r>>2]=0,a[104+r|0]=1,c[92+r>>2]=0,c[96+r>>2]=0,s=c[72+r>>2])for(;c[72+r>>2]=c[s+8>>2],(e=c[s>>2])&&(c[5499]=c[5499]+1,z(c[e-4>>2])),c[5499]=c[5499]+1,z(c[s-4>>2]),s=c[72+r>>2];);if(s=c[56+r>>2])for(;c[56+r>>2]=c[s+8>>2],(e=c[s>>2])&&(c[5499]=c[5499]+1,z(c[e-4>>2])),c[5499]=c[5499]+1,z(c[s-4>>2]),s=c[56+r>>2];);if(s=c[40+r>>2])for(;c[40+r>>2]=c[s+8>>2],(e=c[s>>2])&&(c[5499]=c[5499]+1,z(c[e-4>>2])),c[5499]=c[5499]+1,z(c[s-4>>2]),s=c[40+r>>2];);}N=176+r|0}function Ve(e,t,n,i){pi[c[c[(e|=0)>>2]+80>>2]](e,t|=0,n|=0,i|=0)}function He(e,t){e|=0,t=x(t),A[e+52>>2]=t}function We(){return 0}function qe(){}function Ye(e,t){var n,i,o,r=0,s=0,l=0,_=0,u=0,h=0,f=0,d=0,m=0,A=0,v=0,x=0;if(c[e+8>>2]<(0|t)){if(t&&(c[5498]=c[5498]+1,(r=M(g(t,36)+19|0))&&(c[(f=r+19&-16)-4>>2]=r)),!((0|(o=c[e+4>>2]))<1)){for(;;){s=g(d,36),c[4+(r=s+f|0)>>2]=0,c[r+8>>2]=0,a[r+16|0]=1,n=r+4|(c[r+12>>2]=0);e:{t:{n:{if(u=s+c[e+12>>2]|0,1<=(0|(l=c[u+4>>2]))){if(v=r+8|0,m=r+12|0,x=r+16|0,c[5498]=c[5498]+1,!(s=M(19+(A=l<<2)|0)))break n;if(c[(h=s+19&-16)-4>>2]=s,i=c[m>>2],1<=(0|(s=c[n>>2])))for(_=0;c[_+h>>2]=c[_+i>>2],_=_+4|0,s=s-1|0;);else if(!i)break t;c[5499]=c[5499]+1,z(c[i-4>>2]);break t}c[n>>2]=l;break e}h=0}for(c[m>>2]=h,a[0|x]=1,c[v>>2]=l,B(h,0,A),c[n>>2]=l,_=c[u+12>>2],s=c[m>>2];c[s>>2]=c[_>>2],s=s+4|0,_=_+4|0,l=l-1|0;);}if(s=c[u+24>>2],c[r+20>>2]=c[u+20>>2],c[r+24>>2]=s,l=c[4+(s=u+28|0)>>2],c[(r=r+28|0)>>2]=c[s>>2],c[r+4>>2]=l,(0|o)==(0|(d=d+1|0)))break}if(!((0|(l=c[e+4>>2]))<1))for(s=8;r=c[e+12>>2]+s|0,(u=c[(_=r+4|0)>>2])&&p[r+8|0]&&(c[5499]=c[5499]+1,z(c[u-4>>2])),c[_>>2]=0,a[r+8|0]=1,c[(r=r-4|0)>>2]=0,s=s+36|(c[r+4>>2]=0),l=l-1|0;);}(r=c[e+12>>2])&&p[e+16|0]&&(c[5499]=c[5499]+1,z(c[r-4>>2])),c[e+12>>2]=f,a[e+16|0]=1,c[e+8>>2]=t}}function Xe(e,t){var n,i,o,r,s,l,_=0,u=0,h=0,f=0;if((0|(f=c[e+4>>2]))==c[e+8>>2]&&(Ye(e,f?f<<1:1),f=c[e+4>>2]),_=(i=c[e+12>>2])+g(f,36)|0,c[_+4>>2]=0,c[_+8>>2]=0,a[_+16|0]=1,o=_+4|(c[_+12>>2]=0),1<=(0|(u=c[t+4>>2])))for(s=_+8|0,n=_+12|0,l=_+16|0,c[5498]=c[5498]+1,(_=M(19+(r=u<<2)|0))&&(c[(h=_+19&-16)-4>>2]=_,(_=c[n>>2])&&(c[5499]=c[5499]+1,z(c[_-4>>2]))),c[n>>2]=h,a[0|l]=1,c[s>>2]=u,B(h,0,r),c[o>>2]=u,_=c[t+12>>2],h=c[n>>2];c[h>>2]=c[_>>2],h=h+4|0,_=_+4|0,u=u-1|0;);else c[o>>2]=u;u=c[t+24>>2],_=g(f,36)+i|0,c[_+20>>2]=c[t+20>>2],c[_+24>>2]=u,u=c[4+(t=t+28|0)>>2],c[(_=_+28|0)>>2]=c[t>>2],c[_+4>>2]=u,c[e+4>>2]=c[e+4>>2]+1}function Qe(e,t,n,i){t|=0,n|=0,i|=0;var o,a,r,s=x(pi[c[c[(e|=0)>>2]+48>>2]](e)),l=A[t+52>>2],_=A[t+24>>2],u=A[t+20>>2],h=A[t+56>>2],f=A[t+40>>2],p=A[e+72>>2],d=A[e+88>>2],m=A[t+36>>2],v=A[e+68>>2],g=A[e+84>>2],b=A[t+48>>2],S=A[t+8>>2],C=A[t>>2],E=A[t+4>>2],T=A[t+16>>2],P=A[t+32>>2],w=A[e+64>>2],I=A[e+80>>2];c[n+12>>2]=0,o=h,h=x(x(I+w)*x(.5)),a=x(x(g+v)*x(.5)),r=x(x(d+p)*x(.5)),o=x(o+x(x(x(P*h)+x(m*a))+x(f*r))),w=x(s+x(x(I-w)*x(.5))),v=x(s+x(x(g-v)*x(.5))),s=x(s+x(x(d-p)*x(.5))),f=x(x(x(w*x(y(P)))+x(v*x(y(m))))+x(s*x(y(f)))),A[n+8>>2]=o-f,p=x(l+x(x(x(h*T)+x(a*u))+x(r*_))),_=x(x(x(w*x(y(T)))+x(v*x(y(u))))+x(s*x(y(_)))),A[n+4>>2]=p-_,u=x(b+x(x(x(h*C)+x(a*E))+x(r*S))),s=x(x(x(w*x(y(C)))+x(v*x(y(E))))+x(s*x(y(S)))),A[n>>2]=u-s,c[i+12>>2]=0,A[i+8>>2]=f+o,A[i+4>>2]=_+p,A[i>>2]=s+u}function Ze(e,t){e|=0,t=x(t);var n,i,o,a,r,s,l,_=x(pi[c[c[e>>2]+48>>2]](e)),u=x(pi[c[c[e>>2]+48>>2]](e)),h=x(pi[c[c[e>>2]+48>>2]](e));A[e+52>>2]=t,t=A[(n=e+44|0)>>2],o=A[(i=e+40|0)>>2],a=A[e+36>>2],r=x(pi[c[c[e>>2]+48>>2]](e)),s=x(pi[c[c[e>>2]+48>>2]](e)),l=x(pi[c[c[e>>2]+48>>2]](e)),c[e+48>>2]=0,A[i>>2]=x(u+o)-s,A[e+36>>2]=x(_+a)-r,A[n>>2]=x(h+t)-l}function Je(e){var t;c[(e|=0)>>2]=7916,(t=c[e+60>>2])&&(pi[c[c[t>>2]>>2]](t),(t=c[e+60>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),c[5499]=c[5499]+1,z(c[e-4>>2])}function Ke(e,t,n,i){t|=0,n|=0,i|=0;var o=x(pi[c[c[(e|=0)>>2]+48>>2]](e)),a=A[t+52>>2],r=A[t+20>>2],s=A[t+24>>2],l=A[t+56>>2],_=A[t+36>>2],u=A[e+40>>2],h=A[t+40>>2],f=A[e+44>>2],p=A[t+48>>2],d=A[t>>2],m=A[t+4>>2],v=A[t+8>>2],g=A[t+16>>2],b=A[t+32>>2],S=A[e+36>>2];c[n+12>>2]=0,S=x(o+S),u=x(o+u),o=x(o+f),_=x(x(x(S*x(y(b)))+x(u*x(y(_))))+x(o*x(y(h)))),A[n+8>>2]=l-_,r=x(x(x(S*x(y(g)))+x(u*x(y(r))))+x(o*x(y(s)))),A[n+4>>2]=a-r,o=x(x(x(S*x(y(d)))+x(u*x(y(m))))+x(o*x(y(v)))),A[n>>2]=p-o,c[i+12>>2]=0,A[i+8>>2]=l+_,A[i+4>>2]=r+a,A[i>>2]=o+p}function $e(e,t){t|=0;var n,i,o,a=x(pi[c[c[(e|=0)>>2]+48>>2]](e)),r=x(pi[c[c[e>>2]+48>>2]](e)),s=x(pi[c[c[e>>2]+48>>2]](e)),l=A[t>>2],_=A[t+4>>2],u=A[t+8>>2];c[e+48>>2]=0,c[e+32>>2]=0,n=A[(t=e+28|0)>>2],u=x(y(u)),A[t>>2]=u,i=A[(t=e+24|0)>>2],_=x(y(_)),A[t>>2]=_,o=A[e+20>>2],l=x(y(l)),A[e+20>>2]=l,A[(t=e+44|0)>>2]=x(x(x(s+A[t>>2])/n)*u)-s,A[(t=e+40|0)>>2]=x(x(x(r+A[t>>2])/i)*_)-r,A[e+36>>2]=x(x(x(a+A[e+36>>2])/o)*l)-a}function et(){return 52}function tt(){return 6}function nt(e){e|=0,c[5499]=c[5499]+1,z(c[e-4>>2])}function it(e,t){var n;t|=0,c[(e|=0)>>2]=0,c[e+4>>2]=0,c[(n=e+8|0)>>2]=0,c[4+n>>2]=0,c[(c[t+60>>2]<<2)+e>>2]=1065353216}function ot(){}function at(){return 60}function rt(e,t,n){e|=0,c[(n|=0)>>2]=0,c[n+4>>2]=0,c[(e=n+8|0)>>2]=0,c[e+4>>2]=0}function st(e){var t=0;(t=c[e>>2])&&ct(e,t),(t=c[e+4>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+4>>2]=0,c[e+8>>2]=-1,(t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+16>>2]=0,c[e+32>>2]=0,a[e+36|0]=1,c[(e=e+24|0)>>2]=0,c[e+4>>2]=0}function ct(e,t){var n;c[t+40>>2]&&(ct(e,c[t+36>>2]),ct(e,c[t+40>>2])),c[e>>2]==(0|t)&&(c[e>>2]=0),(n=c[e+4>>2])&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+4>>2]=t}function lt(e){var t=0;(t=c[e>>2])&&ct(e,t),(t=c[e+4>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+4>>2]=0,c[e+8>>2]=-1,(t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+32>>2]=0,c[e+16>>2]=0,a[e+36|0]=1,c[(e=e+24|0)>>2]=0,c[e+4>>2]=0}function _t(e,t){var n,i,o,a,r,s,l,_,u,h,f,p,d=0,m=0,A=0,v=0,g=0,x=0;N=p=N-32|0;e:if(!((0|(t=(0|t)<=-1?c[e+12>>2]:t))<1)&&(d=c[e>>2]))for(;;){if(c[(v=d+40|0)>>2])for(x=0;(A=c[d+32>>2])>>>0<=d>>>0?A=d:(i=(0|(n=c[A+40>>2]))==(0|d),a=c[36+((o=((0|d)!=(0|n))<<2)+A|0)>>2],g=e,(m=c[A+32>>2])&&(g=36+(m+((c[m+40>>2]==(0|A))<<2)|0)|0),c[g>>2]=d,c[a+32>>2]=d,c[A+32>>2]=d,c[d+32>>2]=m,c[A+36>>2]=c[d+36>>2],c[A+40>>2]=c[v>>2],c[c[d+36>>2]+32>>2]=A,c[c[v>>2]+32>>2]=A,c[(n=d+36|0)+(i<<2)>>2]=A,c[n+o>>2]=a,v=c[4+(n=A+24|0)>>2],_=c[n>>2],c[(m=24+p|0)>>2]=_,c[m+4>>2]=v,a=c[4+(m=A+16|0)>>2],u=c[m>>2],c[(i=16+p|0)>>2]=u,c[4+i>>2]=a,o=c[4+(i=A+8|0)>>2],h=c[i>>2],c[(r=8+p|0)>>2]=h,c[4+r>>2]=o,r=c[A+4>>2],f=c[A>>2],c[p>>2]=f,c[4+p>>2]=r,s=c[4+(g=l=d+24|0)>>2],c[n>>2]=c[g>>2],c[4+n>>2]=s,s=c[4+(n=d+16|0)>>2],c[m>>2]=c[n>>2],c[m+4>>2]=s,s=c[4+(m=d+8|0)>>2],c[i>>2]=c[m>>2],c[4+i>>2]=s,i=c[d+4>>2],c[A>>2]=c[d>>2],c[A+4>>2]=i,c[l>>2]=_,c[4+l>>2]=v,c[n>>2]=u,c[4+n>>2]=a,c[m>>2]=h,c[m+4>>2]=o,c[d>>2]=f,c[d+4>>2]=r),d=c[e+16>>2]>>>x|0,x=x+1&31,d=c[36+(((1&d)<<2)+A|0)>>2],c[(v=d+40|0)>>2];);if(m=0,ht(g=e,m=ut(e,d)?c[e>>2]:m,d),c[e+16>>2]=c[e+16>>2]+1,!(t=t-1|0))break e;d=c[e>>2]}N=32+p|0}function ut(e,t){var n,i,o,a=0,r=0,s=x(0),l=x(0),_=x(0),u=x(0),h=x(0),f=x(0),p=x(0),d=x(0),m=x(0),v=x(0),g=x(0);if(c[e>>2]==(0|t))return c[e>>2]=0;if(r=c[t+32>>2],a=c[36+(((c[r+40>>2]!=(0|t))<<2)+r|0)>>2],t=c[r+32>>2]){for(c[36+((((0|r)==c[t+40>>2])<<2)+t|0)>>2]=a,c[a+32>>2]=t,(a=c[e+4>>2])&&(c[5499]=c[5499]+1,z(c[a-4>>2])),c[e+4>>2]=r;;){if(o=A[t>>2],a=c[t+36>>2],s=A[a>>2],r=c[t+40>>2],p=A[r>>2],A[t>>2]=s=s<p?s:p,p=A[t+16>>2],l=A[a+16>>2],d=A[r+16>>2],A[t+16>>2]=l=d<l?l:d,d=A[t+4>>2],_=A[a+4>>2],m=A[r+4>>2],A[t+4>>2]=_=_<m?_:m,m=A[(n=t+20|0)>>2],u=A[a+20>>2],v=A[r+20>>2],A[n>>2]=u=v<u?u:v,v=A[t+8>>2],h=A[a+8>>2],g=A[r+8>>2],A[t+8>>2]=h=h<g?h:g,g=A[(n=t+24|0)>>2],f=A[a+24>>2],i=A[r+24>>2],A[n>>2]=f=i<f?f:i,m==u&&p==l&&s==o&&d==_&&v==h&&g==f)return t;if(!(t=c[t+32>>2]))break}return c[e>>2]}return c[a+32>>2]=0,c[e>>2]=a,(t=c[e+4>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2]),a=c[e>>2]),c[e+4>>2]=r,a}function ht(e,t,n){var i=0,o=x(0),a=x(0),r=x(0),s=0,l=0;if(!c[e>>2])return c[n+32>>2]=0,void(c[e>>2]=n);if(i=c[t+40>>2])for(a=x(A[n>>2]+A[n+16>>2]),o=x(A[n+8>>2]+A[n+24>>2]),r=x(A[n+4>>2]+A[n+20>>2]);l=t+36|0,t=c[t+36>>2],t=c[l+(!(x(x(x(y(x(a-x(A[t>>2]+A[t+16>>2]))))+x(y(x(r-x(A[t+4>>2]+A[t+20>>2])))))+x(y(x(o-x(A[t+8>>2]+A[t+24>>2])))))<x(x(x(y(x(a-x(A[i>>2]+A[i+16>>2]))))+x(y(x(r-x(A[i+4>>2]+A[i+20>>2])))))+x(y(x(o-x(A[i+8>>2]+A[i+24>>2]))))))<<2)>>2],i=c[t+40>>2];);l=c[t+32>>2],(i=c[e+4>>2])?c[e+4>>2]=0:(c[5498]=c[5498]+1,i=0,(s=M(63))&&(c[(i=s+19&-16)-4>>2]=s),c[i>>2]=0,c[i+4>>2]=0,c[i+40>>2]=0,c[(s=i+32|0)>>2]=0,c[s+4>>2]=0,c[(s=i+24|0)>>2]=0,c[s+4>>2]=0,c[(s=i+16|0)>>2]=0,c[s+4>>2]=0,c[(s=i+8|0)>>2]=0,c[s+4>>2]=0),c[i+36>>2]=0,c[i+40>>2]=0,a=A[n>>2],o=A[t>>2],A[i>>2]=a<o?a:o,a=A[n+16>>2],o=A[t+16>>2],A[i+16>>2]=o<a?a:o,a=A[n+4>>2],o=A[t+4>>2],A[i+4>>2]=a<o?a:o,a=A[n+20>>2],o=A[t+20>>2],A[i+20>>2]=o<a?a:o,a=A[n+8>>2],o=A[t+8>>2],A[i+8>>2]=a<o?a:o,c[i+32>>2]=l,a=A[n+24>>2],o=A[t+24>>2],A[i+24>>2]=o<a?a:o;e:if(l)for(c[36+(((c[c[t+32>>2]+40>>2]==(0|t))<<2)+l|0)>>2]=i,c[i+36>>2]=t,c[t+32>>2]=i,c[i+40>>2]=n,c[n+32>>2]=i,a=A[i>>2];;){if(e=i,A[(i=l)>>2]<=a&&A[i+4>>2]<=A[e+4>>2]&&A[i+8>>2]<=A[e+8>>2]&&A[i+16>>2]>=A[e+16>>2]&&A[i+20>>2]>=A[e+20>>2]&&A[i+24>>2]>=A[e+24>>2])break e;if(e=c[i+36>>2],a=A[e>>2],t=c[i+40>>2],o=A[t>>2],A[i>>2]=a=a<o?a:o,o=A[e+16>>2],r=A[t+16>>2],A[i+16>>2]=r<o?o:r,o=A[e+4>>2],r=A[t+4>>2],A[i+4>>2]=o<r?o:r,o=A[e+20>>2],r=A[t+20>>2],A[i+20>>2]=r<o?o:r,o=A[e+8>>2],r=A[t+8>>2],A[i+8>>2]=o<r?o:r,o=A[e+24>>2],r=A[t+24>>2],A[i+24>>2]=r<o?o:r,!(l=c[i+32>>2]))break}else c[i+36>>2]=t,c[t+32>>2]=i,c[i+40>>2]=n,c[e>>2]=i,c[n+32>>2]=i}function ft(){return 1}function pt(e){var t=0;return c[(e|=0)>>2]=9180,(t=c[e+72>>2])&&(st(t),(t=c[e+72>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),(t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+32>>2]=0,a[e+36|0]=1,c[(t=e+24|0)>>2]=0,(c[t+4>>2]=0)|e}function dt(e,t){var n,i,o,a,r,s,l,_,u,h,f,p,d,m,A,v,x=0,y=0,b=0;N=v=N-80|0,c[e+76>>2]=c[e+76>>2]+1,(x=c[e+72>>2])&&(ut(x,y=c[76+(c[e+32>>2]+g(t,80)|0)>>2]),(b=c[x+4>>2])&&(c[5499]=c[5499]+1,z(c[b-4>>2])),c[x+4>>2]=y,c[x+12>>2]=c[x+12>>2]-1),y=c[e+24>>2],d=g(t,80),l=c[(m=e+32|0)>>2],o=c[4+(n=8+(x=d+l|0)|0)>>2],c[(b=8+v|0)>>2]=c[n>>2],c[b+4>>2]=o,u=c[4+(a=x+24|0)>>2],c[(o=h=24+v|0)>>2]=c[a>>2],c[4+o>>2]=u,s=c[4+(f=x+40|0)>>2],c[(o=40+v|0)>>2]=c[f>>2],c[4+o>>2]=s,i=c[4+(r=x+56|0)>>2],c[(s=u=56+v|0)>>2]=c[r>>2],c[4+s>>2]=i,A=c[4+(p=x+72|0)>>2],c[(i=s=72+v|0)>>2]=c[p>>2],c[4+i>>2]=A,i=c[x+4>>2],c[v>>2]=c[x>>2],c[4+v>>2]=i,i=c[x+20>>2],c[16+v>>2]=c[x+16>>2],c[20+v>>2]=i,i=c[x+36>>2],c[32+v>>2]=c[x+32>>2],c[36+v>>2]=i,i=c[x+52>>2],c[48+v>>2]=c[x+48>>2],c[52+v>>2]=i,i=c[x+68>>2],c[64+v>>2]=c[x+64>>2],c[68+v>>2]=i,i=g(y,80)-80|0,_=c[68+(y=i+l|0)>>2],c[x+64>>2]=c[y+64>>2],c[x+68>>2]=_,_=c[4+(l=y+8|0)>>2],c[n>>2]=c[l>>2],c[4+n>>2]=_,n=c[y+4>>2],c[x>>2]=c[y>>2],c[x+4>>2]=n,l=c[4+(n=y+24|0)>>2],c[a>>2]=c[n>>2],c[4+a>>2]=l,n=c[y+20>>2],c[x+16>>2]=c[y+16>>2],c[x+20>>2]=n,a=c[4+(n=y+40|0)>>2],c[f>>2]=c[n>>2],c[4+f>>2]=a,n=c[y+36>>2],c[x+32>>2]=c[y+32>>2],c[x+36>>2]=n,a=c[4+(n=y+56|0)>>2],c[r>>2]=c[n>>2],c[4+r>>2]=a,n=c[y+52>>2],c[x+48>>2]=c[y+48>>2],c[x+52>>2]=n,y=c[4+(x=y+72|0)>>2],c[p>>2]=c[x>>2],c[4+p>>2]=y,n=c[4+v>>2],x=i+c[m>>2]|0,c[x>>2]=c[v>>2],c[x+4>>2]=n,n=c[b+4>>2],c[(y=x+8|0)>>2]=c[b>>2],c[y+4>>2]=n,b=c[4+h>>2],c[(y=x+24|0)>>2]=c[h>>2],c[y+4>>2]=b,y=c[20+v>>2],c[x+16>>2]=c[16+v>>2],c[x+20>>2]=y,b=c[4+o>>2],c[(y=x+40|0)>>2]=c[o>>2],c[y+4>>2]=b,y=c[36+v>>2],c[x+32>>2]=c[32+v>>2],c[x+36>>2]=y,b=c[4+u>>2],c[(y=x+56|0)>>2]=c[u>>2],c[y+4>>2]=b,y=c[52+v>>2],c[x+48>>2]=c[48+v>>2],c[x+52>>2]=y,b=c[4+s>>2],c[(y=x+72|0)>>2]=c[s>>2],c[y+4>>2]=b,y=c[68+v>>2],c[x+64>>2]=c[64+v>>2],c[x+68>>2]=y,c[e+72>>2]&&(c[c[76+(c[e+32>>2]+d|0)>>2]+36>>2]=t),c[e+24>>2]=c[e+24>>2]-1,N=80+v|0}function mt(e,t,n,i,o,a,r,s,l,_){t|=0,i|=0,o|=0,a|=0,r|=0,s|=0,l|=0,e=c[32+(e|=0)>>2]+((_|=0)<<5)|0,c[(n|=0)>>2]=c[e+12>>2],c[o>>2]=c[e+20>>2],c[t>>2]=c[e+16>>2],c[i>>2]=c[e+28>>2],c[s>>2]=c[e>>2],c[a>>2]=c[e+4>>2],c[l>>2]=c[e+24>>2],c[r>>2]=c[e+8>>2]}function At(){}function vt(e){var t=0;return c[(e|=0)>>2]=9704,(t=c[e+156>>2])&&p[e+160|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+156>>2]=0,a[e+160|0]=1,c[(t=e+148|0)>>2]=0,c[t+4>>2]=0,(t=c[e+136>>2])&&p[e+140|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+136>>2]=0,a[e+140|0]=1,c[(t=e+128|0)>>2]=0,c[t+4>>2]=0,(t=c[e+116>>2])&&p[e+120|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+116>>2]=0,a[e+120|0]=1,c[(t=e+108|0)>>2]=0,c[t+4>>2]=0,(t=c[e+96>>2])&&p[e+100|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+96>>2]=0,c[e>>2]=9592,a[e+100|0]=1,c[(t=e+88|0)>>2]=0,c[t+4>>2]=0,(t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+32>>2]=0,a[e+36|0]=1,c[(t=e+24|0)>>2]=0,(c[t+4>>2]=0)|e}function gt(e){return c[24+(e|=0)>>2]}function xt(e,t){var n,i=0,o=0,r=0,l=0,_=0,u=0;if(p[e+164|0]){if((0|(r=c[e+128>>2]))==c[e+132>>2]&&!((0|(l=r?r<<1:1))<=(0|r))){l&&(c[5498]=c[5498]+1,(i=M(19+(l<<2)|0))&&(c[(o=i+19&-16)-4>>2]=i)),_=c[e+136>>2];e:{if(1<=(0|r))for(i=o,u=_;c[i>>2]=c[u>>2],i=i+4|0,u=u+4|0,r=r-1|0;);else if(!_)break e;p[e+140|0]&&(c[5499]=c[5499]+1,z(c[_-4>>2])),r=c[e+128>>2]}c[e+136>>2]=o,c[e+132>>2]=l,a[e+140|0]=1}return o=c[e+136>>2],c[o+(r<<2)>>2]=t,c[c[e+32>>2]+4>>2]=o,void(c[e+128>>2]=c[e+128>>2]+1)}if((0|(o=c[e+148>>2]))==c[e+152>>2]&&!((0|(n=o?o<<1:1))<=(0|o))){n&&(c[5498]=c[5498]+1,(i=M(19+(n<<1)|0))&&(c[(l=i+19&-16)-4>>2]=i)),_=c[e+156>>2];e:{if(1<=(0|o))for(i=l,u=_,r=o;s[i>>1]=d[u>>1],i=i+2|0,u=u+2|0,r=r-1|0;);else if(!_)break e;p[e+160|0]&&(c[5499]=c[5499]+1,z(c[_-4>>2]),o=c[e+148>>2])}c[e+156>>2]=l,c[e+152>>2]=n,a[e+160|0]=1}c[e+148>>2]=o+1,i=c[e+32>>2],e=c[e+156>>2],c[i+4>>2]=e,s[e+(o<<1)>>1]=t}function yt(e,t,n){var i=0,o=0,r=0,s=0,l=0,_=0,u=x(0),h=x(0),f=x(0),d=x(0),m=x(0),v=x(0);e:{if(p[e+165|0]){if(!((0|(r=c[e+88>>2]))<1)&&n)for(n=c[e+96>>2],f=A[e+168>>2],d=A[t+8>>2],m=A[t+4>>2],v=A[t>>2];;){if(u=x(A[n>>2]-v),h=x(u*u),u=x(A[n+4>>2]-m),h=x(h+x(u*u)),u=x(A[n+8>>2]-d),f>=x(h+x(u*u)))break e;if(n=n+16|0,(0|(l=l+1|0))==(0|r))break}if(n=c[e+32>>2],c[n+12>>2]=c[n+12>>2]+1,c[e+92>>2]==(0|r)&&!((0|(l=r?r<<1:1))<=(0|r))){if(l&&(c[5498]=c[5498]+1,(n=M(19+(l<<4)|0))&&(c[(i=n+19&-16)-4>>2]=n)),1<=(0|r))for(n=0;o=c[e+96>>2]+n|0,s=c[o+4>>2],c[(_=n+i|0)>>2]=c[o>>2],c[_+4>>2]=s,s=c[4+(o=o+8|0)>>2],c[(_=_+8|0)>>2]=c[o>>2],c[_+4>>2]=s,n=n+16|0,r=r-1|0;);(n=c[e+96>>2])&&p[e+100|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+96>>2]=i,c[e+92>>2]=l,a[e+100|0]=1,r=c[e+88>>2]}return n=c[t+4>>2],i=c[(s=e+96|0)>>2]+(r<<4)|0,c[i>>2]=c[t>>2],c[i+4>>2]=n,t=c[4+(n=t+8|0)>>2],c[(i=i+8|0)>>2]=c[n>>2],c[i+4>>2]=t,c[c[e+32>>2]+16>>2]=c[s>>2],e=c[(t=e)+88>>2],c[t+88>>2]=e+1,e}if(!((0|(o=c[e+108>>2]))<1)&&n)for(n=c[e+116>>2],f=A[e+168>>2],d=A[t+8>>2],m=A[t+4>>2],v=A[t>>2];;){if(u=x(A[n>>2]-v),h=x(u*u),u=x(A[n+4>>2]-m),h=x(h+x(u*u)),u=x(A[n+8>>2]-d),f>=x(h+x(u*u)))break e;if(n=n+12|0,l=l+1|0,!((0|(r=r+3|0))<(0|o)))break}if((0|o)==(0|(i=c[e+112>>2])))if((0|(i=o?o<<1:1))<=(0|o))i=o;else{i&&(c[5498]=c[5498]+1,(n=M(19+(i<<2)|0))&&(c[(s=n+19&-16)-4>>2]=n)),_=c[e+116>>2];t:{if(1<=(0|o))for(n=s,l=_,r=o;A[n>>2]=A[l>>2],n=n+4|0,l=l+4|0,r=r-1|0;);else if(!_)break t;p[e+120|0]&&(c[5499]=c[5499]+1,z(c[_-4>>2]),o=c[e+108>>2])}c[e+116>>2]=s,c[e+112>>2]=i,a[e+120|0]=1}if(c[e+108>>2]=n=o+1|0,_=c[e+116>>2],A[_+(o<<2)>>2]=A[t>>2],(0|n)==(0|i))if((0|(o=i?i<<1:1))<=(0|i))o=i,s=_;else{s=0,o&&(c[5498]=c[5498]+1,(n=M(19+(o<<2)|0))&&(c[(s=n+19&-16)-4>>2]=n,_=c[e+116>>2]));t:{if(1<=(0|i))for(n=s,l=_,r=i;A[n>>2]=A[l>>2],n=n+4|0,l=l+4|0,r=r-1|0;);else if(!_)break t;p[e+120|0]&&(c[5499]=c[5499]+1,z(c[_-4>>2]),i=c[e+108>>2])}c[e+116>>2]=s,c[e+112>>2]=o,a[e+120|0]=1}else o=i,s=_,i=n;if(c[e+108>>2]=n=i+1|0,A[(i<<2)+s>>2]=A[t+4>>2],(0|n)==(0|o))if((0|(_=o?o<<1:1))<=(0|o))i=s;else{i=0,_&&(c[5498]=c[5498]+1,(n=M(19+(_<<2)|0))&&(c[(i=n+19&-16)-4>>2]=n,s=c[e+116>>2]));t:{if(1<=(0|o))for(n=i,l=s,r=o;A[n>>2]=A[l>>2],n=n+4|0,l=l+4|0,r=r-1|0;);else if(!s)break t;p[e+120|0]&&(c[5499]=c[5499]+1,z(c[s-4>>2]),o=c[e+108>>2])}c[e+116>>2]=i,c[e+112>>2]=_,a[e+120|0]=1}else i=s,o=n;c[e+108>>2]=n=o+1|0,A[(o<<2)+i>>2]=A[t+8>>2],e=c[e+32>>2],c[e+16>>2]=i,c[e+12>>2]=c[e+12>>2]+1,l=((0|n)/3|0)-1|0}return l}function bt(e,t){var n,i,o,a;N=a=N-48|0,o=c[4+(t|=0)>>2],i=c[56+(e|=0)>>2],c[(n=i)+4>>2]=c[t>>2],c[n+8>>2]=o,n=c[4+(t=t+8|0)>>2],c[(i=i+12|0)>>2]=c[t>>2],c[4+i>>2]=n,c[44+a>>2]=0,c[36+a>>2]=0,c[40+a>>2]=0,c[32+a>>2]=1065353216,pi[c[c[e>>2]+68>>2]](16+a|0,e,32+a|0),A[e+40>>2]=A[16+a>>2]+A[e+20>>2],c[32+a>>2]=-1082130432,pi[c[c[e>>2]+68>>2]](a,e,32+a|0),n=c[4+(i=8+a|0)>>2],c[(t=24+a|0)>>2]=c[i>>2],c[t+4>>2]=n,n=c[4+a>>2],c[16+a>>2]=c[a>>2],c[20+a>>2]=n,A[e+24>>2]=A[16+a>>2]-A[e+20>>2],c[(n=40+a|0)>>2]=0,c[4+n>>2]=0,c[32+a>>2]=0,c[36+a>>2]=0,c[36+a>>2]=1065353216,pi[c[c[e>>2]+68>>2]](16+a|0,e,32+a|0),A[e+44>>2]=A[20+a>>2]+A[e+20>>2],c[36+a>>2]=-1082130432,pi[c[c[e>>2]+68>>2]](a,e,32+a|0),o=c[4+i>>2],c[t>>2]=c[i>>2],c[t+4>>2]=o,o=c[4+a>>2],c[16+a>>2]=c[a>>2],c[20+a>>2]=o,A[e+28>>2]=A[20+a>>2]-A[e+20>>2],c[n>>2]=0,c[4+n>>2]=0,c[n>>2]=1065353216,c[32+a>>2]=0,c[36+a>>2]=0,pi[c[c[e>>2]+68>>2]](16+a|0,e,32+a|0),c[n>>2]=-1082130432,A[e+48>>2]=A[t>>2]+A[e+20>>2],pi[c[c[e>>2]+68>>2]](a,e,32+a|0),n=c[4+i>>2],c[t>>2]=c[i>>2],c[t+4>>2]=n,i=c[4+a>>2],c[16+a>>2]=c[a>>2],c[20+a>>2]=i,A[e+32>>2]=A[t>>2]-A[e+20>>2],N=48+a|0}function St(e){var t=0;return c[(e|=0)>>2]=10128,(t=c[e+160>>2])&&p[e+164|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+160>>2]=0,a[e+164|0]=1,c[(t=e+152|0)>>2]=0,c[t+4>>2]=0,(t=c[e+136>>2])&&p[e+140|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+136>>2]=0,a[e+140|0]=1,c[(t=e+128|0)>>2]=0,c[t+4>>2]=0,(t=c[e+116>>2])&&p[e+120|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+116>>2]=0,a[e+120|0]=1,c[(t=e+108|0)>>2]=0,c[t+4>>2]=0,(t=c[e+96>>2])&&p[e+100|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+96>>2]=0,a[e+100|0]=1,c[(t=e+88|0)>>2]=0,c[t+4>>2]=0,(t=c[e+76>>2])&&p[e+80|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+76>>2]=0,a[e+80|0]=1,c[(t=e+68|0)>>2]=0,(c[t+4>>2]=0)|e}function Ct(e,t,n,i){t|=0,n|=0,i|=0;var o=0,r=0,l=0,_=0,u=0,h=0,f=0,m=0;if(c[168+(e|=0)>>2]=c[e+152>>2],a[t+80|0]=1,a[t+60|0]=0,c[t+52>>2]=287,c[t>>2]=10128,c[t+76>>2]=0,a[t+100|0]=1,c[t+68>>2]=0,c[t+72>>2]=0,c[t+96>>2]=0,a[t+120|0]=1,c[t+88>>2]=0,c[t+92>>2]=0,c[t+116>>2]=0,a[t+140|0]=1,c[t+108>>2]=0,c[t+112>>2]=0,c[t+136>>2]=0,c[t+144>>2]=0,a[t+164|0]=1,c[t+128>>2]=0,c[t+132>>2]=0,c[t+152>>2]=0,c[t+156>>2]=0,c[t+4>>2]=-8388609,c[t+8>>2]=-8388609,c[t+12>>2]=-8388609,c[t+16>>2]=0,c[t+20>>2]=2139095039,c[t+24>>2]=2139095039,c[t+28>>2]=2139095039,c[t+32>>2]=0,c[t+168>>2]=0,c[t+160>>2]=0,n=c[e+56>>2],n=i?(c[t+56>>2]=n<<8&16711680|n<<24|n>>>8&65280|n>>>24,a[t+4|0]=p[e+7|0],a[t+5|0]=p[e+6|0],a[t+6|0]=p[e+5|0],a[t+7|0]=p[e+4|0],a[t+8|0]=p[e+11|0],a[t+9|0]=p[e+10|0],a[t+10|0]=p[e+9|0],a[t+11|0]=p[e+8|0],a[t+12|0]=p[e+15|0],a[t+13|0]=p[e+14|0],a[t+14|0]=p[e+13|0],a[t+15|0]=p[e+12|0],a[t+16|0]=p[e+19|0],a[t+17|0]=p[e+18|0],a[t+18|0]=p[e+17|0],a[t+19|0]=p[e+16|0],a[t+20|0]=p[e+23|0],a[t+21|0]=p[e+22|0],a[t+22|0]=p[e+21|0],a[t+23|0]=p[e+20|0],a[t+24|0]=p[e+27|0],a[t+25|0]=p[e+26|0],a[t+26|0]=p[e+25|0],a[t+27|0]=p[e+24|0],a[t+28|0]=p[e+31|0],a[t+29|0]=p[e+30|0],a[t+30|0]=p[e+29|0],a[t+31|0]=p[e+28|0],a[t+32|0]=p[e+35|0],a[t+33|0]=p[e+34|0],a[t+34|0]=p[e+33|0],a[t+35|0]=p[e+32|0],a[t+36|0]=p[e+39|0],a[t+37|0]=p[e+38|0],a[t+38|0]=p[e+37|0],a[t+39|0]=p[e+36|0],a[t+40|0]=p[e+43|0],a[t+41|0]=p[e+42|0],a[t+42|0]=p[e+41|0],a[t+43|0]=p[e+40|0],a[t+44|0]=p[e+47|0],a[t+45|0]=p[e+46|0],a[t+46|0]=p[e+45|0],a[t+47|0]=p[e+44|0],a[t+48|0]=p[e+51|0],a[t+49|0]=p[e+50|0],a[t+50|0]=p[e+49|0],a[t+51|0]=p[e+48|0],n=c[e+144>>2],c[t+144>>2]=n<<24|n<<8&16711680|n>>>8&65280|n>>>24,(n=c[e+168>>2])<<24|n<<8&16711680|n>>>8&65280|n>>>24):(c[t+56>>2]=n,o=c[4+(u=e+12|0)>>2],c[(h=8+(n=t+4|0)|0)>>2]=c[u>>2],c[h+4>>2]=o,h=c[e+8>>2],c[n>>2]=c[e+4>>2],c[n+4>>2]=h,o=c[4+(u=e+28|0)>>2],c[(h=8+(n=t+20|0)|0)>>2]=c[u>>2],c[h+4>>2]=o,h=c[e+24>>2],c[n>>2]=c[e+20>>2],c[n+4>>2]=h,n=c[e+40>>2],c[t+36>>2]=c[e+36>>2],c[t+40>>2]=n,u=c[4+(h=e+44|0)>>2],c[(n=t+44|0)>>2]=c[h>>2],c[n+4>>2]=u,c[t+144>>2]=c[e+144>>2],c[e+168>>2]),a[t+60|0]=p[e+60|0],c[t+168>>2]=n,u=t+172|0,h=c[e+56>>2],p[e+60|0]){if((n=c[t+136>>2])&&p[t+140|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[t+136>>2]=u,a[t+140|0]=0,i){if(!((0|h)<1))for(f=c[e+136>>2],o=h;l=d[(r=_+f|0)>>1],s[172+(n=t+_|0)>>1]=(l<<24|l<<8&16711680)>>>16,l=d[r+2>>1],s[n+174>>1]=(l<<24|l<<8&16711680)>>>16,l=d[r+4>>1],s[n+176>>1]=(l<<24|l<<8&16711680)>>>16,l=d[r+6>>1],s[n+178>>1]=(l<<24|l<<8&16711680)>>>16,l=d[r+8>>1],s[n+180>>1]=(l<<24|l<<8&16711680)>>>16,l=c[r+12>>2],c[n+184>>2]=l<<24|l<<8&16711680|l>>>8&65280|l>>>24,l=n+182|0,n=d[r+10>>1],s[l>>1]=(n<<24|n<<8&16711680)>>>16,_=_+16|0,o=o-1|0;);}else if(!((0|h)<1))for(l=c[e+136>>2],n=h;s[172+(o=t+_|0)>>1]=d[(r=l+_|0)>>1],s[o+174>>1]=d[r+2>>1],s[o+176>>1]=d[r+4>>1],s[o+178>>1]=d[r+6>>1],s[o+180>>1]=d[r+8>>1],c[o+184>>2]=c[r+12>>2],s[o+182>>1]=d[r+10>>1],_=_+16|0,n=n-1|0;);l=t+128|0,_=h<<4}else{(n=c[t+96>>2])&&p[t+100|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[t+96>>2]=u,a[t+100|0]=0,c[t+92>>2]=h,c[t+88>>2]=h;e:{t:{if(!i){if(1<=(0|h))break t;n=u;break e}if((0|h)<1){n=u;break e}for(r=c[e+96>>2],_=40,o=h,n=u;a[(n=n+_|0)-40|0]=p[(r=r+_|0)-37|0],a[n-39|0]=p[r-38|0],a[n-38|0]=p[r-39|0],a[n-37|0]=p[r-40|0],a[n-36|0]=p[r-33|0],a[n-35|0]=p[r-34|0],a[n-34|0]=p[r-35|0],a[n-33|0]=p[r-36|0],a[n-32|0]=p[r-29|0],a[n-31|0]=p[r-30|0],a[n-30|0]=p[r-31|0],a[n-29|0]=p[r-32|0],a[n-28|0]=p[r-25|0],a[n-27|0]=p[r-26|0],a[n-26|0]=p[r-27|0],a[n-25|0]=p[r-28|0],n=c[t+96>>2]+_|0,r=c[e+96>>2]+_|0,a[n-24|0]=p[r-21|0],a[n-23|0]=p[r-22|0],a[n-22|0]=p[r-23|0],a[n-21|0]=p[r-24|0],a[n-20|0]=p[r-17|0],a[n-19|0]=p[r-18|0],a[n-18|0]=p[r-19|0],a[n-17|0]=p[r-20|0],a[n-16|0]=p[r-13|0],a[n-15|0]=p[r-14|0],a[n-14|0]=p[r-15|0],a[n-13|0]=p[r-16|0],a[n-12|0]=p[r-9|0],a[n-11|0]=p[r-10|0],a[n-10|0]=p[r-11|0],a[n-9|0]=p[r-12|0],n=c[t+96>>2],r=c[e+96>>2],l=c[(m=_+r|0)>>2],c[(f=_+n|0)>>2]=l<<24|l<<8&16711680|l>>>8&65280|l>>>24,l=c[m-8>>2],c[f-8>>2]=l<<24|l<<8&16711680|l>>>8&65280|l>>>24,l=c[m-4>>2],c[f-4>>2]=l<<24|l<<8&16711680|l>>>8&65280|l>>>24,_=_- -64|0,o=o-1|0;);break e}for(o=c[e+96>>2],l=40,r=h,n=u;_=c[4+(o=(o+l|0)-40|0)>>2],c[(n=(n+l|0)-40|0)>>2]=c[o>>2],c[n+4>>2]=_,_=c[4+(o=o+8|0)>>2],c[(n=n+8|0)>>2]=c[o>>2],c[n+4>>2]=_,o=(c[e+96>>2]+l|0)-24|0,_=c[o+4>>2],n=(c[t+96>>2]+l|0)-24|0,c[n>>2]=c[o>>2],c[n+4>>2]=_,_=c[4+(o=o+8|0)>>2],c[(n=n+8|0)>>2]=c[o>>2],c[n+4>>2]=_,n=c[t+96>>2],o=c[e+96>>2],c[(_=l+n|0)>>2]=c[(f=o+l|0)>>2],c[_-4>>2]=c[f-4>>2],c[_-8>>2]=c[f-8>>2],l=l- -64|0,r=r-1|0;);}l=t+88|0,_=h<<6,p[t+100|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2]))}if(c[l>>2]=0,c[l+4>>2]=0,a[0|(n=l+5|0)]=0,a[n+1|0]=0,a[n+2|0]=0,a[n+3|0]=0,a[n+4|0]=0,a[n+5|0]=0,a[n+6|0]=0,n=_+u|(a[n+7|0]=0),(h=c[t+160>>2])&&p[t+164|0]&&(c[5499]=c[5499]+1,z(c[h-4>>2])),h=t+152|0,a[t+164|0]=0,c[t+160>>2]=n,n=c[e+168>>2],i){if(!((0|n)<1))for(r=t+_|0,_=c[e+160>>2],e=0;o=d[(u=e+_|0)>>1],s[172+(i=e+r|0)>>1]=(o<<24|o<<8&16711680)>>>16,o=d[u+2>>1],s[i+174>>1]=(o<<24|o<<8&16711680)>>>16,o=d[u+4>>1],s[i+176>>1]=(o<<24|o<<8&16711680)>>>16,o=d[u+6>>1],s[i+178>>1]=(o<<24|o<<8&16711680)>>>16,o=d[u+8>>1],s[i+180>>1]=(o<<24|o<<8&16711680)>>>16,o=c[u+12>>2],c[i+184>>2]=o<<24|o<<8&16711680|o>>>8&65280|o>>>24,o=c[u+16>>2],c[i+188>>2]=o<<24|o<<8&16711680|o>>>8&65280|o>>>24,o=i+182|0,i=d[u+10>>1],s[o>>1]=(i<<24|i<<8&16711680)>>>16,e=e+32|0,n=n-1|0;);}else if(!((0|n)<1))for(o=t+_|0,r=c[e+160>>2],n=_=0;s[172+(i=o+_|0)>>1]=d[(u=r+_|0)>>1],s[i+174>>1]=d[u+2>>1],s[i+176>>1]=d[u+4>>1],s[i+178>>1]=d[u+6>>1],s[i+180>>1]=d[u+8>>1],f=c[4+(l=u+12|0)>>2],l=c[l>>2],c[i+200>>2]=0,c[(m=i+184|0)>>2]=l,c[m+4>>2]=f,u=d[u+10>>1],c[(l=i+192|0)>>2]=0,c[l+4>>2]=0,s[i+182>>1]=u,_=_+32|0,(0|(n=n+1|0))<c[e+168>>2];);return c[(e=h)>>2]=0,c[e+4>>2]=0,c[t>>2]=0,a[0|(e=e+5|0)]=0,a[e+1|0]=0,a[e+2|0]=0,a[e+3|0]=0,a[e+4|0]=0,a[e+5|0]=0,a[e+6|0]=0,a[e+7|0]=0,1}function Et(e,t,n,i,o,a,r,s){var l,_,u,h,f,p,d,m,v,g,y,b,S,C,E,P,w,I,R,D=0,O=0,M=x(0),z=x(0),L=x(0),F=x(0),B=0,k=x(0),U=x(0),G=0,j=x(0),V=x(0),H=x(0),W=0,q=0,Y=0;N=R=N-32|0;e:if(!((0|(Y=c[e+56>>2]))<1))for(M=A[n+8>>2],V=F=x(a-M),k=A[n>>2],z=x(i-k),U=A[n+4>>2],L=x(o-U),j=x(x(1)/x(T(x(x(x(z*z)+x(L*L))+x(F*F))))),F=x(F*j),z=x((H=z)*j),L=x((l=L)*j),l=x(x(V*F)+x(x(H*z)+x(l*L))),j=A[s+8>>2],h=x((M<a?a:M)+j),V=A[s+4>>2],f=x((U<o?o:U)+V),H=A[s>>2],p=x((k<i?i:k)+H),M=a<M?a:M,a=A[r+8>>2],d=x(M+a),M=o<U?o:U,o=A[r+4>>2],m=x(M+o),M=i<k?i:k,i=A[r>>2],v=x(M+i),O=c[e+96>>2],g=((D=(M=F==x(0)?x(0xde0b6b000000000):x(x(1)/F))<x(0))<<4)+R|8,y=((B=(k=L==x(0)?x(0xde0b6b000000000):x(x(1)/L))<x(0))<<4)+R|4,b=(!D<<4)+R|8,S=(!B<<4)+R|4,C=((D=(U=z==x(0)?x(0xde0b6b000000000):x(x(1)/z))<x(0))<<4)+R|0,E=(!D<<4)+R|0,_=16+R|0,W=1;;){B=c[(D=O+8|0)>>2],D=c[D+4>>2],P=c[O>>2],w=c[O+4>>2],G=c[O+20>>2],c[_>>2]=c[O+16>>2],c[4+_>>2]=G,I=c[4+(G=O+24|0)>>2],c[(u=8+_|0)>>2]=c[G>>2],c[4+u>>2]=I,c[R>>2]=P,c[4+R>>2]=w,c[8+R>>2]=B,c[12+R>>2]=D,A[R>>2]=A[R>>2]-H,A[4+R>>2]=A[4+R>>2]-V,A[16+R>>2]=A[16+R>>2]-i,A[20+R>>2]=A[20+R>>2]-o,A[8+R>>2]=A[8+R>>2]-j,A[24+R>>2]=A[24+R>>2]-a,D=0,A[O+16>>2]<v||(D=0,A[O>>2]>p||(D=1)),B=0,A[G>>2]<d||A[O+8>>2]>h||(B=D);t:{n:{i:{o:{if(!(A[O+20>>2]<m||1^B|A[O+4>>2]>f||(z=A[n+4>>2],i=x(k*x(A[y>>2]-z)),a=A[n>>2],(o=x(U*x(A[E>>2]-a)))<i||(a=x(U*x(A[C>>2]-a)),(z=x(k*x(A[S>>2]-z)))<a||(F=A[n+8>>2],(o=z<o?z:o)<(L=x(M*x(A[g>>2]-F)))||(i=a<i?i:a,(a=x(M*x(A[b>>2]-F)))<i)))))){if(G=-1==(0|(D=c[O+32>>2])),!(B=(i<L?L:i)<l&(a<o?a:o)>x(0)))break o;if(-1!=(0|D))break o;pi[c[c[t>>2]+8>>2]](t,c[O+36>>2],c[O+40>>2]),Y=c[e+56>>2];break i}G=-1==(0|(D=c[O+32>>2])),B=0}if(!G&&!B)break n}q=q+1|0,O=O- -64|0;break t}q=D+q|0,O=(D<<6)+O|0}if((0|Y)<=(0|q))break e;W=W+1|0,a=A[r+8>>2],o=A[r+4>>2],i=A[r>>2],j=A[s+8>>2],V=A[s+4>>2],H=A[s>>2]}c[5592]<(0|W)&&(c[5592]=W),N=32+R|0}function Tt(e,t,n,i,o,a,r,s,l){var _,u,h,f,p,m,v,g,y,b,S,C,E,P,w,I,R,D,O,M,z,L,F,B,k=x(0),U=0,G=0,j=x(0),V=x(0),H=x(0),W=0,q=0,Y=0,X=0,Q=0,Z=0;if(N=B=N-32|0,m=A[n+4>>2],v=A[n>>2],j=A[e+28>>2],h=A[e+12>>2],g=A[n+8>>2],k=x((a<g?a:g)+A[r+8>>2]),y=A[e+44>>2],W=(k=x(x((j<(k=k<h?h:k)?j:k)-h)*y))<x(4294967296)&k>=x(0)?~~k>>>0:0,V=A[e+24>>2],f=A[e+8>>2],k=x((o<m?o:m)+A[r+4>>2]),_=A[e+40>>2],q=(k=x(x((V<(k=k<f?f:k)?V:k)-f)*_))<x(4294967296)&k>=x(0)?~~k>>>0:0,H=A[e+20>>2],p=A[e+4>>2],k=x((i<v?i:v)+A[r>>2]),u=A[e+36>>2],Y=(k=x(x((H<(k=k<p?p:k)?H:k)-p)*u))<x(4294967296)&k>=x(0)?~~k>>>0:0,k=x((g<a?a:g)+A[s+8>>2]),X=(k=x(x(x((j<(k=k<h?h:k)?j:k)-h)*y)+x(1)))<x(4294967296)&k>=x(0)?~~k>>>0:0,k=x((m<o?o:m)+A[s+4>>2]),G=(k=x(x(x((V<(k=k<f?f:k)?V:k)-f)*_)+x(1)))<x(4294967296)&k>=x(0)?~~k>>>0:0,k=x((v<i?i:v)+A[s>>2]),U=(k=x(x(x((H<(k=k<p?p:k)?H:k)-p)*u)+x(1)))<x(4294967296)&k>=x(0)?~~k>>>0:0,1<=(0|l))for(a=k=x(a-g),_=x(i-v),u=x(o-m),i=x(x(1)/x(T(x(x(x(_*_)+x(u*u))+x(k*k))))),k=x(k*i),o=x(_*i),i=x(u*i),y=x(x(a*k)+x(x(_*o)+x(u*i))),C=65534&W,E=65534&q,P=65534&Y,w=1|X,I=1|G,R=1|U,D=((G=(j=k==x(0)?x(0xde0b6b000000000):x(x(1)/k))<x(0))<<4)+B|8,O=((U=(V=i==x(0)?x(0xde0b6b000000000):x(x(1)/i))<x(0))<<4)+B|4,M=(!G<<4)+B|8,z=(!U<<4)+B|4,U=c[e+136>>2],L=((G=(H=o==x(0)?x(0xde0b6b000000000):x(x(1)/o))<x(0))<<4)+B|0,F=(!G<<4)+B|0;;){b=c[U+12>>2],G=0;e:{t:{n:{i:if(!(d[U+6>>1]<P>>>0||R>>>0<(S=d[U>>1])>>>0||d[U+10>>1]<C>>>0||w>>>0<(W=d[U+4>>1])>>>0||d[U+8>>1]<E>>>0||I>>>0<(q=d[U+2>>1])>>>0)){if(c[12+B>>2]=0,Y=d[U+10>>1],X=d[U+8>>1],G=d[U+6>>1],c[28+B>>2]=0,_=A[e+36>>2],u=A[e+4>>2],A[B>>2]=x(x(x(S>>>0)/_)+u)-A[s>>2],k=A[e+40>>2],a=A[e+8>>2],A[4+B>>2]=x(x(x(q>>>0)/k)+a)-A[s+4>>2],o=A[e+44>>2],i=A[e+12>>2],A[8+B>>2]=x(x(x(W>>>0)/o)+i)-A[s+8>>2],A[16+B>>2]=x(u+x(x(G>>>0)/_))-A[r>>2],A[20+B>>2]=x(a+x(x(X>>>0)/k))-A[r+4>>2],A[24+B>>2]=x(i+x(x(Y>>>0)/o))-A[r+8>>2],o=A[n+4>>2],_=x(V*x(A[O>>2]-o)),i=A[n>>2],!((a=x(H*x(A[F>>2]-i)))<_||(u=x(H*x(A[L>>2]-i)),(o=x(V*x(A[z>>2]-o)))<u||(i=A[n+8>>2],(a=o<a?o:a)<(k=x(j*x(A[D>>2]-i)))||(o=u<_?_:u,(i=x(j*x(A[M>>2]-i)))<o))))){if(G=(o<k?k:o)<y&(i<a?i:a)>x(0),(0|b)<0)break i;if(!G)break i;G=c[U+12>>2],pi[c[c[t>>2]+8>>2]](t,G>>21,2097151&G);break n}G=0}if(!(-1<(0|b)||G))break t}Q=Q+1|0,U=U+16|0;break e}Q=Q-(G=c[U+12>>2])|0,U=U-(G<<4)|0}if(Z=Z+1|0,!((0|Q)<(0|l)))break}c[5592]<(0|Z)&&(c[5592]=Z),N=32+B|0}function Pt(){return 84}function wt(e,t,n,i,o){var r,l,_,u,h,f,m=0,v=x(0),g=x(0),y=0,b=0,S=0,C=x(0),E=x(0),T=x(0),P=0,w=0,I=x(0),R=x(0),D=x(0),O=x(0);if(N=f=N-112|0,a[e+60|0]=n){if(v=A[i>>2],E=A[i+4>>2],T=A[i+8>>2],c[e+16>>2]=0,I=x(T+x(-1)),A[e+12>>2]=I,E=x(E+x(-1)),A[e+8>>2]=E,v=x(v+x(-1)),A[e+4>>2]=v,a[e+60|0]=1,T=A[o>>2],g=A[o+4>>2],R=A[o+8>>2],c[e+32>>2]=0,_=x(R+x(1)),A[e+28>>2]=_,R=x(g+x(1)),A[e+24>>2]=R,T=x(T+x(1)),A[e+20>>2]=T,D=x(_-I),O=x(x(65533)/D),A[e+44>>2]=O,g=x(x(65533)/x(R-E)),A[e+40>>2]=g,l=x(x(65533)/x(T-v)),A[e+36>>2]=l,n=(C=x(x(I-I)*O))<x(4294967296)&C>=x(0)?~~C>>>0:0,h=x((65534&n)>>>0),n=(C=x(x((u=E)-E)*g))<x(4294967296)&C>=x(0)?~~C>>>0:0,u=x(u+x(x((65534&n)>>>0)/g)),n=(C=x(x((g=v)-v)*l))<x(4294967296)&C>=x(0)?~~C>>>0:0,(g=x(x(g+x(x((65534&n)>>>0)/l))+x(-1)))<v&&(v=A[e+4>>2]=g),(g=x(u+x(-1)))<E&&(E=A[e+8>>2]=g),(g=x(x(I+x(h/O))+x(-1)))<I&&(A[e+12>>2]=g,D=x(_-g),O=x(x(65533)/D),I=g),g=x(R-E),l=x(x(65533)/g),n=(g=x(x(l*g)+x(1)))<x(4294967296)&g>=x(0)?~~g>>>0:0,l=x(x((1|n)>>>0)/l),v=x(T-(g=v)),C=x(x(65533)/v),n=(v=x(x(C*v)+x(1)))<x(4294967296)&v>=x(0)?~~v>>>0:0,i=!(T<(v=x(x(g+x(x((1|n)>>>0)/C))+x(1)))),n=(D=x(x(O*D)+x(1)))<x(4294967296)&D>=x(0)?~~D>>>0:0,i||(T=A[e+20>>2]=v),R<(v=x(x(E+l)+x(1)))&&(R=A[e+24>>2]=v),_<(v=x(x(I+x(x((1|n)>>>0)/O))+x(1)))&&(A[e+28>>2]=v,O=x(x(65533)/x(v-I))),c[e+48>>2]=0,A[e+44>>2]=O,A[e+40>>2]=x(65533)/x(R-E),A[e+36>>2]=x(65533)/x(T-g),c[96+f>>2]=e,c[92+f>>2]=e+104,c[88+f>>2]=10352,pi[c[c[t>>2]+8>>2]](t,88+f|0,e+4|0,e+20|0),P=c[e+108>>2],c[(t=16+f|0)>>2]=0,c[t+4>>2]=0,c[8+f>>2]=0,((c[12+f>>2]=0)|(i=c[e+128>>2]))<(0|(o=P<<1))){if((0|o)>c[e+132>>2]){if(P&&(c[5498]=c[5498]+1,(t=M(P<<5|19))&&(c[(b=t+19&-16)-4>>2]=t)),1<=(0|i))for(n=0,t=i;m=c[e+136>>2]+n|0,S=c[m+4>>2],c[(y=w=n+b|0)>>2]=c[m>>2],c[y+4>>2]=S,y=c[4+(m=m+8|0)>>2],c[(w=w+8|0)>>2]=c[m>>2],c[w+4>>2]=y,n=n+16|0,t=t-1|0;);(t=c[e+136>>2])&&p[e+140|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+136>>2]=b,c[e+132>>2]=o,a[e+140|0]=1}for(n=i<<4,t=i-(P<<1)|0;b=c[12+f>>2],i=c[e+136>>2]+n|0,c[i>>2]=c[8+f>>2],c[i+4>>2]=b,b=c[4+(m=16+f|0)>>2],c[(i=i+8|0)>>2]=c[m>>2],c[i+4>>2]=b,n=n+16|0,(i=t)>>>0<=(t=t+1|0)>>>0;);}c[e+128>>2]=o}else{if(c[104+f>>2]=10372,c[108+f>>2]=e- -64,c[96+f>>2]=-581039253,c[100+f>>2]=0,c[88+f>>2]=-581039253,c[92+f>>2]=-581039253,c[80+f>>2]=1566444395,c[84+f>>2]=0,c[72+f>>2]=1566444395,c[76+f>>2]=1566444395,pi[c[c[t>>2]+8>>2]](t,104+f|0,88+f|0,72+f|0),P=c[e+68>>2],c[(t=f+64|0)>>2]=0,c[t+4>>2]=0,c[(t=56+f|0)>>2]=0,c[t+4>>2]=0,c[(t=48+f|0)>>2]=0,c[t+4>>2]=0,c[(t=40+f|0)>>2]=0,c[t+4>>2]=0,c[(t=32+f|0)>>2]=0,c[t+4>>2]=0,c[(t=24+f|0)>>2]=0,c[t+4>>2]=0,c[(t=16+f|0)>>2]=0,c[t+4>>2]=0,c[8+f>>2]=0,((c[12+f>>2]=0)|(n=c[e+88>>2]))<(0|(w=P<<1))){if((0|w)>c[e+92>>2]){if(P&&(c[5498]=c[5498]+1,(t=M(P<<7|19))&&(c[(b=t+19&-16)-4>>2]=t)),1<=(0|n))for(i=0,o=n;m=c[e+96>>2]+i|0,r=c[m+4>>2],c[(t=i+b|0)>>2]=c[m>>2],c[t+4>>2]=r,r=c[4+(y=m+56|0)>>2],c[(S=t+56|0)>>2]=c[y>>2],c[S+4>>2]=r,r=c[4+(S=m+48|0)>>2],c[(y=t+48|0)>>2]=c[S>>2],c[y+4>>2]=r,r=c[4+(S=m+40|0)>>2],c[(y=t+40|0)>>2]=c[S>>2],c[y+4>>2]=r,r=c[4+(S=m+32|0)>>2],c[(y=t+32|0)>>2]=c[S>>2],c[y+4>>2]=r,r=c[4+(S=m+24|0)>>2],c[(y=t+24|0)>>2]=c[S>>2],c[y+4>>2]=r,r=c[4+(S=m+16|0)>>2],c[(y=t+16|0)>>2]=c[S>>2],c[y+4>>2]=r,y=c[4+(m=m+8|0)>>2],c[(t=t+8|0)>>2]=c[m>>2],c[t+4>>2]=y,i=i- -64|0,o=o-1|0;);(t=c[e+96>>2])&&p[e+100|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+96>>2]=b,c[e+92>>2]=w,a[e+100|0]=1}for(t=n<<6,i=n-(P<<1)|0;m=c[12+f>>2],n=c[e+96>>2]+t|0,c[n>>2]=c[8+f>>2],c[n+4>>2]=m,b=c[4+(m=f+64|0)>>2],c[(o=n+56|0)>>2]=c[m>>2],c[o+4>>2]=b,b=c[4+(m=56+f|0)>>2],c[(o=n+48|0)>>2]=c[m>>2],c[o+4>>2]=b,b=c[4+(m=48+f|0)>>2],c[(o=n+40|0)>>2]=c[m>>2],c[o+4>>2]=b,b=c[4+(m=40+f|0)>>2],c[(o=n+32|0)>>2]=c[m>>2],c[o+4>>2]=b,b=c[4+(m=32+f|0)>>2],c[(o=n+24|0)>>2]=c[m>>2],c[o+4>>2]=b,b=c[4+(m=24+f|0)>>2],c[(o=n+16|0)>>2]=c[m>>2],c[o+4>>2]=b,m=c[4+(o=16+f|0)>>2],c[(n=n+8|0)>>2]=c[o>>2],c[n+4>>2]=m,t=t- -64|0,(n=i)>>>0<=(i=n+1|0)>>>0;);}c[e+88>>2]=w}(function e(t,n,i){var o,r,l,_,u,h,f,m,v,g,y,b,S=0,C=0,E=x(0),T=0,P=0,w=0,I=0,R=0,D=x(0),O=x(0),L=0,F=x(0),B=0,k=0,U=x(0),G=x(0),j=x(0),V=x(0),H=x(0),W=0,q=0,Y=x(0),X=0,Q=0,Z=0,J=0,K=0,$=x(0),ee=x(0),te=x(0),ne=x(0);if(N=b=N-112|0,J=c[t+56>>2],1!=(0|(w=i-n|0))){if(k=(0|n)<(0|i)){if(T=p[t+60|0])for(S=c[t+116>>2]+(n<<4)|0,I=i-n|0,U=A[t+12>>2],G=A[t+8>>2],F=A[t+44>>2],D=A[t+40>>2],O=A[t+4>>2],E=A[t+36>>2];V=x(V+x(x(x(x(x(d[S+10>>1])/F)+U)+x(x(x(d[S+4>>1])/F)+U))*x(.5))),H=x(H+x(x(x(x(x(d[S+8>>1])/D)+G)+x(x(x(d[S+2>>1])/D)+G))*x(.5))),j=x(j+x(x(x(x(x(d[S+6>>1])/E)+O)+x(x(x(d[S>>1])/E)+O))*x(.5))),S=S+16|0,I=I-1|0;);else for(S=c[t+76>>2]+(n<<6)|0,I=i-n|0;V=x(V+x(x(A[S+24>>2]+A[S+8>>2])*x(.5))),H=x(H+x(x(A[S+20>>2]+A[S+4>>2])*x(.5))),j=x(j+x(x(A[S+16>>2]+A[S>>2])*x(.5))),S=S- -64|0,I=I-1|0;);if(te=x(0|w),E=x(x(1)/te),V=x(E*V),H=x(E*H),j=x(E*j),T)for(S=c[t+116>>2]+(n<<4)|0,I=i-n|0,Y=A[t+12>>2],U=A[t+8>>2],G=A[t+44>>2],F=A[t+40>>2],D=A[t+4>>2],O=A[t+36>>2];E=x(x(x(x(x(x(d[S+10>>1])/G)+Y)+x(x(x(d[S+4>>1])/G)+Y))*x(.5))-V),$=x($+x(E*E)),E=x(x(x(x(x(x(d[S+8>>1])/F)+U)+x(x(x(d[S+2>>1])/F)+U))*x(.5))-H),ne=x(ne+x(E*E)),E=x(x(x(x(x(x(d[S+6>>1])/O)+D)+x(x(x(d[S>>1])/O)+D))*x(.5))-j),ee=x(ee+x(E*E)),S=S+16|0,I=I-1|0;);else for(S=c[t+76>>2]+(n<<6)|0,I=i-n|0;E=x(x(x(A[S+24>>2]+A[S+8>>2])*x(.5))-V),$=x($+x(E*E)),E=x(x(x(A[S+20>>2]+A[S+4>>2])*x(.5))-H),ne=x(ne+x(E*E)),E=x(x(x(A[S+16>>2]+A[S>>2])*x(.5))-j),ee=x(ee+x(E*E)),S=S- -64|0,I=I-1|0;);}else te=x(0|w);if(c[28+b>>2]=0,V=x(0),H=x(0),j=x(0),!(C=(0|i)<=(0|n)))if(p[t+60|0])for(S=c[t+116>>2]+(n<<4)|0,I=i-n|0,U=A[t+12>>2],G=A[t+8>>2],F=A[t+44>>2],D=A[t+40>>2],O=A[t+4>>2],E=A[t+36>>2];V=x(x(x(x(x(x(d[S+10>>1])/F)+U)+x(x(x(d[S+4>>1])/F)+U))*x(.5))+V),H=x(x(x(x(x(x(d[S+8>>1])/D)+G)+x(x(x(d[S+2>>1])/D)+G))*x(.5))+H),j=x(x(x(x(x(x(d[S+6>>1])/E)+O)+x(x(x(d[S>>1])/E)+O))*x(.5))+j),S=S+16|0,I=I-1|0;);else for(S=c[t+76>>2]+(n<<6)|0,I=i-n|0;V=x(x(x(A[S+24>>2]+A[S+8>>2])*x(.5))+V),H=x(x(x(A[S+20>>2]+A[S+4>>2])*x(.5))+H),j=x(x(x(A[S+16>>2]+A[S>>2])*x(.5))+j),S=S- -64|0,I=I-1|0;);if(E=x(x(1)/x(0|w)),A[24+b>>2]=E*V,A[20+b>>2]=E*H,A[16+b>>2]=E*j,I=J,T=n,!C){for(D=x(x(1)/x(te+x(-1))),C=(O=x(D*ne))<(E=x(D*$))?2:1,te=E,E=x(D*ee),Y=A[(16+b|0)+((S=E<O?C:(E<te)<<1)<<2)>>2],X=i-n|0,I=n<<4,K=n<<6,Z=(S<<2)+b|0;E=(S=p[t+60|0])?(C=c[t+116>>2]+I|0,U=A[t+36>>2],G=A[t+4>>2],V=x(x(x(d[C>>1])/U)+G),F=A[t+44>>2],D=A[t+12>>2],H=x(x(x(d[C+4>>1])/F)+D),O=A[t+40>>2],E=A[t+8>>2],j=x(x(x(d[C+2>>1])/O)+E),ee=x(x(x(d[C+10>>1])/F)+D),$=x(x(x(d[C+6>>1])/U)+G),x(x(x(d[C+8>>1])/O)+E)):(C=c[t+76>>2]+K|0,V=A[C>>2],H=A[C+8>>2],j=A[C+4>>2],ee=A[C+24>>2],$=A[C+16>>2],A[C+20>>2]),c[12+b>>2]=0,A[8+b>>2]=x(ee+H)*x(.5),A[4+b>>2]=x(E+j)*x(.5),A[b>>2]=x($+V)*x(.5),Y<A[Z>>2]&&(S?(S=c[t+116>>2],Q=c[(P=S+I|0)>>2],W=c[P+4>>2],S=c[4+(C=q=(B=T<<4)+S|0)>>2],c[P>>2]=c[C>>2],c[P+4>>2]=S,R=c[(L=P+8|0)>>2],P=c[L+4>>2],S=c[4+(C=C+8|0)>>2],c[L>>2]=c[C>>2],c[L+4>>2]=S,S=B+c[t+116>>2]|0,c[S>>2]=Q,c[S+4>>2]=W,c[(S=S+8|0)>>2]=R,c[S+4>>2]=P):(S=c[t+76>>2],B=c[(o=S+K|0)>>2],q=c[4+o>>2],S=c[4+(C=r=(R=T<<6)+S|0)>>2],c[o>>2]=c[C>>2],c[4+o>>2]=S,S=c[4+(C=l=8+o|0)>>2],c[(P=_=40+b|0)>>2]=c[C>>2],c[P+4>>2]=S,S=c[4+(C=u=16+o|0)>>2],c[(P=h=48+b|0)>>2]=c[C>>2],c[P+4>>2]=S,S=c[4+(C=f=24+o|0)>>2],c[(P=m=56+b|0)>>2]=c[C>>2],c[P+4>>2]=S,S=c[4+(C=v=32+o|0)>>2],c[(P=g=64+b|0)>>2]=c[C>>2],c[P+4>>2]=S,S=c[4+(C=L=40+o|0)>>2],c[(P=y=72+b|0)>>2]=c[C>>2],c[P+4>>2]=S,S=c[4+(C=W=48+o|0)>>2],c[(P=Q=80+b|0)>>2]=c[C>>2],c[P+4>>2]=S,S=c[4+(o=56+o|0)>>2],c[(C=P=88+b|0)>>2]=c[o>>2],c[C+4>>2]=S,S=c[4+(C=8+r|0)>>2],c[l>>2]=c[C>>2],c[4+l>>2]=S,S=c[4+(C=16+r|0)>>2],c[u>>2]=c[C>>2],c[4+u>>2]=S,S=c[4+(C=24+r|0)>>2],c[f>>2]=c[C>>2],c[4+f>>2]=S,S=c[4+(C=32+r|0)>>2],c[v>>2]=c[C>>2],c[4+v>>2]=S,S=c[4+(C=40+r|0)>>2],c[L>>2]=c[C>>2],c[L+4>>2]=S,S=c[4+(C=48+r|0)>>2],c[W>>2]=c[C>>2],c[W+4>>2]=S,S=c[4+(C=56+r|0)>>2],c[o>>2]=c[C>>2],c[4+o>>2]=S,c[32+b>>2]=B,c[36+b>>2]=q,S=c[36+b>>2],R=R+c[t+76>>2]|0,c[R>>2]=c[32+b>>2],c[R+4>>2]=S,S=c[P+4>>2],c[(C=R+56|0)>>2]=c[P>>2],c[C+4>>2]=S,S=c[Q+4>>2],c[(C=R+48|0)>>2]=c[Q>>2],c[C+4>>2]=S,S=c[4+y>>2],c[(C=R+40|0)>>2]=c[y>>2],c[C+4>>2]=S,S=c[4+g>>2],c[(C=R+32|0)>>2]=c[g>>2],c[C+4>>2]=S,S=c[4+m>>2],c[(C=R+24|0)>>2]=c[m>>2],c[C+4>>2]=S,S=c[4+h>>2],c[(C=R+16|0)>>2]=c[h>>2],c[C+4>>2]=S,S=c[4+_>>2],c[(C=R+8|0)>>2]=c[_>>2],c[C+4>>2]=S),T=T+1|0),I=I+16|0,K=K- -64|0,X=X-1|0;);I=c[t+56>>2]}if(W=(w>>1)+n|0,R=((-1^(S=(0|w)/3|0))+i|0)<=(0|T),q=n+S|0,p[t+60|0]?(C=S=c[t+136>>2]+(I<<4)|0,P=(E=x(x(A[t+20>>2]-A[t+4>>2])*A[t+36>>2]))<x(4294967296)&E>=x(0)?~~E>>>0:0,s[C>>1]=65534&P,D=A[t+40>>2],O=A[t+8>>2],E=A[t+24>>2],C=S,P=(F=x(x(A[t+28>>2]-A[t+12>>2])*A[t+44>>2]))<x(4294967296)&F>=x(0)?~~F>>>0:0,s[C+4>>1]=65534&P,C=(E=x(D*x(E-O)))<x(4294967296)&E>=x(0)?~~E>>>0:0,s[S+2>>1]=65534&C):(S=c[4+(B=t+20|0)>>2],P=c[t+96>>2]+(I<<6)|0,c[(C=P)>>2]=c[B>>2],c[C+4>>2]=S,S=c[4+(C=B+8|0)>>2],c[(P=P+8|0)>>2]=c[C>>2],c[P+4>>2]=S),R=R?W:T,P=(0|T)<=(0|q),S=c[t+56>>2],p[t+60|0]?(S=C=c[t+136>>2]+(S<<4)|0,E=A[t+4>>2],T=(E=x(x(x(E-E)*A[t+36>>2])+x(1)))<x(4294967296)&E>=x(0)?~~E>>>0:0,s[S+6>>1]=1|T,O=A[t+40>>2],D=A[t+8>>2],S=C+10|0,E=A[t+12>>2],T=(E=x(x(x(E-E)*A[t+44>>2])+x(1)))<x(4294967296)&E>=x(0)?~~E>>>0:0,s[S>>1]=1|T,C=C+8|0,S=(E=x(x(O*x(D-D))+x(1)))<x(4294967296)&E>=x(0)?~~E>>>0:0,s[C>>1]=1|S):(C=c[t+96>>2]+(S<<6)|0,S=c[4+(q=t+4|0)>>2],c[C+16>>2]=c[q>>2],c[C+20>>2]=S,S=c[4+(T=q+8|0)>>2],c[(C=C+24|0)>>2]=c[T>>2],c[C+4>>2]=S),Q=P?W:R,k)for(K=n<<4,X=n<<6|16,Z=c[t+56>>2],B=p[t+60|0];B?(k=c[t+116>>2]+K|0,Y=A[t+36>>2],U=A[t+4>>2],S=(E=x(x(x(x(x(d[k>>1])/Y)+U)-U)*Y))<x(4294967296)&E>=x(0)?~~E>>>0:0,L=c[t+136>>2]+(Z<<4)|0,q=d[L>>1],G=A[t+44>>2],F=A[t+12>>2],R=(E=x(x(x(x(x(d[k+4>>1])/G)+F)-F)*G))<x(4294967296)&E>=x(0)?~~E>>>0:0,D=A[t+40>>2],O=A[t+8>>2],P=(E=x(x(x(x(x(d[k+2>>1])/D)+O)-O)*D))<x(4294967296)&E>=x(0)?~~E>>>0:0,C=(E=x(x(G*x(x(x(x(d[k+10>>1])/G)+F)-F))+x(1)))<x(4294967296)&E>=x(0)?~~E>>>0:0,W=65534&S,T=(E=x(x(D*x(x(x(x(d[k+8>>1])/D)+O)-O))+x(1)))<x(4294967296)&E>=x(0)?~~E>>>0:0,q=q>>>0<=W>>>0,S=(E=x(x(Y*x(x(x(x(d[k+6>>1])/Y)+U)-U))+x(1)))<x(4294967296)&E>=x(0)?~~E>>>0:0,q||(s[L>>1]=W),(S|=1)>>>0>d[L+6>>1]&&(s[L+6>>1]=S),(S=65534&P)>>>0<d[L+2>>1]&&(s[L+2>>1]=S),(S=1|T)>>>0>d[(P=L+8|0)>>1]&&(s[P>>1]=S),(S=65534&R)>>>0<d[L+4>>1]&&(s[L+4>>1]=S),(S=1|C)>>>0<=d[(T=L+10|0)>>1]||(s[T>>1]=S)):(S=c[t+76>>2]+X|0,j=A[S>>2],Y=A[S+12>>2],U=A[S+8>>2],G=A[S+4>>2],F=A[S-4>>2],D=A[S-8>>2],O=A[S-12>>2],E=A[S-16>>2],T=c[t+96>>2]+(Z<<6)|0,E<A[T>>2]&&(A[T>>2]=E),O<A[T+4>>2]&&(A[T+4>>2]=O),D<A[T+8>>2]&&(A[T+8>>2]=D),F<A[T+12>>2]&&(A[T+12>>2]=F),j>A[T+16>>2]&&(A[T+16>>2]=j),G>A[(S=T+20|0)>>2]&&(A[S>>2]=G),U>A[(S=T+24|0)>>2]&&(A[S>>2]=U),Y>A[(S=T+28|0)>>2]&&(A[S>>2]=Y)),K=K+16|0,X=X- -64|0,w=w-1|0;);else Z=c[t+56>>2];if(c[t+56>>2]=k=Z+1|0,e(t,n,Q),Z=c[t+56>>2],e(t,Q,i),Q=c[t+56>>2]-J|0,(S=p[t+60|0])&&!((0|Q)<129)){if(W=c[t+136>>2],q=-1<(0|(n=c[12+(W+(Z<<4)|0)>>2]))?1:0-n|0,(0|(P=-1<(0|(n=c[12+(W+(k<<4)|0)>>2]))?1:0-n|0))<=128){if((0|(S=n=c[t+152>>2]))==c[t+156>>2]&&!((0|(L=(S=n)?S<<1:1))<=(0|S))){if(X=0,L&&(c[5498]=c[5498]+1,(i=M(L<<5|19))&&(c[(X=i+19&-16)-4>>2]=i)),1<=(0|n))for(S=0,w=n;J=c[t+160>>2]+S|0,i=c[(R=J)+4>>2],c[(T=B=S+X|0)>>2]=c[R>>2],c[T+4>>2]=i,i=c[4+(T=R+24|0)>>2],c[(C=B+24|0)>>2]=c[T>>2],c[C+4>>2]=i,i=c[4+(T=R+16|0)>>2],c[(C=B+16|0)>>2]=c[T>>2],c[C+4>>2]=i,i=c[4+(T=R+8|0)>>2],c[(C=B+8|0)>>2]=c[T>>2],c[C+4>>2]=i,S=S+32|0,w=w-1|0;);(i=c[t+160>>2])&&p[t+164|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[t+160>>2]=X,c[t+156>>2]=L,a[t+164|0]=1,S=c[t+152>>2]}c[t+152>>2]=S+1,C=(w=n<<5)+c[(T=t+160|0)>>2]|0,n=c[36+b>>2],c[C>>2]=c[32+b>>2],c[C+4>>2]=n,n=c[4+(i=56+b|0)>>2],c[(S=C+24|0)>>2]=c[i>>2],c[S+4>>2]=n,n=c[4+(i=48+b|0)>>2],c[(S=C+16|0)>>2]=c[i>>2],c[S+4>>2]=n,n=c[4+(i=40+b|0)>>2],c[(S=C+8|0)>>2]=c[i>>2],c[S+4>>2]=n,i=w+c[T>>2]|0,s[i>>1]=d[(n=W+(k<<4)|0)>>1],s[i+2>>1]=d[n+2>>1],s[i+4>>1]=d[n+4>>1],s[i+6>>1]=d[n+6>>1],s[i+8>>1]=d[n+8>>1],c[i+16>>2]=P,c[i+12>>2]=k,s[i+10>>1]=d[n+10>>1]}if((0|q)<=128){if((0|(S=n=c[t+152>>2]))==c[t+156>>2]&&!((0|(k=(S=n)?S<<1:1))<=(0|S))){if(T=0,k&&(c[5498]=c[5498]+1,(i=M(k<<5|19))&&(c[(T=i+19&-16)-4>>2]=i)),1<=(0|n))for(S=0,w=n;J=c[t+160>>2]+S|0,i=c[(R=J)+4>>2],c[(C=B=S+T|0)>>2]=c[R>>2],c[C+4>>2]=i,i=c[4+(C=R+24|0)>>2],c[(P=B+24|0)>>2]=c[C>>2],c[P+4>>2]=i,i=c[4+(C=R+16|0)>>2],c[(P=B+16|0)>>2]=c[C>>2],c[P+4>>2]=i,i=c[4+(C=R+8|0)>>2],c[(P=B+8|0)>>2]=c[C>>2],c[P+4>>2]=i,S=S+32|0,w=w-1|0;);(i=c[t+160>>2])&&p[t+164|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[t+160>>2]=T,c[t+156>>2]=k,a[t+164|0]=1,S=c[t+152>>2]}c[t+152>>2]=S+1,C=(w=n<<5)+c[(T=t+160|0)>>2]|0,n=c[36+b>>2],c[C>>2]=c[32+b>>2],c[C+4>>2]=n,n=c[4+(i=56+b|0)>>2],c[(S=C+24|0)>>2]=c[i>>2],c[S+4>>2]=n,n=c[4+(i=48+b|0)>>2],c[(S=C+16|0)>>2]=c[i>>2],c[S+4>>2]=n,n=c[4+(i=40+b|0)>>2],c[(S=C+8|0)>>2]=c[i>>2],c[S+4>>2]=n,i=w+c[T>>2]|0,s[i>>1]=d[(n=W+(Z<<4)|0)>>1],s[i+2>>1]=d[n+2>>1],s[i+4>>1]=d[n+4>>1],s[i+6>>1]=d[n+6>>1],s[i+8>>1]=d[n+8>>1],c[i+16>>2]=q,c[i+12>>2]=Z,s[i+10>>1]=d[n+10>>1]}c[t+168>>2]=c[t+152>>2],S=p[t+60|0]}255&S?c[12+(c[t+136>>2]+(I<<4)|0)>>2]=0-Q:c[32+(c[t+96>>2]+(I<<6)|0)>>2]=Q}else p[t+60|0]?(n=c[t+116>>2]+(n<<4)|0,S=c[n+4>>2],i=c[t+136>>2]+(J<<4)|0,c[i>>2]=c[n>>2],c[i+4>>2]=S):(n=c[t+76>>2]+(n<<6)|0,S=c[(C=n)+4>>2],i=c[t+96>>2]+(J<<6)|0,c[i>>2]=c[C>>2],c[i+4>>2]=S,S=c[4+(w=C+56|0)>>2],c[(T=i+56|0)>>2]=c[w>>2],c[T+4>>2]=S,S=c[4+(w=C+48|0)>>2],c[(T=i+48|0)>>2]=c[w>>2],c[T+4>>2]=S,S=c[4+(w=C+40|0)>>2],c[(T=i+40|0)>>2]=c[w>>2],c[T+4>>2]=S,S=c[4+(w=C+32|0)>>2],c[(T=i+32|0)>>2]=c[w>>2],c[T+4>>2]=S,S=c[4+(w=C+24|0)>>2],c[(T=i+24|0)>>2]=c[w>>2],c[T+4>>2]=S,S=c[4+(w=C+16|0)>>2],c[(T=i+16|0)>>2]=c[w>>2],c[T+4>>2]=S),S=i+8|0,n=c[4+(i=n+8|0)>>2],c[S>>2]=c[i>>2],c[S+4>>2]=n,c[t+56>>2]=c[t+56>>2]+1;N=112+b|0})(e,c[e+56>>2]=0,P),p[e+60|0]&&(c[e+152>>2]||(c[e+156>>2]?(n=c[e+160>>2],t=1):(n=0,c[5498]=c[5498]+(t=1),(i=M(51))&&(c[(n=i+19&-16)-4>>2]=i),(i=c[e+160>>2])&&p[e+164|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2]),t=c[e+152>>2]+1|0),c[e+160>>2]=n,c[e+156>>2]=1,a[e+164|0]=1),c[e+152>>2]=t,t=c[12+f>>2],c[n>>2]=c[8+f>>2],c[n+4>>2]=t,o=c[4+(i=32+f|0)>>2],c[(t=n+24|0)>>2]=c[i>>2],c[t+4>>2]=o,o=c[4+(i=24+f|0)>>2],c[(t=n+16|0)>>2]=c[i>>2],c[t+4>>2]=o,t=n+8|0,i=c[4+(n=16+f|0)>>2],c[t>>2]=c[n>>2],c[t+4>>2]=i,t=c[e+160>>2],n=c[e+136>>2],s[t>>1]=d[n>>1],s[t+2>>1]=d[n+2>>1],s[t+4>>1]=d[n+4>>1],s[t+6>>1]=d[n+6>>1],s[t+8>>1]=d[n+8>>1],c[t+12>>2]=0,i=c[n+12>>2],c[t+16>>2]=-1<(0|i)?1:0-i|0,s[t+10>>1]=d[n+10>>1])),c[e+168>>2]=c[e+152>>2],(t=c[e+116>>2])&&p[e+120|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+116>>2]=0,a[e+120|0]=1,c[(t=e+108|0)>>2]=0,c[t+4>>2]=0,(t=c[e+76>>2])&&p[e+80|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+76>>2]=0,a[e+80|0]=1,c[(e=e+68|0)>>2]=0,c[e+4>>2]=0,N=112+f|0}function It(e,t,n){e|=0,t|=0,n|=0;var i,o,a,r,s,l,_=0,u=x(0),h=x(0),f=x(0),p=0,m=x(0);N=l=N-80|0,p=c[e+4>>2],pi[c[c[p>>2]+16>>2]](p,28+l|0,24+l|0,20+l|0,16+l|0,12+l|0,8+l|0,4+l|0,l,t),p=(i=c[e+4>>2])+12|0,o=c[12+l>>2]+g(c[8+l>>2],n)|0,a=c[16+l>>2],r=c[28+l>>2],s=c[20+l>>2];e:{t:{n:{i:{o:{a:{r:{if(3!=c[l>>2]){if(_=g(c[8+o>>2],a)+r|0,s)break r;f=x(A[_+4>>2]*A[i+8>>2]),h=x(A[_>>2]*A[i+4>>2]),u=A[i+12>>2],_=_+8|0;break a}if(_=g(d[4+o>>1],a)+r|0,_=s?(f=x(A[i+8>>2]*x(v[_+8>>3])),h=x(A[i+4>>2]*x(v[_>>3])),u=x(v[_+16>>3]),p):(f=x(A[_+4>>2]*A[i+8>>2]),h=x(A[_>>2]*A[i+4>>2]),u=A[i+12>>2],_+8|0),m=A[_>>2],c[76+l>>2]=0,A[68+l>>2]=f,A[72+l>>2]=m*u,A[64+l>>2]=h,_=g(d[2+o>>1],a)+r|0,!s)break o;f=x(A[i+8>>2]*x(v[_+8>>3])),h=x(A[i+4>>2]*x(v[_>>3])),u=x(v[_+16>>3]),_=p;break i}f=x(A[i+8>>2]*x(v[_+8>>3])),h=x(A[i+4>>2]*x(v[_>>3])),u=x(v[_+16>>3]),_=p}if(m=A[_>>2],c[76+l>>2]=0,A[68+l>>2]=f,A[72+l>>2]=m*u,A[64+l>>2]=h,_=g(c[4+o>>2],a)+r|0,!s)break n;f=x(A[i+8>>2]*x(v[_+8>>3])),h=x(A[i+4>>2]*x(v[_>>3])),u=x(v[_+16>>3]),_=p;break t}f=x(A[_+4>>2]*A[i+8>>2]),h=x(A[_>>2]*A[i+4>>2]),u=A[i+12>>2],_=_+8|0}m=A[_>>2],c[60+l>>2]=0,A[52+l>>2]=f,A[56+l>>2]=m*u,A[48+l>>2]=h,_=g(d[o>>1],a)+r|0,u=s?(f=x(A[i+8>>2]*x(v[_+8>>3])),h=x(A[i+4>>2]*x(v[_>>3])),x(v[_+16>>3])):(p=_+8|0,f=x(A[_+4>>2]*A[i+8>>2]),h=x(A[_>>2]*A[i+4>>2]),A[i+12>>2]),m=A[p>>2],A[32+l>>2]=h,u=x(m*u);break e}f=x(A[_+4>>2]*A[i+8>>2]),h=x(A[_>>2]*A[i+4>>2]),u=A[i+12>>2],_=_+8|0}m=A[_>>2],c[60+l>>2]=0,A[52+l>>2]=f,A[56+l>>2]=m*u,A[48+l>>2]=h,_=g(c[o>>2],a)+r|0,u=s?(f=x(A[i+8>>2]*x(v[_+8>>3])),h=x(A[i+4>>2]*x(v[_>>3])),x(v[_+16>>3])):(p=_+8|0,f=x(A[_+4>>2]*A[i+8>>2]),h=x(A[_>>2]*A[i+4>>2]),A[i+12>>2]),m=A[p>>2],A[32+l>>2]=h,u=x(m*u)}c[44+l>>2]=0,A[40+l>>2]=u,A[36+l>>2]=f,p=c[e+8>>2],pi[c[c[p>>2]+8>>2]](p,32+l|0,t,n),e=c[e+4>>2],pi[c[c[e>>2]+24>>2]](e,t),N=80+l|0}function Rt(){}function Dt(){return 0}function Nt(e,t,n,i){t|=0,n|=0,i|=0;var o,a=x(pi[c[c[(e|=0)>>2]+48>>2]](e)),r=x(pi[c[c[e>>2]+48>>2]](e)),s=x(pi[c[c[e>>2]+48>>2]](e)),l=A[(e=t+52|0)>>2],_=A[(o=t+56|0)>>2],u=A[t+48>>2];c[n+12>>2]=0,A[n+8>>2]=_-s,A[n+4>>2]=l-r,A[n>>2]=u-a,l=A[e>>2],_=A[o>>2],u=A[t+48>>2],c[i+12>>2]=0,A[i+8>>2]=s+_,A[i+4>>2]=r+l,A[i>>2]=a+u}function Ot(e){return c[16+(e|=0)>>2]}function Mt(e){return c[8+(e|=0)>>2]}function zt(e,t,n,i){pi[c[c[(e|=0)>>2]+8>>2]](e,t|=0,n|=0,i|=0)}function Lt(e,t){pi[c[c[(e|=0)>>2]+64>>2]](e,t|=0)}function Ft(e,t){var n,i,o,a=x(0),r=x(0),s=0,l=x(0),_=x(0),u=x(0),h=0,f=x(0),p=x(0),d=x(0),m=x(0),v=x(0),b=x(0),S=x(0),C=x(0),E=x(0),T=x(0),P=x(0),w=x(0);e:{t:{n:{i:{o:{if(4==(0|(s=c[e+844>>2]))){if(u=A[t>>2],h=(s=(a=A[e+84>>2])<(l=A[t+80>>2]))?0:-1,i=(s=(r=A[e+292>>2])<(a=s?a:l))?1:h,l=A[e+500>>2],!(s=(h=A[e+708>>2]<((s=l<(a=s?r:a))?l:a))?3:s?2:i)){f=A[e+636>>2],C=A[e+428>>2],r=x(f-C),d=A[e+632>>2],E=A[e+424>>2],_=x(d-E),T=A[e+628>>2],P=A[e+420>>2],p=x(T-P),w=A[e+220>>2],m=A[e+216>>2],v=A[e+212>>2],a=A[t+8>>2],l=A[t+4>>2];break o}if(v=A[e+212>>2],b=x(u-v),d=A[e+632>>2],E=A[e+424>>2],_=x(d-E),l=A[t+4>>2],m=A[e+216>>2],a=x(l-m),T=A[e+628>>2],P=A[e+420>>2],p=x(T-P),r=x(x(b*_)-x(a*p)),o=x(r*r),f=A[e+636>>2],C=A[e+428>>2],r=x(f-C),n=x(a*r),a=A[t+8>>2],w=A[e+220>>2],S=x(a-w),n=x(n-x(S*_)),b=x(x(S*p)-x(b*r)),b=x(o+x(x(n*n)+x(b*b))),1!=(0|s))break o;u=x(u-A[e+4>>2]),a=x(a-A[e+12>>2]),l=x(l-A[e+8>>2]),p=x(0);break i}c[e+844>>2]=s+1;break e}if(u=x(u-A[e+4>>2]),l=x(l-A[e+8>>2]),S=x(x(u*_)-x(l*p)),a=x(a-A[e+12>>2]),_=x(x(l*r)-x(a*_)),r=x(x(a*p)-x(u*r)),p=x(x(S*S)+x(x(_*_)+x(r*r))),r=x(0),2==(0|s))break n}if(r=x(d-m),_=x(T-v),d=x(x(u*r)-x(l*_)),f=x(f-w),r=x(x(l*f)-x(a*r)),S=x(r*r),r=x(x(a*_)-x(u*f)),r=x(x(d*d)+x(S+x(r*r))),_=x(0),h)break t}_=x(E-m),m=x(P-v),v=x(x(u*_)-x(l*m)),f=l,l=x(C-w),_=x(x(f*l)-x(a*_)),a=x(x(a*m)-x(u*l)),_=x(x(v*v)+x(x(_*_)+x(a*a)))}h=(s=(a=x(y(b)))>x(-0xde0b6b000000000))?0:-1,l=x(y(p)),h=(s=(a=s?a:x(-0xde0b6b000000000))<l)?1:h,s=(a=s?l:a)<(r=x(y(r))),s=x(y(_))>(s?r:a)?3:s?2:h}return k(4+((h=e)+g(e=0<(0|s)?s:0,208)|0)|0,t,208),e}function Bt(e,t,n){var i,o,a,r,s,l,_,u,h,f,p,d,m,v,y,b=0,S=x(0),C=x(0),E=x(0),T=0,P=0,w=x(0);if(1<=(0|(T=c[e+844>>2]))){for(P=T+1|0,b=(g(T,208)+e|0)-204|0;a=A[t+48>>2],l=A[t+8>>2],_=A[t+4>>2],u=A[t>>2],r=A[t+52>>2],h=A[t+24>>2],i=A[t+20>>2],f=A[t+16>>2],S=A[t+56>>2],C=A[t+40>>2],E=A[t+36>>2],s=A[t+32>>2],c[b+60>>2]=0,w=S,S=A[b>>2],p=E,E=A[b+4>>2],o=C,C=A[b+8>>2],s=x(w+x(x(x(s*S)+x(p*E))+x(o*C))),A[b+56>>2]=s,r=x(r+x(x(x(S*f)+x(E*i))+x(C*h))),A[b+52>>2]=r,a=x(a+x(x(x(S*u)+x(E*_))+x(C*l))),A[b+48>>2]=a,l=A[n+56>>2],_=A[n+40>>2],u=A[n+32>>2],h=A[n+36>>2],i=A[n+52>>2],f=A[n+24>>2],m=A[n+16>>2],v=A[n+20>>2],S=A[n+48>>2],C=A[n+8>>2],E=A[n>>2],o=A[n+4>>2],c[b+44>>2]=0,w=S,S=A[b+16>>2],y=x(E*S),E=A[b+20>>2],p=C,C=A[b+24>>2],o=x(w+x(x(y+x(o*E))+x(p*C))),A[b+32>>2]=o,i=x(i+x(x(x(S*m)+x(E*v))+x(C*f))),A[b+36>>2]=i,S=x(l+x(x(x(S*u)+x(E*h))+x(C*_))),A[b+40>>2]=S,A[b+80>>2]=x(x(x(a-o)*A[b- -64>>2])+x(x(r-i)*A[b+68>>2]))+x(x(s-S)*A[b+72>>2]),c[(d=b+164|0)>>2]=c[d>>2]+1,b=b-208|0,1<(0|(P=P-1|0)););for(b=(g(T,208)+e|0)-204|0;T=(t=T)-1|0,(S=A[b+80>>2])<=(E=A[e+848>>2])?(C=x(A[b+32>>2]-x(A[b+48>>2]-x(A[b- -64>>2]*S))),w=x(C*C),C=x(A[b+36>>2]-x(A[b+52>>2]-x(S*A[b+68>>2]))),S=x(A[b+40>>2]-x(A[b+56>>2]-x(S*A[b+72>>2]))),x(x(w+x(C*C))+x(S*S))>x(E*E)&&(t=(0|(n=t))!=(0|(t=c[(P=e)+844>>2]))?(k(b,4+(t=g(t-1|0,208)+e|0)|0,208),c[t+168>>2]=0,c[t+120>>2]=0,c[(n=t+132|0)>>2]=0,c[n+4>>2]=0,c[(t=t+140|0)>>2]=0,c[t+4>>2]=0,c[e+844>>2]-1|0):T,c[P+844>>2]=t)):(t=(0|(n=t))!=(0|(t=c[(P=e)+844>>2]))?(k(b,4+(t=g(t-1|0,208)+e|0)|0,208),c[t+168>>2]=0,c[t+120>>2]=0,c[(n=t+132|0)>>2]=0,c[n+4>>2]=0,c[(t=t+140|0)>>2]=0,c[t+4>>2]=0,c[e+844>>2]-1|0):T,c[P+844>>2]=t),b=b-208|0,1<(T+1|0););}}function kt(e){var t,n,i,o,r,s,l,_,u,h,f,d,m,v,g,y,b,S,C,E=0,T=0,P=0,w=0,I=x(0),R=x(0),D=0,O=x(0),M=x(0),z=x(0),L=x(0),F=x(0),B=x(0),k=0,U=0,G=0,j=0,V=0,H=x(0),W=x(0),q=0,Y=x(0),X=x(0),Q=0,Z=0,J=x(0),K=x(0),$=x(0),ee=0,te=x(0),ne=x(0);N=C=N+-64|0;e:if(p[e+356|0]){a[e+356|0]=0,a[0|(D=e+352|0)]=0,c[(T=j=e+344|0)>>2]=0,c[T+4>>2]=0,c[(T=ee=e+336|0)>>2]=0,c[T+4>>2]=0,T=p[0|(E=e+332|0)],a[0|E]=G=-16&T,E=e+316|0;t:{n:{i:switch(c[e>>2]){case 1:P=c[e+168>>2],c[e+260>>2]=c[e+164>>2],c[e+264>>2]=P,P=c[e+88>>2],c[e+244>>2]=c[e+84>>2],c[e+248>>2]=P,P=c[4+(T=e+172|0)>>2],c[(E=w=e+268|0)>>2]=c[T>>2],c[E+4>>2]=P,P=c[4+(T=e+92|0)>>2],c[(E=e+252|0)>>2]=c[T>>2],c[E+4>>2]=P,a[0|D]=0,c[e+288>>2]=0,A[e+280>>2]=A[e+248>>2]-A[e+264>>2],A[e+276>>2]=A[e+244>>2]-A[e+260>>2],A[e+284>>2]=A[E>>2]-A[w>>2],c[j>>2]=0,c[j+4>>2]=0,c[e+336>>2]=1065353216,c[e+340>>2]=0,a[e+332|0]=G,a[e+312|0]=P=1;break e;case 2:M=A[(w=e)+4>>2],L=x(A[e+20>>2]-M),O=A[e+8>>2],F=x(A[e+24>>2]-O),I=A[e+12>>2],z=x(A[e+28>>2]-I),P=(I=x(x(x(x(x(0)-M)*L)+x(x(x(0)-O)*F))+x(x(x(0)-I)*z)))>x(0)?I<(R=x(x(x(L*L)+x(F*F))+x(z*z)))?(R=x(I/R),3|G):(R=x(1),2|G):1|G,a[w+332|0]=P,c[(T=e+344|0)>>2]=0,c[T+4>>2]=0,A[e+340>>2]=R,B=x(x(1)-R),A[e+336>>2]=B,c[e+256>>2]=0,I=A[e+92>>2],M=x(I+x(R*x(A[e+108>>2]-I))),A[e+252>>2]=M,I=A[e+88>>2],L=x(I+x(R*x(A[e+104>>2]-I))),A[e+248>>2]=L,I=A[e+84>>2],F=x(I+x(R*x(A[e+100>>2]-I))),A[e+244>>2]=F,z=A[e+180>>2],O=A[e+184>>2],K=A[e+168>>2],I=A[e+188>>2],$=A[e+172>>2],H=A[e+164>>2],c[e+288>>2]=0,W=M,M=x($+x(R*x(I-$))),A[e+284>>2]=W-M,O=x(K+x(R*x(O-K))),A[e+280>>2]=L-O,I=x(H+x(R*x(z-H))),A[e+276>>2]=F-I,c[e+272>>2]=0,A[e+268>>2]=M,A[e+264>>2]=O,A[e+260>>2]=I,U=1,2&P||(c[e>>2]=1,U=0),1&P||(c[e>>2]=U,G=c[(P=12+(V=(U<<4)+e|0)|0)>>2],j=c[P+4>>2],ee=c[(P=V+4|0)>>2],D=c[P+4>>2],P=c[4+(T=V+84|0)>>2],c[(E=w=e+84|0)>>2]=c[T>>2],c[E+4>>2]=P,P=c[4+(T=V+92|0)>>2],c[(E=E+8|0)>>2]=c[T>>2],c[E+4>>2]=P,P=c[4+(T=V+164|0)>>2],c[(E=w=e+164|0)>>2]=c[T>>2],c[E+4>>2]=P,P=c[4+(T=V+172|0)>>2],c[(E=E+8|0)>>2]=c[T>>2],c[E+4>>2]=P,c[(P=e+4|0)>>2]=ee,c[P+4>>2]=D,c[(P=P+8|0)>>2]=G,c[P+4>>2]=j),P=B>=x(0)&R>=x(0),a[e+312|0]=P;break e;case 3:c[(P=32+C|0)>>2]=0,c[P+4>>2]=0,c[24+C>>2]=0,Ut(24+C|(c[28+C>>2]=0),q=e+4|0,Q=e+20|0,Z=e+36|0,E),c[e+256>>2]=0,J=A[e+336>>2],Y=A[e+340>>2],X=A[j>>2],te=x(x(x(J*A[e+92>>2])+x(Y*A[e+108>>2]))+x(X*A[e+124>>2])),A[e+252>>2]=te,K=x(x(x(J*A[e+88>>2])+x(Y*A[e+104>>2]))+x(X*A[e+120>>2])),A[e+248>>2]=K,V=e+100|0,G=e+116|0,$=x(x(x(J*A[e+84>>2])+x(Y*A[V>>2]))+x(X*A[G>>2])),A[e+244>>2]=$,H=A[(j=e+180|0)>>2],B=A[(D=e+196|0)>>2],L=A[e+168>>2],F=A[e+184>>2],z=A[e+200>>2],M=A[e+172>>2],O=A[e+188>>2],I=A[e+204>>2],R=A[e+164>>2],c[e+288>>2]=0,O=x(x(x(J*M)+x(Y*O))+x(X*I)),A[e+284>>2]=te-O,I=x(x(x(J*L)+x(Y*F))+x(X*z)),A[e+280>>2]=K-I,R=x(x(x(J*R)+x(Y*H))+x(X*B)),A[e+276>>2]=$-R,c[e+272>>2]=0,A[e+268>>2]=O,A[e+264>>2]=I,A[e+260>>2]=R;o:{a:{r:{s:{c:{if(4<=(0|(T=c[e>>2])))8&(U=p[e+332|0])?P=T:(T=c[4+(E=12+(k=((P=T-1|0)<<4)+e|0)|0)>>2],c[(w=e+60|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=k+4|0)>>2],c[(w=e+52|0)>>2]=c[E>>2],c[w+4>>2]=T,c[e>>2]=P,T=c[4+(E=k+84|0)>>2],c[(w=e+132|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=k+92|0)>>2],c[(w=e+140|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=k+164|0)>>2],c[(w=e+212|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=k+172|0)>>2],c[(w=e+220|0)>>2]=c[E>>2],c[w+4>>2]=T);else{if((P=3)!=(0|T))break c;U=p[e+332|0]}if(4&U)break s;c[e>>2]=P=P-1|0,T=c[4+(E=12+(k=(P<<4)+e|0)|0)>>2],c[(w=Z+8|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=k+4|0)>>2],c[Z>>2]=c[E>>2],c[Z+4>>2]=T,T=c[4+(E=k+92|0)>>2],c[(w=G+8|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=k+84|0)>>2],c[G>>2]=c[E>>2],c[G+4>>2]=T,T=c[4+(E=k+164|0)>>2],c[D>>2]=c[E>>2],c[D+4>>2]=T,T=c[4+(E=k+172|0)>>2],c[(w=D+8|0)>>2]=c[E>>2],c[w+4>>2]=T;break s}if((0|T)<(P=2))break r;U=p[e+332|0]}if(2&U)break a;c[e>>2]=P=P-1|0,T=c[4+(E=12+(D=(P<<4)+e|0)|0)>>2],c[(w=Q+8|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=D+4|0)>>2],c[Q>>2]=c[E>>2],c[Q+4>>2]=T,T=c[4+(E=D+92|0)>>2],c[(w=V+8|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=D+84|0)>>2],c[V>>2]=c[E>>2],c[V+4>>2]=T,T=c[4+(E=D+164|0)>>2],c[j>>2]=c[E>>2],c[j+4>>2]=T,T=c[4+(E=D+172|0)>>2],c[(w=j+8|0)>>2]=c[E>>2],c[w+4>>2]=T;break a}if((P=1)!=(0|T))break o;U=p[e+332|0]}1&U||(c[e>>2]=P=P-1|0,P=c[4+(T=12+(D=(P<<4)+e|0)|0)>>2],c[(E=q+8|0)>>2]=c[T>>2],c[E+4>>2]=P,P=c[4+(T=D+4|0)>>2],c[q>>2]=c[T>>2],c[q+4>>2]=P,P=c[4+(T=D+92|0)>>2],c[(E=8+(w=e+84|0)|0)>>2]=c[T>>2],c[E+4>>2]=P,P=c[4+(T=D+84|0)>>2],c[w>>2]=c[T>>2],c[w+4>>2]=P,P=c[4+(T=D+164|0)>>2],c[(E=w=e+164|0)>>2]=c[T>>2],c[E+4>>2]=P,P=c[4+(T=D+172|0)>>2],c[(E=E+8|0)>>2]=c[T>>2],c[E+4>>2]=P)}if(!(A[ee>>2]>=x(P=0)))break t;if(!(Y>=x(0)))break t;if(!(X>=x(0)))break t;P=A[e+348>>2]>=x(0),a[e+312|0]=P;break e;case 0:break t;case 4:break i;default:break n}if(c[(P=16+C|0)>>2]=0,c[P+4>>2]=0,c[8+C>>2]=0,c[12+C>>2]=0,c[E>>2]=0,c[E+4>>2]=0,c[(P=E+8|0)>>2]=0,c[P+4>>2]=0,a[e+332|0]=15|T,a[40+C|0]=0,r=A[e+12>>2],y=x(x(0)-r),s=A[e+28>>2],l=x(s-r),z=A[(n=e+36|0)>>2],_=A[e+4>>2],u=x(z-_),M=A[e+56>>2],h=A[e+8>>2],B=x(M-h),I=A[e+40>>2],f=x(I-h),R=A[(i=e+52|0)>>2],d=x(R-_),ne=x(x(u*B)-x(f*d)),m=A[(o=e+20|0)>>2],v=x(m-_),Y=A[e+60>>2],t=x(Y-r),O=A[e+44>>2],L=x(O-r),X=x(x(f*t)-x(L*B)),g=A[e+24>>2],F=x(g-h),J=x(x(L*d)-x(u*t)),b=x(x(l*ne)+x(x(v*X)+x(F*J))),te=x(x(F*L)-x(l*f)),K=x(x(l*u)-x(v*L)),$=x(x(v*f)-x(F*u)),S=x(x(x(te*d)+x(K*B))+x($*t)),H=x(x(F*d)-x(v*B)),W=x(L*H),B=x(x(l*B)-x(F*t)),L=x(x(v*t)-x(l*d)),t=x(W+x(x(u*B)+x(f*L))),I=x(I-g),F=x(R-m),z=x(z-m),R=x(M-g),M=x(x(I*F)-x(z*R)),O=x(O-s),W=x(O*R),R=x(Y-s),I=x(W-x(I*R)),R=x(x(z*R)-x(O*F)),F=x(x(x(r-s)*M)+x(x(x(_-m)*I)+x(x(h-g)*R))),w=x(F*F)<x(9.99999905104687e-9)?-1:x(x(x(x(x(0)-s)*M)+x(x(x(x(0)-m)*I)+x(x(x(0)-g)*R)))*F)<x(0),z=x(x(0)-_),O=x(x(0)-h),(0|(P=w|(E=x(b*b)<x(9.99999905104687e-9)?-1:x(x(x(y*ne)+x(x(z*X)+x(O*J)))*b)<x(0))|(T=x(S*S)<x(9.99999905104687e-9)?-1:x(x(x(x(z*te)+x(O*K))+x($*y))*S)<x(0))|(D=x(t*t)<x(9.99999905104687e-9)?-1:x(x(x(y*H)+x(x(z*B)+x(O*L)))*t)<x(0))))<=-1)a[e+352|0]=1;else{if(P){k=e+4|0,R=x(34028234663852886e22),T&&(Ut(8+C|0,k,o,n,24+C|0),z=A[24+C>>2],I=x(z-A[8+C>>2]),R=x(I*I),M=A[28+C>>2],I=x(M-A[12+C>>2]),R=x(R+x(I*I)),O=A[32+C>>2],I=x(O-A[16+C>>2]),I=x(R+x(I*I)),R=x(34028234663852886e22),I<x(34028234663852886e22)&&(A[e+316>>2]=z,P=c[48+C>>2],c[e+336>>2]=c[44+C>>2],c[e+340>>2]=P,A[e+328>>2]=A[36+C>>2],A[e+324>>2]=O,A[e+320>>2]=M,c[e+348>>2]=0,A[e+344>>2]=A[52+C>>2],P=p[40+C|0],a[e+332|0]=1&P|240&p[e+332|0]|2&P|4&P,R=I)),E&&(Ut(8+C|0,k,n,i,24+C|0),z=A[24+C>>2],I=x(z-A[8+C>>2]),W=x(I*I),M=A[28+C>>2],I=x(M-A[12+C>>2]),W=x(W+x(I*I)),O=A[32+C>>2],I=x(O-A[16+C>>2]),(I=x(W+x(I*I)))<R&&(A[e+316>>2]=z,A[e+336>>2]=A[44+C>>2],A[e+328>>2]=A[36+C>>2],A[e+324>>2]=O,A[e+320>>2]=M,c[e+340>>2]=0,P=c[4+(T=48+C|0)>>2],c[(E=e+344|0)>>2]=c[T>>2],c[E+4>>2]=P,P=p[40+C|0],a[e+332|0]=8&(T=P<<1)|4&T|1&P|240&p[e+332|0],R=I)),D&&(Ut(8+C|0,k,i,o,24+C|0),z=A[24+C>>2],I=x(z-A[8+C>>2]),W=x(I*I),M=A[28+C>>2],I=x(M-A[12+C>>2]),W=x(W+x(I*I)),O=A[32+C>>2],I=x(O-A[16+C>>2]),(I=x(W+x(I*I)))<R&&(A[e+316>>2]=z,A[e+336>>2]=A[44+C>>2],A[e+328>>2]=A[36+C>>2],A[e+324>>2]=O,A[e+320>>2]=M,c[e+344>>2]=0,A[e+348>>2]=A[48+C>>2],A[e+340>>2]=A[52+C>>2],P=p[40+C|0],a[e+332|0]=1&P|240&p[e+332|0]|P>>>1&2|P<<2&8,R=I)),w&&(Ut(8+C|0,o,i,n,24+C|0),W=R,M=A[24+C>>2],R=x(M-A[8+C>>2]),I=x(R*R),O=A[28+C>>2],R=x(O-A[12+C>>2]),ne=x(I+x(R*R)),I=A[32+C>>2],R=x(I-A[16+C>>2]),W>x(ne+x(R*R))&&(A[e+316>>2]=M,c[e+336>>2]=0,A[e+328>>2]=A[36+C>>2],A[e+324>>2]=I,A[e+320>>2]=O,A[e+340>>2]=A[44+C>>2],A[e+348>>2]=A[48+C>>2],A[e+344>>2]=A[52+C>>2],P=p[40+C|0],a[e+332|0]=4&P|240&p[e+332|0]|P<<1&2|P<<2&8)),c[e+256>>2]=0,B=A[e+336>>2],L=A[e+340>>2],R=A[e+344>>2],H=A[e+348>>2],F=x(x(x(x(B*A[e+92>>2])+x(L*A[e+108>>2]))+x(R*A[e+124>>2]))+x(H*A[e+140>>2])),A[e+252>>2]=F,z=x(x(x(x(B*A[e+88>>2])+x(L*A[e+104>>2]))+x(R*A[e+120>>2]))+x(H*A[e+136>>2])),A[e+248>>2]=z,Q=e+100|0,Z=e+116|0,V=e+132|0,M=x(x(x(x(B*A[e+84>>2])+x(L*A[Q>>2]))+x(R*A[Z>>2]))+x(H*A[V>>2])),A[e+244>>2]=M,c[e+288>>2]=0,G=e+180|(c[e+272>>2]=0),j=e+196|0,D=e+212|0,O=x(x(x(x(B*A[e+164>>2])+x(L*A[G>>2]))+x(R*A[j>>2]))+x(H*A[D>>2])),A[e+260>>2]=O,I=x(x(x(x(B*A[e+168>>2])+x(L*A[e+184>>2]))+x(R*A[e+200>>2]))+x(H*A[e+216>>2])),A[e+264>>2]=I,R=x(x(x(x(B*A[e+172>>2])+x(L*A[e+188>>2]))+x(R*A[e+204>>2]))+x(H*A[e+220>>2])),A[e+268>>2]=R,A[e+276>>2]=M-O,A[e+280>>2]=z-I,A[e+284>>2]=F-R;i:{o:{a:{r:{s:{if(4<=(0|(T=c[e>>2])))8&(U=p[e+332|0])?P=T:(T=c[4+(E=12+(q=((P=T-1|0)<<4)+e|0)|0)>>2],c[(w=8+i|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=q+4|0)>>2],c[i>>2]=c[E>>2],c[4+i>>2]=T,c[e>>2]=P,T=c[4+(E=q+84|0)>>2],c[V>>2]=c[E>>2],c[V+4>>2]=T,T=c[4+(E=q+92|0)>>2],c[(w=V+8|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=q+164|0)>>2],c[D>>2]=c[E>>2],c[D+4>>2]=T,T=c[4+(E=q+172|0)>>2],c[(w=D+8|0)>>2]=c[E>>2],c[w+4>>2]=T);else{if((P=3)!=(0|T))break s;U=p[e+332|0]}if(4&U)break r;c[e>>2]=P=P-1|0,T=c[4+(E=12+(D=(P<<4)+e|0)|0)>>2],c[(w=8+n|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=D+4|0)>>2],c[n>>2]=c[E>>2],c[4+n>>2]=T,T=c[4+(E=D+92|0)>>2],c[(w=Z+8|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=D+84|0)>>2],c[Z>>2]=c[E>>2],c[Z+4>>2]=T,T=c[4+(E=D+164|0)>>2],c[j>>2]=c[E>>2],c[j+4>>2]=T,T=c[4+(E=D+172|0)>>2],c[(w=j+8|0)>>2]=c[E>>2],c[w+4>>2]=T;break r}if((0|T)<(P=2))break a;U=p[e+332|0]}if(2&U)break o;c[e>>2]=P=P-1|0,T=c[4+(E=12+(D=(P<<4)+e|0)|0)>>2],c[(w=8+o|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=D+4|0)>>2],c[o>>2]=c[E>>2],c[4+o>>2]=T,T=c[4+(E=D+92|0)>>2],c[(w=Q+8|0)>>2]=c[E>>2],c[w+4>>2]=T,T=c[4+(E=D+84|0)>>2],c[Q>>2]=c[E>>2],c[Q+4>>2]=T,T=c[4+(E=D+164|0)>>2],c[G>>2]=c[E>>2],c[G+4>>2]=T,T=c[4+(E=D+172|0)>>2],c[(w=G+8|0)>>2]=c[E>>2],c[w+4>>2]=T;break o}if((P=1)!=(0|T))break i;U=p[e+332|0]}1&U||(c[e>>2]=P=P-1|0,P=c[4+(T=12+(D=(P<<4)+e|0)|0)>>2],c[(E=k+8|0)>>2]=c[T>>2],c[E+4>>2]=P,P=c[4+(T=D+4|0)>>2],c[k>>2]=c[T>>2],c[k+4>>2]=P,P=c[4+(T=D+92|0)>>2],c[(E=8+(w=e+84|0)|0)>>2]=c[T>>2],c[E+4>>2]=P,P=c[4+(T=D+84|0)>>2],c[w>>2]=c[T>>2],c[w+4>>2]=P,P=c[4+(T=D+164|0)>>2],c[(E=w=e+164|0)>>2]=c[T>>2],c[E+4>>2]=P,P=c[4+(T=D+172|0)>>2],c[(E=E+8|0)>>2]=c[T>>2],c[E+4>>2]=P)}if(!(A[ee>>2]>=x(P=0)))break t;if(!(A[e+340>>2]>=x(0)))break t;if(!(A[e+344>>2]>=x(0)))break t;P=H>=x(0),a[e+312|0]=P;break e}if(!p[e+352|0]){c[e+276>>2]=0,c[e+280>>2]=0,a[e+312|0]=P=1,c[(e=e+284|0)>>2]=0,c[e+4>>2]=0;break e}}}P=0}a[e+312|0]=0}else P=p[e+312|0];return N=C+64|0,0!=(255&P)}function Ut(e,t,n,i,o){var r,s,l,_,u,h,f,d,m,v,g,y,b,S=x(0),C=x(0),E=x(0),T=x(0),P=x(0),w=x(0),I=x(0),R=x(0),D=x(0),N=x(0),O=x(0),M=x(0),z=-16&p[o+16|0];a[o+16|0]=z,v=A[i>>2],s=A[t>>2],h=x(v-s),r=A[e>>2],S=x(r-s),g=A[i+4>>2],l=A[t+4>>2],f=x(g-l),T=A[e+4>>2],C=x(T-l),y=A[i+8>>2],_=A[t+8>>2],d=x(y-_),u=A[e+8>>2],E=x(u-_),P=x(x(x(h*S)+x(f*C))+x(d*E)),b=o,N=A[n>>2],I=x(N-s),O=A[n+4>>2],R=x(O-l),M=A[n+8>>2],D=x(M-_),E=(C=x(x(x(I*S)+x(R*C))+x(D*E)))<=x(0)&&P<=x(0)?(e=c[t+4>>2],c[o>>2]=c[t>>2],c[o+4>>2]=e,n=c[4+(t=t+8|0)>>2],c[(e=o+8|0)>>2]=c[t>>2],c[e+4>>2]=n,a[o+16|0]=1|z,C=x(0),S=x(0),x(1)):(S=x(r-N),E=x(T-O),w=x(u-M),m=x(x(x(h*S)+x(f*E))+x(d*w)),(E=x(x(x(I*S)+x(R*E))+x(D*w)))>=x(0)&&m<=E?(e=c[n+4>>2],c[o>>2]=c[n>>2],c[o+4>>2]=e,n=c[4+(t=n+8|0)>>2],c[(e=o+8|0)>>2]=c[t>>2],c[e+4>>2]=n,a[o+16|0]=2|z,C=x(1),S=x(0),x(0)):(w=x(x(C*m)-x(E*P)),E<=x(0)&&C>=x(0)&&(S=x(0),w<=x(0))?(c[o+12>>2]=0,a[o+16|0]=3|z,C=x(C/x(C-E)),A[o+8>>2]=_+x(D*C),A[o+4>>2]=l+x(R*C),A[o>>2]=s+x(I*C),x(x(1)-C)):(S=x(r-v),T=x(T-g),u=x(u-y),r=x(x(x(I*S)+x(R*T))+x(D*u)),(S=x(x(x(h*S)+x(f*T))+x(d*u)))>=x(0)&&r<=S?(e=c[i+4>>2],c[o>>2]=c[i>>2],c[o+4>>2]=e,n=c[4+(t=i+8|0)>>2],c[(e=o+8|0)>>2]=c[t>>2],c[e+4>>2]=n,a[o+16|0]=4|z,S=x(1),C=x(0),x(0)):(T=x(x(r*P)-x(C*S)),S<=x(0)&&P>=x(0)&&(C=x(0),T<=x(0))?(c[o+12>>2]=0,a[o+16|0]=5|z,S=x(P/x(P-S)),A[o+8>>2]=_+x(d*S),A[o+4>>2]=l+x(f*S),A[o>>2]=s+x(h*S),x(x(1)-S)):(C=x(x(E*S)-x(r*m)),(P=x(r-S))>=x(0)&&(S=x(m-E))>=x(0)&&C<=x(0)?(c[o+12>>2]=0,a[o+16|0]=6|z,S=x(S/x(S+P)),A[o+8>>2]=M+x(x(y-M)*S),A[o+4>>2]=O+x(x(g-O)*S),A[o>>2]=N+x(x(v-N)*S),C=x(x(1)-S),x(0)):(c[o+12>>2]=0,a[o+16|0]=7|z,C=x(x(1)/x(w+x(C+T))),S=x(w*C),C=x(T*C),A[o+8>>2]=x(d*S)+x(_+x(D*C)),A[o+4>>2]=x(f*S)+x(l+x(R*C)),A[o>>2]=x(h*S)+x(s+x(I*C)),x(x(x(1)-C)-S))))))),A[b+20>>2]=E,c[o+32>>2]=0,A[o+28>>2]=S,A[o+24>>2]=C}function Gt(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var r,s,l,_,u,h,f,d,m,v,g,y,b,S,C,E,P,w,I,R,D,O,M,z,L,F,B,k,U,G,j,V,H,W,q,Y=0,X=0,Q=x(0),Z=x(0),J=x(0),K=x(0),$=0,ee=x(0),te=x(0),ne=x(0),ie=x(0),oe=x(0),ae=x(0),re=x(0),se=0,ce=x(0),le=x(0),_e=x(0),ue=x(0),he=x(0),fe=x(0),pe=0,de=0;for(N=o=N-208|0,c[e+56>>2]=0,c[(Y=o+200|0)>>2]=0,c[Y+4>>2]=0,c[o+192>>2]=0,c[o+196>>2]=0,r=c[4+(X=t+8|0)>>2],c[(Y=o+136|0)>>2]=c[X>>2],c[Y+4>>2]=r,r=c[4+(X=t+24|0)>>2],c[(Y=o+152|0)>>2]=c[X>>2],c[Y+4>>2]=r,r=c[4+(X=t+40|0)>>2],c[(Y=o+168|0)>>2]=c[X>>2],c[Y+4>>2]=r,$=c[4+(r=t+56|0)>>2],c[(Y=o+184|0)>>2]=c[r>>2],c[Y+4>>2]=$,X=c[t+4>>2],c[o+128>>2]=c[t>>2],c[o+132>>2]=X,X=c[t+20>>2],c[o+144>>2]=c[t+16>>2],c[o+148>>2]=X,X=c[t+36>>2],c[o+160>>2]=c[t+32>>2],c[o+164>>2]=X,X=c[t+52>>2],c[o+176>>2]=c[t+48>>2],c[o+180>>2]=X,se=c[4+($=t+120|0)>>2],c[(X=o+120|0)>>2]=c[$>>2],c[X+4>>2]=se,se=c[4+($=t+72|0)>>2],c[(r=o+72|0)>>2]=c[$>>2],c[4+r>>2]=se,se=c[4+($=t+88|0)>>2],c[(r=o+88|0)>>2]=c[$>>2],c[4+r>>2]=se,se=c[4+($=t+104|0)>>2],c[(r=o+104|0)>>2]=c[$>>2],c[4+r>>2]=se,r=c[t+68>>2],c[o+64>>2]=c[t+64>>2],c[o+68>>2]=r,$=c[4+(r=t+80|0)>>2],c[o+80>>2]=c[r>>2],c[o+84>>2]=$,$=c[4+(r=t+96|0)>>2],c[o+96>>2]=c[r>>2],c[o+100>>2]=$,$=c[4+(r=t+112|0)>>2],c[o+112>>2]=c[r>>2],c[o+116>>2]=$,Q=A[(r=o+116|0)>>2],ne=A[($=o+180|0)>>2],ie=A[o+112>>2],Z=A[o+176>>2],oe=A[Y>>2],J=A[X>>2],s=x(x(oe+J)*x(.5)),A[Y>>2]=oe-s,l=x(x(ne+Q)*x(.5)),A[$>>2]=ne-l,_=x(x(Z+ie)*x(.5)),A[o+176>>2]=Z-_,A[X>>2]=J-s,A[r>>2]=Q-l,A[o+112>>2]=ie-_,f=c[c[e+28>>2]+4>>2]-17>>>0<=1?c[c[e+32>>2]+4>>2]-17>>>0<2:0,c[e+68>>2]=0,c[e+4>>2]=0,c[e+8>>2]=1065353216,c[e+60>>2]=-1,c[e+64>>2]=0,c[(Y=e+12|0)>>2]=0,c[Y+4>>2]=0,c[5604]=c[5604]+1,Y=c[e+24>>2],a[Y+312|0]=0,a[Y+356|0]=1,d=p[e+52|0],ae=A[e+48>>2],ce=A[e+44>>2],c[(X=Y+336|0)>>2]=0,c[X+4>>2]=0,c[(X=Y+300|0)>>2]=1566444395,c[X+4>>2]=0,c[Y+292>>2]=1566444395,c[Y+296>>2]=1566444395,c[(X=Y+344|0)>>2]=0,c[X+4>>2]=0,a[Y+352|0]=0,c[Y>>2]=0,a[0|(Y=Y+332|0)]=240&p[0|Y],r=e+4|0,Z=x(0xde0b6b000000000);;){c[o+60>>2]=0,ie=A[e+8>>2],oe=x(-ie),Q=A[e+4>>2],ne=A[e+12>>2],A[o+56>>2]=x(x(A[t+24>>2]*oe)-x(Q*A[t+8>>2]))-x(ne*A[t+40>>2]),A[o+52>>2]=x(x(A[t+20>>2]*oe)-x(Q*A[t+4>>2]))-x(ne*A[t+36>>2]),A[o+48>>2]=x(x(A[t+16>>2]*oe)-x(Q*A[t>>2]))-x(ne*A[t+32>>2]),c[o+44>>2]=0,A[o+40>>2]=x(x(Q*A[t+72>>2])+x(ie*A[t+88>>2]))+x(ne*A[t+104>>2]),A[o+36>>2]=x(x(Q*A[t+68>>2])+x(ie*A[t+84>>2]))+x(ne*A[t+100>>2]),A[o+32>>2]=x(x(Q*A[t+64>>2])+x(ie*A[t+80>>2]))+x(ne*A[t+96>>2]),Re(o+16|0,c[e+28>>2],o+48|0),Re(o,c[e+32>>2],o+32|0);e:{if(oe=A[o+16>>2],J=A[o+20>>2],ie=A[o+24>>2],re=x(x(x(x(oe*A[o+128>>2])+x(J*A[o+132>>2]))+x(ie*A[o+136>>2]))+A[o+176>>2]),K=A[o>>2],te=A[o+4>>2],ee=A[o+8>>2],le=x(x(x(x(K*A[o+64>>2])+x(te*A[o+68>>2]))+x(ee*A[o+72>>2]))+A[o+112>>2]),ne=x(re-le),ue=x(x(x(x(oe*A[o+144>>2])+x(J*A[o+148>>2]))+x(ie*A[o+152>>2]))+A[o+180>>2]),he=x(x(x(x(K*A[o+80>>2])+x(te*A[o+84>>2]))+x(ee*A[o+88>>2]))+A[o+116>>2]),Q=x(ue-he),fe=x(f?0:x(x(x(oe*A[o+160>>2])+x(J*A[o+164>>2]))+x(ie*A[o+168>>2]))+A[o+184>>2]),K=x(f?0:x(x(x(K*A[o+96>>2])+x(te*A[o+100>>2]))+x(ee*A[o+104>>2]))+A[o+120>>2]),J=x(fe-K),(oe=x(x(x(ne*A[e+4>>2])+x(Q*A[e+8>>2]))+x(J*A[e+12>>2])))>x(0)&&x(oe*oe)>x(Z*A[t+128>>2]))c[e+68>>2]=10;else{Y=c[e+24>>2];t:if((0|(pe=c[Y>>2]))<1)se=0;else for(X=Y+12|0,ie=A[Y+308>>2],$=0,se=1;;){if(te=x(ne-A[X-8>>2]),ee=x(te*te),te=x(Q-A[X-4>>2]),ee=x(ee+x(te*te)),te=x(J-A[X>>2]),x(ee+x(te*te))<=ie)break t;if(X=X+16|0,se=(0|($=$+1|0))<(0|pe),(0|$)==(0|pe))break}t:{n:{if(A[Y+304>>2]==x(0)&&J==A[Y+300>>2]&&Q==A[Y+296>>2]){if(A[Y+292>>2]==ne|se)break n;break t}if(!se)break t}c[e+68>>2]=de=1,X=0;break e}if((te=x(Z-oe))<=x(Z*x(9.999999974752427e-7)))c[e+68>>2]=te<=x(0)?2:11;else if(c[Y+304>>2]=0,A[Y+296>>2]=Q,A[Y+300>>2]=J,a[Y+356|0]=1,A[Y+292>>2]=ne,c[16+(X=Y+(pe<<4)|0)>>2]=0,A[X+8>>2]=Q,A[X+12>>2]=J,A[X+4>>2]=ne,X=Y+(c[Y>>2]<<4)|0,c[X+96>>2]=0,A[X+88>>2]=ue,A[X+92>>2]=fe,A[X+84>>2]=re,X=Y+(c[Y>>2]<<4)|0,c[X+176>>2]=0,A[X+168>>2]=he,A[X+172>>2]=K,A[X+164>>2]=le,c[Y>>2]=c[Y>>2]+1,kt(Y=c[e+24>>2])){if(ie=A[Y+288>>2],Q=A[Y+276>>2],J=A[Y+280>>2],K=A[Y+284>>2],!((ne=x(x(x(Q*Q)+x(J*J))+x(K*K)))<x(9.999999974752427e-7))){x(Z-ne)<=x(Z*x(1.1920928955078125e-7))?(c[e+68>>2]=12,de=1,X=0):(A[e+16>>2]=ie,A[e+12>>2]=K,A[e+8>>2]=J,A[e+4>>2]=Q,Y=c[e+64>>2],c[e+64>>2]=Y+1,1e3<((X=0)|Y)||(4==c[c[e+24>>2]>>2]?c[e+68>>2]=13:X=1)),Z=ne;break e}c[e+68>>2]=6,A[e+16>>2]=ie,A[e+12>>2]=K,A[e+8>>2]=J,A[e+4>>2]=Q}else c[e+68>>2]=3}de=1,X=0}if(!X)break}Q=x(0),J=d?x(0):ae,K=x((d?x(0):ce)+J),X=$=0,de&&(kt(Y=c[e+24>>2]),pe=c[4+(se=8+r|0)>>2],c[(X=o+200|0)>>2]=c[se>>2],c[X+4>>2]=pe,X=c[4+r>>2],c[o+192>>2]=c[r>>2],c[o+196>>2]=X,oe=A[Y+268>>2],ie=A[Y+264>>2],ne=A[Y+260>>2],te=A[e+4>>2],ee=A[e+8>>2],ae=A[e+12>>2],(Q=x(x(x(te*te)+x(ee*ee))+x(ae*ae)))<x(9.999999974752427e-7)&&(c[e+68>>2]=5),Y=1,Q=(X=Q>x(14210854715202004e-30))?(Q=x(x(1)/x(T(Q))),A[o+192>>2]=Q*A[o+192>>2],A[o+196>>2]=Q*A[o+196>>2],A[o+200>>2]=Q*A[o+200>>2],Z=x(J/x(T(Z))),oe=x(x(Z*ae)+oe),ie=x(x(Z*ee)+ie),ne=x(x(Z*te)+ne),x(x(x(1)/Q)-K)):(Y=2,x(0)),c[e+60>>2]=Y),c[e+72>>2]&&c[e+20>>2]&&c[e+68>>2]&&($=x(K+Q)<x(.0010000000474974513));e:{t:{if((1^X||$)&&(Y=c[e+20>>2])){if(c[r>>2]=0,c[4+r>>2]=0,c[($=8+r|0)>>2]=0,c[$+4>>2]=0,c[5605]=c[5605]+1,0|pi[c[c[Y>>2]+8>>2]](Y,c[e+24>>2],c[e+28>>2],c[e+32>>2],o+128|0,o- -64|0,r,o+48|0,o+32|0,i)){if(Z=x(0),J=A[o+32>>2],ee=A[o+48>>2],ae=x(J-ee),K=A[o+36>>2],ue=A[o+52>>2],ce=x(K-ue),te=A[o+40>>2],he=A[o+56>>2],re=x(te-he),(le=x(x(x(ae*ae)+x(ce*ce))+x(re*re)))<=x(14210854715202004e-30)&&(ae=A[e+4>>2],ce=A[e+8>>2],re=A[e+12>>2],le=x(x(x(ae*ae)+x(ce*ce))+x(re*re)),Z=A[e+16>>2]),le>x(14210854715202004e-30)){if(c[e+60>>2]=3,ee=x(ee-J),_e=x(ee*ee),ee=x(ue-K),_e=x(_e+x(ee*ee)),ee=x(he-te),!(!((ee=x(-x(T(x(_e+x(ee*ee))))))<Q)&X)){A[o+204>>2]=Z,Q=x(x(1)/x(T(le))),A[o+200>>2]=re*Q,A[o+196>>2]=ce*Q,A[o+192>>2]=ae*Q,ne=J,ie=K,oe=te,Q=ee;break t}c[e+60>>2]=8;break t}if(c[e+60>>2]=9,X)break t;break e}if(te=A[e+4>>2],ee=A[e+8>>2],ae=A[e+12>>2],x(x(x(te*te)+x(ee*ee))+x(ae*ae))>x(0)){if(ce=A[o+32>>2],Z=x(A[o+48>>2]-ce),_e=x(Z*Z),re=A[o+36>>2],Z=x(A[o+52>>2]-re),_e=x(_e+x(Z*Z)),le=A[o+40>>2],Z=x(A[o+56>>2]-le),!(!((Z=x(x(T(x(_e+x(Z*Z))))-K))<Q)&X)){$=c[4+(X=8+r|0)>>2],c[(Y=i=o+200|0)>>2]=c[X>>2],c[Y+4>>2]=$,c[e+60>>2]=6,Y=c[4+r>>2],c[o+192>>2]=c[r>>2],c[o+196>>2]=Y,ne=A[o+192>>2],ie=A[o+196>>2],oe=A[i>>2],Q=x(x(1)/x(T(x(x(x(ne*ne)+x(ie*ie))+x(oe*oe))))),A[i>>2]=oe*Q,A[o+192>>2]=ne*Q,A[o+196>>2]=ie*Q,oe=x(x(J*ae)+le),ie=x(x(J*ee)+re),ne=x(x(J*te)+ce),Q=Z;break t}c[e+60>>2]=5;break t}}if(!X)break e}(A[t+128>>2]>x(Q*Q)||Q<x(0))&&(i=c[o+196>>2],c[r>>2]=c[o+192>>2],c[4+r>>2]=i,A[e+56>>2]=Q,X=c[4+(i=o+200|0)>>2],c[(Y=8+r|0)>>2]=c[i>>2],c[Y+4>>2]=X,c[o+60>>2]=0,Z=A[o+192>>2],K=A[o+196>>2],J=A[i>>2],A[o+56>>2]=x(x(Z*A[t+8>>2])+x(K*A[t+24>>2]))+x(J*A[t+40>>2]),A[o+52>>2]=x(x(Z*A[t+4>>2])+x(K*A[t+20>>2]))+x(J*A[t+36>>2]),A[o+48>>2]=x(x(Z*A[t>>2])+x(K*A[t+16>>2]))+x(J*A[t+32>>2]),c[o+44>>2]=0,K=x(-K),A[o+40>>2]=x(x(A[t+88>>2]*K)-x(Z*A[t+72>>2]))-x(J*A[t+104>>2]),A[o+36>>2]=x(x(A[t+84>>2]*K)-x(Z*A[t+68>>2]))-x(J*A[t+100>>2]),A[o+32>>2]=x(x(A[t+80>>2]*K)-x(Z*A[t+64>>2]))-x(J*A[t+96>>2]),Re(o+16|0,c[e+28>>2],o+48|0),Re(o,c[e+32>>2],o+32|0),Z=A[i>>2],g=A[o+184>>2],y=A[o+168>>2],b=A[o+160>>2],S=A[o+164>>2],C=A[o+120>>2],E=A[o+104>>2],P=A[o+96>>2],w=A[o+100>>2],I=A[o+180>>2],R=A[o+152>>2],D=A[o+144>>2],O=A[o+148>>2],M=A[o+116>>2],z=A[o+88>>2],L=A[o+80>>2],F=A[o+84>>2],B=A[o+176>>2],k=A[o+136>>2],te=A[o+24>>2],U=A[o+128>>2],ee=A[o+16>>2],G=A[o+132>>2],ae=A[o+20>>2],j=A[o+112>>2],V=A[o+72>>2],ce=A[o+8>>2],H=A[o+64>>2],re=A[o>>2],W=A[o+68>>2],le=A[o+4>>2],K=A[o+196>>2],J=A[o+192>>2],c[o+60>>2]=0,ue=x(-K),A[o+56>>2]=x(x(A[t+24>>2]*ue)-x(J*A[t+8>>2]))-x(Z*A[t+40>>2]),A[o+52>>2]=x(x(A[t+20>>2]*ue)-x(J*A[t+4>>2]))-x(Z*A[t+36>>2]),A[o+48>>2]=x(x(A[t+16>>2]*ue)-x(J*A[t>>2]))-x(Z*A[t+32>>2]),c[o+44>>2]=0,A[o+40>>2]=x(x(J*A[t+72>>2])+x(K*A[t+88>>2]))+x(Z*A[t+104>>2]),A[o+36>>2]=x(x(J*A[t+68>>2])+x(K*A[t+84>>2]))+x(Z*A[t+100>>2]),A[o+32>>2]=x(x(J*A[t+64>>2])+x(K*A[t+80>>2]))+x(Z*A[t+96>>2]),Re(o+16|0,c[e+28>>2],o+48|0),Re(o,c[e+32>>2],o+32|0),K=A[o+16>>2],he=A[o+20>>2],fe=A[o+24>>2],u=A[o>>2],h=A[o+4>>2],_e=A[o+8>>2],m=A[o+192>>2],v=A[o+196>>2],q=x(x(x(x(x(x(x(K*A[o+128>>2])+x(he*A[o+132>>2]))+x(fe*A[o+136>>2]))+A[o+176>>2])-x(x(x(x(u*A[o+64>>2])+x(h*A[o+68>>2]))+x(_e*A[o+72>>2]))+A[o+112>>2]))*m)+x(x(x(x(x(x(K*A[o+144>>2])+x(he*A[o+148>>2]))+x(fe*A[o+152>>2]))+A[o+180>>2])-x(x(x(x(u*A[o+80>>2])+x(h*A[o+84>>2]))+x(_e*A[o+88>>2]))+A[o+116>>2]))*v)),_e=x(x(x(x(x(K*A[o+160>>2])+x(he*A[o+164>>2]))+x(fe*A[o+168>>2]))+A[o+184>>2])-x(x(x(x(u*A[o+96>>2])+x(h*A[o+100>>2]))+x(_e*A[o+104>>2]))+A[o+120>>2])),K=A[i>>2],x(q+x(_e*K))<x(x(x(x(x(I+x(x(x(ee*D)+x(ae*O))+x(te*R)))-x(M+x(x(x(re*L)+x(le*F))+x(ce*z))))*ue)-x(J*x(x(B+x(x(x(ee*U)+x(ae*G))+x(te*k)))-x(j+x(x(x(re*H)+x(le*W))+x(ce*V))))))-x(Z*x(x(g+x(x(x(ee*b)+x(ae*S))+x(te*y)))-x(C+x(x(x(re*P)+x(le*w))+x(ce*E))))))&&(c[e+60>>2]=10,A[o+200>>2]=-K,A[o+196>>2]=-v,A[o+192>>2]=-m),c[o+60>>2]=0,A[o+56>>2]=s+oe,A[o+52>>2]=l+ie,A[o+48>>2]=_+ne,pi[c[c[n>>2]+16>>2]](n,o+192|0,o+48|0,Q))}N=o+208|0}function jt(e,t,n,i,o,a,r,s,c,l,_){var u,h;return n=x(x(x(n*a)+x(i*r))+x(o*s)),i=x(x(x(A[e>>2]*a)+x(A[e+16>>2]*r))+x(A[e+32>>2]*s)),o=A[c+80>>2],u=x(i*(i<x(0)?x(-o):o)),i=x(x(x(A[e+4>>2]*a)+x(A[e+20>>2]*r))+x(A[e+36>>2]*s)),o=A[c+84>>2],u=x(u+x(i*(i<x(0)?x(-o):o))),i=x(x(x(A[e+8>>2]*a)+x(A[e+24>>2]*r))+x(A[e+40>>2]*s)),o=A[c+88>>2],i=x(u+x(i*(i<x(0)?x(-o):o))),u=(o=A[c+96>>2])<i?i:o,i=x(x(x(A[t>>2]*a)+x(A[t+16>>2]*r))+x(A[t+32>>2]*s)),o=A[l+80>>2],h=x(i*(i<x(0)?x(-o):o)),i=x(x(x(A[t+4>>2]*a)+x(A[t+20>>2]*r))+x(A[t+36>>2]*s)),o=A[l+84>>2],h=x(h+x(i*(i<x(0)?x(-o):o))),i=x(x(x(A[t+8>>2]*a)+x(A[t+24>>2]*r))+x(A[t+40>>2]*s)),o=A[l+88>>2],i=x(h+x(i*(i<x(0)?x(-o):o))),o=A[l+96>>2],i=x(u+(o<i?i:o)),!(_<((o=x(n+i))<(n=x(i-n))?o:n))}function Vt(e,t,n,i,o,r,s,l){var _,u,h,f,d,m,v,y,b,S,C,E,T,P,w,I=0,R=0,D=0,O=0,L=x(0),F=0,B=x(0),k=x(0),U=0,G=x(0),j=0,V=x(0),H=x(0),W=x(0),q=0,Y=x(0),X=x(0),Q=x(0),Z=0,J=x(0),K=x(0),$=x(0),ee=x(0),te=x(0),ne=0,ie=x(0),oe=x(0);if(N=w=N-16|0,(0|(I=c[o+4>>2]))<=-1)for(c[o+8>>2]<=-1&&((D=c[o+12>>2])&&p[o+16|0]&&(c[5499]=c[5499]+1,z(c[D-4>>2])),a[o+16|0]=1,c[o+8>>2]=0,c[o+12>>2]=0),R=I<<4;Z=c[4+w>>2],D=c[o+12>>2]+R|0,c[D>>2]=c[w>>2],c[D+4>>2]=Z,Z=c[4+(U=8+w|0)>>2],c[(D=D+8|0)>>2]=c[U>>2],c[D+4>>2]=Z,R=R+16|0,(D=I)>>>0<=(I=I+1|0)>>>0;);if(((c[o+4>>2]=R=0)|(D=c[i+4>>2]))>c[o+8>>2]&&(D&&(c[5498]=c[5498]+1,(I=M(19+(D<<4)|0))&&(c[(R=I+19&-16)-4>>2]=I)),(I=c[o+12>>2])&&p[o+16|0]&&(c[5499]=c[5499]+1,z(c[I-4>>2])),c[o+12>>2]=R,a[o+16|0]=1,c[o+8>>2]=D),!((0|(Z=c[t+28>>2]))<1)){for(I=(_=c[t+36>>2])+28|0,L=A[n+40>>2],J=A[n+36>>2],G=A[n+24>>2],k=A[n+20>>2],K=A[e+8>>2],$=A[e+4>>2],ie=A[e>>2],Q=A[n+32>>2],W=A[n+16>>2],V=A[n+8>>2],H=A[n+4>>2],Y=A[n>>2],R=0,B=x(34028234663852886e22),U=-1;X=A[I-8>>2],ee=A[I-4>>2],te=A[I>>2],B=(D=(X=x(x(x(x(x(x(X*Y)+x(ee*H))+x(te*V))*ie)+x(x(x(x(X*W)+x(ee*k))+x(te*G))*$))+x(x(x(x(X*Q)+x(ee*J))+x(te*L))*K)))<B)?X:B,U=D?R:U,I=I+36|0,(0|Z)!=(0|(R=R+1|0)););if(!((0|U)<0)){if(_=_+g(U,36)|0,1<=(0|(d=c[4+_>>2])))for(C=28+_|0,E=24+_|0,T=20+_|0,P=12+_|0,R=0;;){if(m=(0|(Z=R+1|0))==(0|d),2<=(0|(U=c[(D=i)+4>>2]))){for(I=c[P>>2],i=c[I+(R<<2)>>2]<<4,R=c[t+16>>2],B=A[(i=i+R|0)>>2],I=R+(c[I+((m?0:Z)<<2)>>2]<<4)|0,K=x(B-A[I>>2]),X=A[i+4>>2],$=x(X-A[I+4>>2]),ee=A[i+8>>2],ie=x(ee-A[I+8>>2]),v=x(x(x(K*Q)+x($*J))+x(ie*L)),u=A[T>>2],h=A[E>>2],f=A[C>>2],y=x(x(x(Y*u)+x(H*h))+x(V*f)),b=x(x(x(K*Y)+x($*H))+x(ie*V)),S=x(x(x(Q*u)+x(J*h))+x(L*f)),te=x(-x(x(v*y)-x(b*S))),oe=x(x(x(x(x(B*W)+x(X*k))+x(ee*G))+A[n+52>>2])*te),$=x(x(x(K*W)+x($*k))+x(ie*G)),G=x(x(x(W*u)+x(k*h))+x(G*f)),K=x(x($*S)-x(v*G)),W=x(oe-x(K*x(x(x(x(B*Y)+x(X*H))+x(ee*V))+A[n+48>>2]))),Y=x(x(b*G)-x($*y)),X=x(W-x(Y*x(x(x(x(B*Q)+x(X*J))+x(ee*L))+A[n+56>>2]))),I=c[D+12>>2],B=A[4+(i=(I+(U<<4)|0)-16|0)>>2],G=A[i>>2],k=A[i+8>>2],L=x(x(x(x(B*te)-x(K*G))-x(Y*k))-X),ne=0;;){Q=A[4+(i=(ne<<4)+I|0)>>2],W=A[i>>2],V=A[i+8>>2],H=x(x(x(x(Q*te)-x(K*W))-x(Y*V))-X),J=A[i+12>>2];e:{if(L<x(0))if(H<x(0)){if((0|(R=c[o+4>>2]))==c[o+8>>2]&&!((0|(j=R?R<<1:1))<=(0|R))){if(i=0,j&&(c[5498]=c[5498]+1,(I=M(19+(j<<4)|0))&&(c[(i=I+19&-16)-4>>2]=I)),1<=(0|R))for(I=0;F=c[o+12>>2]+I|0,q=c[F+4>>2],c[(O=i+I|0)>>2]=c[F>>2],c[O+4>>2]=q,q=c[4+(F=F+8|0)>>2],c[(O=O+8|0)>>2]=c[F>>2],c[O+4>>2]=q,I=I+16|0,R=R-1|0;);(I=c[o+12>>2])&&p[o+16|0]&&(c[5499]=c[5499]+1,z(c[I-4>>2])),c[o+12>>2]=i,a[o+16|0]=1,c[o+8>>2]=j,R=c[o+4>>2]}i=c[o+12>>2]+(R<<4)|0,A[i+8>>2]=V,A[i+4>>2]=Q,A[i>>2]=W,i=i+12|0}else{if(L=x(L/x(L-H)),k=x(k+x(x(V-k)*L)),B=x(B+x(x(Q-B)*L)),L=x(G+x(x(W-G)*L)),(0|(R=c[o+4>>2]))==c[o+8>>2]&&!((0|(j=R?R<<1:1))<=(0|R))){if(i=0,j&&(c[5498]=c[5498]+1,(I=M(19+(j<<4)|0))&&(c[(i=I+19&-16)-4>>2]=I)),1<=(0|R))for(I=0;F=c[o+12>>2]+I|0,q=c[F+4>>2],c[(O=i+I|0)>>2]=c[F>>2],c[O+4>>2]=q,q=c[4+(F=F+8|0)>>2],c[(O=O+8|0)>>2]=c[F>>2],c[O+4>>2]=q,I=I+16|0,R=R-1|0;);(I=c[o+12>>2])&&p[o+16|0]&&(c[5499]=c[5499]+1,z(c[I-4>>2])),c[o+12>>2]=i,a[o+16|0]=1,c[o+8>>2]=j,R=c[o+4>>2]}i=c[o+12>>2]+(R<<4)|0,A[i+8>>2]=k,A[i+4>>2]=B,A[i>>2]=L,J=x(0),i=i+12|0}else{if(!(H<x(0)))break e;if(L=x(L/x(L-H)),k=x(k+x(x(V-k)*L)),B=x(B+x(x(Q-B)*L)),L=x(G+x(x(W-G)*L)),(0|(R=c[o+4>>2]))==c[o+8>>2]&&!((0|(j=R?R<<1:1))<=(0|R))){if(i=0,j&&(c[5498]=c[5498]+1,(I=M(19+(j<<4)|0))&&(c[(i=I+19&-16)-4>>2]=I)),1<=(0|R))for(I=0;F=c[o+12>>2]+I|0,q=c[F+4>>2],c[(O=i+I|0)>>2]=c[F>>2],c[O+4>>2]=q,q=c[4+(F=F+8|0)>>2],c[(O=O+8|0)>>2]=c[F>>2],c[O+4>>2]=q,I=I+16|0,R=R-1|0;);(I=c[o+12>>2])&&p[o+16|0]&&(c[5499]=c[5499]+1,z(c[I-4>>2])),c[o+12>>2]=i,a[o+16|0]=1,c[o+8>>2]=j,R=c[o+4>>2]}if(i=c[o+12>>2]+(R<<4)|0,c[i+12>>2]=0,A[i+8>>2]=k,A[i+4>>2]=B,A[i>>2]=L,R=c[o+4>>2],c[o+4>>2]=I=R+1|0,c[o+8>>2]==(0|I)&&!((0|(j=I?I<<1:1))<=(0|I))){if(i=0,j&&(c[5498]=c[5498]+1,(I=M(19+(j<<4)|0))&&(c[(i=I+19&-16)-4>>2]=I)),0<=(0|R))for(R=R+1|0,I=0;F=c[o+12>>2]+I|0,q=c[F+4>>2],c[(O=i+I|0)>>2]=c[F>>2],c[O+4>>2]=q,q=c[4+(F=F+8|0)>>2],c[(O=O+8|0)>>2]=c[F>>2],c[O+4>>2]=q,I=I+16|0,R=R-1|0;);(I=c[o+12>>2])&&p[o+16|0]&&(c[5499]=c[5499]+1,z(c[I-4>>2])),c[o+12>>2]=i,a[o+16|0]=1,c[o+8>>2]=j,I=c[o+4>>2]}i=c[o+12>>2]+(I<<4)|0,A[i+8>>2]=V,A[i+4>>2]=Q,A[i>>2]=W,i=i+12|0}A[i>>2]=J,c[o+4>>2]=c[o+4>>2]+1}if((0|(ne=ne+1|0))==(0|U))break;I=c[D+12>>2],L=H,k=V,B=Q,G=W}U=c[D+4>>2]}if((0|U)<=-1)for(c[D+8>>2]<=-1&&((i=c[D+12>>2])&&p[D+16|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),a[D+16|0]=1,c[D+8>>2]=0,c[D+12>>2]=0),I=U<<4;R=c[4+w>>2],i=c[D+12>>2]+I|0,c[i>>2]=c[w>>2],c[i+4>>2]=R,ne=c[4+(R=8+w|0)>>2],c[(i=i+8|0)>>2]=c[R>>2],c[i+4>>2]=ne,I=I+16|0,(i=U)>>>0<=(U=i+1|0)>>>0;);if(c[D+4>>2]=0,L=A[n+40>>2],J=A[n+36>>2],Q=A[n+32>>2],G=A[n+24>>2],k=A[n+20>>2],W=A[n+16>>2],V=A[n+8>>2],H=A[n+4>>2],Y=A[n>>2],i=o,R=Z,o=D,m)break}if(!((0|(U=c[i+4>>2]))<1))for(B=A[20+_>>2],oe=x(B*Y),Y=A[24+_>>2],oe=x(oe+x(Y*H)),H=A[28+_>>2],V=x(oe+x(H*V)),G=x(x(x(B*W)+x(Y*k))+x(H*G)),L=x(x(x(B*Q)+x(Y*J))+x(H*L)),B=x(A[32+_>>2]-x(x(x(V*A[n+48>>2])+x(G*A[n+52>>2]))+x(L*A[n+56>>2]))),R=I=0;n=8+(t=c[i+12>>2]+I|0)|0,I=I+16|0,(k=(k=x(B+x(x(x(V*A[t>>2])+x(G*A[t+4>>2]))+x(L*A[n>>2]))))<=r?r:k)<=s&&(D=c[n+4>>2],c[(o=8+w|0)>>2]=c[n>>2],c[o+4>>2]=D,n=c[t+4>>2],c[w>>2]=c[t>>2],c[4+w>>2]=n,pi[c[c[l>>2]+16>>2]](l,e,w,k),U=c[i+4>>2]),(0|(R=R+1|0))<(0|U););}}N=16+w|0}function Ht(e,t,n,i,o,r){e|=0,t|=0,n|=0,i|=0,o|=0,r|=0;var s,l,_,u,h,f,d,m,v,g,y,b,S,C=0,E=x(0),T=x(0),P=x(0),w=x(0),I=x(0),R=x(0);N=S=N-288|0,s=c[e+4>>2],c[s+292>>2]=1566444395,c[s+296>>2]=1566444395,c[(C=s+336|0)>>2]=0,c[C+4>>2]=0,c[(C=s+300|0)>>2]=1566444395,c[C+4>>2]=0,c[(C=s+344|0)>>2]=0,c[C+4>>2]=0,a[s+352|0]=0,a[0|(C=s+332|0)]=240&p[0|C],a[s+312|0]=0,a[s+356|0]=1,c[s>>2]=0,E=A[n+52>>2],T=A[t+52>>2],w=A[o+52>>2],I=A[i+52>>2],R=A[n+56>>2],P=A[(l=t+56|0)>>2],u=A[o+56>>2],h=A[(_=i+56|0)>>2],f=A[n+48>>2],d=A[t+48>>2],m=A[o+48>>2],v=A[i+48>>2],a[264+S|0]=0,c[260+S>>2]=1566444395,c[224+S>>2]=12428,c[(s=156+S|0)>>2]=0,c[4+s>>2]=0,c[144+S>>2]=12272,c[164+S>>2]=0,c[148+S>>2]=0,c[152+S>>2]=1065353216,s=c[e+12>>2],c[176+S>>2]=s,C=c[e+8>>2],c[172+S>>2]=C,c[168+S>>2]=c[e+4>>2],c[180+S>>2]=c[C+4>>2],c[184+S>>2]=c[s+4>>2],y=S,b=x(pi[c[c[C>>2]+48>>2]](C)),A[188+y>>2]=b,g=x(pi[c[c[s>>2]+48>>2]](s)),c[216+S>>2]=1,c[220+S>>2]=1,c[204+S>>2]=-1,a[196+S|0]=0,A[192+S>>2]=g,C=c[4+(s=t+8|0)>>2],c[(e=16+S|0)>>2]=c[s>>2],c[e+4>>2]=C,C=c[4+(s=t+24|0)>>2],c[(e=32+S|0)>>2]=c[s>>2],c[e+4>>2]=C,C=c[4+(s=t+40|0)>>2],c[(e=48+S|0)>>2]=c[s>>2],c[e+4>>2]=C,s=c[4+l>>2],c[(e=S+64|0)>>2]=c[l>>2],c[e+4>>2]=s,C=c[4+(s=i+8|0)>>2],c[(e=80+S|0)>>2]=c[s>>2],c[e+4>>2]=C,c[136+S>>2]=1566444395,e=c[t+4>>2],c[8+S>>2]=c[t>>2],c[12+S>>2]=e,e=c[t+20>>2],c[24+S>>2]=c[t+16>>2],c[28+S>>2]=e,e=c[t+36>>2],c[40+S>>2]=c[t+32>>2],c[44+S>>2]=e,e=c[t+52>>2],c[56+S>>2]=c[t+48>>2],c[60+S>>2]=e,e=c[i+4>>2],c[72+S>>2]=c[i>>2],c[76+S>>2]=e,C=c[4+(s=i+24|0)>>2],c[(e=96+S|0)>>2]=c[s>>2],c[e+4>>2]=C,s=c[i+20>>2],c[(e=88+S|0)>>2]=c[i+16>>2],c[e+4>>2]=s,C=c[4+(s=i+40|0)>>2],c[(e=112+S|0)>>2]=c[s>>2],c[e+4>>2]=C,s=c[i+36>>2],c[(e=104+S|0)>>2]=c[i+32>>2],c[e+4>>2]=s,s=c[4+_>>2],c[(e=128+S|0)>>2]=c[_>>2],c[e+4>>2]=s,s=c[i+52>>2],c[(e=120+S|0)>>2]=c[i+48>>2],c[e+4>>2]=s,Gt(144+S|0,8+S|0,224+S|0,0,0),C=c[4+(s=252+S|0)>>2],c[(e=280+S|0)>>2]=c[s>>2],c[e+4>>2]=C,e=c[248+S>>2],c[272+S>>2]=c[244+S>>2],c[276+S>>2]=e;e:if(p[264+S|(e=0)]){u=x(x(R-P)-x(u-h)),h=x(x(E-T)-x(w-I)),f=x(x(f-d)-x(m-v)),w=A[236+S>>2],I=A[232+S>>2],R=A[228+S>>2];t:{if((P=A[260+S>>2])>x(.0010000000474974513)){for(s=244+S|0,C=33,T=x(0);;){if(!(C=C-1|(e=0)))break e;if(e=0,(E=x(T-x(P/x(x(x(f*R)+x(h*I))+x(u*w)))))<=T)break e;if(e=0,E>x(1))break e;if(E<x(e=0))break e;if(pi[c[c[r>>2]>>2]](r,E),T=x(x(1)-E),A[56+S>>2]=x(T*A[t+48>>2])+x(E*A[n+48>>2]),A[60+S>>2]=x(T*A[t+52>>2])+x(E*A[n+52>>2]),A[64+S>>2]=x(T*A[t+56>>2])+x(E*A[n+56>>2]),A[120+S>>2]=x(T*A[i+48>>2])+x(E*A[o+48>>2]),A[124+S>>2]=x(T*A[i+52>>2])+x(E*A[o+52>>2]),A[128+S>>2]=x(T*A[i+56>>2])+x(E*A[o+56>>2]),Gt(144+S|0,8+S|0,224+S|0,0,0),!p[264+S|(e=0)])break e;if((P=A[260+S>>2])<x(0)){A[r+164>>2]=E,e=c[232+S>>2],c[r+132>>2]=c[228+S>>2],c[r+136>>2]=e,t=c[240+S>>2],c[(e=r+140|0)>>2]=c[236+S>>2],c[e+4>>2]=t,e=c[4+s>>2],c[r+148>>2]=c[s>>2],c[r+152>>2]=e,n=c[4+(t=8+s|0)>>2],c[(e=r+156|0)>>2]=c[t>>2],c[e+4>>2]=n;break t}if(_=c[4+(l=8+s|0)>>2],c[(e=280+S|0)>>2]=c[l>>2],c[e+4>>2]=_,e=c[4+s>>2],c[272+S>>2]=c[s>>2],c[276+S>>2]=e,w=A[236+S>>2],I=A[232+S>>2],R=A[228+S>>2],T=E,!(P>x(.0010000000474974513)))break}T=A[240+S>>2]}else E=x(0),T=A[240+S>>2];if(e=0,x(-A[r+172>>2])<=x(x(x(f*R)+x(h*I))+x(u*w)))break e;A[r+132>>2]=R,A[r+164>>2]=E,e=c[276+S>>2],c[r+148>>2]=c[272+S>>2],c[r+152>>2]=e,A[r+144>>2]=T,A[r+140>>2]=w,A[r+136>>2]=I,n=c[4+(t=280+S|0)>>2],c[(e=r+156|0)>>2]=c[t>>2],c[e+4>>2]=n}e=1}return N=288+S|0,0|e}function Wt(e,t,n,i,o,a,r,s,l,_,u){var h,f=x(0),p=x(0),d=x(0),m=x(0),v=x(0),g=x(0),b=A[(s=(s<<2)+_|0)>>2],S=x(A[_+48>>2]-A[l+48>>2]),C=A[s+16>>2],E=x(A[_+52>>2]-A[l+52>>2]),P=A[s+32>>2],w=x(A[_+56>>2]-A[l+56>>2]),I=(d=x(x(x(b*S)+x(C*E))+x(P*w)),A[(r=(r<<2)+l|0)>>2]),R=(m=A[r+16>>2],A[r+32>>2]);g=x(x(x(I*S)+x(m*E))+x(R*w)),v=x(x(x(I*b)+x(m*C))+x(R*P)),(p=x(x(1)-x(v*v)))!=x(0)&&(f=x(-n),(p=x(x(g-x(v*d))/p))<f||n<(f=p)&&(f=n));e:{if((p=x(x(v*f)-d))<(d=x(-o))){if(f=x(-n),(o=x(g-x(v*o)))<f){p=d;break e}if(!(n<o)){p=d,f=o;break e}o=d}else{if(!(o<p))break e;if(f=x(-n),(d=x(x(v*o)+g))<f){p=o;break e}if(!(n<d)){p=o,f=d;break e}}p=o,f=n}return h=u,d=x(P*p),n=x(d+x(w-x(R*f))),v=x(b*p),o=x(v+x(S-x(I*f))),p=x(C*p),u=x(p+x(E-x(m*f))),f=x(x(n*n)+x(x(o*o)+x(u*u))),g=x(T(f)),h<(b=x(x(g-i)-a))||(f<=x(14210854715202004e-30)?x(y(R))>x(.7071067690849304)?(c[e>>2]=0,i=x(x(1)/x(T(x(x(m*m)+x(R*R))))),n=x(m*i),A[e+8>>2]=n,f=x(i*x(-R)),A[e+4>>2]=f,i=x(0)):(c[e+8>>2]=0,n=x(x(1)/x(T(x(x(I*I)+x(m*m))))),f=x(I*n),A[e+4>>2]=f,i=x(n*x(-m)),A[e>>2]=i,n=x(0)):(c[e+12>>2]=0,i=x(x(-1)/g),n=x(n*i),A[e+8>>2]=n,f=x(u*i),A[e+4>>2]=f,i=x(o*i),A[e>>2]=i),o=A[_+48>>2],u=A[_+52>>2],m=A[_+56>>2],c[t+12>>2]=0,A[t+8>>2]=x(d+m)+x(n*a),A[t+4>>2]=x(p+u)+x(f*a),A[t>>2]=x(v+o)+x(i*a)),b}function qt(){}function Yt(e,t,n,i,o,r){e|=0,t|=0,n|=0,i|=0,o|=0,r|=0;var s,l,_,u,h,f,d,m,v,g,y,b,S,C,E,P,w,I,R,D,O,M,z,L,F,B,k,U,G,j,V,H=0,W=x(0),q=0,Y=x(0),X=0,Q=x(0),Z=x(0),J=x(0),K=x(0),$=0,ee=x(0),te=x(0),ne=x(0),ie=x(0),oe=0,ae=x(0),re=x(0),se=0,ce=x(0),le=x(0),_e=x(0),ue=x(0),he=x(0),fe=x(0),pe=x(0),de=x(0),me=x(0),Ae=x(0),ve=x(0),ge=x(0),xe=x(0),ye=x(0);N=V=N-32|0,X=c[e+4>>2],a[X+312|0]=0,a[X+356|0]=1,c[X>>2]=0,c[X+292>>2]=1566444395,c[X+296>>2]=1566444395,c[(H=X+336|0)>>2]=0,c[H+4>>2]=0,c[(H=X+300|0)>>2]=1566444395,c[H+4>>2]=0,c[(H=X+344|0)>>2]=0,c[H+4>>2]=0,a[X+352|0]=0,a[0|(H=X+332|0)]=240&p[0|H],R=A[(f=i+40|0)>>2],D=A[(d=i+36|0)>>2],O=A[(m=i+24|0)>>2],M=A[(v=i+20|0)>>2],g=A[(z=t+20|0)>>2],y=A[(L=t+36|0)>>2],b=A[(q=t+24|0)>>2],Q=A[n+52>>2],pe=A[($=t+52|0)>>2],ee=A[o+52>>2],de=A[(oe=i+52|0)>>2],S=A[(se=t+40|0)>>2],le=A[n+56>>2],me=A[(X=t+56|0)>>2],Z=A[o+56>>2],Ae=A[(H=i+56|0)>>2],F=A[i+32>>2],B=A[i+16>>2],k=A[i+8>>2],U=A[i+4>>2],G=A[i>>2],C=A[t>>2],E=A[t+16>>2],P=A[t+32>>2],w=A[t+4>>2],I=A[t+8>>2],W=A[n+48>>2],ve=A[t+48>>2],J=A[o+48>>2],ge=A[i+48>>2],j=c[e+8>>2],c[12+V>>2]=0,h=x(x(Q-pe)-x(ee-de)),ee=x(-h),l=x(x(W-ve)-x(J-ge)),_=x(x(le-me)-x(Z-Ae)),A[8+V>>2]=x(x(b*ee)-x(I*l))-x(S*_),A[4+V>>2]=x(x(g*ee)-x(l*w))-x(_*y),A[V>>2]=x(x(E*ee)-x(l*C))-x(_*P),pi[c[c[j>>2]+64>>2]](16+V|0,j,V),K=A[X>>2],_e=A[se>>2],ue=A[L>>2],he=A[$>>2],fe=A[q>>2],ae=A[z>>2],re=A[t+32>>2],s=A[t+48>>2],Y=A[t+8>>2],Q=A[t>>2],Z=A[t+4>>2],W=A[t+16>>2],ne=A[24+V>>2],ie=A[16+V>>2],ce=A[20+V>>2],X=c[e+12>>2],c[12+V>>2]=0,A[8+V>>2]=x(x(l*A[i+8>>2])+x(h*A[m>>2]))+x(_*A[f>>2]),A[4+V>>2]=x(x(l*A[i+4>>2])+x(h*A[v>>2]))+x(_*A[d>>2]),A[V>>2]=x(x(l*A[i>>2])+x(h*A[i+16>>2]))+x(_*A[i+32>>2]),pi[c[c[X>>2]+64>>2]](16+V|0,X,V),ee=x(0),le=x(0),J=x(0);e:{t:if(Y=x(s+x(x(x(ie*Q)+x(ce*Z))+x(ne*Y))),u=A[16+V>>2],s=A[20+V>>2],Z=A[24+V>>2],Y=x(Y-x(x(x(x(u*A[i>>2])+x(s*A[i+4>>2]))+x(Z*A[i+8>>2]))+A[i+48>>2])),Q=x(x(he+x(x(x(ie*W)+x(ce*ae))+x(ne*fe)))-x(x(x(x(u*A[i+16>>2])+x(s*A[v>>2]))+x(Z*A[m>>2]))+A[oe>>2])),W=x(x(K+x(x(x(ie*re)+x(ce*ue))+x(ne*_e)))-x(x(x(x(u*A[i+32>>2])+x(s*A[d>>2]))+x(Z*A[f>>2]))+A[H>>2])),x(x(x(Y*Y)+x(Q*Q))+x(W*W))>x(9999999747378752e-20))for(X=31,Z=x(0);;){if(H=c[e+8>>2],c[12+V>>2]=$=0,s=x(-Q),A[8+V>>2]=x(x(b*s)-x(I*Y))-x(S*W),A[4+V>>2]=x(x(g*s)-x(w*Y))-x(y*W),A[V>>2]=x(x(E*s)-x(C*Y))-x(P*W),pi[c[c[H>>2]+64>>2]](16+V|0,H,V),ce=A[24+V>>2],u=A[16+V>>2],ae=A[20+V>>2],H=c[e+12>>2],c[12+V>>2]=0,A[8+V>>2]=x(x(k*Y)+x(O*Q))+x(R*W),A[4+V>>2]=x(x(U*Y)+x(M*Q))+x(D*W),A[V>>2]=x(x(G*Y)+x(B*Q))+x(F*W),pi[c[c[H>>2]+64>>2]](16+V|0,H,V),te>x(1))break e;if(_e=x(ve+x(x(x(C*u)+x(w*ae))+x(I*ce))),K=A[16+V>>2],re=A[20+V>>2],s=A[24+V>>2],ue=x(ge+x(x(x(G*K)+x(U*re))+x(k*s))),ne=x(_e-ue),he=x(pe+x(x(x(E*u)+x(g*ae))+x(b*ce))),fe=x(de+x(x(x(B*K)+x(M*re))+x(O*s))),ie=x(he-fe),ae=x(me+x(x(x(P*u)+x(y*ae))+x(S*ce))),re=x(Ae+x(x(x(F*K)+x(D*re))+x(R*s))),K=x(ae-re),(s=x(x(x(ne*Y)+x(ie*Q))+x(K*W)))>x(0)){if((J=x(x(x(l*Y)+x(h*Q))+x(_*W)))>=x(-14210854715202004e-30))break e;te=x(te-x(s/J)),J=x(x(1)-te),Ae=x(x(J*A[i+56>>2])+x(te*A[o+56>>2])),de=x(x(J*A[i+52>>2])+x(te*A[o+52>>2])),ge=x(x(J*A[i+48>>2])+x(te*A[o+48>>2])),me=x(x(J*A[t+56>>2])+x(te*A[n+56>>2])),pe=x(x(J*A[t+52>>2])+x(te*A[n+52>>2])),ve=x(x(J*A[t+48>>2])+x(te*A[n+48>>2])),ee=Y,le=Q,xe=W,J=Z}q=c[e+4>>2];n:if((0|(H=c[q>>2]))<1)se=0;else for(oe=q+12|0,Z=A[q+308>>2],se=1;;){if(W=x(ne-A[oe-8>>2]),Y=x(W*W),W=x(ie-A[oe-4>>2]),Y=x(Y+x(W*W)),W=x(K-A[oe>>2]),Z>=x(Y+x(W*W)))break n;if(oe=oe+16|0,se=(0|($=$+1|0))<(0|H),(0|H)==(0|$))break}n:{i:{if(A[q+304>>2]==x(0)&&K==A[q+300>>2]&&ie==A[q+296>>2]){if(!(ne==A[q+292>>2]|se))break i;break n}if(se)break n}c[q+304>>2]=0,A[q+296>>2]=ie,A[q+300>>2]=K,a[q+356|0]=1,A[q+292>>2]=ne,c[16+(H=(H<<4)+q|0)>>2]=0,A[H+8>>2]=ie,A[H+12>>2]=K,A[H+4>>2]=ne,H=(c[q>>2]<<4)+q|0,c[H+96>>2]=0,A[H+88>>2]=he,A[H+92>>2]=ae,A[H+84>>2]=_e,H=(c[q>>2]<<4)+q|0,c[H+176>>2]=0,A[H+168>>2]=fe,A[H+172>>2]=re,A[H+164>>2]=ue,c[q>>2]=c[q>>2]+1,q=c[e+4>>2]}if(!kt(q))break t;if(Y=A[q+276>>2],Q=A[q+280>>2],W=A[q+284>>2],!(x(x(x(Y*Y)+x(Q*Q))+x(W*W))>x(9999999747378752e-20)))break t;if(!X)break t;Z=A[q+288>>2],X=X-1|0}A[r+164>>2]=te,Y=x(0),Q=x(0),W=x(0),(Z=x(x(x(ee*ee)+x(le*le))+x(xe*xe)))>=x(14210854715202004e-30)&&(W=x(x(1)/x(T(Z))),Q=x(xe*W),Y=x(le*W),ye=x(ee*W),W=J),A[r+132>>2]=ye,A[r+144>>2]=W,A[r+140>>2]=Q,A[r+136>>2]=Y,$=0,x(-A[r+172>>2])<=x(x(x(l*ye)+x(h*Y))+x(_*Q))||(kt(e=c[e+4>>2]),o=c[e+260>>2],i=c[e+264>>2],e=c[4+(t=e+268|0)>>2],c[(n=r+156|0)>>2]=c[t>>2],c[n+4>>2]=e,c[r+148>>2]=o,c[r+152>>2]=i,$=1)}return N=32+V|0,0|$}function Xt(){return 2}function Qt(){return 3}function Zt(){return 1}function Jt(e,t,n){var i,o,r,s,l,_=0,u=0,h=0,f=0;if(N=l=N-32|0,s=p[e+68|0],r=c[(o=s?n:t)+4>>2],i=c[r+24>>2],(0|(f=c[e+52>>2]))<(0|i)){if(c[e+56>>2]<(0|i)){if(i&&(c[5498]=c[5498]+1,(_=M(19+(i<<2)|0))&&(c[(h=_+19&-16)-4>>2]=_)),1<=(0|f))for(_=f;c[u+h>>2]=c[c[e+60>>2]+u>>2],u=u+4|0,_=_-1|0;);(_=c[e+60>>2])&&p[e- -64|0]&&(c[5499]=c[5499]+1,z(c[_-4>>2])),c[e+60>>2]=h,c[e+56>>2]=i,a[e- -64|0]=1}for(u=f<<2,_=i-f|0;u=u+4|(c[c[e+60>>2]+u>>2]=0),_=_-1|0;);}if(1<=(0|(c[e+52>>2]=i)))for(t=s?t:n,_=64,h=u=0;c[r+72>>2]?c[c[e+60>>2]+u>>2]=0:(n=c[c[r+32>>2]+_>>2],c[28+l>>2]=h,c[24+l>>2]=-1,c[8+l>>2]=o,f=c[o+12>>2],c[16+l>>2]=c[o+8>>2],c[20+l>>2]=f,c[12+l>>2]=n,n=c[e+4>>2],n=0|pi[c[c[n>>2]+8>>2]](n,8+l|0,t,c[e+72>>2],1),c[c[e+60>>2]+u>>2]=n),_=_+80|0,u=u+4|0,(0|(h=h+1|0))!=(0|i););N=32+l|0}function Kt(e){var t,n=0,i=0;if(c[(e|=0)>>2]=13820,1<=(0|(i=c[e+52>>2])))for(;(t=c[c[e+60>>2]+n>>2])&&(pi[c[c[t>>2]>>2]](t),t=c[e+4>>2],pi[c[c[t>>2]+60>>2]](t,c[c[e+60>>2]+n>>2])),n=n+4|0,i=i-1|0;);return(n=c[e+60>>2])&&p[e- -64|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+60>>2]=0,c[e+52>>2]=0,c[e+56>>2]=0,a[e- -64|0]=1,(n=c[e+40>>2])&&p[e+44|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+40>>2]=0,a[e+44|0]=1,c[(n=e+32|0)>>2]=0,c[n+4>>2]=0,(n=c[e+20>>2])&&p[e+24|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+20>>2]=0,a[e+24|0]=1,c[(n=e+12|0)>>2]=0,(c[n+4>>2]=0)|e}function $t(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var r,s,l,_,u,h,f,d,m=0,v=0,g=0,y=x(0),b=x(0),S=x(0),C=x(0),E=x(0),T=x(0),P=x(0),w=x(0),I=x(0),R=x(0),D=x(0),O=x(0),L=x(0),F=x(0),B=x(0),k=x(0),U=x(0),G=x(0),j=x(0),V=x(0),H=x(0),W=x(0),q=x(0),Y=x(0);if(N=d=N-160|0,r=p[e+68|0],s=c[(l=r?n:t)+4>>2],c[s+76>>2]!=c[e+80>>2]){if(1<=(0|(g=c[e+52>>2])))for(;(v=c[c[e+60>>2]+m>>2])&&(pi[c[c[v>>2]>>2]](v),v=c[e+4>>2],pi[c[c[v>>2]+60>>2]](v,c[c[e+60>>2]+m>>2])),m=m+4|0,g=g-1|0;);Jt(e,t,n),c[e+80>>2]=c[s+76>>2]}if(v=c[e+52>>2]){if(g=c[s+72>>2],c[148+d>>2]=o,c[144+d>>2]=i,c[136+d>>2]=r=r?t:n,c[132+d>>2]=l,c[128+d>>2]=13860,c[156+d>>2]=c[e+72>>2],c[152+d>>2]=c[e+60>>2],c[140+d>>2]=c[e+4>>2],(0|(m=c[e+32>>2]))<=-1){for(c[e+36>>2]<=-1&&((t=c[e+40>>2])&&p[e+44|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+36>>2]=0,c[e+40>>2]=0,a[e+44|0]=1),v=m<<2;v=v+4|(c[c[e+40>>2]+v>>2]=0),(t=m)>>>0<=(m=t+1|0)>>>0;);v=c[e+52>>2]}if(1<=((c[e+32>>2]=0)|v))for(h=e+28|0,n=0;;){if(t=c[c[e+60>>2]+(n<<2)>>2]){if(pi[c[c[t>>2]+16>>2]](t,h),1<=(0|(m=c[e+32>>2])))for(t=v=0;i=c[c[e+40>>2]+v>>2],c[i+844>>2]&&(c[o+4>>2]=i,_=c[c[o+8>>2]+8>>2],u=c[i+836>>2],f=i,i=c[c[o+12>>2]+8>>2],Bt(f,((m=(0|_)==(0|u))?u:i)+4|0,(m?i:_)+4|0),c[o+4>>2]=0,m=c[e+32>>2]),v=v+4|0,(0|(t=t+1|0))<(0|m););if((0|m)<=-1)for(c[e+36>>2]<=-1&&((t=c[e+40>>2])&&p[e+44|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),a[e+44|0]=1,c[e+36>>2]=0,c[e+40>>2]=0),v=m<<2;v=v+4|(c[c[e+40>>2]+v>>2]=0),(t=m)>>>0<=(m=t+1|0)>>>0;);c[e+32>>2]=0,v=c[e+52>>2]}if(!((0|(n=n+1|0))<(0|v)))break}if(g){if(t=c[l+12>>2],R=A[t+52>>2],D=A[t+56>>2],n=c[r+12>>2],O=A[n+52>>2],L=A[n+56>>2],y=A[t+20>>2],b=A[t+36>>2],F=A[n+20>>2],B=A[n+36>>2],k=A[n+24>>2],S=A[t+24>>2],U=A[n+40>>2],C=A[t+40>>2],G=A[n+32>>2],E=A[t+32>>2],j=A[n>>2],T=A[t>>2],V=A[n+16>>2],P=A[t+16>>2],H=A[t+48>>2],W=A[n+48>>2],w=A[t+4>>2],q=A[n+4>>2],Y=A[n+8>>2],I=A[t+8>>2],c[92+d>>2]=0,c[76+d>>2]=0,c[60+d>>2]=0,A[72+d>>2]=x(x(I*Y)+x(S*k))+x(C*U),A[68+d>>2]=x(x(I*q)+x(S*F))+x(C*B),A[56+d>>2]=x(x(w*Y)+x(y*k))+x(b*U),A[52+d>>2]=x(x(w*q)+x(y*F))+x(b*B),R=x(-R),A[88+d>>2]=x(x(x(S*R)-x(I*H))-x(C*D))+x(x(x(I*W)+x(S*O))+x(C*L)),A[84+d>>2]=x(x(x(y*R)-x(w*H))-x(b*D))+x(x(x(w*W)+x(y*O))+x(b*L)),c[44+d>>2]=0,A[32+d>>2]=x(x(T*j)+x(P*V))+x(E*G),A[64+d>>2]=x(x(I*j)+x(S*V))+x(C*G),A[48+d>>2]=x(x(w*j)+x(y*V))+x(b*G),A[40+d>>2]=x(x(T*Y)+x(P*k))+x(E*U),A[36+d>>2]=x(x(T*q)+x(P*F))+x(E*B),A[80+d>>2]=x(x(x(P*R)-x(T*H))-x(E*D))+x(x(x(T*W)+x(P*O))+x(E*L)),t=c[r+4>>2],pi[c[c[t>>2]+8>>2]](t,32+d|0,112+d|0,96+d|0),y=A[o+32>>2],b=x(A[112+d>>2]-y),A[112+d>>2]=b,S=x(A[116+d>>2]-y),A[116+d>>2]=S,C=x(A[120+d>>2]-y),A[120+d>>2]=C,E=x(y+A[96+d>>2]),A[96+d>>2]=E,T=x(y+A[100+d>>2]),A[100+d>>2]=T,y=x(y+A[104+d>>2]),A[104+d>>2]=y,i=c[g>>2]){if(t=c[e+16>>2],(0|(m=c[e+12>>2]))<=-1)for((0|t)<=-1&&((t=c[e+20>>2])&&p[e+24|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+16>>2]=0,c[e+20>>2]=0,a[e+24|0]=1,t=0),v=m<<2;v=v+4|(c[c[e+20>>2]+v>>2]=0),(n=m)>>>0<=(m=n+1|0)>>>0;);if(((c[e+12>>2]=m=0)|t)<=63&&(c[5498]=c[5498]+1,v=0,(t=M(275))&&(c[(v=t+19&-16)-4>>2]=t),(t=c[e+20>>2])&&p[e+24|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2]),m=c[e+12>>2]),c[e+20>>2]=v,c[e+16>>2]=64,a[e+24|0]=1,t=64),(0|t)==(0|m))if((0|(o=t<<1))<=(0|t))m=t;else{for(m=0,c[5498]=c[5498]+1,(n=M(19+(t<<3)|(g=0)))&&(c[(g=n+19&-16)-4>>2]=n),v=t;c[m+g>>2]=c[c[e+20>>2]+m>>2],m=m+4|0,v=v-1|0;);(n=c[e+20>>2])&&p[e+24|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2]),t=c[e+12>>2]),m=t,c[e+20>>2]=g,c[e+16>>2]=o,a[e+24|0]=1}for(c[c[e+20>>2]+(m<<2)>>2]=i,m=m+1|0;;){if(c[e+12>>2]=v=m-1|0,o=c[e+20>>2],i=c[o+(v<<2)>>2],E>=A[i>>2])if(b<=A[i+16>>2])if(T>=A[i+4>>2])if(S<=A[i+20>>2])if(y>=A[i+8>>2])if(C<=A[i+24>>2])if(c[i+40>>2]){if((0|v)==(0|(n=c[e+16>>2])))if((0|(n=v?v<<1:1))<(0|m))n=v;else{if(o=0,n&&(c[5498]=c[5498]+1,(t=M(19+(n<<2)|0))&&(c[(o=t+19&-16)-4>>2]=t)),2<=(0|m))for(t=m-1|0,m=0;c[o+m>>2]=c[c[e+20>>2]+m>>2],m=m+4|0,t=t-1|0;);(t=c[e+20>>2])&&p[e+24|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2]),v=c[e+12>>2]),c[e+20>>2]=o,a[e+24|0]=1,c[e+16>>2]=n}if(c[e+12>>2]=t=v+1|0,c[(v<<2)+o>>2]=c[i+36>>2],(0|t)==(0|n))if((0|(g=n?n<<1:1))<=(0|n))t=n;else{if(o=0,g&&(c[5498]=c[5498]+1,(t=M(19+(g<<2)|0))&&(c[(o=t+19&-16)-4>>2]=t)),1<=(0|n))for(m=0,v=n;c[o+m>>2]=c[c[e+20>>2]+m>>2],m=m+4|0,v=v-1|0;);t=n,(n=c[e+20>>2])&&p[e+24|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2]),t=c[e+12>>2]),c[e+20>>2]=o,a[e+24|0]=1,c[e+16>>2]=g}c[e+12>>2]=m=t+1|0,c[c[e+20>>2]+(t<<2)>>2]=c[i+40>>2]}else pi[c[c[128+d>>2]+12>>2]](128+d|0,i),m=c[e+12>>2];else m=v;else m=v;else m=v;else m=v;else m=v;else m=v;if(!(0<(0|m)))break}}}else if(!((0|v)<1))for(m=0,g=64;en(128+d|0,c[c[s+32>>2]+g>>2],m),g=g+80|0,(0|v)!=(0|(m=m+1|0)););if(t=c[e+52>>2],(0|(m=c[e+32>>2]))<=-1)for(c[e+36>>2]<=-1&&((n=c[e+40>>2])&&p[e+44|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+36>>2]=0,c[e+40>>2]=0,a[e+44|0]=1),v=m<<2;v=v+4|(c[c[e+40>>2]+v>>2]=0),(n=m)>>>0<=(m=n+1|0)>>>0;);if(!(((c[e+32>>2]=0)|t)<1))for(o=32,g=0;c[c[e+60>>2]+g>>2]&&(n=c[s+32>>2]+o|0,m=c[n+32>>2],i=c[l+12>>2],q=A[i+52>>2],Y=A[i+56>>2],D=A[n+16>>2],O=A[n+20>>2],L=A[n+24>>2],y=A[i+20>>2],b=A[i+24>>2],F=A[n-32>>2],B=A[n-16>>2],k=A[n>>2],U=A[n-28>>2],G=A[n-12>>2],j=A[n+4>>2],V=A[n-24>>2],S=A[i+36>>2],H=A[n-8>>2],C=A[i+40>>2],W=A[n+8>>2],R=A[i+48>>2],E=A[i+8>>2],T=A[i>>2],P=A[i+4>>2],w=A[i+16>>2],I=A[i+32>>2],c[92+d>>2]=v=0,c[76+d>>2]=0,c[60+d>>2]=0,c[44+d>>2]=0,A[72+d>>2]=x(x(I*V)+x(S*H))+x(C*W),A[68+d>>2]=x(x(I*U)+x(S*G))+x(C*j),A[64+d>>2]=x(x(I*F)+x(S*B))+x(C*k),A[56+d>>2]=x(x(w*V)+x(y*H))+x(b*W),A[52+d>>2]=x(x(w*U)+x(y*G))+x(b*j),A[48+d>>2]=x(x(w*F)+x(y*B))+x(b*k),A[40+d>>2]=x(x(T*V)+x(P*H))+x(E*W),A[36+d>>2]=x(x(T*U)+x(P*G))+x(E*j),A[32+d>>2]=x(x(T*F)+x(P*B))+x(E*k),A[88+d>>2]=Y+x(x(x(I*D)+x(S*O))+x(C*L)),A[84+d>>2]=q+x(x(x(w*D)+x(y*O))+x(b*L)),A[80+d>>2]=R+x(x(x(T*D)+x(P*O))+x(E*L)),pi[c[c[m>>2]+8>>2]](m,32+d|0,112+d|0,96+d|0),n=c[r+4>>2],pi[c[c[n>>2]+8>>2]](n,c[r+12>>2],16+d|0,d),n=0,A[112+d>>2]>A[d>>2]||(n=0,A[96+d>>2]<A[16+d>>2]||(n=1)),A[120+d>>2]>A[8+d>>2]||A[104+d>>2]<A[24+d>>2]||(v=n),!(A[100+d>>2]<A[20+d>>2])&v&&!(A[116+d>>2]>A[4+d>>2])||(n=c[c[e+60>>2]+g>>2],pi[c[c[n>>2]>>2]](n),n=c[e+4>>2],pi[c[c[n>>2]+60>>2]](n,c[c[e+60>>2]+g>>2]),c[c[e+60>>2]+g>>2]=0)),o=o+80|0,g=g+4|0,t=t-1|0;);}N=160+d|0}function en(e,t,n){var i,o,a,r,s,l,_,u,h,f,p,d,m,v,y,b,S,C,E,T,P,w,I,R,D=0,O=0;N=R=N-160|0,O=c[e+4>>2],D=c[O+12>>2],d=A[D+52>>2],s=A[D+56>>2],i=A[D+24>>2],l=A[D+20>>2],o=A[D+40>>2],a=A[D+36>>2],_=c[c[O+4>>2]+32>>2],w=A[D+48>>2],u=A[D+8>>2],h=A[D>>2],f=A[D+4>>2],p=A[D+16>>2],r=A[D+32>>2],c[156+R>>2]=O=0,c[140+R>>2]=0,c[124+R>>2]=0,D=_+g(n,80)|0,m=A[D+8>>2],v=A[D+24>>2],y=A[D+40>>2],A[136+R>>2]=x(x(r*m)+x(a*v))+x(o*y),b=A[D+4>>2],S=A[D+20>>2],C=A[D+36>>2],A[132+R>>2]=x(x(r*b)+x(a*S))+x(o*C),A[120+R>>2]=x(x(p*m)+x(l*v))+x(i*y),A[116+R>>2]=x(x(p*b)+x(l*S))+x(i*C),E=s,s=A[D+48>>2],T=A[D+52>>2],P=A[D+56>>2],A[152+R>>2]=E+x(x(x(r*s)+x(a*T))+x(o*P)),A[148+R>>2]=d+x(x(x(p*s)+x(l*T))+x(i*P)),c[108+R>>2]=0,E=r,r=A[D>>2],d=a,a=A[D+16>>2],I=o,o=A[D+32>>2],A[128+R>>2]=x(x(E*r)+x(d*a))+x(I*o),A[112+R>>2]=x(x(p*r)+x(l*a))+x(i*o),A[96+R>>2]=x(x(h*r)+x(f*a))+x(u*o),A[104+R>>2]=x(x(h*m)+x(f*v))+x(u*y),A[100+R>>2]=x(x(h*b)+x(f*S))+x(u*C),A[144+R>>2]=w+x(x(x(h*s)+x(f*T))+x(u*P)),pi[c[c[t>>2]+8>>2]](t,96+R|0,80+R|0,R+64|0),i=A[c[e+20>>2]+32>>2],A[80+R>>2]=A[80+R>>2]-i,A[84+R>>2]=A[84+R>>2]-i,A[88+R>>2]=A[88+R>>2]-i,A[64+R>>2]=i+A[64+R>>2],A[68+R>>2]=i+A[68+R>>2],A[72+R>>2]=i+A[72+R>>2],D=c[e+8>>2],_=c[D+4>>2],pi[c[c[_>>2]+8>>2]](_,c[D+12>>2],48+R|0,32+R|0),D=0,A[80+R>>2]>A[32+R>>2]||(D=0,A[64+R>>2]<A[48+R>>2]||(D=1)),A[88+R>>2]>A[40+R>>2]||A[72+R>>2]<A[56+R>>2]||(O=D),A[84+R>>2]>A[36+R>>2]||1^O|A[68+R>>2]<A[52+R>>2]||(c[28+R>>2]=n,c[24+R>>2]=-1,c[12+R>>2]=t,t=c[e+4>>2],c[8+R>>2]=t,c[16+R>>2]=c[t+8>>2],i=A[c[e+20>>2]+32>>2],c[20+R>>2]=96+R,i>x(0)?(t=c[e+12>>2],t=0|pi[c[c[t>>2]+8>>2]](t,8+R|0,c[e+8>>2],0,2)):(t=c[(D=n<<2)+c[e+24>>2]>>2])||(t=c[e+12>>2],t=0|pi[c[c[t>>2]+8>>2]](t,8+R|0,c[e+8>>2],c[e+28>>2],1),c[D+c[e+24>>2]>>2]=t,t=c[D+c[e+24>>2]>>2]),D=c[e+20>>2],O=c[D+8>>2],c[O+8>>2]!=c[c[e+4>>2]+8>>2]?(O=c[D+12>>2],c[D+12>>2]=8+R,pi[c[c[D>>2]+12>>2]](D,-1,n)):(c[D+8>>2]=8+R,pi[c[c[D>>2]+8>>2]](D,-1,n)),pi[c[c[t>>2]+8>>2]](t,8+R|0,c[e+8>>2],c[e+16>>2],c[e+20>>2]),t=c[e+20>>2],c[(c[c[t+8>>2]+8>>2]==c[c[e+4>>2]+8>>2]?8:12)+t>>2]=O),N=160+R|0}function tn(e){var t,n,i,o,r=0,s=0,l=0,_=0,u=0;if(!((0|(t=c[e+12>>2]))<=(0|(n=c[e+28>>2])))){e:if(c[e+32>>2]>=(0|t))l=c[e+36>>2];else{if(t&&(c[5498]=c[5498]+1,(s=M(19+(t<<2)|0))&&(c[(l=s+19&-16)-4>>2]=s)),r=c[e+36>>2],1<=(0|n))for(s=l,u=r,_=n;c[s>>2]=c[u>>2],s=s+4|0,u=u+4|0,_=_-1|0;);else if(!r){c[e+36>>2]=l,c[e+32>>2]=t,a[e+40|0]=1;break e}p[e+40|0]&&(c[5499]=c[5499]+1,z(c[r-4>>2])),c[e+36>>2]=l,a[e+40|0]=1,c[e+32>>2]=t}if(B((n<<2)+l|0,0,t-n<<2),i=(c[e+28>>2]=t)<<2,(0|(r=c[e+48>>2]))<(0|t)){e:if(c[e+52>>2]>=(0|t))l=c[e+56>>2];else{if(l=0,t&&(c[5498]=c[5498]+1,(s=M(16+(3|i)|0))&&(c[(l=s+19&-16)-4>>2]=s)),o=c[e+56>>2],1<=(0|r))for(s=l,u=o,_=r;c[s>>2]=c[u>>2],s=s+4|0,u=u+4|0,_=_-1|0;);else if(!o){c[e+56>>2]=l,c[e+52>>2]=t,a[e+60|0]=1;break e}p[e+60|0]&&(c[5499]=c[5499]+1,z(c[o-4>>2])),c[e+56>>2]=l,a[e+60|0]=1,c[e+52>>2]=t}B((r<<2)+l|0,0,t-r<<2)}if(1<=(0|(c[e+48>>2]=t))&&(B(c[e+36>>2],255,i),B(c[e+56>>2],255,i)),!((0|n)<1))for(u=c[e+56>>2],s=c[e+16>>2],l=c[e+36>>2],_=0;r=c[s>>2]|c[s+4>>2]<<16,r=g((r=(r<<15^-1)+r|0)>>>10^r,9),r=l+((c[e+12>>2]-1&((r=((r^=r>>>6)<<11^-1)+r|0)>>>16^r))<<2)|0,c[u>>2]=c[r>>2],s=s+12|0,u=u+4|0,(0|n)!=(0|(_=(c[r>>2]=_)+1|0)););}}function nn(e){return c[16+(e|=0)>>2]}function on(e){var t,n,i,o=0,r=0,s=0;if((o=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[o-4>>2])),c[e+16>>2]=0,a[e+20|0]=1,c[(o=e+8|0)>>2]=0,c[o+4>>2]=0,(o=c[e+36>>2])&&p[e+40|0]&&(c[5499]=c[5499]+1,z(c[o-4>>2])),c[e+36>>2]=0,a[e+40|0]=1,c[(o=e+28|0)>>2]=0,c[o+4>>2]=0,(o=c[e+56>>2])&&p[e+60|0]&&(c[5499]=c[5499]+1,z(c[o-4>>2])),c[e+56>>2]=0,a[e+60|0]=1,c[(o=e+48|0)>>2]=0,c[o+4>>2]=0,c[e+12>>2]<=1){if(c[5498]=c[5498]+1,(o=M(43))&&(c[(s=o+19&-16)-4>>2]=o),1<=(0|(r=c[e+8>>2])))for(o=0;t=c[e+16>>2]+o|0,i=c[4+t>>2],c[(n=o+s|0)>>2]=c[t>>2],c[4+n>>2]=i,c[8+n>>2]=c[8+t>>2],o=o+12|0,r=r-1|0;);(o=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[o-4>>2])),c[e+16>>2]=s,a[e+20|0]=1,c[e+12>>2]=2}tn(e)}function an(e){var t,n,i=0,o=0,r=0;if(c[(e|=0)>>2]=14028,i=c[e+84>>2],1<=(0|(o=c[i+(r=8)>>2]))){for(;(t=c[c[i+16>>2]+r>>2])&&(pi[c[c[t>>2]>>2]](t),n=c[e+4>>2],pi[c[c[n>>2]+60>>2]](n,t)),r=r+12|0,o=o-1|0;);i=c[e+84>>2]}return on(i),i=c[e+84>>2],pi[c[c[i>>2]>>2]](i),(i=c[e+84>>2])&&(c[5499]=c[5499]+1,z(c[i-4>>2])),(i=c[e+100>>2])&&p[e+104|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+100>>2]=0,a[e+104|0]=1,c[(i=e+92|0)>>2]=0,c[i+4>>2]=0,Kt(e),0|e}function rn(){return x(x(1))}function sn(e,t){t|=0;var n,i=0,o=0,r=0,s=0;if((r=c[12+(e|=0)>>2])&&p[e+8|0]){if((0|(o=c[t+4>>2]))==c[t+8>>2]&&!((0|(n=o?o<<1:1))<=(0|o))){if(n&&(c[5498]=c[5498]+1,(i=M(19+(n<<2)|0))&&(c[(s=i+19&-16)-4>>2]=i)),1<=(0|o))for(r=0,i=o;c[r+s>>2]=c[c[t+12>>2]+r>>2],r=r+4|0,i=i-1|0;);(i=c[t+12>>2])&&p[t+16|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2]),o=c[t+4>>2]),c[t+12>>2]=s,a[t+16|0]=1,c[t+8>>2]=n,r=c[e+12>>2]}c[t+4>>2]=o+1,c[c[t+12>>2]+(o<<2)>>2]=r}}function cn(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var a,r,s,l,_=x(0),u=x(0),h=x(0),f=x(0),p=x(0),d=x(0),m=x(0),v=x(0),g=x(0),y=0,b=x(0),S=x(0),C=x(0),E=x(0),P=x(0),w=x(0),I=x(0),R=x(0),D=x(0),O=x(0),M=x(0),z=x(0),L=x(0),F=0;N=i=N-32|0,y=c[e+8>>2],w=A[y+80>>2],h=A[y+64>>2],p=x(w-h),C=A[y+100>>2],d=A[y+68>>2],_=x(C-d),I=A[y+84>>2],g=x(I-d),O=A[y+96>>2],f=x(O-h),v=x(x(p*_)-x(g*f)),P=A[y+104>>2],M=A[y+72>>2],u=x(P-M),L=A[y+88>>2],b=x(L-M),_=x(x(g*u)-x(b*_)),f=x(x(b*f)-x(p*u));e:if((u=x(x(v*v)+x(x(_*_)+x(f*f))))>=x(14210854715202004e-30)&&(F=c[e+4>>2],z=x(A[F+36>>2]*A[F+20>>2]),m=x(z+A[e+12>>2]),u=x(x(1)/x(T(u))),_=x(_*u),S=x(A[t+48>>2]-A[t+112>>2]),E=x(A[t+52>>2]-A[t+116>>2]),a=x(A[t+56>>2]-A[t+120>>2]),R=x(x(x(S*A[t+64>>2])+x(E*A[t+80>>2]))+x(a*A[t+96>>2])),s=x(R-h),f=x(f*u),D=x(x(x(S*A[t+68>>2])+x(E*A[t+84>>2]))+x(a*A[t+100>>2])),l=x(D-d),v=x(v*u),S=x(x(x(S*A[t+72>>2])+x(E*A[t+88>>2]))+x(a*A[t+104>>2])),E=x(S-M),(u=x(x(x(_*s)+x(f*l))+x(v*E)))<x(0)&&(v=x(-v),f=x(-f),u=x(-u),_=x(-_)),u<m)){p=x(x(E*x(x(p*f)-x(g*_)))+x(x(s*x(x(g*v)-x(b*f)))+x(l*x(x(b*_)-x(p*v))))),g=x(O-w),b=x(C-I),E=x(x(S-L)*x(x(g*f)-x(b*_))),a=x(b*v),b=x(P-L),g=x(E+x(x(x(R-w)*x(a-x(b*f)))+x(x(D-I)*x(x(b*_)-x(g*v)))));t:{n:{if(h=x(h-O),d=x(d-C),b=x(x(S-P)*x(x(h*f)-x(d*_))),E=x(d*v),d=x(M-P),!((h=x(b+x(x(x(R-O)*x(E-x(d*f)))+x(x(D-C)*x(x(d*_)-x(h*v))))))>x(0)&&p>x(0)&&g>x(0))){if(!(h<=x(0)))break n;if(!(p<=x(0)))break n;if(!(g<=x(0)))break n}P=x(S-x(u*v)),w=x(D-x(u*f)),I=x(R-x(u*_)),O=x(m*m);break t}if((0|pi[c[c[y>>2]+100>>2]](y))<1)break e;for(O=x(m*m),y=F=0;r=c[e+8>>2],pi[c[c[r>>2]+104>>2]](r,y,i+16|0,i),u=x(0),M=A[i+16>>2],m=x(R-M),C=x(A[i>>2]-M),b=A[i+20>>2],h=x(D-b),d=x(A[i+4>>2]-b),L=A[i+24>>2],p=x(S-L),g=x(A[i+8>>2]-L),(E=x(x(x(m*C)+x(h*d))+x(p*g)))>x(0)&&(E<(u=x(x(x(C*C)+x(d*d))+x(g*g)))?(u=x(E/u),p=x(p-x(g*u)),h=x(h-x(d*u)),m=x(m-x(C*u))):(p=x(p-g),h=x(h-d),m=x(m-C),u=x(1))),x(x(x(m*m)+x(h*h))+x(p*p))<O&&(I=x(M+x(C*u)),w=x(b+x(d*u)),F=1,P=x(L+x(g*u))),r=c[e+8>>2],y=y+1|0,(0|pi[c[c[r>>2]+100>>2]](r))>(0|y););if(!F)break e}u=x(R-I),m=x(D-w),h=x(S-P),(p=x(x(x(u*u)+x(m*m))+x(h*h)))<O&&(p>x(1.1920928955078125e-7)&&(_=x(T(p)),z=x(z-_),_=x(x(1)/_),v=x(h*_),f=x(m*_),_=x(u*_)),u=x(-z),o?(m=A[t+72>>2],h=A[t+64>>2],p=A[t+68>>2],R=A[t+88>>2],D=A[t+80>>2],S=A[t+84>>2],C=A[t+104>>2],d=A[t+96>>2],g=A[t+100>>2],c[i+28>>2]=0,O=x(x(x(_*d)+x(f*g))+x(v*C)),A[i+24>>2]=-O,M=x(x(x(_*D)+x(f*S))+x(v*R)),A[i+20>>2]=-M,_=x(x(x(h*_)+x(p*f))+x(m*v)),A[i+16>>2]=-_,c[i+12>>2]=0,A[i+8>>2]=x(x(x(x(I*d)+x(w*g))+x(P*C))+A[t+120>>2])-x(z*O),A[i+4>>2]=x(x(x(x(I*D)+x(w*S))+x(P*R))+A[t+116>>2])-x(z*M),A[i>>2]=x(x(x(x(I*h)+x(w*p))+x(P*m))+A[t+112>>2])-x(z*_)):(c[i+28>>2]=0,z=A[t+96>>2],m=A[t+100>>2],h=A[t+104>>2],A[i+24>>2]=x(x(_*z)+x(f*m))+x(v*h),p=A[t+80>>2],R=A[t+84>>2],D=A[t+88>>2],A[i+20>>2]=x(x(_*p)+x(f*R))+x(v*D),S=A[t+64>>2],d=x(S*_),_=A[t+68>>2],d=x(d+x(_*f)),f=A[t+72>>2],A[i+16>>2]=d+x(f*v),c[i+12>>2]=0,A[i+8>>2]=x(x(x(I*z)+x(w*m))+x(P*h))+A[t+120>>2],A[i+4>>2]=x(x(x(I*p)+x(w*R))+x(P*D))+A[t+116>>2],A[i>>2]=x(x(x(I*S)+x(w*_))+x(P*f))+A[t+112>>2]),pi[c[c[n>>2]+16>>2]](n,i+16|0,i,u))}N=i+32|0}function ln(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var a,r,s,l,_,u,h,f,p,d,m,v,b,S,C,E,P,w,I,R,D,O,M=x(0),z=x(0),L=x(0),F=0,B=x(0),U=x(0),j=x(0),V=x(0),H=x(0),W=x(0),q=x(0),Y=0,X=x(0),Q=x(0),Z=x(0),J=0,K=x(0),$=x(0),ee=x(0),te=x(0),ne=x(0),ie=x(0),oe=x(0),ae=x(0),re=x(0),se=x(0),ce=0,le=x(0),_e=x(0),ue=x(0),he=x(0),fe=x(0),pe=x(0),de=x(0),me=x(0),Ae=x(0),ve=x(0),ge=0,xe=0,ye=x(0),be=0,Se=x(0),Ce=0,Ee=0;A[48+(N=O=N-448|0)>>2]=A[t>>2],A[O>>2]=A[t+64>>2],i=c[t+8>>2],c[52+O>>2]=c[t+4>>2],c[56+O>>2]=i,o=c[4+(i=t+68|0)>>2],c[4+O>>2]=c[i>>2],c[8+O>>2]=o,i=c[t+20>>2],c[64+O>>2]=c[t+16>>2],c[68+O>>2]=i,o=c[4+(i=t+80|0)>>2],c[16+O>>2]=c[i>>2],c[20+O>>2]=o,A[72+O>>2]=A[t+24>>2],A[24+O>>2]=A[t+88>>2],A[80+O>>2]=A[t+32>>2],M=A[t+96>>2],o=c[4+(i=t+36|0)>>2],c[84+O>>2]=c[i>>2],c[88+O>>2]=o,A[40+O>>2]=A[t+104>>2],A[36+O>>2]=A[t+100>>2],A[32+O>>2]=M,i=c[e+4>>2],M=A[i+40>>2],z=A[i+44>>2],H=A[i+36>>2],X=x(pi[c[c[i>>2]+48>>2]](i)),Q=x(pi[c[c[i>>2]+48>>2]](i)),j=x(pi[c[c[i>>2]+48>>2]](i)),e=c[e+8>>2],L=A[e+44>>2],V=A[e+40>>2],U=A[e+36>>2],W=x(pi[c[c[e>>2]+48>>2]](e)),B=x(pi[c[c[e>>2]+48>>2]](e)),ee=x(pi[c[c[e>>2]+48>>2]](e)),z=x(z+j),j=x(x(z+z)*x(.5)),A[380+O>>2]=j,M=x(M+Q),Z=x(x(M+M)*x(.5)),A[376+O>>2]=Z,M=x(H+X),q=x(x(M+M)*x(.5)),A[372+O>>2]=q,M=x(V+B),V=x(x(M+M)*x(.5)),A[364+O>>2]=V,M=x(U+W),U=x(x(M+M)*x(.5)),A[360+O>>2]=U,M=x(L+ee),W=x(x(M+M)*x(.5)),A[368+O>>2]=W;e:if(H=x(A[(o=t+112|0)>>2]-A[t+48>>2]),Se=A[48+O>>2],X=x(A[t+116>>2]-A[t+52>>2]),M=A[64+O>>2],Q=x(A[t+120>>2]-A[t+56>>2]),z=A[80+O>>2],ee=x(x(x(H*Se)+x(X*M))+x(Q*z)),_e=A[O>>2],se=A[16+O>>2],te=A[32+O>>2],le=x(x(x(Se*_e)+x(M*se))+x(z*te)),a=x(y(le)),r=A[4+O>>2],he=A[20+O>>2],me=A[36+O>>2],fe=x(x(x(Se*r)+x(M*he))+x(z*me)),l=x(y(fe)),s=A[8+O>>2],ye=A[24+O>>2],f=A[40+O>>2],ue=x(x(x(Se*s)+x(M*ye))+x(z*f)),_=x(y(ue)),!((z=x(x(y(ee))-x(x(x(q+x(U*a))+x(V*l))+x(W*_))))>x(0)||(M=A[52+O>>2],B=A[68+O>>2],K=A[84+O>>2],L=x(x(x(H*M)+x(X*B))+x(Q*K)),ae=x(x(x(M*s)+x(B*ye))+x(K*f)),u=x(y(ae)),re=x(x(x(M*r)+x(B*he))+x(K*me)),pe=x(y(re)),K=x(x(x(M*_e)+x(B*se))+x(K*te)),ne=x(y(K)),M=x(-34028234663852886e22),e=i=0,z>x(-34028234663852886e22)&&(i=ee<x(0),F=48+O|0,M=z,e=1),(z=x(x(y(L))-x(x(x(Z+x(U*ne))+x(V*pe))+x(W*u))))>x(0)||($=A[56+O>>2],Ae=A[72+O>>2],de=A[88+O>>2],B=x(x(x(H*$)+x(X*Ae))+x(Q*de)),ie=x(x(x($*s)+x(Ae*ye))+x(de*f)),p=x(y(ie)),oe=x(x(x($*r)+x(Ae*he))+x(de*me)),d=x(y(oe)),$=x(x(x($*_e)+x(Ae*se))+x(de*te)),h=x(y($)),M<z&&(F=48+O|4,i=L<x(0),M=z,e=2),(z=x(x(y(B))-x(x(x(j+x(U*h))+x(V*d))+x(W*p))))>x(0)||(M<z&&(F=48+O|8,i=B<x(0),M=z,e=3),_e=x(x(x(H*_e)+x(X*se))+x(Q*te)),(z=x(x(y(_e))-x(U+x(x(j*h)+x(x(q*a)+x(Z*ne))))))>x(0)||(M<z&&(i=_e<x(0),F=O,M=z,e=4),_e=x(x(x(H*r)+x(X*he))+x(Q*me)),(z=x(x(y(_e))-x(V+x(x(j*d)+x(x(q*l)+x(Z*pe))))))>x(0)||(M<z&&(F=4|O,i=_e<x(0),M=z,e=5),H=x(x(x(H*s)+x(X*ye))+x(Q*f)),(z=x(x(y(H))-x(W+x(x(j*p)+x(x(q*_)+x(Z*u))))))>x(0)||(M<z&&(F=8|O,i=H<x(0),M=z,e=6),ve=x(x(B*K)-x(L*$)),l=x(l+x(9999999747378752e-21)),h=x(h+x(9999999747378752e-21)),m=x(ne+x(9999999747378752e-21)),_=x(_+x(9999999747378752e-21)),(z=x(x(y(ve))-x(x(W*l)+x(x(x(Z*h)+x(j*m))+x(V*_)))))>x(1.1920928955078125e-7)||(_e=x(d+x(9999999747378752e-21)),r=x(pe+x(9999999747378752e-21)),s=x(a+x(9999999747378752e-21)),Q=x(0),d=x(K*K),a=x(x($*$)+x(0)),(pe=x(T(x(d+a))))>x(1.1920928955078125e-7)?(X=x(0),z=x(z/pe),H=x(0),x(z*x(1.0499999523162842))>M&&(i=ve<x(0),X=x(K/pe),Q=x(x(0)/pe),F=0,e=7,M=z,H=x(x(-$)/pe))):(X=x(0),H=x(0)),ve=x(x(B*re)-x(L*oe)),(z=x(x(y(ve))-x(x(W*s)+x(x(x(Z*_e)+x(j*r))+x(U*_)))))>x(1.1920928955078125e-7)||(pe=x(p+x(9999999747378752e-21)),u=x(u+x(9999999747378752e-21)),p=x(re*re),S=x(x(oe*oe)+x(0)),(ne=x(T(x(p+S))))>x(1.1920928955078125e-7)&&(z=x(z/ne),x(z*x(1.0499999523162842))>M&&(i=ve<x(0),X=x(re/ne),H=x(x(-oe)/ne),Q=x(x(0)/ne),F=0,e=8,M=z)),ve=x(x(B*ae)-x(L*ie)),(z=x(x(y(ve))-x(x(V*s)+x(x(U*l)+x(x(Z*pe)+x(j*u))))))>x(1.1920928955078125e-7)||(C=x(ae*ae),E=x(x(ie*ie)+x(0)),(ne=x(T(x(C+E))))>x(1.1920928955078125e-7)&&(z=x(z/ne),x(z*x(1.0499999523162842))>M&&(i=ve<x(0),X=x(ae/ne),H=x(x(-ie)/ne),Q=x(x(0)/ne),F=0,e=9,M=z)),ve=x(x(ee*$)-x(B*le)),(z=x(x(y(ve))-x(x(W*r)+x(x(x(q*h)+x(j*s))+x(V*u)))))>x(1.1920928955078125e-7)||(P=x(le*le),(ne=x(T(x(P+a))))>x(1.1920928955078125e-7)&&(z=x(z/ne),x(z*x(1.0499999523162842))>M&&(i=ve<x(0),X=x(x(-le)/ne),H=x(x(0)/ne),Q=x($/ne),F=0,e=10,M=z)),ne=x(x(ee*oe)-x(B*fe)),(z=x(x(y(ne))-x(x(W*m)+x(x(x(q*_e)+x(j*l))+x(U*u)))))>x(1.1920928955078125e-7)||(a=x(fe*fe),($=x(T(x(a+S))))>x(1.1920928955078125e-7)&&(z=x(z/$),x(z*x(1.0499999523162842))>M&&(i=ne<x(0),X=x(x(-fe)/$),H=x(x(0)/$),Q=x(oe/$),F=0,e=11,M=z)),oe=x(x(ee*ie)-x(B*ue)),(z=x(x(y(oe))-x(x(V*m)+x(x(U*r)+x(x(q*pe)+x(j*_))))))>x(1.1920928955078125e-7)||($=x(ue*ue),(B=x(T(x($+E))))>x(1.1920928955078125e-7)&&(z=x(z/B),x(z*x(1.0499999523162842))>M&&(i=oe<x(0),X=x(x(-ue)/B),H=x(x(0)/B),Q=x(ie/B),F=0,e=12,M=z)),ie=x(x(L*le)-x(ee*K)),(z=x(x(y(ie))-x(x(W*_e)+x(x(x(q*m)+x(Z*s))+x(V*pe)))))>x(1.1920928955078125e-7)||((B=x(T(x(x(d+P)+x(0)))))>x(1.1920928955078125e-7)&&(z=x(z/B),x(z*x(1.0499999523162842))>M&&(i=ie<x(0),X=x(x(0)/B),H=x(le/B),Q=x(x(-K)/B),F=0,e=13,M=z)),le=x(x(L*fe)-x(ee*re)),(z=x(x(y(le))-x(x(W*h)+x(x(x(q*r)+x(Z*l))+x(U*pe)))))>x(1.1920928955078125e-7)||((B=x(T(x(x(p+a)+x(0)))))>x(1.1920928955078125e-7)&&(z=x(z/B),x(z*x(1.0499999523162842))>M&&(i=le<x(0),X=x(x(0)/B),H=x(fe/B),Q=x(x(-re)/B),F=0,e=14,M=z)),B=x(x(L*ue)-x(ee*ae)),(z=x(x(y(B))-x(x(V*h)+x(x(U*_e)+x(x(q*u)+x(Z*_))))))>x(1.1920928955078125e-7))))))))))))))))){t:{n:{if((L=x(T(x(x(C+$)+x(0)))))>x(1.1920928955078125e-7)&&(z=x(z/L),x(z*x(1.0499999523162842))>M))i=B<x(0),X=x(x(0)/L),H=x(ue/L),Q=x(x(-ae)/L),e=15;else{if(!e)break e;if(F)break n;z=M}B=x(x(x(Q*A[80+O>>2])+x(H*A[84+O>>2]))+x(X*de)),L=x(x(x(Se*Q)+x(H*A[52+O>>2]))+x(X*A[56+O>>2])),M=x(x(x(Q*A[64+O>>2])+x(H*A[68+O>>2]))+x(X*Ae));break t}B=A[F+32>>2],L=A[F>>2],z=M,M=A[F+16>>2]}if(H=i?x(-B):B,X=i?x(-M):M,Q=i?x(-L):L,7<=(0|e))$=A[t+48>>2],Se=A[t+52>>2],_e=A[t+56>>2],M=A[56+O>>2],B=A[80+O>>2],ee=A[48+O>>2],le=A[64+O>>2],fe=A[84+O>>2],ue=A[52+O>>2],ae=A[68+O>>2],c[(t=184+O|0)>>2]=c[o+8>>2],i=c[o+4>>2],c[176+O>>2]=c[o>>2],c[180+O>>2]=i,L=x(0),ie=A[O>>2],U=x(x(x(Q*ie)+x(X*se))+x(H*te))>x(0)?x(-U):U,oe=A[4+O>>2],V=x(x(x(Q*oe)+x(X*he))+x(H*me))>x(0)?x(-V):V,K=x(x(A[t>>2]+x(U*te))+x(V*me)),te=A[8+O>>2],W=x(x(x(Q*te)+x(X*ye))+x(H*f))>x(0)?x(-W):W,re=x(K+x(W*f)),K=x(x(x(A[180+O>>2]+x(U*se))+x(V*he))+x(W*ye)),V=x(x(x(A[176+O>>2]+x(U*ie))+x(V*oe))+x(W*te)),se=A[(e=(48+O|0)+((0|(t=e-7|0))/3<<24>>24<<2)|0)>>2],U=A[(t=((0|t)%3<<24>>24<<2)+O|0)>>2],te=A[e+16>>2],W=A[t+16>>2],he=A[e+32>>2],ie=A[t+32>>2],oe=x(x(x(se*U)+x(te*W))+x(he*ie)),(me=x(x(1)-x(oe*oe)))<=x(9999999747378752e-20)||(q=x(x(x(Q*ee)+x(X*le))+x(H*B))>x(0)?q:x(-q),Z=x(x(x(Q*ue)+x(X*ae))+x(H*fe))>x(0)?Z:x(-Z),j=x(x(x(Q*M)+x(X*Ae))+x(H*de))>x(0)?j:x(-j),M=x(V-x(x(x($+x(q*ee))+x(Z*ue))+x(j*M))),L=x(K-x(x(x(Se+x(q*le))+x(Z*ae))+x(j*Ae))),j=x(re-x(x(x(_e+x(q*B))+x(Z*fe))+x(j*de))),L=x(x(x(x(x(x(M*se)+x(L*te))+x(j*he))*oe)-x(x(x(M*U)+x(L*W))+x(j*ie)))*x(x(1)/me))),A[184+O>>2]=re+x(L*ie),A[180+O>>2]=K+x(L*W),A[176+O>>2]=V+x(L*U),c[284+O>>2]=0,A[280+O>>2]=-H,A[276+O>>2]=-X,A[272+O>>2]=-Q,pi[c[c[n>>2]+16>>2]](n,272+O|0,176+O|0,z);else{ce=t+48|0,t=(0|e)<4?(Y=48+O|0,xe=372+O|0,F=360+O|0,z=Q,Z=X,j=H,O):(j=x(-H),Z=x(-X),z=x(-Q),t=o,F=372+(Y=O)|0,xe=360+O|0,o=ce,ce=t,48+O|0),q=x(x(x(z*A[t>>2])+x(Z*A[t+16>>2]))+x(j*A[t+32>>2])),A[344+O>>2]=q,L=x(x(x(z*A[t+4>>2])+x(Z*A[t+20>>2]))+x(j*A[t+36>>2])),A[348+O>>2]=L,be=1,M=x(x(x(z*A[t+8>>2])+x(Z*A[t+24>>2]))+x(j*A[t+40>>2])),A[352+O>>2]=M,M=x(y(M)),L=x(y(L));t:{if((q=x(y(q)))<L){if(be=0,M<L){Ce=2,i=1;break t}}else{if(M<q){Ce=2,i=0;break t}be=0}Ce=1,i=2}M=A[(i<<=2)+F>>2],q=x(M*A[t+i>>2]),L=x(A[o>>2]-A[ce>>2]),q=A[i+(344+O|0)>>2]<x(0)?(le=x(x(A[o+8>>2]-A[ce+8>>2])+x(M*A[t+(32|i)>>2])),fe=x(L+q),x(x(A[o+4>>2]-A[ce+4>>2])+x(M*A[t+(16|i)>>2]))):(le=x(x(A[o+8>>2]-A[ce+8>>2])-x(M*A[t+(32|i)>>2])),fe=x(L-q),x(x(A[o+4>>2]-A[ce+4>>2])-x(M*A[t+(16|i)>>2]))),i=1,o=2;t:{n:{i:switch(0|(Ee=((0|e)<4?-1:-4)+e|0)){case 0:break t;case 1:break i;default:break n}i=0;break t}o=1,i=0}M=A[(o=(J=o<<2)+Y|0)>>2],L=A[o+16>>2],V=A[o+32>>2],Ae=x(x(x(fe*M)+x(q*L))+x(le*V)),W=A[(v=(o=be<<2)+t|0)>>2],B=A[16+v>>2],ee=A[32+v>>2],de=x(x(x(M*W)+x(L*B))+x(V*ee)),ae=A[o+F>>2],re=x(de*ae),te=x(Ae+re),K=A[(b=(o=Ce<<2)+t|0)>>2],se=A[16+b>>2],he=A[32+b>>2],ie=x(x(x(M*K)+x(L*se))+x(V*he)),me=A[o+F>>2],M=x(ie*me),ue=x(te-M),L=A[(i=(o=i<<2)+Y|0)>>2],V=A[i+16>>2],U=A[i+32>>2],oe=x(x(x(fe*L)+x(q*V))+x(le*U)),$=x(x(x(L*W)+x(V*B))+x(U*ee)),ye=x($*ae),B=x(oe+ye),se=x(x(x(L*K)+x(V*se))+x(U*he)),K=x(se*me),W=x(B-K),ae=x(te+M),B=x(B+K),L=x(Ae-re),ee=x(L+M),te=x(oe-ye),U=x(te+K),re=x(L-M),V=A[J+xe>>2],L=A[o+xe>>2],M=x(-L);t:{n:{i:{o:{a:{r:{s:{c:{l:{_:{u:{h:{f:{p:{K=x(te-K);d:{if(!(Y=L>x(-K))){if(J=1,i=o=272+O|(F=0),L>x(-U))break d;break h}if(A[276+O>>2]=re,A[272+O>>2]=K,i=272+O|8,J=2,L>x(-U))break p}if(A[(o=i)>>2]=M,A[o+4>>2]=re+x(x(M-K)*x(x(ee-re)/x(U-K))),i=o+8|0,Y){F=J,o=i;break h}A[o+12>>2]=ee,A[o+8>>2]=U,F=J+1|0;break f}A[284+O>>2]=ee,A[280+O>>2]=U,F=2}if(o=i+8|0,i=0,L>x(-B))break l;break u}if(i=1,!(L>x(-B)))break _}if(A[o>>2]=M,A[o+4>>2]=ee+x(x(M-U)*x(x(ae-ee)/x(B-U))),8&(F=F+1|0)){i=F;break t}if(o=o+8|0,i)break l}if(i=1,L>x(-W))break c;break s}if(A[o+4>>2]=ae,A[o>>2]=B,8&(F=F+1|0)){i=F;break t}if(o=o+8|0,i=0,L>x(-W))break r}if(A[o>>2]=M,A[o+4>>2]=ae+x(x(M-B)*x(x(ue-ae)/x(W-B))),8&(F=F+1|0)){i=F;break t}if(o=o+8|0,i)break r}if(Y)break a;if(((i=0)|F)<=0)break i;break o}if(A[o+4>>2]=ue,A[o>>2]=W,8&(F=F+1|0)){i=F;break t}if(Y)break o;o=o+8|0}if(A[o>>2]=M,A[o+4>>2]=ue+x(x(M-W)*x(x(re-ue)/x(K-W))),8&(i=F=F+1|0))break t}for(w=272+O|4,o=272+O|(i=0),Y=176+O|0;;){if((M=A[o>>2])<L){if(A[Y>>2]=M,A[Y+4>>2]=A[o+4>>2],8&(i=i+1|0))break i;Y=Y+8|0,M=A[o>>2]}if(J=o+8|0,(M<L|0)!=((W=A[((ge=1<(0|F))?J:272+O|0)>>2])<L|0)){if(B=A[(ge?o+12|0:w)>>2],U=A[o+4>>2],A[Y>>2]=L,A[Y+4>>2]=U+x(x(L-M)*x(x(B-U)/x(W-M))),8&(i=i+1|0))break i;Y=Y+8|0}if(F=F-1|0,o=J,!ge)break}if((0|i)<1)i=0;else{for(U=x(-V),I=176+O|4,F=272+O|(Y=0),o=176+O|0;;){if(M=A[(J=o+4|0)>>2],(L=x(-M))<V){if(A[F>>2]=A[o>>2],A[F+4>>2]=A[J>>2],8&(Y=Y+1|0)){i=Y;break n}M=A[J>>2],L=x(-M),F=F+8|0}if(J=o+8|0,W=A[((ge=1<(0|i))?o+12|0:I)>>2],(L<V|0)!=(V>x(-W)|0)){if(B=A[(ge?J:176+O|0)>>2],L=A[o>>2],A[F+4>>2]=U,A[F>>2]=L+x(x(U-M)*x(x(B-L)/x(W-M))),8&(Y=Y+1|0)){i=Y;break n}F=F+8|0}if(i=i-1|0,o=J,!ge)break}if(!(((i=0)|Y)<1))for(o=272+O|0,F=176+O|0;;){if((L=A[(J=o+4|0)>>2])<V){if(A[F>>2]=A[o>>2],A[F+4>>2]=A[J>>2],8&(i=i+1|0))break i;L=A[J>>2],F=F+8|0}if(J=o+8|0,(L<V|0)!=((U=A[((ge=1<(0|Y))?o+12|0:w)>>2])<V|0)){if(W=A[(ge?J:272+O|0)>>2],M=A[o>>2],A[F+4>>2]=V,A[F>>2]=M+x(x(V-L)*x(x(W-M)/x(U-L))),8&(i=i+1|0))break i;F=F+8|0}if(Y=Y-1|0,o=J,!ge)break}}}k(272+O|0,176+O|0,i<<3)}if((0|i)<1)break e}for(M=x(x(1)/x(x($*ie)-x(de*se))),V=x(M*x(-de)),U=x(ie*M),W=x(se*M),B=x($*M),ee=A[(Ee<<2)+xe>>2],ue=A[t+(32|(o=Ce<<2))>>2],ae=A[t+(32|(F=be<<2))>>2],re=A[t+(16|o)>>2],K=A[t+(16|F)>>2],de=A[b>>2],ie=A[v>>2],t=272+O|(F=0);o=(176+O|0)+g(F,12)|0,$=A[t>>2],L=x($-oe),se=A[t+4>>2],te=x(se-Ae),M=x(x(U*L)-x(W*te)),L=x(x(V*L)+x(B*te)),te=x(x(fe+x(M*ie))+x(L*de)),A[o>>2]=te,he=x(x(q+x(M*K))+x(L*re)),A[o+4>>2]=he,M=x(x(le+x(M*ae))+x(L*ue)),A[o+8>>2]=M,M=x(ee-x(x(x(z*te)+x(Z*he))+x(j*M))),(A[(144+O|0)+(F<<2)>>2]=M)>=x(0)&&(A[(o=F<<3)+(272+O|0)>>2]=$,A[(272+O|0)+(4|o)>>2]=se,F=F+1|0),t=t+8|0,i=i-1|0;);if(!((0|F)<1))if((0|F)<=(0|(xe=1<(0|(Y=(0|F)<4?F:4))?Y:1)))if(4<=(0|e))for(z=x(-H),j=x(-X),Z=x(-Q),o=144+O|0,t=176+O|0;M=A[o>>2],A[416+O>>2]=x(A[t>>2]+A[ce>>2])-x(Q*M),A[420+O>>2]=x(A[t+4>>2]+A[ce+4>>2])-x(X*M),A[424+O>>2]=x(A[t+8>>2]+A[ce+8>>2])-x(H*M),c[396+O>>2]=0,A[392+O>>2]=z,A[388+O>>2]=j,A[384+O>>2]=Z,pi[c[c[n>>2]+16>>2]](n,384+O|0,416+O|0,x(-M)),t=t+12|0,o=o+4|0,F=F-1|0;);else for(M=x(-H),z=x(-X),H=x(-Q),o=144+O|0,t=176+O|0;A[416+O>>2]=A[t>>2]+A[ce>>2],A[420+O>>2]=A[t+4>>2]+A[ce+4>>2],A[424+O>>2]=A[t+8>>2]+A[ce+8>>2],c[396+O>>2]=0,A[392+O>>2]=M,A[388+O>>2]=z,A[384+O>>2]=H,pi[c[c[n>>2]+16>>2]](n,384+O|0,416+O|0,x(-A[o>>2])),t=t+12|0,o=o+4|0,F=F-1|0;);else{for(t=144+O|4,J=0,L=A[144+O>>2],o=1;L=(i=L<(M=A[t>>2]))?M:L,J=i?o:J,t=t+4|0,(0|F)!=(0|(o=o+1|0)););t:{n:{i:{o:switch(0|(o=F-1|0)){case 1:break i;case 0:break o;default:break n}L=A[276+O>>2],M=A[272+O>>2];break t}L=x(x(A[276+O>>2]+A[284+O>>2])*x(.5)),M=x(x(A[272+O>>2]+A[280+O>>2])*x(.5));break t}for(M=x(0),t=272+O|0,B=x(0),z=x(0);U=M,M=A[t+12>>2],j=A[t+4>>2],L=x(M+j),Z=A[t>>2],q=A[(t=t+8|0)>>2],j=x(x(Z*M)-x(q*j)),M=x(U+x(L*j)),z=x(z+j),B=x(B+x(x(Z+q)*j)),o=o-1|0;);j=x(0xde0b6b000000000),U=z,Z=A[(t=(272+O|0)+(F<<3)|0)-8>>2],q=A[276+O>>2],V=A[272+O>>2],L=A[t-4>>2],z=x(x(Z*q)-x(V*L)),U=x(U+z),x(y(U))>x(1.1920928955078125e-7)&&(j=x(x(1)/x(U*x(3)))),L=x(x(M+x(x(q+L)*z))*j),M=x(x(B+x(x(Z+V)*z))*j)}for(o=416+O|0,t=272+O|0,i=F;R=o,D=G(x(A[t+4>>2]-L),x(A[t>>2]-M)),A[R>>2]=D,t=t+8|0,o=o+4|0,i=i-1|0;);for(t=384+O|0,o=F;c[t>>2]=1,t=t+4|0,o=o-1|0;);if(c[112+O>>2]=J,2<=((c[(t=J<<2)+(384+O|0)>>2]=0)|Y))for(j=x(x(6.2831854820251465)/x(0|xe)),Z=A[t+(416+O|0)>>2],Y=112+O|0,be=1;;){for(c[Y+4>>2]=J,q=(M=x(x(j*x(0|be))+Z))>x(3.1415927410125732)?x(M+x(-6.2831854820251465)):M,Y=Y+4|0,i=0,M=x(1e9),o=416+O|0,t=384+O|0,Ce=J;c[t>>2]&&(z=(z=x(y(x(A[o>>2]-q))))>x(3.1415927410125732)?x(x(6.2831854820251465)-z):z)<M&&(Ce=c[Y>>2]=i,M=z),t=t+4|0,o=o+4|0,(0|F)!=(0|(i=i+1|0)););if(((c[(384+O|0)+(Ce<<2)>>2]=0)|xe)==(0|(be=be+1|0)))break}if(z=x(-H),j=x(-X),Z=x(-Q),4<=(0|e))for(o=xe-1|0,e=112+O|4;;){if(t=(176+O|0)+g(J,12)|0,q=x(A[t>>2]+A[ce>>2]),A[416+O>>2]=q,L=x(A[t+4>>2]+A[ce+4>>2]),A[420+O>>2]=L,M=x(A[t+8>>2]+A[ce+8>>2]),A[424+O>>2]=M,c[396+O>>2]=0,A[392+O>>2]=z,A[388+O>>2]=j,A[384+O>>2]=Z,c[108+O>>2]=0,U=M,M=A[(144+O|0)+(J<<2)>>2],A[104+O>>2]=U-x(H*M),A[100+O>>2]=L-x(X*M),A[96+O>>2]=q-x(Q*M),pi[c[c[n>>2]+16>>2]](n,384+O|0,96+O|0,x(-M)),!o)break e;o=o-1|0,J=c[e>>2],e=e+4|0}for(o=xe-1|0,e=112+O|4;;){if(t=(176+O|0)+g(J,12)|0,A[416+O>>2]=A[t>>2]+A[ce>>2],A[420+O>>2]=A[t+4>>2]+A[ce+4>>2],A[424+O>>2]=A[t+8>>2]+A[ce+8>>2],c[396+O>>2]=0,A[392+O>>2]=z,A[388+O>>2]=j,A[384+O>>2]=Z,pi[c[c[n>>2]+16>>2]](n,384+O|0,416+O|0,x(-A[(144+O|0)+(J<<2)>>2])),!o)break e;o=o-1|0,J=c[e>>2],e=e+4|0}}}}N=448+O|0}function _n(e,t,n){var i,o,a,r,s,l,_,u,h,f,p,d,m,v,y,b,S,C,E,P=x(0),w=0,I=x(0),R=0,D=0,O=x(0),M=x(0),z=x(0),L=0,F=x(0),B=x(0),k=0,U=x(0),G=0,j=x(0),V=x(0),H=x(0),W=0,q=x(0),Y=x(0),X=x(0),Q=0,Z=0,J=x(0),K=0,$=x(0),ee=0,te=0;N=E=N-128|0,c[e+376>>2]=0,c[e+364>>2]=4,c[e+368>>2]=0,c[e+360>>2]=L=e+316|0,c[e+356>>2]=e+284,c[e+352>>2]=e+252,c[e+348>>2]=e+220,R=c[t+4>>2],c[e>>2]=c[t>>2],c[e+4>>2]=R,R=c[4+(w=t+16|0)>>2],c[(D=e+16|0)>>2]=c[w>>2],c[D+4>>2]=R,R=c[t+12>>2],c[e+8>>2]=c[t+8>>2],c[e+12>>2]=R,R=c[4+(w=t+32|0)>>2],c[(D=e+32|0)>>2]=c[w>>2],c[D+4>>2]=R,R=c[4+(w=t+24|0)>>2],c[(D=e+24|0)>>2]=c[w>>2],c[D+4>>2]=R,R=c[4+(w=t+48|0)>>2],c[(D=e+48|0)>>2]=c[w>>2],c[D+4>>2]=R,R=c[4+(w=t+40|0)>>2],c[(D=e+40|0)>>2]=c[w>>2],c[D+4>>2]=R,R=c[4+(w=t- -64|0)>>2],c[(D=e- -64|0)>>2]=c[w>>2],c[D+4>>2]=R,R=c[t+60>>2],c[e+56>>2]=c[t+56>>2],c[e+60>>2]=R,R=c[4+(w=t+80|0)>>2],c[(D=e+80|0)>>2]=c[w>>2],c[D+4>>2]=R,R=c[4+(w=t+72|0)>>2],c[(D=e+72|0)>>2]=c[w>>2],c[D+4>>2]=R,R=c[4+(w=t+96|0)>>2],c[(D=e+96|0)>>2]=c[w>>2],c[D+4>>2]=R,R=c[4+(w=t+88|0)>>2],c[(D=e+88|0)>>2]=c[w>>2],c[D+4>>2]=R,R=c[4+(w=t+104|0)>>2],c[(D=e+104|0)>>2]=c[w>>2],c[D+4>>2]=R,R=c[4+(w=t+112|0)>>2],c[(D=e+112|0)>>2]=c[w>>2],c[D+4>>2]=R,w=c[t+120>>2],t=c[t+124>>2],c[e+144>>2]=0,c[(R=e+180|0)>>2]=0,c[e+120>>2]=w,c[e+124>>2]=t,t=c[n+4>>2],c[e+128>>2]=c[n>>2],c[e+132>>2]=t,t=c[4+(n=n+8|0)>>2],c[(w=D=e+136|0)>>2]=c[n>>2],c[w+4>>2]=t,M=A[w>>2],P=A[(n=e+132|0)>>2],I=A[e+128>>2],c[e+364>>2]=3,c[(t=e+164|0)>>2]=0,c[R>>2]=1,c[(y=e+148|0)>>2]=L,O=x(-I),un(e,(R=(I=x(x(x(I*I)+x(P*P))+x(M*M)))>x(0))?O:x(1),x(R?-P:0),x(R?-M:0),L),c[t>>2]=1065353216,w=c[y>>2],t=c[w+20>>2],c[e+128>>2]=c[w+16>>2],c[e+132>>2]=t,t=c[4+(R=w+24|0)>>2],c[D>>2]=c[R>>2],c[D+4>>2]=t,k=c[R+4>>2],R=c[R>>2],c[(t=88+E|0)>>2]=R,c[t+4>>2]=k,c[(t=72+E|0)>>2]=R,c[t+4>>2]=k,c[(t=56+E|0)>>2]=R,c[t+4>>2]=k,L=c[w+20>>2],t=c[w+16>>2],c[80+E>>2]=t,c[84+E>>2]=L,c[64+E>>2]=t,c[68+E>>2]=L,c[48+E>>2]=t,c[52+E>>2]=L,c[40+E>>2]=R,c[44+E>>2]=k,c[32+E>>2]=t,c[36+E>>2]=L,R=e+128|0,V=A[n>>2],P=A[D>>2],W=c[e+368>>2],H=A[e+128>>2];e:{t:{n:{for(;;){if((M=x(T(x(x(x(H*H)+x(V*V))+x(P*P)))))<x(9999999747378752e-20)){c[e+376>>2]=1;break n}if(t=c[e+364>>2]-1|0,c[e+364>>2]=t,K=g(W,36),n=c[(Z=180+(r=K+e|0)|0)>>2],c[Z>>2]=n+1,t=c[348+((t<<2)+e|0)>>2],c[(n=(G=148+r|0)+(n<<2)|0)>>2]=t,c[n+16>>2]=0,un(e,x(-H),x(-V),x(-P),t),D=c[Z>>2],t=c[(G+(D<<2)|0)-4>>2],F=A[t+16>>2],P=x(F-A[32+E>>2]),O=x(P*P),B=A[t+20>>2],P=x(B-A[36+E>>2]),O=x(O+x(P*P)),z=A[t+24>>2],P=x(z-A[40+E>>2]),x(O+x(P*P))<x(9999999747378752e-20)||(P=x(F-A[48+E>>2]),O=x(P*P),P=x(B-A[52+E>>2]),O=x(O+x(P*P)),P=x(z-A[56+E>>2]),x(O+x(P*P))<x(9999999747378752e-20)||(P=x(F-A[64+E>>2]),O=x(P*P),P=x(B-A[68+E>>2]),O=x(O+x(P*P)),P=x(z-A[72+E>>2]),x(O+x(P*P))<x(9999999747378752e-20)||(P=x(F-A[80+E>>2]),O=x(P*P),P=x(B-A[84+E>>2]),O=x(O+x(P*P)),P=x(z-A[88+E>>2]),x(O+x(P*P))<x(9999999747378752e-20)))))break;if(t=c[4+(n=8+(L=t+16|0)|0)>>2],c[8+(w=k=(32+E|0)+((ee=ee+1&3)<<4)|0)>>2]=c[n>>2],c[w+12>>2]=t,t=c[L+4>>2],c[w>>2]=c[L>>2],c[w+4>>2]=t,P=x(x(x(x(A[e+128>>2]*F)+x(A[e+132>>2]*B))+x(A[e+136>>2]*z))/M),x(x(M-($=$<P?P:$))+x(M*x(-9999999747378752e-20)))<=x(0)){R=c[e+364>>2],c[e+364>>2]=R+1,W=c[e+368>>2],n=g(W,36)+e|0,w=c[(t=n+180|0)>>2]-1|0,c[t>>2]=w,c[348+((R<<2)+e|0)>>2]=c[148+(n+(w<<2)|0)>>2];break n}i:{o:{a:{r:{s:switch(D-2|(c[12+E>>2]=0)){case 0:if(n=c[152+r>>2],z=A[n+16>>2],t=c[G>>2],j=A[t+16>>2],X=x(z-j),M=A[n+20>>2],q=A[t+20>>2],F=x(M-q),P=A[n+24>>2],Y=A[t+24>>2],B=x(P-Y),!((I=x(x(x(X*X)+x(F*F))+x(B*B)))>x(0)))break o;if((U=x(x(-x(x(x(j*X)+x(q*F))+x(Y*B)))/I))>=x(1)){c[16+E>>2]=0,c[20+E>>2]=1065353216,c[12+E>>2]=2,I=x(x(x(z*z)+x(M*M))+x(P*P));break a}if(!(U<=x(0)))break r;c[16+E>>2]=1065353216,c[20+E>>2]=0,c[12+E>>2]=1,I=x(x(x(j*j)+x(q*q))+x(Y*Y));break a;case 1:I=hn(c[G>>2]+16|0,c[152+r>>2]+16|0,c[156+r>>2]+16|0,16+E|0,12+E|0);break a;case 2:break s;default:break a}if(Q=c[G>>2],b=A[Q+16>>2],i=c[160+r>>2],V=A[i+16>>2],h=x(b-V),G=c[152+r>>2],u=A[G+20>>2],H=A[i+20>>2],f=x(u-H),o=x(h*f),k=c[156+r>>2],U=A[k+24>>2],J=A[i+24>>2],s=x(U-J),S=A[Q+20>>2],p=x(S-H),C=A[G+24>>2],d=x(C-J),j=x(p*d),P=A[k+16>>2],l=x(P-V),O=A[Q+24>>2],m=x(O-J),M=A[G+16>>2],v=x(M-V),q=x(m*v),I=A[k+20>>2],_=x(I-H),Y=x(h*d),X=x(p*v),F=x(m*f),!((a=x(x(x(o*s)+x(x(x(x(j*l)+x(q*_))-x(Y*_))-x(X*s)))-x(F*l)))>x(0)|a<x(0)))break o;if(B=x(S-u),z=x(M-P),M=x(b-M),I=x(u-I),u=x(O*x(x(B*z)-x(M*I))),P=x(O-C),O=x(P*I),I=x(C-U),!(x(a*x(u+x(x(b*x(O-x(B*I)))+x(S*x(x(M*I)-x(P*z))))))<=x(0)))break o;if(D=Q+16|0,L=i+16|0,w=G+16|0,c[120+E>>2]=0,c[112+E>>2]=0,c[116+E>>2]=0,c[108+E>>2]=0,I=x(-1),x(a*x(x(x(x(j-F)*V)+x(H*x(q-Y)))+x(x(o-X)*J)))>x(0)&&(I=hn(D,w,L,112+E|0,108+E|0),c[24+E>>2]=0,t=c[116+E>>2],c[16+E>>2]=c[112+E>>2],c[20+E>>2]=t,A[28+E>>2]=A[120+E>>2],t=c[108+E>>2],c[12+E>>2]=2&t|t<<1&8|1&t,H=A[i+20>>2],V=A[i+16>>2],J=A[i+24>>2]),n=k+16|0,x(a*x(x(x(x(x(f*s)-x(d*_))*V)+x(H*x(x(d*l)-x(s*v))))+x(x(x(_*v)-x(f*l))*J)))>x(0)&&((P=hn(w,n,L,112+E|0,108+E|0))<I||I<x(0))&&(A[20+E>>2]=A[112+E>>2],c[16+E>>2]=0,t=c[120+E>>2],c[24+E>>2]=c[116+E>>2],c[28+E>>2]=t,c[12+E>>2]=c[108+E>>2]<<1&14,I=P),x(a*x(x(x(x(x(_*m)-x(s*p))*A[i+16>>2])+x(A[i+20>>2]*x(x(s*h)-x(m*l))))+x(x(x(p*l)-x(_*h))*A[i+24>>2])))>x(0)&&((P=hn(n,D,L,112+E|0,108+E|0))<I||I<x(0))&&(A[24+E>>2]=A[112+E>>2],c[20+E>>2]=0,A[16+E>>2]=A[116+E>>2],A[28+E>>2]=A[120+E>>2],t=c[108+E>>2],c[12+E>>2]=t>>>1&1|t<<1&8|t<<2&4,I=P),!(I<x(0)))break a;c[12+E>>2]=15,q=A[Q+20>>2],Y=A[k+24>>2],o=A[i+16>>2],X=A[Q+24>>2],P=A[k+16>>2],U=A[i+20>>2],F=A[Q+16>>2],j=A[i+24>>2],I=A[k+20>>2],M=x(x(x(x(x(x(x(x(q*Y)*o)+x(x(X*P)*U))-x(U*x(Y*F)))-x(x(q*P)*j))+x(j*x(F*I)))-x(o*x(X*I)))/a),A[20+E>>2]=M,B=A[G+24>>2],z=A[G+16>>2],O=x(x(x(x(o*x(I*B))+x(U*x(Y*z)))-x(U*x(B*P)))-x(j*x(I*z))),I=A[G+20>>2],P=x(x(x(O+x(j*x(P*I)))-x(o*x(Y*I)))/a),A[16+E>>2]=P,I=x(x(x(x(x(x(x(o*x(I*X))+x(U*x(B*F)))-x(U*x(X*z)))-x(j*x(I*F)))+x(j*x(z*q)))-x(o*x(B*q)))/a),A[24+E>>2]=I,A[28+E>>2]=x(1)-x(x(P+M)+I),I=x(0);break a}c[12+E>>2]=3,A[20+E>>2]=U,A[16+E>>2]=x(1)-U,I=x(Y+x(B*U)),O=x(I*I),I=x(j+x(X*U)),P=x(I*I),I=x(q+x(F*U)),I=x(O+x(P+x(I*I)))}if(I>=x(0)){if(k=g(W=1-W|0,36)+e|0,c[(L=k+180|0)>>2]=0,c[R>>2]=0,c[R+4>>2]=0,c[e+368>>2]=W,c[(t=R+8|0)>>2]=0,c[t+4>>2]=0,G=c[12+E>>2],!(D=c[Z>>2])){P=x(0),V=x(0),H=x(0);break i}for(t=K+y|0,P=x(0),Z=16+E|(Q=0),V=x(0),H=x(0),n=0;K=c[t>>2],G>>>n&1?(c[148+(w=k+(Q<<2)|0)>>2]=K,z=A[Z>>2],A[w+164>>2]=z,c[L>>2]=Q=Q+1|0,w=c[t>>2],M=A[w+24>>2],P=A[w+20>>2],H=x(x(z*A[w+16>>2])+A[e+128>>2]),A[e+128>>2]=H,V=x(x(z*P)+A[e+132>>2]),A[e+132>>2]=V,P=x(x(z*M)+A[e+136>>2]),A[e+136>>2]=P):(w=c[e+364>>2],c[e+364>>2]=w+1,c[348+((w<<2)+e|0)>>2]=K),t=t+4|0,Z=Z+4|0,(0|D)!=(0|(n=n+1|0)););break i}}R=c[e+364>>2],c[e+364>>2]=R+1,W=c[e+368>>2],n=g(W,36)+e|0,w=c[(t=n+180|0)>>2]-1|0,c[t>>2]=w,c[348+((R<<2)+e|0)>>2]=c[148+(n+(w<<2)|0)>>2];break n}if(15==(0|G)&&(c[e+376>>2]=1),127==(0|te)){c[e+376>>(t=2)]=2,c[e+372>>2]=148+(g(W,36)+e|0);break e}if(te=te+1|0,t=c[e+376>>2])break t}R=c[e+364>>2],c[e+364>>2]=R+1,W=c[e+368>>2],n=g(W,36)+e|0,w=c[(t=n+180|0)>>2]-1|0,c[t>>2]=w,c[348+((R<<2)+e|0)>>2]=c[148+(n+(w<<2)|0)>>2]}t=c[e+376>>2]}c[e+372>>2]=148+(g(W,36)+e|0);t:switch(0|t){case 0:I=A[e+128>>2],P=x(I*I),I=A[e+132>>2],P=x(P+x(I*I)),I=A[e+136>>2],A[e+144>>2]=T(x(P+x(I*I))),t=0;break e;case 1:break t;default:break e}c[e+144>>2]=0,t=1}return N=128+E|0,t}function un(e,t,n,i,o){var a,r,s,l,_,u,h,f,p,d,m,v,g,y,b,S,C,E,P=0,w=0;N=E=N-48|0,c[o+12>>2]=0,a=x(x(1)/x(T(x(x(x(t*t)+x(n*n))+x(i*i))))),A[o+8>>2]=a*i,A[o+4>>2]=a*n,A[o>>2]=a*t,w=c[e+120>>2],u=c[e+124>>2],P=c[e>>2]+(u>>1)|0,1&u&&(w=c[w+c[P>>2]>>2]),pi[0|w](E,P,o),i=A[o+8>>2],n=A[o>>2],w=c[e+124>>2],r=c[e+4>>2]+(w>>1)|0,t=x(-A[o+4>>2]),P=c[e+120>>2],P=1&w?c[c[r>>2]+P>>2]:P,c[28+E>>2]=0,A[24+E>>2]=x(x(A[e+44>>2]*t)-x(n*A[e+40>>2]))-x(i*A[e+48>>2]),A[20+E>>2]=x(x(A[e+28>>2]*t)-x(n*A[e+24>>2]))-x(i*A[e+32>>2]),A[16+E>>2]=x(x(A[e+12>>2]*t)-x(n*A[e+8>>2]))-x(i*A[e+16>>2]),pi[0|P](32+E|0,r,16+E|0),h=A[e+104>>2],f=A[e- -64>>2],p=A[e+60>>2],d=A[e+108>>2],m=A[e+80>>2],v=A[e+72>>2],g=A[e+76>>2],y=A[e+112>>2],b=A[e+96>>2],S=A[e+88>>2],C=A[e+92>>2],a=A[e+56>>2],s=A[40+E>>2],l=A[32+E>>2],_=A[36+E>>2],i=A[E>>2],n=A[4+E>>2],t=A[8+E>>2],c[o+28>>2]=0,A[o+24>>2]=t-x(y+x(x(x(l*S)+x(_*C))+x(s*b))),A[o+20>>2]=n-x(d+x(x(x(l*v)+x(_*g))+x(s*m))),A[o+16>>2]=i-x(h+x(x(x(l*a)+x(_*p))+x(s*f))),N=48+E|0}function hn(e,t,n,i,o){var a=x(0),r=x(0),s=x(0),l=x(0),_=x(0),u=x(0),h=x(0),f=x(0),p=x(0),d=x(0),m=x(0),v=x(0),g=x(0),y=x(0),b=0,S=x(0),C=x(0),E=x(0),P=x(0),w=x(0),I=(a=x(-1),h=A[e>>2],s=A[t>>2],r=x(h-s),u=A[t+4>>2],S=A[n+4>>2],x(u-S)),R=(v=A[e+4>>2],_=x(v-u),C=A[n>>2],x(s-C)),D=(f=x(x(r*I)-x(_*R)),l=A[t+8>>2],E=A[n+8>>2],x(l-E)),N=(g=A[e+8>>2],d=x(g-l),x(x(_*D)-x(d*I))),O=x(x(d*R)-x(r*D));return(w=x(x(f*f)+x(x(N*N)+x(O*O))))>x(0)&&(x(x(x(h*x(x(f*_)-x(O*d)))+x(v*x(x(N*d)-x(f*r))))+x(x(x(O*r)-x(N*_))*g))>x(0)?(_=x(-1),d=x(s-h),p=x(u-v),m=x(l-g),(a=x(x(x(d*d)+x(p*p))+x(m*m)))>x(0)?(r=x(1),(a=x(x(-x(x(x(h*d)+x(v*p))+x(g*m)))/a))>=x(1)?(_=x(x(x(s*s)+x(u*u))+x(l*l)),b=2):(r=x(0),b=1,a<=x(0)?(_=x(x(x(h*h)+x(v*v))+x(g*g)),y=x(1)):(r=x(g+x(m*a)),_=x(r*r),r=x(h+x(d*a)),s=x(r*r),r=x(v+x(p*a)),_=x(_+x(s+x(r*r))),y=x(x(1)-a),b=3,r=a))):r=x(0),c[i+8>>2]=0,A[i+4>>2]=r,A[i>>2]=y,c[o>>2]=b,l=A[t+8>>2],u=A[t+4>>2],s=A[t>>2]):(_=x(-1),r=x(0)),g=x(E-g),v=x(S-v),d=x(C-h),x(x(x(s*x(x(f*I)-x(O*D)))+x(u*x(x(N*D)-x(f*R))))+x(x(x(O*R)-x(N*I))*l))>x(0)?(S=A[n>>2],h=x(S-s),C=A[n+4>>2],p=x(C-u),E=A[n+8>>2],m=x(E-l),P=x(x(x(h*h)+x(p*p))+x(m*m)),a=x(-1),P>x(0)&&(r=x(1),a=(a=x(x(-x(x(x(s*h)+x(u*p))+x(l*m)))/P))>=x(1)?(y=x(0),b=2,x(x(x(S*S)+x(C*C))+x(E*E))):(r=x(0),b=1,a<=x(0)?(y=x(1),x(x(x(s*s)+x(u*u))+x(l*l))):(y=x(x(1)-a),b=3,a=x(l+x(m*(r=a))),l=x(a*a),a=x(s+x(h*r)),s=x(a*a),a=x(u+x(p*r)),x(l+x(s+x(a*a)))))),_<x(0)||a<_?(A[i+8>>2]=r,A[i+4>>2]=y,c[i>>2]=0,c[o>>2]=b<<1):a=_):a=_,u=A[n>>2],l=A[n+4>>2],h=A[n+8>>2],x(x(x(u*x(x(f*v)-x(O*g)))+x(l*x(x(N*g)-x(f*d))))+x(x(x(O*d)-x(N*v))*h))>x(0)&&(s=x(-1),C=A[e>>2],p=x(C-u),E=A[e+4>>2],m=x(E-l),P=A[e+8>>2],S=x(P-h),(_=x(x(x(p*p)+x(m*m))+x(S*S)))>x(0)&&(r=x(1),(_=x(x(-x(x(x(u*p)+x(l*m))+x(h*S)))/_))>=x(1)?(s=x(x(x(C*C)+x(E*E))+x(P*P)),y=x(0),b=2):(r=x(0),_<=x(0)?(s=x(x(x(u*u)+x(l*l))+x(h*h)),y=x(1),b=1):(r=x(h+x(S*_)),s=x(r*r),r=x(u+x(p*_)),u=x(r*r),r=x(l+x(m*_)),s=x(s+x(u+x(r*r))),y=x(x(1)-_),b=3,r=_))),(s<a||a<x(0))&&(A[i+8>>2]=y,c[i+4>>2]=0,A[i>>2]=r,c[o>>2]=b<<2&4|b>>>1,a=s)),a<x(0)&&(_=x(x(x(x(N*A[e>>2])+x(O*A[e+4>>2]))+x(f*A[e+8>>2]))/w),a=x(O*_),s=x(A[t+4>>2]-a),r=x(N*_),u=x(A[t>>2]-r),l=x(x(R*s)-x(I*u)),h=x(l*l),_=x(f*_),l=x(A[t+8>>2]-_),s=x(x(I*l)-x(s*D)),f=x(s*s),s=x(x(u*D)-x(R*l)),l=x(T(x(h+x(f+x(s*s))))),s=x(T(w)),u=x(l/s),A[i>>2]=u,c[o>>2]=7,l=x(A[n+4>>2]-a),y=x(A[n>>2]-r),f=x(x(d*l)-x(y*v)),h=x(f*f),f=x(A[n+8>>2]-_),l=x(x(v*f)-x(l*g)),p=x(l*l),l=x(x(y*g)-x(d*f)),s=x(x(T(x(h+x(p+x(l*l)))))/s),A[i+4>>2]=s,A[i+8>>2]=x(1)-x(u+s),a=x(x(_*_)+x(x(r*r)+x(a*a))))),a}function fn(e,t,n,i,o){var r,s,l,_,u,h,f,p,d,m,v,g,y=0,b=x(0),S=x(0),C=x(0),E=0;if(g=c[e+18504>>2]){if((y=c[g+48>>2])&&(c[y+44>>2]=c[g+44>>2]),(y=c[g+44>>2])&&(c[y+48>>2]=c[g+48>>2]),c[e+18504>>2]==(0|g)&&(c[e+18504>>2]=c[g+48>>2]),c[g+44>>2]=0,c[g+48>>2]=c[e+18496>>2],c[(y=e+18508|0)>>2]=c[y>>2]-1,(y=c[e+18496>>2])&&(c[y+44>>2]=g),c[e+18496>>2]=g,c[(y=e+18500|0)>>2]=c[y>>2]+1,a[g+55|0]=0,c[g+28>>2]=i,c[g+24>>2]=n,c[g+20>>2]=t,r=A[i+16>>2],s=A[(y=n+16|0)>>2],C=A[(l=t+16|0)>>2],u=A[(_=n+20|0)>>2],h=A[i+24>>2],f=A[(p=n+24|0)>>2],b=A[(d=t+24|0)>>2],S=A[(m=t+20|0)>>2],v=A[i+20>>2],c[g+12>>2]=0,u=x(u-S),h=x(h-b),f=x(f-b),S=x(v-S),b=x(x(u*h)-x(f*S)),A[g>>2]=b,r=x(r-C),s=x(s-C),C=x(x(f*r)-x(s*h)),A[g+4>>2]=C,S=x(x(s*S)-x(u*r)),A[g+8>>2]=S,E=2,(r=x(T(x(x(x(b*b)+x(C*C))+x(S*S)))))>x(9999999747378752e-20)){if(s=A[y>>2],pn(b,C,S,A[l>>2],A[m>>2],A[d>>2],s,A[_>>2],A[p>>2],y=g+16|0)||(b=A[n+16>>2],S=A[n+20>>2],C=A[n+24>>2],pn(A[g>>2],A[(E=g+4|0)>>2],A[(l=g+8|0)>>2],b,S,C,A[(n=i+16|0)>>2],A[(_=i+20|0)>>2],A[(i=i+24|0)>>2],y)||pn(A[g>>2],A[E>>2],A[l>>2],A[n>>2],A[_>>2],A[i>>2],A[t+16>>2],A[t+20>>2],A[t+24>>2],y)||(A[g+16>>2]=x(x(x(A[t+16>>2]*A[g>>2])+x(A[t+20>>2]*A[g+4>>2]))+x(A[t+24>>2]*A[g+8>>2]))/r)),b=x(x(1)/r),A[g>>2]=b*A[g>>2],A[(t=g+4|0)>>2]=b*A[t>>2],A[(t=g+8|0)>>2]=b*A[t>>2],o)return g;if(E=3,A[y>>2]>=x(-9999999747378752e-21))return g}return c[e>>2]=E,(t=c[g+48>>2])&&(c[t+44>>2]=c[g+44>>2]),(t=c[g+44>>2])&&(c[t+48>>2]=c[g+48>>2]),c[e+18496>>2]==(0|g)&&(c[e+18496>>2]=c[g+48>>2]),c[g+44>>2]=0,c[g+48>>2]=c[e+18504>>2],c[e+18500>>2]=c[e+18500>>2]-1,(t=c[e+18504>>2])&&(c[t+44>>2]=g),c[e+18504>>2]=g,c[e+18508>>2]=c[e+18508>>2]+1,0}return c[e>>2]=5,0}function pn(e,t,n,i,o,a,r,s,c,l){var _,u=x(r-i),h=x(s-o),f=x(c-a);return(_=x(x(x(x(u*t)-x(h*e))*a)+x(x(x(x(h*n)-x(f*t))*i)+x(x(x(f*e)-x(u*n))*o)))<x(0))&&(e=x(x(x(i*i)+x(o*o))+x(a*a)),x(x(x(u*i)+x(h*o))+x(f*a))>x(0)||(e=x(x(x(r*r)+x(s*s))+x(c*c)),x(x(x(u*r)+x(h*s))+x(f*c))<x(0)||(e=x(x(x(r*i)+x(s*o))+x(c*a)),e=(e=x(x(x(x(x(x(r*r)+x(s*s))+x(c*c))*x(x(x(i*i)+x(o*o))+x(a*a)))-x(e*e))/x(x(x(u*u)+x(h*h))+x(f*f))))>x(0)?e:x(0))),A[l>>2]=T(e)),_}function dn(){p[23440]||(c[5778]=1062847606,c[5779]=0,c[5776]=1042701022,c[5777]=1056964440,c[5774]=1062847606,c[5775]=0,c[5772]=-1093024784,c[5773]=1050556081,c[5770]=1062847606,c[5771]=0,c[5768]=-1093024784,c[5769]=-1096927567,c[5766]=1062847606,c[5767]=0,c[5764]=1042701022,c[5765]=-1090519208,c[5762]=1062847572,c[5763]=0,c[5760]=1057396286,c[5761]=0,c[5758]=1057396386,c[5759]=0,c[5756]=1060121912,c[5757]=1056964507,c[5754]=1057396420,c[5755]=0,c[5752]=-1098475836,c[5753]=1062148969,c[5750]=1057396386,c[5751]=0,c[5748]=-1084636143,c[5749]=0,c[5746]=1057396420,c[5747]=0,c[5744]=-1098475836,c[5745]=-1085334679,c[5742]=1057396386,c[5743]=0,c[5740]=1060121912,c[5741]=-1090519141,c[5738]=-2147483648,c[5739]=0,c[5736]=1058437413,c[5737]=1062149053,c[5734]=-2147483648,c[5735]=0,c[5732]=-2147483648,c[5733]=1065353216,c[5730]=-2147483648,c[5731]=0,c[5728]=-1089046235,c[5729]=1062149053,c[5726]=-2147483648,c[5727]=0,c[5724]=-1082951543,c[5725]=1050556148,c[5722]=-2147483648,c[5723]=0,c[5720]=-1082951543,c[5721]=-1096927500,c[5718]=0,c[5719]=0,c[5716]=-1089046235,c[5717]=-1085334595,c[5714]=0,c[5715]=0,c[5712]=0,c[5713]=-1082130432,c[5710]=0,c[5711]=0,c[5708]=1058437413,c[5709]=-1085334595,c[5706]=0,c[5707]=0,c[5704]=1064532105,c[5705]=-1096927500,c[5702]=0,c[5703]=0,c[5700]=1064532105,c[5701]=1050556148,c[5698]=-1090087228,c[5699]=0,c[5696]=1049007812,c[5697]=1062148969,c[5694]=-1090087262,c[5695]=0,c[5692]=-1087361736,c[5693]=1056964507,c[5690]=-1084636042,c[5691]=0,c[5688]=-1104782626,c[5689]=1056964440,c[5686]=-1090087262,c[5687]=0,c[5684]=-1087361736,c[5685]=-1090519141,c[5682]=-1084636076,c[5683]=0,c[5680]=-1090087362,c[5681]=-2147483648,c[5678]=-1090087262,c[5679]=0,c[5676]=1062847505,c[5677]=-2147483648,c[5674]=-1084636042,c[5675]=0,c[5672]=1054458864,c[5673]=1050556081,c[5670]=-1090087228,c[5671]=0,c[5668]=1049007812,c[5669]=-1085334679,c[5666]=-1084636042,c[5667]=0,c[5664]=-1104782626,c[5665]=-1090519208,c[5662]=-1084636042,c[5663]=0,c[5660]=1054458864,c[5661]=-1096927567,c[5658]=1065353216,c[5659]=0,c[5656]=-2147483648,c[5657]=0,c[5654]=1055193471,c[5655]=0,c[5652]=1063581978,c[5653]=0,c[5650]=1055193572,c[5651]=0,c[5648]=1049461434,c[5649]=1062847522,c[5646]=1055193572,c[5647]=0,c[5644]=-1086767520,c[5645]=1057396202,c[5642]=1055193572,c[5643]=0,c[5640]=-1086767520,c[5641]=-1090087446,c[5638]=1055193605,c[5639]=0,c[5636]=1049461434,c[5637]=-1084636126,c[5634]=-1092290076,c[5635]=0,c[5632]=1060716128,c[5633]=1057396202,c[5630]=-1092290043,c[5631]=0,c[5628]=-1098022214,c[5629]=1062847522,c[5626]=-1092290177,c[5627]=0,c[5624]=-1083901670,c[5625]=-2147483648,c[5622]=-1092290076,c[5623]=0,c[5620]=-1098022214,c[5621]=-1084636126,c[5618]=-1092290076,c[5619]=0,c[5616]=1060716128,c[5617]=-1090087446,c[5614]=-1082130432,c[5615]=0,c[5612]=0,c[5613]=-2147483648,a[23440]=1)}function mn(e){var t,n=0,i=0,o=0,r=0,s=0,l=0;if(c[6041]=15080,r=c[5498],n=c[e+20>>2],(s=M(23))&&(c[(o=s+19&-16)-4>>2]=s),c[6047]=o,c[o>>2]=n?14688:15012,c[5498]=r+2,(n=M(39))&&(c[(i=n+19&-16)-4>>2]=n,o=c[6047]),c[i+12>>2]=0,c[i+16>>2]=3,c[i>>2]=12568,a[i+4|(s=0)]=0,c[i+8>>2]=o,c[6048]=i,i=0,(n=M(27))&&(c[(i=n+19&-16)-4>>2]=n),c[i>>2]=15112,a[i+4|0]=0,c[6049]=i,(n=M(27))&&(c[(s=n+19&-16)-4>>2]=n),c[s>>2]=15132,a[s+4|(i=0)]=0,c[6050]=s,c[5498]=r+5,o=0,(n=M(27))&&(c[(o=n+19&-16)-4>>2]=n),c[o>>2]=15152,a[o+4|0]=0,c[6051]=o,(n=M(27))&&(c[(i=n+19&-16)-4>>2]=n),c[i>>2]=15172,a[i+4|(o=0)]=0,c[6052]=i,i=0,(n=M(27))&&(c[(i=n+19&-16)-4>>2]=n),c[i>>2]=15192,a[i+4|0]=0,c[6053]=i,c[5498]=r+8,(n=M(27))&&(c[(o=n+19&-16)-4>>2]=n),c[o>>2]=15212,a[o+4|(i=0)]=0,c[6054]=o,o=0,(n=M(27))&&(c[(o=n+19&-16)-4>>2]=n),c[o>>2]=15232,a[o+4|0]=0,c[6055]=o,(n=M(27))&&(c[(i=n+19&-16)-4>>2]=n),c[i>>2]=15252,a[i+4|(o=0)]=0,c[6059]=i,c[5498]=r+11,i=0,(n=M(27))&&(c[(i=n+19&-16)-4>>2]=n),c[6060]=i,c[i>>2]=15252,a[i+4|0]=1,(n=M(27))&&(c[(o=n+19&-16)-4>>2]=n),c[o>>2]=15272,a[o+4|(i=0)]=0,c[6058]=o,o=0,(n=M(35))&&(c[(o=n+19&-16)-4>>2]=n),c[o+8>>2]=1,c[o+12>>2]=0,c[o>>2]=15292,a[o+4|0]=0,c[6062]=o,c[5498]=l=r+14|0,(n=M(35))&&(c[(i=n+19&-16)-4>>2]=n),c[i+8>>2]=1,c[i+12>>2]=0,c[i>>2]=15292,c[6061]=i,a[i+4|0]=1,t=c[e+16>>2],n=c[e>>2])c[6043]=n,a[24176]=0;else{if(a[24176]=1,i=0,c[5498]=r+15,r=0,(n=M(43))&&(c[(r=n+19&-16)-4>>2]=n),c[r>>2]=868,c[r+20>>2]=0,s=c[e+8>>2],c[r+4>>2]=s,l=c[5498]+1|0,c[5498]=l,(n=M(g(s,868)+19|0))&&(c[(i=n+19&-16)-4>>2]=n),c[r+12>>2]=i,c[r+16>>2]=i,o=(c[r+8>>2]=s)-1|0)for(s=c[r>>2];i=c[i>>2]=n=i+s|0,o=o-1|0;);else n=i;c[n>>2]=0,c[6043]=r}if(n=c[e+4>>2])return c[6045]=n,void(a[24184]=0);if(s=116<(0|(n=80<(0|t)?t:80))?n+16&-16:128,a[24184]=1,i=0,c[5498]=l+1,r=0,(n=M(43))&&(c[(r=n+19&-16)-4>>2]=n),c[r>>2]=s,c[r+20>>2]=0,n=c[e+12>>2],c[r+4>>2]=n,c[5498]=c[5498]+1,(e=M(16+(3|g(n,s))|0))&&(c[(i=e+19&-16)-4>>2]=e),c[r+12>>2]=i,c[r+16>>2]=i,o=(c[r+8>>2]=n)-1|0)for(e=c[r>>2];i=c[i>>2]=n=e+i|0,o=o-1|0;);else n=i;c[n>>2]=0,c[6045]=r}function An(e){var t=0,n=0;return c[(e|=0)>>2]=15080,p[e+20|0]&&(t=c[e+16>>2],(n=c[t+16>>2])&&(c[5499]=c[5499]+1,z(c[n-4>>2]),t=c[e+16>>2]),t&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),p[e+12|0]&&(t=c[e+8>>2],(n=c[t+16>>2])&&(c[5499]=c[5499]+1,z(c[n-4>>2]),t=c[e+8>>2]),t&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),t=c[e+28>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+28>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+32>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+32>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+36>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+36>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+40>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+40>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+44>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+44>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+48>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+48>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+52>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+52>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+56>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+56>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+72>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+72>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+76>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+76>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+68>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+68>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+84>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+84>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+80>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+80>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),t=c[e+24>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+24>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2])),0|e}function vn(e){return c[72+(e|=0)>>2]}function gn(e){var t,n,i,o,r=0,s=0,l=0,_=0,u=0;if(!((0|(t=c[e+12>>2]))<=(0|(n=c[e+32>>2])))){e:if(c[e+36>>2]>=(0|t))l=c[e+40>>2];else{if(t&&(c[5498]=c[5498]+1,(s=M(19+(t<<2)|0))&&(c[(l=s+19&-16)-4>>2]=s)),r=c[e+40>>2],1<=(0|n))for(s=l,u=r,_=n;c[s>>2]=c[u>>2],s=s+4|0,u=u+4|0,_=_-1|0;);else if(!r){c[e+40>>2]=l,c[e+36>>2]=t,a[e+44|0]=1;break e}p[e+44|0]&&(c[5499]=c[5499]+1,z(c[r-4>>2])),c[e+40>>2]=l,a[e+44|0]=1,c[e+36>>2]=t}if(B((n<<2)+l|0,0,t-n<<2),i=(c[e+32>>2]=t)<<2,(0|(r=c[e+52>>2]))<(0|t)){e:if(c[e+56>>2]>=(0|t))l=c[e+60>>2];else{if(l=0,t&&(c[5498]=c[5498]+1,(s=M(16+(3|i)|0))&&(c[(l=s+19&-16)-4>>2]=s)),o=c[e+60>>2],1<=(0|r))for(s=l,u=o,_=r;c[s>>2]=c[u>>2],s=s+4|0,u=u+4|0,_=_-1|0;);else if(!o){c[e+60>>2]=l,c[e+56>>2]=t,a[e- -64|0]=1;break e}p[e- -64|0]&&(c[5499]=c[5499]+1,z(c[o-4>>2])),c[e+60>>2]=l,a[e+64|0]=1,c[e+56>>2]=t}B((r<<2)+l|0,0,t-r<<2)}if(1<=(0|(c[e+52>>2]=t))&&(B(c[e+40>>2],255,i),B(c[e+60>>2],255,i)),!((0|n)<1))for(u=c[e+60>>2],s=c[e+16>>2],l=c[e+40>>2],_=0;r=c[c[s>>2]+12>>2]|c[c[s+4>>2]+12>>2]<<16,r=g((r=(r<<15^-1)+r|0)>>>10^r,9),r=l+((c[e+12>>2]-1&((r=((r^=r>>>6)<<11^-1)+r|0)>>>16^r))<<2)|0,c[u>>2]=c[r>>2],s=s+16|0,u=u+4|0,(0|n)!=(0|(_=(c[r>>2]=_)+1|0)););}}function xn(e,t,n){for(var i,o,a,r,s,l=0,_=0,u=0,h=0,f=0,p=0,d=0,A=0,v=0,g=0,x=0;;){for(g=c[e+12>>2],a=c[8+(f=g+(((r=t)+n|0)/2<<4)|0)>>2],i=c[f+4>>2],o=c[f>>2],p=n;;){e:{if(!o)for(u=(t<<4)+g|0;;){_=h=-1,(d=c[u>>2])&&(_=c[d+12>>2]),(f=c[u+4>>2])&&(h=c[f+12>>2]),l=i?c[i+12>>2]:-1;t:if(!(-1<(0|_))){if(!((0|l)<(0|h)||d)){if((0|i)!=(0|f))break e;if(m[u+8>>2]>a>>>0)break t;f=i;break e}if(d)break e;if((0|h)<=(0|l))break e}u=u+16|0,t=t+1|0}for(u=(t<<4)+g|0,A=c[o+12>>2];;){_=h=-1,(d=c[u>>2])&&(_=c[d+12>>2]),(f=c[u+4>>2])&&(h=c[f+12>>2]),l=i?c[i+12>>2]:-1;t:if(!((0|A)<(0|_))){if(!((0|l)<(0|h))&&(0|o)==(0|d)){if((0|i)!=(0|f))break e;if(m[u+8>>2]>a>>>0)break t;f=i;break e}if((0|o)!=(0|d))break e;if((0|h)<=(0|l))break e}u=u+16|0,t=t+1|0}}e:{if(!o)for(_=(p<<4)+g|0;;){h=-1,(v=c[_>>2])&&(h=c[v+12>>2]),A=i?c[i+12>>2]:-1,l=-1,(x=c[_+4>>2])&&(l=c[x+12>>2]);t:if(!((0|h)<-1)){if(!((0|l)<(0|A)||v)){if((0|i)!=(0|x))break e;if(m[_+8>>2]<a>>>0)break t;break e}if(v)break e;if((0|A)<=(0|l))break e}_=_-16|0,p=p-1|0}for(_=(p<<4)+g|0,s=c[o+12>>2];;){if(h=-1,(v=c[_>>2])&&(h=c[v+12>>2]),A=i?c[i+12>>2]:-1,l=-1,(x=c[_+4>>2])&&(l=c[x+12>>2]),!((0|h)<(0|s)))if((0|l)<(0|A)||(0|o)!=(0|v)){if((0|o)!=(0|v))break e;if((0|A)<=(0|l))break e}else{if((0|i)!=(0|x))break e;if(m[_+8>>2]>=a>>>0)break e}_=_-16|0,p=p-1|0}}if((0|t)<=(0|p)&&(h=c[8+(l=(t<<4)+g|0)>>2],A=c[l+12>>2],l=c[_+4>>2],c[u>>2]=c[_>>2],c[u+4>>2]=l,l=u+8|0,u=c[4+(_=_+8|0)>>2],c[l>>2]=c[_>>2],c[l+4>>2]=u,l=c[e+12>>2]+(p<<4)|0,c[l+4>>2]=f,c[l+8>>2]=h,c[l+12>>2]=A,c[l>>2]=d,p=p-1|0,t=t+1|0),!((0|t)<=(0|p)))break;g=c[e+12>>2]}if((0|r)<(0|p)&&xn(e,r,p),!((0|t)<(0|n)))break}}function yn(e){var t,n,i=0,o=0,r=0;if(c[(e|=0)>>2]=16780,p[e+152|0]&&(i=c[e+96>>2],pi[c[c[i>>2]>>2]](i),(i=c[e+96>>2])&&(c[5499]=c[5499]+1,z(c[i-4>>2]))),1<=(0|(r=c[e+160>>2])))for(i=8;o=c[e+168>>2]+i|0,(n=c[(t=o+4|0)>>2])&&p[o+8|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[t>>2]=0,a[o+8|0]=1,c[(o=o-4|0)>>2]=0,i=i+20|(c[o+4>>2]=0),r=r-1|0;);return(i=c[e+168>>2])&&p[e+172|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+168>>2]=0,c[e+160>>2]=0,c[e+164>>2]=0,a[e+172|0]=1,st(e+44|0),st(e+4|0),0|e}function bn(e,t,n){var i,o,a,r,s,l,_,u=0,h=0,f=0,p=0,d=0,m=0,v=0,g=0;if(N=_=N-256|0,e){for(i=A[t+24>>2],o=A[t+20>>2],a=A[t+16>>2],r=A[t+8>>2],s=A[t+4>>2],l=A[t>>2],c[_>>2]=e,f=64,e=_,t=1;;){e:{t:{n:{if(d=c[(g=(h=t-1|0)<<2)+e>>2],A[d>>2]<=a&&A[d+16>>2]>=l&&A[d+4>>2]<=o&&A[d+20>>2]>=s&&A[d+8>>2]<=i&&A[d+24>>2]>=r){if(c[d+40>>2]){if((0|h)!=(0|f))break n;if((0|(u=f?f<<1:1))<(0|t))break n;if(h=0,u&&(c[5498]=c[5498]+1,(p=M(19+(u<<2)|0))&&(c[(h=p+19&-16)-4>>2]=p)),2<=(0|t))for(m=h,p=e;c[m>>2]=c[p>>2],m=m+4|0,p=p+4|0,f=f-1|0;);if(!v){v=1;break t}c[5499]=c[5499]+(v=1),z(c[e-4>>2]);break t}pi[c[c[n>>2]+12>>2]](n,d)}t=h;break e}u=f,h=e}if(c[h+g>>2]=c[d+36>>2],(0|t)==(0|u))if((0|(f=t<<1))<=(0|t))f=t,e=h;else{if(e=0,c[5498]=c[5498]+1,(u=M(19+(t<<3)|0))&&(c[(e=u+19&-16)-4>>2]=u),1<=(0|t))for(m=e,u=h,p=t;c[m>>2]=c[u>>2],m=m+4|0,u=u+4|0,p=p-1|0;);v?(c[5499]=c[5499]+(v=1),z(c[h-4>>2])):v=1}else f=u,e=h;c[(t<<2)+e>>2]=c[d+40>>2],t=t+1|0}if(!(0<(0|t)))break}v&&e&&(c[5499]=c[5499]+1,z(c[e-4>>2]))}N=256+_|0}function Sn(e,t,n,i){var o,r,s,l,_=0,u=0,h=0,f=0,d=0,m=0;if(t&&n){if(!(127<(0|(f=c[e+24>>2]))||127<c[e+28>>2])){if(c[5498]=c[5498]+1,(_=M(1043))&&(c[(u=_+19&-16)-4>>2]=_),1<=(0|f))for(;d=c[e+32>>2]+h|0,m=c[d+4>>2],c[(_=u+h|0)>>2]=c[d>>2],c[_+4>>2]=m,h=h+8|0,f=f-1|0;);(_=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[_-4>>2])),c[e+32>>2]=u,c[e+28>>2]=128,a[e+36|0]=1}for(c[e+24>>2]=128,_=c[e+32>>2],c[_+4>>2]=n,c[_>>2]=t,f=124,t=1;;){if(d=c[e+32>>2],u=c[4+(_=d+(o=(t=(n=t)-1|0)<<3)|0)>>2],_=c[_>>2],(0|f)<(0|t)){if(!((0|(m=(f=c[e+24>>2])<<1))<=(0|f)||c[e+28>>2]>=(0|m))){if(d=0,f&&(c[5498]=c[5498]+1,(h=M(19+(f<<4)|0))&&(c[(d=h+19&-16)-4>>2]=h),!((0|f)<1)))for(h=0;r=c[e+32>>2]+h|0,l=c[4+r>>2],c[(s=h+d|0)>>2]=c[r>>2],c[4+s>>2]=l,h=h+8|0,f=f-1|0;);(f=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[f-4>>2])),c[e+32>>2]=d,a[e+36|0]=1,c[e+28>>2]=m}f=(c[e+24>>2]=m)-4|0}if((0|_)!=(0|u)?A[_>>2]<=A[u+16>>2]&&A[_+16>>2]>=A[u>>2]&&A[_+4>>2]<=A[u+20>>2]&&A[_+20>>2]>=A[u+4>>2]&&A[_+8>>2]<=A[u+24>>2]&&A[_+24>>2]>=A[u+8>>2]&&(h=c[u+40>>2],c[_+40>>2]?(t=c[_+36>>2],t=h?(c[4+(h=d+o|0)>>2]=c[u+36>>2],c[h>>2]=t,h=c[_+40>>2],d=(t=n<<3)+c[e+32>>2]|0,c[d+4>>2]=c[u+36>>2],c[d>>2]=h,h=c[_+36>>2],d=t+c[e+32>>2]|0,c[d+12>>2]=c[u+40>>2],c[d+8>>2]=h,_=c[_+40>>2],t=t+c[e+32>>2]|0,c[t+20>>2]=c[u+40>>2],c[t+16>>2]=_,n+3|0):(c[4+(h=d+o|0)>>2]=u,c[h>>2]=t,t=c[_+40>>2],_=c[e+32>>2]+(n<<3)|0,c[_+4>>2]=u,c[_>>2]=t,n+1|0)):h?(c[4+(t=d+o|0)>>2]=c[u+36>>2],c[t>>2]=_,t=c[e+32>>2]+(n<<3)|0,c[t+4>>2]=c[u+40>>2],c[t>>2]=_,t=n+1|0):pi[c[c[i>>2]+8>>2]](i,_,u)):c[_+40>>2]&&(u=c[_+36>>2],c[4+(t=d+o|0)>>2]=u,c[t>>2]=u,u=(t=n<<3)+c[e+32>>2]|0,h=c[_+40>>2],c[u+4>>2]=h,c[u>>2]=h,u=c[_+40>>2],t=8+(t+c[e+32>>2]|0)|0,c[t>>2]=c[_+36>>2],c[t+4>>2]=u,t=n+2|0),!t)break}}}function Cn(e,t,n,i,o,r,s,l,_){var u,h,f,d,m,v,g=0,y=0,b=0,S=0,C=x(0),E=0,T=x(0),P=x(0),w=0;if(N=v=N-32|0,e){if((0|(g=c[l+4>>2]))<=127){if(c[l+8>>2]<=127){if(c[5498]=c[5498]+1,(b=M(531))&&(c[(y=b+19&-16)-4>>2]=b),1<=(0|g))for(b=g;c[y+S>>2]=c[c[l+12>>2]+S>>2],S=S+4|0,b=b-1|0;);(b=c[l+12>>2])&&p[l+16|0]&&(c[5499]=c[5499]+1,z(c[b-4>>2])),c[l+12>>2]=y,a[l+16|0]=1,c[l+8>>2]=128}for(S=g<<2,b=g-128|0;S=S+4|(c[c[l+12>>2]+S>>2]=0),(g=b)>>>0<=(b=g+1|0)>>>0;);}for(c[l+4>>2]=128,c[c[l+12>>2]>>2]=e,e=126,b=1;;){c[12+v>>2]=0,E=c[l+12>>2],S=c[E+(d=(g=b-1|0)<<2)>>2],A[8+v>>2]=A[S+8>>2]-A[s+8>>2],A[4+v>>2]=A[S+4>>2]-A[s+4>>2],A[v>>2]=A[S>>2]-A[s>>2],T=A[S+24>>2],P=A[S+16>>2],C=A[r+8>>2],u=A[r>>2],A[20+v>>2]=A[S+20>>2]-A[r+4>>2],A[16+v>>2]=P-u,A[24+v>>2]=T-C,y=c[i+4>>2],u=A[t+4>>2],h=A[n+4>>2],T=x(x(A[4+((y<<4)+v|0)>>2]-u)*h),C=A[n>>2],w=c[i>>2],f=A[t>>2];e:if(!((P=x(C*x(A[(1-w<<4)+v>>2]-f)))<T||(C=x(x(A[(w<<4)+v>>2]-f)*C),(u=x(h*x(A[4+((1-y<<4)+v|0)>>2]-u)))<C||(y=c[i+8>>2],f=A[t+8>>2],m=A[n+8>>2],(P=u<P?u:P)<(h=x(x(A[8+((y<<4)+v|0)>>2]-f)*m))||(T=C<T?T:C,!(!((C=x(m*x(A[8+((1-y<<4)+v|0)>>2]-f)))<T)&&(T<h?h:T)<o&&(C<P?C:P)>x(0))))))){if(c[S+40>>2]){if((0|e)<(0|g)){if((0|(g=c[l+4>>2]))<(0|(w=g<<1))){if((0|w)>c[l+8>>2]){if(E=0,g&&(c[5498]=c[5498]+1,(e=M(19+(g<<3)|0))&&(c[(E=e+19&-16)-4>>2]=e),!((0|g)<1)))for(y=0,e=g;c[y+E>>2]=c[c[l+12>>2]+y>>2],y=y+4|0,e=e-1|0;);(e=c[l+12>>2])&&p[l+16|0]&&(c[5499]=c[5499]+1,z(c[e-4>>2])),c[l+12>>2]=E,a[l+16|0]=1,c[l+8>>2]=w}if(((c[(y=g<<2)+E>>2]=0)|w)!=(g+1|0))for(e=g-1|0,y=y+4|0;y=y+4|(c[c[l+12>>2]+y>>2]=0),e=e-1|0;);E=c[l+12>>2]}e=(c[l+4>>2]=w)-2|0}c[E+d>>2]=c[S+36>>2],c[c[l+12>>2]+(b<<2)>>2]=c[S+40>>2],g=b+1|0;break e}pi[c[c[_>>2]+12>>2]](_,S)}if(!(b=g))break}}N=32+v|0}function En(e){return c[96+(e|=0)>>2]}function Tn(){}function Pn(e,t){e=c[4+(e|=0)>>2],pi[c[c[e>>2]+8>>2]](e,c[36+(t|=0)>>2])}function wn(e,t){var n,i,o,r,s,l,_,u,h,f,d,m,v,g,y=0,b=0,S=0,C=x(0),E=x(0),T=x(0),P=x(0);N=g=N-16|0,c[e+372>>2]=0,c[e+376>>2]=0,c[e+252>>2]=2,c[e+604>>2]=1065353216,c[e+608>>2]=1065353216,c[e+408>>2]=1065353216,c[e+412>>2]=1065353216,c[e+472>>2]=0,c[e+476>>2]=0,c[(y=e+380|0)>>2]=0,c[y+4>>2]=0,c[(y=e+388|0)>>2]=0,c[y+4>>2]=0,c[(y=e+396|0)>>2]=0,c[y+4>>2]=0,c[(y=e+612|0)>>2]=1065353216,c[y+4>>2]=0,c[(y=e+420|0)>>2]=0,c[y+4>>2]=0,c[e+416>>2]=1065353216,c[(y=e+428|0)>>2]=0,c[y+4>>2]=0,c[(y=e+436|0)>>2]=0,c[y+4>>2]=0,c[(y=e+444|0)>>2]=0,c[y+4>>2]=0,c[e+452>>2]=0,c[(y=e+480|0)>>2]=0,c[y+4>>2]=0,c[(y=e+488|0)>>2]=0,c[y+4>>2]=0,c[(y=e+496|0)>>2]=0,c[y+4>>2]=0,E=A[t+96>>2],C=A[t+92>>2],A[12+g>>2]=C,A[8+g>>2]=E,c[4+g>>2]=0,c[g>>2]=1065353216,A[e+504>>2]=A[(C<x(0)?4+g|0:C>x(1)?g:12+g|0)>>2],c[4+g>>2]=0,c[g>>2]=1065353216,A[e+508>>2]=A[(E<x(0)?4+g|0:E>x(1)?g:8+g|0)>>2],c[e+668>>2]=0,c[e+672>>2]=0,y=c[t+120>>2],c[e+532>>2]=c[t+116>>2],c[e+536>>2]=y,b=c[t+4>>2],c[e+540>>2]=b,a[e+512|0]=p[t+124|0],y=c[t+132>>2],c[e+516>>2]=c[t+128>>2],c[e+520>>2]=y,y=c[t+140>>2],c[e+524>>2]=c[t+136>>2],c[e+528>>2]=y,b?pi[c[c[b>>2]+8>>2]](b,y=e+4|0):(y=c[t+12>>2],c[e+4>>2]=c[t+8>>2],c[e+8>>2]=y,S=c[4+(b=t+16|0)>>2],c[(y=e+12|0)>>2]=c[b>>2],c[y+4>>2]=S,S=c[4+(b=t+32|0)>>2],c[(y=e+28|0)>>2]=c[b>>2],c[y+4>>2]=S,S=c[4+(b=t+24|0)>>2],c[(y=e+20|0)>>2]=c[b>>2],c[y+4>>2]=S,S=c[4+(b=t+40|0)>>2],c[(y=e+36|0)>>2]=c[b>>2],c[y+4>>2]=S,S=c[4+(b=t+48|0)>>2],c[(y=e+44|0)>>2]=c[b>>2],c[y+4>>2]=S,S=c[4+(b=t- -64|0)>>2],c[(y=e+60|0)>>2]=c[b>>2],c[y+4>>2]=S,S=c[4+(b=t+56|0)>>2],c[(y=e+52|0)>>2]=c[b>>2],c[y+4>>2]=S,y=e+4|0),c[e+132>>2]=0,c[e+136>>2]=0,b=c[y+4>>2],c[e+68>>2]=c[y>>2],c[e+72>>2]=b,c[(b=e+156|0)>>2]=0,c[b+4>>2]=0,c[(b=e+148|0)>>2]=0,c[b+4>>2]=0,c[(b=e+140|0)>>2]=0,c[b+4>>2]=0,v=c[4+(S=e+20|0)>>2],c[(b=e+84|0)>>2]=c[S>>2],c[b+4>>2]=v,S=c[4+(y=y+8|0)>>2],c[(b=e+76|0)>>2]=c[y>>2],c[b+4>>2]=S,S=c[4+(b=e+28|0)>>2],c[(y=e+92|0)>>2]=c[b>>2],c[y+4>>2]=S,S=c[4+(b=e+36|0)>>2],c[(y=e+100|0)>>2]=c[b>>2],c[y+4>>2]=S,S=c[4+(b=e+44|0)>>2],c[(y=e+108|0)>>2]=c[b>>2],c[y+4>>2]=S,S=c[4+(b=e+52|0)>>2],c[(y=e+116|0)>>2]=c[b>>2],c[y+4>>2]=S,S=c[4+(b=e+60|0)>>2],c[(y=e+124|0)>>2]=c[b>>2],c[y+4>>2]=S,A[e+228>>2]=A[t+100>>2],A[e+236>>2]=A[t+104>>2],A[e+240>>2]=A[t+108>>2],A[e+232>>2]=A[t+112>>2],pi[c[c[e>>2]+8>>2]](e,c[t+72>>2]),y=c[5866],c[e+568>>2]=y,c[5866]=y+1,E=x(0),y=c[e+204>>2],(C=A[t>>2])!=x(0)?(c[e+204>>2]=-2&y,E=x(x(1)/C)):c[e+204>>2]=1|y,A[e+404>>2]=E,c[e+436>>2]=0,A[e+424>>2]=C*A[e+440>>2],A[e+432>>2]=C*A[e+448>>2],A[e+428>>2]=C*A[e+444>>2],C=A[t+84>>2],T=A[t+80>>2],P=A[t+76>>2],c[e+468>>2]=0,_=P!=x(0)?x(x(1)/P):x(0),A[e+456>>2]=_,u=T!=x(0)?x(x(1)/T):x(0),A[e+460>>2]=u,h=C!=x(0)?x(x(1)/C):x(0),A[e+464>>2]=h,c[e+368>>2]=0,c[e+352>>2]=0,c[e+336>>2]=0,C=A[e+44>>2],T=A[e+36>>2],P=A[e+40>>2],f=A[e+28>>2],d=A[e+20>>2],m=A[e+24>>2],r=A[e+12>>2],s=A[e+8>>2],l=A[e+4>>2],c[e+564>>2]=8,n=x(_*l),i=x(u*s),o=x(h*r),A[e+324>>2]=x(x(l*n)+x(s*i))+x(r*o),A[e+328>>2]=x(x(n*d)+x(i*m))+x(o*f),A[e+332>>2]=x(x(n*T)+x(i*P))+x(o*C),n=x(_*d),i=x(u*m),o=x(h*f),A[e+340>>2]=x(x(l*n)+x(s*i))+x(r*o),A[e+344>>2]=x(x(d*n)+x(m*i))+x(f*o),A[e+348>>2]=x(x(n*T)+x(i*P))+x(o*C),n=l,l=x(_*T),i=s,s=x(u*P),o=r,r=x(h*C),A[e+356>>2]=x(x(n*l)+x(i*s))+x(o*r),A[e+360>>2]=x(x(d*l)+x(m*s))+x(f*r),A[e+364>>2]=x(x(T*l)+x(P*s))+x(C*r),c[(t=e+596|0)>>2]=0,c[t+4>>2]=0,c[(t=e+588|0)>>2]=0,c[t+4>>2]=0,c[(t=e+580|0)>>2]=0,c[t+4>>2]=0,c[e+572>>2]=0,c[e+576>>2]=0,C=A[e+408>>2],T=A[e+412>>2],A[e+628>>2]=E*A[e+416>>2],A[e+624>>2]=E*T,A[e+620>>2]=E*C,c[e+664>>2]=0,c[(t=e+656|0)>>2]=0,c[t+4>>2]=0,c[(t=e+648|0)>>2]=0,c[t+4>>2]=0,c[(t=e+640|0)>>2]=0,c[t+4>>2]=0,c[(e=e+632|0)>>2]=0,c[e+4>>2]=0,N=16+g|0}function In(e,t,n,i){var o,a,s,_,u,p,d,m,v,g,y,b,E,P,w,I,R,D,O,M,z,L,F=x(0),B=x(0);N=L=N+-64|0,v=A[t+24>>2],g=A[t+20>>2],y=A[t+40>>2],b=A[t+36>>2],s=A[e+40>>2],_=A[e+20>>2],u=A[e+36>>2],p=A[e+24>>2],E=A[t+8>>2],P=A[t>>2],w=A[t+4>>2],I=A[t+16>>2],R=A[t+32>>2],B=A[e+8>>2],o=A[e+4>>2],m=A[e+32>>2],d=A[e+16>>2],a=A[e>>2],c[60+L>>2]=0,c[44+L>>2]=0,O=x(x(_*s)-x(p*u)),M=x(x(p*m)-x(s*d)),z=x(x(u*d)-x(_*m)),F=x(x(1)/x(x(x(a*O)+x(o*M))+x(B*z))),D=x(x(x(p*o)-x(_*B))*F),p=x(x(x(d*B)-x(p*a))*F),_=x(x(x(_*a)-x(d*o))*F),A[56+L>>2]=x(x(R*D)+x(b*p))+x(y*_),d=x(x(x(u*B)-x(s*o))*F),B=x(x(x(s*a)-x(m*B))*F),o=x(x(x(m*o)-x(u*a))*F),A[52+L>>2]=x(x(R*d)+x(b*B))+x(y*o),A[40+L>>2]=x(x(D*I)+x(p*g))+x(_*v),A[36+L>>2]=x(x(d*I)+x(B*g))+x(o*v),c[28+L>>2]=0,a=x(O*F),s=x(M*F),F=x(z*F),A[48+L>>2]=x(x(R*a)+x(b*s))+x(y*F),A[32+L>>2]=x(x(a*I)+x(s*g))+x(F*v),A[24+L>>2]=x(E*_)+x(x(P*D)+x(w*p)),A[20+L>>2]=x(E*o)+x(x(P*d)+x(w*B)),A[16+L>>2]=x(F*E)+x(x(P*a)+x(w*s)),Rn(16+L|0,L),a=A[L>>2],s=A[4+L>>2],_=A[8+L>>2],F=A[12+L>>2],o=x(x(1)/x(T(x(x(x(x(a*a)+x(s*s))+x(_*_))+x(F*F))))),h(B=x(S(x(C(x(F*o),x(-1))),x(1))));e:if(1065353216<=(e=2147483647&(t=r[2]))>>>0)F=x((0|t)<0?3.141592502593994:0),1065353216!=(0|e)&&(F=x(x(0)/x(B-B)));else t:{if(e>>>0<=1056964607){if(F=x(1.570796251296997),e>>>0<847249409)break t;F=x(B*B),F=x(x(x(x(7.549789415861596e-8)-x(x(x(F*x(x(F*x(x(F*x(-.008656363002955914))+x(-.04274342209100723)))+x(.16666586697101593)))/x(x(F*x(-.7066296339035034))+x(1)))*B))-B)+x(1.570796251296997));break e}if((0|t)<=-1){F=x(x(B+x(1))*x(.5)),B=x(T(F)),F=x(x(1.570796251296997)-x(B+x(x(B*x(x(F*x(x(F*x(x(F*x(-.008656363002955914))+x(-.04274342209100723)))+x(.16666586697101593)))/x(x(F*x(-.7066296339035034))+x(1))))+x(-7.549789415861596e-8)))),F=x(F+F);break e}F=x(x(x(1)-B)*x(.5)),l(2,-4096&(h(u=x(T(F))),r[2])),B=f(),F=x(x(x(u*x(x(F*x(x(F*x(x(F*x(-.008656363002955914))+x(-.04274342209100723)))+x(.16666586697101593)))/x(x(F*x(-.7066296339035034))+x(1))))+x(x(F-x(B*B))/x(u+B)))+B),F=x(F+F)}A[i>>2]=F+F,c[n+12>>2]=0,F=x(a*o),B=x(s*o),o=x(_*o),(a=x(x(x(F*F)+x(B*B))+x(o*o)))<x(14210854715202004e-30)?(c[n+8>>2]=0,c[n+12>>2]=0,c[n>>2]=1065353216,c[n+4>>2]=0):(s=o,o=x(x(1)/x(T(a))),A[n+8>>2]=s*o,A[n+4>>2]=B*o,A[n>>2]=F*o),N=L+64|0}function Rn(e,t){var n,i,o,a,r=x(0),s=x(0),c=0,l=x(0),_=x(0),u=N-16|0;r=A[e>>2],l=A[e+20>>2],_=A[e+40>>2],r=(s=x(x(r+l)+_))>x(0)?(s=x(T(x(s+x(1)))),r=x(x(.5)/s),l=x(r*x(A[e+16>>2]-A[e+4>>2])),_=x(r*x(A[e+8>>2]-A[e+32>>2])),s=x(s*x(.5)),x(r*x(A[e+36>>2]-A[e+24>>2]))):(i=(n=r<l?l<_?2:1:(r<_)<<1)<<2,o=(n<<4)+e|0,a=((c=(1+n>>>0)%3|0)<<4)+e|0,n=e+((e=(2+n>>>0)%3|0)<<4)|0,e<<=2,r=x(T(x(x(x(A[o+i>>2]-A[a+(c<<=2)>>2])-A[n+e>>2])+x(1)))),A[(i|u)>>2]=r*x(.5),r=x(x(.5)/r),A[12+u>>2]=x(A[n+c>>2]-A[e+a>>2])*r,A[(u|c)>>2]=r*x(A[i+a>>2]+A[c+o>>2]),A[(e|u)>>2]=r*x(A[n+i>>2]+A[e+o>>2]),s=A[12+u>>2],l=A[8+u>>2],_=A[4+u>>2],A[u>>2]),A[t+12>>2]=s,A[t+8>>2]=l,A[t+4>>2]=_,A[t>>2]=r}function Dn(e,t){var n,i,o,a,r,s,l,_,u,h,f,d,m,v,g,y,b,S,C,E,T=0,P=0,w=0;2&p[e+204|0]?(T=c[e+8>>2],c[e+68>>2]=c[e+4>>2],c[e+72>>2]=T,w=c[4+(P=e+12|0)>>2],c[(T=e+76|0)>>2]=c[P>>2],c[T+4>>2]=w,w=c[4+(P=e+20|0)>>2],c[(T=e+84|0)>>2]=c[P>>2],c[T+4>>2]=w,w=c[4+(P=e+28|0)>>2],c[(T=e+92|0)>>2]=c[P>>2],c[T+4>>2]=w,w=c[4+(P=e+36|0)>>2],c[(T=e+100|0)>>2]=c[P>>2],c[T+4>>2]=w,w=c[4+(P=e+44|0)>>2],c[(T=e+108|0)>>2]=c[P>>2],c[T+4>>2]=w,w=c[4+(P=e+52|0)>>2],c[(T=e+116|0)>>2]=c[P>>2],c[T+4>>2]=w,w=c[4+(P=e+60|0)>>2],c[(T=e+124|0)>>2]=c[P>>2],c[T+4>>2]=w):(T=c[t+4>>2],c[e+68>>2]=c[t>>2],c[e+72>>2]=T,w=c[4+(P=t+8|0)>>2],c[(T=e+76|0)>>2]=c[P>>2],c[T+4>>2]=w,w=c[4+(P=t+24|0)>>2],c[(T=e+92|0)>>2]=c[P>>2],c[T+4>>2]=w,P=c[t+20>>2],c[(T=e+84|0)>>2]=c[t+16>>2],c[T+4>>2]=P,P=c[t+36>>2],c[(T=e+100|0)>>2]=c[t+32>>2],c[T+4>>2]=P,w=c[4+(P=t+40|0)>>2],c[(T=e+108|0)>>2]=c[P>>2],c[T+4>>2]=w,w=c[4+(P=t+56|0)>>2],c[(T=e+124|0)>>2]=c[P>>2],c[T+4>>2]=w,P=c[t+52>>2],c[(T=e+116|0)>>2]=c[t+48>>2],c[T+4>>2]=P),T=c[e+392>>2],c[e+148>>2]=c[e+388>>2],c[e+152>>2]=T,T=c[e+376>>2],c[e+132>>2]=c[e+372>>2],c[e+136>>2]=T,w=c[4+(P=e+396|0)>>2],c[(T=e+156|0)>>2]=c[P>>2],c[T+4>>2]=w,w=c[4+(P=e+380|0)>>2],c[(T=e+140|0)>>2]=c[P>>2],c[T+4>>2]=w,h=c[4+(w=t+8|0)>>2],c[(T=e+12|0)>>2]=c[w>>2],c[T+4>>2]=h,P=c[t+4>>2],c[e+4>>2]=c[t>>2],c[e+8>>2]=P,i=c[4+(h=t+24|0)>>2],c[(P=e+28|0)>>2]=c[h>>2],c[P+4>>2]=i,i=c[t+20>>2],c[(w=e+20|0)>>2]=c[t+16>>2],c[w+4>>2]=i,s=c[4+(n=t+40|0)>>2],c[(i=h=e+44|0)>>2]=c[n>>2],c[4+i>>2]=s,s=c[t+36>>2],c[(n=i=e+36|0)>>2]=c[t+32>>2],c[4+n>>2]=s,E=c[4+(s=t+56|0)>>2],c[(n=e+60|0)>>2]=c[s>>2],c[4+n>>2]=E,s=c[t+52>>2],c[(n=e+52|0)>>2]=c[t+48>>2],c[4+n>>2]=s,f=A[e+8>>2],d=A[T>>2],m=A[P>>2],v=A[w>>2],g=A[e+24>>2],l=A[h>>2],b=A[e+464>>2],_=A[i>>2],u=A[e+40>>2],S=A[e+460>>2],y=A[e+4>>2],C=A[e+456>>2],c[e+368>>2]=0,c[e+352>>2]=0,c[e+336>>2]=0,o=x(C*_),a=x(S*u),r=x(b*l),A[e+364>>2]=x(x(_*o)+x(u*a))+x(l*r),A[e+360>>2]=x(x(v*o)+x(g*a))+x(m*r),A[e+356>>2]=x(x(y*o)+x(f*a))+x(d*r),o=x(C*v),a=x(S*g),r=x(b*m),A[e+348>>2]=x(x(_*o)+x(u*a))+x(l*r),A[e+344>>2]=x(x(v*o)+x(g*a))+x(m*r),A[e+340>>2]=x(x(y*o)+x(f*a))+x(d*r),o=_,_=x(y*C),a=u,u=x(f*S),r=l,l=x(d*b),A[e+332>>2]=x(x(o*_)+x(a*u))+x(r*l),A[e+328>>2]=x(x(_*v)+x(u*g))+x(l*m),A[e+324>>2]=x(x(y*_)+x(f*u))+x(d*l)}function Nn(e,t){var n=0,i=0,o=0,r=0,s=0;e:{t:if(!((0|(i=c[e+548>>2]))<1)){for(o=c[e+556>>2],n=i;c[o>>2]!=(0|t);)if(o=o+4|0,!(n=n-1|0))break t;if(n)break e}if(c[e+552>>2]==(0|i)&&!((0|(r=i?i<<1:1))<=(0|i))){if(r&&(c[5498]=c[5498]+1,(n=M(19+(r<<2)|0))&&(c[(s=n+19&-16)-4>>2]=n)),1<=(0|i))for(o=0,n=i;c[o+s>>2]=c[c[e+556>>2]+o>>2],o=o+4|0,n=n-1|0;);(n=c[e+556>>2])&&p[e+560|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2]),i=c[e+548>>2]),c[e+556>>2]=s,c[e+552>>2]=r,a[e+560|0]=1}if(c[c[e+556>>2]+(i<<2)>>2]=t,c[e+548>>2]=i+1,n=c[t+32>>2],(0|(s=c[t+28>>2]))!=(0|e)){if((0|(t=c[n+288>>2]))==c[n+292>>2]&&!((0|(r=t?t<<1:1))<=(0|t))){if(i=0,r&&(c[5498]=c[5498]+1,(e=M(19+(r<<2)|0))&&(c[(i=e+19&-16)-4>>2]=e)),1<=(0|t))for(o=0,e=t;c[i+o>>2]=c[c[n+296>>2]+o>>2],o=o+4|0,e=e-1|0;);(e=c[n+296>>2])&&p[n+300|0]&&(c[5499]=c[5499]+1,z(c[e-4>>2]),t=c[n+288>>2]),c[n+296>>2]=i,c[n+292>>2]=r,a[n+300|0]=1}e=n,n=s}else if((0|(t=c[e+288>>2]))==c[e+292>>2]&&!((0|(r=t?t<<1:1))<=(0|t))){if(s=0,r&&(c[5498]=c[5498]+1,(i=M(19+(r<<2)|0))&&(c[(s=i+19&-16)-4>>2]=i)),1<=(0|t))for(o=0,i=t;c[o+s>>2]=c[c[e+296>>2]+o>>2],o=o+4|0,i=i-1|0;);(i=c[e+296>>2])&&p[e+300|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2]),t=c[e+288>>2]),c[e+296>>2]=s,c[e+292>>2]=r,a[e+300|0]=1}c[e+288>>2]=t+1,c[e+280>>2]=(-1^t)>>>31,c[c[e+296>>2]+(t<<2)>>2]=n}}function On(e,t){var n=0,i=0,o=0,a=0;e:if(!((0|(a=c[e+548>>2]))<1)){for(i=o=c[e+556>>2];c[i>>2]!=(0|t);)if(i=i+4|0,(0|a)==(0|(n=n+1|0)))break e;if(!((0|a)<=(0|n))){n=0,i=o;t:{for(;c[i>>2]!=(0|t);)if(i=i+4|0,(0|a)==(0|(n=n+1|0)))break t;(0|a)<=(0|n)||(c[i>>2]=c[(n=o)+(o=(i=a-1|0)<<2)>>2],c[e+548>>2]=i,c[o+c[e+556>>2]>>2]=t)}if(a=c[t+32>>2],(0|(o=c[t+28>>2]))==(0|e)){t:if(!((0|(t=c[e+288>>2]))<1)){for(n=0,i=o=c[e+296>>2];c[i>>2]!=(0|a);)if(i=i+4|0,(0|(n=n+1|0))==(0|t))break t;(0|t)<=(0|n)||(c[i>>2]=c[(n=o)+(o=(t=t-1|0)<<2)>>2],c[e+288>>2]=t,c[o+c[e+296>>2]>>2]=a)}return void(c[e+280>>2]=0<(0|t))}t:if(!((0|(t=c[a+288>>2]))<1)){for(n=0,i=e=c[a+296>>2];(0|o)!=c[i>>2];)if(i=i+4|0,(0|(n=n+1|0))==(0|t))break t;(0|t)<=(0|n)||(c[i>>2]=c[(n=e)+(e=(t=t-1|0)<<2)>>2],c[a+288>>2]=t,c[e+c[a+296>>2]>>2]=o)}c[a+280>>2]=0<(0|t)}}}function Mn(e){var t=0;return c[(e|=0)>>2]=17208,(t=c[e+204>>2])&&p[e+208|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+204>>2]=0,a[e+208|0]=1,c[(t=e+196|0)>>2]=0,c[t+4>>2]=0,(t=c[e+176>>2])&&p[e+180|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+176>>2]=0,a[e+180|0]=1,c[(t=e+168|0)>>2]=0,c[t+4>>2]=0,(t=c[e+156>>2])&&p[e+160|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+156>>2]=0,a[e+160|0]=1,c[(t=e+148|0)>>2]=0,c[t+4>>2]=0,(t=c[e+136>>2])&&p[e+140|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+136>>2]=0,a[e+140|0]=1,c[(t=e+128|0)>>2]=0,c[t+4>>2]=0,(t=c[e+116>>2])&&p[e+120|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+116>>2]=0,a[e+120|0]=1,c[(t=e+108|0)>>2]=0,c[t+4>>2]=0,(t=c[e+96>>2])&&p[e+100|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+96>>2]=0,a[e+100|0]=1,c[(t=e+88|0)>>2]=0,c[t+4>>2]=0,(t=c[e+76>>2])&&p[e+80|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+76>>2]=0,a[e+80|0]=1,c[(t=e+68|0)>>2]=0,c[t+4>>2]=0,(t=c[e+56>>2])&&p[e+60|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+56>>2]=0,a[e+60|0]=1,c[(t=e+48|0)>>2]=0,c[t+4>>2]=0,(t=c[e+36>>2])&&p[e+40|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+36>>2]=0,a[e+40|0]=1,c[(t=e+28|0)>>2]=0,c[t+4>>2]=0,(t=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+16>>2]=0,a[e+20|0]=1,c[(t=e+8|0)>>2]=0,(c[t+4>>2]=0)|e}function zn(e,t,n){var i,o,a,r,s,l,_,u,h,f,d,m,v,g,y=0,b=0;return N=g=N-256|0,-1<(0|(b=c[t+212>>2]))||(2&(y=c[t+252>>2])&&(2&p[204+(y=y<<30>>31&t)|0]||A[y+404>>2]!=x(0))?(b=c[e+8>>2],B(8+g|0,0,244),e=kn(e+4|0,8+g|0),y=c[t+252>>2],c[(i=e+88|0)>>2]=0,c[4+i>>2]=0,c[(i=e+80|0)>>2]=0,c[4+i>>2]=0,c[(i=e+72|0)>>2]=0,c[4+i>>2]=0,c[e+64>>2]=0,c[e+68>>2]=0,c[e+144>>2]=0,c[e+148>>2]=0,c[(i=e+152|0)>>2]=0,c[4+i>>2]=0,c[(i=e+160|0)>>2]=0,c[4+i>>2]=0,c[(i=e+168|0)>>2]=0,c[4+i>>2]=0,2&y?(i=c[8+(y=y<<30>>31&t)>>2],c[e>>2]=c[y+4>>2],c[e+4>>2]=i,a=c[4+(o=y+12|0)>>2],c[(i=e+8|0)>>2]=c[o>>2],c[4+i>>2]=a,a=c[4+(o=y+28|0)>>2],c[(i=e+24|0)>>2]=c[o>>2],c[4+i>>2]=a,o=c[4+(i=y+20|0)>>2],c[e+16>>2]=c[i>>2],c[e+20>>2]=o,a=c[4+(o=y+44|0)>>2],c[(i=e+40|0)>>2]=c[o>>2],c[4+i>>2]=a,o=c[4+(i=y+36|0)>>2],c[e+32>>2]=c[i>>2],c[e+36>>2]=o,o=c[4+(i=y+52|0)>>2],c[e+48>>2]=c[i>>2],c[e+52>>2]=o,a=c[4+(o=y+60|0)>>2],c[(i=e+56|0)>>2]=c[o>>2],c[4+i>>2]=a,s=A[y+412>>2],l=A[(i=y+416|0)>>2],_=A[y+408>>2],r=A[y+404>>2],c[e+140>>2]=0,A[e+136>>2]=r*l,A[e+132>>2]=r*s,A[e+128>>2]=r*_,c[e+240>>2]=y,u=c[4+(a=y+612|0)>>2],c[(o=e+104|0)>>2]=c[a>>2],c[4+o>>2]=u,o=c[y+608>>2],c[e+96>>2]=c[y+604>>2],c[e+100>>2]=o,a=c[4+i>>2],c[(o=e+120|0)>>2]=c[i>>2],c[4+o>>2]=a,i=c[y+412>>2],c[e+112>>2]=c[y+408>>2],c[e+116>>2]=i,a=c[4+(o=y+380|0)>>2],c[(i=e+184|0)>>2]=c[o>>2],c[4+i>>2]=a,i=c[y+376>>2],c[e+176>>2]=c[y+372>>2],c[e+180>>2]=i,i=c[y+392>>2],c[e+192>>2]=c[y+388>>2],c[e+196>>2]=i,a=c[4+(o=y+396|0)>>2],c[(i=e+200|0)>>2]=c[o>>2],c[4+i>>2]=a,s=A[y+476>>2],l=A[y+480>>2],_=A[y+472>>2],r=A[y+404>>2],c[e+220>>2]=0,A[e+216>>2]=x(r*l)*n,A[e+212>>2]=x(r*s)*n,A[e+208>>2]=x(r*_)*n,_=A[y+340>>2],h=A[y+356>>2],f=A[y+328>>2],d=A[y+344>>2],m=A[y+360>>2],v=A[y+324>>2],r=A[y+488>>2],s=A[y+492>>2],l=A[y+496>>2],A[e+232>>2]=x(x(x(r*A[y+332>>2])+x(s*A[y+348>>2]))+x(l*A[y+364>>2]))*n,A[e+228>>2]=x(x(x(r*f)+x(s*d))+x(l*m))*n,A[e+224>>2]=x(x(x(v*r)+x(_*s))+x(h*l))*n):(c[e+4>>2]=0,c[e+8>>2]=0,c[e>>2]=1065353216,c[e+240>>2]=0,c[e+128>>2]=0,c[e+132>>2]=0,c[e+112>>2]=1065353216,c[e+116>>2]=1065353216,c[e+96>>2]=1065353216,c[e+100>>2]=1065353216,c[e+176>>2]=0,c[e+180>>2]=0,c[(y=e+12|0)>>2]=0,c[y+4>>2]=0,c[(y=e+24|0)>>2]=0,c[y+4>>2]=0,c[e+20>>2]=1065353216,c[(y=e+32|0)>>2]=0,c[y+4>>2]=0,c[(y=e+44|0)>>2]=0,c[y+4>>2]=0,c[e+40>>2]=1065353216,c[(y=e+52|0)>>2]=0,c[y+4>>2]=0,c[e+60>>2]=0,c[(y=e+136|0)>>2]=0,c[y+4>>2]=0,c[(y=e+120|0)>>2]=1065353216,c[y+4>>2]=0,c[(y=e+104|0)>>2]=1065353216,c[y+4>>2]=0,c[e+232>>2]=0,c[(y=e+224|0)>>2]=0,c[y+4>>2]=0,c[(y=e+216|0)>>2]=0,c[y+4>>2]=0,c[(y=e+208|0)>>2]=0,c[y+4>>2]=0,c[(y=e+200|0)>>2]=0,c[y+4>>2]=0,c[(y=e+192|0)>>2]=0,c[y+4>>2]=0,c[(y=e+184|0)>>2]=0,c[y+4>>2]=0),c[e+236>>2]=0,c[t+212>>2]=b):-1<(0|(b=c[e+188>>2]))||(c[e+188>>2]=c[e+8>>2],B(8+g|0,0,244),t=kn(e+4|0,8+g|0),c[(y=t+88|0)>>2]=0,c[y+4>>2]=0,c[(y=t+80|0)>>2]=0,c[y+4>>2]=0,c[(y=t+72|0)>>2]=0,c[y+4>>2]=0,c[t+64>>2]=0,c[t+68>>2]=0,c[t+144>>2]=0,c[t+148>>2]=0,c[(y=t+152|0)>>2]=0,c[y+4>>2]=0,c[(y=t+160|0)>>2]=0,c[y+4>>2]=0,c[(y=t+168|0)>>2]=0,c[y+4>>2]=0,c[t+4>>2]=0,c[t+8>>2]=0,c[t>>2]=1065353216,c[(y=t+12|0)>>2]=0,c[y+4>>2]=0,c[(y=t+24|0)>>2]=0,c[y+4>>2]=0,c[t+20>>2]=1065353216,c[(y=t+32|0)>>2]=0,c[y+4>>2]=0,c[(y=t+44|0)>>2]=0,c[y+4>>2]=0,c[t+40>>2]=1065353216,c[(y=t+52|0)>>2]=0,c[y+4>>2]=0,c[t+60>>2]=0,c[(y=t+136|0)>>2]=0,c[y+4>>2]=0,c[t+128>>2]=0,c[t+132>>2]=0,c[(y=t+120|0)>>2]=1065353216,c[y+4>>2]=0,c[t+112>>2]=1065353216,c[t+116>>2]=1065353216,c[(y=t+104|0)>>2]=1065353216,c[y+4>>2]=0,c[t+96>>2]=1065353216,c[t+100>>2]=1065353216,c[(y=t+232|0)>>2]=0,c[y+4>>2]=0,c[(y=t+224|0)>>2]=0,c[y+4>>2]=0,c[(y=t+216|0)>>2]=0,c[y+4>>2]=0,c[(y=t+208|0)>>2]=0,c[y+4>>2]=0,c[(y=t+200|0)>>2]=0,c[y+4>>2]=0,c[(y=t+192|0)>>2]=0,c[y+4>>2]=0,c[(y=t+184|0)>>2]=0,c[y+4>>2]=0,c[t+176>>2]=0,c[t+180>>2]=0,c[t+240>>2]=0,b=c[e+188>>2])),N=256+g|0,b}function Ln(e,t,n,i,o,r){var s,l,_,u,h,f=0,d=0,m=x(0),v=x(0),y=x(0),b=x(0),S=x(0),C=0,E=0,T=x(0),P=x(0),w=x(0),I=x(0),R=x(0),D=x(0),N=x(0),O=x(0),L=x(0),F=x(0);if((0|(f=h=c[e+88>>2]))==c[e+92>>2]&&!((0|(C=(f=h)?f<<1:1))<=(0|f))){if(C&&(c[5498]=c[5498]+1,(f=M(g(C,152)+19|0))&&(c[(E=f+19&-16)-4>>2]=f)),1<=(0|h))for(f=0,d=h;k(f+E|0,c[e+96>>2]+f|0,152),f=f+152|0,d=d-1|0;);(f=c[e+96>>2])&&p[e+100|0]&&(c[5499]=c[5499]+1,z(c[f-4>>2])),c[e+96>>2]=E,c[e+92>>2]=C,a[e+100|0]=1,f=c[e+88>>2]}c[e+88>>2]=f+1,f=(C=c[e+96>>2])+g(h,152)|0,c[f+16>>2]=0,c[f+20>>2]=0,c[f+48>>2]=-2147483648,c[f+52>>2]=-2147483648,c[(d=f+24|0)>>2]=0,c[d+4>>2]=0,c[(d=f+56|0)>>2]=-2147483648,c[d+4>>2]=0,A[f+104>>2]=r,c[f+96>>2]=0,c[f+100>>2]=0,E=c[e+16>>2],e=c[240+(E+g(n,244)|0)>>2],d=c[240+(E+g(i,244)|0)>>2],c[f+132>>2]=0,c[f+140>>2]=o,c[f+148>>2]=i,c[f+144>>2]=n,s=A[t+8>>2],_=A[t+4>>2],v=A[t>>2],c[f+12>>2]=0,u=x(-v),A[f>>2]=u,y=x(-_),A[f+4>>2]=y,A[f+8>>2]=-s,o=f,m=e?(b=x(x(x(x(A[e+360>>2]*y)-x(v*A[e+356>>2]))-x(s*A[e+364>>2]))*A[e+612>>2]),S=x(x(x(x(A[e+344>>2]*y)-x(v*A[e+340>>2]))-x(s*A[e+348>>2]))*A[e+608>>2]),x(x(x(x(A[e+328>>2]*y)-x(v*A[e+324>>2]))-x(s*A[e+332>>2]))*A[e+604>>2])):x(0),A[o+64>>2]=m,c[f+76>>2]=0,A[f+72>>2]=b,A[f+68>>2]=S,l=A[t>>2],b=A[t+4>>2],S=A[t+8>>2],A[f+44>>2]=A[t+12>>2],A[f+40>>2]=S,A[f+36>>2]=b,A[f+32>>2]=l,o=t=C+g(h,152)|0,m=d?(w=x(x(x(x(l*A[d+356>>2])+x(b*A[d+360>>2]))+x(S*A[d+364>>2]))*A[d+612>>2]),T=x(x(x(x(l*A[d+340>>2])+x(b*A[d+344>>2]))+x(S*A[d+348>>2]))*A[d+608>>2]),x(x(x(x(l*A[d+324>>2])+x(b*A[d+328>>2]))+x(S*A[d+332>>2]))*A[d+604>>2])):x(0),A[o+80>>2]=m,c[t+92>>2]=0,A[t+88>>2]=w,A[t+84>>2]=T,T=x(0),w=x(0),t=C+g(h,152)|0,m=e?(I=x(x(x(A[e+360>>2]*y)-x(v*A[e+356>>2]))-x(s*A[e+364>>2])),T=x(x(x(A[e+328>>2]*y)-x(v*A[e+324>>2]))-x(s*A[e+332>>2])),x(x(x(A[e+344>>2]*y)-x(v*A[e+340>>2]))-x(s*A[e+348>>2]))):x(0),m=x(x(x(x(m*y)-x(v*T))-x(s*I))+x(0)),P=d?(R=x(x(x(l*A[d+356>>2])+x(b*A[d+360>>2]))+x(S*A[d+364>>2])),D=x(x(x(l*A[d+340>>2])+x(b*A[d+344>>2]))+x(S*A[d+348>>2])),x(x(x(A[d+324>>2]*l)+x(A[d+328>>2]*b))+x(A[d+332>>2]*S))):x(0),P=x(x(1)/x(m+x(x(x(P*l)+x(D*b))+x(R*S)))),A[t+108>>2]=P,v=x(0),y=x(0),T=x(0),I=x(0),e&&(e=E+g(n,244)|0,v=x(x(A[e+176>>2]+A[e+208>>2])*x(0)),I=A[e+192>>2],T=A[e+200>>2],w=A[e+196>>2],N=x(x(A[e+184>>2]+A[e+216>>2])*x(0)),y=x(x(A[e+180>>2]+A[e+212>>2])*x(0))),D=d?(e=E+g(i,244)|0,R=x(x(A[e+176>>2]+A[e+208>>2])*x(-0)),O=A[e+192>>2],L=A[e+200>>2],F=A[e+196>>2],m=x(x(A[e+180>>2]+A[e+212>>2])*x(-0)),x(x(A[e+184>>2]+A[e+216>>2])*x(-0))):(R=x(-0),m=x(-0),x(-0)),e=C+g(h,152)|0,A[e+124>>2]=r,A[e+120>>2]=-r,c[e+116>>2]=0,A[e+112>>2]=P*x(x(0)-x(x(x(x(v+y)+N)+x(x(x(I*u)-x(_*w))-x(s*T)))+x(x(x(R+m)+D)+x(x(S*L)+x(x(b*F)+x(l*O))))))}function Fn(e,t,n,i,o,r,s,l,_,u,h,f){var d,m,v,y,b,S,C=0,E=0,T=x(0),P=x(0),w=x(0),I=x(0),R=x(0),D=x(0),N=x(0),O=x(0),L=x(0),F=0,B=0,U=x(0),G=x(0),j=x(0),V=x(0),H=x(0),W=x(0),q=x(0),Y=x(0),X=x(0),Q=x(0),Z=x(0),J=x(0),K=x(0),$=x(0),ee=x(0),te=x(0);if((0|(C=S=c[e+68>>2]))==c[e+72>>2]&&!((0|(F=(C=S)?C<<1:1))<=(0|C))){if(F&&(c[5498]=c[5498]+1,(C=M(g(F,152)+19|0))&&(c[(E=C+19&-16)-4>>2]=C)),1<=(0|S))for(C=0,B=S;k(C+E|0,c[e+76>>2]+C|0,152),C=C+152|0,B=B-1|0;);(C=c[e+76>>2])&&p[e+80|0]&&(c[5499]=c[5499]+1,z(c[C-4>>2])),c[e+76>>2]=E,c[e+72>>2]=F,a[e+80|0]=1,C=c[e+68>>2]}c[e+68>>2]=C+1,C=(B=c[e+76>>2])+g(S,152)|0,c[C+140>>2]=o,c[C+148>>2]=i,c[C+144>>2]=n,d=A[r+84>>2],A[C+104>>2]=d,c[C+96>>2]=0,c[C+100>>2]=0,F=c[e+16>>2],e=c[240+(F+g(n,244)|0)>>2],o=c[240+(F+g(i,244)|0)>>2],c[C+132>>2]=0,e?(E=c[t+4>>2],c[C+16>>2]=c[t>>2],c[C+20>>2]=E,v=c[4+(m=t+8|0)>>2],c[(E=C+24|0)>>2]=c[m>>2],c[E+4>>2]=v,w=A[s>>2],T=A[s+4>>2],P=A[s+8>>2],c[C+12>>2]=0,J=A[E>>2],K=A[C+20>>2],W=x(x(T*J)-x(P*K)),A[C>>2]=W,$=A[C+16>>2],q=x(x(K*w)-x(T*$)),A[C+8>>2]=q,Y=x(x(P*$)-x(J*w)),A[C+4>>2]=Y,w=A[e+332>>2],T=A[e+328>>2],P=A[e+608>>2],I=A[e+348>>2],D=A[e+340>>2],L=A[e+344>>2],R=A[e+612>>2],U=A[e+364>>2],N=A[e+356>>2],O=A[e+360>>2],X=A[e+604>>2],V=A[e+324>>2],c[C+76>>2]=0,R=x(R*x(x(x(W*N)+x(Y*O))+x(q*U))),A[C+72>>2]=R,D=x(P*x(x(x(W*D)+x(Y*L))+x(q*I))),A[C+68>>2]=D,L=x(X*x(x(x(W*V)+x(Y*T))+x(q*w))),A[C+64>>2]=L):(c[C>>2]=0,c[C+4>>2]=0,c[(E=C+8|0)>>2]=0,c[E+4>>2]=0,c[(E=C+16|0)>>2]=0,c[E+4>>2]=0,c[(E=C+24|0)>>2]=0,c[E+4>>2]=0,c[C+64>>2]=0,c[C+68>>2]=0,c[(C=C+72|0)>>2]=0,c[C+4>>2]=0),o?(w=A[t+4>>2],T=A[t+8>>2],C=B+g(S,152)|0,P=A[t>>2],X=x(-P),A[C+48>>2]=X,c[C+60>>2]=0,ee=x(-T),A[C+56>>2]=ee,te=x(-w),A[C+52>>2]=te,I=A[l+8>>2],O=A[l+4>>2],N=A[l>>2],c[C+44>>2]=0,U=x(x(P*O)-x(w*N)),A[C+40>>2]=U,N=x(x(T*N)-x(P*I)),A[C+36>>2]=N,O=x(x(w*I)-x(T*O)),A[C+32>>2]=O,w=A[o+332>>2],I=A[o+328>>2],P=A[o+608>>2],V=A[o+348>>2],j=A[o+340>>2],G=A[o+344>>2],T=A[o+612>>2],H=A[o+364>>2],Q=A[o+356>>2],Z=A[o+360>>2],y=A[o+604>>2],b=A[o+324>>2],c[C+92>>2]=0,T=x(T*x(x(x(O*Q)+x(N*Z))+x(U*H))),A[C+88>>2]=T,P=x(P*x(x(x(O*j)+x(N*G))+x(U*V))),A[C+84>>2]=P,I=x(y*x(x(x(O*b)+x(N*I))+x(U*w))),A[C+80>>2]=I):(C=B+g(S,152)|0,c[C+80>>2]=0,c[C+84>>2]=0,c[C+32>>2]=0,c[C+36>>2]=0,c[(E=C+88|0)>>2]=0,c[E+4>>2]=0,c[(E=C+40|0)>>2]=0,c[E+4>>2]=0,c[(E=C+48|0)>>2]=0,c[E+4>>2]=0,c[(C=C+56|0)>>2]=0,c[C+4>>2]=0,U=x(0),N=x(0),O=x(0),X=x(0),T=x(0),P=x(0),I=x(0)),V=x(0),C=B+g(S,152)|0,w=_,_=e?(_=A[s+8>>2],j=A[s+4>>2],H=x(x(x(D*_)-x(R*j))*A[t>>2]),G=R,R=A[s>>2],x(A[e+404>>2]+x(x(H+x(x(x(G*R)-x(_*L))*A[t+4>>2]))+x(x(x(j*L)-x(D*R))*A[t+8>>2])))):x(0),T=o?(R=A[l+4>>2],D=A[l+8>>2],L=x(x(x(T*R)-x(P*D))*A[t>>2]),G=T,T=A[l>>2],x(A[o+404>>2]+x(x(L+x(x(x(I*D)-x(G*T))*A[t+4>>2]))+x(x(x(P*T)-x(I*R))*A[t+8>>2])))):x(0),w=x(w/x(_+T)),A[C+108>>2]=w,j=x(0),R=x(0),D=x(0),L=x(0),T=x(0),P=x(0),e&&(e=F+g(n,244)|0,D=x(A[e+176>>2]+A[e+208>>2]),j=x(A[e+184>>2]+A[e+216>>2]),L=A[e+192>>2],P=A[e+200>>2],R=x(A[e+180>>2]+A[e+212>>2]),T=A[e+196>>2]),I=x(0),_=x(0),G=x(0),H=x(0),Q=x(0),o&&(e=F+g(i,244)|0,V=x(A[e+176>>2]+A[e+208>>2]),I=x(A[e+180>>2]+A[e+212>>2]),Q=A[e+192>>2],G=A[e+200>>2],H=A[e+196>>2],_=x(A[e+184>>2]+A[e+216>>2])),Z=x(0),16&p[r+128|0]&&(Z=x(w*x(x(A[u+44>>2]*x(-x(x(x(x(A[r+48>>2]-A[r+32>>2])*A[t>>2])+x(x(A[r+52>>2]-A[r+36>>2])*A[t+4>>2]))+x(x(A[r+56>>2]-A[r+40>>2])*A[t+8>>2]))))/A[u+12>>2]))),e=B+g(S,152)|0,c[e+128>>2]=0,A[e+124>>2]=d,A[e+120>>2]=-d,A[e+116>>2]=f,A[e+112>>2]=x(w*x(h-x(x(x(x(x(D*$)+x(R*K))+x(j*J))+x(x(x(L*W)+x(T*Y))+x(P*q)))+x(x(x(x(V*X)+x(I*te))+x(_*ee))+x(x(x(Q*O)+x(H*N))+x(G*U))))))+Z}function Bn(e,t,n,i,o,a,r){var s,l,_,u,h,f,p,d,m,v=x(0);N=m=N-16|0,v=A[e+52>>2],s=A[e+56>>2],l=A[e+48>>2],c[r+60>>2]=0,A[r+48>>2]=l+x(t*a),A[r+56>>2]=s+x(i*a),A[r+52>>2]=v+x(n*a),i=A[o>>2],_=A[o+4>>2],u=A[o+8>>2],t=(t=x(x(x(i*i)+x(_*_))+x(u*u)))>x(1.1920928955078125e-7)?x(T(t)):x(0),t=(n=x(t*a)>x(.7853981852531433)?x(x(.7853981852531433)/a):t)<x(.0010000000474974513)?x(x(a*x(.5))+x(n*x(x(x(x(a*a)*a)*x(-.02083333395421505))*n))):x(fe(x(x(n*x(.5))*a))/n),Rn(e,m),v=A[4+m>>2],s=A[12+m>>2],n=pe(x(x(n*a)*x(.5))),l=x(i*t),h=A[m>>2],_=x(_*t),u=x(u*t),f=A[8+m>>2],i=x(x(x(x(s*n)-x(l*h))-x(v*_))-x(u*f)),t=x(x(x(x(u*s)+x(n*f))+x(l*v))-x(_*h)),a=x(x(x(x(n*h)+x(l*s))+x(_*f))-x(u*v)),n=x(x(x(u*h)+x(x(_*s)+x(n*v)))-x(l*f)),(v=x(x(i*i)+x(x(t*t)+x(x(a*a)+x(n*n)))))>x(1.1920928955078125e-7)&&(v=x(x(1)/x(T(v))),i=x(i*v),t=x(t*v),n=x(n*v),a=x(a*v),v=x(x(i*i)+x(x(t*t)+x(x(n*n)+x(a*a))))),v>x(1.1920928955078125e-7)?(c[r+12>>2]=0,c[r+44>>2]=0,c[r+28>>2]=0,s=x(x(2)/v),v=x(t*s),l=x(n*v),h=x(a*s),_=x(i*h),A[r+36>>2]=l+_,u=x(a*v),s=x(n*s),f=x(i*s),A[r+32>>2]=u-f,A[r+24>>2]=l-_,l=x(a*s),i=x(i*v),A[r+16>>2]=l+i,A[r+8>>2]=u+f,A[r+4>>2]=l-i,i=x(a*h),n=x(n*s),A[r+40>>2]=x(1)-x(i+n),t=x(t*v),A[r+20>>2]=x(1)-x(i+t),A[r>>2]=x(1)-x(n+t)):(o=c[e+4>>2],c[r>>2]=c[e>>2],c[r+4>>2]=o,d=c[4+(p=e+8|0)>>2],c[(o=r+8|0)>>2]=c[p>>2],c[o+4>>2]=d,o=c[e+20>>2],c[r+16>>2]=c[e+16>>2],c[r+20>>2]=o,d=c[4+(p=e+24|0)>>2],c[(o=r+24|0)>>2]=c[p>>2],c[o+4>>2]=d,o=c[e+36>>2],c[r+32>>2]=c[e+32>>2],c[r+36>>2]=o,o=r+40|0,r=c[4+(e=e+40|0)>>2],c[o>>2]=c[e>>2],c[o+4>>2]=r),N=16+m|0}function kn(e,t){var n,i,o,r,s,l,_=0,u=0,h=0,f=0,d=0,m=0;if(h=u=c[e+4>>2],(0|u)==c[e+8>>2]&&!((0|(s=(h=u)?u<<1:1))<=(0|u))){if(s&&(c[5498]=c[5498]+1,(h=M(g(s,244)+19|0))&&(c[(m=h+19&-16)-4>>2]=h)),1<=(0|u))for(_=64,h=u;d=c[e+12>>2]+_|0,r=c[4+(i=d+-64|0)>>2],c[(n=(f=_+m|0)-64|0)>>2]=c[i>>2],c[4+n>>2]=r,o=c[4+(i=8+i|0)>>2],c[(n=8+n|0)>>2]=c[i>>2],c[4+n>>2]=o,l=c[4+(r=8+(n=d-48|0)|0)>>2],c[(o=8+(i=f-48|0)|0)>>2]=c[r>>2],c[4+o>>2]=l,o=c[4+n>>2],c[i>>2]=c[n>>2],c[4+i>>2]=o,l=c[4+(r=8+(n=d-32|0)|0)>>2],c[(o=8+(i=f-32|0)|0)>>2]=c[r>>2],c[4+o>>2]=l,o=c[4+n>>2],c[i>>2]=c[n>>2],c[4+i>>2]=o,r=c[4+(i=d-16|0)>>2],c[(n=f-16|0)>>2]=c[i>>2],c[4+n>>2]=r,o=c[4+(i=8+i|0)>>2],c[(n=8+n|0)>>2]=c[i>>2],c[4+n>>2]=o,k(f,d,180),_=_+244|0,h=h-1|0;);(h=c[e+12>>2])&&p[e+16|0]&&(c[5499]=c[5499]+1,z(c[h-4>>2])),c[e+12>>2]=m,a[e+16|0]=1,c[e+8>>2]=s,h=c[e+4>>2]}return c[e+4>>2]=h+1,d=c[4+(f=t+8|0)>>2],u=(h=g(u,244))+c[e+12>>2]|0,c[(_=u+8|0)>>2]=c[f>>2],c[_+4>>2]=d,_=c[t+4>>2],c[u>>2]=c[t>>2],c[u+4>>2]=_,d=c[4+(f=t+24|0)>>2],c[(_=u+24|0)>>2]=c[f>>2],c[_+4>>2]=d,_=c[t+20>>2],c[u+16>>2]=c[t+16>>2],c[u+20>>2]=_,_=c[t+36>>2],c[u+32>>2]=c[t+32>>2],c[u+36>>2]=_,d=c[4+(f=t+40|0)>>2],c[(_=u+40|0)>>2]=c[f>>2],c[_+4>>2]=d,_=c[t+52>>2],c[u+48>>2]=c[t+48>>2],c[u+52>>2]=_,d=c[4+(f=t+56|0)>>2],c[(_=u+56|0)>>2]=c[f>>2],c[_+4>>2]=d,k(u- -64|0,t- -64|0,180),h+c[e+12>>2]|0}function Un(e,t,n,i,o,r){e|=0,t|=0,n|=0,i|=0,o|=0,r|=0;var s,l,_,u,h,f,d,m,v,g,y,b,S,C,E,P,w,I,R=x(0),D=0,O=x(0),M=x(0),z=x(0),L=x(0),F=x(0);N=I=N-272|0,z=A[t+52>>2],L=A[n+52>>2],F=A[t+56>>2],h=A[n+56>>2],f=A[t+48>>2],d=A[n+48>>2],In(t,n,112+I|0,48+I|0),c[268+I>>2]=n=0,R=A[48+I>>2],O=x(R*A[120+I>>2]),A[264+I>>2]=O,l=x(R*A[116+I>>2]),A[260+I>>2]=l,R=x(R*A[112+I>>2]),A[256+I>>2]=R,m=A[i+52>>2],v=A[o+52>>2],S=A[i+56>>2],C=A[o+56>>2],g=A[i+48>>2],E=A[o+48>>2],In(i,o,112+I|0,48+I|0),c[252+I>>2]=0,s=A[48+I>>2],_=x(s*A[120+I>>2]),A[248+I>>2]=_,M=x(s*A[116+I>>2]),A[244+I>>2]=M,s=x(s*A[112+I>>2]),A[240+I>>2]=s,o=c[e+12>>2],R=x(x(pi[c[c[o>>2]+16>>2]](o))*x(T(x(x(x(R*R)+x(l*l))+x(O*O))))),o=c[e+16>>2],O=x(o?pi[c[c[o>>2]+16>>2]](o):0),y=x(R+x(O*x(T(x(x(x(s*s)+x(M*M))+x(_*_)))))),g=x(E-g),f=x(d-f),l=x(g-f),d=x(v-m),m=x(L-z),s=x(d-m),v=x(C-S),h=x(h-F),_=x(v-h);e:if(x(y+x(T(x(x(x(l*l)+x(s*s))+x(_*_)))))!=x(0)&&(a[216+I|0]=0,c[212+I>>2]=1566444395,c[176+I>>2]=12428,Gn(e,t,i,176+I|0),D=c[4+(u=204+I|0)>>2],c[(o=232+I|0)>>2]=c[u>>2],c[o+4>>2]=D,o=c[200+I>>2],c[224+I>>2]=c[196+I>>2],c[228+I>>2]=o,p[216+I|0]&&(M=A[180+I>>2],z=A[184+I>>2],L=A[188+I>>2],!(x(y+x(x(x(l*M)+x(s*z))+x(_*L)))<=x(1.1920928955078125e-7))))){n=1;t:{if((F=x(A[212+I>>2]+A[r+172>>2]))>x(.0010000000474974513)){for(u=20+I|0,P=160+I|0,O=x(o=0);;){if((D=c[r+168>>2])&&(c[120+I>>2]=1065353216,c[124+I>>2]=0,c[112+I>>2]=1065353216,c[116+I>>2]=1065353216,pi[c[c[D>>2]+28>>2]](D,224+I|0,x(.20000000298023224),112+I|0)),(R=x(y+x(x(x(l*M)+x(s*z))+x(_*L))))<=x(1.1920928955078125e-7)){n=0;break e}if((R=x(O+x(F/R)))<=O){n=0;break e}if(R>x(1)){n=0;break e}if(R<x(0)){n=0;break e}if(Bn(t,f,m,h,256+I|0,R,112+I|0),Bn(i,g,d,v,240+I|0,R,48+I|0),(D=c[r+168>>2])&&(c[8+I>>2]=0,c[12+I>>2]=0,c[I>>2]=1065353216,c[4+I>>2]=0,pi[c[c[D>>2]+28>>2]](D,P,x(.20000000298023224),I)),pi[c[c[r>>2]>>2]](r,R),a[40+I|0]=0,c[36+I>>2]=1566444395,c[I>>2]=12428,Gn(e,112+I|0,48+I|0,I),!p[40+I|0])break t;if(w=c[4+(b=8+u|0)>>2],c[(D=232+I|0)>>2]=c[b>>2],c[D+4>>2]=w,D=c[4+u>>2],c[224+I>>2]=c[u>>2],c[228+I>>2]=D,64==(0|o)){pi[c[c[r>>2]+8>>2]](r,-2,65),n=0;break e}if(o=o+1|0,M=A[4+I>>2],z=A[8+I>>2],L=A[12+I>>2],O=R,!((F=x(A[36+I>>2]+A[r+172>>2]))>x(.0010000000474974513)))break}O=A[16+I>>2]}else R=x(0),O=A[192+I>>2];A[r+132>>2]=M,A[r+164>>2]=R,e=c[228+I>>2],c[r+148>>2]=c[224+I>>2],c[r+152>>2]=e,A[r+144>>2]=O,A[r+140>>2]=L,A[r+136>>2]=z,i=c[4+(t=232+I|0)>>2],c[(e=r+156|0)>>2]=c[t>>2],c[e+4>>2]=i;break e}pi[c[c[r>>2]+8>>2]](r,-1,o),n=0}return N=272+I|0,0|n}function Gn(e,t,n,i){var o,r,s,l,_,u,h,f,d,m,v,g,y,b,S,C,E,T,P,w,I,R,D,M,z,L,F,B,k,U,G,j,V,H,W,q=0,Y=0,X=x(0),Q=x(0),Z=0,J=0,K=0;N=W=N-240|0,c[e+16>>2]?(q=c[e+4>>2],a[q+312|0]=0,a[q+356|0]=1,c[q>>2]=0,c[q+292>>2]=1566444395,c[q+296>>2]=1566444395,c[(Y=q+336|0)>>2]=0,c[Y+4>>2]=0,c[(Y=q+300|0)>>2]=1566444395,c[Y+4>>2]=0,c[(Y=q+344|0)>>2]=0,c[Y+4>>2]=0,a[q+352|0]=0,a[0|(q=q+332|0)]=240&p[0|q],q=c[e+12>>2],Y=c[q+4>>2],J=c[e+16>>2],K=c[J+4>>2],Q=x(pi[c[c[q>>2]+48>>2]](q)),Z=c[e+16>>2],X=x(pi[c[c[Z>>2]+48>>2]](Z)),c[(Z=172+W|0)>>2]=0,c[Z+4>>2]=0,c[232+W>>2]=1,c[236+W>>2]=1,c[220+W>>2]=-1,a[212+W|0]=0,A[208+W>>2]=X,A[204+W>>2]=Q,c[200+W>>2]=K,c[196+W>>2]=Y,c[192+W>>2]=J,c[188+W>>2]=q,c[164+W>>2]=0,c[168+W>>2]=1065353216,c[160+W>>2]=12272,O=c[e+4>>2],c[180+W>>2]=c[e+8>>2],c[184+W>>2]=O,q=c[4+(e=t+8|0)>>2],c[(Y=32+W|0)>>2]=c[e>>2],c[Y+4>>2]=q,q=c[4+(e=t+24|0)>>2],c[(Y=48+W|0)>>2]=c[e>>2],c[Y+4>>2]=q,q=c[4+(e=t+40|0)>>2],c[(Y=W+64|0)>>2]=c[e>>2],c[Y+4>>2]=q,q=c[4+(e=t+56|0)>>2],c[(Y=80+W|0)>>2]=c[e>>2],c[Y+4>>2]=q,q=c[4+(e=n+8|0)>>2],c[(Y=96+W|0)>>2]=c[e>>2],c[Y+4>>2]=q,c[152+W>>2]=1566444395,e=c[t+4>>2],c[24+W>>2]=c[t>>2],c[28+W>>2]=e,e=c[t+20>>2],c[40+W>>2]=c[t+16>>2],c[44+W>>2]=e,e=c[t+36>>2],c[56+W>>2]=c[t+32>>2],c[60+W>>2]=e,e=c[t+52>>2],c[72+W>>2]=c[t+48>>2],c[76+W>>2]=e,e=c[n+4>>2],c[88+W>>2]=c[n>>2],c[92+W>>2]=e,t=c[4+(e=n+24|0)>>2],c[(q=112+W|0)>>2]=c[e>>2],c[q+4>>2]=t,e=c[n+20>>2],c[(t=104+W|0)>>2]=c[n+16>>2],c[t+4>>2]=e,e=c[n+36>>2],c[(t=120+W|0)>>2]=c[n+32>>2],c[t+4>>2]=e,t=c[4+(e=n+40|0)>>2],c[(q=128+W|0)>>2]=c[e>>2],c[q+4>>2]=t,e=c[n+52>>2],c[(t=136+W|0)>>2]=c[n+48>>2],c[t+4>>2]=e,t=c[4+(e=n+56|0)>>2],c[(n=144+W|0)>>2]=c[e>>2],c[n+4>>2]=t,Gt(160+W|0,24+W|0,i,0,0)):(V=A[(Y=n+52|0)>>2],S=A[(J=n+56|0)>>2],C=A[t+52>>2],R=A[t+56>>2],u=A[t+20>>2],h=A[t+36>>2],Q=A[(K=n+20|0)>>2],X=A[(Z=n+36|0)>>2],o=A[(z=n+24|0)>>2],r=A[t+24>>2],s=A[(L=n+40|0)>>2],v=A[t+40>>2],D=A[n+48>>2],M=A[t+48>>2],q=c[e+12>>2],g=A[t+32>>2],y=A[t>>2],E=A[t+16>>2],T=A[t+4>>2],_=A[n+32>>2],l=A[n+16>>2],f=A[n>>2],d=A[n+4>>2],e=c[e+20>>2],m=A[n+8>>2],P=A[t+8>>2],c[172+W>>2]=0,F=x(x(x(P*d)+x(r*Q))+x(v*X)),w=x(-A[(t=e+60|0)>>2]),B=x(x(x(P*f)+x(r*l))+x(v*_)),I=A[e+56>>2],P=x(x(x(P*m)+x(r*o))+x(v*s)),r=A[(k=e- -64|0)>>2],A[168+W>>2]=x(x(F*w)-x(B*I))-x(P*r),U=x(x(x(T*d)+x(u*Q))+x(h*X)),G=x(x(x(T*f)+x(u*l))+x(h*_)),T=x(x(x(T*m)+x(u*o))+x(h*s)),A[164+W>>2]=x(x(U*w)-x(I*G))-x(r*T),j=x(x(x(y*d)+x(E*Q))+x(g*X)),b=x(j*w),w=x(x(x(y*f)+x(E*l))+x(g*_)),E=x(x(x(y*m)+x(E*o))+x(g*s)),A[160+W>>2]=x(b-x(I*w))-x(r*E),pi[c[c[q>>2]+64>>2]](24+W|0,q,160+W|0),u=A[t>>2],h=A[k>>2],I=A[e+72>>2],r=A[e+56>>2],v=A[24+W>>2],g=A[28+W>>2],y=A[32+W>>2],c[172+W>>2]=0,H=x(x(x(M*f)+x(C*l))+x(R*_)),b=l,l=x(-V),_=x(x(H+x(x(x(b*l)-x(f*D))-x(_*S)))+x(x(x(w*v)+x(G*g))+x(B*y))),s=x(x(x(x(x(M*m)+x(C*o))+x(R*s))+x(x(x(o*l)-x(m*D))-x(s*S)))+x(x(x(E*v)+x(T*g))+x(P*y))),o=x(x(x(x(x(M*d)+x(C*Q))+x(R*X))+x(x(x(Q*l)-x(d*D))-x(X*S)))+x(x(x(j*v)+x(U*g))+x(F*y))),Q=x(x(x(h*s)+x(x(r*_)+x(u*o)))-I),X=x(_-x(r*Q)),_=A[n+32>>2],o=x(o-x(u*Q)),l=A[Z>>2],s=x(s-x(h*Q)),f=A[L>>2],A[168+W>>2]=x(x(x(X*_)+x(o*l))+x(s*f))+A[J>>2],d=A[n+16>>2],m=A[K>>2],S=A[z>>2],A[164+W>>2]=x(x(x(X*d)+x(o*m))+x(s*S))+A[Y>>2],C=A[n>>2],b=x(C*X),X=A[n+4>>2],b=x(b+x(o*X)),o=A[n+8>>2],A[160+W>>2]=x(b+x(s*o))+A[n+48>>2],c[20+W>>2]=0,A[16+W>>2]=x(x(r*_)+x(u*l))+x(h*f),A[12+W>>2]=x(x(r*d)+x(u*m))+x(h*S),A[8+W>>2]=x(x(r*C)+x(u*X))+x(h*o),pi[c[c[i>>2]+16>>2]](i,8+W|0,160+W|0,Q)),N=240+W|0}function jn(e){var t,n,i=0,o=0,r=0;if(c[(e|=0)>>2]=17524,1<=(0|(i=c[e+8>>2])))for(;n=c[c[e+16>>2]+o>>2],(t=c[n+188>>2])&&(i=c[e+68>>2],i=0|pi[c[c[i>>2]+36>>2]](i),pi[c[c[i>>2]+40>>2]](i,t,c[e+24>>2]),i=c[e+68>>2],pi[c[c[i>>2]+12>>2]](i,t,c[e+24>>2]),c[n+188>>2]=0,i=c[e+8>>2]),o=o+4|0,(0|(r=r+1|0))<(0|i););return(i=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+16>>2]=0,c[e+8>>2]=0,c[e+12>>2]=0,a[e+20|0]=1,0|e}function Vn(e){e|=0;var t,n,i,o,r,s,l,_=0,u=0,h=0,f=0,d=0,m=x(0),v=0,g=0,y=0,b=0,S=0;if(N=l=N-192|0,0|pi[c[c[e>>2]+20>>2]](e)){if(u=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[u>>2]+100>>2]](u),u=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[u>>2]+8>>2]](80+l|0,u),u=0|pi[c[c[e>>2]+20>>2]](e),8&pi[c[c[u>>2]+56>>2]](u)&&(u=c[e+24>>2])&&!((0|(g=0|pi[c[c[u>>2]+36>>2]](u)))<1))for(b=176+l|0,u=0;;){if(f=c[e+24>>2],f=0|pi[c[c[f>>2]+40>>2]](f,u),1<=(0|(v=c[f+844>>2])))for(f=f+168|0;y=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[y>>2]+40>>2]](y,f-132|0,f-100|0,A[f-84>>2],c[f>>2],b),f=f+208|0,v=v-1|0;);if((0|g)==(0|(u=u+1|0)))break}if(u=0|pi[c[c[e>>2]+20>>2]](e),3&pi[c[c[u>>2]+56>>2]](u)&&!(c[e+8>>2]<1))for(v=160+l|0,g=96+l|0,b=112+l|0,y=128+l|0,t=144+l|0,f=0;;){if(u=c[c[e+16>>2]+f>>2],!(32&p[u+204|0])){if(0|pi[c[c[e>>2]+20>>2]](e)&&(_=0|pi[c[c[e>>2]+20>>2]](e),1&pi[c[c[_>>2]+56>>2]](_))){e:{switch(c[u+220>>2]-1|0){case 0:d=c[4+(h=88+l|0)>>2],c[(_=72+l|0)>>2]=c[h>>2],c[_+4>>2]=d,_=c[84+l>>2],c[64+l>>2]=c[80+l>>2],c[68+l>>2]=_;break e;case 1:d=c[4+(h=g+8|0)>>2],c[(_=72+l|0)>>2]=c[h>>2],c[_+4>>2]=d,_=c[g+4>>2],c[64+l>>2]=c[g>>2],c[68+l>>2]=_;break e;case 2:d=c[4+(h=b+8|0)>>2],c[(_=72+l|0)>>2]=c[h>>2],c[_+4>>2]=d,_=c[b+4>>2],c[64+l>>2]=c[b>>2],c[68+l>>2]=_;break e;case 3:d=c[4+(h=y+8|0)>>2],c[(_=72+l|0)>>2]=c[h>>2],c[_+4>>2]=d,_=c[y+4>>2],c[64+l>>2]=c[y>>2],c[68+l>>2]=_;break e;case 4:d=c[4+(h=8+t|0)>>2],c[(_=72+l|0)>>2]=c[h>>2],c[_+4>>2]=d,_=c[4+t>>2],c[64+l>>2]=c[t>>2],c[68+l>>2]=_;break e}c[72+l>>2]=1050253722,c[76+l>>2]=0,c[64+l>>2]=1050253722,c[68+l>>2]=1050253722}1&a[u+205|0]&&(d=c[4+(h=u+316|0)>>2],c[(_=72+l|0)>>2]=c[h>>2],c[_+4>>2]=d,_=c[u+312>>2],c[64+l>>2]=c[u+308>>2],c[68+l>>2]=_),pi[c[c[e>>2]+28>>2]](e,u+4|0,c[u+192>>2],l+64|0)}(_=c[e+72>>2])&&2&pi[c[c[_>>2]+56>>2]](_)&&(d=c[4+(h=v+8|0)>>2],c[(_=40+l|0)>>2]=c[h>>2],c[_+4>>2]=d,_=c[v+4>>2],c[32+l>>2]=c[v>>2],c[36+l>>2]=_,_=c[u+192>>2],pi[c[c[_>>2]+8>>2]](_,u+4|0,l+64|0,48+l|0),A[64+l>>2]=A[64+l>>2]+x(-.019999999552965164),A[68+l>>2]=A[68+l>>2]+x(-.019999999552965164),A[72+l>>2]=A[72+l>>2]+x(-.019999999552965164),A[48+l>>2]=A[48+l>>2]+x(.019999999552965164),A[52+l>>2]=A[52+l>>2]+x(.019999999552965164),A[56+l>>2]=A[56+l>>2]+x(.019999999552965164),p[e+44|0]&&2==c[u+252>>2]&&(3&p[u+204|0]||(_=c[u+192>>2],pi[c[c[_>>2]+8>>2]](_,u+68|0,16+l|0,l),m=x(A[16+l>>2]+x(-.019999999552965164)),A[16+l>>2]=m,n=x(A[20+l>>2]+x(-.019999999552965164)),A[20+l>>2]=n,i=x(A[24+l>>2]+x(-.019999999552965164)),A[24+l>>2]=i,o=x(A[l>>2]+x(.019999999552965164)),A[l>>2]=o,r=x(A[4+l>>2]+x(.019999999552965164)),A[4+l>>2]=r,s=x(A[8+l>>2]+x(.019999999552965164)),A[8+l>>2]=s,m<A[64+l>>2]&&(A[64+l>>2]=m),A[68+l>>2]>n&&(A[68+l>>2]=n),A[72+l>>2]>i&&(A[72+l>>2]=i),(m=A[28+l>>2])<A[76+l>>2]&&(A[76+l>>2]=m),A[48+l>>2]<o&&(A[48+l>>2]=o),A[52+l>>2]<r&&(A[52+l>>2]=r),A[56+l>>2]<s&&(A[56+l>>2]=s),(m=A[12+l>>2])>A[60+l>>2]&&(A[60+l>>2]=m))),u=c[e+72>>2],pi[c[c[u>>2]+60>>2]](u,l+64|0,48+l|0,32+l|0))}if(f=f+4|0,!((0|(S=S+1|0))<c[e+8>>2]))break}}N=192+l|0}function Hn(e,t,n,i){t|=0,n|=0,i|=0;var o,r,s=0,l=0,_=0,u=0,h=0,f=N-96|0;if(N=f,s=c[8+(e|=0)>>2],c[t+216>>2]=s,c[e+12>>2]==(0|s)&&!((0|(_=s?s<<1:1))<=(0|s))){if(_&&(c[5498]=c[5498]+1,(l=M(19+(_<<2)|0))&&(c[(u=l+19&-16)-4>>2]=l)),1<=(0|s))for(l=s;c[h+u>>2]=c[c[e+16>>2]+h>>2],h=h+4|0,l=l-1|0;);(l=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[l-4>>2]),s=c[e+8>>2]),c[e+16>>2]=u,c[e+12>>2]=_,a[e+20|0]=1}c[e+8>>2]=s+1,c[c[e+16>>2]+(s<<2)>>2]=t,_=c[4+(l=t+12|0)>>2],c[(s=40+f|0)>>2]=c[l>>2],c[s+4>>2]=_,_=c[4+(l=t+28|0)>>2],c[(s=56+f|0)>>2]=c[l>>2],c[s+4>>2]=_,_=c[4+(l=t+44|0)>>2],c[(s=72+f|0)>>2]=c[l>>2],c[s+4>>2]=_,_=c[4+(l=t+60|0)>>2],c[(s=88+f|0)>>2]=c[l>>2],c[s+4>>2]=_,s=c[t+8>>2],c[32+f>>2]=c[t+4>>2],c[36+f>>2]=s,l=c[4+(s=t+20|0)>>2],c[48+f>>2]=c[s>>2],c[52+f>>2]=l,l=c[4+(s=t+36|0)>>2],c[64+f>>2]=c[s>>2],c[68+f>>2]=l,l=c[4+(s=t+52|0)>>2],c[80+f>>2]=c[s>>2],c[84+f>>2]=l,s=c[t+192>>2],pi[c[c[s>>2]+8>>2]](s,32+f|0,16+f|0,f),s=c[e+68>>2],r=0|pi[c[c[s>>2]+8>>2]](s,16+f|0,f,c[c[(o=t)+192>>2]+4>>2],t,n,i,c[e+24>>2]),c[o+188>>2]=r,N=96+f|0}function Wn(e,t){e|=0;var n,i,o=0,a=0,r=0,s=0,l=0;(a=c[188+(t|=0)>>2])&&(o=c[e+68>>2],o=0|pi[c[c[o>>2]+36>>2]](o),pi[c[c[o>>2]+40>>2]](o,a,c[e+24>>2]),o=c[e+68>>2],pi[c[c[o>>2]+12>>2]](o,a,c[e+24>>2]),c[t+188>>2]=0),a=c[e+8>>2];e:if((0|(o=c[t+216>>2]))<0||(0|a)<=(0|o)){if(!((0|a)<1)){for(o=l=c[e+16>>2];c[o>>2]!=(0|t);)if(o=o+4|0,(0|a)==(0|(s=s+1|0)))break e;(0|a)<=(0|s)||(c[(r=o)>>2]=c[(o=(a=a-1|0)<<2)+l>>2],c[e+8>>2]=a,c[o+c[e+16>>2]>>2]=t)}}else r=c[(l=e+16|0)>>2],i=c[(n=(s=o<<2)+r|0)>>2],c[n>>2]=c[r+(r=(a=a-1|0)<<2)>>2],c[e+8>>2]=a,c[r+c[l>>2]>>2]=i,(0|a)<=(0|o)||(c[c[c[e+16>>2]+s>>2]+216>>2]=o);c[t+216>>2]=-1}function qn(e,t){var n,i,o,a=0,r=0,s=0,l=0,_=0,u=0,h=0,f=0,p=0,d=0,m=0,A=0,v=0,x=0,y=0,b=0,S=0,C=0,E=0,T=0;if(!((0|(r=c[e+8>>2]))<1)){for(;;){n=c[c[c[e+16>>2]+(C<<2)>>2]+192>>2],a=g((a=n+(n<<15^-1)|0)>>>10^a,9);e:{t:if(!(a=A>>>0<=(h=(i=(a=((a^=a>>>6)<<11^-1)+a|0)>>>16^a)&f-1)>>>0)&&-1!=(0|(s=c[(h<<2)+d>>2]))){for(;c[(s<<3)+l>>2]!=(0|n);)if(-1==(0|(s=c[(s<<2)+_>>2])))break t;if(p)break e}t:{n:{if(!a&&-1!=(0|(s=c[(h<<2)+d>>2])))for(;;){if(c[(s<<3)+l>>2]==(0|n))break n;if(-1==(0|(s=c[(s<<2)+_>>2])))break}if((0|f)==(0|S)){i:if((0|(a=f?f<<1:1))<=(0|f))a=f,x=p;else{if(x=0,a&&(c[5498]=c[5498]+1,(r=M(19+(a<<2)|0))&&(c[(x=r+19&-16)-4>>2]=r)),1<=(0|f))for(s=x,r=p,u=f;c[s>>2]=c[r>>2],s=s+4|0,r=r+4|0,u=u-1|0;);else if(!p)break i;c[5499]=c[5499]+1,z(c[p-4>>2])}r=f}else a=f,x=p,r=S;c[((p=r)<<2)+x>>2]=n;i:if((0|m)==(0|y))if((0|(y=m?m<<1:1))<=(0|m))y=m,v=l;else{if(v=0,y&&(c[5498]=c[5498]+1,(r=M(19+(y<<3)|0))&&(c[(v=r+19&-16)-4>>2]=r)),1<=(0|m))for(s=v,r=l,u=m;o=c[r+4>>2],c[s>>2]=c[r>>2],c[s+4>>2]=o,s=s+8|0,r=r+8|0,u=u-1|0;);else if(!l)break i;c[5499]=c[5499]+1,z(c[l-4>>2])}else v=l;if(c[(m<<3)+v>>2]=n,(0|f)<(0|a)){if((0|A)<(0|a)){if((0|a)<=(0|E))u=d;else{u=0,a&&(c[5498]=c[5498]+1,(l=M(19+(a<<2)|0))&&(c[(u=l+19&-16)-4>>2]=l));i:{if(1<=(0|A))for(s=u,r=d,l=A;c[s>>2]=c[r>>2],s=s+4|0,r=r+4|0,l=l-1|0;);else if(!d)break i;c[5499]=c[5499]+1,z(c[d-4>>2])}E=a}if(B((A<<2)+u|0,0,a-A<<2),f=a<<2,(0|a)<=(0|b))h=_;else{if((0|a)<=(0|T))h=_;else{h=0,a&&(c[5498]=c[5498]+1,(l=M(16+(3|f)|0))&&(c[(h=l+19&-16)-4>>2]=l));i:{if(1<=(0|b))for(s=h,r=_,l=b;c[s>>2]=c[r>>2],s=s+4|0,r=r+4|0,l=l-1|0;);else if(!_)break i;c[5499]=c[5499]+1,z(c[_-4>>2])}T=a}B((b<<2)+h|0,0,a-b<<2)}if(1<=(0|a)&&(B(u,255,f),B(h,255,f)),1<=(0|A))for(f=a-1|0,s=0,r=v,l=h;_=c[r>>2],_=g((_=(_<<15^-1)+_|0)>>>10^_,9),_^=_>>>6,c[l>>2]=c[(_=((f&((_=(_<<11^-1)+_|0)>>>16^_))<<2)+u|0)>>2],r=r+8|0,l=l+4|0,(0|A)!=(0|(s=(c[_>>2]=s)+1|0)););d=u,A=b=a,_=h}h=a-1&i}m=m+1|0,c[(S<<2)+_>>2]=c[(l=(h<<2)+d|0)>>2],c[l>>2]=S,f=a,S=p+1|0,p=x,l=v;break t}c[(s<<2)+p>>2]=n}pi[c[c[n>>2]+60>>2]](n,t),r=c[e+8>>2]}if(!((0|(C=C+1|0))<(0|r)))break}if(1<=(0|r))for(u=s=0;a=c[c[e+16>>2]+s>>2],1!=(0|(h=c[a+252>>2]))&&64!=(0|h)||(pi[c[c[a>>2]+24>>2]](a,t),r=c[e+8>>2]),s=s+4|0,(0|(u=u+1|0))<(0|r););l&&(c[5499]=c[5499]+1,z(c[l-4>>2])),p&&(c[5499]=c[5499]+1,z(c[p-4>>2])),_&&(c[5499]=c[5499]+1,z(c[_-4>>2])),d&&(c[5499]=c[5499]+1,z(c[d-4>>2]))}}function Yn(e,t,n,i){var o,r,s,l,_,u,h,f,d,m,v,g,y=0,b=x(0),S=x(0),C=x(0),E=x(0),P=0,w=0,I=x(0),R=x(0),D=x(0),O=x(0),L=x(0),F=x(0),k=x(0),U=x(0),G=0,j=x(0),V=x(0),H=x(0),W=x(0),q=0,Y=x(0),X=x(0),Q=x(0),Z=x(0),J=0,K=x(0),$=0;c[(y=264+(N=g=N-832|0)|0)>>2]=0,c[y+4>>2]=0,c[(y=272+g|0)>>2]=0,c[y+4>>2]=0,c[(y=280+g|0)>>2]=0,c[y+4>>2]=0,c[288+g>>2]=0,c[260+g>>2]=1065353216,c[252+g>>2]=1065353216,c[256+g>>2]=1065353216,c[236+g>>2]=8,c[240+g>>2]=0,c[244+g>>2]=0,c[248+g>>2]=0,c[232+g>>2]=11936,y=c[n+12>>2];e:if(w=c[n+4>>2],(0|(P=c[w+4>>2]))<=19)c[216+g>>2]=0,c[220+g>>2]=0,c[48+g>>2]=12640,A[212+g>>2]=A[i+4>>2],a[652+g|0]=0,c[628+g>>2]=953267991,c[308+g>>2]=w,c[296+g>>2]=13256,c[304+g>>2]=232+g,c[300+g>>2]=320+g,c[32+g>>2]=12396,c[44+g>>2]=w,P=8&c[i+16>>2]?32+g|0:296+g|0,w=c[P>>2],c[40+g>>2]=232+g,w=c[w+8>>2],c[36+g>>2]=320+g,0|pi[0|w](P,e,t,y,y,48+g|0)&&(C=A[180+g>>2],b=A[184+g>>2],S=A[188+g>>2],(D=x(x(x(C*C)+x(b*b))+x(S*S)))>x(9999999747378752e-20)&&(I=A[212+g>>2])<A[i+4>>2]&&(Y=S,S=x(x(1)/x(T(D))),A[188+g>>2]=Y*S,A[184+g>>2]=b*S,A[180+g>>2]=C*S,P=c[4+(y=8+(e=180+g|0)|0)>>2],c[(t=16+g|0)>>2]=c[y>>2],c[t+4>>2]=P,A[24+g>>2]=I,t=c[e+4>>2],c[8+g>>2]=c[e>>2],c[12+g>>2]=t,c[4+g>>2]=0,c[g>>2]=c[n+8>>2],x(pi[c[c[i>>2]+12>>2]](i,g,1))));else if(P-21>>>0<=8)b=A[y+20>>2],S=A[y+36>>2],C=A[(P=y+24|0)>>2],D=A[y+52>>2],E=A[(q=y+56|0)>>2],R=A[(G=y+40|0)>>2],O=A[y+32>>2],U=A[y+16>>2],j=A[y>>2],V=A[y+4>>2],F=A[y+48>>2],L=A[y+8>>2],c[308+g>>2]=0,k=x(-D),Q=x(x(x(C*k)-x(L*F))-x(R*E)),W=A[e+48>>2],H=A[e+52>>2],X=A[e+56>>2],D=x(Q+x(x(x(L*W)+x(C*H))+x(R*X))),A[304+g>>2]=D,Z=x(x(x(b*k)-x(V*F))-x(S*E)),I=x(Z+x(x(x(V*W)+x(b*H))+x(S*X))),A[300+g>>2]=I,k=x(x(x(U*k)-x(j*F))-x(O*E)),E=x(k+x(x(x(j*W)+x(U*H))+x(O*X))),A[296+g>>2]=E,F=A[t+48>>2],H=x(L*F),L=A[t+52>>2],Y=R,R=A[t+56>>2],C=x(Q+x(x(H+x(C*L))+x(Y*R))),b=x(Z+x(x(x(V*F)+x(b*L))+x(S*R))),S=x(k+x(x(x(j*F)+x(U*L))+x(O*R))),21!=c[w+4>>2]?(c[352+g>>2]=0,A[348+g>>2]=C,A[344+g>>2]=b,c[336+g>>2]=0,A[332+g>>2]=D,A[328+g>>2]=I,c[360+g>>2]=1065353216,A[324+g>>2]=E,c[372+g>>2]=w,c[320+g>>2]=17624,c[368+g>>2]=c[n+8>>2],c[364+g>>2]=i,c[356+g>>2]=c[i+16>>2],A[340+g>>2]=S,n=c[4+(t=y+8|0)>>2],c[(e=384+g|0)>>2]=c[t>>2],c[e+4>>2]=n,e=c[y+4>>2],c[376+g>>2]=c[y>>2],c[380+g>>2]=e,t=c[P+4>>2],c[(e=400+g|0)>>2]=c[P>>2],c[e+4>>2]=t,t=c[y+20>>2],c[(e=392+g|0)>>2]=c[y+16>>2],c[e+4>>2]=t,t=c[y+36>>2],c[(e=408+g|0)>>2]=c[y+32>>2],c[e+4>>2]=t,t=c[G+4>>2],c[(e=416+g|0)>>2]=c[G>>2],c[e+4>>2]=t,t=c[y+52>>2],c[(e=424+g|0)>>2]=c[y+48>>2],c[e+4>>2]=t,t=c[q+4>>2],c[(e=432+g|0)>>2]=c[q>>2],c[e+4>>2]=t,A[360+g>>2]=A[i+4>>2],c[60+g>>2]=0,A[56+g>>2]=D,A[52+g>>2]=I,S<(A[48+g>>2]=E)&&(A[48+g>>2]=S),b<I&&(A[52+g>>2]=b),C<D&&(A[56+g>>2]=C),c[12+g>>2]=0,A[8+g>>2]=D,A[4+g>>2]=I,(A[g>>2]=E)<S&&(A[g>>2]=S),I<b&&(A[4+g>>2]=b),D<C&&(A[8+g>>2]=C),pi[c[c[w>>2]+64>>2]](w,320+g|0,48+g|0,g)):(c[352+g>>2]=0,A[348+g>>2]=C,A[344+g>>2]=b,J=c[4+(t=304+g|0)>>2],c[(e=332+g|0)>>2]=c[t>>2],c[e+4>>2]=J,e=c[300+g>>2],c[324+g>>2]=c[296+g>>2],c[328+g>>2]=e,c[360+g>>2]=1065353216,A[340+g>>2]=S,c[320+g>>2]=17624,c[368+g>>2]=c[n+8>>2],c[364+g>>2]=i,c[356+g>>2]=c[i+16>>2],c[372+g>>2]=w,n=c[4+(t=y+8|0)>>2],c[(e=384+g|0)>>2]=c[t>>2],c[e+4>>2]=n,e=c[y+4>>2],c[376+g>>2]=c[y>>2],c[380+g>>2]=e,t=c[P+4>>2],c[(e=400+g|0)>>2]=c[P>>2],c[e+4>>2]=t,t=c[y+20>>2],c[(e=392+g|0)>>2]=c[y+16>>2],c[e+4>>2]=t,t=c[y+36>>2],c[(e=408+g|0)>>2]=c[y+32>>2],c[e+4>>2]=t,t=c[G+4>>2],c[(e=416+g|0)>>2]=c[G>>2],c[e+4>>2]=t,t=c[y+52>>2],c[(e=424+g|0)>>2]=c[y+48>>2],c[e+4>>2]=t,t=c[q+4>>2],c[(e=432+g|0)>>2]=c[q>>2],c[e+4>>2]=t,A[360+g>>2]=A[i+4>>2],c[32+g>>2]=10956,c[36+g>>2]=c[w+56>>2],c[40+g>>2]=320+g,e=c[w+60>>2],c[(t=56+g|0)>>2]=0,c[t+4>>2]=0,c[48+g>>2]=0,c[52+g>>2]=0,c[(t=8+g|0)>>2]=0,c[t+4>>2]=0,c[g>>2]=0,c[4+g>>2]=0,p[e+60|0]?Tt(e,32+g|0,296+g|0,S,b,C,48+g|0,g,c[e+56>>2]):Et(e,32+g|0,296+g|0,S,b,C,48+g|0,g));else if(31==(0|P))if(P=c[w+72>>2],c[24+g>>2]=i,c[20+g>>2]=t,c[16+g>>2]=e,c[12+g>>2]=y,c[8+g>>2]=w,c[g>>2]=17648,c[4+g>>2]=c[n+8>>2],P){if(n=c[P>>2]){for(C=A[y+56>>2],H=A[e+56>>2],b=A[y+40>>2],S=A[y+52>>2],X=A[e+52>>2],D=A[y+24>>2],I=A[y+48>>2],Q=A[e+48>>2],E=A[y+8>>2],R=A[y+36>>2],O=A[y+20>>2],U=A[y+4>>2],j=A[y+32>>2],V=A[y+16>>2],F=A[y>>2],L=A[t+56>>2],k=A[t+52>>2],W=A[t+48>>2],c[320+g>>2]=n,L=x(L-C),k=x(k-S),W=x(W-I),K=x(x(b*L)+x(x(D*k)+x(E*W))),I=x(Q-I),S=x(X-S),Y=b,b=x(H-C),D=x(x(x(E*I)+x(D*S))+x(Y*b)),H=E=x(K-D),Y=x(x(j*L)+x(x(V*k)+x(W*F))),j=x(x(x(I*F)+x(S*V))+x(b*j)),C=x(Y-j),I=x(x(x(I*U)+x(S*O))+x(b*R)),b=x(x(x(R*L)+x(x(O*k)+x(W*U)))-I),E=x(x(1)/x(T(x(x(x(C*C)+x(b*b))+x(E*E))))),S=x(H*E),C=x((R=C)*E),b=x((Y=b)*E),F=x(x(H*S)+x(x(R*C)+x(Y*b))),l=(48+g|0)+((e=(S=S==x(0)?x(0xde0b6b000000000):x(x(1)/S))<x(0))<<4)|8,_=(48+g|0)+((t=(b=b==x(0)?x(0xde0b6b000000000):x(x(1)/b))<x(0))<<4)|4,u=(48+g|0)+(!e<<4)|8,h=(48+g|0)+(!t<<4)|4,f=(48+g|0)+((e=(C=C==x(0)?x(0xde0b6b000000000):x(x(1)/C))<x(0))<<4)|0,d=(48+g|0)+(!e<<4)|0,J=g+64|0,q=126,e=320+g|0,t=n=128,w=1;;){if(G=c[(s=(i=w-1|0)<<2)+e>>2],P=c[(y=G)+20>>2],c[J>>2]=c[y+16>>2],c[J+4>>2]=P,m=c[4+(y=y+24|0)>>2],c[(P=J+8|0)>>2]=c[y>>2],c[P+4>>2]=m,y=c[G+4>>2],c[48+g>>2]=c[G>>2],c[52+g>>2]=y,P=c[4+(y=G+8|0)>>2],c[56+g>>2]=c[y>>2],c[60+g>>2]=P,E=x(b*x(A[_>>2]-I)),!((R=x(C*x(A[d>>2]-j)))<E||(O=x(C*x(A[f>>2]-j)),(U=x(b*x(A[h>>2]-I)))<O||(R=U<R?U:R)<(V=x(S*x(A[l>>2]-D)))||(E=O<E?E:O,!(!((O=x(S*x(A[u>>2]-D)))<E)&&(E<V?V:E)<F&&(O<R?O:R)>x(0))))))if(c[G+40>>2]){if((0|q)<(0|i)){if((0|t)<(0|(y=t<<1))){if((0|n)<(0|y)){if(P=0,t&&(c[5498]=c[5498]+1,(n=M(19+(t<<3)|0))&&(c[(P=n+19&-16)-4>>2]=n),!((0|t)<1)))for(i=P,q=e,n=t;c[i>>2]=c[q>>2],i=i+4|0,q=q+4|0,n=n-1|0;);$&&(c[5499]=c[5499]+1,z(c[e-4>>2])),$=1,n=y,e=P}B((t<<=2)+e|0,0,t)}q=y-2|0,t=y}c[e+s>>2]=c[G+36>>2],c[(w<<2)+e>>2]=c[G+40>>2],i=w+1|0}else pi[c[c[g>>2]+12>>2]](g,G);if(!(w=i))break}$&&e&&(c[5499]=c[5499]+1,z(c[e-4>>2]))}}else if(!((0|(e=c[w+24>>2]))<1))for(P=e-1|0,e=32,n=0;;){if(t=c[w+32>>2]+e|0,i=c[t+32>>2],v=A[y+52>>2],K=A[y+56>>2],j=A[t+16>>2],V=A[t+20>>2],F=A[t+24>>2],C=A[y+20>>2],b=A[y+24>>2],L=A[t-32>>2],k=A[t-16>>2],W=A[t>>2],H=A[t-28>>2],X=A[t-12>>2],Q=A[t+4>>2],Z=A[t-24>>2],S=A[y+36>>2],o=A[t-8>>2],D=A[y+40>>2],r=A[t+8>>2],Y=A[y+48>>2],I=A[y+8>>2],E=A[y>>2],R=A[y+4>>2],O=A[y+16>>2],U=A[y+32>>2],c[380+g>>2]=0,c[364+g>>2]=0,c[348+g>>2]=0,c[332+g>>2]=0,A[360+g>>2]=x(x(Z*U)+x(o*S))+x(r*D),A[356+g>>2]=x(x(H*U)+x(X*S))+x(Q*D),A[352+g>>2]=x(x(L*U)+x(k*S))+x(W*D),A[344+g>>2]=x(x(Z*O)+x(o*C))+x(r*b),A[340+g>>2]=x(x(H*O)+x(X*C))+x(Q*b),A[336+g>>2]=x(x(L*O)+x(k*C))+x(W*b),A[328+g>>2]=x(x(E*Z)+x(R*o))+x(I*r),A[324+g>>2]=x(x(E*H)+x(R*X))+x(I*Q),A[320+g>>2]=x(x(L*E)+x(k*R))+x(W*I),A[376+g>>2]=K+x(x(x(U*j)+x(S*V))+x(D*F)),A[372+g>>2]=v+x(x(x(O*j)+x(C*V))+x(b*F)),A[368+g>>2]=Y+x(x(x(E*j)+x(R*V))+x(I*F)),c[316+g>>2]=n,c[312+g>>2]=-1,c[304+g>>2]=c[4+g>>2],c[300+g>>2]=i,c[296+g>>2]=0,c[308+g>>2]=320+g,c[52+g>>2]=1065353216,c[56+g>>2]=0,c[64+g>>2]=0,c[76+g>>2]=n,c[68+g>>2]=i,c[48+g>>2]=17684,t=c[24+g>>2],c[72+g>>2]=t,A[52+g>>2]=A[t+4>>2],c[64+g>>2]=c[t+16>>2],Yn(c[16+g>>2],c[20+g>>2],296+g|0,48+g|0),(0|n)==(0|P))break e;n=n+1|0,e=e+80|0,y=c[12+g>>2],w=c[8+g>>2]}N=832+g|0}function Xn(e,t,n,i,o,r){var s,l,_,u,h,f,d,m,v=0,g=x(0),y=0,b=x(0),S=x(0),C=x(0),E=0,P=x(0),w=x(0),I=x(0),R=x(0),D=x(0),O=x(0),M=x(0),z=x(0),L=x(0),F=0,B=0,k=x(0),U=x(0),G=x(0),j=x(0),V=x(0),H=x(0),W=x(0),q=x(0),Y=x(0),X=0,Q=x(0),Z=x(0),J=0,K=0,$=0,ee=0,te=0,ne=0,ie=0;N=m=N-672|0,v=c[i+12>>2],s=c[i+4>>2];e:if((0|(X=c[s+4>>2]))<=19)A[644+m>>2]=r,c[640+m>>2]=0,c[472+m>>2]=12640,A[636+m>>2]=A[o+4>>2],a[444+m|0]=0,c[420+m>>2]=953267991,c[32+m>>2]=14688,c[668+m>>2]=0,c[664+m>>2]=s,c[660+m>>2]=e,c[648+m>>2]=17352,c[656+m>>2]=32+m,c[652+m>>2]=112+m,Un(648+m|0,t,n,v,v,472+m|0)&&(r=A[604+m>>2],g=A[608+m>>2],b=A[612+m>>2],(S=x(x(x(r*r)+x(g*g))+x(b*b)))>x(9999999747378752e-20)&&(P=A[636+m>>2])<A[o+4>>2]&&(C=b,b=x(x(1)/x(T(S))),A[612+m>>2]=C*b,A[608+m>>2]=g*b,A[604+m>>2]=r*b,c[56+m>>2]=s,n=c[4+(t=628+m|0)>>2],c[(e=96+m|0)>>2]=c[t>>2],c[e+4>>2]=n,v=c[4+(n=8+(e=604+m|0)|0)>>2],c[(t=80+m|0)>>2]=c[n>>2],c[t+4>>2]=v,t=c[624+m>>2],c[88+m>>2]=c[620+m>>2],c[92+m>>2]=t,A[104+m>>2]=P,t=c[e+4>>2],c[72+m>>2]=c[e>>2],c[76+m>>2]=t,c[64+m>>2]=c[i+8>>2],c[68+m>>2]=48+m,x(pi[c[c[o>>2]+12>>2]](o,m+64|0,1))));else if((K=X-21|0)>>>0<=8){switch(0|K){case 0:if(g=A[v+20>>2],b=A[v+36>>2],S=A[(X=v+8|0)>>2],P=A[(K=v+24|0)>>2],z=A[v+52>>2],O=A[(F=v+56|0)>>2],D=A[($=v+40|0)>>2],I=A[v+32>>2],R=A[v+16>>2],w=A[v>>2],C=A[v+4>>2],M=A[v+48>>2],c[76+m>>2]=0,z=x(-z),Q=x(x(x(P*z)-x(S*M))-x(D*O)),L=A[t+48>>2],k=A[t+52>>2],U=A[(B=t+56|0)>>2],A[72+m>>2]=Q+x(x(x(S*L)+x(P*k))+x(D*U)),Z=x(x(x(g*z)-x(C*M))-x(b*O)),A[68+m>>2]=Z+x(x(x(C*L)+x(g*k))+x(b*U)),j=x(x(x(R*z)-x(w*M))-x(I*O)),A[64+m>>2]=j+x(x(x(w*L)+x(R*k))+x(I*U)),O=A[n+52>>2],M=A[(ee=n+56|0)>>2],z=A[n+48>>2],c[500+m>>2]=0,L=A[(te=n+8|0)>>2],k=A[(ne=n+24|0)>>2],U=A[(ie=n+40|0)>>2],A[512+m>>2]=x(x(S*L)+x(P*k))+x(D*U),V=A[n+4>>2],H=A[n+20>>2],G=A[n+36>>2],A[508+m>>2]=x(x(S*V)+x(P*H))+x(D*G),A[496+m>>2]=x(x(C*L)+x(g*k))+x(b*U),A[492+m>>2]=x(x(C*V)+x(g*H))+x(b*G),c[484+m>>2]=0,W=A[n>>2],q=A[n+16>>2],Y=A[n+32>>2],A[504+m>>2]=x(x(S*W)+x(P*q))+x(D*Y),A[488+m>>2]=x(x(C*W)+x(g*q))+x(b*Y),A[480+m>>2]=x(x(w*L)+x(R*k))+x(I*U),A[476+m>>2]=x(x(w*V)+x(R*H))+x(I*G),A[472+m>>2]=x(x(w*W)+x(R*q))+x(I*Y),c[532+m>>2]=0,c[(y=524+m|0)>>2]=0,c[y+4>>2]=0,c[(y=516+m|0)>>2]=0,c[y+4>>2]=0,i=c[i+8>>2],L=x(pi[c[c[s>>2]+48>>2]](s)),J=c[4+(E=t+8|0)>>2],c[(y=128+m|0)>>2]=c[E>>2],c[y+4>>2]=J,E=c[t+20>>2],c[(y=136+m|0)>>2]=c[t+16>>2],c[y+4>>2]=E,J=c[4+(E=t+24|0)>>2],c[(y=144+m|0)>>2]=c[E>>2],c[y+4>>2]=J,E=c[t+36>>2],c[(y=152+m|0)>>2]=c[t+32>>2],c[y+4>>2]=E,J=c[4+(E=t+40|0)>>2],c[(y=160+m|0)>>2]=c[E>>2],c[y+4>>2]=J,E=c[t+52>>2],c[(y=168+m|0)>>2]=c[t+48>>2],c[y+4>>2]=E,E=c[B+4>>2],c[(y=176+m|0)>>2]=c[B>>2],c[y+4>>2]=E,y=c[te+4>>2],c[(B=192+m|0)>>2]=c[te>>2],c[B+4>>2]=y,c[116+m>>2]=e,c[112+m>>2]=17456,B=c[t+4>>2],c[120+m>>2]=c[t>>2],c[124+m>>2]=B,t=c[n+4>>2],c[184+m>>2]=c[n>>2],c[188+m>>2]=t,B=c[n+36>>2],c[(t=216+m|0)>>2]=c[n+32>>2],c[t+4>>2]=B,B=c[ne+4>>2],c[(t=208+m|0)>>2]=c[ne>>2],c[t+4>>2]=B,B=c[n+20>>2],c[(t=200+m|0)>>2]=c[n+16>>2],c[t+4>>2]=B,B=c[ie+4>>2],c[(t=224+m|0)>>2]=c[ie>>2],c[t+4>>2]=B,B=c[n+52>>2],c[(t=232+m|0)>>2]=c[n+48>>2],c[t+4>>2]=B,n=c[ee+4>>2],c[(t=240+m|0)>>2]=c[ee>>2],c[t+4>>2]=n,n=c[X+4>>2],c[(t=256+m|0)>>2]=c[X>>2],c[t+4>>2]=n,t=c[v+4>>2],c[248+m>>2]=c[v>>2],c[252+m>>2]=t,n=c[K+4>>2],c[(t=272+m|0)>>2]=c[K>>2],c[t+4>>2]=n,n=c[v+20>>2],c[(t=264+m|0)>>2]=c[v+16>>2],c[t+4>>2]=n,n=c[$+4>>2],c[(t=288+m|0)>>2]=c[$>>2],c[t+4>>2]=n,n=c[v+36>>2],c[(t=280+m|0)>>2]=c[v+32>>2],c[t+4>>2]=n,n=c[F+4>>2],c[(t=304+m|0)>>2]=c[F>>2],c[t+4>>2]=n,n=c[v+52>>2],c[(t=296+m|0)>>2]=c[v+48>>2],c[t+4>>2]=n,A[316+m>>2]=L,c[328+m>>2]=i,c[332+m>>2]=s,c[112+m>>2]=18564,A[320+m>>2]=r,c[324+m>>2]=o,A[312+m>>2]=A[o+4>>2],pi[c[c[e>>2]+8>>2]](e,472+m|0,648+m|0,48+m|0),c[32+m>>2]=11092,c[36+m>>2]=c[s+56>>2],r=x(Q+x(x(x(S*z)+x(P*O))+x(D*M))),g=x(Z+x(x(x(C*z)+x(g*O))+x(b*M))),b=x(j+x(x(x(w*z)+x(R*O))+x(I*M))),c[40+m>>2]=112+m,e=c[s+60>>2],p[e+60|0]){Tt(e,32+m|0,m+64|0,b,g,r,648+m|0,48+m|0,c[e+56>>2]);break e}Et(e,32+m|0,m+64|0,b,g,r,648+m|0,48+m|0);break e;case 7:if(A[284+m>>2]=r,c[280+m>>2]=0,c[112+m>>2]=12640,A[276+m>>2]=A[o+4>>2],c[84+m>>2]=s,c[80+m>>2]=0,c[76+m>>2]=e,c[68+m>>2]=0,c[72+m>>2]=0,c[64+m>>2]=17352,!Un(m+64|0,t,n,v,v,112+m|0))break e;if(r=A[244+m>>2],g=A[248+m>>2],b=A[252+m>>2],!((S=x(x(x(r*r)+x(g*g))+x(b*b)))>x(9999999747378752e-20)))break e;if(!((P=A[276+m>>2])<A[o+4>>2]))break e;C=b,b=x(x(1)/x(T(S))),A[252+m>>2]=C*b,A[248+m>>2]=g*b,A[244+m>>2]=r*b,c[656+m>>2]=s,n=c[4+(t=268+m|0)>>2],c[(e=504+m|0)>>2]=c[t>>2],c[e+4>>2]=n,v=c[4+(n=8+(e=244+m|0)|0)>>2],c[(t=488+m|0)>>2]=c[n>>2],c[t+4>>2]=v,t=c[264+m>>2],c[496+m>>2]=c[260+m>>2],c[500+m>>2]=t,A[512+m>>2]=P,t=c[e+4>>2],c[480+m>>2]=c[e>>2],c[484+m>>2]=t,c[472+m>>2]=c[i+8>>2],c[476+m>>2]=648+m,x(pi[c[c[o>>2]+12>>2]](o,472+m|0,1));break e}O=A[(X=n+56|0)>>2],M=A[n+52>>2],z=A[(K=v+56|0)>>2],d=A[v+52>>2],L=A[(F=t+56|0)>>2],k=A[t+52>>2],g=A[v+20>>2],b=A[v+36>>2],S=A[($=v+40|0)>>2],P=A[(B=v+8|0)>>2],D=A[(ee=v+24|0)>>2],U=A[n+48>>2],V=A[v+48>>2],H=A[t+48>>2],I=A[v+32>>2],R=A[v>>2],w=A[v+16>>2],C=A[v+4>>2],c[500+m>>2]=0,G=A[(te=n+8|0)>>2],W=A[(ne=n+24|0)>>2],q=A[(ie=n+40|0)>>2],A[512+m>>2]=x(x(P*G)+x(D*W))+x(S*q),Y=A[n+4>>2],Q=A[n+20>>2],Z=A[n+36>>2],A[508+m>>2]=x(x(P*Y)+x(D*Q))+x(S*Z),A[496+m>>2]=x(x(C*G)+x(g*W))+x(b*q),A[492+m>>2]=x(x(C*Y)+x(g*Q))+x(b*Z),c[484+m>>2]=0,j=A[n>>2],l=A[n+16>>2],_=A[n+32>>2],A[504+m>>2]=x(x(P*j)+x(D*l))+x(S*_),A[488+m>>2]=x(x(C*j)+x(g*l))+x(b*_),A[480+m>>2]=x(x(R*G)+x(w*W))+x(I*q),A[476+m>>2]=x(x(R*Y)+x(w*Q))+x(I*Z),A[472+m>>2]=x(x(R*j)+x(w*l))+x(I*_),c[532+m>>2]=0,c[(y=524+m|0)>>2]=0,c[y+4>>2]=0,c[(y=516+m|0)>>2]=0,c[y+4>>2]=0,i=c[i+8>>2],G=x(pi[c[c[s>>2]+48>>2]](s)),J=c[4+(E=t+8|0)>>2],c[(y=128+m|0)>>2]=c[E>>2],c[y+4>>2]=J,E=c[t+20>>2],c[(y=136+m|0)>>2]=c[t+16>>2],c[y+4>>2]=E,J=c[4+(E=t+24|0)>>2],c[(y=144+m|0)>>2]=c[E>>2],c[y+4>>2]=J,E=c[t+36>>2],c[(y=152+m|0)>>2]=c[t+32>>2],c[y+4>>2]=E,J=c[4+(E=t+40|0)>>2],c[(y=160+m|0)>>2]=c[E>>2],c[y+4>>2]=J,E=c[t+52>>2],c[(y=168+m|0)>>2]=c[t+48>>2],c[y+4>>2]=E,E=c[F+4>>2],c[(y=176+m|0)>>2]=c[F>>2],c[y+4>>2]=E,y=c[te+4>>2],c[(F=192+m|0)>>2]=c[te>>2],c[F+4>>2]=y,c[116+m>>2]=e,c[112+m>>2]=17456,F=c[t+4>>2],c[120+m>>2]=c[t>>2],c[124+m>>2]=F,t=c[n+4>>2],c[184+m>>2]=c[n>>2],c[188+m>>2]=t,F=c[n+36>>2],c[(t=216+m|0)>>2]=c[n+32>>2],c[t+4>>2]=F,F=c[ne+4>>2],c[(t=208+m|0)>>2]=c[ne>>2],c[t+4>>2]=F,F=c[n+20>>2],c[(t=200+m|0)>>2]=c[n+16>>2],c[t+4>>2]=F,F=c[ie+4>>2],c[(t=224+m|0)>>2]=c[ie>>2],c[t+4>>2]=F,F=c[n+52>>2],c[(t=232+m|0)>>2]=c[n+48>>2],c[t+4>>2]=F,n=c[X+4>>2],c[(t=240+m|0)>>2]=c[X>>2],c[t+4>>2]=n,n=c[B+4>>2],c[(t=256+m|0)>>2]=c[B>>2],c[t+4>>2]=n,t=c[v+4>>2],c[248+m>>2]=c[v>>2],c[252+m>>2]=t,n=c[ee+4>>2],c[(t=272+m|0)>>2]=c[ee>>2],c[t+4>>2]=n,n=c[v+20>>2],c[(t=264+m|0)>>2]=c[v+16>>2],c[t+4>>2]=n,n=c[$+4>>2],c[(t=288+m|0)>>2]=c[$>>2],c[t+4>>2]=n,n=c[v+36>>2],c[(t=280+m|0)>>2]=c[v+32>>2],c[t+4>>2]=n,n=c[K+4>>2],c[(t=304+m|0)>>2]=c[K>>2],c[t+4>>2]=n,n=c[v+52>>2],c[(t=296+m|0)>>2]=c[v+48>>2],c[t+4>>2]=n,A[316+m>>2]=G,c[328+m>>2]=i,c[332+m>>2]=s,c[112+m>>2]=18588,A[320+m>>2]=r,c[324+m>>2]=o,A[312+m>>2]=A[o+4>>2],pi[c[c[e>>2]+8>>2]](e,472+m|0,m+64|0,648+m|0),c[60+m>>2]=0,c[44+m>>2]=0,G=x(-d),W=x(x(x(w*G)-x(R*V))-x(I*z)),r=x(W+x(x(x(R*U)+x(w*M))+x(I*O))),I=x(W+x(x(x(R*H)+x(w*k))+x(I*L))),A[48+m>>2]=A[64+m>>2]+(r<I?r:I),w=x(x(x(g*G)-x(C*V))-x(b*z)),R=x(w+x(x(x(C*U)+x(g*M))+x(b*O))),g=x(w+x(x(x(C*H)+x(g*k))+x(b*L))),A[52+m>>2]=A[68+m>>2]+(R<g?R:g),w=x(x(x(D*G)-x(P*V))-x(S*z)),b=x(w+x(x(x(P*U)+x(D*M))+x(S*O))),S=x(w+x(x(x(P*H)+x(D*k))+x(S*L))),A[56+m>>2]=A[72+m>>2]+(b<S?b:S),A[32+m>>2]=A[648+m>>2]+(I<r?r:I),A[36+m>>2]=A[652+m>>2]+(g<R?R:g),A[40+m>>2]=A[656+m>>2]+(S<b?b:S),pi[c[c[s>>2]+64>>2]](s,112+m|0,48+m|0,32+m|0)}else if(31==(0|X)){if(j=A[(X=v+52|0)>>2],O=A[(K=v+56|0)>>2],M=A[t+52>>2],z=A[t+56>>2],g=A[(F=v+20|0)>>2],b=A[($=v+36|0)>>2],L=A[t+20>>2],k=A[t+36>>2],U=A[t+24>>2],S=A[(B=v+24|0)>>2],V=A[t+40>>2],P=A[(ee=v+40|0)>>2],D=A[v+32>>2],I=A[v>>2],R=A[v+16>>2],H=A[t+32>>2],G=A[t>>2],W=A[t+16>>2],q=A[v+48>>2],Y=A[t+48>>2],w=A[v+4>>2],Q=A[t+4>>2],Z=A[t+8>>2],C=A[v+8>>2],c[(te=172+m|0)>>2]=0,c[(ne=156+m|0)>>2]=0,c[(ie=140+m|0)>>2]=0,A[(y=152+m|0)>>2]=x(x(C*Z)+x(S*U))+x(P*V),A[(E=148+m|0)>>2]=x(x(C*Q)+x(S*L))+x(P*k),A[(J=136+m|0)>>2]=x(x(w*Z)+x(g*U))+x(b*V),A[(u=132+m|0)>>2]=x(x(w*Q)+x(g*L))+x(b*k),h=168+m|0,j=x(-j),A[h>>2]=x(x(x(S*j)-x(C*q))-x(P*O))+x(x(x(C*Y)+x(S*M))+x(P*z)),A[(f=164+m|0)>>2]=x(x(x(g*j)-x(w*q))-x(b*O))+x(x(x(w*Y)+x(g*M))+x(b*z)),c[124+m>>2]=0,A[144+m>>2]=x(x(C*G)+x(S*W))+x(P*H),A[128+m>>2]=x(x(w*G)+x(g*W))+x(b*H),A[120+m>>2]=x(x(I*Z)+x(R*U))+x(D*V),A[160+m>>2]=x(x(x(R*j)-x(I*q))-x(D*O))+x(x(x(I*Y)+x(R*M))+x(D*z)),A[116+m>>2]=x(x(I*Q)+x(R*L))+x(D*k),A[112+m>>2]=x(x(I*G)+x(R*W))+x(D*H),pi[c[c[e>>2]+8>>2]](e,112+m|0,48+m|0,32+m|0),j=A[X>>2],O=A[K>>2],M=A[n+52>>2],z=A[n+56>>2],g=A[F>>2],b=A[$>>2],L=A[n+20>>2],k=A[n+36>>2],U=A[n+24>>2],S=A[B>>2],V=A[n+40>>2],P=A[ee>>2],D=A[v+32>>2],I=A[v>>2],R=A[v+16>>2],H=A[n+32>>2],G=A[n>>2],W=A[n+16>>2],q=A[v+48>>2],Y=A[n+48>>2],w=A[v+4>>2],Q=A[n+4>>2],Z=A[n+8>>2],C=A[v+8>>2],c[te>>2]=0,c[ne>>2]=0,c[ie>>2]=0,A[y>>2]=x(x(C*Z)+x(S*U))+x(P*V),A[E>>2]=x(x(C*Q)+x(S*L))+x(P*k),A[J>>2]=x(x(w*Z)+x(g*U))+x(b*V),A[u>>2]=x(x(w*Q)+x(g*L))+x(b*k),j=x(-j),A[h>>2]=x(x(x(S*j)-x(C*q))-x(P*O))+x(x(x(C*Y)+x(S*M))+x(P*z)),A[f>>2]=x(x(x(g*j)-x(w*q))-x(b*O))+x(x(x(w*Y)+x(g*M))+x(b*z)),c[124+m>>2]=0,A[144+m>>2]=x(x(C*G)+x(S*W))+x(P*H),A[128+m>>2]=x(x(w*G)+x(g*W))+x(b*H),A[120+m>>2]=x(x(I*Z)+x(R*U))+x(D*V),A[160+m>>2]=x(x(x(R*j)-x(I*q))-x(D*O))+x(x(x(I*Y)+x(R*M))+x(D*z)),A[116+m>>2]=x(x(I*Q)+x(R*L))+x(D*k),A[112+m>>2]=x(x(I*G)+x(R*W))+x(D*H),pi[c[c[e>>2]+8>>2]](e,112+m|0,16+m|0,m),(g=A[16+m>>2])<A[48+m>>2]&&(A[48+m>>2]=g),(g=A[20+m>>2])<A[52+m>>2]&&(A[52+m>>2]=g),(g=A[24+m>>2])<A[56+m>>2]&&(A[56+m>>2]=g),(g=A[28+m>>2])<A[60+m>>2]&&(A[60+m>>2]=g),(g=A[m>>2])>A[32+m>>2]&&(A[32+m>>2]=g),(g=A[4+m>>2])>A[36+m>>2]&&(A[36+m>>2]=g),(g=A[8+m>>2])>A[40+m>>2]&&(A[40+m>>2]=g),(g=A[12+m>>2])>A[44+m>>2]&&(A[44+m>>2]=g),c[504+m>>2]=o,c[500+m>>2]=v,A[492+m>>2]=r,c[488+m>>2]=n,c[484+m>>2]=t,c[480+m>>2]=e,c[476+m>>2]=i,c[472+m>>2]=18612,c[496+m>>2]=s,!(e=c[s+72>>2])){if(c[s+24>>2]<1)break e;for(e=32,t=1;;){if(n=c[s+32>>2]+e|0,i=c[n+32>>2],r=A[n+16>>2],g=A[n+20>>2],b=A[n+24>>2],S=A[n-32>>2],P=A[n-16>>2],D=A[n>>2],I=A[n-28>>2],R=A[n-12>>2],w=A[n+4>>2],C=A[n-24>>2],O=A[n-8>>2],M=A[n+8>>2],c[172+m>>2]=0,c[156+m>>2]=0,c[140+m>>2]=0,c[124+m>>2]=0,z=A[v+32>>2],L=A[v+36>>2],k=A[v+40>>2],A[152+m>>2]=x(x(C*z)+x(O*L))+x(M*k),A[148+m>>2]=x(x(I*z)+x(R*L))+x(w*k),A[144+m>>2]=x(x(S*z)+x(P*L))+x(D*k),U=A[v+16>>2],V=A[v+20>>2],H=A[v+24>>2],A[136+m>>2]=x(x(C*U)+x(O*V))+x(M*H),A[132+m>>2]=x(x(I*U)+x(R*V))+x(w*H),A[128+m>>2]=x(x(S*U)+x(P*V))+x(D*H),G=C,C=A[v>>2],j=O,O=A[v+4>>2],W=M,M=A[v+8>>2],A[120+m>>2]=x(x(G*C)+x(j*O))+x(W*M),A[116+m>>2]=x(x(I*C)+x(R*O))+x(w*M),A[112+m>>2]=x(x(S*C)+x(P*O))+x(D*M),A[168+m>>2]=x(x(x(r*z)+x(g*L))+x(b*k))+A[v+56>>2],A[164+m>>2]=x(x(x(r*U)+x(g*V))+x(b*H))+A[v+52>>2],A[160+m>>2]=x(x(x(r*C)+x(g*O))+x(b*M))+A[v+48>>2],c[68+m>>2]=1065353216,c[72+m>>2]=1,c[76+m>>2]=-1,c[88+m>>2]=n=t-1|0,o=c[504+m>>2],c[84+m>>2]=o,c[80+m>>2]=i,c[64+m>>2]=18648,A[68+m>>2]=A[o+4>>2],c[668+m>>2]=n,c[664+m>>2]=-1,c[652+m>>2]=i,n=c[476+m>>2],c[648+m>>2]=n,c[656+m>>2]=c[n+8>>2],c[660+m>>2]=112+m,Xn(c[480+m>>2],c[484+m>>2],c[488+m>>2],648+m|0,m+64|0,A[492+m>>2]),c[s+24>>2]<=(0|t))break e;e=e+80|0,t=t+1|0,v=c[500+m>>2]}}i=c[4+(n=56+m|0)>>2],c[(t=120+m|0)>>2]=c[n>>2],c[t+4>>2]=i,i=c[4+(n=40+m|0)>>2],c[(t=136+m|0)>>2]=c[n>>2],c[t+4>>2]=i,t=c[52+m>>2],c[112+m>>2]=c[48+m>>2],c[116+m>>2]=t,t=c[36+m>>2],c[128+m>>2]=c[32+m>>2],c[132+m>>2]=t,bn(c[e>>2],112+m|0,472+m|0)}N=672+m|0}function Qn(e,t,n,i,o,a){e|=0,t|=0,n|=0,i=x(i),o|=0;var r,s,l;return c[52+(N=l=N+-64|0)>>2]=a|=0,c[48+l>>2]=o,c[56+l>>2]=c[e+220>>2],o=c[e+212>>2],A[o+4>>2]>=i&&(s=c[4+(r=n+8|0)>>2],c[(a=32+l|0)>>2]=c[r>>2],c[a+4>>2]=s,s=c[4+(r=t+8|0)>>2],c[(a=16+l|0)>>2]=c[r>>2],c[a+4>>2]=s,a=c[n+4>>2],c[24+l>>2]=c[n>>2],c[28+l>>2]=a,n=c[t+4>>2],c[8+l>>2]=c[t>>2],c[12+l>>2]=n,A[40+l>>2]=i,c[l>>2]=c[e+216>>2],c[4+l>>2]=48+l,i=x(pi[c[c[o>>2]+12>>2]](o,l,1))),N=l+64|0,x(i)}function Zn(e,t,n,i,o,a){var r,s,l,_,u,h,f,p,d,m,v,g,y,b,S,C,E,P,w,I,R,D,O,M,z,L,F,B,k,U,G,j,V;N=V=N-368|0,l=c[4+(m=n+8|0)>>2],c[(r=312+V|0)>>2]=c[m>>2],c[4+r>>2]=l,u=c[4+(_=n+24|0)>>2],c[(r=328+V|0)>>2]=c[_>>2],c[4+r>>2]=u,P=c[4+(l=n+40|0)>>2],c[(r=344+V|0)>>2]=c[l>>2],c[4+r>>2]=P,v=c[4+(u=n+56|0)>>2],c[(r=360+V|0)>>2]=c[u>>2],c[4+r>>2]=v,w=c[4+(P=i+8|0)>>2],c[(r=248+V|0)>>2]=c[P>>2],c[4+r>>2]=w,r=c[n+4>>2],c[304+V>>2]=c[n>>2],c[308+V>>2]=r,r=c[n+20>>2],c[320+V>>2]=c[n+16>>2],c[324+V>>2]=r,r=c[n+36>>2],c[336+V>>2]=c[n+32>>2],c[340+V>>2]=r,r=c[n+52>>2],c[352+V>>2]=c[n+48>>2],c[356+V>>2]=r,r=c[i+4>>2],c[240+V>>2]=c[i>>2],c[244+V>>2]=r,g=c[4+(v=i+24|0)>>2],c[(r=264+V|0)>>2]=c[v>>2],c[4+r>>2]=g,I=c[4+(w=i+40|0)>>2],c[(r=280+V|0)>>2]=c[w>>2],c[4+r>>2]=I,R=c[4+(g=i+56|0)>>2],c[(r=296+V|0)>>2]=c[g>>2],c[4+r>>2]=R,r=c[i+20>>2],c[256+V>>2]=c[i+16>>2],c[260+V>>2]=r,r=c[i+36>>2],c[272+V>>2]=c[i+32>>2],c[276+V>>2]=r,r=c[i+52>>2],c[288+V>>2]=c[i+48>>2],c[292+V>>2]=r,In(304+V|0,240+V|0,8+V|0,224+V|0),U=A[16+V>>2],G=A[8+V>>2],j=A[12+V>>2],y=A[224+V>>2],c[(r=I=20+V|0)>>2]=0,c[4+r>>2]=0,c[(r=R=32+V|0)>>2]=0,c[4+r>>2]=0,c[(D=28+V|0)>>2]=1065353216,c[(r=z=40+V|0)>>2]=0,c[4+r>>2]=0,c[(r=52+V|0)>>2]=0,c[4+r>>2]=0,c[(L=48+V|0)>>2]=1065353216,c[(C=M=60+V|0)>>2]=0,c[4+C>>2]=0,c[(C=68+V|0)>>2]=0,c[12+V>>2]=0,c[16+V>>2]=0,c[8+V>>2]=1065353216,Rn(304+V|0,224+V|0),c[r>>2]=0,c[(F=36+V|0)>>2]=0,c[I>>2]=0,s=A[224+V>>2],h=A[228+V>>2],p=A[232+V>>2],f=A[236+V>>2],d=x(x(2)/x(x(x(x(s*s)+x(h*h))+x(p*p))+x(f*f))),b=x(p*d),S=x(h*b),O=x(s*d),E=x(f*O),A[44+V>>2]=S+E,B=x(s*b),d=x(h*d),k=x(f*d),A[z>>2]=B-k,A[R>>2]=S-E,S=x(s*O),h=x(h*d),A[L>>2]=x(1)-x(S+h),p=x(p*b),A[D>>2]=x(1)-x(S+p),s=x(s*d),f=x(f*b),A[24+V>>2]=s+f,A[16+V>>2]=B+k,A[12+V>>2]=s-f,A[8+V>>2]=x(1)-x(h+p),pi[c[c[t>>2]+8>>2]](t,8+V|0,224+V|0,208+V|0),h=A[208+V>>2],f=A[212+V>>2],p=A[216+V>>2],d=A[224+V>>2],b=A[228+V>>2],s=A[232+V>>2],S=x(pi[c[c[t>>2]+16>>2]](t)),c[220+V>>2]=0,c[236+V>>2]=0,O=x(s+x(0)),s=x(G*y),E=x(s*s),s=x(y*j),E=x(E+x(s*s)),s=x(y*U),s=x(S*x(T(x(E+x(s*s))))),A[232+V>>2]=O-s,A[228+V>>2]=x(b+x(0))-s,A[224+V>>2]=x(d+x(0))-s,A[216+V>>2]=s+p,A[212+V>>2]=s+f,A[208+V>>2]=s+h,D=c[4+m>>2],c[r>>2]=c[m>>2],c[4+r>>2]=D,r=c[n+20>>2],c[M>>2]=c[n+16>>2],c[4+M>>2]=r,r=c[4+_>>2],c[C>>2]=c[_>>2],c[4+C>>2]=r,m=c[n+36>>2],c[(r=76+V|0)>>2]=c[n+32>>2],c[4+r>>2]=m,m=c[4+l>>2],c[(r=84+V|0)>>2]=c[l>>2],c[4+r>>2]=m,_=c[n+52>>2],c[(r=92+V|0)>>2]=c[n+48>>2],c[4+r>>2]=_,l=c[4+u>>2],c[(_=m=100+V|0)>>2]=c[u>>2],c[4+_>>2]=l,l=c[4+P>>2],c[(_=116+V|0)>>2]=c[P>>2],c[4+_>>2]=l,c[8+V>>2]=19520,_=c[n+4>>2],c[44+V>>2]=c[n>>2],c[48+V>>2]=_,n=c[i+4>>2],c[108+V>>2]=c[i>>2],c[112+V>>2]=n,l=c[i+52>>2],c[(n=156+V|0)>>2]=c[i+48>>2],c[n+4>>2]=l,u=c[4+g>>2],c[(l=_=164+V|0)>>2]=c[g>>2],c[4+l>>2]=u,u=c[4+v>>2],c[(l=132+V|0)>>2]=c[v>>2],c[4+l>>2]=u,u=c[i+20>>2],c[(l=124+V|0)>>2]=c[i+16>>2],c[4+l>>2]=u,u=c[4+w>>2],c[(l=148+V|0)>>2]=c[w>>2],c[4+l>>2]=u,u=c[i+36>>2],c[(l=140+V|0)>>2]=c[i+32>>2],c[4+l>>2]=u,c[192+V>>2]=o,A[196+V>>2]=a,c[200+V>>2]=t,s=A[96+V>>2],h=A[160+V>>2],a=A[r>>2],f=A[n>>2],y=A[m>>2],p=A[_>>2],c[188+V>>2]=e,a=x(f-a),s=x(h-s),h=x(p-y),f=x(x(1)/x(T(x(x(x(a*a)+x(s*s))+x(h*h))))),d=(y=x(h*f))==x(0)?x(0xde0b6b000000000):x(x(1)/y),c[F>>2]=d<x(0),b=(p=x(s*f))==x(0)?x(0xde0b6b000000000):x(x(1)/p),c[R>>2]=b<x(0),A[I>>2]=d,A[16+V>>2]=b,a=x((d=a)*f),A[40+V>>2]=x(h*y)+x(x(d*a)+x(s*p)),a=a==x(0)?x(0xde0b6b000000000):x(x(1)/a),A[12+V>>2]=a,c[28+V>>2]=a<x(0),e=c[e+68>>2],pi[c[c[e>>2]+24>>2]](e,352+V|0,288+V|0,8+V|0,224+V|0,208+V|0),N=368+V|0}function Jn(e,t,n){var i,o=0,a=0,r=(a=t|=0,0|pi[c[c[(n|=0)>>2]+28>>2]](n,c[28+(e|=0)>>2]));if(c[a>>2]=r,a=t,r=0|pi[c[c[n>>2]+28>>2]](n,c[e+32>>2]),c[a+4>>2]=r,o=0|pi[c[c[n>>2]+40>>2]](n,e),i=0|pi[c[c[n>>2]+28>>2]](n,o),(c[t+8>>2]=i)&&pi[c[c[n>>2]+48>>2]](n,o),c[t+12>>2]=c[e+4>>2],c[t+24>>2]=p[e+21|0],c[t+40>>2]=c[e+24>>2],A[t+44>>2]=A[e+16>>2],c[t+48>>2]=p[e+20|0],n=c[e+12>>2],o=c[e+40>>2],c[t+28>>2]=c[e+36>>2],c[t+32>>2]=o,c[t+20>>2]=n,c[t+36>>2]=0,c[t+16>>2]=c[e+8>>2],n=c[e+28>>2],!((0|(o=c[n+548>>2]))<1)&&(n=c[n+556>>2],c[n>>2]==(0|e)&&(c[t+36>>2]=1),1!=(0|o)))for(n=n+4|0,o=o-1|0;c[n>>2]==(0|e)&&(c[t+36>>2]=1),n=n+4|0,o=o-1|0;);if(n=c[e+32>>2],!((0|(o=c[n+548>>2]))<1)&&(n=c[n+556>>2],c[n>>2]==(0|e)&&(c[t+36>>2]=1),1!=(0|o)))for(n=n+4|0,o=o-1|0;c[n>>2]==(0|e)&&(c[t+36>>2]=1),n=n+4|0,o=o-1|0;);return 19704}function Kn(e,t,n,i,o,a,r,s,l,_){var u,h,f,p,d,m,v,g,y,b,S,C,E,T,P,w,I,R,D,N,O=c[a+4>>2];c[e>>2]=c[a>>2],c[e+4>>2]=O,R=c[4+(a=a+8|0)>>2],c[(O=e+8|0)>>2]=c[a>>2],c[4+O>>2]=R,C=A[t+24>>2],g=A[t+20>>2],p=A[t+40>>2],h=A[t+36>>2],y=A[t+8>>2],b=A[t>>2],E=A[t+4>>2],T=A[t+16>>2],u=A[t+32>>2],m=A[i+4>>2],d=A[i+8>>2],S=A[i>>2],c[e+28>>2]=0,P=u,u=A[O>>2],f=A[e+4>>2],v=x(x(m*u)-x(d*f)),w=h,I=d,d=A[e>>2],h=x(x(I*d)-x(u*S)),m=x(x(f*S)-x(m*d)),S=x(x(x(P*v)+x(w*h))+x(p*m)),A[e+24>>2]=S,C=x(x(x(v*T)+x(h*g))+x(m*C)),A[e+20>>2]=C,m=x(x(x(v*b)+x(E*h))+x(m*y)),A[e+16>>2]=m,y=A[n+24>>2],b=A[n+20>>2],E=A[n+40>>2],T=A[n+36>>2],D=A[n+8>>2],N=A[n>>2],P=A[n+4>>2],w=A[n+16>>2],p=A[n+32>>2],v=A[o+4>>2],h=A[o>>2],g=A[o+8>>2],c[e+44>>2]=0,I=p,p=x(x(f*g)-x(u*v)),u=x(x(u*h)-x(d*g)),f=x(x(d*v)-x(f*h)),d=x(x(x(I*p)+x(T*u))+x(E*f)),A[e+40>>2]=d,v=x(x(x(p*w)+x(u*b))+x(f*y)),A[e+36>>2]=v,u=x(x(x(N*p)+x(P*u))+x(f*D)),A[e+32>>2]=u,f=A[r+8>>2],h=A[r+4>>2],g=A[r>>2],c[e+60>>2]=0,g=x(g*m),A[e+48>>2]=g,h=x(h*C),A[e+52>>2]=h,f=x(f*S),A[e+56>>2]=f,p=A[l+8>>2],y=A[l+4>>2],b=A[l>>2],c[e+76>>2]=0,b=x(b*u),A[e+64>>2]=b,y=x(y*v),A[e+68>>2]=y,p=x(p*d),A[e+72>>2]=p,A[e+80>>2]=x(x(x(x(x(m*g)+x(C*h))+x(S*f))+s)+_)+x(x(x(u*b)+x(v*y))+x(d*p))}function $n(e){var t=0,n=0,i=0,o=0,r=(i=c[e+8>>2],(n=c[e+32>>2])?c[e+40>>2]:0),s=n,l=(t=c[e+52>>2])?c[e+60>>2]:0;if(n=t,o=0,(t=c[e+72>>2])&&(o=c[e+80>>2]),x(pi[c[c[i>>2]+12>>2]](i,r,s,l,n,o,t,c[e+4>>2],c[e+20>>2],c[e+24>>2])),(0|(t=c[e+32>>2]))<=-1)for(c[e+36>>2]<=-1&&((n=c[e+40>>2])&&p[e+44|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+36>>2]=0,c[e+40>>2]=0,a[e+44|0]=1),i=t<<2;i=i+4|(c[c[e+40>>2]+i>>2]=0),(n=t)>>>0<=(t=t+1|0)>>>0;);if(((c[e+32>>2]=0)|(t=c[e+52>>2]))<=-1)for(c[e+56>>2]<=-1&&((n=c[e+60>>2])&&p[e- -64|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+56>>2]=0,c[e+60>>2]=0,a[e- -64|0]=1),i=t<<2;i=i+4|(c[c[e+60>>2]+i>>2]=0),(n=t)>>>0<=(t=t+1|0)>>>0;);if(((c[e+52>>2]=0)|(t=c[e+72>>2]))<=-1)for(c[e+76>>2]<=-1&&((n=c[e+80>>2])&&p[e+84|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+76>>2]=0,c[e+80>>2]=0,a[e+84|0]=1),i=t<<2;i=i+4|(c[c[e+80>>2]+i>>2]=0),(n=t)>>>0<=(t=t+1|0)>>>0;);c[e+72>>2]=0}function ei(e){var t=0;return c[(e|=0)>>2]=19784,p[e+288|0]&&(t=c[e+220>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+220>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),(t=c[e+212>>2])&&(pi[c[c[t>>2]>>2]](t),(t=c[e+212>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),p[e+289|0]&&(t=c[e+216>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+216>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),(t=c[e+332>>2])&&p[e+336|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+332>>2]=0,a[e+336|0]=1,c[(t=e+324|0)>>2]=0,c[t+4>>2]=0,(t=c[e+304>>2])&&p[e+308|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+304>>2]=0,a[e+308|0]=1,c[(t=e+296|0)>>2]=0,c[t+4>>2]=0,(t=c[e+256>>2])&&p[e+260|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+256>>2]=0,a[e+260|0]=1,c[(t=e+248|0)>>2]=0,c[t+4>>2]=0,(t=c[e+236>>2])&&p[e+240|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+236>>2]=0,a[e+240|0]=1,c[(t=e+228|0)>>2]=0,c[t+4>>2]=0,(t=c[e+204>>2])&&p[e+208|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+204>>2]=0,a[e+208|0]=1,c[(t=e+196|0)>>2]=0,c[t+4>>2]=0,jn(e),0|e}function ti(e,t){return c[c[236+(e|=0)>>2]+((t|=0)<<2)>>2]}function ni(e,t){pi[c[c[(e|=0)>>2]+68>>2]](e,t|=0)}function ii(e,t,n){var i,o,a,r,s,c,l,_,u,h,f,p,d,m,v,g=x(0);(g=A[e+404>>2])!=x(0)&&(o=A[t+8>>2],i=A[t+4>>2],a=A[e+408>>2],A[e+372>>2]=x(g*x(A[t>>2]*a))+A[e+372>>2],s=i,i=A[e+412>>2],A[(r=e+376|0)>>2]=x(g*x(s*i))+A[r>>2],s=g,g=A[e+416>>2],A[(r=e+380|0)>>2]=x(s*x(o*g))+A[r>>2],_=A[e+612>>2],u=A[e+364>>2],h=A[e+356>>2],f=A[e+360>>2],p=A[e+608>>2],d=A[e+348>>2],m=A[e+340>>2],v=A[e+344>>2],l=A[n+4>>2],o=x(g*A[t+8>>2]),i=x(i*A[t+4>>2]),c=A[n+8>>2],g=x(x(l*o)-x(i*c)),a=x(a*A[t>>2]),s=x(a*c),c=A[n>>2],o=x(s-x(o*c)),i=x(x(i*c)-x(a*l)),A[e+388>>2]=x(x(x(x(A[e+324>>2]*g)+x(A[e+328>>2]*o))+x(i*A[e+332>>2]))*A[e+604>>2])+A[e+388>>2],A[(t=e+392|0)>>2]=x(p*x(x(x(g*m)+x(o*v))+x(i*d)))+A[t>>2],A[(e=e+396|0)>>2]=x(_*x(x(x(g*h)+x(o*f))+x(i*u)))+A[e>>2])}function oi(e){c[(e|=0)>>2]=19636,c[5499]=c[5499]+1,z(c[e-4>>2])}function ai(e,t,n){var i,o,a,r=A[e+552>>2],s=A[t>>2],c=A[e+568>>2],l=A[t+4>>2],_=A[e+584>>2],u=A[t+8>>2],h=A[e+620>>2],f=A[e+636>>2],p=A[e+652>>2],d=x(x(x(h*A[n>>2])+x(f*A[n+4>>2]))+x(p*A[n+8>>2])),m=A[t+16>>2],v=A[t+20>>2],g=A[t+24>>2],y=x(x(x(h*A[n+16>>2])+x(f*A[n+20>>2]))+x(p*A[n+24>>2])),b=x(x(x(x(x(r*s)+x(c*l))+x(_*u))*d)+x(x(x(x(r*m)+x(c*v))+x(_*g))*y)),S=r;return r=A[t+32>>2],i=c,c=A[t+36>>2],o=_,_=A[t+40>>2],p=x(x(x(h*A[n+32>>2])+x(f*A[n+36>>2]))+x(p*A[n+40>>2])),h=s,s=A[e+556>>2],f=l,l=A[e+572>>2],a=u,u=A[e+588>>2],x(G(x(b+x(x(x(x(S*r)+x(i*c))+x(o*_))*p)),x(x(x(x(x(x(h*s)+x(f*l))+x(a*u))*d)+x(x(x(x(m*s)+x(v*l))+x(g*u))*y))+x(x(x(x(r*s)+x(c*l))+x(_*u))*p)))*A[e+732>>2])}function ri(e){return x(A[(e|=0)>>2])}function si(e){(e|=0)&&(c[5499]=c[5499]+1,z(c[e-4>>2]))}function ci(e){return x(A[4+(e|=0)>>2])}function li(e){return x(A[8+(e|=0)>>2])}function _i(e,t,n,i,o){e|=0,t=x(t),n=x(n),i=x(i),o=x(o),A[e+12>>2]=o,A[e+8>>2]=i,A[e+4>>2]=n,A[e>>2]=t}function ui(e,t,n,i){var o,a,r,s=0,c=0,l=g(s=n>>>16|0,c=e>>>16|0);return s=(65535&(c=((r=g(o=65535&n,a=65535&e))>>>16|0)+g(c,o)|0))+g(s,a)|0,O=(g(t,n)+l|0)+g(e,i)+(c>>>16)+(s>>>16)|0,65535&r|s<<16}function hi(e,t,n){var i,o,a=0,r=0,s=0,c=0,l=0,_=0,u=0;e:{t:{n:{i:{o:{a:{r:{s:{c:{l:{if(t){if(!n)break l;break c}e=(e>>>0)/(n>>>0)|0,O=0;break e}if(!e)break s;break r}if(!(n-1&n))break a;c=0-(s=(b(n)+33|0)-b(t)|0)|0;break i}e=(t>>>0)/0|0,O=0;break e}if((a=32-b(t)|0)>>>0<31)break o;break n}if(1==(0|n))break t;n=31&(a=n?31-b(n-1^n)|0:32),e=32<=(63&a)>>>0?t>>>n|(a=0):(a=t>>>n|0,((1<<n)-1&t)<<32-n|e>>>n),O=a;break e}s=a+1|0,c=63-a|0}if(r=31&(a=63&s),l=32<=a>>>0?t>>>r|(a=0):(a=t>>>r|0,((1<<r)-1&t)<<32-r|e>>>r),r=31&(c&=63),32<=c>>>0?(t=e<<r,e=0):(t=(1<<r)-1&e>>>32-r|t<<r,e<<=r),s)for(c=-1!=(0|(r=n-1|0))?0:-1;_=a<<1|l>>>31,l=(a=l<<1|t>>>31)-(o=n&(i=(l=c-(_+(r>>>0<a>>>0)|0)|0)>>31))|0,a=_-(a>>>0<o>>>0)|0,t=t<<1|e>>>31,e=u|e<<1,u=_=1&i,s=s-1|0;);O=t<<1|e>>>31,e=_|e<<1;break e}t=e=0}O=t}return e}function fi(e){var t;return(-1>>>(t=31&e)&-2)<<t|(-1<<(e=0-e&31)&-2)>>>e}o(t=p,1024,"OGPtPtoPST9emHs/2g/JP2k3rDFoISIztA8UM2ghojPbD0k/2w9Jv+TLFkDkyxbAAAAAAAAAAIDbD0lA2w9JwFB1cmUgdmlydHVhbCBmdW5jdGlvbiBjYWxsZWQhAAAAUFIAAAAAAAAAAAAAAAAAAAAZEkQ7Aj8sRxQ9MzAKGwZGS0U3D0kOFwNAHTwrNh9KLRwBICUpIQgMFRYiLhA4Pgs0MRgvQQk5ESNDMkI6BQQmKCcNKh41BxpIEyRM/wAAU3VjY2VzcwBJbGxlZ2FsIGJ5dGUgc2VxdWVuY2UARG9tYWluIGVycm9yAFJlc3VsdCBub3QgcmVwcmVzZW50YWJsZQBOb3QgYSB0dHkAUGVybWlzc2lvbiBkZW5pZWQAT3BlcmF0aW9uIG5vdCBwZXJtaXR0ZWQATm8gc3VjaCBmaWxlIG9yIGRpcmVjdG9yeQBObyBzdWNoIHByb2Nlc3MARmlsZSBleGlzdHMAVmFsdWUgdG9vIGxhcmdlIGZvciBkYXRhIHR5cGUATm8gc3BhY2UgbGVmdCBvbiBkZXZpY2UAT3V0IG9mIG1lbW9yeQBSZXNvdXJjZSBidXN5AEludGVycnVwdGVkIHN5c3RlbSBjYWxsAFJlc291cmNlIHRlbXBvcmFyaWx5IHVuYXZhaWxhYmxlAEludmFsaWQgc2VlawBDcm9zcy1kZXZpY2UgbGluawBSZWFkLW9ubHkgZmlsZSBzeXN0ZW0ARGlyZWN0b3J5IG5vdCBlbXB0eQBDb25uZWN0aW9uIHJlc2V0IGJ5IHBlZXIAT3BlcmF0aW9uIHRpbWVkIG91dABDb25uZWN0aW9uIHJlZnVzZWQASG9zdCBpcyB1bnJlYWNoYWJsZQBBZGRyZXNzIGluIHVzZQBCcm9rZW4gcGlwZQBJL08gZXJyb3IATm8gc3VjaCBkZXZpY2Ugb3IgYWRkcmVzcwBObyBzdWNoIGRldmljZQBOb3QgYSBkaXJlY3RvcnkASXMgYSBkaXJlY3RvcnkAVGV4dCBmaWxlIGJ1c3kARXhlYyBmb3JtYXQgZXJyb3IASW52YWxpZCBhcmd1bWVudABBcmd1bWVudCBsaXN0IHRvbyBsb25nAFN5bWJvbGljIGxpbmsgbG9vcABGaWxlbmFtZSB0b28gbG9uZwBUb28gbWFueSBvcGVuIGZpbGVzIGluIHN5c3RlbQBObyBmaWxlIGRlc2NyaXB0b3JzIGF2YWlsYWJsZQBCYWQgZmlsZSBkZXNjcmlwdG9yAE5vIGNoaWxkIHByb2Nlc3MAQmFkIGFkZHJlc3MARmlsZSB0b28gbGFyZ2UAVG9vIG1hbnkgbGlua3MATm8gbG9ja3MgYXZhaWxhYmxlAFJlc291cmNlIGRlYWRsb2NrIHdvdWxkIG9jY3VyAFN0YXRlIG5vdCByZWNvdmVyYWJsZQBQcmV2aW91cyBvd25lciBkaWVkAE9wZXJhdGlvbiBjYW5jZWxlZABGdW5jdGlvbiBub3QgaW1wbGVtZW50ZWQATm8gbWVzc2FnZSBvZiBkZXNpcmVkIHR5cGUASWRlbnRpZmllciByZW1vdmVkAExpbmsgaGFzIGJlZW4gc2V2ZXJlZABQcm90b2NvbCBlcnJvcgBCYWQgbWVzc2FnZQBOb3QgYSBzb2NrZXQARGVzdGluYXRpb24gYWRkcmVzcyByZXF1aXJlZABNZXNzYWdlIHRvbyBsYXJnZQBQcm90b2NvbCB3cm9uZyB0eXBlIGZvciBzb2NrZXQAUHJvdG9jb2wgbm90IGF2YWlsYWJsZQBQcm90b2NvbCBub3Qgc3VwcG9ydGVkAE5vdCBzdXBwb3J0ZWQAQWRkcmVzcyBmYW1pbHkgbm90IHN1cHBvcnRlZCBieSBwcm90b2NvbABBZGRyZXNzIG5vdCBhdmFpbGFibGUATmV0d29yayBpcyBkb3duAE5ldHdvcmsgdW5yZWFjaGFibGUAQ29ubmVjdGlvbiByZXNldCBieSBuZXR3b3JrAENvbm5lY3Rpb24gYWJvcnRlZABObyBidWZmZXIgc3BhY2UgYXZhaWxhYmxlAFNvY2tldCBpcyBjb25uZWN0ZWQAU29ja2V0IG5vdCBjb25uZWN0ZWQAT3BlcmF0aW9uIGFscmVhZHkgaW4gcHJvZ3Jlc3MAT3BlcmF0aW9uIGluIHByb2dyZXNzAFN0YWxlIGZpbGUgaGFuZGxlAFF1b3RhIGV4Y2VlZGVkAE11bHRpaG9wIGF0dGVtcHRlZABDYXBhYmlsaXRpZXMgaW5zdWZmaWNpZW50AE5vIGVycm9yIGluZm9ybWF0aW9uAAAtKyAgIDBYMHgAKG51bGwpAAAAAAAAAAAAABkACgAZGRkAAAAABQAAAAAAAAkAAAAACwAAAAAAAAAAGQARChkZGQMKBwABGwkLGAAACQYLAAALAAYZAAAAGRkZAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAABkACg0ZGRkADQAAAgAJDgAAAAkADgAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAATAAAAABMAAAAACQwAAAAAAAwAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAADwAAAAQPAAAAAAkQAAAAAAAQAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAABEAAAAAEQAAAAAJEgAAAAAAEgAAEgAAGgAAABoaGgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaAAAAGhoaAAAAAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFwAAAAAXAAAAAAkUAAAAAAAUAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABYAAAAAAAAAAAAAABUAAAAAFQAAAAAJFgAAAAAAFgAAFgAAU3VwcG9ydCBmb3IgZm9ybWF0dGluZyBsb25nIGRvdWJsZSB2YWx1ZXMgaXMgY3VycmVudGx5IGRpc2FibGVkLgpUbyBlbmFibGUgaXQsIGFkZCAtbGMtcHJpbnRzY2FuLWxvbmctZG91YmxlIHRvIHRoZSBsaW5rIGNvbW1hbmQuCgAAAAAAAAAAAAAAAAAAMDEyMzQ1Njc4OUFCQ0RFRi0wWCswWCAwWC0weCsweCAweABpbmYASU5GAG5hbgBOQU4ALgAKAFN0OXR5cGVfaW5mbwAUDgAAlw0AAE4xMF9fY3h4YWJpdjExNl9fc2hpbV90eXBlX2luZm9FAAAAADwOAACsDQAApA0AAE4xMF9fY3h4YWJpdjExN19fY2xhc3NfdHlwZV9pbmZvRQAAADwOAADcDQAA0A0AAAAAAAAADgAABAAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAAAAAAhA4AAAUAAAAOAAAACAAAAAkAAAAKAAAADwAAABAAAAARAAAATjEwX19jeHhhYml2MTIwX19zaV9jbGFzc190eXBlX2luZm9FAAAAADwOAABcDgAAAA4AAAAAAADgDgAABgAAABIAAAAIAAAACQAAAAoAAAATAAAAFAAAABUAAABOMTBfX2N4eGFiaXYxMjFfX3ZtaV9jbGFzc190eXBlX2luZm9FAAAAPA4AALgOAAAADgAAAAAAAAMAAAAEAAAABAAAAAYAAACD+aIARE5uAPwpFQDRVycA3TT1AGLbwAA8mZUAQZBDAGNR/gC73qsAt2HFADpuJADSTUIASQbgAAnqLgAcktEA6x3+ACmxHADoPqcA9TWCAES7LgCc6YQAtCZwAEF+XwDWkTkAU4M5AJz0OQCLX4QAKPm9APgfOwDe/5cAD5gFABEv7wAKWosAbR9tAM9+NgAJyycARk+3AJ5mPwAt6l8Auid1AOXrxwA9e/EA9zkHAJJSigD7a+oAH7FfAAhdjQAwA1YAe/xGAPCrawAgvM8ANvSaAOOpHQBeYZEACBvmAIWZZQCgFF8AjUBoAIDY/wAnc00ABgYxAMpWFQDJqHMAe+JgAGuMwAAZxEcAzWfDAAno3ABZgyoAi3bEAKYclgBEr90AGVfRAKU+BQAFB/8AM34/AMIy6ACYT94Au30yACY9wwAea+8An/heADUfOgB/8soA8YcdAHyQIQBqJHwA1W76ADAtdwAVO0MAtRTGAMMZnQCtxMIALE1BAAwAXQCGfUYA43EtAJvGmgAzYgAAtNJ8ALSnlwA3VdUA1z72AKMQGABNdvwAZJ0qAHDXqwBjfPgAerBXABcV5wDASVYAO9bZAKeEOAAkI8sA1op3AFpUIwAAH7kA8QobABnO3wCfMf8AZh5qAJlXYQCs+0cAfn/YACJltwAy6IkA5r9gAO/EzQBsNgkAXT/UABbe1wBYO94A3puSANIiKAAohugA4lhNAMbKMgAI4xYA4H3LABfAUADzHacAGOBbAC4TNACDEmIAg0gBAPWOWwCtsH8AHunyAEhKQwAQZ9MAqt3YAK5fQgBqYc4ACiikANOZtAAGpvIAXHd/AKPCgwBhPIgAinN4AK+MWgBv170ALaZjAPS/ywCNge8AJsFnAFXKRQDK2TYAKKjSAMJhjQASyXcABCYUABJGmwDEWcQAyMVEAE2ykQAAF/MA1EOtAClJ5QD91RAAAL78AB6UzABwzu4AEz71AOzxgACz58MAx/goAJMFlADBcT4ALgmzAAtF8wCIEpwAqyB7AC61nwBHksIAezIvAAxVbQByp5AAa+cfADHLlgB5FkoAQXniAPTfiQDolJcA4uaEAJkxlwCI7WsAX182ALv9DgBImrQAZ6RsAHFyQgCNXTIAnxW4ALzlCQCNMSUA93Q5ADAFHAANDAEASwhoACzuWABHqpAAdOcCAL3WJAD3faYAbkhyAJ8W7wCOlKYAtJH2ANFTUQDPCvIAIJgzAPVLfgCyY2gA3T5fAEBdAwCFiX8AVVIpADdkwABt2BAAMkgyAFtMdQBOcdQARVRuAAsJwQAq9WkAFGbVACcHnQBdBFAAtDvbAOp2xQCH+RcASWt9AB0nugCWaSkAxsysAK0UVACQ4moAiNmJACxyUAAEpL4AdweUAPMwcAAA/CcA6nGoAGbCSQBk4D0Al92DAKM/lwBDlP0ADYaMADFB3gCSOZ0A3XCMABe35wAI3zsAFTcrAFyAoABagJMAEBGSAA/o2ABsgK8A2/9LADiQDwBZGHYAYqUVAGHLuwDHibkAEEC9ANLyBABJdScA67b2ANsiuwAKFKoAiSYvAGSDdgAJOzMADpQaAFE6qgAdo8IAr+2uAFwmEgBtwk0ALXqcAMBWlwADP4MACfD2ACtAjABtMZkAObQHAAwgFQDYw1sA9ZLEAMatSwBOyqUApzfNAOapNgCrkpQA3UJoABlj3gB2jO8AaItSAPzbNwCuoasA3xUxAACuoQAM+9oAZE1mAO0FtwApZTAAV1a/AEf/OgBq+bkAdb7zACiT3wCrgDAAZoz2AATLFQD6IgYA2eQdAD2zpABXG48ANs0JAE5C6QATvqQAMyO1APCqGgBPZagA0sGlAAs/DwBbeM0AI/l2AHuLBACJF3IAxqZTAG9u4gDv6wAAm0pYAMTatwCqZroAds/PANECHQCx8S0AjJnBAMOtdwCGSNoA912gAMaA9ACs8C8A3eyaAD9cvADQ3m0AkMcfACrbtgCjJToAAK+aAK1TkwC2VwQAKS20AEuAfgDaB6cAdqoOAHtZoQAWEioA3LctAPrl/QCJ2/4Aib79AOR2bAAGqfwAPoBwAIVuFQD9h/8AKD4HAGFnMwAqGIYATb3qALPnrwCPbW4AlWc5ADG/WwCE10gAMN8WAMctQwAlYTUAyXDOADDLuAC/bP0ApACiAAVs5ABa3aAAIW9HAGIS0gC5XIQAcGFJAGtW4ACZUgEAUFU3AB7VtwAz8cQAE25fAF0w5ACFLqkAHbLDAKEyNgAIt6QA6rHUABb3IQCPaeQAJ/93AAwDgACNQC0AT82gACClmQCzotMAL10KALT5QgAR2ssAfb7QAJvbwQCrF70AyqKBAAhqXAAuVRcAJwBVAH8U8ADhB4YAFAtkAJZBjQCHvt4A2v0qAGsltgB7iTQABfP+ALm/ngBoak8ASiqoAE/EWgAt+LwA11qYAPTHlQANTY0AIDqmAKRXXwAUP7EAgDiVAMwgAQBx3YYAyd62AL9g9QBNZREAAQdrAIywrACywNAAUVVIAB77DgCVcsMAowY7AMBANQAG3HsA4EXMAE4p+gDWysgA6PNBAHxk3gCbZNgA2b4xAKSXwwB3WNQAaePFAPDaEwC6OjwARhhGAFV1XwDSvfUAbpLGAKwuXQAORO0AHD5CAGHEhwAp/ekA59bzACJ8ygBvkTUACODFAP/XjQBuauIAsP3GAJMIwQB8XXQAa62yAM1unQA+cnsAxhFqAPfPqQApc98Atcm6ALcAUQDisg0AdLokAOV9YAB02IoADRUsAIEYDAB+ZpQAASkWAJ96dgD9/b4AVkXvANl+NgDs2RMAi7q5AMSX/AAxqCcA8W7DAJTFNgDYqFYAtKi1AM/MDgASiS0Ab1c0ACxWiQCZzuMA1iC5AGteqgA+KpwAEV/MAP0LSgDh9PsAjjttAOKGLADp1IQA/LSpAO/u0QAuNckALzlhADghRAAb2cgAgfwKAPtKagAvHNgAU7SEAE6ZjABUIswAKlXcAMDG1gALGZYAGnC4AGmVZAAmWmAAP1LuAH8RDwD0tREA/Mv1ADS8LQA0vO4A6F3MAN1eYABnjpsAkjPvAMkXuABhWJsA4Ve8AFGDxgDYPhAA3XFIAC0c3QCvGKEAISxGAFnz1wDZepgAnlTAAE+G+gBWBvwA5XmuAIkiNgA4rSIAZ5PcAFXoqgCCJjgAyuebAFENpACZM7EAqdcOAGkFSABlsvAAf4inAIhMlwD50TYAIZKzAHuCSgCYzyEAQJ/cANxHVQDhdDoAZ+tCAP6d3wBe1F8Ae2ekALqsegBV9qIAK4gjAEG6VQBZbggAISqGADlHgwCJ4+YA5Z7UAEn7QAD/VukAHA/KAMVZigCU+isA08HFAA/FzwDbWq4AR8WGAIVDYgAhhjsALHmUABBhhwAqTHsAgCwaAEO/EgCIJpAAeDyJAKjE5ADl23sAxDrCACb06gD3Z4oADZK/AGWjKwA9k7EAvXwLAKRR3AAn3WMAaeHdAJqUGQCoKZUAaM4oAAnttABEnyAATpjKAHCCYwB+fCMAD7kyAKf1jgAUVucAIfEIALWdKgBvfk0ApRlRALX5qwCC39YAlt1hABY2AgDEOp8Ag6KhAHLtbQA5jXoAgripAGsyXABGJ1sAADTtANIAdwD89FUAAVlNAOBxgAAAAAAAAAAAAAAAAED7Ifk/AAAAAC1EdD4AAACAmEb4PAAAAGBRzHg7AAAAgIMb8DkAAABAICV6OAAAAIAiguM2AAAAAB3zaTW+8/h57GH2PxkwllvG/t6/PYivSu1x9T+k/NQyaAvbv7AQ8PA5lfQ/e7cfCotB17+FA7iwlcnzP3vPbRrpndO/pWSIDBkN8z8xtvLzmx3Qv6COC3siXvI/8Ho7Gx18yb8/NBpKSrvxP588r5Pj+cK/uuWK8Fgj8T9cjXi/y2C5v6cAmUE/lfA/zl9Htp1vqr8AAAAAAADwPwAAAAAAAAAArEea/Yxg7j899SSfyjizP6BqAh+zpOw/upE4VKl2xD/m/GpXNiDrP9LkxEoLhM4/LaqhY9HC6T8cZcbwRQbUP+1BeAPmhug/+J8bLJyO2D9iSFP13GfnP8x7sU6k4Nw/C25JyRZ20j96xnWgaRnXv926p2wKx94/yPa+SEcV578ruCplRxX3PwAAAAAAAPA/dIUV07DZ7z8PiflsWLXvP1FbEtABk+8/e1F9PLhy7z+quWgxh1TvPzhidW56OO8/4d4f9Z0e7z8VtzEK/gbvP8upOjen8e4/IjQSTKbe7j8tiWFgCM7uPycqNtXav+4/gk+dViu07j8pVEjdB6vuP4VVOrB+pO4/zTt/Zp6g7j90X+zodZ/uP4cB63MUoe4/E85MmYml7j/boCpC5azuP+XFzbA3t+4/kPCjgpHE7j9dJT6yA9XuP63TWpmf6O4/R1778nb/7j+cUoXdmxnvP2mQ79wgN+8/h6T73BhY7z9fm3szl3zvP9qQpKKvpO8/QEVuW3bQ7z8AAAAAAADoQpQjkUv4aqw/88T6UM6/zj/WUgz/Qi7mPwAAAAAAADhD/oIrZUcVR0CUI5FL+Gq8PvPE+lDOvy4/1lIM/0Iulj8AAAAA4BwAACAAAAAhAAAAIgAAACMAAAAAAAAAsBwAACAAAAAkAAAAJQAAACYAAAAUDgAAuBwAAE4xNmJ0Q29sbGlzaW9uV29ybGQxN1JheVJlc3VsdENhbGxiYWNrRQA8DgAA7BwAABAdAABOMmNjMjZjY0Nsb3Nlc3RSYXlSZXN1bHRDYWxsYmFja0UAAAA8DgAAHB0AALAcAABOMTZidENvbGxpc2lvbldvcmxkMjRDbG9zZXN0UmF5UmVzdWx0Q2FsbGJhY2tFAAAAAAAAuB0AACcAAAAoAAAAKQAAACoAAAAAAAAAfB0AACsAAAAsAAAAJQAAAC0AAAA8DgAAiB0AALAcAABOMTZidENvbGxpc2lvbldvcmxkMjRBbGxIaXRzUmF5UmVzdWx0Q2FsbGJhY2tFAAA8DgAAxB0AAHwdAABOMmNjMjZjY0FsbEhpdHNSYXlSZXN1bHRDYWxsYmFja0UAAAAAAAAADB4AAC4AAAAvAAAAMAAAADEAAAAyAAAAMwAAADQAAAAUDgAALx4AAGJ0Q29sbGlzaW9uT2JqZWN0RmxvYXREYXRhADE3YnRDb2xsaXNpb25PYmplY3QAYnRDb2xsaXNpb25TaGFwZURhdGEAMTZidENvbGxpc2lvblNoYXBlAAAUDgAAWB4AADwOAACAHgAAbB4AADEzYnRDb252ZXhTaGFwZQA8DgAAnB4AAHQeAAAyMWJ0Q29udmV4SW50ZXJuYWxTaGFwZQAAAAAAxB4AADUAAAA2AAAAFA4AAMweAAAxOGJ0Q29udmV4UG9seWhlZHJvbgAAAAAAAAAAaB8AADcAAAA4AAAAOQAAADoAAAA7AAAAPAAAAD0AAAA+AAAAPwAAACYAAABAAAAAQQAAAEIAAABDAAAARAAAAEUAAABGAAAARwAAAEgAAABJAAAASgAAAEsAAABMAAAATQAAACYAAAAmAAAAJgAAACYAAAAmAAAAJgAAACYAAAA8DgAAdB8AAJAeAAAyM2J0UG9seWhlZHJhbENvbnZleFNoYXBlAAAAPA4AAJwfAABoHwAAMzRidFBvbHloZWRyYWxDb252ZXhBYWJiQ2FjaGluZ1NoYXBlAAAAAAAAAABMIAAANwAAAE4AAABPAAAAOgAAADsAAAA8AAAAUAAAAD4AAABRAAAAUgAAAEAAAABTAAAAQgAAAEMAAABEAAAARQAAAFQAAABVAAAASAAAAFYAAABKAAAAVwAAAFgAAABNAAAAWQAAAFoAAABbAAAAXAAAAF0AAABeAAAAXwAAAGAAAAA8DgAAHiEAAGgfAAAAAAAAAAAAAAEAAAACAAAAAAAAAAEAAAACAAAAAwAAAAQAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAADAAAABAAAAAUAAAAGAAAABwAAAAUAAAAGAAAABwAAAAcAAAAAAIA/AACAvwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAIC/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAgL9idENvbnZleEludGVybmFsU2hhcGVEYXRhAEJveAAxMGJ0Qm94U2hhcGUAAAAAAACQIQAAYQAAAGIAAABjAAAAOgAAADsAAAA8AAAAZAAAAD4AAABlAAAAZgAAAGcAAABoAAAAQgAAAGkAAABqAAAARQAAAEYAAABrAAAASAAAAGwAAABKAAAASwAAAEwAAAA8DgAAvCEAAJAeAABidENhcHN1bGVTaGFwZURhdGEAQ2Fwc3VsZVNoYXBlADE0YnRDYXBzdWxlU2hhcGUAAAAAAAAAADgiAABhAAAAbQAAAG4AAAA6AAAAOwAAADwAAABvAAAAPgAAAHAAAABxAAAAcgAAAHMAAABCAAAAdAAAAHUAAABFAAAAdgAAAHcAAABIAAAAeAAAAEoAAABLAAAATAAAAHkAAAA8DgAAYiIAAJAeAABidEN5bGluZGVyU2hhcGVEYXRhAEN5bGluZGVyWQAxNWJ0Q3lsaW5kZXJTaGFwZQAAAAAA2CIAAGEAAAB6AAAAOQAAADoAAAA7AAAAPAAAAHsAAAA+AAAAfAAAAH0AAAB+AAAAQQAAAEIAAAB/AAAAgAAAAEUAAACBAAAAggAAAEgAAACDAAAASgAAAEsAAABMAAAAPA4AAPkiAACQHgAAYnRDb25lU2hhcGVEYXRhAENvbmUAMTFidENvbmVTaGFwZQAAPA4AABQjAABsHgAAMTRidENvbmNhdmVTaGFwZQAAAAAAAAAAdCMAAIQAAACFAAAAhgAAADoAAAA7AAAAPAAAAIcAAACIAAAAiQAAAIoAAABAAAAAiwAAAIwAAACNAAAAjgAAAEUAAACPAAAAPA4AAKMjAAAIIwAAYnRTdGF0aWNQbGFuZVNoYXBlRGF0YQBTVEFUSUNQTEFORQAxOGJ0U3RhdGljUGxhbmVTaGFwZQBONmJ0RGJ2dDhJQ29sbGlkZUUAABQOAAC4IwAAAAAAACQkAACQAAAAkQAAAJIAAAA6AAAAOwAAADwAAACTAAAAlAAAAJUAAACWAAAAQAAAAJcAAACYAAAAmQAAAJoAAABFAAAAmwAAAJwAAAA8DgAAXSQAAGweAABidENvbXBvdW5kU2hhcGVDaGlsZERhdGEAYnRDb21wb3VuZFNoYXBlRGF0YQAxNWJ0Q29tcG91bmRTaGFwZQAxOGJ0VHJpYW5nbGVDYWxsYmFjawAUDgAAbyQAADMxYnRJbnRlcm5hbFRyaWFuZ2xlSW5kZXhDYWxsYmFjawAAABQOAACMJAAAYnRJbnRJbmRleERhdGEAYnRTaG9ydEludEluZGV4VHJpcGxldERhdGEAYnRDaGFySW5kZXhUcmlwbGV0RGF0YQBidFZlY3RvcjNGbG9hdERhdGEAYnRWZWN0b3IzRG91YmxlRGF0YQBidE1lc2hQYXJ0RGF0YQBidFN0cmlkaW5nTWVzaEludGVyZmFjZURhdGEAMjNidFN0cmlkaW5nTWVzaEludGVyZmFjZQAAAAAUDgAASyUAAAAAAAC0JQAAnQAAAJ4AAACfAAAAoAAAAKEAAACiAAAAowAAAKQAAAClAAAApgAAAKcAAACoAAAAqQAAAKoAAACrAAAAPA4AAMAlAABoJQAAMjZidFRyaWFuZ2xlSW5kZXhWZXJ0ZXhBcnJheQAAAAAAAAAAJCYAAKwAAACtAAAAnwAAAKAAAAChAAAAogAAAKMAAACkAAAArgAAAK8AAACnAAAAqAAAAKkAAACqAAAAqwAAADwOAAAwJgAAtCUAADE0YnRUcmlhbmdsZU1lc2gAAAAAAAAAAJgmAACwAAAAsQAAALIAAAA6AAAAOwAAADwAAACzAAAAtAAAALUAAAC2AAAAQAAAAIsAAACMAAAAtwAAALgAAABFAAAAuQAAALoAAAC7AAAAPA4AAG8nAAAIIwAAAAAAALgmAAC8AAAAvQAAAL4AAAA8DgAAxCYAAIQkAAAyMVN1cHBvcnRWZXJ0ZXhDYWxsYmFjawAAAAAA8CYAAL8AAADAAAAAwQAAADwOAAD8JgAAsCQAAFpOSzE5YnRUcmlhbmdsZU1lc2hTaGFwZTE5cHJvY2Vzc0FsbFRyaWFuZ2xlc0VQMThidFRyaWFuZ2xlQ2FsbGJhY2tSSzlidFZlY3RvcjNTNF9FMTZGaWx0ZXJlZENhbGxiYWNrAFRSSUFOR0xFTUVTSAAxOWJ0VHJpYW5nbGVNZXNoU2hhcGUAAAAAAAAAAKwnAADCAAAAwwAAAMQAAADFAAAAxgAAAMcAAADIAAAAFA4AAA8oAABidE9wdGltaXplZEJ2aE5vZGVEYXRhAGJ0UXVhbnRpemVkQnZoTm9kZURhdGEAYnRCdmhTdWJ0cmVlSW5mb0RhdGEAYnRRdWFudGl6ZWRCdmhGbG9hdERhdGEAMTRidFF1YW50aXplZEJ2aAAAAAAASCgAAMkAAADKAAAAxAAAAMUAAADGAAAAxwAAAMgAAADLAAAAPA4AAFQoAACsJwAAMTRidE9wdGltaXplZEJ2aAAAAAAAAAAA+CgAAL8AAADMAAAAzQAAAAAAAACQKAAAvwAAAM4AAADPAAAAPA4AAJwoAACwJAAAWk4xNGJ0T3B0aW1pemVkQnZoNWJ1aWxkRVAyM2J0U3RyaWRpbmdNZXNoSW50ZXJmYWNlYlJLOWJ0VmVjdG9yM1M0X0UyME5vZGVUcmlhbmdsZUNhbGxiYWNrAAA8DgAABCkAALAkAABaTjE0YnRPcHRpbWl6ZWRCdmg1YnVpbGRFUDIzYnRTdHJpZGluZ01lc2hJbnRlcmZhY2ViUks5YnRWZWN0b3IzUzRfRTI5UXVhbnRpemVkTm9kZVRyaWFuZ2xlQ2FsbGJhY2sAAAAAAMQpAADQAAAA0QAAALIAAAA6AAAAOwAAADwAAADSAAAAtAAAALUAAADTAAAAQAAAAIsAAACMAAAA1AAAANUAAABFAAAA1gAAALoAAAC7AAAA1wAAANgAAAA8DgAAqCoAAJgmAAAAAAAA5CkAANkAAADaAAAA2wAAADwOAADwKQAAYCoAAFpOSzIyYnRCdmhUcmlhbmdsZU1lc2hTaGFwZTE5cHJvY2Vzc0FsbFRyaWFuZ2xlc0VQMThidFRyaWFuZ2xlQ2FsbGJhY2tSSzlidFZlY3RvcjNTNF9FMjFNeU5vZGVPdmVybGFwQ2FsbGJhY2sAAAAUDgAAaCoAADIxYnROb2RlT3ZlcmxhcENhbGxiYWNrAGJ0VHJpYW5nbGVNZXNoU2hhcGVEYXRhAEJWSFRSSUFOR0xFTUVTSAAyMmJ0QnZoVHJpYW5nbGVNZXNoU2hhcGUAAAAAAAAAANgqAADZAAAA3AAAAN0AAAA8DgAA5CoAAGAqAABaTjIyYnRCdmhUcmlhbmdsZU1lc2hTaGFwZTE0cGVyZm9ybVJheWNhc3RFUDE4YnRUcmlhbmdsZUNhbGxiYWNrUks5YnRWZWN0b3IzUzRfRTIxTXlOb2RlT3ZlcmxhcENhbGxiYWNrAAAAAABgKwAA2QAAAN4AAADfAAAAPA4AAGwrAABgKgAAWk4yMmJ0QnZoVHJpYW5nbGVNZXNoU2hhcGUxN3BlcmZvcm1Db252ZXhjYXN0RVAxOGJ0VHJpYW5nbGVDYWxsYmFja1JLOWJ0VmVjdG9yM1M0X1M0X1M0X0UyMU15Tm9kZU92ZXJsYXBDYWxsYmFjawAAAAAAAAAAZCwAADcAAADgAAAA4QAAADoAAAA7AAAAPAAAAOIAAADjAAAAPwAAAOQAAABAAAAAQQAAAEIAAABDAAAARAAAAEUAAADlAAAA5gAAAEgAAADnAAAASgAAAEsAAABMAAAATQAAAOgAAADpAAAA6gAAAOsAAADsAAAA7QAAAO4AAAA8DgAAuywAAJAfAAAAAAAAhCwAAL8AAADvAAAA8AAAADwOAACQLAAAsCQAADI2TG9jYWxTdXBwb3J0VmVydGV4Q2FsbGJhY2sAQ29udmV4VHJpbWVzaAAyNWJ0Q29udmV4VHJpYW5nbGVNZXNoU2hhcGUAAAAAAAAkLQAA8QAAAPIAAADzAAAAOgAAADsAAAA8AAAA9AAAAPUAAAD2AAAA9wAAAEAAAACLAAAAjAAAALcAAAC4AAAARQAAAPgAAAA8DgAANi0AAAgjAABFbXB0eQAxMmJ0RW1wdHlTaGFwZQAAAAAAAAAA0C0AADcAAAD5AAAA+gAAADoAAAA7AAAAPAAAAPsAAAA+AAAAPwAAAPwAAABAAAAAQQAAAEIAAABDAAAARAAAAEUAAABGAAAARwAAAEgAAABJAAAASgAAAEsAAABMAAAATQAAAP0AAAD+AAAA/wAAAAABAAABAQAAAgEAAAMBAAAEAQAAPA4AAPktAACQHwAAAQAAAAMAAAAGAAAAYnRCVV9TaW1wbGV4MXRvNAAxNmJ0QlVfU2ltcGxleDF0bzQAAAAAAFwuAAAFAQAABgEAAAcBAAA6AAAAOwAAADwAAAAIAQAACQEAAAoBAAALAQAAQAAAAIsAAACMAAAAtwAAALgAAABFAAAADAEAAA0BAAA8DgAAdC4AAAgjAABIRUlHSFRGSUVMRAAyNWJ0SGVpZ2h0ZmllbGRUZXJyYWluU2hhcGUAU1BIRVJFAAAAAAAA/C4AAGEAAAAOAQAADwEAADoAAAA7AAAAPAAAAD0AAAA+AAAAEAEAABEBAABAAAAAEgEAABMBAABDAAAARAAAAEUAAAAUAQAAFQEAAEgAAAAWAQAASgAAAEsAAABMAAAAPA4AAAgvAACQHgAAMTNidFNwaGVyZVNoYXBlAAAAAABoLwAAkAAAABcBAACSAAAAOgAAADsAAAA8AAAAkwAAAJQAAACVAAAAlgAAAEAAAACXAAAAmAAAAJkAAACaAAAARQAAAJsAAACcAAAAPA4AAH0vAAAkJAAAQ29tcG91bmQATjJjYzE1Y2NDb21wb3VuZFNoYXBlRQA8DgAAoC8AAMQvAAAzMGJ0QWN0aXZhdGluZ0NvbGxpc2lvbkFsZ29yaXRobQAAAAAUDgAAzC8AADIwYnRDb2xsaXNpb25BbGdvcml0aG0AAArXozwAAAAA/C8AABgBAAAZAQAAGgEAADwOAAAIMAAAHDAAADE3YnRHamtQYWlyRGV0ZWN0b3IAFA4AACQwAAAzNmJ0RGlzY3JldGVDb2xsaXNpb25EZXRlY3RvckludGVyZmFjZQAxMmJ0Q29udmV4Q2FzdAAAABQOAABLMAAAAAAAAHgwAAAbAQAAHAEAAB0BAAA8DgAAvzAAAFwwAAAAAAAAoDAAAB4BAAAfAQAAIAEAACEBAAAiAQAAPA4AAKwwAAC0MgAAMTZidFBvaW50Q29sbGVjdG9yADE1YnRHamtDb252ZXhDYXN0AAAAAAAAAADwMAAAHgEAACMBAAAkAQAAJQEAACYBAAA8DgAA/DAAALQyAAAxNmJ0TWFuaWZvbGRSZXN1bHQAAAAAAAAkMQAAJwEAACgBAAApAQAAPA4AAJczAAAEPAAAAAAAAEwxAAAqAQAAKwEAACwBAAAtAQAALgEAADwOAAB9MwAAlC8AAAAAAAB0MQAALwEAADABAAAxAQAAMgEAADMBAAAUDgAAfDEAAE4xMmJ0Q29udmV4Q2FzdDEwQ2FzdFJlc3VsdEUAAAAAAAAAAOwyAAAeAQAANAEAADUBAAA2AQAANwEAAAAAAAAYMgAAHgEAADgBAAA5AQAAOgEAADsBAAAAAAAA8DEAAB4BAAA8AQAAJAEAACUBAAA9AQAAPA4AAPwxAADwMAAAMjRidFBlcnR1cmJlZENvbnRhY3RSZXN1bHQAADwOAAAkMgAAtDIAAFpOMjNidENvbnZleENvbnZleEFsZ29yaXRobTE2cHJvY2Vzc0NvbGxpc2lvbkVQSzI0YnRDb2xsaXNpb25PYmplY3RXcmFwcGVyUzJfUksxNmJ0RGlzcGF0Y2hlckluZm9QMTZidE1hbmlmb2xkUmVzdWx0RTIxYnRXaXRob3V0TWFyZ2luUmVzdWx0AAAAABQOAAC8MgAATjM2YnREaXNjcmV0ZUNvbGxpc2lvbkRldGVjdG9ySW50ZXJmYWNlNlJlc3VsdEUAPA4AAPgyAAC0MgAAWk4yM2J0Q29udmV4Q29udmV4QWxnb3JpdGhtMTZwcm9jZXNzQ29sbGlzaW9uRVBLMjRidENvbGxpc2lvbk9iamVjdFdyYXBwZXJTMl9SSzE2YnREaXNwYXRjaGVySW5mb1AxNmJ0TWFuaWZvbGRSZXN1bHRFMTNidER1bW15UmVzdWx0ADIzYnRDb252ZXhDb252ZXhBbGdvcml0aG0ATjIzYnRDb252ZXhDb252ZXhBbGdvcml0aG0xMENyZWF0ZUZ1bmNFAAAAAAAA1DMAABsBAAA+AQAAPwEAADwOAADgMwAAXDAAADIyYnRTdWJzaW1wbGV4Q29udmV4Q2FzdAAAAAAAAAAABDUAAEABAABBAQAAQgEAAEMBAABEAQAAAAAAACw0AABFAQAARgEAAEcBAAA8DgAA5zQAAIQkAAAAAAAAwDQAADcAAABIAQAASQEAADoAAAA7AAAAPAAAAD0AAAA+AAAASgEAAEsBAABAAAAAQQAAAEIAAABDAAAARAAAAEUAAABGAAAATAEAAEgAAABNAQAASgAAAE4BAABPAQAATQAAAFABAABRAQAAUgEAAFMBAABUAQAAVQEAAFYBAABXAQAAPA4AANU0AABoHwAAVHJpYW5nbGUAMTVidFRyaWFuZ2xlU2hhcGUAMjRidENvbnZleFRyaWFuZ2xlQ2FsbGJhY2sAAAA8DgAAzjUAAJQvAAAAAAAAJDUAALwAAABYAQAAWQEAADwOAAAwNQAAhCQAAFpOMzNidENvbnZleENvbmNhdmVDb2xsaXNpb25BbGdvcml0aG0yMWNhbGN1bGF0ZVRpbWVPZkltcGFjdEVQMTdidENvbGxpc2lvbk9iamVjdFMxX1JLMTZidERpc3BhdGNoZXJJbmZvUDE2YnRNYW5pZm9sZFJlc3VsdEUzMUxvY2FsVHJpYW5nbGVTcGhlcmVDYXN0Q2FsbGJhY2sAMzNidENvbnZleENvbmNhdmVDb2xsaXNpb25BbGdvcml0aG0AAAAAAAAAEDYAAFoBAABbAQAAXAEAAF0BAABeAQAAPA4AAGU2AACULwAAAAAAAEA2AABfAQAAYAEAAGEBAABiAQAAYwEAAGQBAABlAQAAPA4AAEw2AADMIwAAMjJidENvbXBvdW5kTGVhZkNhbGxiYWNrADI4YnRDb21wb3VuZENvbGxpc2lvbkFsZ29yaXRobQAAAAAAoDYAAGYBAABnAQAAaAEAAGkBAABqAQAAFA4AAKg2AAAyM2J0SGFzaGVkU2ltcGxlUGFpckNhY2hlAAAAAAAAAOA2AABrAQAAbAEAAG0BAABuAQAAbwEAADwOAAA9NwAAEDYAAAAAAAAQNwAAXwEAAHABAABxAQAAcgEAAGMBAABkAQAAZQEAADwOAAAcNwAAzCMAADMwYnRDb21wb3VuZENvbXBvdW5kTGVhZkNhbGxiYWNrADM2YnRDb21wb3VuZENvbXBvdW5kQ29sbGlzaW9uQWxnb3JpdGhtAAAAAACANwAAcwEAAHQBAAB1AQAAdgEAAHcBAAA8DgAAjDcAAMQvAAAxNmJ0RW1wdHlBbGdvcml0aG0AAAAAAAC8NwAAeAEAAHkBAAB6AQAAewEAAHwBAAA8DgAAyDcAAJQvAAAzMmJ0U3BoZXJlU3BoZXJlQ29sbGlzaW9uQWxnb3JpdGhtAAAAAAAAADgAABgBAAB9AQAAfgEAADwOAAAMOAAAHDAAADIyU3BoZXJlVHJpYW5nbGVEZXRlY3RvcgAAAAAAAAAARDgAAH8BAACAAQAAgQEAAIIBAACDAQAAPA4AAFA4AACULwAAMzRidFNwaGVyZVRyaWFuZ2xlQ29sbGlzaW9uQWxnb3JpdGhtAAAAAAAAAACMOAAAGAEAAIQBAACFAQAAPA4AAJg4AAAcMAAAMTZidEJveEJveERldGVjdG9yAAAAAAAAyDgAAIYBAACHAQAAiAEAAIkBAACKAQAAPA4AANQ4AACULwAAMjZidEJveEJveENvbGxpc2lvbkFsZ29yaXRobQAAAAAAAAAAEDkAAIsBAACMAQAAjQEAAI4BAACPAQAAPA4AABw5AADELwAAMzFidENvbnZleFBsYW5lQ29sbGlzaW9uQWxnb3JpdGhtAAAAAQAAAAIAAAAAAAAAAgAAAAAAAAABAAAAAAAAAGw5AACQAQAAkQEAAJIBAAA8DgAAeDkAAJw5AAAzMGJ0R2prRXBhUGVuZXRyYXRpb25EZXB0aFNvbHZlcgAAAAAUDgAApDkAADMwYnRDb252ZXhQZW5ldHJhdGlvbkRlcHRoU29sdmVyAAAAAAAAAADkOQAAHgEAAJMBAACUAQAAlQEAAJYBAAA8DgAA8DkAALQyAABaTjMzYnRNaW5rb3dza2lQZW5ldHJhdGlvbkRlcHRoU29sdmVyMTJjYWxjUGVuRGVwdGhFUjIyYnRWb3Jvbm9pU2ltcGxleFNvbHZlclBLMTNidENvbnZleFNoYXBlUzRfUksxMWJ0VHJhbnNmb3JtUzdfUjlidFZlY3RvcjNTOV9TOV9QMTJidElEZWJ1Z0RyYXdFMjBidEludGVybWVkaWF0ZVJlc3VsdAAAAAAAALA6AACQAQAAlwEAAJgBAAA8DgAAvDoAAJw5AAAzM2J0TWlua293c2tpUGVuZXRyYXRpb25EZXB0aFNvbHZlcgAAAAAAYD4AAJkBAACaAQAAmwEAAJwBAACdAQAAngEAAAAAAAAgPgAAnwEAAKABAAChAQAAAAAAANg9AACfAQAAogEAAKMBAAAAAAAAnD0AAJ8BAACkAQAApQEAAAAAAABYPQAAnwEAAKYBAACnAQAAAAAAABg9AACfAQAAqAEAAKkBAAAAAAAA6DwAAJ8BAACqAQAAqwEAAAAAAACoPAAAnwEAAKwBAACtAQAAAAAAAGg8AACfAQAArgEAAK8BAAAAAAAAMDwAAJ8BAACwAQAAsQEAAAAAAADIOwAAnwEAALIBAACzAQAAPA4AANQ7AAAEPAAATjMxYnRDb252ZXhQbGFuZUNvbGxpc2lvbkFsZ29yaXRobTEwQ3JlYXRlRnVuY0UAFA4AAAw8AAAzMGJ0Q29sbGlzaW9uQWxnb3JpdGhtQ3JlYXRlRnVuYwAAAAA8DgAAPDwAAAQ8AABOMjZidEJveEJveENvbGxpc2lvbkFsZ29yaXRobTEwQ3JlYXRlRnVuY0UAADwOAAB0PAAABDwAAE4zNGJ0U3BoZXJlVHJpYW5nbGVDb2xsaXNpb25BbGdvcml0aG0xMENyZWF0ZUZ1bmNFAAA8DgAAtDwAAAQ8AABOMzJidFNwaGVyZVNwaGVyZUNvbGxpc2lvbkFsZ29yaXRobTEwQ3JlYXRlRnVuY0UAAAAAPA4AAPQ8AAAEPAAATjE2YnRFbXB0eUFsZ29yaXRobTEwQ3JlYXRlRnVuY0UAAAAAPA4AACQ9AAAEPAAATjI4YnRDb21wb3VuZENvbGxpc2lvbkFsZ29yaXRobTE3U3dhcHBlZENyZWF0ZUZ1bmNFADwOAABkPQAABDwAAE4zNmJ0Q29tcG91bmRDb21wb3VuZENvbGxpc2lvbkFsZ29yaXRobTEwQ3JlYXRlRnVuY0UAAAAAPA4AAKg9AAAEPAAATjI4YnRDb21wb3VuZENvbGxpc2lvbkFsZ29yaXRobTEwQ3JlYXRlRnVuY0UAAAAAPA4AAOQ9AAAEPAAATjMzYnRDb252ZXhDb25jYXZlQ29sbGlzaW9uQWxnb3JpdGhtMTdTd2FwcGVkQ3JlYXRlRnVuY0UAAAAAPA4AACw+AAAEPAAATjMzYnRDb252ZXhDb25jYXZlQ29sbGlzaW9uQWxnb3JpdGhtMTBDcmVhdGVGdW5jRQAAADwOAABsPgAAkD4AADMxYnREZWZhdWx0Q29sbGlzaW9uQ29uZmlndXJhdGlvbgAAABQOAACYPgAAMjRidENvbGxpc2lvbkNvbmZpZ3VyYXRpb24AMTJidERpc3BhdGNoZXIAAAAUDgAAsz4AAAAAAAAUPwAAtAEAALUBAAC2AQAAtwEAALgBAAC5AQAAugEAALsBAAC8AQAAvQEAAL4BAAC/AQAAwAEAAMEBAADCAQAAwwEAADwOAAB4PwAAxD4AAAAAAAA0PwAAxAEAAMUBAADGAQAAPA4AAEA/AABcPwAAMjNidENvbGxpc2lvblBhaXJDYWxsYmFjawAAABQOAABkPwAAMTdidE92ZXJsYXBDYWxsYmFjawAyMWJ0Q29sbGlzaW9uRGlzcGF0Y2hlcgAAAAAA3D8AAMcBAADIAQAAyQEAAMoBAADLAQAAzAEAAM0BAADOAQAAzwEAANABAADRAQAA0gEAANMBAADUAQAA1QEAANYBAADXAQAAPA4AABlBAAA4QQAAAAAAAPw/AADEAQAA2AEAANkBAAA8DgAACEAAAFw/AABaTjI4YnRIYXNoZWRPdmVybGFwcGluZ1BhaXJDYWNoZTE5Y2xlYW5Qcm94eUZyb21QYWlyc0VQMTdidEJyb2FkcGhhc2VQcm94eVAxMmJ0RGlzcGF0Y2hlckUxN0NsZWFuUGFpckNhbGxiYWNrAAAAAAAAAIxAAADEAQAA2gEAANsBAAA8DgAAmEAAAFw/AABaTjI4YnRIYXNoZWRPdmVybGFwcGluZ1BhaXJDYWNoZTM3cmVtb3ZlT3ZlcmxhcHBpbmdQYWlyc0NvbnRhaW5pbmdQcm94eUVQMTdidEJyb2FkcGhhc2VQcm94eVAxMmJ0RGlzcGF0Y2hlckUxOFJlbW92ZVBhaXJDYWxsYmFjawAyOGJ0SGFzaGVkT3ZlcmxhcHBpbmdQYWlyQ2FjaGUAPA4AAERBAABgQQAAMjJidE92ZXJsYXBwaW5nUGFpckNhY2hlAAAAABQOAABoQQAAMjVidE92ZXJsYXBwaW5nUGFpckNhbGxiYWNrAAAAAADEQQAA3AEAAN0BAADeAQAA3wEAAOABAADhAQAA4gEAAOMBAADkAQAA5QEAAOYBAADnAQAA6AEAAOkBAAA8DgAApkIAALxCAAAAAAAA9EEAAF8BAADqAQAA6wEAAOwBAABjAQAAZAEAAGUBAAA8DgAAAEIAAMwjAAAxOGJ0RGJ2dFRyZWVDb2xsaWRlcgAAAAAAAAAAPEIAAF8BAADtAQAAYQEAAO4BAABjAQAAZAEAAGUBAAA8DgAASEIAAMwjAAAyMEJyb2FkcGhhc2VBYWJiVGVzdGVyAAAAAAAAhEIAAF8BAADvAQAAYQEAAPABAABjAQAAZAEAAGUBAAA8DgAAkEIAAMwjAAAxOUJyb2FkcGhhc2VSYXlUZXN0ZXIAMTZidERidnRCcm9hZHBoYXNlAAAAABQOAADEQgAAMjFidEJyb2FkcGhhc2VJbnRlcmZhY2UAAAAAAABDAADxAQAA8gEAADAAAAAxAAAA8wEAAPQBAAD1AQAAPA4AACFDAAAMHgAAYnRSaWdpZEJvZHlGbG9hdERhdGEAMTFidFJpZ2lkQm9keQAAAAAAAGxDAAD2AQAA9wEAAPgBAAD5AQAA+gEAAPsBAAD8AQAA/QEAAP4BAAD/AQAAAAIAAAECAAACAgAAPA4AAHhDAACgQwAAMzVidFNlcXVlbnRpYWxJbXB1bHNlQ29uc3RyYWludFNvbHZlcgAAABQOAACoQwAAMThidENvbnN0cmFpbnRTb2x2ZXIAAAAAAAAAANRDAAAbAQAAAwIAAAQCAAA8DgAA4EMAAFwwAAAyN2J0Q29udGludW91c0NvbnZleENvbGxpc2lvbgAAADwOAAAMRAAAhCQAADI1YnRUcmlhbmdsZVJheWNhc3RDYWxsYmFjawAAAAAAQEQAALwAAAAFAgAABgIAACYAAAA8DgAATEQAAIQkAAAyOGJ0VHJpYW5nbGVDb252ZXhjYXN0Q2FsbGJhY2sAAAAAAACoRAAABwIAAAgCAAAJAgAACgIAAAsCAAAMAgAADQIAAA4CAAAPAgAAEAIAABECAAASAgAAEwIAABQOAABnSAAAAAAAAMREAAAUAgAAFQIAABYCAAA8DgAA40YAAPxGAAAAAAAAREYAALwAAAAXAgAAGAIAABkCAAAAAAAAuEUAAF8BAAAaAgAAYQEAABsCAABjAQAAZAEAAGUBAAAAAAAAJEUAACAAAAAcAgAAHQIAAB4CAAA8DgAAMEUAALAcAABaTjE2YnRDb2xsaXNpb25Xb3JsZDIxcmF5VGVzdFNpbmdsZUludGVybmFsRVJLMTFidFRyYW5zZm9ybVMyX1BLMjRidENvbGxpc2lvbk9iamVjdFdyYXBwZXJSTlNfMTdSYXlSZXN1bHRDYWxsYmFja0VFMTVMb2NhbEluZm9BZGRlcjIAAAAAPA4AAMRFAADMIwAAWk4xNmJ0Q29sbGlzaW9uV29ybGQyMXJheVRlc3RTaW5nbGVJbnRlcm5hbEVSSzExYnRUcmFuc2Zvcm1TMl9QSzI0YnRDb2xsaXNpb25PYmplY3RXcmFwcGVyUk5TXzE3UmF5UmVzdWx0Q2FsbGJhY2tFRTlSYXlUZXN0ZXIAAAA8DgAAUEYAAABEAABaTjE2YnRDb2xsaXNpb25Xb3JsZDIxcmF5VGVzdFNpbmdsZUludGVybmFsRVJLMTFidFRyYW5zZm9ybVMyX1BLMjRidENvbGxpc2lvbk9iamVjdFdyYXBwZXJSTlNfMTdSYXlSZXN1bHRDYWxsYmFja0VFMjlCcmlkZ2VUcmlhbmdsZVJheWNhc3RDYWxsYmFjawAxOWJ0U2luZ2xlUmF5Q2FsbGJhY2sAAAAAPA4AAAhHAAAkRwAAMjNidEJyb2FkcGhhc2VSYXlDYWxsYmFjawAAABQOAAAsRwAAMjRidEJyb2FkcGhhc2VBYWJiQ2FsbGJhY2sAAAAAAAB0RwAAHwIAACACAAAhAgAAIgIAAPz///90RwAAIwIAACQCAAAlAgAAmA4AAJRHAAAAAAAAAgAAAIQkAAACAAAAsCQAAAIEAAAxN0RlYnVnRHJhd2NhbGxiYWNrAE92ZXJmbG93IGluIEFBQkIsIG9iamVjdCByZW1vdmVkIGZyb20gc2ltdWxhdGlvbgBJZiB5b3UgY2FuIHJlcHJvZHVjZSB0aGlzLCBwbGVhc2UgZW1haWwgYnVnc0Bjb250aW51b3VzcGh5c2ljcy5jb20KAFBsZWFzZSBpbmNsdWRlIGFib3ZlIGluZm9ybWF0aW9uLCB5b3VyIFBsYXRmb3JtLCB2ZXJzaW9uIG9mIE9TLgoAVGhhbmtzLgoAMTZidENvbGxpc2lvbldvcmxkAAAAAAAAAHxLAAC8AAAAJgIAAAYCAAAnAgAAAAAAALxKAAC8AAAAKAIAAAYCAAApAgAAAAAAAAhKAABfAQAAKgIAAGEBAAArAgAAYwEAAGQBAABlAQAAAAAAAOhIAAAsAgAALQIAAC4CAAAvAgAAPA4AAPRIAADUSQAAWlpOMTZidENvbGxpc2lvbldvcmxkMjVvYmplY3RRdWVyeVNpbmdsZUludGVybmFsRVBLMTNidENvbnZleFNoYXBlUksxMWJ0VHJhbnNmb3JtUzVfUEsyNGJ0Q29sbGlzaW9uT2JqZWN0V3JhcHBlclJOU18yMENvbnZleFJlc3VsdENhbGxiYWNrRWZFTjIyYnRDb21wb3VuZExlYWZDYWxsYmFjazEyUHJvY2Vzc0NoaWxkRWlTNV9QSzE2YnRDb2xsaXNpb25TaGFwZUUxNExvY2FsSW5mb0FkZGVyAAAUDgAA3EkAAE4xNmJ0Q29sbGlzaW9uV29ybGQyMENvbnZleFJlc3VsdENhbGxiYWNrRQAAPA4AABRKAADMIwAAWk4xNmJ0Q29sbGlzaW9uV29ybGQyNW9iamVjdFF1ZXJ5U2luZ2xlSW50ZXJuYWxFUEsxM2J0Q29udmV4U2hhcGVSSzExYnRUcmFuc2Zvcm1TNV9QSzI0YnRDb2xsaXNpb25PYmplY3RXcmFwcGVyUk5TXzIwQ29udmV4UmVzdWx0Q2FsbGJhY2tFZkUyMmJ0Q29tcG91bmRMZWFmQ2FsbGJhY2sAAAAAPA4AAMhKAABARAAAWk4xNmJ0Q29sbGlzaW9uV29ybGQyNW9iamVjdFF1ZXJ5U2luZ2xlSW50ZXJuYWxFUEsxM2J0Q29udmV4U2hhcGVSSzExYnRUcmFuc2Zvcm1TNV9QSzI0YnRDb2xsaXNpb25PYmplY3RXcmFwcGVyUk5TXzIwQ29udmV4UmVzdWx0Q2FsbGJhY2tFZkUzMkJyaWRnZVRyaWFuZ2xlQ29udmV4Y2FzdENhbGxiYWNrXzAAAAAAPA4AAIhLAABARAAAWk4xNmJ0Q29sbGlzaW9uV29ybGQyNW9iamVjdFF1ZXJ5U2luZ2xlSW50ZXJuYWxFUEsxM2J0Q29udmV4U2hhcGVSSzExYnRUcmFuc2Zvcm1TNV9QSzI0YnRDb2xsaXNpb25PYmplY3RXcmFwcGVyUk5TXzIwQ29udmV4UmVzdWx0Q2FsbGJhY2tFZkUzMkJyaWRnZVRyaWFuZ2xlQ29udmV4Y2FzdENhbGxiYWNrAAAAAAAATEwAABQCAAAwAgAAMQIAADwOAABYTAAA/EYAADIxYnRTaW5nbGVTd2VlcENhbGxiYWNrAAAAAACITAAAMgIAADMCAAA0AgAANQIAABQOAACQTAAAMjVidFNpbXVsYXRpb25Jc2xhbmRNYW5hZ2VyAAAAAADgTAAANgIAADcCAAA4AgAAOQIAACYAAAAmAAAAOgIAACYAAAAmAAAAOwIAADwCAACYDgAAE00AAAAAAAABAAAAKE0AAAIEAABidFR5cGVkQ29uc3RyYWludEZsb2F0RGF0YQAxN2J0VHlwZWRDb25zdHJhaW50AAAUDgAAME0AADEzYnRUeXBlZE9iamVjdAAAAAAAfE4AAD0CAAA+AgAACQIAAAoCAAALAgAADAIAAD8CAAAOAgAADwIAAEACAABBAgAAEgIAAEICAABDAgAARAIAAEUCAABGAgAARwIAAEgCAABJAgAASgIAAEsCAABMAgAATQIAAE4CAABPAgAAUAIAAFECAABSAgAAUwIAAFQCAABVAgAAVgIAAFcCAABYAgAAWQIAAFoCAABbAgAAXAIAAF0CAABeAgAAXwIAAGACAABhAgAAYgIAAGMCAABkAgAAAAAAABhOAABlAgAAZgIAAGcCAAA8DgAAJE4AAEROAAAyN0lucGxhY2VTb2x2ZXJJc2xhbmRDYWxsYmFjawAAABQOAABMTgAATjI1YnRTaW11bGF0aW9uSXNsYW5kTWFuYWdlcjE0SXNsYW5kQ2FsbGJhY2tFAAAAPA4AAOpOAAAETwAAAAAAAKBOAAAsAgAAaAIAAGkCAABqAgAAPA4AAKxOAACoUAAAMzRidENsb3Nlc3ROb3RNZUNvbnZleFJlc3VsdENhbGxiYWNrAGJ0RHluYW1pY3NXb3JsZEZsb2F0RGF0YQAyM2J0RGlzY3JldGVEeW5hbWljc1dvcmxkADwOAAAQTwAAqEQAADE1YnREeW5hbWljc1dvcmxkAAAAAAAAAExQAABrAgAAbAIAAAkCAAAKAgAACwIAAAwCAAA/AgAADgIAAA8CAABAAgAAQQIAABICAABCAgAAQwIAAEQCAABFAgAARgIAAEcCAABIAgAASQIAAEoCAABLAgAATAIAAE0CAABOAgAATwIAAFACAABRAgAAUgIAAFMCAABUAgAAVQIAAFYCAABXAgAAWAIAAFkCAABaAgAAWwIAAFwCAABdAgAAXgIAAG0CAABgAgAAYQIAAG4CAABjAgAAZAIAAAAAAAD8TwAAbwIAAHACAABxAgAAPA4AAAhQAAAoUAAATjJjYzIzY2NPdmVybGFwRmlsdGVyQ2FsbGJhY2tFAAAUDgAAMFAAADIzYnRPdmVybGFwRmlsdGVyQ2FsbGJhY2sAAAA8DgAA5lAAAHxOAAAAAAAAcFAAACwCAAByAgAAcwIAAHQCAAA8DgAAfFAAAKhQAABOMmNjMzRjY05vdE1lQ2xvc2VzdENvbnZleFJlc3VsdENhbGxiYWNrRQAAADwOAAC0UAAA1EkAAE4xNmJ0Q29sbGlzaW9uV29ybGQyN0Nsb3Nlc3RDb252ZXhSZXN1bHRDYWxsYmFja0UATjJjYzIzY2NEaXNjcmV0ZUR5bmFtaWNzV29ybGRFAAAAAAAAAABAUQAANgIAAHUCAAB2AgAAOQIAAHcCAAB4AgAAOgIAAHkCAAB6AgAAewIAAHwCAAB9AgAAPA4AAGdRAADgTAAAYnRIaW5nZUNvbnN0cmFpbnRGbG9hdERhdGEAMTdidEhpbmdlQ29uc3RyYWludAAAAAAAALRRAAA2AgAAfgIAAH8CAAA5AgAAgAIAAIECAAA6AgAAggIAAIMCAACEAgAAhQIAAIYCAAA8DgAA4VEAAOBMAABidFBvaW50MlBvaW50Q29uc3RyYWludEZsb2F0RGF0YQAyM2J0UG9pbnQyUG9pbnRDb25zdHJhaW50AAAAAAAAFFIAAIcCAACIAgAAiQIAAIoCAAA8DgAAIFIAADhSAABOMmNjMTNjY01vdGlvblN0YXRlRQAAAAAUDgAAQFIAADEzYnRNb3Rpb25TdGF0ZQA="),o(t,21072,"BQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAwAAAMxVAAAAAAAAAAAAAAAAAAACAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="),o(t,21184,"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=");var pi=[null,function(e){var t=0;return t=0,(e=0|I(c[56+(e|=0)>>2]))&&(c[5420]=e,t=-1),0|t},function(e,t,n){e|=0,t|=0;var i,o,a=0,r=0,s=0,l=0;c[12+(N=o=N-16|0)>>2]=n|=0,c[8+o>>2]=t,t=c[e+24>>2],c[o>>2]=t,t=c[e+20>>2]-t|0,c[4+o>>2]=t;e:{if((0|(a=H(c[e+56>>(s=2)],o,2)))!=(0|(l=t+n|0)))for(t=o;;){if((0|a)<=-1){if(c[e+24>>2]=0,c[e+16>>2]=0,c[e+20>>2]=0,c[e>>2]=32|c[e>>2],2==((e=0)|s))break e;e=n-c[t+4>>2]|0;break e}if(r=c[t+4>>2],c[(t=(i=r>>>0<a>>>0)?t+8|0:t)>>2]=(r=a-(i?r:0)|0)+c[t>>2],c[t+4>>2]=c[t+4>>2]-r,(0|(l=l-a|0))==(0|(a=H(c[e+56>>2],t,s=s-i|0))))break}t=c[e+40>>2],c[e+24>>2]=t,c[e+20>>2]=t,c[e+16>>2]=t+c[e+44>>2],e=n}return N=16+o|0,0|e},function(e,t,n,i){var o;return N=o=N-16|0,e=(e=0|D(c[56+(e|=0)>>2],0|(t|=0),0|(n|=0),255&(i|=0),8+o|0))?(c[5420]=76==(0|e)?70:e,t=-1):(t=c[12+o>>2],c[8+o>>2]),N=16+o|0,O=t,0|e},$,ee,ee,function(e){var t;c[12+(N=t=N-16|0)>>2]=e|=0,$(e=c[12+t>>2]),V(e),N=16+t|0},K,K,function(e,t,n){t|=0,n|=0;var i,o;if(c[72+(N=o=N-80|0)>>2]=e|=0,c[68+o>>2]=t,c[64+o>>2]=n,1&ne(t=c[72+o>>2],c[68+o>>2],0))a[79+o|0]=1;else{if(n=c[68+(i=o)>>2]){if(c[92+(N=e=N-96|0)>>2]=n,c[e+88>>2]=3536,c[e+84>>2]=3584,c[e+80>>2]=0,c[e+76>>2]=c[c[e+92>>2]>>2],c[e+72>>2]=c[c[e+76>>2]-8>>2],c[e+68>>2]=c[e+92>>2]+c[e+72>>2],c[e+64>>2]=c[c[e+76>>2]-4>>2],c[e+60>>2]=0,c[e>>2]=c[e+84>>2],c[e+4>>2]=c[e+92>>2],c[e+8>>2]=c[e+88>>2],c[e+12>>2]=c[e+80>>2],c[e+16>>2]=0,c[e+20>>2]=0,c[e+24>>2]=0,c[e+28>>2]=0,c[e+32>>2]=0,c[e+36>>2]=0,c[e+40>>2]=0,c[e+44>>2]=0,c[e+48>>2]=0,a[e+52|0]=0,a[e+53|0]=0,a[e+54|0]=0,1&ne(c[e+64>>2],c[e+84>>2],0))c[e+48>>2]=1,n=c[e+64>>2],pi[c[c[n>>2]+20>>2]](n,e,c[e+68>>2],c[e+68>>2],1,0),1==c[e+24>>2]&&(c[e+60>>2]=c[e+68>>2]);else if(n=c[e+64>>2],pi[c[c[n>>2]+24>>2]](n,e,c[e+68>>2],1,0),!(1<(n=c[e+36>>2])>>>0))if(1==(0|n))e:{if(1!=c[e+24>>2]){if(c[e+40>>2])break e;if(1!=c[e+28>>2])break e;if(1!=c[e+32>>2])break e}c[e+60>>2]=c[e+16>>2]}else 1==c[e+40>>2]&&1==c[e+28>>2]&&1==c[e+32>>2]&&(c[e+60>>2]=c[e+20>>2]);N=e+96|0,e=c[e+60>>2]}else e=0;c[60+i>>2]=e,c[60+o>>2]?(c[o>>2]=c[60+o>>2],c[4+o>>2]=0,c[8+o>>2]=t,c[12+o>>2]=-1,c[16+o>>2]=0,c[20+o>>2]=0,c[24+o>>2]=0,c[28+o>>2]=0,c[32+o>>2]=0,c[36+o>>2]=0,c[40+o>>2]=0,c[44+o>>2]=0,c[48+o>>2]=0,a[52+o|0]=0,a[53+o|0]=0,a[54+o|0]=0,c[48+o>>2]=1,e=c[60+o>>2],pi[c[c[e>>2]+28>>2]](e,o,c[c[64+o>>2]>>2],1),1!=c[24+o>>2]?a[79+o|0]=0:(c[c[64+o>>2]>>2]=c[16+o>>2],a[79+o|0]=1)):a[79+o|0]=0}return N=80+o|0,1&a[79+o|0]},function(e,t,n,i,o,r){t|=0,n|=0,i|=0,o|=0,r|=0;var s;c[28+(N=s=N-32|0)>>2]=e|=0,c[24+s>>2]=t,c[20+s>>2]=n,c[16+s>>2]=i,c[12+s>>2]=o,a[11+s|0]=r,1&ne(e=c[28+s>>2],c[c[24+s>>2]+8>>2],1&a[11+s|0])&&ae(e,c[24+s>>2],c[20+s>>2],c[16+s>>2],c[12+s>>2]),N=32+s|0},function(e,t,n,i,o){t|=0,n|=0,i|=0,o|=0;var r;c[28+(N=r=N-32|0)>>2]=e|=0,c[24+r>>2]=t,c[20+r>>2]=n,c[16+r>>2]=i,a[15+r|0]=o,1&ne(e=c[28+r>>2],c[c[24+r>>2]+8>>2],1&a[15+r|0])?re(e,c[24+r>>2],c[20+r>>2],c[16+r>>2]):1&ne(e,c[c[24+r>>2]>>2],1&a[15+r|0])&&(c[20+r>>2]!=c[c[24+r>>2]+20>>2]&&c[20+r>>2]!=c[c[24+r>>2]+16>>2]?(c[c[24+r>>2]+32>>2]=c[16+r>>2],c[c[24+r>>2]+20>>2]=c[20+r>>2],e=c[24+r>>2],c[e+40>>2]=c[e+40>>2]+1,1==c[c[24+r>>2]+36>>2]&&2==c[c[24+r>>2]+24>>2]&&(a[c[24+r>>2]+54|0]=1),c[c[24+r>>2]+44>>2]=4):1==c[16+r>>2]&&(c[c[24+r>>2]+32>>2]=1)),N=32+r|0},function(e,t,n,i){t|=0,n|=0,i|=0;var o;c[12+(N=o=N-16|0)>>2]=e|=0,c[8+o>>2]=t,c[4+o>>2]=n,c[o>>2]=i,1&ne(e=c[12+o>>2],c[c[8+o>>2]+8>>2],0)&&ie(e,c[8+o>>2],c[4+o>>2],c[o>>2]),N=16+o|0},te,function(e,t,n,i,o,r){t|=0,n|=0,i|=0,o|=0,r|=0;var s;c[28+(N=s=N-32|0)>>2]=e|=0,c[24+s>>2]=t,c[20+s>>2]=n,c[16+s>>2]=i,c[12+s>>2]=o,a[11+s|0]=r,1&ne(e=c[28+s>>2],c[c[24+s>>2]+8>>2],1&a[11+s|0])?ae(e,c[24+s>>2],c[20+s>>2],c[16+s>>2],c[12+s>>2]):(e=c[e+8>>2],pi[c[c[e>>2]+20>>2]](e,c[24+s>>2],c[20+s>>2],c[16+s>>2],c[12+s>>2],1&a[11+s|0])),N=32+s|0},function(e,t,n,i,o){t|=0,n|=0,i|=0,o|=0;var r;c[28+(N=r=N-32|0)>>2]=e|=0,c[24+r>>2]=t,c[20+r>>2]=n,c[16+r>>2]=i,a[15+r|0]=o,1&ne(e=c[28+r>>2],c[c[24+r>>2]+8>>2],1&a[15+r|0])?re(e,c[24+r>>2],c[20+r>>2],c[16+r>>2]):1&ne(e,c[c[24+r>>2]>>2],1&a[15+r|0])?c[20+r>>2]!=c[c[24+r>>2]+20>>2]&&c[20+r>>2]!=c[c[24+r>>2]+16>>2]?(c[c[24+r>>2]+32>>2]=c[16+r>>2],a[14+r|0]=0,4!=c[c[24+r>>2]+44>>2]&&(a[13+r|0]=0,a[c[24+r>>2]+52|0]=0,a[c[24+r>>2]+53|0]=0,e=c[e+8>>2],pi[c[c[e>>2]+20>>2]](e,c[24+r>>2],c[20+r>>2],c[20+r>>2],1,1&a[15+r|0]),1&a[c[24+r>>2]+53|0]&&(a[13+r|0]=1)&a[c[24+r>>2]+52|0]&&(a[14+r|0]=1),1&a[13+r|0]?c[c[24+r>>2]+44>>2]=3:c[c[24+r>>2]+44>>2]=4),1&a[14+r|0]||(c[c[24+r>>2]+20>>2]=c[20+r>>2],e=c[24+r>>2],c[e+40>>2]=c[e+40>>2]+1,1==c[c[24+r>>2]+36>>2]&&2==c[c[24+r>>2]+24>>2]&&(a[c[24+r>>2]+54|0]=1))):1==c[16+r>>2]&&(c[c[24+r>>2]+32>>2]=1):(e=c[e+8>>2],pi[c[c[e>>2]+24>>2]](e,c[24+r>>2],c[20+r>>2],c[16+r>>2],1&a[15+r|0])),N=32+r|0},function(e,t,n,i){t|=0,n|=0,i|=0;var o;c[12+(N=o=N-16|0)>>2]=e|=0,c[8+o>>2]=t,c[4+o>>2]=n,c[o>>2]=i,1&ne(e=c[12+o>>2],c[c[8+o>>2]+8>>2],0)?ie(e,c[8+o>>2],c[4+o>>2],c[o>>2]):(e=c[e+8>>2],pi[c[c[e>>2]+28>>2]](e,c[8+o>>2],c[4+o>>2],c[o>>2])),N=16+o|0},te,function(e,t,n,i,o,r){t|=0,n|=0,i|=0,o|=0,r|=0;var s;if(c[28+(N=s=N-32|0)>>2]=e|=0,c[24+s>>2]=t,c[20+s>>2]=n,c[16+s>>2]=i,c[12+s>>2]=o,a[11+s|0]=r,1&ne(e=c[28+s>>2],c[c[24+s>>2]+8>>2],1&a[11+s|0]))ae(e,c[24+s>>2],c[20+s>>2],c[16+s>>2],c[12+s>>2]);else{if(a[10+s|0]=1&a[c[24+s>>2]+52|0],a[9+s|0]=1&a[c[24+s>>2]+53|0],c[4+s>>2]=(e+16|0)+(c[e+12>>2]<<3),c[s>>2]=e+16,a[c[24+s>>2]+52|0]=0,a[c[24+s>>2]+53|0]=0,se(c[s>>2],c[24+s>>2],c[20+s>>2],c[16+s>>2],c[12+s>>2],1&a[11+s|0]),a[10+s|0]=1&a[c[24+s>>2]+52|0]|1&a[10+s|0],a[9+s|0]=1&a[c[24+s>>2]+53|0]|1&a[9+s|0],t=c[s>>2]+8|0,(c[s>>2]=t)>>>0<m[4+s>>2])for(;;){e:if(!(1&a[c[24+s>>2]+54|0])){if(1&a[c[24+s>>2]+52|0]){if(1==c[c[24+s>>2]+24>>2])break e;if(!(2&c[e+8>>2]))break e}else if(!(1&c[e+8>>2])&&1&a[c[24+s>>2]+53|0])break e;if(a[c[24+s>>2]+52|0]=0,a[c[24+s>>2]+53|0]=0,se(c[s>>2],c[24+s>>2],c[20+s>>2],c[16+s>>2],c[12+s>>2],1&a[11+s|0]),a[10+s|0]=1&a[c[24+s>>2]+52|0]|1&a[10+s|0],a[9+s|0]=1&a[c[24+s>>2]+53|0]|1&a[9+s|0],t=c[s>>2]+8|0,(c[s>>2]=t)>>>0<m[4+s>>2])continue}break}a[c[24+s>>2]+52|0]=1&a[10+s|0],a[c[24+s>>2]+53|0]=1&a[9+s|0]}N=32+s|0},function(e,t,n,i,o){t|=0,n|=0,i|=0,o|=0;var r;if(c[44+(N=r=N-48|0)>>2]=e|=0,c[40+r>>2]=t,c[36+r>>2]=n,c[32+r>>2]=i,a[31+r|0]=o,1&ne(e=c[44+r>>2],c[c[40+r>>2]+8>>2],1&a[31+r|0]))re(e,c[40+r>>2],c[36+r>>2],c[32+r>>2]);else if(1&ne(e,c[c[40+r>>2]>>2],1&a[31+r|0]))if(c[36+r>>2]!=c[c[40+r>>2]+20>>2]&&c[36+r>>2]!=c[c[40+r>>2]+16>>2]){if(c[c[40+r>>2]+32>>2]=c[32+r>>2],a[30+r|0]=0,4!=c[c[40+r>>2]+44>>2]){for(a[29+r|0]=0,c[24+r>>2]=(e+16|0)+(c[e+12>>2]<<3),c[20+r>>2]=e+16;;){e:if(!(m[20+r>>2]>=m[24+r>>2]||(a[c[40+r>>2]+52|0]=0,a[c[40+r>>2]+53|0]=0,se(c[20+r>>2],c[40+r>>2],c[36+r>>2],c[36+r>>2],1,1&a[31+r|0]),1&a[c[40+r>>2]+54|0]))){if(1&a[c[40+r>>2]+53|0])if((a[29+r|0]=1)&a[c[40+r>>2]+52|0]){if((a[30+r|0]=1)==c[c[40+r>>2]+24>>2])break e;if(!(2&c[e+8>>2]))break e}else if(!(1&c[e+8>>2]))break e;c[20+r>>2]=c[20+r>>2]+8;continue}break}1&a[29+r|0]?c[c[40+r>>2]+44>>2]=3:c[c[40+r>>2]+44>>2]=4}1&a[30+r|0]||(c[c[40+r>>2]+20>>2]=c[36+r>>2],e=c[40+r>>2],c[e+40>>2]=c[e+40>>2]+1,1==c[c[40+r>>2]+36>>2]&&2==c[c[40+r>>2]+24>>2]&&(a[c[40+r>>2]+54|0]=1))}else 1==c[32+r>>2]&&(c[c[40+r>>2]+32>>2]=1);else if(c[16+r>>2]=(e+16|0)+(c[e+12>>2]<<3),c[12+r>>2]=e+16,ce(c[12+r>>2],c[40+r>>2],c[36+r>>2],c[32+r>>2],1&a[31+r|0]),t=c[12+r>>2]+8|0,(c[12+r>>2]=t)>>>0<m[16+r>>2])if(1==c[c[40+r>>2]+36>>2]||2&c[e+8>>2])for(;!(1&a[c[40+r>>2]+54|0])&&(ce(c[12+r>>2],c[40+r>>2],c[36+r>>2],c[32+r>>2],1&a[31+r|0]),e=c[12+r>>2]+8|0,(c[12+r>>2]=e)>>>0<m[16+r>>2]););else if(1&c[e+8>>2])for(;!(1&a[c[40+r>>2]+54|0]||1==c[c[40+r>>2]+36>>2]&&1==c[c[40+r>>2]+24>>2])&&(ce(c[12+r>>2],c[40+r>>2],c[36+r>>2],c[32+r>>2],1&a[31+r|0]),e=c[12+r>>2]+8|0,(c[12+r>>2]=e)>>>0<m[16+r>>2]););else for(;!(1&a[c[40+r>>2]+54|0]||1==c[c[40+r>>2]+36>>2])&&(ce(c[12+r>>2],c[40+r>>2],c[36+r>>2],c[32+r>>2],1&a[31+r|0]),e=c[12+r>>2]+8|0,(c[12+r>>2]=e)>>>0<m[16+r>>2]););N=48+r|0},function(e,t,n,i){t|=0,n|=0,i|=0;var o;if(c[28+(N=o=N-32|0)>>2]=e|=0,c[24+o>>2]=t,c[20+o>>2]=n,c[16+o>>2]=i,1&ne(e=c[28+o>>2],c[c[24+o>>2]+8>>2],0))ie(e,c[24+o>>2],c[20+o>>2],c[16+o>>2]);else if(c[12+o>>2]=(e+16|0)+(c[e+12>>2]<<3),c[8+o>>2]=e+16,oe(c[8+o>>2],c[24+o>>2],c[20+o>>2],c[16+o>>2]),e=c[8+o>>2]+8|0,(c[8+o>>2]=e)>>>0<m[12+o>>2])for(;oe(c[8+o>>2],c[24+o>>2],c[20+o>>2],c[16+o>>2]),!(1&a[c[24+o>>2]+54|0])&&(e=c[8+o>>2]+8|0,(c[8+o>>2]=e)>>>0<m[12+o>>2]););N=32+o|0},function(){c[5501]=7328},function(){ge(22100)},function(e,t,n){e|=0,t|=0,n|=0;var i,o,a,r,s,l=x(0),_=x(0),u=x(0);N=s=N-32|0,a=c[4+(o=n+8|0)>>2],c[(i=r=24+s|0)>>2]=c[o>>2],c[4+i>>2]=a,i=c[n+4>>2],c[16+s>>2]=c[n>>2],c[20+s>>2]=i,l=A[16+s>>2],u=A[20+s>>2],_=A[r>>2],x(x(x(l*l)+x(u*u))+x(_*_))<x(14210854715202004e-30)&&(c[28+s>>2]=0,_=x(-1),u=x(-1),l=x(-1)),r=_,_=x(x(1)/x(T(x(x(x(l*l)+x(u*u))+x(_*_))))),A[24+s>>2]=r*_,A[20+s>>2]=u*_,A[16+s>>2]=l*_,Re(s,t,16+s|0);e:{switch(c[t+4>>2]){case 8:l=x(A[t+36>>2]*A[t+20>>2]);break e;case 0:case 1:case 13:case 11:case 10:l=A[t+52>>2];break e;case 4:case 5:l=A[t+52>>2];break e}l=x(pi[c[c[t>>2]+48>>2]](t))}c[e+12>>2]=0,A[e+8>>2]=x(l*A[24+s>>2])+A[8+s>>2],A[e+4>>2]=x(l*A[20+s>>2])+A[4+s>>2],A[e>>2]=x(l*A[16+s>>2])+A[s>>2],N=32+s|0},Re,function(e,t,n){e|=0,t|=0,n|=0;var i,o,a,r,s=x(0),l=x(0),_=x(0),u=x(0);return(l=A[n+128>>2])!=x(0)&&(c[5868]=c[5868]+1,s=A[n+96>>2],_=x(l-x(s*A[n+116>>2])),u=A[n+16>>2],i=A[n+20>>2],o=A[n+24>>2],l=A[n+108>>2],l=x(x(_-x(x(x(x(x(u*A[e+144>>2])+x(i*A[e+148>>2]))+x(o*A[e+152>>2]))+x(x(x(A[n>>2]*A[e+160>>2])+x(A[n+4>>2]*A[e+164>>2]))+x(A[n+8>>2]*A[e+168>>2])))*l))-x(l*x(x(x(x(A[n+48>>2]*A[t+144>>2])+x(A[n+52>>2]*A[t+148>>2]))+x(A[n+56>>2]*A[t+152>>2]))+x(x(x(A[n+32>>2]*A[t+160>>2])+x(A[n+36>>2]*A[t+164>>2]))+x(A[n+40>>2]*A[t+168>>2]))))),a=x(s+l),_=A[n+120>>2],A[n+96>>2]=(r=a<_)?_:a,s=r?x(_-s):l,c[e+240>>2]&&(A[e+144>>2]=x(A[e+112>>2]*x(s*x(u*A[e+128>>2])))+A[e+144>>2],A[e+148>>2]=x(x(s*x(i*A[e+132>>2]))*A[e+116>>2])+A[e+148>>2],A[e+152>>2]=x(x(s*x(o*A[e+136>>2]))*A[e+120>>2])+A[e+152>>2],l=A[n+72>>2],_=A[n+68>>2],A[e+160>>2]=x(x(s*A[e+96>>2])*A[n+64>>2])+A[e+160>>2],u=A[e+104>>2],A[e+164>>2]=x(_*x(s*A[e+100>>2]))+A[e+164>>2],A[e+168>>2]=x(l*x(s*u))+A[e+168>>2]),c[t+240>>2]&&(l=A[n+56>>2],_=A[n+52>>2],A[t+144>>2]=x(A[t+112>>2]*x(s*x(A[n+48>>2]*A[t+128>>2])))+A[t+144>>2],A[t+148>>2]=x(x(s*x(_*A[t+132>>2]))*A[t+116>>2])+A[t+148>>2],A[t+152>>2]=x(x(s*x(l*A[t+136>>2]))*A[t+120>>2])+A[t+152>>2],l=A[n+88>>2],_=A[n+84>>2],A[t+160>>2]=x(x(s*A[t+96>>2])*A[n+80>>2])+A[t+160>>2],u=A[t+104>>2],A[t+164>>2]=x(_*x(s*A[t+100>>2]))+A[t+164>>2],A[t+168>>2]=x(l*x(s*u))+A[t+168>>2])),x(s)},function(e,t,n){e|=0,t|=0,n|=0;var i,o,a=x(0),r=x(0),s=x(0),l=x(0),_=(a=A[n+100>>2],l=A[n+16>>2],A[n+20>>2]),u=A[n+24>>2];return r=A[n+108>>2],r=x(x(x(A[n+112>>2]-x(a*A[n+116>>2]))-x(x(x(x(x(l*A[e+64>>2])+x(_*A[e+68>>2]))+x(u*A[e+72>>2]))+x(x(x(A[n>>2]*A[e+80>>2])+x(A[n+4>>2]*A[e+84>>2]))+x(A[n+8>>2]*A[e+88>>2])))*r))-x(r*x(x(x(x(A[n+48>>2]*A[t+64>>2])+x(A[n+52>>2]*A[t+68>>2]))+x(A[n+56>>2]*A[t+72>>2]))+x(x(x(A[n+32>>2]*A[t+80>>2])+x(A[n+36>>2]*A[t+84>>2]))+x(A[n+40>>2]*A[t+88>>2]))))),i=x(a+r),s=A[n+120>>2],A[n+100>>2]=(o=i<s)?s:i,a=o?x(s-a):r,c[e+240>>2]&&(A[e+64>>2]=x(A[e+112>>2]*x(a*x(l*A[e+128>>2])))+A[e+64>>2],A[e+68>>2]=x(x(a*x(_*A[e+132>>2]))*A[e+116>>2])+A[e+68>>2],A[e+72>>2]=x(x(a*x(u*A[e+136>>2]))*A[e+120>>2])+A[e+72>>2],r=A[n+72>>2],s=A[n+68>>2],A[e+80>>2]=x(x(a*A[e+96>>2])*A[n+64>>2])+A[e+80>>2],l=A[e+104>>2],A[e+84>>2]=x(s*x(a*A[e+100>>2]))+A[e+84>>2],A[e+88>>2]=x(r*x(a*l))+A[e+88>>2]),c[t+240>>2]&&(r=A[n+56>>2],s=A[n+52>>2],A[t+64>>2]=x(A[t+112>>2]*x(a*x(A[n+48>>2]*A[t+128>>2])))+A[t+64>>2],A[t+68>>2]=x(x(a*x(s*A[t+132>>2]))*A[t+116>>2])+A[t+68>>2],A[t+72>>2]=x(x(a*x(r*A[t+136>>2]))*A[t+120>>2])+A[t+72>>2],r=A[n+88>>2],s=A[n+84>>2],A[t+80>>2]=x(x(a*A[t+96>>2])*A[n+80>>2])+A[t+80>>2],l=A[t+104>>2],A[t+84>>2]=x(s*x(a*A[t+100>>2]))+A[t+84>>2],A[t+88>>2]=x(r*x(a*l))+A[t+88>>2]),x(a)},function(e,t,n){e|=0,t|=0,n|=0;var i=x(0),o=x(0),a=x(0),r=x(0),s=(r=A[n+100>>2],A[n+16>>2]),l=A[n+20>>2],_=A[n+24>>2];return o=A[n+108>>2],i=x(x(x(A[n+112>>2]-x(r*A[n+116>>2]))-x(x(x(x(x(s*A[e+64>>2])+x(l*A[e+68>>2]))+x(_*A[e+72>>2]))+x(x(x(A[n>>2]*A[e+80>>2])+x(A[n+4>>2]*A[e+84>>2]))+x(A[n+8>>2]*A[e+88>>2])))*o))-x(o*x(x(x(x(A[n+48>>2]*A[t+64>>2])+x(A[n+52>>2]*A[t+68>>2]))+x(A[n+56>>2]*A[t+72>>2]))+x(x(x(A[n+32>>2]*A[t+80>>2])+x(A[n+36>>2]*A[t+84>>2]))+x(A[n+40>>2]*A[t+88>>2]))))),((o=x(r+i))<(a=A[n+120>>2])||(a=A[n+124>>2])<o)&&(i=x(a-r),o=a),A[n+100>>2]=o,c[e+240>>2]&&(A[e+64>>2]=x(A[e+112>>2]*x(i*x(s*A[e+128>>2])))+A[e+64>>2],A[e+68>>2]=x(x(i*x(l*A[e+132>>2]))*A[e+116>>2])+A[e+68>>2],A[e+72>>2]=x(x(i*x(_*A[e+136>>2]))*A[e+120>>2])+A[e+72>>2],o=A[n+72>>2],a=A[n+68>>2],A[e+80>>2]=x(x(i*A[e+96>>2])*A[n+64>>2])+A[e+80>>2],r=A[e+104>>2],A[e+84>>2]=x(a*x(i*A[e+100>>2]))+A[e+84>>2],A[e+88>>2]=x(o*x(i*r))+A[e+88>>2]),c[t+240>>2]&&(o=A[n+56>>2],a=A[n+52>>2],A[t+64>>2]=x(A[t+112>>2]*x(i*x(A[n+48>>2]*A[t+128>>2])))+A[t+64>>2],A[t+68>>2]=x(x(i*x(a*A[t+132>>2]))*A[t+116>>2])+A[t+68>>2],A[t+72>>2]=x(x(i*x(o*A[t+136>>2]))*A[t+120>>2])+A[t+72>>2],o=A[n+88>>2],a=A[n+84>>2],A[t+80>>2]=x(x(i*A[t+96>>2])*A[n+80>>2])+A[t+80>>2],r=A[t+104>>2],A[t+84>>2]=x(a*x(i*A[t+100>>2]))+A[t+84>>2],A[t+88>>2]=x(o*x(i*r))+A[t+88>>2]),x(i)},function(){An(24164)},function(e,t,n){t|=0,n|=0;var i,o,a,r=0;N=a=N-96|0,i=c[c[(e|=0)>>2]>>2],o=c[c[e+4>>2]>>2],0|pi[c[c[t>>2]+24>>2]](t,i,o)&&(c[88+a>>2]=-1,c[92+a>>2]=-1,c[72+a>>2]=0,c[80+a>>2]=i,c[84+a>>2]=i+4,c[76+a>>2]=c[i+192>>2],c[64+a>>2]=-1,c[68+a>>2]=-1,c[48+a>>2]=0,c[56+a>>2]=o,c[60+a>>2]=o+4,c[52+a>>2]=c[o+192>>2],((r=c[e+8>>2])||(r=0|pi[c[c[t>>2]+8>>2]](t,72+a|0,48+a|0,0,1),c[e+8>>2]=r))&&(c[40+a>>2]=0,c[12+a>>2]=0,c[8+a>>2]=12508,e=c[n+8>>2],c[20+a>>2]=48+a,c[16+a>>2]=72+a,1!=(0|e)?(o=x(pi[c[c[r>>2]+12>>2]](r,i,o,n,8+a|0)))<A[n+12>>2]&&(A[n+12>>2]=o):pi[c[c[r>>2]+8>>2]](r,72+a|0,48+a|0,n,8+a|0))),N=96+a|0},function(e){e|=0,c[5870]=17124,(e=c[6009])&&p[24040]&&(c[5499]=c[5499]+1,z(c[e-4>>2])),a[24040]=1,c[6007]=0,c[6008]=0,c[5870]=7664,c[6009]=0,(e=c[5944])&&p[23780]&&(c[5499]=c[5499]+1,z(c[e-4>>2])),a[23780]=1,c[5942]=0,c[5943]=0,c[5944]=0},function(e){return c[(e|=0)>>2]=7328,0|e},ve,function(e,t){var n=0;return c[12+(e|=0)>>2]&c[4+(t|=0)>>2]?(n=1,p[e+88|0]||(e=c[t>>2])&&(n=!(4&p[e+204|0])),0|n):0},function(e,t,n){e|=0,t|=0,n|=0;var i,o,a,r,s,l,_,u=0,h=x(0),f=x(0),p=0;return u=c[t>>2],p=c[u+192>>2],31==c[p+4>>2]&&(_=c[t+4>>2])&&(p=c[64+(c[p+32>>2]+g(c[_>>2],80)|0)>>2]),c[e+8>>2]=u,c[e+84>>2]=c[p+8>>2],A[e+4>>2]=A[t+24>>2],n?(n=c[t+12>>2],c[e+52>>2]=c[t+8>>2],c[e+56>>2]=n,p=c[4+(u=t+16|0)>>2],c[(n=e+60|0)>>2]=c[u>>2],c[n+4>>2]=p):(i=A[u+8>>2],o=A[u+12>>2],a=A[u+20>>2],r=A[u+24>>2],s=A[u+28>>2],l=A[u+36>>2],_=A[u+40>>2],h=A[t+12>>2],n=A[u+44>>2],f=A[t+16>>2],p=A[u+4>>2],u=A[t+8>>2],c[e- -64>>2]=0,A[e+60>>2]=x(x(u*l)+x(h*_))+x(f*n),A[e+56>>2]=x(x(u*a)+x(h*r))+x(f*s),A[e+52>>2]=x(x(p*u)+x(i*h))+x(o*f)),h=A[t+24>>2],f=x(x(1)-h),A[e+68>>2]=x(f*A[e+20>>2])+x(h*A[e+36>>2]),A[e+72>>2]=x(f*A[e+24>>2])+x(h*A[e+40>>2]),A[e+76>>2]=x(f*A[e+28>>2])+x(h*A[e+44>>2]),x(A[t+24>>2])},Ae,function(e,t){return(e=c[12+(e|=0)>>2])&c[4+(t|=0)>>2]?0!=(e&c[t+8>>2])|0:0},function(){var e=0;c[12+(N=e=N-16|0)>>2]=1088,c[8+e>>2]=0,X(c[280],c[12+e>>2],c[8+e>>2]),X(c[280],3477,c[12+(N=e=N-16|0)>>2]=0),N=16+e|0,P()},ge,function(e){V(ge(e|=0))},function(e,t){var n=0;return c[12+(e|=0)>>2]&c[4+(t|=0)>>2]?(n=1,p[e+152|0]||(e=c[t>>2])&&(n=!(4&p[e+204|0])),0|n):0},function(e,t,n){e|=0,n|=0;var i=0,o=0,r=0,s=0,l=0,_=0,u=0;if(o=c[c[(t|=0)>>2]+192>>2],31==c[o+4>>2]&&(r=c[t+4>>2])){if(u=c[c[64+(c[o+32>>2]+g(c[r>>2],80)|0)>>2]+8>>2],(0|(i=c[e+136>>2]))==c[e+140>>2]&&!((0|(s=i?i<<1:1))<=(0|i))){s&&(c[5498]=c[5498]+1,(o=M(19+(s<<2)|0))&&(c[(l=o+19&-16)-4>>2]=o)),_=c[e+144>>2];e:{if(1<=(0|i))for(o=l,r=_;c[o>>2]=c[r>>2],o=o+4|0,r=r+4|0,i=i-1|0;);else if(!_)break e;p[e+148|0]&&(c[5499]=c[5499]+1,z(c[_-4>>2])),i=c[e+136>>2]}c[e+144>>2]=l,c[e+140>>2]=s,a[e+148|0]=1}}else if(u=c[o+8>>2],(0|(i=c[e+136>>2]))==c[e+140>>2]&&!((0|(s=i?i<<1:1))<=(0|i))){s&&(c[5498]=c[5498]+1,(o=M(19+(s<<2)|0))&&(c[(l=o+19&-16)-4>>2]=o)),_=c[e+144>>2];e:{if(1<=(0|i))for(o=l,r=_;c[o>>2]=c[r>>2],o=o+4|0,r=r+4|0,i=i-1|0;);else if(!_)break e;p[e+148|0]&&(c[5499]=c[5499]+1,z(c[_-4>>2])),i=c[e+136>>2]}c[e+144>>2]=l,c[e+140>>2]=s,a[e+148|0]=1}return c[c[e+144>>2]+(i<<2)>>2]=u,c[e+136>>2]=c[e+136>>2]+1,x(xe(e,t,n))},function(e){var t=0;return c[(e|=0)>>2]=7532,(t=c[e+124>>2])&&p[e+128|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+124>>2]=0,a[e+128|0]=1,c[(t=e+116|0)>>2]=0,c[t+4>>2]=0,(t=c[e+104>>2])&&p[e+108|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+104>>2]=0,a[e+108|0]=1,c[(t=e+96|0)>>2]=0,c[t+4>>2]=0,(t=c[e+84>>2])&&p[e+88|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+84>>2]=0,a[e+88|0]=1,c[(t=e+76|0)>>2]=0,c[t+4>>2]=0,(t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+32>>2]=0,c[e>>2]=7328,a[e+36|0]=1,c[(t=e+24|0)>>2]=0,(c[t+4>>2]=0)|e},function(e){var t=0;c[(e|=0)>>2]=7532,(t=c[e+124>>2])&&p[e+128|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+124>>2]=0,a[e+128|0]=1,c[(t=e+116|0)>>2]=0,c[t+4>>2]=0,(t=c[e+104>>2])&&p[e+108|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+104>>2]=0,a[e+108|0]=1,c[(t=e+96|0)>>2]=0,c[t+4>>2]=0,(t=c[e+84>>2])&&p[e+88|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+84>>2]=0,a[e+88|0]=1,c[(t=e+76|0)>>2]=0,c[t+4>>2]=0,(t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),V(e)},xe,function(e){var t=0;return c[(e|=0)>>2]=7664,(t=c[e+296>>2])&&p[e+300|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+296>>2]=0,a[e+300|0]=1,c[(t=e+288|0)>>2]=0,(c[t+4>>2]=0)|e},function(e){var t=0;c[(e|=0)>>2]=7664,(t=c[e+296>>2])&&p[e+300|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+296>>2]=0,a[e+300|0]=1,c[(t=e+288|0)>>2]=0,c[t+4>>2]=0,c[5499]=c[5499]+1,z(c[e-4>>2])},function(e,t){c[200+(e|=0)>>2]=t|=0,c[e+192>>2]=t,c[e+304>>2]=c[e+304>>2]+1},function(e,t){t|=0;var n,i=0;i=n=c[288+(e|=0)>>2];e:if(!((0|n)<1)){for(e=c[e+296>>2],i=0;;){if(c[e>>2]==(0|t))break e;if(e=e+4|0,(0|n)==(0|(i=i+1|0)))break}i=n}return(0|n)<=(0|i)|0},function(){return 264},Ee,function(e,t){var n=0,i=0,o=(i=t|=0,0|pi[c[c[(e|=0)>>2]+16>>2]](e)),a=c[c[t>>2]+16>>2];n=0|pi[a](0|i,0|o,1),i=0|pi[c[c[e>>2]+20>>2]](e,c[8+(o=n)>>2],n=t),a=c[c[t>>2]+20>>2],pi[a](0|n,0|o,0|i,1245859651,0|e)},Ne,function(e){e=Ne(e|=0),c[5499]=c[5499]+1,z(c[e-4>>2])},function(e){var t;return c[(e|=0)>>2]=7916,(t=c[e+60>>2])&&(pi[c[c[t>>2]>>2]](t),(t=c[e+60>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),0|e},Ae,Ve,function(e,t,n){e|=0,t|=0,n|=0;var i,o,a,r,s,l,_,u;c[(_=44+(N=u=N-96|0)|0)>>2]=0,c[4+_>>2]=0,c[(_=56+u|0)>>2]=0,c[4+_>>2]=0,c[52+u>>2]=1065353216,c[(_=u+64|0)>>2]=0,c[4+_>>2]=0,c[(_=76+u|0)>>2]=0,c[4+_>>2]=0,c[72+u>>2]=1065353216,c[(_=84+u|0)>>2]=0,c[4+_>>2]=0,c[92+u>>2]=0,c[36+u>>2]=0,c[40+u>>2]=0,c[32+u>>2]=1065353216,pi[c[c[e>>2]+8>>2]](e,32+u|0,16+u|0,u),r=A[u>>2],s=A[16+u>>2],i=x(r-s),a=x(i*i),i=A[4+u>>2],l=A[20+u>>2],o=x(i-l),_=x(a+x(o*o)),o=A[8+u>>2],a=A[24+u>>2],e=x(o-a),A[n>>2]=x(T(x(_+x(e*e))))*x(.5),c[t+12>>2]=0,A[t+8>>2]=x(o+a)*x(.5),A[t+4>>2]=x(i+l)*x(.5),A[t>>2]=x(r+s)*x(.5),N=96+u|0},function(e){var t,n;return N=n=N-32|0,pi[c[c[(e|=0)>>2]+12>>2]](e,16+n|0,12+n|0),N=32+n|0,t=A[16+n>>2],e=x(t*t),t=A[20+n>>2],e=x(e+x(t*t)),t=A[24+n>>2],x(x(A[12+n>>2]+x(T(x(e+x(t*t))))))},function(e,t){return e|=0,t=x(t),x(x(x(pi[c[c[e>>2]+16>>2]](e))*t))},function(e,t){e|=0,t|=0,x(0);var n=A[t>>2],i=A[t+4>>2];t=A[t+8>>2],c[e+32>>2]=0,A[e+28>>2]=y(t),A[e+24>>2]=y(i),A[e+20>>2]=y(n)},function(e){return 20+(e|=0)|0},function(e,t,n){e|=0,t=x(t),n|=0;var i,o,a;N=a=N-96|0,i=x(pi[c[c[e>>2]+48>>2]](e)),c[(o=44+a|0)>>2]=0,c[4+o>>2]=0,c[(o=56+a|0)>>2]=0,c[4+o>>2]=0,c[52+a>>2]=1065353216,c[(o=a+64|0)>>2]=0,c[4+o>>2]=0,c[(o=76+a|0)>>2]=0,c[4+o>>2]=0,c[72+a>>2]=1065353216,c[(o=84+a|0)>>2]=0,c[4+o>>2]=0,c[92+a>>2]=0,c[36+a>>2]=0,c[40+a>>2]=0,c[32+a>>2]=1065353216,pi[c[c[e>>2]+8>>2]](e,32+a|0,16+a|0,a),c[n+12>>2]=0,t=x(t*x(.0833333283662796)),o=x(i+x(x(A[a>>2]-A[16+a>>2])*x(.5))),o=x(o+o),o=x(o*o),e=x(i+x(x(A[4+a>>2]-A[20+a>>2])*x(.5))),e=x(e+e),e=x(e*e),A[n+8>>2]=t*x(o+e),i=x(i+x(x(A[8+a>>2]-A[24+a>>2])*x(.5))),i=x(i+i),i=x(i*i),A[n+4>>2]=t*x(o+i),A[n>>2]=t*x(e+i),N=96+a|0},function(e){c[8+(e|=0)>>2]=1065353216,c[e+12>>2]=0,c[e>>2]=1065353216,c[e+4>>2]=1065353216},He,function(e){return x(A[52+(e|=0)>>2])},et,function(e,t,n){t|=0;var i=0|pi[c[c[(n|=0)>>2]+40>>2]](n,e|=0),o=0|pi[c[c[n>>2]+28>>2]](n,i);return(c[t>>2]=o)&&pi[c[c[n>>2]+48>>2]](n,i),n=c[e+4>>2],c[t+8>>2]=0,A[t+28>>2]=A[e+36>>2],A[t+32>>2]=A[e+40>>2],A[t+36>>2]=A[e+44>>2],A[t+40>>2]=A[e+48>>2],A[t+12>>2]=A[e+20>>2],A[t+16>>2]=A[e+24>>2],A[t+20>>2]=A[e+28>>2],A[t+24>>2]=A[e+32>>2],c[t+4>>2]=n,A[t+44>>2]=A[e+52>>2],c[t+48>>2]=0,8448},function(e,t){var n=0,i=0,o=(i=t|=0,0|pi[c[c[(e|=0)>>2]+52>>2]](e)),a=c[c[t>>2]+16>>2];n=0|pi[a](0|i,0|o,1),i=0|pi[c[c[e>>2]+56>>2]](e,c[8+(o=n)>>2],n=t),a=c[c[t>>2]+20>>2],pi[a](0|n,0|o,0|i,1346455635,0|e)},De,function(e,t,n){e|=0,t|=0,n|=0;var i,o=0,a=x(0),r=x(0),s=0,l=x(0),_=x(0),u=0,h=0,f=0,p=x(0),d=x(0),m=x(0);if(N=i=N-2048|0,c[e>>2]=0,c[e+4>>2]=0,c[(o=e+8|0)>>2]=0,c[o+4>>2]=0,l=A[n>>2],a=A[n+4>>2],_=A[n+8>>2],r=x(x(x(l*l)+x(a*a))+x(_*_)),p=x(1),r<x(9999999747378752e-20)||(r=x(x(1)/x(T(r))),d=x(_*r),m=x(a*r),p=x(l*r)),r=p,1<=(0|pi[c[c[t>>2]+96>>2]](t)))for(_=x(-0xde0b6b000000000);;){if(u=128,127<((0|pi[c[c[t>>2]+96>>2]](t))-h|0)||1<=(0|(u=(0|pi[c[c[t>>2]+96>>2]](t))-h|0))){for(n=0,o=i;pi[c[c[t>>2]+108>>2]](t,n,o),o=o+16|0,(0|u)!=(0|(n=n+1|0)););for(o=0,f=-1,a=x(-34028234663852886e22),n=i;a=(s=a<(l=x(x(x(r*A[n>>2])+x(m*A[n+4>>2]))+x(d*A[n+8>>2]))))?l:a,f=s?o:f,n=n+16|0,(0|u)!=(0|(o=o+1|0)););}else a=x(-34028234663852886e22),f=-1;if(_<a&&(n=c[12+(s=(f<<4)+i|0)>>2],c[(o=e+8|0)>>2]=c[s+8>>2],c[o+4>>2]=n,n=c[s+4>>2],c[e>>2]=c[s>>2],c[e+4>>2]=n,_=a),h=h+128|0,!((0|pi[c[c[t>>2]+96>>2]](t))>(0|h)))break}N=2048+i|0},function(e,t,n,i,o,a,r){e|=0,t|=0,n|=0,i|=0,o|=0,a|=0,r|=0;var s,l,_,u,h,f,p,d,m,v,g,y,b,S,C,E,T,P,w,I,R,D,O,M,z,L,F,B,k;c[44+(N=k=N-48|0)>>2]=0,s=A[n>>2],l=A[n+4>>2],_=A[n+8>>2],A[32+k>>2]=x(x(A[t>>2]*s)+x(A[t+16>>2]*l))+x(A[t+32>>2]*_),f=t+24|0,L=t+40|0,A[40+k>>2]=x(x(s*A[t+8>>2])+x(l*A[f>>2]))+x(_*A[L>>2]),p=t+20|0,F=t+36|0,A[36+k>>2]=x(x(s*A[t+4>>2])+x(l*A[p>>2]))+x(_*A[F>>2]),pi[c[c[e>>2]+64>>2]](16+k|0,e,32+k|0),d=A[(z=t+56|0)>>2],m=A[L>>2],v=A[F>>2],u=A[(B=t+52|0)>>2],g=A[f>>2],y=A[p>>2],b=A[t+32>>2],h=A[t+48>>2],S=A[t+8>>2],C=A[t>>2],E=A[t+4>>2],T=A[t+16>>2],s=A[24+k>>2],l=A[16+k>>2],_=A[20+k>>2],c[12+k>>2]=0,A[8+k>>2]=-A[40+k>>2],A[4+k>>2]=-A[36+k>>2],A[k>>2]=-A[32+k>>2],pi[c[c[e>>2]+64>>2]](16+k|0,e,k),P=A[z>>2],w=A[L>>2],I=A[F>>2],R=A[B>>2],D=A[f>>2],O=A[p>>2],M=A[t+32>>2],e=A[t+48>>2],z=A[t+8>>2],L=A[t>>2],F=A[t+4>>2],B=A[t+16>>2],f=A[24+k>>2],p=A[16+k>>2],t=A[20+k>>2],h=x(h+x(x(x(l*C)+x(_*E))+x(s*S))),u=x(u+x(x(x(l*T)+x(_*y))+x(s*g))),s=x(d+x(x(x(l*b)+x(_*v))+x(s*m))),A[i>>2]=x(x(h*A[n>>2])+x(u*A[n+4>>2]))+x(s*A[n+8>>2]),l=x(e+x(x(x(p*L)+x(t*F))+x(f*z))),_=x(R+x(x(x(p*B)+x(t*O))+x(f*D))),f=x(P+x(x(x(p*M)+x(t*I))+x(f*w))),A[o>>2]=x(x(l*A[n>>2])+x(_*A[n+4>>2]))+x(f*A[n+8>>2]),c[r+12>>2]=0,A[r+8>>2]=f,A[r+4>>2]=_,A[r>>2]=l,c[a+12>>2]=0,A[a+8>>2]=s,A[a+4>>2]=u,A[a>>2]=h,p=A[i>>2],(t=A[o>>2])<p&&(A[i>>2]=t,A[o>>2]=p,c[r+12>>2]=0,A[r+8>>2]=s,A[r+4>>2]=u,A[r>>2]=h,c[a+12>>2]=0,A[a+8>>2]=f,A[a+4>>2]=_,A[a>>2]=l),N=48+k|0},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,a,r,s,l,_,u,h,f,p,d,m=0,v=0,g=x(0),y=0,b=0,S=0,C=0;if(N=d=N-2048|0,1<=(0|i)){for(v=n+12|0,m=i;c[v>>2]=-581039253,v=v+16|0,m=m-1|0;);for(;;){if(1<=(0|pi[c[c[e>>2]+96>>2]](e)))for(r=12+(o=(m=C<<4)+n|0)|0,_=8+(a=t+m|0)|0,u=4+a|0,b=0;;){if(S=128,127<((0|pi[c[c[e>>2]+96>>2]](e))-b|0)||1<=(0|(S=(0|pi[c[c[e>>2]+96>>2]](e))-b|0))){for(v=0,m=d;pi[c[c[e>>2]+108>>2]](e,v,m),m=m+16|0,(0|S)!=(0|(v=v+1|0)););for(h=A[_>>2],f=A[u>>2],p=A[a>>2],m=0,y=-1,g=x(-34028234663852886e22),v=d;g=(l=g<(s=x(x(x(p*A[v>>2])+x(f*A[v+4>>2]))+x(h*A[v+8>>2]))))?s:g,y=l?m:y,v=v+16|0,(0|S)!=(0|(m=m+1|0)););}else g=x(-34028234663852886e22),y=-1;if(A[r>>2]<g&&(y=c[12+(m=(y<<4)+d|0)>>2],c[(v=8+o|0)>>2]=c[m+8>>2],c[v+4>>2]=y,v=c[m+4>>2],c[o>>2]=c[m>>2],c[4+o>>2]=v,A[r>>2]=g),b=b+128|0,!((0|pi[c[c[e>>2]+96>>2]](e))>(0|b)))break}if((0|(C=C+1|0))==(0|i))break}}N=2048+d|0},function(e,t,n,i){t|=0,n|=0,i|=0;var o,a,r,s,l,_,u,h=0;for(N=u=N-80|0,_=x(pi[c[c[(e|=0)>>2]+48>>2]](e)),l=72+u|0;c[l>>2]=0,c[4+l>>2]=0,c[64+u>>2]=0,c[68+u>>2]=0,c[(s=(u+64|0)+h|0)>>2]=1065353216,c[44+u>>2]=0,o=A[64+u>>2],a=A[68+u>>2],r=A[l>>2],A[40+u>>2]=x(x(o*A[t+8>>2])+x(a*A[t+24>>2]))+x(r*A[t+40>>2]),A[36+u>>2]=x(x(o*A[t+4>>2])+x(a*A[t+20>>2]))+x(r*A[t+36>>2]),A[32+u>>2]=x(x(o*A[t>>2])+x(a*A[t+16>>2]))+x(r*A[t+32>>2]),pi[c[c[e>>2]+64>>2]](48+u|0,e,32+u|0),c[44+u>>2]=0,o=A[48+u>>2],a=A[52+u>>2],r=A[56+u>>2],A[40+u>>2]=x(x(x(o*A[t+32>>2])+x(a*A[t+36>>2]))+x(r*A[t+40>>2]))+A[t+56>>2],A[36+u>>2]=x(x(x(o*A[t+16>>2])+x(a*A[t+20>>2]))+x(r*A[t+24>>2]))+A[t+52>>2],A[32+u>>2]=x(x(x(o*A[t>>2])+x(a*A[t+4>>2]))+x(r*A[t+8>>2]))+A[t+48>>2],c[s>>2]=-1082130432,A[i+h>>2]=_+A[(s=(32+u|0)+h|0)>>2],c[12+u>>2]=0,o=A[64+u>>2],a=A[68+u>>2],r=A[l>>2],A[8+u>>2]=x(x(o*A[t+8>>2])+x(a*A[t+24>>2]))+x(r*A[t+40>>2]),A[4+u>>2]=x(x(o*A[t+4>>2])+x(a*A[t+20>>2]))+x(r*A[t+36>>2]),A[u>>2]=x(x(o*A[t>>2])+x(a*A[t+16>>2]))+x(r*A[t+32>>2]),pi[c[c[e>>2]+64>>2]](16+u|0,e,u),c[44+u>>2]=0,o=A[16+u>>2],a=A[20+u>>2],r=A[24+u>>2],A[40+u>>2]=x(x(x(o*A[t+32>>2])+x(a*A[t+36>>2]))+x(r*A[t+40>>2]))+A[t+56>>2],A[36+u>>2]=x(x(x(o*A[t+16>>2])+x(a*A[t+20>>2]))+x(r*A[t+24>>2]))+A[t+52>>2],A[32+u>>2]=x(x(x(o*A[t>>2])+x(a*A[t+4>>2]))+x(r*A[t+8>>2]))+A[t+48>>2],A[n+h>>2]=A[s>>2]-_,12!=(0|(h=h+4|0)););N=80+u|0},We,qe,function(e,t){e|=0,t|=0;var n,i,o,r,s,l,_=0,u=0,h=0,f=0,d=0,m=0,v=x(0),b=0,S=x(0),C=0,E=x(0),w=x(0),I=0,R=0,D=0,O=x(0),L=0,F=0,k=0,U=x(0),G=x(0),j=x(0),V=x(0),H=0,W=0,q=0,Y=0,X=0,Q=0,Z=x(0),J=x(0),K=0,$=x(0),ee=x(0),te=0,ne=0;if(N=l=N-208|0,(u=c[e+60>>2])&&(pi[c[c[u>>2]>>2]](u),(u=c[e+60>>2])&&(c[5499]=c[5499]+1,z(c[u-4>>2]))),c[5498]=c[5498]+1,(u=M(151))&&(c[(_=u+19&-16)-4>>2]=u),c[_>>2]=7868,a[_+20|0]=1,c[_+16>>2]=0,a[_+40|0]=1,c[_+8>>2]=0,c[_+12>>2]=0,c[_+36>>2]=0,a[_+60|0]=1,c[_+28>>2]=0,c[_+32>>2]=0,c[_+56>>2]=0,c[_+48>>2]=0,c[_+52>>2]=0,c[e+60>>2]=_,!(((_=0)|pi[c[c[e>>2]+96>>2]](e))<1)){for(;;){if((0|f)==(0|k)&&!((0|(u=f?f<<1:1))<=(0|f))){d=0,u&&(c[5498]=c[5498]+1,(_=M(19+(u<<4)|0))&&(c[(d=_+19&-16)-4>>2]=_));e:{if(1<=(0|f))for(_=d,h=Y;b=c[h+4>>2],c[_>>2]=c[h>>2],c[_+4>>2]=b,H=c[4+(L=h+8|0)>>2],c[(b=_+8|0)>>2]=c[L>>2],c[b+4>>2]=H,_=_+16|0,h=h+16|0,f=f-1|0;);else if(!Y)break e;c[5499]=c[5499]+1,z(c[Y-4>>2])}f=u,Y=d}if(d=c[108+l>>2],c[(_=(k<<4)+Y|0)>>2]=c[104+l>>2],c[_+4>>2]=d,h=c[4+(d=112+l|0)>>2],c[(u=_+8|0)>>2]=c[d>>2],c[u+4>>2]=h,pi[c[c[e>>2]+108>>2]](e,k,_),k=k+1|0,!((0|pi[c[c[e>>2]+96>>2]](e))>(0|k)))break}_=Y}a[140+l|0]=1,c[136+l>>2]=0,a[160+l|0]=1,c[(u=128+l|0)>>2]=0,c[u+4>>2]=0,c[156+l>>2]=0,c[(u=148+l|0)>>2]=0,c[u+4>>2]=0,c[116+l>>2]=0,a[120+l|0]=1,c[108+l>>2]=0,c[112+l>>2]=0;e:{t:{if(!t){je(104+l|0,_,k);break e}if(!((0|k)<1)){for(W=k-1|0,d=Y+24|0;;){if((C=(t=C)+1|0)>>>0<k>>>0)for(H=8+(m=(t<<4)+Y|0)|0,X=m+4|0,b=C;;){if((0|(b=(t=b)+1|0))<(0|k))for(te=8+(F=(t<<4)+Y|0)|0,Q=F+4|0,L=b;;){for(v=A[m>>2],S=x(A[F>>2]-v),E=A[X>>2],w=x(A[4+(t=(L<<4)+Y|0)>>2]-E),E=x(A[Q>>2]-E),v=x(A[t>>2]-v),U=x(x(S*w)-x(E*v)),j=A[H>>2],V=x(A[te>>2]-j),O=x(V*v),v=x(A[t+8>>2]-j),j=x(O-x(S*v)),V=x(x(E*v)-x(V*w)),S=x(1),t=1;;){v=x(U*S),E=x(V*S),S=x(j*S);n:if((w=x(x(v*v)+x(x(E*E)+x(S*S))))>x(9999999747378752e-20)){w=x(x(1)/x(T(w))),v=x(v*w),S=x(S*w),E=x(E*w);i:if(!(f=(0|I)<1)){if(x(x(x(E*A[R>>2])+x(S*A[R+4>>2]))+x(v*A[R+8>>2]))>x(.9990000128746033))break n;for(u=I-1|0,_=R+24|0,h=0;;){if((0|u)==(0|h))break i;if(q=_-4|0,K=_-8|0,w=A[_>>2],_=_+16|0,h=h+1|0,x(x(x(E*A[K>>2])+x(S*A[q>>2]))+x(v*w))>x(.9990000128746033))break}if((0|h)<(0|I))break n}if(w=x(x(x(E*A[m>>2])+x(S*A[X>>2]))+x(v*A[H>>2])),!(x(x(x(x(x(E*A[Y>>2])+x(S*A[Y+4>>2]))+x(v*A[Y+8>>2]))-w)+x(-.009999999776482582))>x(0))){O=x(-w),h=0,_=d;i:{for(;;){if((0|h)==(0|W))break i;if(u=_-4|0,q=_-8|0,G=A[_>>2],_=_+16|0,h=h+1|0,x(x(x(x(x(E*A[q>>2])+x(S*A[u>>2]))+x(v*G))-w)+x(-.009999999776482582))>x(0))break}if((0|h)<(0|k))break n}if((0|I)==(0|D))if((0|(D=I?I<<1:1))<=(0|I))D=I;else{u=0,D&&(c[5498]=c[5498]+1,(_=M(19+(D<<4)|0))&&(c[(u=_+19&-16)-4>>2]=_));i:{if(f){if(!R)break i}else for(_=u,h=R,f=I;q=c[h+4>>2],c[_>>2]=c[h>>2],c[_+4>>2]=q,ne=c[4+(K=h+8|0)>>2],c[(q=_+8|0)>>2]=c[K>>2],c[q+4>>2]=ne,_=_+16|0,h=h+16|0,f=f-1|0;);c[5499]=c[5499]+1,z(c[R-4>>2])}R=u}A[12+(_=(I<<4)+R|0)>>2]=O,A[_+8>>2]=v,A[_+4>>2]=S,A[_>>2]=E,I=I+1|0}}if(_=1&t,S=x(-1),t=0,!_)break}if(!((0|(L=L+1|0))<(0|k)))break}if((0|b)==(0|k))break}if((0|C)==(0|k))break}if((0|I)<1)m=0;else{for(d=t=m=0;;){if(c[(D=40+l|0)>>2]=c[8+(_=(d<<4)+R|0)>>2],u=c[_+4>>2],c[32+l>>2]=c[_>>2],c[36+l>>2]=u,v=x(A[_+12>>2]-x(pi[c[c[e>>2]+48>>2]](e))),(0|d)==(0|(u=t)))if((0|(t=u?u<<1:1))<=(0|u))t=u;else{b=0,t&&(c[5498]=c[5498]+1,(_=M(19+(t<<4)|0))&&(c[(b=_+19&-16)-4>>2]=_));n:{if(1<=(0|u))for(_=b,h=m,f=u;C=c[h+4>>2],c[_>>2]=c[h>>2],c[_+4>>2]=C,k=c[4+(L=h+8|0)>>2],c[(C=_+8|0)>>2]=c[L>>2],c[C+4>>2]=k,_=_+16|0,h=h+16|0,f=f-1|0;);else if(!m)break n;c[5499]=c[5499]+1,z(c[m-4>>2])}m=b}else u=d;if(_=(u<<4)+m|0,u=c[36+l>>2],c[_>>2]=c[32+l>>2],c[_+4>>2]=u,u=c[D>>2],A[_+12>>2]=v,c[_+8>>2]=u,(0|I)==(0|(d=d+1|0)))break}if(!((0|I)<1)){for(C=L=_=t=0;;){if((C=(u=C)+1|0)>>>0<I>>>0)for(F=12+(D=(u<<4)+m|0)|0,W=D+4|0,te=D+8|0,k=C;;){if((0|(k=(u=k)+1|0))<(0|I))for(Q=12+(X=(u<<4)+m|0)|0,q=X+8|0,K=X+4|0,h=k;;){if(u=_,E=A[4+(_=(h<<4)+m|0)>>2],w=A[X>>2],U=A[K>>2],j=A[_>>2],V=x(x(E*w)-x(U*j)),O=A[_+8>>2],G=A[q>>2],J=x(x(U*O)-x(G*E)),$=x(x(G*j)-x(O*w)),x(x(V*V)+x(x(J*J)+x($*$)))>x(9999999747378752e-20))if(v=A[W>>2],S=A[D>>2],ee=x(x(j*v)-x(E*S)),Z=E,E=A[te>>2],Z=x(x(Z*E)-x(O*v)),j=x(x(O*S)-x(j*E)),x(x(ee*ee)+x(x(Z*Z)+x(j*j)))>x(9999999747378752e-20))if(O=x(x(U*S)-x(w*v)),U=x(x(G*v)-x(U*E)),w=x(x(w*E)-x(G*S)),x(x(O*O)+x(x(U*U)+x(w*w)))>x(9999999747378752e-20))if(v=x(x(E*V)+x(x(v*$)+x(J*S))),x(y(v))>x(9.999999974752427e-7)){for(v=x(x(-1)/v),S=A[_+12>>2],E=A[F>>2],G=x(V*E),V=A[Q>>2],O=x(v*x(x(O*S)+x(G+x(ee*V)))),w=x(v*x(x(w*S)+x(x($*E)+x(j*V)))),v=x(v*x(x(U*S)+x(x(J*E)+x(Z*V)))),f=0,d=1,_=m;!(x(x(A[_+12>>2]+x(x(x(v*A[_>>2])+x(w*A[_+4>>2]))+x(O*A[_+8>>2])))+x(-.009999999776482582))>x(0)||(_=_+16|0,d=(f=f+1|0)>>>0<I>>>0,(0|f)==(0|I))););if(1&d)_=u;else{if((0|u)==(0|L))if((0|(_=u?u<<1:1))<=(0|u))_=u;else{b=0,_&&(c[5498]=c[5498]+1,(d=M(19+(_<<4)|0))&&(c[(b=d+19&-16)-4>>2]=d));n:{if(1<=(0|u))for(f=b,d=t,H=u;ne=c[d+4>>2],c[f>>2]=c[d>>2],c[f+4>>2]=ne,i=c[4+(n=d+8|0)>>2],c[(ne=f+8|0)>>2]=c[n>>2],c[ne+4>>2]=i,f=f+16|0,d=d+16|0,H=H-1|0;);else if(!t)break n;c[5499]=c[5499]+1,z(c[t-4>>2])}t=b}else _=u,u=L;c[12+(u=(u<<4)+t|0)>>2]=0,A[u+8>>2]=O,A[u+4>>2]=w,A[u>>2]=v,L=L+1|0}}else _=u;else _=u;else _=u;else _=u;if(!((0|(h=h+1|0))<(0|I)))break}if((0|I)==(0|k))break}if((0|C)==(0|I))break}if(je(104+l|0,t,L),!t)break t;c[5499]=c[5499]+1,z(c[t-4>>2]);break t}}}je(104+l|0,0,0)}m&&(c[5499]=c[5499]+1,z(c[m-4>>2])),R&&(c[5499]=c[5499]+1,z(c[R-4>>2]))}if(1<=((k=0)|(d=c[148+l>>2])))for(c[5498]=c[5498]+1,(t=M(19+(d<<4)|0))&&(c[(k=t+19&-16)-4>>2]=t),_=k,h=d;t=c[36+l>>2],c[_>>2]=c[32+l>>2],c[_+4>>2]=t,f=c[4+(u=40+l|0)>>2],c[(t=_+8|0)>>2]=c[u>>2],c[t+4>>2]=f,_=_+16|0,h=h-1|0;);if(c[92+l>>2]=0,a[96+l|0]=1,c[84+l>>2]=0,c[88+l>>2]=0,a[0|(t=47+l|0)]=0,a[t+1|0]=0,a[t+2|0]=0,a[t+3|0]=0,c[(t=40+l|0)>>2]=0,c[t+4>>2]=0,c[32+l>>2]=0,-1<((c[36+l>>2]=0)|d)){if(d)for(Ye(80+l|0,d),_=c[92+l>>2]+20|0,t=32+l|3,f=d;c[(u=b=_-16|0)>>2]=0,c[u+4>>2]=0,a[_-4|0]=1,u=p[t+4|0]|p[t+5|0]<<8|p[t+6|0]<<16|p[t+7|0]<<24,h=p[0|t]|p[t+1|0]<<8|p[t+2|0]<<16|p[t+3|0]<<24,a[0|_]=h,a[_+1|0]=h>>>8,a[_+2|0]=h>>>16,a[_+3|0]=h>>>24,a[_+4|0]=u,a[_+5|0]=u>>>8,a[_+6|0]=u>>>16,a[_+7|0]=u>>>24,c[b+8>>2]=0,b=p[4+(h=t+8|0)|0]|p[h+5|0]<<8|p[h+6|0]<<16|p[h+7|0]<<24,h=p[0|h]|p[h+1|0]<<8|p[h+2|0]<<16|p[h+3|0]<<24,a[0|(u=_+8|0)]=h,a[u+1|0]=h>>>8,a[u+2|0]=h>>>16,a[u+3|0]=h>>>24,a[u+4|0]=b,a[u+5|0]=b>>>8,a[u+6|0]=b>>>16,a[u+7|0]=b>>>24,_=_+36|0,f=f-1|0;);if(c[84+l>>2]=d,h=c[108+l>>2],b=c[e+60>>2],(0|(u=c[b+8>>2]))<(0|h)){if(c[b+12>>2]<(0|h)){if(t=0,h&&(c[5498]=c[5498]+1,(_=M(19+(h<<4)|0))&&(c[(t=_+19&-16)-4>>2]=_)),1<=(0|u))for(_=0,f=u;m=c[b+16>>2]+_|0,L=c[m+4>>2],c[(C=D=t+_|0)>>2]=c[m>>2],c[C+4>>2]=L,C=c[4+(m=m+8|0)>>2],c[(D=D+8|0)>>2]=c[m>>2],c[D+4>>2]=C,_=_+16|0,f=f-1|0;);(_=c[b+16>>2])&&p[b+20|0]&&(c[5499]=c[5499]+1,z(c[_-4>>2])),c[b+16>>2]=t,c[b+12>>2]=h,a[b+20|0]=1}for(_=u<<4,f=h-u|0;m=c[36+l>>2],t=c[b+16>>2]+_|0,c[t>>2]=c[32+l>>2],c[t+4>>2]=m,m=c[4+(u=40+l|0)>>2],c[(t=t+8|0)>>2]=c[u>>2],c[t+4>>2]=m,_=_+16|0,f=f-1|0;);}if(1<=(0|(c[b+8>>2]=h)))for(_=0;t=c[116+l>>2]+_|0,b=c[t+4>>2],u=c[c[e+60>>2]+16>>2]+_|0,c[u>>2]=c[t>>2],c[u+4>>2]=b,f=c[4+(t=t+8|0)>>2],c[(u=u+8|0)>>2]=c[t>>2],c[u+4>>2]=f,_=_+16|0,h=h-1|0;);if(!((0|d)<1))for(R=0;;){for(t=0,u=F=c[136+l>>2]+g(c[c[156+l>>2]+(R<<2)>>2],12)|0;;){if(D=4+(m=(I=g(R,36))+c[92+l>>2]|0)|0,H=c[8+(g(c[u+4>>2],12)+u|0)>>2],(0|(f=c[m+4>>2]))==c[m+8>>2]&&!((0|(L=f?f<<1:1))<=(0|f))){L?(C=0,c[5498]=c[5498]+1,(_=M(19+(L<<2)|0))&&(c[(C=_+19&-16)-4>>2]=_),f=c[D>>2]):C=0,W=m+8|0,X=m+12|0,b=c[m+12>>2];e:{if(1<=(0|f))for(_=C,h=b;c[_>>2]=c[h>>2],_=_+4|0,h=h+4|0,f=f-1|0;);else if(!b)break e;p[m+16|0]&&(c[5499]=c[5499]+1,z(c[b-4>>2])),c[X>>2]=0,f=c[D>>2]}c[X>>2]=C,c[W>>2]=L,a[m+16|0]=1}if(c[c[m+12>>2]+(f<<2)>>2]=H,c[D>>2]=c[D>>2]+1,t=(0|t)<=1?(h=c[116+l>>2],v=A[4+(_=h+(H<<4)|0)>>2],h=h+(c[u+8>>2]<<4)|0,E=A[h+4>>2],S=A[_>>2],w=A[h>>2],U=A[_+8>>2],j=A[h+8>>2],c[12+(_=(32+l|0)+(t<<4)|0)>>2]=0,S=x(w-S),E=x(E-v),w=x(j-U),v=x(x(1)/x(T(x(x(x(S*S)+x(E*E))+x(w*w))))),A[_+8>>2]=w*v,A[_+4>>2]=E*v,A[_>>2]=S*v,t+1|0):2,_=g(c[u+4>>2],12)+u|0,(0|F)==(0|(u=g(c[_>>2],12)+_|0)))break}if(2!=(0|t)?(c[(t=(R<<4)+k|0)>>2]=0,c[t+4>>2]=0,c[(t=t+8|0)>>2]=0,c[t+4>>2]=0,h=c[92+l>>2]):(v=A[36+l>>2],S=A[52+l>>2],E=A[48+l>>2],w=A[40+l>>2],U=A[32+l>>2],j=A[56+l>>2],c[12+(t=(R<<4)+k|0)>>2]=0,V=x(x(S*U)-x(v*E)),S=x(x(v*j)-x(w*S)),E=x(x(w*E)-x(j*U)),v=x(x(1)/x(T(x(x(V*V)+x(x(S*S)+x(E*E)))))),A[t+8>>2]=V*v,A[t+4>>2]=E*v,v=x(S*v),A[t>>2]=v,h=c[92+l>>2],A[20+(_=I+h|0)>>2]=v,A[_+24>>2]=A[t+4>>2],A[_+28>>2]=A[t+8>>2],c[_+32>>2]=1900671690),(0|(u=c[4+(t=h+I|0)>>2]))<1)S=x(1.0000000150474662e30);else if(b=c[c[e+60>>2]+16>>2],f=c[t+12>>2],_=b+(c[f>>2]<<4)|0,v=A[(h=(R<<4)+k|0)>>2],E=A[h+4>>2],w=A[h+8>>2],S=(S=x(x(x(A[_>>2]*v)+x(A[_+4>>2]*E))+x(A[_+8>>2]*w)))<x(1.0000000150474662e30)?S:x(1.0000000150474662e30),1!=(0|u))for(_=f+4|0,f=u-1|0;u=b+(c[_>>2]<<4)|0,S=(U=x(x(x(A[u>>2]*v)+x(A[u+4>>2]*E))+x(A[u+8>>2]*w)))<S?U:S,_=_+4|0,f=f-1|0;);if(A[t+32>>2]=-S,(0|d)==(0|(R=R+1|0)))break}}else P();if(1<=c[84+l>>2]){for(u=b=L=0;;){if((0|u)==(0|b))if((u=b?b<<1:1)>>>0<=b>>>0)u=b;else{d=0,c[5498]=c[5498]+1,(t=M(19+(u<<2)|0))&&(c[(d=t+19&-16)-4>>2]=t);e:{if(b)for(_=d,h=L,f=b;c[_>>2]=c[h>>2],_=_+4|0,h=h+4|0,f=f-1|0;);else if(!L){u=1;break e}c[5499]=c[5499]+1,z(c[L-4>>2])}L=d}if(!((0|(b=(c[(b<<2)+L>>2]=b)+1|0))<c[84+l>>2]))break}for(X=52+l|0;;){t=c[((u=b-1|0)<<2)+L>>2],c[5498]=c[5498]+1,D=0,(_=M(23))&&(c[(D=_+19&-16)-4>>2]=_),c[D>>2]=t;e:{if((0|b)<2)H=1,b=u;else{for(t=(h=c[92+l>>2])+g(t,36)|0,v=A[t+20>>2],S=A[t+28>>2],E=A[t+24>>2],d=b-2|0,t=D,b=u,H=_=1;;){u=c[(d<<2)+L>>2],h=g(u,36)+h|0;t:if(x(x(x(v*A[h+20>>2])+x(E*A[h+24>>2]))+x(S*A[h+28>>2]))>x(.9990000128746033)){n:if((0|_)!=(0|H)||(0|(m=_?_<<1:1))<=(0|_))D=t,m=_;else{if(D=0,m&&(c[5498]=c[5498]+1,(h=M(19+(m<<2)|0))&&(c[(D=h+19&-16)-4>>2]=h)),1<=(0|_))for(h=D,f=t;c[h>>2]=c[f>>2],h=h+4|0,f=f+4|0,_=_-1|0;);else if(!t)break n;c[5499]=c[5499]+1,z(c[t-4>>2])}if(c[(H<<2)+D>>2]=u,H=H+1|0,!((0|b)<1)){for(h=0,_=L;(0|u)!=c[_>>2];)if(_=_+4|0,(0|b)==(0|(h=h+1|0)))break t;(0|b)<=(0|h)||(c[_>>2]=c[(t=((b=b-1|0)<<2)+L|0)>>2],c[t>>2]=u)}}else D=t,m=_;if(!(1<=(0|d)))break;d=d-1|0,h=c[92+l>>2],t=D,_=m}if((0|H)<=1){if(t=1!=(0|H),H=1,t)break e}else{for(c[20+l>>2]=d=0,a[24+l|0]=1,c[12+l>>2]=0,c[16+l>>2]=0,S=x(0),E=x(u=0),w=x(0),f=0;;){if(_=c[92+l>>2]+g(c[(f<<2)+D>>2],36)|0,v=A[_+20>>2],U=A[_+28>>2],j=A[_+24>>2],1<=(0|(t=c[_+4>>2])))for(W=_+4|0,te=_+12|0,m=0;;){I=c[c[te>>2]+(m<<2)>>2],_=c[c[e+60>>2]+16>>2]+(I<<4)|0,F=c[4+(R=_+8|0)>>2],c[(h=C=176+l|0)>>2]=c[R>>2],c[h+4>>2]=F,h=c[_+4>>2],c[168+l>>2]=c[_>>2],c[172+l>>2]=h;t:{if(1<=(0|u)){for(h=1<(0|d)?d:1,_=c[20+l>>2]+20|0;;){if((0|I)==c[_>>2])break t;if(_=_+24|0,!(h=h-1|0))break}u=d}if(_=c[C+4>>2],c[(t=F=40+l|0)>>2]=c[C>>2],c[t+4>>2]=_,t=c[172+l>>2],c[32+l>>2]=c[168+l>>2],c[36+l>>2]=t,c[16+l>>2]==(0|u))if((0|(R=u?u<<1:1))<=(0|u))d=u;else{if(C=0,R&&(c[5498]=c[5498]+1,(t=M(g(R,24)+19|0))&&(c[(C=t+19&-16)-4>>2]=t),u=d),t=c[20+l>>2],1<=(0|u))for(_=C,h=t;Q=c[h+4>>2],c[_>>2]=c[h>>2],c[_+4>>2]=Q,K=c[4+(q=h+16|0)>>2],c[(Q=_+16|0)>>2]=c[q>>2],c[Q+4>>2]=K,K=c[4+(q=h+8|0)>>2],c[(Q=_+8|0)>>2]=c[q>>2],c[Q+4>>2]=K,_=_+24|0,h=h+24|0,u=u-1|0;);t&&p[24+l|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2]),d=c[12+l>>2]),c[20+l>>2]=C,a[24+l|0]=1,c[16+l>>2]=R}else d=u;u=c[36+l>>2],_=c[20+l>>2]+g(d,24)|0,c[_>>2]=c[32+l>>2],c[_+4>>2]=u,c[_+20>>2]=I,c[_+16>>2]=c[48+l>>2],t=_+8|0,_=c[F+4>>2],c[t>>2]=c[F>>2],c[t+4>>2]=_,d=c[12+l>>2]+1|0,c[12+l>>2]=d,t=c[W>>2]}if(u=d,!((0|(m=m+1|0))<(0|t)))break}if(w=x(v+w),S=x(U+S),E=x(j+E),(0|(f=f+1|0))==(0|H))break}c[36+l>>2]=0,c[40+l>>2]=0,t=c[92+l>>2]+g(c[D>>2],36)|0,A[52+l>>2]=A[t+20>>2],A[56+l>>2]=A[t+24>>2],A[60+l>>2]=A[t+28>>2],c[44+l>>2]=0,A[64+l>>2]=A[t+32>>2],v=x(x(1)/x(T(x(x(x(w*w)+x(E*E))+x(S*S))))),U=x(E*v),j=x(w*v),a[48+l|0]=1,V=x(S*v),v=x(y(V))>x(.7071067690849304)?(S=x(x(V*V)+x(U*U)),v=x(x(1)/x(T(S))),$=x(S*v),S=x(v*x(-V)),ee=x(j*S),w=x(0),E=x(U*v),x(E*x(-j))):(S=x(x(j*j)+x(U*U)),v=x(x(1)/x(T(S))),ee=x(S*v),S=x(j*v),$=x(S*x(-V)),E=x(0),w=x(v*x(-U)),x(V*w));t:{n:{i:{o:if(2<=(0|d)){for(f=0,_=u=c[20+l>>2];t=_+8|0,x(x(x(w*A[_>>2])+x(S*A[_+4>>2]))+x(E*A[t>>2]))<x(x(x(w*A[u>>2])+x(S*A[u+4>>2]))+x(E*A[u+8>>2]))&&(C=c[u>>2],R=c[u+4>>2],h=c[_+4>>2],c[u>>2]=c[_>>2],c[u+4>>2]=h,I=c[(h=u+16|0)>>2],F=c[h+4>>2],W=c[4+(m=_+16|0)>>2],c[h>>2]=c[m>>2],c[h+4>>2]=W,W=c[(h=u+8|0)>>2],te=c[h+4>>2],Q=c[t+4>>2],c[h>>2]=c[t>>2],c[h+4>>2]=Q,c[_>>2]=C,c[_+4>>2]=R,c[m>>2]=I,c[m+4>>2]=F,c[t>>2]=W,c[t+4>>2]=te),_=_+24|0,(0|(f=f+1|0))<(0|d););if(c[u+16>>2]=-246811958,2<=(0|d))for(_=u+40|0,f=d-1|0,o=A[u+8>>2],r=A[u+4>>2],s=A[u>>2];O=x(A[(t=_)-16>>2]-s),G=x(A[_-12>>2]-r),Z=x(A[_-8>>2]-o),J=x(x(x($*O)+x(v*G))+x(ee*Z)),O=x(x(x(w*O)+x(S*G))+x(E*Z)),O=x(x(J*J)+x(O*O))<x(1.1920928955078125e-7)?x(0):(G=x(y(J)),O=O>=x(0)?(Z=x(.7853981852531433),x(x(O-G)/x(O+G))):(Z=x(2.356194496154785),x(x(O+G)/x(G-O))),O=x(Z+x(O*x(-.7853981852531433))),J<x(0)?x(-O):O),A[t>>2]=O,_=_+24|0,f=f-1|0;);if(h=c[4+(_=u+8|0)>>2],c[(t=176+l|0)>>2]=c[_>>2],c[t+4>>2]=h,t=c[u+4>>2],c[168+l>>2]=c[u>>2],c[172+l>>2]=t,function e(t,n,i,o){var a,r,s=x(0),l=0,_=0,u=0,h=x(0),f=0,p=0,d=0,m=0,v=x(0),y=0,b=x(0),S=x(0),C=x(0),E=x(0),T=0,P=0,w=0,I=x(0),R=x(0),D=x(0),O=0;for(N=a=N-32|0,_=(f=c[t+12>>2])+g((i+o|0)/2|0,24)|0,r=c[_+20>>2],b=A[_+16>>2],I=A[_+8>>2],R=A[_+4>>2],D=A[_>>2],_=i,p=o;;){for(S=A[n>>2],h=x(D-S),s=x(h*h),C=A[n+4>>2],h=x(R-C),s=x(s+x(h*h)),E=A[n+8>>2],h=x(I-E),h=x(s+x(h*h)),l=20+(g(_,24)+f|0)|0;;){a:{r:{if((s=A[l-4>>2])!=b){if(s<b)break r;break a}if(s=x(A[l-20>>2]-S),v=x(s*s),s=x(A[l-16>>2]-C),v=x(v+x(s*s)),s=x(A[l-12>>2]-E),1!=(0|((s=x(v+x(s*s)))!=h?s<h:c[l>>2]<(0|r))))break a}l=l+24|0,_=_+1|0;continue}break}for(d=g(p,24);;){a:{r:{if((s=A[(T=16+(u=d+f|0)|0)>>2])!=b){if(b<s)break r;break a}if(s=x(A[u>>2]-S),v=x(s*s),s=x(A[u+4>>2]-C),v=x(v+x(s*s)),s=x(A[u+8>>2]-E),1!=(0|((s=x(v+x(s*s)))!=h?h<s:c[u+20>>2]>(0|r))))break a}d=d-24|0,p=p-1|0;continue}break}if((0|_)<=(0|p)&&(m=c[4+(P=16+(l=l-20|0)|0)>>2],c[(f=24+a|0)>>2]=c[(y=P)>>2],c[f+4>>2]=m,O=c[4+(y=l+8|0)>>2],c[(m=w=16+a|0)>>2]=c[y>>2],c[4+m>>2]=O,m=c[l+4>>2],c[8+a>>2]=c[l>>2],c[12+a>>2]=m,m=c[u+4>>2],c[l>>2]=c[u>>2],c[l+4>>2]=m,u=c[4+(l=u+8|0)>>2],c[y>>2]=c[l>>2],c[4+y>>2]=u,l=c[T+4>>2],c[P>>2]=c[T>>2],c[4+P>>2]=l,l=c[t+12>>2]+d|0,d=c[12+a>>2],c[l>>2]=c[8+a>>2],c[l+4>>2]=d,d=c[f+4>>2],c[(u=l+16|0)>>2]=c[f>>2],c[u+4>>2]=d,u=c[4+w>>2],c[(l=l+8|0)>>2]=c[w>>2],c[l+4>>2]=u,p=p-1|0,_=_+1|0),!((0|_)<=(0|p)))break;f=c[t+12>>2]}(0|i)<(0|p)&&e(t,n,i,p),(0|_)<(0|o)&&e(t,n,_,o),N=32+a|0}(8+l|0,168+l|0,1,d-1|0),m=0,c[5498]=c[5498]+1,t=c[20+l>>2],_=0,(u=M(43))&&(c[(_=u+19&-16)-4>>2]=u),h=c[20+l>>2],u=c[t+4>>2],c[_>>2]=c[t>>2],c[_+4>>2]=u,C=c[4+(f=t+16|0)>>2],c[(u=_+16|0)>>2]=c[f>>2],c[u+4>>2]=C,C=c[4+(t=t+8|0)>>2],c[(f=d=_+8|0)>>2]=c[t>>2],c[f+4>>2]=C,c[5498]=c[5498]+1,(t=M(67))&&(c[(m=t+19&-16)-4>>2]=t),t=c[_+4>>2],c[m>>2]=c[_>>2],c[m+4>>2]=t,f=c[u+4>>2],c[(t=m+16|0)>>2]=c[u>>2],c[t+4>>2]=f,u=c[d+4>>2],c[(t=m+8|0)>>2]=c[d>>2],c[t+4>>2]=u,c[5499]=c[5499]+1,z(c[_-4>>2]),d=c[4+(u=16+(t=h+24|0)|0)>>2],c[(_=m+40|0)>>2]=c[u>>2],c[_+4>>2]=d,d=c[4+(u=t+8|0)>>2],c[(_=m+32|0)>>2]=c[u>>2],c[_+4>>2]=d,_=c[t+4>>2],c[m+24>>2]=c[t>>2],c[m+28>>2]=_,2!=c[12+l>>2]){for(R=h=d=u=2;;){a:{r:{s:if(!((0|h)<2)){for(f=h<<1,_=(g(h,24)+m|0)-48|0,t=c[20+l>>2]+g(R,24)|0,v=A[t+8>>2],S=A[t+4>>2],E=A[t>>2];;){if(w=A[_>>2],O=x(w-A[_+24>>2]),G=A[_+4>>2],J=x(G-S),G=x(G-A[_+28>>2]),w=x(w-E),ee=x(x(x(O*J)-x(G*w))*V),Z=G,G=A[_+8>>2],$=x(G-v),G=x(G-A[_+32>>2]),x(ee+x(x(j*x(x(Z*$)-x(G*J)))+x(U*x(x(G*w)-x(O*$)))))>x(0)){if(!((0|f)<=(0|h))&&(0|u)==(0|h)){if(I=0,c[5498]=c[5498]+1,(_=M(g(u,48)+19|0))&&(c[(I=_+19&-16)-4>>2]=_),1<=(0|d))for(_=I,h=m,u=d;C=c[h+4>>2],c[_>>2]=c[h>>2],c[_+4>>2]=C,W=c[4+(F=h+16|0)>>2],c[(C=_+16|0)>>2]=c[F>>2],c[C+4>>2]=W,W=c[4+(F=h+8|0)>>2],c[(C=_+8|0)>>2]=c[F>>2],c[C+4>>2]=W,_=_+24|0,h=h+24|0,u=u-1|0;);c[5499]=c[5499]+1,z(c[m-4>>2]),u=f,m=I,h=d}f=c[t+4>>2],_=g(h,24)+m|0,c[_>>2]=c[t>>2],c[_+4>>2]=f,C=c[4+(f=t+16|0)>>2],c[(h=_+16|0)>>2]=c[f>>2],c[h+4>>2]=C,h=c[4+(t=t+8|0)>>2],c[(_=_+8|0)>>2]=c[t>>2],c[_+4>>2]=h,h=d=d+1|0;break s}if(_=_-24|0,f=f-2|0,!(2<(1+(h=d=h-1|0)|0)))break}d=1;break r}if(1!=(0|h))break a}if(h=c[20+l>>2]+g(R,24)|0,1==(0|u)){t=0,c[5498]=c[5498]+1,(_=M(67))&&(c[(t=_+19&-16)-4>>2]=_);r:{if(1<=(0|d))for(_=0,u=d;W=c[4+(C=F=_+m|0)>>2],c[(f=t+_|0)>>2]=c[C>>2],c[f+4>>2]=W,W=c[4+(C=C+16|0)>>2],c[(I=f+16|0)>>2]=c[C>>2],c[I+4>>2]=W,I=c[4+(C=F+8|0)>>2],c[(f=f+8|0)>>2]=c[C>>2],c[f+4>>2]=I,_=_+24|0,u=u-1|0;);else if(!m)break r;c[5499]=c[5499]+1,z(c[m-4>>2])}u=2,m=t,t=d}else t=1;f=c[h+4>>2],t=g(t,24)+m|0,c[(_=t)>>2]=c[h>>2],c[_+4>>2]=f,C=c[4+(f=h+16|0)>>2],c[(_=_+16|0)>>2]=c[f>>2],c[_+4>>2]=C,h=c[4+(_=h+8|0)>>2],c[(t=t+8|0)>>2]=c[_>>2],c[t+4>>2]=h,h=d=d+1|0}if((0|(R=R+1|0))==c[12+l>>2])break}if(0<(0|d))break o;break i}d=2}else{if(1!=((m=0)|d))break n;c[5498]=c[5498]+1,t=c[20+l>>2],(_=M(43))&&(c[(m=_+19&-16)-4>>2]=_),_=c[t+4>>2],c[m>>2]=c[t>>2],c[m+4>>2]=_,d=c[4+(u=t+16|0)>>2],c[(_=m+16|0)>>2]=c[u>>2],c[_+4>>2]=d,u=c[4+(t=t+8|0)>>2],c[(_=m+8|0)>>2]=c[t>>2],c[_+4>>2]=u,d=1}for(f=c[40+l>>2],C=p[48+l|(I=0)],t=c[36+l>>2];;){if(F=20+(g(I,24)+m|0)|0,(0|t)==(0|f))if((0|(u=f?f<<1:1))<=(0|f))t=f;else{R=0,u&&(c[5498]=c[5498]+1,(t=M(19+(u<<2)|0))&&(c[(R=t+19&-16)-4>>2]=t)),t=c[44+l>>2];o:{if(1<=(0|f))for(_=R,h=t;c[_>>2]=c[h>>2],_=_+4|0,h=h+4|0,f=f-1|0;);else if(!t)break o;C&&(c[5499]=c[5499]+1,z(c[t-4>>2])),f=c[36+l>>2]}t=f,c[40+l>>2]=u,c[44+l>>2]=R,C=1,f=u}c[c[44+l>>2]+(t<<2)>>2]=c[F>>2],c[36+l>>2]=t=t+1|0;o:if(!(u=(0|(R=c[12+l>>2]))<1)){for(_=c[20+l>>2]+20|0,F=c[F>>2],h=R;(0|F)!=c[_>>2];)if(_=_+24|0,!(h=h-1|0))break o;c[_>>2]=-1}if((0|(I=I+1|0))==(0|d))break}if(a[48+l|0]=C,u)break n}if(!((0|(d=c[84+l>>2]))<1))for(C=c[92+l>>2],I=c[20+l>>2],R=1<(0|R)?R:1,t=0;;){if(-1!=(0|(F=c[20+(I+g(t,24)|0)>>2])))for(f=0;;){_=D,h=H;i:{for(;;){if(c[_>>2]==(0|f))break i;if(_=_+4|0,!(h=h-1|0))break}if(_=C+g(f,36)|0,!((0|(h=c[_+4>>2]))<1))for(_=c[_+12>>2];;){if(u=1,(0|F)==c[_>>2])break t;if(_=_+4|0,!(h=h-1|0))break}}if((0|d)==(0|(f=f+1|0)))break}if((0|R)==(0|(t=t+1|0)))break}}Xe(c[e+60>>2]+24|0,32+l|0),u=0}if(m&&(c[5499]=c[5499]+1,z(c[m-4>>2])),(t=c[44+l>>2])&&p[48+l|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),(t=c[20+l>>2])&&p[24+l|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),!u)break e}}for(d=0;;){if(c[44+l>>2]=0,t=c[(d<<2)+D>>2],c[40+l>>2]=0,u=c[92+l>>2]+g(t,36)|0,f=c[u+4>>2],(a[48+l|0]=1)<=(0|f)){for(_=0,c[5498]=c[5498]+1,(t=M(19+(h=f<<2)|0))&&(c[(_=t+19&-16)-4>>2]=t,(t=c[44+l>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),c[44+l>>2]=_,a[48+l|0]=1,c[40+l>>2]=f,B(_,0,h),c[36+l>>2]=f,h=c[u+12>>2];c[_>>2]=c[h>>2],_=_+4|0,h=h+4|0,f=f-1|0;);h=p[48+l|0],t=c[44+l>>2]}else c[36+l>>2]=f,h=1,t=0;if(_=c[u+24>>2],c[X>>2]=c[u+20>>2],c[X+4>>2]=_,f=c[4+(u=u+28|0)>>2],c[(_=X+8|0)>>2]=c[u>>2],c[_+4>>2]=f,Xe(c[e+60>>2]+24|0,32+l|0),t&&255&h&&(c[5499]=c[5499]+1,z(c[t-4>>2])),(0|H)==(0|(d=d+1|0)))break}}if(D&&(c[5499]=c[5499]+1,z(c[D-4>>2])),!b)break}if(Me(c[e+60>>2]),L&&(c[5499]=c[5499]+1,z(c[L-4>>2])),!((0|(h=c[84+l>>2]))<1))for(_=c[92+l>>2]+8|0;(t=c[(e=_+4|0)>>2])&&p[_+8|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e>>2]=0,a[_+8|0]=1,c[(e=_-4|0)>>2]=0,_=_+36|(c[e+4>>2]=0),h=h-1|0;);}else Me(c[e+60>>2]);return(e=c[92+l>>2])&&p[96+l|0]&&(c[5499]=c[5499]+1,z(c[e-4>>2])),k&&(c[5499]=c[5499]+1,z(c[k-4>>2])),(e=c[156+l>>2])&&p[160+l|0]&&(c[5499]=c[5499]+1,z(c[e-4>>2])),c[156+l>>2]=0,a[160+l|0]=1,c[148+l>>2]=0,c[152+l>>2]=0,(e=c[136+l>>2])&&p[140+l|0]&&(c[5499]=c[5499]+1,z(c[e-4>>2])),c[136+l>>2]=0,a[140+l|0]=1,c[128+l>>2]=0,c[132+l>>2]=0,(e=c[116+l>>2])&&p[120+l|0]&&(c[5499]=c[5499]+1,z(c[e-4>>2])),Y&&(c[5499]=c[5499]+1,z(c[Y-4>>2])),N=208+l|0,1},Je,Ke,$e,function(e,t,n){e|=0,t=x(t),n|=0,x(0);var i=A[e+44>>2],o=A[e+40>>2],a=A[e+36>>2],r=x(pi[c[c[e>>2]+48>>2]](e)),s=x(pi[c[c[e>>2]+48>>2]](e));e=x(pi[c[c[e>>2]+48>>2]](e)),c[n+12>>2]=0,t=x(t/x(12)),a=x(a+r),a=x(a+a),a=x(a*a),o=x(o+s),o=x(o+o),o=x(o*o),A[n+8>>2]=t*x(a+o),i=x(i+e),i=x(i+i),i=x(i*i),A[n+4>>2]=t*x(a+i),A[n>>2]=t*x(o+i)},function(){return 8474},Ze,function(e,t,n){e|=0,t|=0,n|=0;var i=x(0),o=(i=A[t+40>>2],A[t+44>>2]),a=A[t+36>>2],r=x(pi[c[c[t>>2]+48>>2]](t)),s=x(pi[c[c[t>>2]+48>>2]](t));t=x(pi[c[c[t>>2]+48>>2]](t)),c[e+12>>2]=0,o=x(o+t),A[e+8>>2]=A[n+8>>2]>=x(0)?o:x(-o),i=x(i+s),A[e+4>>2]=A[n+4>>2]>=x(0)?i:x(-i),i=x(a+r),A[e>>2]=A[n>>2]>=x(0)?i:x(-i)},function(e,t,n){e|=0,t|=0,n|=0;var i=x(0);c[e+12>>2]=0,i=A[t+36>>2],A[e>>2]=A[n>>2]>=x(0)?i:x(-i),i=A[t+44>>2],A[e+8>>2]=A[n+8>>2]>=x(0)?i:x(-i),i=A[t+40>>2],A[e+4>>2]=A[n+4>>2]>=x(0)?i:x(-i)},function(e,t,n,i){e|=0,t|=0,n|=0;var o,a,r,s,l,_,u,h=0;if(1<=(0|(i|=0)))for(;l=A[4+(o=t+h|0)>>2],_=A[8+o>>2],u=A[o>>2],a=A[e+40>>2],r=A[e+44>>2],s=A[e+36>>2],c[12+(o=n+h|0)>>2]=0,A[o>>2]=u>=x(0)?s:x(-s),A[8+o>>2]=_>=x(0)?r:x(-r),A[4+o>>2]=l>=x(0)?a:x(-a),h=h+16|0,i=i-1|0;);},tt,function(e,t,n){e|=0,n|=0,(t|=0)>>>0<=5&&(c[n+12>>2]=0,A[n+8>>2]=A[8424+(e=t<<2)>>2],A[n+4>>2]=A[e+8400>>2],A[n>>2]=A[e+8376>>2])},function(){return 8},Ie,function(e,t,n,i){i|=0;var o=0;t=(t|=0)>>>0<=11?(o=c[8328+(t<<=2)>>2],c[t+8280>>2]):0,pi[c[c[(e|=0)>>2]+108>>2]](e,t,n|=0),pi[c[c[e>>2]+108>>2]](e,o,i)},function(e,t,n){e|=0,t|=0,n|=0,x(0);var i=A[e+44>>2],o=A[e+40>>2],a=A[e+36>>2],r=x(pi[c[c[e>>2]+48>>2]](e)),s=x(pi[c[c[e>>2]+48>>2]](e)),l=x(pi[c[c[e>>2]+48>>2]](e));c[n+12>>2]=0,o=x(o+s),A[n+4>>2]=x(o*x(0|!(e=t>>>1&1)))-x(o*x(0|e)),o=x(a+r),A[n>>2]=x(o*x(0|!(e=1&t)))-x(o*x(0|e)),i=x(i+l),A[n+8>>2]=x(i*x(0|!(e=t>>>2&1)))-x(i*x(0|e))},tt,function(e,t,n,i){t|=0,n|=0,i|=0;var o,a,r,s;N=s=N-48|0,pi[c[c[(e|=0)>>2]+124>>2]](e,32+s|0,i),c[t+12>>2]=0,o=A[40+s>>2],A[t+8>>2]=o,a=A[36+s>>2],A[t+4>>2]=a,r=A[32+s>>2],A[t>>2]=r,c[12+s>>2]=0,A[8+s>>2]=-o,A[4+s>>2]=-a,A[s>>2]=-r,pi[c[c[e>>2]+64>>2]](16+s|0,e,s),i=c[4+(t=24+s|0)>>2],c[(e=n+8|0)>>2]=c[t>>2],c[e+4>>2]=i,e=c[20+s>>2],c[n>>2]=c[16+s>>2],c[n+4>>2]=e,N=48+s|0},function(e,t,n){e|=0,t|=0,n=x(n),x(0);var i=0,o=A[t>>2],a=A[e+36>>2];return o<=x(a+n)&&o>=x(x(-a)-n)&&(o=A[t+4>>2],a=A[e+40>>2],o<=x(a+n)&&o>=x(x(-a)-n)&&(o=A[t+8>>2],a=A[e+44>>2],o<=x(a+n)&&(i=o>=x(x(-a)-n)))),0|i},function(e,t,n){e|=0,t|=0,n|=0;var i=x(0),o=x(0),a=x(0),r=x(0),s=A[e+44>>2],c=A[e+40>>2];i=A[e+36>>2],o=x(1);e:{t:{n:{i:{o:switch(0|n){case 1:o=x(-1);break t;case 2:a=x(1);break n;case 3:a=x(-1);break n;case 4:i=x(1);break i;case 0:break t;case 5:break o;default:break e}i=x(-1)}r=i,o=x(0),i=s;break t}o=x(0),i=c}A[t+8>>2]=r,A[t+4>>2]=a,A[t>>2]=o,A[t+12>>2]=-i}},Se,nt,function(e,t,n,i){e|=0,t|=0,n|=0,i|=0,x(0);var o,a,r,s,l,_,u,h,f,p,d,m,v,g=e+36|0;e=c[e+60>>2],a=A[g+((e+2|0)%3<<2)>>2],A[8+(v=N-16|0)>>2]=a,A[4+v>>2]=a,A[v>>2]=a,A[(e<<=2)+v>>2]=a+A[e+g>>2],a=A[t+56>>2],h=A[t+40>>2],f=A[t+36>>2],_=A[t+52>>2],l=A[t+24>>2],p=A[t+20>>2],d=A[t+32>>2],m=A[t+16>>2],u=A[t+48>>2],r=A[t+8>>2],o=A[t>>2],s=A[t+4>>2],c[n+12>>2]=0,e=x(y(o)),o=A[v>>2],g=x(y(s)),s=A[4+v>>2],t=x(y(r)),r=A[8+v>>2],e=x(x(x(e*o)+x(g*s))+x(t*r)),A[n>>2]=u-e,l=x(x(x(o*x(y(m)))+x(s*x(y(p))))+x(r*x(y(l)))),A[n+4>>2]=_-l,o=x(x(x(o*x(y(d)))+x(s*x(y(f))))+x(r*x(y(h)))),A[n+8>>2]=a-o,A[i>>2]=u+e,A[i+4>>2]=_+l,A[i+8>>2]=a+o,c[i+12>>2]=0},function(e,t){e|=0,t|=0,x(0);var n,i,o,a=A[t>>2],r=A[t+4>>2],s=A[t+8>>2];c[e+32>>2]=0,n=A[(o=e+28|0)>>2],A[o>>2]=y(s),s=A[(o=e+24|0)>>2],A[o>>2]=y(r),r=A[e+20>>2],A[e+20>>2]=y(a),a=A[t+8>>2],i=A[t+4>>2],o=A[t>>2],c[e+48>>2]=0,A[e+36>>2]=o*x(A[e+36>>2]/r),A[(t=e+40|0)>>2]=i*x(A[t>>2]/s),A[(t=e+44|0)>>2]=a*x(A[t>>2]/n),A[e+52>>2]=A[(e+36|0)+((c[e+60>>2]+2|0)%3<<2)>>2]},function(e,t,n){e|=0,t=x(t),n|=0,x(0);var i,o=0,a=0,r=(o=c[e+60>>2],A[(a=e+36|0)+((o+2|0)%3<<2)>>2]);c[12+(e=N-16|0)>>2]=0,A[e+8>>2]=r,A[e+4>>2]=r,A[e>>2]=r,A[(i=(o<<=2)+e|0)>>2]=A[o+a>>2]+A[i>>2],t=x(t*x(.0833333283662796)),r=A[e>>2],r=x(r+r),r=x(r*r),a=A[e+4>>2],a=x(a+a),a=x(a*a),A[n+8>>2]=t*x(r+a),i=r,r=A[e+8>>2],r=x(r+r),r=x(r*r),A[n+4>>2]=t*x(i+r),A[n>>2]=t*x(a+r)},function(){return 8623},it,ot,at,function(e,t,n){t|=0;var i=0|pi[c[c[(n|=0)>>2]+40>>2]](n,e|=0),o=0|pi[c[c[n>>2]+28>>2]](n,i);return(c[t>>2]=o)&&pi[c[c[n>>2]+48>>2]](n,i),n=c[e+4>>2],c[t+8>>2]=0,A[t+28>>2]=A[e+36>>2],A[t+32>>2]=A[e+40>>2],A[t+36>>2]=A[e+44>>2],A[t+40>>2]=A[e+48>>2],A[t+12>>2]=A[e+20>>2],A[t+16>>2]=A[e+24>>2],A[t+20>>2]=A[e+28>>2],A[t+24>>2]=A[e+32>>2],c[t+4>>2]=n,A[t+44>>2]=A[e+52>>2],c[t+48>>2]=0,e=c[e+60>>2],c[t+56>>2]=0,c[t+52>>2]=e,8604},function(e,t,n){e|=0,t|=0,n|=0;var i,o,a,r=x(0),s=x(0),l=x(0),_=x(0),u=x(0),h=x(0),f=x(0),p=N-16|0;c[e>>2]=0,c[e+4>>2]=0,c[(a=e+8|0)>>2]=0,c[4+a>>2]=0,s=A[n>>2],l=A[n+4>>2],r=A[n+8>>2],s=(_=x(x(x(s*s)+x(l*l))+x(r*r)))<x(9999999747378752e-20)?(_=x(0),x(1)):(u=r,r=x(x(1)/x(T(_))),f=x(u*r),_=x(l*r),x(s*r)),c[(n=8+p|0)>>2]=0,c[n+4>>2]=0,c[p>>2]=0,c[4+p>>2]=0,a=c[t+60>>2]<<2,u=A[36+(t+a|0)>>2],A[(i=p+a|0)>>2]=u,l=x(-0xde0b6b000000000),h=A[p>>2],o=A[4+p>>2],a=A[n>>2],(r=x(x(x(s*h)+x(_*o))+x(f*a)))>x(-0xde0b6b000000000)&&(A[e+12>>2]=A[12+p>>2],A[e+8>>2]=a,A[e+4>>2]=o,A[e>>2]=h,l=r),c[(n=t=8+p|0)>>2]=0,c[n+4>>2]=0,c[p>>2]=0,c[4+p>>2]=0,A[i>>2]=-u,u=l,h=s,s=A[p>>2],l=A[4+p>>2],r=A[n>>2],u<x(x(x(h*s)+x(_*l))+x(f*r))&&(A[e+12>>2]=A[12+p>>2],A[e+8>>2]=r,A[e+4>>2]=l,A[e>>2]=s)},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,a,r,s,l,_,u=0,h=x(0),f=x(0),p=x(0),d=x(0),m=0,v=x(0),g=x(0),y=x(0),b=N-16|0;if(1<=(0|i))for(;c[(o=8+b|0)>>2]=0,c[4+o>>2]=0,c[b>>2]=0,c[4+b>>2]=0,u=c[e+60>>2],h=A[36+((a=u<<2)+e|0)>>2],A[b+a>>2]=h,f=x(-0xde0b6b000000000),d=A[b>>2],v=A[(a=t+m|0)>>2],r=A[4+b>>2],g=A[(s=4+a|0)>>2],l=A[o>>2],y=A[(_=8+a|0)>>2],(p=x(x(x(d*v)+x(r*g))+x(l*y)))>x(-0xde0b6b000000000)&&(A[(u=n+m|0)>>2]=d,A[u+12>>2]=A[12+b>>2],A[u+8>>2]=l,A[u+4>>2]=r,y=A[_>>2],g=A[s>>2],u=c[e+60>>2],h=A[36+((u<<2)+e|0)>>2],v=A[a>>2],f=p),c[o>>2]=0,c[4+o>>2]=0,c[b>>2]=0,c[4+b>>2]=0,A[(u<<2)+b>>2]=-h,d=f,f=A[b>>2],p=A[4+b>>2],h=A[o>>2],d<x(x(x(f*v)+x(p*g))+x(h*y))&&(A[(o=n+m|0)>>2]=f,A[12+o>>2]=A[12+b>>2],A[8+o>>2]=h,A[4+o>>2]=p),m=m+16|0,i=i-1|0;);},nt,Ke,$e,function(e,t,n){e|=0,t=x(t),n|=0;var i,o,a,r=x(0),s=x(0),l=x(0),_=(l=A[e+44>>2],r=A[e+40>>2],A[e+36>>2]),u=x(pi[c[c[e>>2]+48>>2]](e));r=x(r+x(pi[c[c[e>>2]+48>>2]](e))),a=x(pi[c[c[e>>2]+48>>2]](e)),s=x(t*x(.5)),i=x(t*x(.25)),o=x(t/x(12)),t=x(u+_);e:{switch(c[e+60>>2]){case 0:l=s,s=x(r*r),r=x(l*s),s=t=x(x(i*s)+x(o*x(t*x(t*x(4)))));break e;case 2:t=x(t*t),s=x(s*t),r=x(i*t),t=x(a+l),t=r=x(r+x(o*x(t*x(t*x(4)))));break e}l=s,s=x(t*t),t=x(l*s),s=r=x(x(i*s)+x(o*x(r*x(r*x(4)))))}c[n+12>>2]=0,A[n+8>>2]=s,A[n+4>>2]=t,A[n>>2]=r},function(){return 8792},it,Ze,at,function(e,t,n){t|=0;var i=0|pi[c[c[(n|=0)>>2]+40>>2]](n,e|=0),o=0|pi[c[c[n>>2]+28>>2]](n,i);return(c[t>>2]=o)&&pi[c[c[n>>2]+48>>2]](n,i),n=c[e+4>>2],c[t+8>>2]=0,A[t+28>>2]=A[e+36>>2],A[t+32>>2]=A[e+40>>2],A[t+36>>2]=A[e+44>>2],A[t+40>>2]=A[e+48>>2],A[t+12>>2]=A[e+20>>2],A[t+16>>2]=A[e+24>>2],A[t+20>>2]=A[e+28>>2],A[t+24>>2]=A[e+32>>2],c[t+4>>2]=n,A[t+44>>2]=A[e+52>>2],c[t+48>>2]=0,e=c[e+60>>2],c[t+56>>2]=0,c[t+52>>2]=e,8772},function(e,t,n){e|=0,t|=0,n|=0;var i,o,a,r,s=x(0),l=x(0),_=x(0);N=r=N-16|0,pi[c[c[t>>2]+68>>2]](r,t,n),a=c[4+(o=8+r|0)>>2],c[(i=e+8|0)>>2]=c[o>>2],c[4+i>>2]=a,i=c[4+r>>2],c[e>>2]=c[r>>2],c[e+4>>2]=i,x(pi[c[c[t>>2]+48>>2]](t))!=x(0)&&(l=A[n+4>>2],s=A[n>>2],_=A[n+8>>2],i=x(pi[c[c[t>>2]+48>>2]](t)),n=s=(t=x(x(x(s*s)+x(l*l))+x(_*_))<x(14210854715202004e-30))?x(-1):s,_=t?x(-1):_,l=t?x(-1):l,s=x(x(1)/x(T(x(x(_*_)+x(x(s*s)+x(l*l)))))),A[e>>2]=A[e>>2]+x(i*x(n*s)),A[e+4>>2]=A[e+4>>2]+x(i*x(l*s)),A[e+8>>2]=A[e+8>>2]+x(i*x(_*s))),N=16+r|0},function(e,t,n){e|=0,t|=0,n|=0;var i=x(0),o=x(0),a=x(0),r=x(0),s=(i=A[t+40>>2],o=A[t+36>>2],A[n>>2]);t=A[n+8>>2],(a=x(T(x(x(s*s)+x(t*t)))))==x(0)||(o=x(o/a),r=x(t*o),o=x(s*o)),i=A[n+4>>2]<x(0)?x(-i):i,A[e+8>>2]=r,A[e+4>>2]=i,A[e>>2]=o},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,a,r=x(0),s=x(0),c=x(0);if(1<=(0|i))for(;r=A[e+40>>2],s=A[e+36>>2],o=A[t>>2],c=A[t+8>>2],(a=x(T(x(x(o*o)+x(c*c)))))==x(0)?c=x(0):(s=x(s/a),c=x(c*s),s=x(o*s)),r=A[t+4>>2]<x(0)?x(-r):r,A[n>>2]=s,A[n+8>>2]=c,A[n+4>>2]=r,t=t+16|0,n=n+16|0,i=i-1|0;);},function(e){e|=0,x(0);var t=A[e+36>>2],n=x(pi[c[c[e>>2]+48>>2]](e));return x(pi[c[c[e>>2]+48>>2]](e)),x(pi[c[c[e>>2]+48>>2]](e)),x(x(t+n))},nt,function(e,t){t|=0;var n=0,i=c[76+(e|=0)>>2]<<2,o=A[i+t>>2],a=x(A[e+68>>2]*x(o/A[(n=i)+(i=e+20|0)>>2]));A[e+68>>2]=a,n=c[e+72>>2]<<2,o=x(A[n+t>>2]/A[i+n>>2]),n=c[e+80>>2]<<2,n=x(A[e+64>>2]*x(x(o+x(A[n+t>>2]/A[i+n>>2]))*x(.5))),A[e+64>>2]=n,A[e+60>>2]=n/x(T(x(x(a*a)+x(n*n)))),n=A[t+8>>2],a=A[t+4>>2],o=A[t>>2],c[e+32>>2]=0,A[e+20>>2]=y(o),A[e+24>>2]=y(a),A[e+28>>2]=y(n)},function(e,t,n){e|=0,t=x(t),n|=0;var i,o,a,r,s,l,_;c[(l=44+(N=_=N-96|0)|0)>>2]=0,c[4+l>>2]=0,c[(l=56+_|0)>>2]=0,c[4+l>>2]=0,c[52+_>>2]=1065353216,c[(l=_+64|0)>>2]=0,c[4+l>>2]=0,c[(l=76+_|0)>>2]=0,c[4+l>>2]=0,c[72+_>>2]=1065353216,c[(l=84+_|0)>>2]=0,c[4+l>>2]=0,c[92+_>>2]=0,c[36+_>>2]=0,c[40+_>>2]=0,c[32+_>>2]=1065353216,pi[c[c[e>>2]+8>>2]](e,32+_|0,16+_|0,_),a=A[24+_>>2],r=A[8+_>>2],i=A[16+_>>2],o=A[_>>2],s=A[20+_>>2],l=A[4+_>>2],e=x(pi[c[c[e>>2]+48>>2]](e)),c[n+12>>2]=0,t=x(t*x(.0833333283662796)),i=x(e+x(x(o-i)*x(.5))),i=x(i+i),i=x(i*i),o=x(e+x(x(l-s)*x(.5))),o=x(o+o),o=x(o*o),A[n+8>>2]=t*x(i+o),e=x(e+x(x(r-a)*x(.5))),e=x(e+e),e=x(e*e),A[n+4>>2]=t*x(i+e),A[n>>2]=t*x(o+e),N=96+_|0},function(){return 8948},function(e){c[8+(e|=0)>>2]=0,c[e+12>>2]=0,c[e>>2]=0,c[e+4>>2]=1065353216},at,function(e,t,n){e|=0,t|=0,n|=0,x(0);var i=0|pi[c[c[n>>2]+40>>2]](n,e),o=0|pi[c[c[n>>2]+28>>2]](n,i);return(c[t>>2]=o)&&pi[c[c[n>>2]+48>>2]](n,i),n=c[e+4>>2],c[t+8>>2]=0,A[t+28>>2]=A[e+36>>2],A[t+32>>2]=A[e+40>>2],A[t+36>>2]=A[e+44>>2],A[t+40>>2]=A[e+48>>2],A[t+12>>2]=A[e+20>>2],A[t+16>>2]=A[e+24>>2],A[t+20>>2]=A[e+28>>2],A[t+24>>2]=A[e+32>>2],c[t+4>>2]=n,n=A[e+52>>2],c[t+48>>2]=0,A[t+44>>2]=n,e=c[e+76>>2],c[t+56>>2]=0,c[t+52>>2]=e,8932},function(e,t,n){e|=0,t|=0,n|=0;var i,o=x(0),a=x(0),r=x(0),s=x(0),l=0,_=x(0),u=(a=x(A[t+68>>2]*x(.5)),c[t+72>>2]);l=(i=c[t+76>>2])<<2,o=A[n>>2],s=x(o*o),o=A[n+4>>2],s=x(s+x(o*o)),o=A[n+8>>2];e:{if(A[l+n>>2]>x(A[t+60>>2]*x(T(x(s+x(o*o))))))c[(u<<2)+e>>2]=0,A[e+l>>2]=a,l=c[t+80>>2];else{if(o=A[(u<<2)+n>>2],l=c[t+80>>2],r=A[(l<<2)+n>>2],(_=x(T(x(x(o*o)+x(r*r)))))>x(1.1920928955078125e-7)){s=o,o=x(A[t+64>>2]/_),A[(u<<2)+e>>2]=s*o,A[(i<<2)+e>>2]=-a,a=x(r*o);break e}c[(u<<2)+e>>2]=0,A[(i<<2)+e>>2]=-a}a=x(0)}A[(l<<2)+e>>2]=a,x(pi[c[c[t>>2]+48>>2]](t))!=x(0)&&(a=A[n+4>>2],o=A[n>>2],r=A[n+8>>2],_=x(pi[c[c[t>>2]+48>>2]](t)),s=o=(t=x(x(x(o*o)+x(a*a))+x(r*r))<x(14210854715202004e-30))?x(-1):o,r=t?x(-1):r,a=t?x(-1):a,o=x(x(1)/x(T(x(x(r*r)+x(x(o*o)+x(a*a)))))),A[e>>2]=A[e>>2]+x(_*x(s*o)),A[e+4>>2]=A[e+4>>2]+x(_*x(a*o)),A[e+8>>2]=A[e+8>>2]+x(_*x(r*o)))},function(e,t,n){e|=0,t|=0,n|=0,x(0);var i,o,a,r=x(0),s=x(0),l=0,_=(r=x(A[t+68>>2]*x(.5)),c[t+72>>2]),u=(l=(a=c[t+76>>2])<<2,A[n>>2]);s=x(u*u),u=A[n+4>>2],s=x(s+x(u*u)),u=A[n+8>>2];e:{if(A[l+n>>2]>x(A[t+60>>2]*x(T(x(s+x(u*u))))))c[(_<<2)+e>>2]=0,A[e+l>>2]=r,n=c[t+80>>2];else{if(u=A[(_<<2)+n>>2],l=n,n=c[t+80>>2],i=A[l+(n<<2)>>2],(o=x(T(x(x(u*u)+x(i*i)))))>x(1.1920928955078125e-7)){s=u,u=x(A[t+64>>2]/o),A[(_<<2)+e>>2]=s*u,A[(a<<2)+e>>2]=-r,r=x(i*u);break e}c[(_<<2)+e>>2]=0,A[(a<<2)+e>>2]=-r}r=x(0)}A[(n<<2)+e>>2]=r},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0,x(0);var o,a,r,s=0,l=0,_=x(0),u=x(0),h=0,f=N-16|0;if(1<=(0|i))for(;;){_=x(A[e+68>>2]*x(.5)),s=c[e+72>>2],l=c[e+76>>2]<<2,o=A[t>>2],u=x(o*o),o=A[t+4>>2],u=x(u+x(o*o)),o=A[t+8>>2];e:{if(A[l+t>>2]>x(A[e+60>>2]*x(T(x(u+x(o*o))))))c[(s<<2)+f>>2]=0,A[f+l>>2]=_,s=c[e+80>>2];else{if(o=A[(h=s<<2)+t>>2],s=c[e+80>>2],a=A[(s<<2)+t>>2],(r=x(T(x(x(o*o)+x(a*a)))))>x(1.1920928955078125e-7)){u=o,o=x(A[e+64>>2]/r),A[f+h>>2]=u*o,A[f+l>>2]=-_,_=x(a*o);break e}c[f+h>>2]=0,A[f+l>>2]=-_}_=x(0)}if(A[(s<<2)+f>>2]=_,l=c[4+f>>2],c[n>>2]=c[f>>2],c[n+4>>2]=l,h=c[4+(s=8+f|0)>>2],c[(l=n+8|0)>>2]=c[s>>2],c[l+4>>2]=h,t=t+16|0,n=n+16|0,!(i=i-1|0))break}},Se,nt,function(e,t,n,i){i|=0,c[8+(n|=0)>>2]=-581039253,c[n+12>>2]=0,c[n>>2]=-581039253,c[n+4>>2]=-581039253,c[i+8>>2]=1566444395,c[i+12>>2]=0,c[i>>2]=1566444395,c[i+4>>2]=1566444395},function(e,t){var n=c[4+(t|=0)>>2];c[76+(e|=0)>>2]=c[t>>2],c[e+80>>2]=n,n=c[4+(t=t+8|0)>>2],c[(e=e+84|0)>>2]=c[t>>2],c[e+4>>2]=n},function(e){return 76+(e|=0)|0},rt,function(){return 9111},function(e,t){e|=0,t=x(t),A[e+20>>2]=t},function(e){return x(A[20+(e|=0)>>2])},et,function(e,t,n){e|=0,t|=0,n|=0,x(0);var i=0|pi[c[c[n>>2]+40>>2]](n,e),o=0|pi[c[c[n>>2]+28>>2]](n,i);return(c[t>>2]=o)&&pi[c[c[n>>2]+48>>2]](n,i),n=c[e+4>>2],c[t+8>>2]=0,A[t+12>>2]=A[e+76>>2],A[t+16>>2]=A[e+80>>2],A[t+20>>2]=A[e+84>>2],A[t+24>>2]=A[e+88>>2],A[t+28>>2]=A[e+56>>2],A[t+32>>2]=A[e+60>>2],A[t+36>>2]=A[e- -64>>2],A[t+40>>2]=A[e+68>>2],c[t+4>>2]=n,e=A[e+72>>2],c[t+48>>2]=0,A[t+44>>2]=e,9088},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,a,r,s,l,_,u,h,f,p,d=x(0),m=x(0),v=x(0),g=x(0),b=x(0),S=x(0),C=x(0),E=x(0),P=x(0);N=p=N-48|0,g=A[i>>2],v=A[n>>2],o=x(x(g-v)*x(.5)),a=x(o*o),m=A[i+4>>2],d=A[n+4>>2],o=x(x(m-d)*x(.5)),s=x(a+x(o*o)),a=A[i+8>>2],r=A[n+8>>2],o=x(x(a-r)*x(.5)),o=x(T(x(s+x(o*o)))),a=x(x(a+r)*x(.5)),r=x(x(m+d)*x(.5)),l=x(x(g+v)*x(.5)),g=A[e- -64>>2],x(y(g))>x(.7071067690849304)?(v=A[e+60>>2],m=x(x(g*g)+x(v*v)),d=x(x(1)/x(T(m))),S=x(m*d),b=x(v*d),m=A[e+56>>2],C=x(b*x(-m)),d=x(d*x(-g)),E=x(m*d)):(m=A[e+56>>2],v=A[e+60>>2],S=x(x(m*m)+x(v*v)),d=x(x(1)/x(T(S))),E=x(S*d),P=x(d*x(-v)),C=x(g*P),d=x(m*d),S=x(d*x(-g))),f=A[e+72>>2],c[(e=44+p|0)>>2]=0,i=40+p|(c[(n=28+p|0)>>2]=0),a=x(x(x(g*(s=a))+x(x(l*m)+x(r*v)))-f),f=x(s-x(g*a)),b=x(o*b),s=x(f-b),g=x(o*E),E=x(s-g),A[i>>2]=E,_=36+p|0,r=x(r-x(v*a)),d=x(o*d),u=x(r-d),v=x(o*C),C=x(u-v),A[_>>2]=C,h=24+p|0,b=x(b+f),A[h>>2]=b-g,f=20+p|0,d=x(d+r),A[f>>2]=d-v,c[12+p>>2]=0,m=x(l-x(m*a)),a=x(o*P),r=x(m-a),o=x(o*S),l=x(r-o),A[32+p>>2]=l,m=x(a+m),A[16+p>>2]=m-o,a=x(g+b),A[8+p>>2]=a,d=x(v+d),A[4+p>>2]=d,m=x(o+m),A[p>>2]=m,pi[c[c[t>>2]+8>>2]](t,p,0,0),c[e>>2]=0,A[i>>2]=a,A[_>>2]=d,c[n>>2]=0,A[h>>2]=g+s,A[f>>2]=v+u,A[32+p>>2]=m,A[16+p>>2]=o+r,c[12+p>>2]=0,A[8+p>>2]=E,A[4+p>>2]=C,A[p>>2]=l,pi[c[c[t>>2]+8>>2]](t,p,0,1),N=48+p|0},pt,function(e){var t=0;c[(e|=0)>>2]=9180,(t=c[e+72>>2])&&(st(t),(t=c[e+72>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),(t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+32>>2]=0,a[e+36|0]=1,c[(t=e+24|0)>>2]=0,c[t+4>>2]=0,c[5499]=c[5499]+1,z(c[e-4>>2])},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o=x(0),a=x(0),r=x(0),s=x(0),l=x(0),_=x(0),u=x(0),h=x(0),f=(o=c[e+24>>2]?(r=A[e- -64>>2],o=A[e+48>>2],s=x(x(r+o)*x(.5)),a=A[e+60>>2],_=A[e+44>>2],l=x(x(a+_)*x(.5)),u=x(x(r-o)*x(.5)),h=x(x(a-_)*x(.5)),o=A[e+56>>2],a=A[e+40>>2],r=x(x(o+a)*x(.5)),x(x(o-a)*x(.5))):x(0),x(pi[c[c[e>>2]+48>>2]](e))),p=x(pi[c[c[e>>2]+48>>2]](e)),d=x(pi[c[c[e>>2]+48>>2]](e)),m=A[t+52>>2],v=(a=A[t+20>>2],_=A[t+24>>2],A[t+56>>2]),g=A[t+36>>2],b=A[t+40>>2],S=A[t+48>>2],C=A[t+8>>2],E=A[t>>2],T=A[t+4>>2];e=A[t+16>>2],t=A[t+32>>2],c[n+12>>2]=0,v=x(v+x(x(x(r*t)+x(l*g))+x(s*b))),o=x(o+f),f=x(o*x(y(t))),t=x(h+p),f=x(f+x(t*x(y(g)))),g=x(u+d),b=x(f+x(g*x(y(b)))),A[n+8>>2]=v-b,u=x(m+x(x(x(r*e)+x(l*a))+x(s*_))),a=x(x(x(o*x(y(e)))+x(t*x(y(a))))+x(g*x(y(_)))),A[n+4>>2]=u-a,s=x(S+x(x(x(r*E)+x(l*T))+x(s*C))),l=x(x(x(o*x(y(E)))+x(t*x(y(T))))+x(g*x(y(C)))),A[n>>2]=s-l,c[i+12>>2]=0,A[i+8>>2]=b+v,A[i+4>>2]=a+u,A[i>>2]=l+s},function(e,t){t|=0;var n,i,o,a,r,s,l,_,u,h,f,p=0,d=0,m=0,v=0;if(N=f=N-144|0,1<=c[24+(e|=0)>>2])for(s=96+f|0,l=f+64|0,_=48+f|0,u=32+f|0;;){if(p=(m=g(v,80))+c[e+32>>2]|0,a=c[4+(d=p+8|0)>>2],c[(n=24+f|0)>>2]=c[d>>2],c[4+n>>2]=a,o=c[p+4>>2],c[16+f>>2]=c[p>>2],c[20+f>>2]=o,i=c[4+(a=p+24|0)>>2],c[(d=o=8+u|0)>>2]=c[a>>2],c[d+4>>2]=i,d=c[p+20>>2],c[u>>2]=c[p+16>>2],c[4+u>>2]=d,r=c[4+(i=p+40|0)>>2],c[(d=8+_|0)>>2]=c[i>>2],c[d+4>>2]=r,a=c[p+36>>2],c[_>>2]=c[p+32>>2],c[4+_>>2]=a,h=c[4+(r=p+56|0)>>2],c[(i=a=8+l|0)>>2]=c[r>>2],c[4+i>>2]=h,i=c[p+52>>2],c[l>>2]=c[p+48>>2],c[4+l>>2]=i,p=c[p+64>>2],p=0|pi[c[c[p>>2]+28>>2]](p),r=c[4+(h=p+8|0)>>2],c[(i=8+f|0)>>2]=c[h>>2],c[4+i>>2]=r,r=c[p+4>>2],p=c[p>>2],A[i>>2]=x(A[i>>2]*A[t+8>>2])/A[e+92>>2],c[f>>2]=p,c[4+f>>2]=r,c[12+f>>2]=0,A[f>>2]=x(A[f>>2]*A[t>>2])/A[e+84>>2],A[4+f>>2]=x(A[4+f>>2]*A[t+4>>2])/A[e+88>>2],p=c[64+(m+c[e+32>>2]|0)>>2],pi[c[c[p>>2]+24>>2]](p,f),c[76+f>>2]=0,A[72+f>>2]=x(A[72+f>>2]*A[t+8>>2])/A[e+92>>2],A[68+f>>2]=x(A[68+f>>2]*A[t+4>>2])/A[e+88>>2],A[64+f>>2]=x(A[64+f>>2]*A[t>>2])/A[e+84>>2],r=c[4+n>>2],p=m+c[e+32>>2]|0,c[(i=p+8|0)>>2]=c[n>>2],c[4+i>>2]=r,n=c[20+f>>2],c[p>>2]=c[16+f>>2],c[p+4>>2]=n,i=c[4+o>>2],c[(n=p+24|0)>>2]=c[o>>2],c[4+n>>2]=i,n=c[4+u>>2],c[p+16>>2]=c[u>>2],c[p+20>>2]=n,o=c[d+4>>2],c[(n=p+40|0)>>2]=c[d>>2],c[4+n>>2]=o,n=c[4+_>>2],c[p+32>>2]=c[_>>2],c[p+36>>2]=n,n=c[4+l>>2],c[p+48>>2]=c[l>>2],c[p+52>>2]=n,n=c[4+a>>2],c[(p=p+56|0)>>2]=c[a>>2],c[p+4>>2]=n,c[e+72>>2]){p=c[64+(m+c[e+32>>2]|0)>>2],pi[c[c[p>>2]+8>>2]](p,16+f|0,128+f|0,112+f|0),o=c[4+(n=136+f|0)>>2],c[(p=a=88+f|0)>>2]=c[n>>2],c[p+4>>2]=o,p=c[116+f>>2],c[s>>2]=c[112+f>>2],c[4+s>>2]=p,o=c[4+(n=120+f|0)>>2],c[(p=8+s|0)>>2]=c[n>>2],c[p+4>>2]=o,p=c[132+f>>2],c[80+f>>2]=c[128+f>>2],c[84+f>>2]=p;e:if(p=ut(o=c[e+72>>2],n=c[76+(m+c[e+32>>2]|0)>>2]))if(0<=(0|(d=c[o+8>>2]))){if(d)for(;;){if(!(m=c[p+32>>2]))break e;if(p=m,!(d=d-1|0))break}}else p=c[o>>2];else p=0;m=c[84+f>>2],c[n>>2]=c[80+f>>2],c[n+4>>2]=m,i=c[4+(d=104+f|0)>>2],c[(m=n+24|0)>>2]=c[d>>2],c[m+4>>2]=i,d=c[4+s>>2],c[(m=n+16|0)>>2]=c[s>>2],c[m+4>>2]=d,d=c[4+a>>2],c[(m=n+8|0)>>2]=c[a>>2],c[m+4>>2]=d,ht(o,p,n)}if(!((0|(v=v+1|0))<c[e+24>>2]))break}p=c[t+4>>2],c[e+84>>2]=c[t>>2],c[e+88>>2]=p,m=c[4+(t=t+8|0)>>2],c[(p=e+92|0)>>2]=c[t>>2],c[p+4>>2]=m,pi[c[c[e>>2]+68>>2]](e),N=144+f|0},function(e){return 84+(e|=0)|0},function(e,t,n){e|=0,t=x(t),n|=0;var i,o,a;c[(o=44+(N=a=N-96|0)|0)>>2]=0,c[4+o>>2]=0,c[(o=56+a|0)>>2]=0,c[4+o>>2]=0,c[52+a>>2]=1065353216,c[(o=a+64|0)>>2]=0,c[4+o>>2]=0,c[(o=76+a|0)>>2]=0,c[4+o>>2]=0,c[72+a>>2]=1065353216,c[(o=84+a|0)>>2]=0,c[4+o>>2]=0,c[92+a>>2]=0,c[36+a>>2]=0,c[40+a>>2]=0,c[32+a>>2]=1065353216,pi[c[c[e>>2]+8>>2]](e,32+a|0,16+a|0,a),t=x(t/x(12)),i=x(x(A[a>>2]-A[16+a>>2])*x(.5)),i=x(i+i),i=x(i*i),o=x(x(A[4+a>>2]-A[20+a>>2])*x(.5)),o=x(o+o),o=x(o*o),A[n+8>>2]=t*x(i+o),e=i,i=x(x(A[8+a>>2]-A[24+a>>2])*x(.5)),i=x(i+i),i=x(i*i),A[n+4>>2]=t*x(e+i),A[n>>2]=t*x(o+i),N=96+a|0},function(){return 12148},function(e,t){e|=0,t=x(t),A[e+80>>2]=t},function(e){return x(A[80+(e|=0)>>2])},function(){return 24},function(e,t,n){t|=0;var i,o,a,r,s,l,_=0,u=0,h=0,f=0,p=0;if(_=0|pi[c[c[(n|=0)>>2]+40>>2]](n,e|=0),u=0|pi[c[c[n>>2]+28>>2]](n,_),(c[t>>2]=u)&&pi[c[c[n>>2]+48>>2]](n,_),_=c[e+4>>2],c[t+8>>2]=0,c[t+12>>2]=0,c[t+4>>2]=_,A[t+20>>2]=A[e+80>>2],_=c[e+24>>2],c[t+16>>2]=_){if(i=0|pi[c[c[n>>2]+16>>2]](n,76,_),_=c[8+i>>2],o=t,a=0|pi[c[c[n>>2]+28>>2]](n,_),c[o+12>>2]=a,0<c[t+16>>2])for(_=_+36|0,f=c[e+32>>2],h=36;A[_+36>>2]=A[36+(u=h+f|0)>>2],o=_+28|0,a=0|pi[c[c[n>>2]+28>>2]](n,c[u+28>>2]),c[o>>2]=a,0|pi[c[c[n>>2]+24>>2]](n,c[28+(c[e+32>>2]+h|0)>>2])||(u=c[28+(c[e+32>>2]+h|0)>>2],a=n,r=0|pi[c[c[u>>2]+52>>2]](u),o=c[c[n>>2]+16>>2],u=0|pi[o](0|a,0|r,1),f=c[28+(c[e+32>>2]+h|0)>>2],a=0|pi[c[c[f>>2]+56>>2]](f,c[(r=u)+8>>2],s=n),l=c[28+(c[e+32>>2]+h|0)>>2],o=c[c[n>>2]+20>>2],pi[o](0|s,0|r,0|a,1346455635,0|l)),f=c[e+32>>2],A[_-36>>2]=A[(u=f+h|0)-36>>2],A[_-32>>2]=A[u-32>>2],A[_-28>>2]=A[u-28>>2],A[_-24>>2]=A[u-24>>2],A[_-20>>2]=A[u-20>>2],A[_-16>>2]=A[u-16>>2],A[_-12>>2]=A[u-12>>2],A[_-8>>2]=A[u-8>>2],A[_-4>>2]=A[u-4>>2],A[_>>2]=A[u>>2],A[_+4>>2]=A[u+4>>2],A[_+8>>2]=A[u+8>>2],A[_+12>>2]=A[u+12>>2],A[_+16>>2]=A[u+16>>2],A[_+20>>2]=A[u+20>>2],c[_+32>>2]=c[u+32>>2],A[_+24>>2]=A[u+24>>2],h=h+80|0,_=_+76|0,(0|(p=p+1|0))<c[t+16>>2];);pi[c[c[n>>2]+20>>2]](n,i,9264,1497453121,c[8+i>>2])}return 9289},function(e,t){t|=0;var n=0,i=0;if(c[76+(e|=0)>>2]=c[e+76>>2]+1,1<=(0|(n=c[e+24>>2])))for(i=n+1|0,n=g(n,80)-16|0;c[c[e+32>>2]+n>>2]==(0|t)&&dt(e,i-2|0),n=n-80|0,1<(0|(i=i-1|0)););pi[c[c[e>>2]+68>>2]](e)},function(e){e|=0;var t,n,i,o=x(0),a=0,r=0;if(N=i=N-32|0,c[e+56>>2]=-581039253,c[e+60>>2]=-581039253,c[e+40>>2]=1566444395,c[e+44>>2]=1566444395,c[(t=e- -64|0)>>2]=-581039253,c[4+t>>2]=0,c[(t=e+48|0)>>2]=1566444395,c[4+t>>2]=0,1<=c[e+24>>2])for(;t=c[e+32>>2]+a|0,n=c[t+64>>2],pi[c[c[n>>2]+8>>2]](n,t,16+i|0,i),(o=A[16+i>>2])<A[e+40>>2]&&(A[e+40>>2]=o),(o=A[i>>2])>A[e+56>>2]&&(A[e+56>>2]=o),(o=A[20+i>>2])<A[e+44>>2]&&(A[e+44>>2]=o),(o=A[4+i>>2])>A[e+60>>2]&&(A[e+60>>2]=o),(o=A[24+i>>2])<A[e+48>>2]&&(A[e+48>>2]=o),(o=A[8+i>>2])>A[e+64>>2]&&(A[e+64>>2]=o),a=a+80|0,(0|(r=r+1|0))<c[e+24>>2];);N=32+i|0},function(e){var t=0;return c[(e|=0)>>2]=9592,(t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+32>>2]=0,a[e+36|0]=1,c[(t=e+24|0)>>2]=0,(c[t+4>>2]=0)|e},function(e){var t=0;c[(e|=0)>>2]=9592,(t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+32>>2]=0,a[e+36|0]=1,c[(t=e+24|0)>>2]=0,c[t+4>>2]=0,c[5499]=c[5499]+1,z(c[e-4>>2])},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,a,r,s,l,_,u,h=0,f=0,m=0,y=0,b=x(0),S=x(0),C=x(0),E=0;if(N=n=N-80|0,1<=(0|(s=0|pi[c[c[e>>2]+28>>2]](e))))for(o=A[e+12>>2],a=A[e+8>>2],r=A[e+4>>2];;){pi[c[c[e>>2]+16>>2]](e,n+76|0,n+52|0,n- -64|0,n+56|0,n+72|0,n+68|0,n+48|0,n+60|0,E);e:{t:switch(c[n+64>>2]){case 0:n:switch(c[n+60>>2]-2|0){case 3:if(c[n+48>>2]<1)break e;for(i=0;y=c[n+76>>2],m=c[n+56>>2],f=c[n+72>>2]+g(c[n+68>>2],i)|0,h=y+g(m,p[0|f])|0,b=A[h>>2],S=A[h+4>>2],C=A[h+8>>2],c[n+12>>2]=0,A[n+8>>2]=o*C,A[n+4>>2]=a*S,A[n>>2]=r*b,h=y+g(m,p[f+1|0])|0,b=A[h>>2],S=A[h+4>>2],C=A[h+8>>2],c[n+28>>2]=0,A[n+24>>2]=o*C,A[n+20>>2]=a*S,A[n+16>>2]=r*b,f=y+g(m,p[f+2|0])|0,b=A[f>>2],S=A[f+4>>2],C=A[f+8>>2],c[n+44>>2]=0,A[n+40>>2]=o*C,A[n+36>>2]=a*S,A[n+32>>2]=r*b,pi[c[c[t>>2]+8>>2]](t,n,E,i),(0|(i=i+1|0))<c[n+48>>2];);break e;case 1:if(c[n+48>>2]<1)break e;for(i=0;y=c[n+76>>2],m=c[n+56>>2],f=c[n+72>>2]+g(c[n+68>>2],i)|0,h=y+g(m,d[f>>1])|0,b=A[h>>2],S=A[h+4>>2],C=A[h+8>>2],c[n+12>>2]=0,A[n+8>>2]=o*C,A[n+4>>2]=a*S,A[n>>2]=r*b,h=y+g(m,d[f+2>>1])|0,b=A[h>>2],S=A[h+4>>2],C=A[h+8>>2],c[n+28>>2]=0,A[n+24>>2]=o*C,A[n+20>>2]=a*S,A[n+16>>2]=r*b,f=y+g(m,d[f+4>>1])|0,b=A[f+8>>2],S=A[f+4>>2],C=A[f>>2],c[n+44>>2]=0,A[n+32>>2]=r*C,A[n+36>>2]=a*S,A[n+40>>2]=o*b,pi[c[c[t>>2]+8>>2]](t,n,E,i),(0|(i=i+1|0))<c[n+48>>2];);break e;case 0:break n;default:break e}if(c[n+48>>2]<1)break e;for(i=0;y=c[n+76>>2],m=c[n+56>>2],f=c[n+72>>2]+g(c[n+68>>2],i)|0,h=y+g(m,c[f>>2])|0,b=A[h>>2],S=A[h+4>>2],C=A[h+8>>2],c[n+12>>2]=0,A[n+8>>2]=o*C,A[n+4>>2]=a*S,A[n>>2]=r*b,h=y+g(m,c[f+4>>2])|0,b=A[h>>2],S=A[h+4>>2],C=A[h+8>>2],c[n+28>>2]=0,A[n+24>>2]=o*C,A[n+20>>2]=a*S,A[n+16>>2]=r*b,f=y+g(m,c[f+8>>2])|0,b=A[f+8>>2],S=A[f+4>>2],C=A[f>>2],c[n+44>>2]=0,A[n+32>>2]=r*C,A[n+36>>2]=a*S,A[n+40>>2]=o*b,pi[c[c[t>>2]+8>>2]](t,n,E,i),(0|(i=i+1|0))<c[n+48>>2];);break e;case 1:break t;default:break e}t:switch(c[n+60>>2]-2|0){case 3:if(c[n+48>>2]<1)break e;for(i=0;f=c[n+72>>2]+g(c[n+68>>2],i)|0,m=p[0|f],c[n+12>>2]=0,y=c[n+76>>2],h=m,m=c[n+56>>2],h=y+g(h,m)|0,A[n+8>>2]=o*x(v[h+16>>3]),A[n+4>>2]=a*x(v[h+8>>3]),A[n>>2]=r*x(v[h>>3]),h=p[f+1|0],c[n+28>>2]=0,h=y+g(h,m)|0,A[n+24>>2]=o*x(v[h+16>>3]),A[n+20>>2]=a*x(v[h+8>>3]),A[n+16>>2]=r*x(v[h>>3]),f=y+g(m,p[f+2|0])|0,l=v[f>>3],_=v[f+8>>3],u=v[f+16>>3],c[n+44>>2]=0,A[n+40>>2]=o*x(u),A[n+36>>2]=a*x(_),A[n+32>>2]=r*x(l),pi[c[c[t>>2]+8>>2]](t,n,E,i),(0|(i=i+1|0))<c[n+48>>2];);break e;case 1:if(c[n+48>>2]<1)break e;for(i=0;c[n+12>>2]=0,c[n+28>>2]=0,y=c[n+76>>2],m=c[n+56>>2],f=c[n+72>>2]+g(c[n+68>>2],i)|0,h=y+g(m,d[f>>1])|0,A[n+8>>2]=o*x(v[h+16>>3]),A[n+4>>2]=a*x(v[h+8>>3]),A[n>>2]=r*x(v[h>>3]),h=y+g(m,d[f+2>>1])|0,A[n+24>>2]=o*x(v[h+16>>3]),A[n+20>>2]=a*x(v[h+8>>3]),A[n+16>>2]=r*x(v[h>>3]),c[n+44>>2]=0,f=y+g(m,d[f+4>>1])|0,A[n+32>>2]=r*x(v[f>>3]),A[n+36>>2]=a*x(v[f+8>>3]),A[n+40>>2]=o*x(v[f+16>>3]),pi[c[c[t>>2]+8>>2]](t,n,E,i),(0|(i=i+1|0))<c[n+48>>2];);break e;case 0:break t;default:break e}if(!(c[n+48>>2]<1))for(i=0;c[n+12>>2]=0,c[n+28>>2]=0,y=c[n+76>>2],m=c[n+56>>2],f=c[n+72>>2]+g(c[n+68>>2],i)|0,h=y+g(m,c[f>>2])|0,A[n+8>>2]=o*x(v[h+16>>3]),A[n+4>>2]=a*x(v[h+8>>3]),A[n>>2]=r*x(v[h>>3]),h=y+g(m,c[f+4>>2])|0,A[n+24>>2]=o*x(v[h+16>>3]),A[n+20>>2]=a*x(v[h+8>>3]),A[n+16>>2]=r*x(v[h>>3]),c[n+44>>2]=0,f=y+g(m,c[f+8>>2])|0,A[n+32>>2]=r*x(v[f>>3]),A[n+36>>2]=a*x(v[f+8>>3]),A[n+40>>2]=o*x(v[f+16>>3]),pi[c[c[t>>2]+8>>2]](t,n,E,i),(0|(i=i+1|0))<c[n+48>>2];);}if(pi[c[c[e>>2]+24>>2]](e,E),(0|s)==(0|(E=E+1|0)))break}N=n+80|0},mt,mt,At,At,gt,At,At,function(e){return 1==c[48+(e|=0)>>2]|0},function(e,t,n){n|=0;var i,o=c[4+(t|=0)>>2];c[52+(e|=0)>>2]=c[t>>2],c[e+56>>2]=o,i=c[4+(t=t+8|0)>>2],c[(o=e+60|0)>>2]=c[t>>2],c[4+o>>2]=i,t=c[n+4>>2],c[e+68>>2]=c[n>>2],c[e+72>>2]=t,o=c[4+(n=n+8|0)>>2],c[(t=e+76|0)>>2]=c[n>>2],c[t+4>>2]=o,c[e+48>>2]=1},function(e,t,n){n|=0;var i,o=c[56+(e|=0)>>2];c[(t|=0)>>2]=c[e+52>>2],c[t+4>>2]=o,i=c[4+(o=e+60|0)>>2],c[(t=t+8|0)>>2]=c[o>>2],c[t+4>>2]=i,i=c[4+(o=e+76|0)>>2],c[(t=n+8|0)>>2]=c[o>>2],c[t+4>>2]=i,t=c[e+72>>2],c[n>>2]=c[e+68>>2],c[n+4>>2]=t},function(){return 28},function(e,t,n){t|=0,n|=0;var i,o,r,l=0,_=0,u=0,h=0,f=0,m=0,x=0,y=0,b=0;if(N=r=N-32|0,l=0|pi[c[c[(e|=0)>>2]+28>>2]](e),c[t>>2]=0,c[t+20>>2]=l){if(i=0|pi[c[c[n>>2]+16>>2]](n,32,l),f=c[8+i>>2],y=t,b=0|pi[c[c[n>>2]+28>>2]](n,f),c[y>>2]=b,0<(0|(o=0|pi[c[c[e>>2]+28>>2]](e))))for(;;){pi[c[c[e>>2]+16>>2]](e,28+r|0,4+r|0,16+r|0,8+r|0,24+r|0,20+r|0,r,12+r|0,x),c[f>>2]=0,c[f+4>>2]=0,c[(l=f+8|0)>>2]=0,c[l+4>>2]=0,c[(l=f+16|0)>>2]=0,c[l+4>>2]=0,l=c[r>>2],c[f+24>>2]=l,c[f+28>>2]=c[4+r>>2];e:{t:switch(c[12+r>>2]-2|0){case 0:if(!l)break e;if(u=0|pi[c[c[n>>2]+16>>2]](n,4,g(l,3)),l=c[u+8>>2],y=f,b=0|pi[c[c[n>>2]+28>>2]](n,l),c[y+8>>2]=b,1<=c[r>>2])for(_=0,m=c[24+r>>2];h=m+g(c[20+r>>2],_)|0,c[l>>2]=c[h>>2],c[l+4>>2]=c[h+4>>2],c[l+8>>2]=c[h+8>>2],l=l+12|0,(0|(_=_+1|0))<c[r>>2];);pi[c[c[n>>2]+20>>2]](n,u,9400,1497453121,c[u+8>>2]);break e;case 1:if(!l)break e;if(u=0|pi[c[c[n>>2]+16>>2]](n,8,l),l=c[u+8>>2],y=f,b=0|pi[c[c[n>>2]+28>>2]](n,l),c[y+12>>2]=b,1<=c[r>>2])for(_=0;h=c[24+r>>2]+g(c[20+r>>2],_)|0,s[l>>1]=d[h>>1],s[l+2>>1]=d[h+2>>1],h=d[h+4>>1],s[l+6>>1]=0,s[l+4>>1]=h,l=l+8|0,(0|(_=_+1|0))<c[r>>2];);pi[c[c[n>>2]+20>>2]](n,u,9415,1497453121,c[u+8>>2]);break e;case 3:break t;default:break e}if(l){if(u=0|pi[c[c[n>>2]+16>>2]](n,4,l),l=c[u+8>>2],y=f,b=0|pi[c[c[n>>2]+28>>2]](n,l),c[y+16>>2]=b,1<=c[r>>2])for(_=0;h=c[24+r>>2]+g(c[20+r>>2],_)|0,a[0|l]=p[0|h],a[l+1|0]=p[h+1|0],a[l+2|0]=p[h+2|0],l=l+4|(a[l+3|0]=0),(0|(_=_+1|0))<c[r>>2];);pi[c[c[n>>2]+20>>2]](n,u,9442,1497453121,c[u+8>>2])}}e:{t:switch(c[16+r>>2]){case 0:if(!(l=c[4+r>>2]))break e;if(h=0|pi[c[c[n>>2]+16>>2]](n,16,l),l=c[h+8>>2],y=f,b=0|pi[c[c[n>>2]+28>>2]](n,l),c[y>>2]=b,1<=(0|(u=c[4+r>>2])))for(m=c[8+r>>2],_=c[28+r>>2];A[l>>2]=A[_>>2],A[l+4>>2]=A[_+4>>2],A[l+8>>2]=A[_+8>>2],_=_+m|0,l=l+16|0,u=u-1|0;);pi[c[c[n>>2]+20>>2]](n,h,9465,1497453121,c[h+8>>2]);break e;case 1:break t;default:break e}if(l=c[4+r>>2]){if(h=0|pi[c[c[n>>2]+16>>2]](n,32,l),l=c[h+8>>2],y=f,b=0|pi[c[c[n>>2]+28>>2]](n,l),c[y+4>>2]=b,1<=(0|(u=c[4+r>>2])))for(m=c[8+r>>2],_=c[28+r>>2];v[l>>3]=v[_>>3],v[l+8>>3]=v[_+8>>3],v[l+16>>3]=v[_+16>>3],_=_+m|0,l=l+32|0,u=u-1|0;);pi[c[c[n>>2]+20>>2]](n,h,9484,1497453121,c[h+8>>2])}}if(pi[c[c[e>>2]+24>>2]](e,x),f=f+32|0,(0|o)==(0|(x=x+1|0)))break}pi[c[c[n>>2]+20>>2]](n,i,9504,1497453121,c[8+i>>2])}return c[t+24>>2]=0,A[t+4>>2]=A[e+4>>2],A[t+8>>2]=A[e+8>>2],A[t+12>>2]=A[e+12>>2],A[t+16>>2]=A[e+16>>2],N=32+r|0,9519},vt,function(e){e=vt(e|=0),c[5499]=c[5499]+1,z(c[e-4>>2])},function(e,t){t|=0;var n,i=0,o=0,r=0,s=0,l=0;e:{if(p[165+(e|=0)|0]){if(c[e+92>>2]>=(0|t))break e;if(t&&(c[5498]=c[5498]+1,(i=M(19+(t<<4)|0))&&(c[(r=i+19&-16)-4>>2]=i)),1<=(0|(s=c[e+88>>2])))for(;o=c[e+96>>2]+l|0,i=c[o+4>>2],c[(n=l+r|0)>>2]=c[o>>2],c[4+n>>2]=i,i=c[4+(o=o+8|0)>>2],c[(n=8+n|0)>>2]=c[o>>2],c[4+n>>2]=i,l=l+16|0,s=s-1|0;);return(i=c[e+96>>2])&&p[e+100|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+96>>2]=r,c[e+92>>2]=t,void(a[e+100|0]=1)}if(!(c[e+112>>2]>=(0|t))){t&&(c[5498]=c[5498]+1,(o=M(19+(t<<2)|0))&&(c[(i=o+19&-16)-4>>2]=o)),o=c[e+116>>2];t:{if(1<=(0|(r=c[e+108>>2])))for(l=i,s=o;A[l>>2]=A[s>>2],l=l+4|0,s=s+4|0,r=r-1|0;);else if(!o)break t;p[e+120|0]&&(c[5499]=c[5499]+1,z(c[o-4>>2]))}c[e+116>>2]=i,c[e+112>>2]=t,a[e+120|0]=1}}},function(e,t){t|=0;var n=0,i=0,o=0,r=0,l=0;e:{if(p[164+(e|=0)|0]){if(c[e+132>>2]>=(0|t))break e;t&&(c[5498]=c[5498]+1,(n=M(19+(t<<2)|0))&&(c[(o=n+19&-16)-4>>2]=n)),r=c[e+136>>2];t:{if(1<=(0|(i=c[e+128>>2])))for(l=o,n=r;c[l>>2]=c[n>>2],l=l+4|0,n=n+4|0,i=i-1|0;);else if(!r)break t;p[e+140|0]&&(c[5499]=c[5499]+1,z(c[r-4>>2]))}return c[e+136>>2]=o,c[e+132>>2]=t,void(a[e+140|0]=1)}if(!(c[e+152>>2]>=(0|t))){t&&(c[5498]=c[5498]+1,(n=M(19+(t<<1)|0))&&(c[(o=n+19&-16)-4>>2]=n)),r=c[e+156>>2];t:{if(1<=(0|(i=c[e+148>>2])))for(l=o,n=r;s[l>>1]=d[n>>1],l=l+2|0,n=n+2|0,i=i-1|0;);else if(!r)break t;p[e+160|0]&&(c[5499]=c[5499]+1,z(c[r-4>>2]))}c[e+156>>2]=o,c[e+152>>2]=t,a[e+160|0]=1}}},Se,nt,function(e,t,n,i){e|=0,t|=0,n|=0,i|=0,x(0);var o=0,a=0,r=0,s=0,l=A[(o=e+32|0)>>2],_=A[(a=e+48|0)>>2],u=A[(r=e+28|0)>>2],h=A[(s=e+44|0)>>2],f=A[e+24>>2],p=A[e+40>>2],d=x(pi[c[c[e>>2]+48>>2]](e)),m=x(pi[c[c[e>>2]+48>>2]](e)),v=x(pi[c[c[e>>2]+48>>2]](e)),g=A[t+52>>2],b=A[t+24>>2],S=A[t+20>>2],C=A[t+56>>2],E=A[r>>2],T=A[s>>2],P=A[o>>2],w=A[a>>2],I=A[t+40>>2],R=A[t+36>>2],D=A[t+48>>2],N=A[t+8>>2],O=A[t>>2];r=A[t+4>>2],s=A[t+16>>2],o=A[e+24>>2],a=A[e+40>>2],e=A[t+32>>2],c[n+12>>2]=0,t=C,C=x(x(a+o)*x(.5)),E=x(x(T+E)*x(.5)),T=x(x(w+P)*x(.5)),P=x(t+x(x(x(e*C)+x(R*E))+x(I*T))),f=x(d+x(x(p-f)*x(.5))),t=x(f*x(y(e))),e=x(m+x(x(h-u)*x(.5))),t=x(t+x(e*x(y(R)))),R=x(v+x(x(_-l)*x(.5))),I=x(t+x(R*x(y(I)))),A[n+8>>2]=P-I,l=x(g+x(x(x(C*s)+x(E*S))+x(T*b))),b=x(x(x(f*x(y(s)))+x(e*x(y(S))))+x(R*x(y(b)))),A[n+4>>2]=l-b,S=x(D+x(x(x(C*O)+x(E*r))+x(T*N))),R=x(x(x(f*x(y(O)))+x(e*x(y(r))))+x(R*x(y(N)))),A[n>>2]=S-R,c[i+12>>2]=0,A[i+8>>2]=I+P,A[i+4>>2]=b+l,A[i>>2]=R+S},bt,function(e){return c[56+(e|=0)>>2]+4|0},rt,function(){return 10082},Ie,function(e,t,n){t|=0;var i=0|pi[c[c[(n|=0)>>2]+40>>2]](n,e|=0),o=0|pi[c[c[n>>2]+28>>2]](n,i);return(c[t>>2]=o)&&pi[c[c[n>>2]+48>>2]](n,i),e=c[e+4>>2],c[t+8>>2]=0,c[t+4>>2]=e,7747},function(e,t,n,i){e|=0,t|=0,i|=0;var o,a,r,s;N=s=N-48|0,r=c[4+(a=8+(n|=0)|0)>>2],c[(o=24+s|0)>>2]=c[a>>2],c[4+o>>2]=r,r=c[4+(a=i+8|0)>>2],c[(o=40+s|0)>>2]=c[a>>2],c[4+o>>2]=r,c[8+s>>2]=9956,o=c[n+4>>2],c[16+s>>2]=c[n>>2],c[20+s>>2]=o,o=c[i+4>>2],c[32+s>>2]=c[i>>2],c[36+s>>2]=o,c[12+s>>2]=t,e=c[e+56>>2],pi[c[c[e>>2]+8>>2]](e,8+s|0,n,i),N=48+s|0},function(e,t,n){e|=0,t|=0,n|=0;var i,o,a,r,s,l,_;c[(l=o=52+(N=_=N-144|0)|0)>>2]=0,c[4+l>>2]=0,c[(l=_+64|0)>>2]=0,c[4+l>>2]=0,c[(l=72+_|0)>>2]=0,c[4+l>>2]=0,c[(l=84+_|0)>>2]=0,c[4+l>>2]=0,c[80+_>>2]=1065353216,c[(l=92+_|0)>>2]=0,c[4+l>>2]=0,c[(l=104+_|0)>>2]=0,c[4+l>>2]=0,c[100+_>>2]=1065353216,c[(l=112+_|0)>>2]=0,c[4+l>>2]=0,c[(l=120+_|0)>>2]=0,c[4+l>>2]=-581039253,c[140+_>>2]=0,i=A[n+8>>2],a=A[n>>2],r=x(a*x(0)),s=A[n+4>>2],l=x(s*x(0)),A[136+_>>2]=i+x(r+l),i=x(i*x(0)),A[132+_>>2]=x(s+r)+i,c[44+_>>2]=0,c[48+_>>2]=0,c[40+_>>2]=9900,c[60+_>>2]=1065353216,A[128+_>>2]=x(a+l)+i,c[32+_>>2]=1566444395,c[36+_>>2]=0,c[24+_>>2]=1566444395,c[28+_>>2]=1566444395,c[16+_>>2]=-581039253,c[20+_>>2]=0,c[8+_>>2]=-581039253,c[12+_>>2]=-581039253,pi[c[c[t>>2]+64>>2]](t,40+_|0,8+_|0,24+_|0),n=c[4+o>>2],c[(t=e+8|0)>>2]=c[o>>2],c[t+4>>2]=n,t=c[48+_>>2],c[e>>2]=c[44+_>>2],c[e+4>>2]=t,N=144+_|0},function(e,t,n){pi[c[c[(t|=0)>>2]+68>>2]](e|=0,t,n|=0)},Se,ve,function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,a,r,s=x(0),l=x(0),_=0,u=0;n=e+4|0,l=A[e+84>>2],o=A[e+88>>2],a=A[e+92>>2],r=A[e+96>>2],l<(s=x(x(x(o*A[t>>2])+x(a*A[t+4>>2]))+x(r*A[t+8>>2])))&&(A[e+84>>2]=s,i=c[t+4>>2],c[n>>2]=c[t>>2],c[n+4>>2]=i,u=c[4+(_=t+8|0)>>2],c[(i=n+8|0)>>2]=c[_>>2],c[i+4>>2]=u,l=s),l<(s=x(x(x(o*A[t+16>>2])+x(a*A[t+20>>2]))+x(r*A[t+24>>2])))?(A[e+84>>2]=s,_=c[4+(i=t+16|0)>>2],c[n>>2]=c[i>>2],c[n+4>>2]=_,u=c[4+(i=i+8|0)>>2],c[(_=n+8|0)>>2]=c[i>>2],c[_+4>>2]=u):s=l,s<(l=x(x(x(o*A[t+32>>2])+x(a*A[t+36>>2]))+x(r*A[t+40>>2])))&&(A[e+84>>2]=l,t=c[4+(e=t+32|0)>>2],c[n>>2]=c[e>>2],c[n+4>>2]=t,t=n+8|0,n=c[4+(e=e+8|0)>>2],c[t>>2]=c[e>>2],c[t+4>>2]=n)},Se,ve,function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o=0,a=x(0),r=x(0),s=x(0),l=x(0),_=0;a=A[t>>2],r=A[t+16>>2],s=A[t+32>>2],A[e+24>>2]<((l=a<r?a:r)<s?l:s)||A[(s<A[t+(o=!(r<a)<<4)>>2]?o:32)+t>>2]<A[e+8>>2]||(a=A[t+8>>2],r=A[(o=t+24|0)>>2],s=A[(_=t+40|0)>>2],A[e+32>>2]<((l=a<r?a:r)<s?l:s)||A[(s<A[(o=r<a?t+8|0:o)>>2]?o:_)>>2]<A[e+16>>2]||(a=A[t+4>>2],r=A[(o=t+20|0)>>2],s=A[(_=t+36|0)>>2],A[e+28>>2]<((l=a<r?a:r)<s?l:s)||A[(s<A[(o=r<a?t+4|0:o)>>2]?o:_)>>2]<A[e+12>>2]||(e=c[e+4>>2],pi[c[c[e>>2]+8>>2]](e,t,n,i))))},St,function(e){e=St(e|=0),c[5499]=c[5499]+1,z(c[e-4>>2])},Ct,Pt,function(e,t,n){n|=0;var i,o,a=0,r=0,l=0,_=0,u=0;if(A[16+(t|=0)>>2]=A[20+(e|=0)>>2],A[t+20>>2]=A[e+24>>2],A[t+24>>2]=A[e+28>>2],A[t+28>>2]=A[e+32>>2],A[t>>2]=A[e+4>>2],A[t+4>>2]=A[e+8>>2],A[t+8>>2]=A[e+12>>2],A[t+12>>2]=A[e+16>>2],A[t+32>>2]=A[e+36>>2],A[t+36>>2]=A[e+40>>2],A[t+40>>2]=A[e+44>>2],A[t+44>>2]=A[e+48>>2],c[t+48>>2]=c[e+56>>2],c[t+52>>2]=p[e+60|0],a=c[e+88>>2],c[t+56>>2]=a){if(a=0|pi[c[c[n>>2]+28>>2]](n,c[e+96>>2]),c[t+64>>2]=a){if(l=c[e+88>>2],u=0|pi[c[c[n>>2]+16>>2]](n,48,l),1<=(0|l))for(a=c[u+8>>2]+44|0,_=40;r=c[e+96>>2]+_|0,A[a-28>>2]=A[r-24>>2],A[a-24>>2]=A[r-20>>2],A[a-20>>2]=A[r-16>>2],A[a-16>>2]=A[r-12>>2],A[a-44>>2]=A[r-40>>2],A[a-40>>2]=A[r-36>>2],A[a-36>>2]=A[r-32>>2],A[a-32>>2]=A[r-28>>2],c[a-12>>2]=c[r-8>>2],c[a-8>>2]=c[r-4>>2],r=c[r>>2],c[a>>2]=0,c[a-4>>2]=r,_=_- -64|0,a=a+48|0,l=l-1|0;);pi[c[c[n>>2]+20>>2]](n,u,10164,1497453121,c[e+96>>2])}}else c[t+64>>2]=0;if(a=c[e+128>>2],c[t+60>>2]=a){if(a=0|pi[c[c[n>>2]+28>>2]](n,c[e+136>>2]),c[t+68>>2]=a){if(l=c[e+128>>2],i=(_=0)|pi[c[c[n>>2]+16>>2]](n,16,l),(0|l)<=0)u=c[e+136>>2];else for(u=c[e+136>>2],o=c[8+i>>2];s[6+(a=_+o|0)>>1]=d[6+(r=_+u|0)>>1],s[a+8>>1]=d[r+8>>1],s[a+10>>1]=d[r+10>>1],s[a>>1]=d[r>>1],s[a+2>>1]=d[r+2>>1],c[a+12>>2]=c[r+12>>2],s[a+4>>1]=d[r+4>>1],_=_+16|0,l=l-1|0;);pi[c[c[n>>2]+20>>2]](n,i,10187,1497453121,u)}}else c[t+68>>2]=0;if(c[t+76>>2]=c[e+144>>2],a=c[e+152>>2],!(c[t+80>>2]=a))return c[t+72>>2]=0,10231;if(a=t,t=0|pi[c[c[n>>2]+28>>2]](n,c[e+160>>2]),c[a+72>>2]=t){if(_=c[e+152>>2],r=0|pi[c[c[n>>2]+16>>2]](n,20,_),(0|_)<=0)e=c[e+160>>2];else for(a=(e=c[e+160>>2])+16|0,t=c[r+8>>2];s[t+14>>1]=d[a-10>>1],s[t+16>>1]=d[a-8>>1],s[t+18>>1]=d[a-6>>1],s[t+8>>1]=d[a-16>>1],s[t+10>>1]=d[a-14>>1],u=c[4+(l=a-4|0)>>2],c[t>>2]=c[l>>2],c[t+4>>2]=u,s[t+12>>1]=d[a-12>>1],a=a+32|0,t=t+20|0,_=_-1|0;);pi[c[c[n>>2]+20>>2]](n,r,10210,1497453121,e)}return 10231},function(e,t){var n,i=0,o=0,r=0,l=0,_=0,u=0,h=0,f=0,m=0,v=0;if(N=n=N+-64|0,A[20+(e|=0)>>2]=A[16+(t|=0)>>2],A[e+24>>2]=A[t+20>>2],A[e+28>>2]=A[t+24>>2],A[e+32>>2]=A[t+28>>2],A[e+4>>2]=A[t>>2],A[e+8>>2]=A[t+4>>2],A[e+12>>2]=A[t+8>>2],A[e+16>>2]=A[t+12>>2],A[e+36>>2]=A[t+32>>2],A[e+40>>2]=A[t+36>>2],A[e+44>>2]=A[t+40>>2],A[e+48>>2]=A[t+44>>2],c[e+56>>2]=c[t+48>>2],a[e+60|0]=0!=c[t+52>>2],h=c[t+56>>2],c[(i=56+n|0)>>2]=0,c[i+4>>2]=0,c[(i=48+n|0)>>2]=0,c[i+4>>2]=0,c[(i=40+n|0)>>2]=0,c[i+4>>2]=0,c[(i=32+n|0)>>2]=0,c[i+4>>2]=0,c[(i=24+n|0)>>2]=0,c[i+4>>2]=0,c[(i=16+n|0)>>2]=0,c[i+4>>2]=0,c[(i=8+n|0)>>2]=0,c[i+4>>2]=0,c[n>>2]=0,((c[4+n>>2]=0)|(r=c[e+88>>2]))<(0|h)){if(c[e+92>>2]<(0|h)){if(h&&(c[5498]=c[5498]+1,(i=M(h<<6|19))&&(c[(l=i+19&-16)-4>>2]=i)),1<=(0|r))for(i=r;u=c[e+96>>2]+f|0,v=c[(_=u)+4>>2],c[(o=l+f|0)>>2]=c[_>>2],c[o+4>>2]=v,v=c[4+(_=_+56|0)>>2],c[(m=o+56|0)>>2]=c[_>>2],c[m+4>>2]=v,v=c[4+(m=u+48|0)>>2],c[(_=o+48|0)>>2]=c[m>>2],c[_+4>>2]=v,v=c[4+(m=u+40|0)>>2],c[(_=o+40|0)>>2]=c[m>>2],c[_+4>>2]=v,v=c[4+(m=u+32|0)>>2],c[(_=o+32|0)>>2]=c[m>>2],c[_+4>>2]=v,v=c[4+(m=u+24|0)>>2],c[(_=o+24|0)>>2]=c[m>>2],c[_+4>>2]=v,v=c[4+(m=u+16|0)>>2],c[(_=o+16|0)>>2]=c[m>>2],c[_+4>>2]=v,_=c[4+(u=u+8|0)>>2],c[(o=o+8|0)>>2]=c[u>>2],c[o+4>>2]=_,f=f- -64|0,i=i-1|0;);(i=c[e+96>>2])&&p[e+100|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+96>>2]=l,c[e+92>>2]=h,a[e+100|0]=1}for(i=r<<6,f=h-r|0;l=c[4+n>>2],r=c[e+96>>2]+i|0,c[(o=r)>>2]=c[n>>2],c[o+4>>2]=l,u=c[4+(l=56+n|0)>>2],c[(o=o+56|0)>>2]=c[l>>2],c[o+4>>2]=u,u=c[4+(l=48+n|0)>>2],c[(o=r+48|0)>>2]=c[l>>2],c[o+4>>2]=u,u=c[4+(l=40+n|0)>>2],c[(o=r+40|0)>>2]=c[l>>2],c[o+4>>2]=u,u=c[4+(l=32+n|0)>>2],c[(o=r+32|0)>>2]=c[l>>2],c[o+4>>2]=u,u=c[4+(l=24+n|0)>>2],c[(o=r+24|0)>>2]=c[l>>2],c[o+4>>2]=u,u=c[4+(l=16+n|0)>>2],c[(o=r+16|0)>>2]=c[l>>2],c[o+4>>2]=u,l=c[4+(o=8+n|0)>>2],c[(r=r+8|0)>>2]=c[o>>2],c[r+4>>2]=l,i=i- -64|0,f=f-1|0;);}if(1<=(0|(c[e+88>>2]=h)))for(o=c[t+64>>2]+40|0,i=c[e+96>>2]+40|0;A[i-24>>2]=A[o-24>>2],A[i-20>>2]=A[o-20>>2],A[i-16>>2]=A[o-16>>2],A[i-12>>2]=A[o-12>>2],A[i-40>>2]=A[o-40>>2],A[i-36>>2]=A[o-36>>2],A[i-32>>2]=A[o-32>>2],c[i-8>>2]=c[o-8>>2],A[i-28>>2]=A[o-28>>2],c[i-4>>2]=c[o-4>>2],c[i>>2]=c[o>>2],i=i- -64|0,o=o+48|0,h=h-1|0;);if(f=c[t+60>>2],c[(i=8+n|0)>>2]=0,c[i+4>>2]=0,c[n>>2]=0,((c[4+n>>2]=0)|(r=c[e+128>>2]))<(0|f)){if(c[e+132>>2]<(0|f)){if(l=0,f&&(c[5498]=c[5498]+1,(i=M(19+(f<<4)|0))&&(c[(l=i+19&-16)-4>>2]=i)),1<=(0|r))for(o=0,i=r;h=c[e+136>>2]+o|0,m=c[h+4>>2],c[(_=u=o+l|0)>>2]=c[h>>2],c[_+4>>2]=m,_=c[4+(h=h+8|0)>>2],c[(u=u+8|0)>>2]=c[h>>2],c[u+4>>2]=_,o=o+16|0,i=i-1|0;);(i=c[e+136>>2])&&p[e+140|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+136>>2]=l,c[e+132>>2]=f,a[e+140|0]=1}for(o=r<<4,i=f-r|0;l=c[4+n>>2],r=c[e+136>>2]+o|0,c[r>>2]=c[n>>2],c[r+4>>2]=l,l=c[4+(h=8+n|0)>>2],c[(r=r+8|0)>>2]=c[h>>2],c[r+4>>2]=l,o=o+16|0,i=i-1|0;);}if(1<=(0|(c[e+128>>2]=f)))for(o=c[e+136>>2],l=c[t+68>>2],h=0;s[6+(i=o+h|0)>>1]=d[6+(r=l+h|0)>>1],s[i+8>>1]=d[r+8>>1],s[i+10>>1]=d[r+10>>1],s[i>>1]=d[r>>1],s[i+2>>1]=d[r+2>>1],c[i+12>>2]=c[r+12>>2],s[i+4>>1]=d[r+4>>1],h=h+16|0,f=f-1|0;);if(c[e+144>>2]=c[t+76>>2],h=c[t+80>>2],(0|(r=c[e+152>>2]))<(0|h)){if(c[e+156>>2]<(0|h)){if(l=0,h&&(c[5498]=c[5498]+1,(i=M(h<<5|19))&&(c[(l=i+19&-16)-4>>2]=i)),1<=(0|r))for(o=0,i=r;u=c[e+160>>2]+o|0,v=c[(_=u)+4>>2],c[(f=o+l|0)>>2]=c[_>>2],c[f+4>>2]=v,v=c[4+(_=_+24|0)>>2],c[(m=f+24|0)>>2]=c[_>>2],c[m+4>>2]=v,v=c[4+(m=u+16|0)>>2],c[(_=f+16|0)>>2]=c[m>>2],c[_+4>>2]=v,_=c[4+(u=u+8|0)>>2],c[(f=f+8|0)>>2]=c[u>>2],c[f+4>>2]=_,o=o+32|0,i=i-1|0;);(i=c[e+160>>2])&&p[e+164|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+160>>2]=l,c[e+156>>2]=h,a[e+164|0]=1}for(i=r<<5,f=h-r|0;l=c[4+n>>2],r=c[e+160>>2]+i|0,c[(o=r)>>2]=c[n>>2],c[o+4>>2]=l,u=c[4+(l=24+n|0)>>2],c[(o=o+24|0)>>2]=c[l>>2],c[o+4>>2]=u,u=c[4+(l=16+n|0)>>2],c[(o=r+16|0)>>2]=c[l>>2],c[o+4>>2]=u,l=c[4+(o=8+n|0)>>2],c[(r=r+8|0)>>2]=c[o>>2],c[r+4>>2]=l,i=i+32|0,f=f-1|0;);}if(1<=(0|(c[e+152>>2]=h)))for(o=c[e+160>>2]+16|0,i=c[t+72>>2];s[o-10>>1]=d[i+14>>1],s[o-8>>1]=d[i+16>>1],s[o-6>>1]=d[i+18>>1],s[o-16>>1]=d[i+8>>1],s[o-14>>1]=d[i+10>>1],t=c[i+4>>2],c[(e=o-4|0)>>2]=c[i>>2],c[e+4>>2]=t,s[o-12>>1]=d[i+12>>1],o=o+32|0,i=i+20|0,h=h-1|0;);N=n+64|0},function(e,t){var n,i=0,o=0,r=0,l=0,_=0,u=0,h=0,f=0,m=0,g=0;if(N=n=N+-64|0,A[20+(e|=0)>>2]=v[32+(t|=0)>>3],A[e+4>>2]=v[t>>3],A[e+8>>2]=v[t+8>>3],A[e+12>>2]=v[t+16>>3],A[e+16>>2]=v[t+24>>3],A[e+36>>2]=v[t+64>>3],A[e+24>>2]=v[t+40>>3],A[e+28>>2]=v[t+48>>3],A[e+32>>2]=v[t+56>>3],A[e+40>>2]=v[t+72>>3],c[e+56>>2]=c[t+96>>2],A[e+44>>2]=v[t+80>>3],A[e+48>>2]=v[t+88>>3],a[e+60|0]=0!=c[t+100>>2],h=c[t+104>>2],c[(i=56+n|0)>>2]=0,c[i+4>>2]=0,c[(i=48+n|0)>>2]=0,c[i+4>>2]=0,c[(i=40+n|0)>>2]=0,c[i+4>>2]=0,c[(i=32+n|0)>>2]=0,c[i+4>>2]=0,c[(i=24+n|0)>>2]=0,c[i+4>>2]=0,c[(i=16+n|0)>>2]=0,c[i+4>>2]=0,c[(i=8+n|0)>>2]=0,c[i+4>>2]=0,c[n>>2]=0,((c[4+n>>2]=0)|(r=c[e+88>>2]))<(0|h)){if(c[e+92>>2]<(0|h)){if(h&&(c[5498]=c[5498]+1,(i=M(h<<6|19))&&(c[(l=i+19&-16)-4>>2]=i)),1<=(0|r))for(i=r;u=c[e+96>>2]+f|0,g=c[(_=u)+4>>2],c[(o=l+f|0)>>2]=c[_>>2],c[o+4>>2]=g,g=c[4+(_=_+56|0)>>2],c[(m=o+56|0)>>2]=c[_>>2],c[m+4>>2]=g,g=c[4+(m=u+48|0)>>2],c[(_=o+48|0)>>2]=c[m>>2],c[_+4>>2]=g,g=c[4+(m=u+40|0)>>2],c[(_=o+40|0)>>2]=c[m>>2],c[_+4>>2]=g,g=c[4+(m=u+32|0)>>2],c[(_=o+32|0)>>2]=c[m>>2],c[_+4>>2]=g,g=c[4+(m=u+24|0)>>2],c[(_=o+24|0)>>2]=c[m>>2],c[_+4>>2]=g,g=c[4+(m=u+16|0)>>2],c[(_=o+16|0)>>2]=c[m>>2],c[_+4>>2]=g,_=c[4+(u=u+8|0)>>2],c[(o=o+8|0)>>2]=c[u>>2],c[o+4>>2]=_,f=f- -64|0,i=i-1|0;);(i=c[e+96>>2])&&p[e+100|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+96>>2]=l,c[e+92>>2]=h,a[e+100|0]=1}for(i=r<<6,f=h-r|0;l=c[4+n>>2],r=c[e+96>>2]+i|0,c[(o=r)>>2]=c[n>>2],c[o+4>>2]=l,u=c[4+(l=56+n|0)>>2],c[(o=o+56|0)>>2]=c[l>>2],c[o+4>>2]=u,u=c[4+(l=48+n|0)>>2],c[(o=r+48|0)>>2]=c[l>>2],c[o+4>>2]=u,u=c[4+(l=40+n|0)>>2],c[(o=r+40|0)>>2]=c[l>>2],c[o+4>>2]=u,u=c[4+(l=32+n|0)>>2],c[(o=r+32|0)>>2]=c[l>>2],c[o+4>>2]=u,u=c[4+(l=24+n|0)>>2],c[(o=r+24|0)>>2]=c[l>>2],c[o+4>>2]=u,u=c[4+(l=16+n|0)>>2],c[(o=r+16|0)>>2]=c[l>>2],c[o+4>>2]=u,l=c[4+(o=8+n|0)>>2],c[(r=r+8|0)>>2]=c[o>>2],c[r+4>>2]=l,i=i- -64|0,f=f-1|0;);}if(1<=(0|(c[e+88>>2]=h)))for(o=c[t+112>>2]+72|0,i=c[e+96>>2]+40|0;c[i-8>>2]=c[o-8>>2],A[i-24>>2]=v[o-40>>3],A[i-20>>2]=v[o-32>>3],A[i-16>>2]=v[o-24>>3],A[i-12>>2]=v[o-16>>3],A[i-40>>2]=v[o-72>>3],A[i-36>>2]=v[o+-64>>3],A[i-32>>2]=v[o-56>>3],A[i-28>>2]=v[o-48>>3],c[i-4>>2]=c[o-4>>2],c[i>>2]=c[o>>2],i=i- -64|0,o=o+80|0,h=h-1|0;);if(f=c[t+108>>2],c[(i=8+n|0)>>2]=0,c[i+4>>2]=0,c[n>>2]=0,((c[4+n>>2]=0)|(r=c[e+128>>2]))<(0|f)){if(c[e+132>>2]<(0|f)){if(l=0,f&&(c[5498]=c[5498]+1,(i=M(19+(f<<4)|0))&&(c[(l=i+19&-16)-4>>2]=i)),1<=(0|r))for(o=0,i=r;h=c[e+136>>2]+o|0,m=c[h+4>>2],c[(_=u=o+l|0)>>2]=c[h>>2],c[_+4>>2]=m,_=c[4+(h=h+8|0)>>2],c[(u=u+8|0)>>2]=c[h>>2],c[u+4>>2]=_,o=o+16|0,i=i-1|0;);(i=c[e+136>>2])&&p[e+140|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+136>>2]=l,c[e+132>>2]=f,a[e+140|0]=1}for(o=r<<4,i=f-r|0;l=c[4+n>>2],r=c[e+136>>2]+o|0,c[r>>2]=c[n>>2],c[r+4>>2]=l,l=c[4+(h=8+n|0)>>2],c[(r=r+8|0)>>2]=c[h>>2],c[r+4>>2]=l,o=o+16|0,i=i-1|0;);}if(1<=(0|(c[e+128>>2]=f)))for(o=c[e+136>>2],l=c[t+116>>2],h=0;s[6+(i=o+h|0)>>1]=d[6+(r=l+h|0)>>1],s[i+8>>1]=d[r+8>>1],s[i+10>>1]=d[r+10>>1],s[i>>1]=d[r>>1],s[i+2>>1]=d[r+2>>1],c[i+12>>2]=c[r+12>>2],s[i+4>>1]=d[r+4>>1],h=h+16|0,f=f-1|0;);if(c[e+144>>2]=c[t+120>>2],h=c[t+124>>2],(0|(r=c[e+152>>2]))<(0|h)){if(c[e+156>>2]<(0|h)){if(l=0,h&&(c[5498]=c[5498]+1,(i=M(h<<5|19))&&(c[(l=i+19&-16)-4>>2]=i)),1<=(0|r))for(o=0,i=r;u=c[e+160>>2]+o|0,g=c[(_=u)+4>>2],c[(f=o+l|0)>>2]=c[_>>2],c[f+4>>2]=g,g=c[4+(_=_+24|0)>>2],c[(m=f+24|0)>>2]=c[_>>2],c[m+4>>2]=g,g=c[4+(m=u+16|0)>>2],c[(_=f+16|0)>>2]=c[m>>2],c[_+4>>2]=g,_=c[4+(u=u+8|0)>>2],c[(f=f+8|0)>>2]=c[u>>2],c[f+4>>2]=_,o=o+32|0,i=i-1|0;);(i=c[e+160>>2])&&p[e+164|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+160>>2]=l,c[e+156>>2]=h,a[e+164|0]=1}for(i=r<<5,f=h-r|0;l=c[4+n>>2],r=c[e+160>>2]+i|0,c[(o=r)>>2]=c[n>>2],c[o+4>>2]=l,u=c[4+(l=24+n|0)>>2],c[(o=o+24|0)>>2]=c[l>>2],c[o+4>>2]=u,u=c[4+(l=16+n|0)>>2],c[(o=r+16|0)>>2]=c[l>>2],c[o+4>>2]=u,l=c[4+(o=8+n|0)>>2],c[(r=r+8|0)>>2]=c[o>>2],c[r+4>>2]=l,i=i+32|0,f=f-1|0;);}if(1<=(0|(c[e+152>>2]=h)))for(o=c[e+160>>2]+16|0,i=c[t+128>>2];s[o-10>>1]=d[i+14>>1],s[o-8>>1]=d[i+16>>1],s[o-6>>1]=d[i+18>>1],s[o-16>>1]=d[i+8>>1],s[o-14>>1]=d[i+10>>1],t=c[i+4>>2],c[(e=o-4|0)>>2]=c[i>>2],c[e+4>>2]=t,s[o-12>>1]=d[i+12>>1],o=o+32|0,i=i+20|0,h=h-1|0;);N=n+64|0},function(e){return St(e|=0),0|e},function(e){St(e|=0),c[5499]=c[5499]+1,z(c[e-4>>2])},function(e,t,n,i){return Ct(e|=0,t|=0,n|=0,i|=0),1},ve,function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,r,l,_,u,h,f,d,m,v,g=x(0),y=x(0),b=x(0),S=x(0),C=0,E=x(0),T=0,P=x(0),w=x(0),I=x(0),R=x(0),D=0,N=(b=A[t+40>>2],g=A[t+24>>2],(S=(S=(y=A[t+8>>2])>x(-0xde0b6b000000000)?y:x(-0xde0b6b000000000))<g?g:S)<b?b:S);if(y=y<x(0xde0b6b000000000)?y:x(0xde0b6b000000000),f=x(N-(P=b<(g=g<y?g:y)?b:g)),S=(b=A[t+36>>2])<(S=(g=A[t+20>>2])<(S=(y=A[t+4>>2])<x(0xde0b6b000000000)?y:x(0xde0b6b000000000))?g:S)?b:S,b=(g=(y=y>x(-0xde0b6b000000000)?y:x(-0xde0b6b000000000))<g?g:y)<b?b:g,d=(g=A[t+32>>2])<(R=(y=A[t+16>>2])<(I=(E=A[t>>2])<x(0xde0b6b000000000)?E:x(0xde0b6b000000000))?y:I),m=(w=(E=E>x(-0xde0b6b000000000)?E:x(-0xde0b6b000000000))<y?y:E)<g,t=c[e+8>>2],y=A[t+44>>2],E=A[t+40>>2],I=A[t+12>>2],_=A[t+8>>2],u=A[t+36>>2],h=A[t+4>>2],o=c[e+4>>2],(0|(e=c[o+4>>2]))==c[o+8>>2]&&!((0|(T=e?e<<1:1))<=(0|e))){if(T&&(c[5498]=c[5498]+1,(t=M(19+(T<<4)|0))&&(c[(D=t+19&-16)-4>>2]=t)),1<=(0|e))for(t=0;r=c[o+12>>2]+t|0,l=c[4+r>>2],c[(C=t+D|0)>>2]=c[r>>2],c[C+4>>2]=l,l=c[4+(r=8+r|0)>>2],c[(C=C+8|0)>>2]=c[r>>2],c[C+4>>2]=l,t=t+16|0,e=e-1|0;);(e=c[o+12>>2])&&p[o+16|0]&&(c[5499]=c[5499]+1,z(c[e-4>>2])),c[o+12>>2]=D,a[o+16|0]=1,c[o+8>>2]=T,e=c[o+4>>2]}v=x(b-S),e=c[o+12>>2]+(e<<4)|0,c[e+12>>2]=n<<21|i,R=x((w=m?g:w)-(g=d?g:R)),t=e,n=f<x(.0020000000949949026),i=(P=x(x((n?x(P+x(-.0010000000474974513)):P)-I)*y))<x(4294967296)&P>=x(0)?~~P>>>0:0,s[t+4>>1]=65534&i,t=e,i=v<x(.0020000000949949026),T=(S=x(x((i?x(S+x(-.0010000000474974513)):S)-_)*E))<x(4294967296)&S>=x(0)?~~S>>>0:0,s[t+2>>1]=65534&T,t=e,T=R<x(.0020000000949949026),C=(g=x(x((T?x(g+x(-.0010000000474974513)):g)-h)*u))<x(4294967296)&g>=x(0)?~~g>>>0:0,s[t>>1]=65534&C,C=e+10|0,t=(g=x(x(x((n?x(N+x(.0010000000474974513)):N)-I)*y)+x(1)))<x(4294967296)&g>=x(0)?~~g>>>0:0,s[C>>1]=1|t,n=e+8|0,t=(b=x(x(x((i?x(b+x(.0010000000474974513)):b)-_)*E)+x(1)))<x(4294967296)&b>=x(0)?~~b>>>0:0,s[n>>1]=1|t,t=(b=x(x(x((T?x(w+x(.0010000000474974513)):w)-h)*u)+x(1)))<x(4294967296)&b>=x(0)?~~b>>>0:0,s[e+6>>1]=1|t,c[o+4>>2]=c[o+4>>2]+1},ve,function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,r,s,l,_,u,h,f,d,m,v,g,y,b=x(0),S=x(0),C=x(0),E=x(0),T=0,P=x(0),w=x(0),I=x(0),R=x(0),D=N-32|0;if(N=D,b=A[t+28>>2],d=(C=(S=A[t+12>>2])>x(0)?S:x(0))<b?b:C,C=A[t+24>>2],m=(E=(P=A[t+8>>2])>x(-0xde0b6b000000000)?P:x(-0xde0b6b000000000))<C?C:E,E=A[t+20>>2],v=(I=(w=A[t+4>>2])>x(-0xde0b6b000000000)?w:x(-0xde0b6b000000000))<E?E:I,I=A[t+16>>2],R=(R=(h=A[t>>2])>x(-0xde0b6b000000000)?h:x(-0xde0b6b000000000))<I?I:R,g=b<(S=S<x(0)?S:x(0))?b:S,y=C<(b=P<x(0xde0b6b000000000)?P:x(0xde0b6b000000000))?C:b,E=E<(b=w<x(0xde0b6b000000000)?w:x(0xde0b6b000000000))?E:b,w=I<(b=h<x(0xde0b6b000000000)?h:x(0xde0b6b000000000))?I:b,b=A[t+44>>2],S=A[t+40>>2],C=A[t+36>>2],P=A[t+32>>2],l=c[e+4>>2],(0|(T=c[l+4>>2]))==c[l+8>>2]&&!((0|(f=T?T<<1:1))<=(0|T))){if(t=0,f&&(c[5498]=c[5498]+1,(e=M(f<<6|19))&&(c[(t=e+19&-16)-4>>2]=e)),1<=(0|T))for(e=0;_=c[l+12>>2]+e|0,s=c[4+(o=_)>>2],c[(r=u=e+t|0)>>2]=c[o>>2],c[4+r>>2]=s,s=c[4+(o=56+o|0)>>2],c[(r=56+r|0)>>2]=c[o>>2],c[4+r>>2]=s,s=c[4+(r=48+_|0)>>2],c[(o=48+u|0)>>2]=c[r>>2],c[4+o>>2]=s,s=c[4+(r=40+_|0)>>2],c[(o=40+u|0)>>2]=c[r>>2],c[4+o>>2]=s,s=c[4+(r=32+_|0)>>2],c[(o=32+u|0)>>2]=c[r>>2],c[4+o>>2]=s,s=c[4+(r=24+_|0)>>2],c[(o=24+u|0)>>2]=c[r>>2],c[4+o>>2]=s,s=c[4+(r=16+_|0)>>2],c[(o=16+u|0)>>2]=c[r>>2],c[4+o>>2]=s,o=c[4+(_=8+_|0)>>2],c[(u=8+u|0)>>2]=c[_>>2],c[4+u>>2]=o,e=e- -64|0,T=T-1|0;);(e=c[l+12>>2])&&p[l+16|0]&&(c[5499]=c[5499]+1,z(c[e-4>>2])),c[l+12>>2]=t,a[l+16|0]=1,c[l+8>>2]=f,T=c[l+4>>2]}e=c[l+12>>2]+(T<<6)|0,c[e+40>>2]=i,c[e+36>>2]=n,c[e+32>>2]=-1,A[e+16>>2]=R<P?P:R,A[e+12>>2]=b<g?b:g,A[e+8>>2]=S<y?S:y,A[e+4>>2]=C<E?C:E,A[e>>2]=P<w?P:w,t=c[16+D>>2],c[e+44>>2]=c[12+D>>2],c[e+48>>2]=t,A[e+28>>2]=d<b?b:d,A[e+24>>2]=m<S?S:m,A[e+20>>2]=v<C?C:v,i=c[4+(n=20+D|0)>>2],c[(t=e+52|0)>>2]=c[n>>2],c[t+4>>2]=i,c[e+60>>2]=c[28+D>>2],c[l+4>>2]=c[l+4>>2]+1,N=32+D|0},function(e){var t;return c[(e|=0)>>2]=10608,p[e+69|0]&&(t=c[e+60>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+60>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),0|e},function(e){var t;c[(e|=0)>>2]=10608,p[e+69|0]&&(t=c[e+60>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+60>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),c[5499]=c[5499]+1,z(c[e-4>>2])},function(e,t){e|=0,t|=0,x(0);var n=0|pi[c[c[e>>2]+28>>2]](e),i=x(A[n>>2]-A[t>>2]),o=x(i*i);i=x(A[4+n>>2]-A[t+4>>2]),o=x(o+x(i*i)),i=x(A[8+n>>2]-A[t+8>>2]),x(o+x(i*i))>x(1.1920928955078125e-7)&&(bt(e,t),p[e+69|0]&&(t=c[e+60>>2],pi[c[c[t>>2]>>2]](t),(t=c[e+60>>2])&&(c[5499]=c[5499]+1,z(c[t-4>>2]))),c[5498]=c[5498]+1,t=0,(n=M(191))&&(c[(t=n+19&-16)-4>>2]=n),a[t+80|0]=1,a[t+60|0]=0,c[t+52>>2]=287,c[t+76>>2]=0,a[t+100|0]=1,c[t+68>>2]=0,c[t+72>>2]=0,c[t+96>>2]=0,a[t+120|0]=1,c[t+88>>2]=0,c[t+92>>2]=0,c[t+116>>2]=0,a[t+140|0]=1,c[t+108>>2]=0,c[t+112>>2]=0,c[t+136>>2]=0,a[t+164|0]=1,c[t+144>>2]=0,c[t+128>>2]=0,c[t+132>>2]=0,c[t+160>>2]=0,c[t+152>>2]=0,c[t+156>>2]=0,c[t+168>>2]=0,c[t+28>>2]=2139095039,c[t+32>>2]=0,c[t+20>>2]=2139095039,c[t+24>>2]=2139095039,c[t+12>>2]=-8388609,c[t+16>>2]=0,c[t+4>>2]=-8388609,c[t+8>>2]=-8388609,c[t>>2]=10280,wt(c[e+60>>2]=t,c[e+56>>2],p[e+68|0],e+24|0,e+40|0),a[e+69|0]=1)},function(){return 10904},at,function(e,t,n){t|=0;var i=0,o=0,a=0,r=0,s=0,l=0,_=0,u=0;return i=0|pi[c[c[(n|=0)>>2]+40>>2]](n,e|=0),o=0|pi[c[c[n>>2]+28>>2]](n,i),(c[t>>2]=o)&&pi[c[c[n>>2]+48>>2]](n,i),i=c[e+4>>2],c[t+8>>2]=0,c[t+4>>2]=i,i=c[e+56>>2],pi[c[c[i>>2]+56>>2]](i,t+12|0,n),A[t+52>>2]=A[e+20>>2],!c[e+60>>2]||1&pi[c[c[n>>2]+52>>2]](n)?(c[t+40>>2]=0,c[t+44>>2]=0):(i=0|pi[c[c[n>>2]+24>>2]](n,c[e+60>>2]))?(c[t+44>>2]=0,c[t+40>>2]=i):(i=0|pi[c[c[n>>2]+28>>2]](n,c[e+60>>2]),c[t+44>>2]=0,c[t+40>>2]=i,i=c[e+60>>2],r=n,s=0|pi[c[c[i>>2]+12>>2]](i),a=c[c[n>>2]+16>>2],i=0|pi[a](0|r,0|s,0|(l=1)),o=c[e+60>>2],r=0|pi[c[c[o>>2]+16>>2]](o,c[(s=i)+8>>2],l=n),u=c[e+60>>2],a=c[c[n>>2]+20>>2],pi[a](0|l,0|s,0|r,0|(_=1213612625),0|u)),!c[e+64>>2]||2&pi[c[c[n>>2]+52>>2]](n)?c[t+48>>2]=0:(i=0|pi[c[c[n>>2]+24>>2]](n,c[e+64>>2]))?c[t+48>>2]=i:(a=t,u=0|pi[c[c[n>>2]+28>>2]](n,c[e+64>>2]),c[a+48>>2]=u,i=c[e+64>>2],u=n,_=0|pi[c[c[i>>2]+8>>2]](i),a=c[c[n>>2]+16>>2],i=0|pi[a](0|u,0|_,0|(r=1)),o=c[e+64>>2],u=0|pi[c[c[o>>2]+12>>2]](o,c[(_=i)+8>>2],r=n),l=c[e+64>>2],a=c[c[n>>2]+20>>2],pi[a](0|r,0|_,0|u,0|(s=1346456916),0|l)),c[t+56>>2]=0,10880},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,a,r,l,_,u,h,f,m=0,v=0,g=x(0),y=x(0),b=0,S=x(0),C=x(0),E=0,T=x(0),P=0,w=0,I=0,R=0,D=0;c[60+(N=f=N-80|0)>>2]=0,c[8+f>>2]=t,c[f>>2]=10712,c[4+f>>2]=c[e+56>>2],m=c[e+60>>2];e:if(p[m+60|0]){v=e=f,T=A[m+28>>2],g=A[m+12>>2],y=A[n+8>>2],r=A[m+44>>2],t=(y=x(x((T<(y=y<g?g:y)?T:y)-g)*r))<x(4294967296)&y>=x(0)?~~y>>>0:0,s[v+78>>1]=t&=65534,E=e,o=A[m+24>>2],y=A[m+8>>2],S=A[n+4>>2],l=A[m+40>>2],v=(S=x(x((o<(S=S<y?y:S)?o:S)-y)*l))<x(4294967296)&S>=x(0)?~~S>>>0:0,s[E+76>>1]=v&=65534,E=e,a=A[m+20>>2],S=A[m+4>>2],C=A[n>>2],_=A[m+36>>2],n=(C=x(x((a<(C=C<S?S:C)?a:C)-S)*_))<x(4294967296)&C>=x(0)?~~C>>>0:0,s[E+74>>1]=P=65534&n,C=A[i+8>>2],n=(g=x(x(r*x((T<(C=C<g?g:C)?T:C)-g))+x(1)))<x(4294967296)&g>=x(0)?~~g>>>0:0,g=A[i>>2],T=A[i+4>>2],s[e+72>>1]=i=1|n,n=(y=x(x(l*x((o<(T=T<y?y:T)?o:T)-y))+x(1)))<x(4294967296)&y>=x(0)?~~y>>>0:0,s[e+70>>1]=E=1|n,e=f,n=(g=x(x(_*x((a<(g=g<S?S:g)?a:g)-S))+x(1)))<x(4294967296)&g>=x(0)?~~g>>>0:0,s[e+68>>1]=w=1|n;t:switch(c[m+144>>2]){case 0:if(1<=(0|(I=c[m+56>>2])))for(e=c[m+136>>2],n=0;m=P>>>0<=d[e+6>>1]&w>>>0>=d[e>>1]&t>>>0<=d[e+10>>1]&i>>>0>=d[e+4>>1]&v>>>0<=d[e+8>>1]&E>>>0>=d[e+2>>1],(D=(0|(R=c[e+12>>2]))<0)||m&&pi[c[c[f>>2]+8>>2]](f,R>>>21|0,2097151&R),e=D&(-1^m)?(n=n-(m=c[e+12>>2])|0,e-(m<<4)|0):(n=n+1|0,e+16|0),b=b+1|0,(0|n)<(0|I););if(c[5592]>=(0|b))break e;c[5592]=b;break e;case 1:if(c[m+152>>2]<1)break e;for(;;){if(e=c[m+160>>2]+(R<<5)|0,!(P>>>0>d[e+6>>1]||w>>>0<d[e>>1]||t>>>0>d[e+10>>1]||i>>>0<d[e+4>>1]||v>>>0>d[e+8>>1]||E>>>0<d[e+2>>1])){if((0|(b=c[e+16>>2]))<1)b=0;else for(h=b+(n=c[e+12>>2])|0,e=c[m+136>>2]+(n<<4)|0,b=0;I=P>>>0<=d[e+6>>1]&w>>>0>=d[e>>1]&t>>>0<=d[e+10>>1]&i>>>0>=d[e+4>>1]&v>>>0<=d[e+8>>1]&E>>>0>=d[e+2>>1],(u=(0|(D=c[e+12>>2]))<0)||I&&pi[c[c[f>>2]+8>>2]](f,D>>>21|0,2097151&D),e=(-1^I)&u?(n=n-(I=c[e+12>>2])|0,e-(I<<4)|0):(n=n+1|0,e+16|0),b=b+1|0,(0|n)<(0|h););c[5592]>=(0|b)||(c[5592]=b)}if(!((0|(R=R+1|0))<c[m+152>>2]))break}break e;case 2:break t;default:break e}!function e(t,n,i,o){for(var a,r=0;;){t:{if(!(d[i>>1]>d[t+6>>1]||d[o>>1]<d[t>>1]||d[i+4>>1]>d[t+10>>1]||d[o+4>>1]<d[t+4>>1]||d[i+2>>1]>d[t+8>>1]||d[o+2>>1]<d[t+2>>1])){if((0|(r=c[t+12>>2]))<0)break t;pi[c[c[n>>2]+8>>2]](n,r>>>21|0,2097151&r)}return}e(r=t+16|0,n,i,o),a=t+32|0,t=-1<(0|(t=c[t+28>>2]))?a:r-(t<<4)|0}}(c[m+136>>2],f,74+f|0,68+f|0)}else{if(1<=(0|(E=c[m+56>>2])))for(e=c[m+96>>2],t=0;;){v=0,A[n>>2]>A[e+16>>2]||(v=0,A[i>>2]<A[e>>2]||(v=1)),b=0,A[n+8>>2]>A[e+24>>2]||A[i+8>>2]<A[e+8>>2]||(b=v);t:{n:{if(A[i+4>>2]<A[e+4>>2]||A[n+4>>2]>A[e+20>>2])w=-1==(0|(v=c[e+32>>2])),b=0;else if((w=-1==(0|(v=c[e+32>>2])))&b){pi[c[c[f>>2]+8>>2]](f,c[e+36>>2],c[e+40>>2]),E=c[m+56>>2];break n}if(!w&&!b){t=t+v|0,e=(v<<6)+e|0;break t}}t=t+1|0,e=e- -64|0}if(P=P+1|0,!((0|t)<(0|E)))break}c[5592]>=(0|P)||(c[5592]=P)}N=80+f|0},function(e,t){t|=0;var n,i,o,a,r=0;(r=c[60+(e|=0)>>2])&&(o=t,a=0|pi[c[c[r>>2]+12>>2]](r),i=c[c[t>>2]+16>>2],r=0|pi[i](0|o,0|a,1),n=c[e+60>>2],o=0|pi[c[c[n>>2]+16>>2]](n,c[8+(a=r)>>2],r=t),e=c[e+60>>2],i=c[c[t>>2]+20>>2],pi[i](0|r,0|a,0|o,1213612625,0|e))},function(e,t){t|=0;var n,i,o,a,r=0;(r=c[64+(e|=0)>>2])&&(o=t,a=0|pi[c[c[r>>2]+8>>2]](r),i=c[c[t>>2]+16>>2],r=0|pi[i](0|o,0|a,1),n=c[e+64>>2],o=0|pi[c[c[n>>2]+12>>2]](n,c[8+(a=r)>>2],r=t),e=c[e+64>>2],i=c[c[t>>2]+20>>2],pi[i](0|r,0|a,0|o,1346456916,0|e))},Se,ve,function(e,t,n){e|=0,t|=0,n|=0;var i,o,a,r,s,l,_,u=0,h=0,f=x(0),m=x(0),y=x(0),b=0,S=x(0),C=0;N=_=N-32|0,c[e+60>>2]=c[e+60>>2]+1,b=c[e+4>>2],pi[c[c[b>>2]+16>>2]](b,28+_|0,24+_|0,20+_|0,16+_|0,12+_|0,8+_|0,4+_|0,_,t),b=(i=c[e+4>>2])+12|0,o=c[12+_>>2]+g(c[8+_>>2],n)|0,a=c[20+_>>2],s=h=c[28+_>>2],l=r=c[16+_>>2];e:{t:{n:{i:{o:{a:{r:{if(3!=(0|(C=c[_>>2]))){if(2!=(0|C))break r;u=c[8+o>>2];break a}if(u=g(d[4+o>>1],r)+h|0,u=a?(m=x(A[i+8>>2]*x(v[u+8>>3])),y=x(A[i+4>>2]*x(v[u>>3])),f=x(v[u+16>>3]),b):(m=x(A[u+4>>2]*A[i+8>>2]),y=x(A[u>>2]*A[i+4>>2]),f=A[i+12>>2],u+8|0),S=A[u>>2],c[e+56>>2]=0,A[e+48>>2]=m,A[e+44>>2]=y,A[e+52>>2]=S*f,u=g(d[2+o>>1],r)+h|0,!a)break o;m=x(A[i+8>>2]*x(v[u+8>>3])),y=x(A[i+4>>2]*x(v[u>>3])),f=x(v[u+16>>3]),u=b;break i}u=p[2+o|0]}if(u=g(u,r)+h|0,u=a?(m=x(A[i+8>>2]*x(v[u+8>>3])),y=x(A[i+4>>2]*x(v[u>>3])),f=x(v[u+16>>3]),b):(m=x(A[u+4>>2]*A[i+8>>2]),y=x(A[u>>2]*A[i+4>>2]),f=A[i+12>>2],u+8|0),S=A[u>>2],c[e+56>>2]=0,A[e+48>>2]=m,A[e+44>>2]=y,A[e+52>>2]=S*f,2==(0|C))break n;u=p[1+o|0];break t}m=x(A[u+4>>2]*A[i+8>>2]),y=x(A[u>>2]*A[i+4>>2]),f=A[i+12>>2],u=u+8|0}S=A[u>>2],c[e+40>>2]=0,A[e+32>>2]=m,A[e+28>>2]=y,A[e+36>>2]=S*f,h=g(d[o>>1],r)+h|0,m=a?(y=x(A[i+4>>2]*x(v[h>>3])),f=x(v[h+16>>3]),x(A[i+8>>2]*x(v[h+8>>3]))):(b=h+8|0,y=x(A[h>>2]*A[i+4>>2]),f=A[i+12>>2],x(A[h+4>>2]*A[i+8>>2])),f=x(A[b>>2]*f);break e}u=c[4+o>>2]}u=s+g(l,u)|0,u=a?(m=x(A[i+8>>2]*x(v[u+8>>3])),y=x(A[i+4>>2]*x(v[u>>3])),f=x(v[u+16>>3]),b):(m=x(A[u+4>>2]*A[i+8>>2]),y=x(A[u>>2]*A[i+4>>2]),f=A[i+12>>2],u+8|0),S=A[u>>2],c[e+40>>2]=0,A[e+32>>2]=m,A[e+28>>2]=y,A[e+36>>2]=S*f,u=2!=(0|C)?p[0|o]:c[o>>2],h=g(u,r)+h|0,m=a?(y=x(A[i+4>>2]*x(v[h>>3])),f=x(v[h+16>>3]),x(A[i+8>>2]*x(v[h+8>>3]))):(b=h+8|0,y=x(A[h>>2]*A[i+4>>2]),f=A[i+12>>2],x(A[h+4>>2]*A[i+8>>2])),f=x(A[b>>2]*f)}A[e+12>>2]=y,c[e+24>>2]=0,A[e+20>>2]=f,A[e+16>>2]=m,b=c[e+8>>2],pi[c[c[b>>2]+8>>2]](b,e+12|0,t,n),e=c[e+4>>2],pi[c[c[e>>2]+24>>2]](e,t),N=32+_|0},ve,It,ve,It,Je,Qe,function(e,t){e|=0,t|=0,x(0);var n,i,o=0;N=o=N-96|0,i=c[t+4>>2],n=c[e+100>>2],c[n+4>>2]=c[t>>2],c[n+8>>2]=i,i=c[4+(t=t+8|0)>>2],c[(n=n+12|0)>>2]=c[t>>2],c[4+n>>2]=i,a[e+96|0]=1,p[22256]||(c[5569]=0,c[5570]=0,c[5568]=1065353216,c[5571]=0,c[5572]=0,c[5574]=0,c[5575]=0,c[5573]=1065353216,c[5576]=0,c[5577]=0,c[5581]=0,c[5582]=0,c[5580]=-1082130432,c[5578]=1065353216,c[5579]=0,c[5583]=0,c[5584]=0,c[5586]=0,c[5587]=0,c[5585]=-1082130432,c[5588]=0,c[5589]=0,c[5590]=-1082130432,c[5591]=0,a[22256]=1),t=B(o,0,96),pi[c[c[e>>2]+76>>2]](e,22272,t,6),o=A[e+52>>2],A[e+80>>2]=A[t>>2]+o,A[e+64>>2]=A[t+48>>2]-o,A[e+84>>2]=o+A[t+20>>2],A[e+68>>2]=A[t+68>>2]-o,A[e+88>>2]=o+A[t+40>>2],A[e+72>>2]=A[t+88>>2]-o,N=t+96|0},function(e){return c[100+(e|=0)>>2]+4|0},function(){return 11437},De,function(e,t,n){e|=0,t|=0,n|=0;var i,o=x(0),a=x(0),r=x(0),s=x(0);N=i=N-80|0,a=A[n>>2],r=A[n+4>>2],s=A[n+8>>2],o=(o=x(x(x(a*a)+x(r*r))+x(s*s)))<x(9999999747378752e-20)?(r=x(0),a=x(1),s=x(0),x(0)):(o=x(x(1)/x(T(o))),s=x(s*o),r=x(r*o),a=x(a*o),A[n+12>>2]),c[(n=52+i|0)>>2]=0,c[n+4>>2]=0,A[76+i>>2]=o,A[72+i>>2]=s,A[68+i>>2]=r,c[44+i>>2]=0,c[48+i>>2]=0,c[40+i>>2]=11384,A[64+i>>2]=a,c[60+i>>2]=-581039253,c[32+i>>2]=1566444395,c[36+i>>2]=0,c[24+i>>2]=1566444395,c[28+i>>2]=1566444395,t=c[t+100>>2],c[16+i>>2]=-581039253,c[20+i>>2]=0,c[8+i>>2]=-581039253,c[12+i>>2]=-581039253,pi[c[c[t>>2]+8>>2]](t,40+i|0,8+i|0,24+i|0),a=c[n+4>>2],c[(t=e+8|0)>>2]=c[n>>2],c[t+4>>2]=a,t=c[48+i>>2],c[e>>2]=c[44+i>>2],c[e+4>>2]=t,N=80+i|0},function(e,t,n,i){e|=0,t|=0,n|=0;var o,a,r,s,l,_=0,u=0;if(N=l=N-80|0,1<=(0|(i|=0))){for(u=n+12|0,_=i;c[u>>2]=-581039253,u=u+16|0,_=_-1|0;);for(_=40+l|4,u=l+64|0;c[_>>2]=0,c[_+4>>2]=0,c[(o=a=_+8|0)>>2]=0,c[4+o>>2]=0,o=c[t+4>>2],c[u>>2]=c[t>>2],c[u+4>>2]=o,s=c[4+(r=t+8|0)>>2],c[(o=u+8|0)>>2]=c[r>>2],c[4+o>>2]=s,c[40+l>>2]=11384,c[60+l>>2]=-581039253,c[32+l>>2]=1566444395,c[36+l>>2]=0,c[24+l>>2]=1566444395,c[28+l>>2]=1566444395,o=c[e+100>>2],c[16+l>>2]=-581039253,c[20+l>>2]=0,c[8+l>>2]=-581039253,c[12+l>>2]=-581039253,pi[c[c[o>>2]+8>>2]](o,40+l|0,8+l|0,24+l|0),r=c[4+a>>2],c[(o=n+8|0)>>2]=c[a>>2],c[4+o>>2]=r,a=c[_+4>>2],c[n>>2]=c[_>>2],c[n+4>>2]=a,t=t+16|0,n=n+16|0,i=i-1|0;);}N=80+l|0},We,We,Rt,qe,We,Rt,Dt,ve,function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,a,r,s=x(0),l=x(0),_=0,u=0;n=e+4|0,l=A[e+20>>2],o=A[e+24>>2],a=A[e+28>>2],r=A[e+32>>2],l<(s=x(x(x(o*A[t>>2])+x(a*A[t+4>>2]))+x(r*A[t+8>>2])))&&(A[e+20>>2]=s,i=c[t+4>>2],c[n>>2]=c[t>>2],c[n+4>>2]=i,u=c[4+(_=t+8|0)>>2],c[(i=n+8|0)>>2]=c[_>>2],c[i+4>>2]=u,l=s),l<(s=x(x(x(o*A[t+16>>2])+x(a*A[t+20>>2]))+x(r*A[t+24>>2])))?(A[e+20>>2]=s,_=c[4+(i=t+16|0)>>2],c[n>>2]=c[i>>2],c[n+4>>2]=_,u=c[4+(i=i+8|0)>>2],c[(_=n+8|0)>>2]=c[i>>2],c[_+4>>2]=u):s=l,s<(l=x(x(x(o*A[t+32>>2])+x(a*A[t+36>>2]))+x(r*A[t+40>>2])))&&(A[e+20>>2]=l,t=c[4+(e=t+32|0)>>2],c[n>>2]=c[e>>2],c[n+4>>2]=t,t=n+8|0,n=c[4+(e=e+8|0)>>2],c[t>>2]=c[e>>2],c[t+4>>2]=n)},Se,nt,Nt,function(e,t){var n=c[4+(t|=0)>>2];c[24+(e|=0)>>2]=c[t>>2],c[e+28>>2]=n,n=c[4+(t=t+8|0)>>2],c[(e=e+32|0)>>2]=c[t>>2],c[e+4>>2]=n},function(e){return 24+(e|=0)|0},function(){},function(){return 11568},Rt,Je,function(e,t,n,i){Qe(e|=0,t|=0,n|=0,i|=0)},function(e,t){e|=0,t|=0,x(0);var n,i,o,r;N=r=N-96|0,a[e+96|0]=1,n=A[t>>2],i=A[t+4>>2],o=A[t+8>>2],c[e+32>>2]=0,A[e+28>>2]=y(o),A[e+24>>2]=y(i),A[e+20>>2]=y(n),p[22256]||(c[5569]=0,c[5570]=0,c[5568]=1065353216,c[5571]=0,c[5572]=0,c[5574]=0,c[5575]=0,c[5573]=1065353216,c[5576]=0,c[5577]=0,c[5581]=0,c[5582]=0,c[5580]=-1082130432,c[5578]=1065353216,c[5579]=0,c[5583]=0,c[5584]=0,c[5586]=0,c[5587]=0,c[5585]=-1082130432,c[5588]=0,c[5589]=0,c[5590]=-1082130432,c[5591]=0,a[22256]=1),t=B(r,0,96),pi[c[c[e>>2]+76>>2]](e,22272,t,6),n=A[e+52>>2],A[e+80>>2]=n+A[t>>2],A[e+64>>2]=A[t+48>>2]-n,A[e+84>>2]=n+A[t+20>>2],A[e+68>>2]=A[t+68>>2]-n,A[e+88>>2]=n+A[t+40>>2],A[e+72>>2]=A[t+88>>2]-n,N=t+96|0},function(){return 11752},function(e){return c[100+(e|=0)>>2]},function(e){return(e=c[100+(e|=0)>>2]-2|0)>>>0<=2?c[11740+(e<<2)>>2]:0},function(e,t,n,i){t|=0,n|=0,i|=0;var o=0,a=0;e:{t:{n:{i:{o:{a:switch(c[100+(e|=0)>>2]-2|0){case 1:r:switch(0|t){case 1:break n;case 0:break i;case 2:break r;default:break o}break t;case 0:break i;case 2:break a;default:break o}a:switch(0|t){case 3:t=c[e+108>>2],c[n>>2]=c[e+104>>2],c[n+4>>2]=t,t=n+8|0,o=c[4+(n=e+112|0)>>2],c[t>>2]=c[n>>2],c[t+4>>2]=o;break e;case 4:a=c[4+(o=e+128|0)>>2],c[(t=n+8|0)>>2]=c[o>>2],c[t+4>>2]=a,o=c[4+(t=e+120|0)>>2],c[n>>2]=c[t>>2],c[n+4>>2]=o;break e;case 2:break t;case 1:break n;case 0:break i;case 5:break a;default:break o}a=c[4+(o=e+144|0)>>2],c[(t=n+8|0)>>2]=c[o>>2],c[t+4>>2]=a,o=c[4+(t=e+136|0)>>2],c[n>>2]=c[t>>2],c[n+4>>2]=o,o=c[4+(n=e+160|0)>>2],c[(t=i+8|0)>>2]=c[n>>2],c[t+4>>2]=o,t=c[4+(e=e+152|0)>>2],c[i>>2]=c[e>>2],c[i+4>>2]=t}return}return t=c[e+108>>2],c[n>>2]=c[e+104>>2],c[n+4>>2]=t,t=n+8|0,o=c[4+(n=e+112|0)>>2],c[t>>2]=c[n>>2],c[t+4>>2]=o,o=c[4+(n=e+128|0)>>2],c[(t=i+8|0)>>2]=c[n>>2],c[t+4>>2]=o,t=c[4+(e=e+120|0)>>2],c[i>>2]=c[e>>2],void(c[i+4>>2]=t)}return a=c[4+(o=e+128|0)>>2],c[(t=n+8|0)>>2]=c[o>>2],c[t+4>>2]=a,o=c[4+(t=e+120|0)>>2],c[n>>2]=c[t>>2],c[n+4>>2]=o,o=c[4+(n=e+144|0)>>2],c[(t=i+8|0)>>2]=c[n>>2],c[t+4>>2]=o,t=c[4+(e=e+136|0)>>2],c[i>>2]=c[e>>2],void(c[i+4>>2]=t)}return a=c[4+(o=e+144|0)>>2],c[(t=n+8|0)>>2]=c[o>>2],c[t+4>>2]=a,o=c[4+(t=e+136|0)>>2],c[n>>2]=c[t>>2],c[n+4>>2]=o,o=c[4+(n=e+112|0)>>2],c[(t=i+8|0)>>2]=c[n>>2],c[t+4>>2]=o,t=c[e+108>>2],c[i>>2]=c[e+104>>2],void(c[i+4>>2]=t)}o=c[4+(n=e+160|0)>>2],c[(t=i+8|0)>>2]=c[n>>2],c[t+4>>2]=o,t=c[4+(e=e+152|0)>>2],c[i>>2]=c[e>>2],c[i+4>>2]=t},function(e,t,n){var i,o=c[4+(t=112+(e=((t|=0)<<4)+(e|=0)|0)|0)>>2];c[(i=8+(n|=0)|0)>>2]=c[t>>2],c[4+i>>2]=o,t=c[4+(e=e+104|0)>>2],c[n>>2]=c[e>>2],c[n+4>>2]=t},function(e){return 0|(4==(0|(e=c[100+(e|=0)>>2]))?4:(3==(0|e))<<1)},Rt,Dt,function(){return 0},function(e){return c[(e|=0)>>2]=11796,0|e},function(e){c[(e|=0)>>2]=11796,c[5499]=c[5499]+1,z(c[e-4>>2])},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0,x(0);var o=A[t+56>>2],a=A[t+36>>2],r=A[t+40>>2],s=A[t+52>>2],l=A[t+20>>2],_=A[e+120>>2],u=A[e+28>>2],h=A[e+44>>2],f=A[t+24>>2],p=A[e+124>>2],d=A[e+32>>2],m=A[e+48>>2],v=A[t+32>>2],g=A[t+48>>2],b=A[t>>2],S=A[t+4>>2],C=A[t+8>>2],E=A[t+16>>2],T=A[e+116>>2],P=A[e+24>>2],w=A[e+40>>2],I=x(pi[c[c[e>>2]+48>>2]](e));t=x(pi[c[c[e>>2]+48>>2]](e)),e=x(pi[c[c[e>>2]+48>>2]](e)),c[n+12>>2]=0,T=x(x(T*x(w-P))*x(.5)),_=x(x(_*x(h-u))*x(.5)),u=x(x(T*x(y(E)))+x(_*x(y(l)))),l=x(x(p*x(m-d))*x(.5)),u=x(t+x(u+x(l*x(y(f))))),A[n+4>>2]=s-u,h=x(I+x(x(x(T*x(y(b)))+x(_*x(y(S))))+x(l*x(y(C))))),A[n>>2]=g-h,T=x(e+x(x(x(T*x(y(v)))+x(_*x(y(a))))+x(l*x(y(r))))),A[n+8>>2]=o-T,c[i+12>>2]=0,A[i+8>>2]=o+T,A[i+4>>2]=s+u,A[i>>2]=g+h},function(e,t){var n=c[4+(t|=0)>>2];c[116+(e|=0)>>2]=c[t>>2],c[e+120>>2]=n,n=c[4+(t=t+8|0)>>2],c[(e=e+124|0)>>2]=c[t>>2],c[e+4>>2]=n},function(e){return 116+(e|=0)|0},rt,function(){return 11880},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,a,r,s,l=x(0),_=x(0),u=x(0),h=0,f=0,d=0,m=0,v=0,g=0,b=0,S=0;N=s=N-48|0,_=A[e+48>>2],u=A[e+32>>2],o=x(x(1)/A[e+124>>2]),a=A[e- -64>>2],d=((l=_<(l=(l=x(x(o*A[i+8>>2])+a))<u?u:l)?_:l)<x(0)?-.5:.5)+ +l,g=1+(h=y(d)<2147483648?~~d:-2147483648)|0,d=((l=_<(l=(l=x(x(o*A[n+8>>2])+a))<u?u:l)?_:l)<x(0)?-.5:.5)+ +l,r=(h=y(d)<2147483648?~~d:-2147483648)-1|0,_=A[e+44>>2],u=A[e+28>>2],o=x(x(1)/A[e+120>>2]),a=A[e+60>>2],d=((l=_<(l=(l=x(x(o*A[i+4>>2])+a))<u?u:l)?_:l)<x(0)?-.5:.5)+ +l,b=1+(h=y(d)<2147483648?~~d:-2147483648)|0,d=((l=_<(l=(l=x(x(o*A[n+4>>2])+a))<u?u:l)?_:l)<x(0)?-.5:.5)+ +l,h=(h=y(d)<2147483648?~~d:-2147483648)-1|0,_=A[e+40>>2],u=A[e+24>>2],o=x(x(1)/A[e+116>>2]),a=A[e+56>>2],d=((l=_<(l=(l=x(x(o*A[i>>2])+a))<u?u:l)?_:l)<x(0)?-.5:.5)+ +l,i=1+(i=y(d)<2147483648?~~d:-2147483648)|0,d=((l=_<(l=(l=x(x(o*A[n>>2])+a))<u?u:l)?_:l)<x(0)?-.5:.5)+ +l,n=(n=y(d)<2147483648?~~d:-2147483648)-1|0,m=c[e+76>>2]-1|0,v=c[e+72>>2]-1|0;e:{t:switch(c[e+112>>2]){case 0:m=(0|g)<(0|m)?g:m,f=0<(0|r)?r:0,v=(0|b)<(0|v)?b:v,S=0<(0|h)?h:0;break e;case 1:m=(0|g)<(0|m)?g:m,f=0<(0|r)?r:0,v=(0|i)<(0|v)?i:v,S=0<(0|n)?n:0;break e;case 2:break t;default:break e}m=(0|b)<(0|m)?b:m,f=0<(0|h)?h:0,v=(0|i)<(0|v)?i:v,S=0<(0|n)?n:0}if((0|f)<(0|m))for(;;){if(g=m,(0|v)<=(0|S))n=f+1|0;else{for(b=1&f,o=x(0|(h=f+1|0)),a=x(0|f),n=S;;){e:{t:{if(!p[e+108|0]&&(n+f&1||!p[e+109|0])){if(b)break t;if(!p[e+110|0])break t}l=x(pi[c[c[e>>2]+68>>2]](e,n,f));n:{switch(c[e+112>>2]){default:_=A[4+s>>2],u=A[s>>2],l=A[8+s>>2];break n;case 0:c[12+s>>2]=0,u=x(l-A[e+56>>2]),_=x(x(0|n)-x(A[e+88>>2]*x(.5))),l=x(a-x(A[e+92>>2]*x(.5)));break n;case 1:c[12+s>>2]=0,_=x(l-A[e+60>>2]),u=x(x(0|n)-x(A[e+88>>2]*x(.5))),l=x(a-x(A[e+92>>2]*x(.5)));break n;case 2:}c[12+s>>2]=0,_=x(a-x(A[e+92>>2]*x(.5))),u=x(x(0|n)-x(A[e+88>>2]*x(.5))),l=x(l-A[e+64>>2])}A[s>>2]=u*A[e+116>>2],A[4+s>>2]=_*A[e+120>>2],A[8+s>>2]=l*A[e+124>>2],l=x(pi[c[c[e>>2]+68>>2]](e,n,h));n:{switch(c[e+112>>2]){default:_=A[20+s>>2],u=A[16+s>>2],l=A[24+s>>2];break n;case 0:c[28+s>>2]=0,u=x(l-A[e+56>>2]),_=x(x(0|n)-x(A[e+88>>2]*x(.5))),l=x(o-x(A[e+92>>2]*x(.5)));break n;case 1:c[28+s>>2]=0,_=x(l-A[e+60>>2]),u=x(x(0|n)-x(A[e+88>>2]*x(.5))),l=x(o-x(A[e+92>>2]*x(.5)));break n;case 2:}c[28+s>>2]=0,_=x(o-x(A[e+92>>2]*x(.5))),u=x(x(0|n)-x(A[e+88>>2]*x(.5))),l=x(l-A[e+64>>2])}A[16+s>>2]=u*A[e+116>>2],A[20+s>>2]=_*A[e+120>>2],A[24+s>>2]=l*A[e+124>>2],l=x(pi[c[c[e>>2]+68>>2]](e,i=n+1|0,h));n:{switch(c[e+112>>2]){default:_=A[36+s>>2],u=A[32+s>>2],l=A[40+s>>2];break n;case 0:c[44+s>>2]=0,u=x(l-A[e+56>>2]),_=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(o-x(A[e+92>>2]*x(.5)));break n;case 1:c[44+s>>2]=0,_=x(l-A[e+60>>2]),u=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(o-x(A[e+92>>2]*x(.5)));break n;case 2:}c[44+s>>2]=0,_=x(o-x(A[e+92>>2]*x(.5))),u=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(l-A[e+64>>2])}A[32+s>>2]=u*A[e+116>>2],A[36+s>>2]=_*A[e+120>>2],A[40+s>>2]=l*A[e+124>>2],pi[c[c[t>>2]+8>>2]](t,s,n,f),l=x(pi[c[c[e>>2]+68>>2]](e,i,h));n:{switch(c[e+112>>2]){default:_=A[20+s>>2],u=A[16+s>>2],l=A[24+s>>2];break n;case 0:c[28+s>>2]=0,u=x(l-A[e+56>>2]),_=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(o-x(A[e+92>>2]*x(.5)));break n;case 1:c[28+s>>2]=0,_=x(l-A[e+60>>2]),u=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(o-x(A[e+92>>2]*x(.5)));break n;case 2:}c[28+s>>2]=0,_=x(o-x(A[e+92>>2]*x(.5))),u=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(l-A[e+64>>2])}A[16+s>>2]=u*A[e+116>>2],A[20+s>>2]=_*A[e+120>>2],A[24+s>>2]=l*A[e+124>>2],l=x(pi[c[c[e>>2]+68>>2]](e,i,f));n:{switch(c[e+112>>2]){default:_=A[36+s>>2],u=A[32+s>>2],l=A[40+s>>2];break n;case 0:c[44+s>>2]=0,u=x(l-A[e+56>>2]),_=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(a-x(A[e+92>>2]*x(.5)));break n;case 1:c[44+s>>2]=0,_=x(l-A[e+60>>2]),u=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(a-x(A[e+92>>2]*x(.5)));break n;case 2:}c[44+s>>2]=0,_=x(a-x(A[e+92>>2]*x(.5))),u=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(l-A[e+64>>2])}break e}l=x(pi[c[c[e>>2]+68>>2]](e,n,f));t:{switch(c[e+112>>2]){default:_=A[4+s>>2],u=A[s>>2],l=A[8+s>>2];break t;case 0:c[12+s>>2]=0,u=x(l-A[e+56>>2]),_=x(x(0|n)-x(A[e+88>>2]*x(.5))),l=x(a-x(A[e+92>>2]*x(.5)));break t;case 1:c[12+s>>2]=0,_=x(l-A[e+60>>2]),u=x(x(0|n)-x(A[e+88>>2]*x(.5))),l=x(a-x(A[e+92>>2]*x(.5)));break t;case 2:}c[12+s>>2]=0,_=x(a-x(A[e+92>>2]*x(.5))),u=x(x(0|n)-x(A[e+88>>2]*x(.5))),l=x(l-A[e+64>>2])}A[s>>2]=u*A[e+116>>2],A[4+s>>2]=_*A[e+120>>2],A[8+s>>2]=l*A[e+124>>2],l=x(pi[c[c[e>>2]+68>>2]](e,n,h));t:{switch(c[e+112>>2]){default:_=A[20+s>>2],u=A[16+s>>2],l=A[24+s>>2];break t;case 0:c[28+s>>2]=0,u=x(l-A[e+56>>2]),_=x(x(0|n)-x(A[e+88>>2]*x(.5))),l=x(o-x(A[e+92>>2]*x(.5)));break t;case 1:c[28+s>>2]=0,_=x(l-A[e+60>>2]),u=x(x(0|n)-x(A[e+88>>2]*x(.5))),l=x(o-x(A[e+92>>2]*x(.5)));break t;case 2:}c[28+s>>2]=0,_=x(o-x(A[e+92>>2]*x(.5))),u=x(x(0|n)-x(A[e+88>>2]*x(.5))),l=x(l-A[e+64>>2])}A[16+s>>2]=u*A[e+116>>2],A[20+s>>2]=_*A[e+120>>2],A[24+s>>2]=l*A[e+124>>2],l=x(pi[c[c[e>>2]+68>>2]](e,i=n+1|0,f));t:{switch(c[e+112>>2]){default:_=A[36+s>>2],u=A[32+s>>2],l=A[40+s>>2];break t;case 0:c[44+s>>2]=0,u=x(l-A[e+56>>2]),_=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(a-x(A[e+92>>2]*x(.5)));break t;case 1:c[44+s>>2]=0,_=x(l-A[e+60>>2]),u=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(a-x(A[e+92>>2]*x(.5)));break t;case 2:}c[44+s>>2]=0,_=x(a-x(A[e+92>>2]*x(.5))),u=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(l-A[e+64>>2])}A[32+s>>2]=u*A[e+116>>2],A[36+s>>2]=_*A[e+120>>2],A[40+s>>2]=l*A[e+124>>2],pi[c[c[t>>2]+8>>2]](t,s,n,f),l=x(pi[c[c[e>>2]+68>>2]](e,i,f));t:{switch(c[e+112>>2]){default:_=A[4+s>>2],u=A[s>>2],l=A[8+s>>2];break t;case 0:c[12+s>>2]=0,u=x(l-A[e+56>>2]),_=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(a-x(A[e+92>>2]*x(.5)));break t;case 1:c[12+s>>2]=0,_=x(l-A[e+60>>2]),u=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(a-x(A[e+92>>2]*x(.5)));break t;case 2:}c[12+s>>2]=0,_=x(a-x(A[e+92>>2]*x(.5))),u=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(l-A[e+64>>2])}A[s>>2]=u*A[e+116>>2],A[4+s>>2]=_*A[e+120>>2],A[8+s>>2]=l*A[e+124>>2],l=x(pi[c[c[e>>2]+68>>2]](e,i,h));t:{switch(c[e+112>>2]){default:_=A[36+s>>2],u=A[32+s>>2],l=A[40+s>>2];break t;case 0:c[44+s>>2]=0,u=x(l-A[e+56>>2]),_=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(o-x(A[e+92>>2]*x(.5)));break t;case 1:c[44+s>>2]=0,_=x(l-A[e+60>>2]),u=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(o-x(A[e+92>>2]*x(.5)));break t;case 2:}c[44+s>>2]=0,_=x(o-x(A[e+92>>2]*x(.5))),u=x(x(0|i)-x(A[e+88>>2]*x(.5))),l=x(l-A[e+64>>2])}}if(A[32+s>>2]=u*A[e+116>>2],A[36+s>>2]=_*A[e+120>>2],A[40+s>>2]=l*A[e+124>>2],pi[c[c[t>>2]+8>>2]](t,s,n,f),(0|v)==(0|(n=i)))break}n=h}if((0|g)==(0|(f=n)))break}N=48+s|0},function(e,t,n){e|=0,t|=0,n|=0;var i=x(0);switch(c[e+104>>2]){case 0:return x(A[c[e+100>>2]+(g(c[e+72>>2],n)+t<<2)>>2]);case 5:return x(x(A[e+96>>2]*x(p[c[e+100>>2]+(g(c[e+72>>2],n)+t|0)|0])));case 3:i=x(A[e+96>>2]*x(s[c[e+100>>2]+(g(c[e+72>>2],n)+t<<1)>>1]))}return x(i)},nt,Nt,function(e,t,n){e|=0,t=x(t),n|=0,x(0);var i=x(pi[c[c[e>>2]+48>>2]](e));e=x(pi[c[c[e>>2]+48>>2]](e)),c[n+12>>2]=0,t=x(e*x(i*x(t*x(.4000000059604645)))),A[n+8>>2]=t,A[n+4>>2]=t,A[n>>2]=t},function(){return 11920},He,function(e){return x(x(A[36+(e|=0)>>2]*A[e+20>>2]))},function(e,t,n){e|=0,t|=0,n|=0;var i,o,a,r,s=x(0),l=x(0),_=x(0);N=r=N-16|0,pi[c[c[t>>2]+68>>2]](r,t,n),o=c[4+(a=8+r|0)>>2],c[(i=e+8|0)>>2]=c[a>>2],c[4+i>>2]=o,o=c[4+r>>2],c[e>>2]=c[r>>2],c[e+4>>2]=o,l=A[n+4>>2],s=A[n>>2],_=A[n+8>>2],o=x(pi[c[c[t>>2]+48>>2]](t)),n=s=(t=x(x(x(s*s)+x(l*l))+x(_*_))<x(14210854715202004e-30))?x(-1):s,_=t?x(-1):_,l=t?x(-1):l,s=x(x(1)/x(T(x(x(_*_)+x(x(s*s)+x(l*l)))))),A[e>>2]=A[e>>2]+x(o*x(n*s)),A[e+4>>2]=A[e+4>>2]+x(o*x(l*s)),A[i>>2]=A[i>>2]+x(o*x(_*s)),N=16+r|0},function(e){c[(e|=0)>>2]=0,c[e+4>>2]=0,c[(e=e+8|0)>>2]=0,c[e+4>>2]=0},function(e,t,n,i){1<=(0|(i|=0))&&B(n|=0,0,i<<4)},function(e){pt(e|=0),c[5499]=c[5499]+1,z(c[e-4>>2])},Se,ve,Gt,Se,ve,Ht,Se,ve,qe,qe,function(e,t,n,i){var o,r;e|=0,t|=0,n|=0,i=x(i),A[e+36>>2]>i&&(a[e+40|0]=1,o=c[t+4>>2],c[e+4>>2]=c[t>>2],c[e+8>>2]=o,r=c[4+(t=t+8|0)>>2],c[(o=e+12|0)>>2]=c[t>>2],c[4+o>>2]=r,t=c[n+4>>2],c[e+20>>2]=c[n>>2],c[e+24>>2]=t,o=c[4+(n=n+8|0)>>2],c[(t=e+28|0)>>2]=c[n>>2],c[t+4>>2]=o,A[e+36>>2]=i)},ve,function(e,t,n){t|=0,c[24+(e|=0)>>2]=n|=0,c[e+16>>2]=t},function(e,t,n){t|=0,c[28+(e|=0)>>2]=n|=0,c[e+20>>2]=t},function(e,t,n,i){e|=0,t|=0,n|=0,i=x(i);var o,a,r,s,l,_,u,h,f,p,d,m,v,b,E,P=0,w=0,I=x(0),R=x(0),D=x(0),O=x(0),M=x(0),z=x(0),L=x(0),F=0,B=0,U=0,G=0,j=x(0),V=x(0);N=E=N-208|0,B=c[e+4>>2];e:if(!((o=A[B+848>>2])<i)){if(M=A[n+8>>2],I=x(x(A[t+8>>2]*i)+M),a=A[n+4>>2],O=x(x(A[t+4>>2]*i)+a),r=A[n>>2],z=x(x(A[t>>2]*i)+r),U=c[e+8>>2],(G=(0|(P=c[U+8>>2]))==(0|(w=c[B+836>>2])))?(L=x(z-A[w+52>>2]),R=x(O-A[w+56>>2]),D=x(I-A[w+60>>2]),j=x(x(x(L*A[w+12>>2])+x(R*A[w+28>>2]))+x(D*A[w+44>>2])),V=x(x(x(L*A[w+8>>2])+x(R*A[w+24>>2]))+x(D*A[w+40>>2])),F=c[e+12>>2],P=c[F+8>>2]):(F=c[e+12>>2],w=c[F+8>>2],L=x(z-A[w+52>>2]),R=x(O-A[w+56>>2]),D=x(I-A[w+60>>2]),j=x(x(x(L*A[w+12>>2])+x(R*A[w+28>>2]))+x(D*A[w+44>>2])),V=x(x(x(L*A[w+8>>2])+x(R*A[w+24>>2]))+x(D*A[w+40>>2]))),L=x(x(x(L*A[w+4>>2])+x(R*A[w+20>>2]))+x(D*A[w+36>>2])),s=A[P+20>>2],l=A[P+36>>2],_=A[P+40>>2],u=A[P+8>>2],h=A[P+24>>2],f=A[P+44>>2],p=A[P+60>>2],R=A[P+12>>2],D=A[P+52>>2],d=A[P+28>>2],m=A[P+56>>2],v=A[P+4>>2],c[28+E>>2]=0,c[(P=92+E|0)>>2]=0,c[P+4>>2]=0,c[(P=124+E|0)>>2]=0,c[P+4>>2]=0,c[(P=132+E|0)>>2]=0,c[P+4>>2]=0,c[(P=140+E|0)>>2]=0,c[P+4>>2]=0,c[(P=148+E|0)>>2]=0,c[P+4>>2]=0,c[(P=156+E|0)>>2]=0,c[P+4>>2]=0,c[164+E>>2]=0,b=c[4+(w=t+8|0)>>2],c[(P=72+E|0)>>2]=c[w>>2],c[P+4>>2]=b,b=R,R=x(r-D),D=x(a-m),M=x(M-p),A[24+E>>2]=x(x(b*R)+x(d*D))+x(f*M),A[20+E>>2]=x(x(R*u)+x(D*h))+x(M*_),c[12+E>>2]=0,A[8+E>>2]=j,A[4+E>>2]=V,A[E>>2]=L,c[84+E>>2]=0,c[88+E>>2]=0,A[80+E>>2]=i,c[116+E>>2]=0,c[120+E>>2]=0,P=c[t+4>>2],c[64+E>>2]=c[t>>2],c[68+E>>2]=P,A[16+E>>2]=x(x(R*v)+x(D*s))+x(M*l),c[60+E>>2]=0,A[56+E>>2]=I,A[52+E>>2]=O,w=c[4+(P=n+8|0)>>2],c[(t=40+E|0)>>2]=c[P>>2],c[t+4>>2]=w,A[48+E>>2]=z,t=c[n+4>>2],c[32+E>>2]=c[n>>2],c[36+E>>2]=t,e=G?(w=e+28|0,t=e+24|0,n=e+20|0,G=e+16|0,P=(e=c[U>>2])||U,(e=c[F>>2])||F):(w=e+24|0,t=e+28|0,n=e+16|0,G=e+20|0,P=(e=c[F>>2])||F,(e=c[U>>2])||U),P=c[P+4>>2],e=c[e+4>>2],c[204+E>>2]=e,w=c[w>>2],c[112+E>>2]=w,t=c[t>>2],c[108+E>>2]=t,c[104+E>>2]=c[n>>2],c[100+E>>2]=c[G>>2],c[200+E>>2]=P,31==c[P+4>>2]&&(P=c[64+(c[P+32>>2]+g(t,80)|0)>>2],c[200+E>>2]=P),31==c[e+4>>2]&&(e=c[64+(c[e+32>>2]+g(w,80)|0)>>2],c[204+E>>2]=e),n=E,i=(t=c[P+16>>2])&&(e=c[e+16>>2])?(A[96+E>>2]=A[t>>2]*A[e>>2],i=A[t+4>>2],I=A[e+4>>2],A[84+E>>2]=S(x(C(x(i*I),x(-10))),x(10)),A[88+E>>2]=S(x(C(x(x(I*A[t+8>>2])+x(i*A[e+8>>2])),x(-10))),x(10)),x(S(x(C(x(x(I*A[t+12>>2])+x(i*A[e+12>>2])),x(-10))),x(10)))):(e=c[U+8>>2],t=c[F+8>>2],A[96+E>>2]=A[e+232>>2]*A[t+232>>2],i=A[e+228>>2],I=A[t+228>>2],A[84+E>>2]=S(x(C(x(i*I),x(-10))),x(10)),A[88+E>>2]=S(x(C(x(x(I*A[e+236>>2])+x(i*A[t+236>>2])),x(-10))),x(10)),x(S(x(C(x(x(I*A[e+240>>2])+x(i*A[t+240>>2])),x(-10))),x(10)))),A[n+92>>2]=i,i=A[72+E>>2],x(y(i))>x(.7071067690849304)?(O=A[68+E>>2],z=x(x(i*i)+x(O*O)),I=x(x(1)/x(T(z))),z=x(z*I),M=A[64+E>>2],R=x(I*x(-i)),D=x(M*R),i=x(O*I),O=x(i*x(-M)),M=x(0)):(z=A[64+E>>2],O=A[68+E>>2],R=x(x(z*z)+x(O*O)),I=x(x(1)/x(T(R))),D=x(R*I),M=x(I*x(-O)),O=x(i*M),R=x(z*I),z=x(R*x(-i)),i=x(0)),A[192+E>>2]=D,A[188+E>>2]=O,A[176+E>>2]=i,A[172+E>>2]=R,A[184+E>>2]=z,A[168+E>>2]=M,!((0|(n=c[B+844>>2]))<1)){for(P=B+12|0,i=x(o*o),e=0,w=-1;I=x(A[P-8>>2]-L),R=x(I*I),I=x(A[P-4>>2]-V),R=x(R+x(I*I)),I=x(A[P>>2]-j),i=(t=(I=x(R+x(I*I)))<i)?I:i,w=t?e:w,P=P+208|0,(0|n)!=(0|(e=e+1|0)););if(!((0|w)<0)){e=B+g(w,208)|0,P=c[(n=e+120|0)>>2],w=c[4+(t=e+136|0)>>2],F=c[t>>2],i=A[(B=e+144|0)>>2],G=c[(U=e+168|0)>>2],k(e+4|0,E,208),c[U>>2]=G,A[B>>2]=i,c[t>>2]=F,c[t+4>>2]=w,c[n>>2]=P;break e}}Ft(B,E)}N=208+E|0},Se,ve,function(e,t,n,i){var o;return e|=0,n|=0,i|=0,n=c[(t|=0)>>2],n=0|pi[c[c[n>>2]+56>>2]](n,72),a[n+60|0]=0,a[n+52|0]=0,c[n+36>>2]=0,c[n+40>>2]=0,i=c[e+12>>2],o=c[e+16>>2],c[n+4>>2]=c[t>>2],a[n+28|0]=1,c[n+8>>2]=c[e+8>>2],c[n>>2]=12600,c[n+24>>2]=0,a[n+48|0]=1,c[n+16>>2]=0,c[n+20>>2]=0,c[n+44>>2]=0,c[n+64>>2]=i,c[n+68>>2]=o,c[n+56>>2]=c[t+4>>2],0|n},function(e){var t,n=0;return c[(e|=0)>>2]=12600,p[e+52|0]&&(n=c[e+56>>2])&&(t=c[e+4>>2],pi[c[c[t>>2]+16>>2]](t,n)),(n=c[e+44>>2])&&p[e+48|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+44>>2]=0,a[e+48|0]=1,c[(n=e+36|0)>>2]=0,c[n+4>>2]=0,(n=c[e+24>>2])&&p[e+28|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+24>>2]=0,a[e+28|0]=1,c[(n=e+16|0)>>2]=0,(c[n+4>>2]=0)|e},function(e){var t,n=0;c[(e|=0)>>2]=12600,p[e+52|0]&&(n=c[e+56>>2])&&(t=c[e+4>>2],pi[c[c[t>>2]+16>>2]](t,n)),(n=c[e+44>>2])&&p[e+48|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+44>>2]=0,a[e+48|0]=1,c[(n=e+36|0)>>2]=0,c[n+4>>2]=0,(n=c[e+24>>2])&&p[e+28|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),V(e)},function(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var r,s,l,_,u,h,f,d,m,v,b,C,E,P,w,I,R,D,O,L,F,B,k,U,G,j,V=0,H=x(0),W=0,q=x(0),Y=x(0),X=0,Q=x(0),Z=0,J=0,K=0,$=0,ee=x(0),te=0,ne=x(0),ie=x(0),oe=x(0),ae=x(0),re=0,se=0,ce=0,le=0,_e=x(0),ue=x(0),he=x(0),de=0,me=x(0),Ae=x(0),ve=x(0),ge=x(0),xe=x(0),ye=x(0),be=x(0),Se=x(0),Ce=x(0),Ee=0,Te=x(0),Pe=x(0),we=x(0),Ie=0,Re=x(0),De=x(0),Ne=x(0),Oe=x(0),Me=x(0),Le=x(0),Fe=x(0),Be=x(0),ke=x(0),Ue=x(0),Ge=x(0),je=x(0),Ve=x(0);N=j=N-976|0,(X=c[e+56>>2])||(V=c[e+4>>2],X=0|pi[c[c[V>>2]+12>>2]](V,c[t+8>>2],c[n+8>>2]),a[e+52|0]=1,c[e+56>>2]=X),c[o+4>>2]=X,K=c[n+4>>2];e:{t:{n:{i:switch(re=c[t+4>>2],c[re+4>>2]-8|0){case 0:break n;case 2:break i;default:break t}i:switch(c[K+4>>2]-8|0){case 2:if(e=c[re+60>>2],H=A[(i=re+36|0)+(e<<2)>>2],Y=A[i+((e+2|0)%3<<2)>>2],i=c[K+60>>2],q=A[X+848>>2],(H=Wt(400+j|0,8+j|0,H,Y,A[(V=K+36|0)+(i<<2)>>2],A[V+((i+2|0)%3<<2)>>2],e,i,c[t+12>>2],c[n+12>>2],q))<q&&pi[c[c[o>>2]+16>>2]](o,400+j|0,8+j|0,H),e=c[o+4>>2],!c[e+844>>2])break e;if((0|(t=c[e+836>>2]))!=(0|(n=c[c[o+8>>2]+8>>2]))){Bt(e,c[c[o+12>>2]+8>>2]+4|0,n+4|0);break e}Bt(e,t+4|0,c[c[o+12>>2]+8>>2]+4|0);break e;case 0:break i;default:break t}if(e=c[re+60>>2],q=A[X+848>>2],(H=Wt(400+j|0,8+j|0,A[(i=re+36|0)+(e<<2)>>2],A[i+((e+2|0)%3<<2)>>2],x(0),x(A[K+36>>2]*A[K+20>>2]),e,1,c[t+12>>2],c[n+12>>2],q))<q&&pi[c[c[o>>2]+16>>2]](o,400+j|0,8+j|0,H),e=c[o+4>>2],!c[e+844>>2])break e;if((0|(t=c[e+836>>2]))!=(0|(n=c[c[o+8>>2]+8>>2]))){Bt(e,c[c[o+12>>2]+8>>2]+4|0,n+4|0);break e}Bt(e,t+4|0,c[c[o+12>>2]+8>>2]+4|0);break e}if(10==c[K+4>>2]){if(i=K+36|0,e=c[K+60>>2],q=A[X+848>>2],(H=Wt(400+j|0,8+j|0,x(0),x(A[re+36>>2]*A[re+20>>2]),A[i+(e<<2)>>2],A[i+((e+2|0)%3<<2)>>2],1,e,c[t+12>>2],c[n+12>>2],q))<q&&pi[c[c[o>>2]+16>>2]](o,400+j|0,8+j|0,H),e=c[o+4>>2],!c[e+844>>2])break e;if((0|(t=c[e+836>>2]))!=(0|(n=c[c[o+8>>2]+8>>2]))){Bt(e,c[c[o+12>>2]+8>>2]+4|0,n+4|0);break e}Bt(e,t+4|0,c[c[o+12>>2]+8>>2]+4|0);break e}}c[888+j>>2]=1566444395,a[732+j|0]=0,c[708+j>>2]=953267991,c[(V=332+j|0)>>2]=0,c[V+4>>2]=0,c[320+j>>2]=12272,c[352+j>>2]=K,c[348+j>>2]=re,c[324+j>>2]=0,c[328+j>>2]=1065353216,c[340+j>>2]=c[e+8>>2],c[356+j>>2]=c[re+4>>2],c[360+j>>2]=c[K+4>>2],c[344+j>>2]=400+j,U=j,G=x(pi[c[c[re>>2]+48>>2]](re)),A[364+U>>2]=G,H=x(pi[c[c[K>>2]+48>>2]](K)),c[392+j>>2]=1,c[396+j>>2]=1,c[380+j>>2]=-1,a[372+j|0]=0,A[368+j>>2]=H,c[352+j>>2]=K,c[348+j>>2]=re,H=x(x(x(x(pi[c[c[re>>2]+48>>2]](re))+x(pi[c[c[K>>2]+48>>2]](K)))+A[c[e+56>>2]+848>>2])+A[o+32>>2]),A[888+j>>2]=H*H,V=c[t+12>>2],Z=c[(X=V+8|0)>>2],X=c[X+4>>2],W=c[V>>2],J=c[V+4>>2],ce=c[4+(se=V+24|0)>>2],c[(te=784+j|0)>>2]=c[se>>2],c[te+4>>2]=ce,c[(te=768+j|0)>>2]=Z,c[te+4>>2]=X,X=c[V+16>>2],Z=c[V+20>>2],ce=c[4+(se=V+40|0)>>2],c[(te=800+j|0)>>2]=c[se>>2],c[te+4>>2]=ce,te=c[V+32>>2],se=c[V+36>>2],Ee=c[4+(le=V+56|0)>>2],c[(ce=816+j|0)>>2]=c[le>>2],c[ce+4>>2]=Ee,c[776+j>>2]=X,c[780+j>>2]=Z,c[760+j>>2]=W,c[764+j>>2]=J,c[792+j>>2]=te,c[796+j>>2]=se,X=c[V+52>>2],c[808+j>>2]=c[V+48>>2],c[812+j>>2]=X,V=c[n+12>>2],W=c[4+(Z=V+8|0)>>2],c[(X=832+j|0)>>2]=c[Z>>2],c[X+4>>2]=W,X=c[V+4>>2],c[824+j>>2]=c[V>>2],c[828+j>>2]=X,Z=c[V+20>>2],c[(X=J=840+j|0)>>2]=c[V+16>>2],c[X+4>>2]=Z,W=c[4+(Z=V+24|0)>>2],c[(X=848+j|0)>>2]=c[Z>>2],c[X+4>>2]=W,Z=c[V+36>>2],c[(X=te=856+j|0)>>2]=c[V+32>>2],c[X+4>>2]=Z,W=c[4+(Z=V+40|0)>>2],c[(X=864+j|0)>>2]=c[Z>>2],c[X+4>>2]=W,Z=c[V+52>>2],c[(X=se=872+j|0)>>2]=c[V+48>>2],c[X+4>>2]=Z,Z=c[4+(V=V+56|0)>>2],c[(X=880+j|0)>>2]=c[V>>2],c[X+4>>2]=Z;t:{n:{i:{if(!(6<(0|(X=c[re+4>>2])))&&!(6<(0|(V=c[K+4>>2])))&&(c[312+j>>2]=12708,H=x(0),X&&(q=x(pi[c[c[re>>2]+48>>2]](re)),V=c[K+4>>2]),V&&(H=x(pi[c[c[K>>2]+48>>2]](K))),a[44+j|0]=0,A[36+j>>2]=H,A[32+j>>2]=q,c[12+j>>2]=o,c[8+j>>2]=12736,ce=c[re+60>>2])){if(le=c[K+60>>2]){if(Ve=A[c[e+56>>2]+848>>2],p[i+24|0]){if(c[5606]=c[5606]+1,Y=A[ce+64>>2],W=c[t+12>>2],H=A[W+32>>2],ee=A[ce+68>>2],q=A[W+36>>2],oe=A[ce+72>>2],Q=A[W+40>>2],ne=A[le+64>>2],J=c[n+12>>2],_e=A[le+68>>2],ie=A[le+72>>2],Le=x(x(x(x(x(Y*H)+x(ee*q))+x(oe*Q))+A[W+56>>2])-x(x(x(x(ne*A[J+32>>2])+x(_e*A[J+36>>2]))+x(ie*A[J+40>>2]))+A[J+56>>2])),ae=A[W+16>>2],be=A[W+20>>2],Se=A[W+24>>2],Fe=x(x(x(x(x(Y*ae)+x(ee*be))+x(oe*Se))+A[W+52>>2])-x(x(x(x(ne*A[J+16>>2])+x(_e*A[J+20>>2]))+x(ie*A[J+24>>2]))+A[J+52>>2])),Ce=A[W+4>>2],ue=A[W+8>>2],Be=x(x(x(x(x(Y*A[W>>2])+x(ee*Ce))+x(oe*ue))+A[W+48>>2])-x(x(x(x(ne*A[J>>2])+x(_e*A[J+4>>2]))+x(ie*A[J+8>>2]))+A[J+48>>2])),(0|(i=c[ce+28>>2]))<1){ee=x(34028234663852886e22);break i}for(i=i-1|0,ee=x(34028234663852886e22),se=28;;){if(V=c[ce+36>>2]+se|0,Y=A[V>>2],oe=A[V-8>>2],ne=A[V-4>>2],c[908+j>>2]=0,H=x(x(x(oe*H)+x(ne*q))+x(Y*Q)),A[904+j>>2]=H,q=x(x(x(oe*ae)+x(ne*be))+x(Y*Se)),A[900+j>>2]=q,Y=x(x(x(oe*A[W>>2])+x(ne*Ce))+x(Y*ue)),A[896+j>>2]=Y,x(x(x(Y*Be)+x(q*Fe))+x(H*Le))<x(0)&&(H=x(-H),A[904+j>>2]=H,q=x(-q),A[900+j>>2]=q,Y=x(-Y),A[896+j>>2]=Y),c[5607]=c[5607]+1,jt(W,J,Be,Fe,Le,Y,q,H,ce,le,ee)){if(te=0,c[5608]=c[5608]+1,ze(ce,W,896+j|0,972+j|0,968+j|0,248+j|0,944+j|0),ze(le,J,896+j|0,964+j|0,960+j|0,928+j|0,912+j|0),(ae=A[968+j>>2])<(oe=A[964+j>>2])||(Q=A[960+j>>2])<(ne=A[972+j>>2])||(te=1,ie=x(Q-ne),(ae=x(ae-oe))<ie&&(ie=ae)),!te)break t;ie<ee&&(he=H,me=q,ve=Y,ee=ie)}if(!i)break i;se=se+36|0,i=i-1|0,Ce=A[W+4>>2],Q=A[W+40>>2],q=A[W+36>>2],H=A[W+32>>2],Se=A[W+24>>2],be=A[W+20>>2],ae=A[W+16>>2],ue=A[W+8>>2]}}if(Gt(320+j|0,760+j|0,8+j|0,c[i+20>>2],0),!((q=A[40+j>>2])<x(0)))break t;if(!p[44+j|0])break t;H=A[28+j>>2],he=A[24+j>>2],me=A[20+j>>2],ve=A[16+j>>2];break n}if(1==c[K+4>>2]){if(c[252+j>>2]=0,V=c[n+12>>2],Q=A[V+52>>2],ee=A[V+20>>2],ie=A[V+24>>2],he=A[V+56>>2],H=A[K- -64>>2],q=A[K+68>>2],me=A[V+36>>2],Y=A[K+72>>2],ve=A[V+40>>2],ge=A[V+48>>2],ae=A[V+8>>2],oe=A[V>>2],ne=A[V+4>>2],_e=A[V+16>>2],be=A[V+32>>2],c[5498]=c[5498]+1,X=0,(V=M(35))&&(c[(X=V+19&-16)-4>>2]=V),c[256+j>>2]=1,c[260+j>>2]=X,a[264+j|0]=1,A[X+4>>2]=Q+x(x(x(H*_e)+x(q*ee))+x(Y*ie)),A[X>>2]=ge+x(x(x(H*oe)+x(q*ne))+x(Y*ae)),c[X+12>>2]=0,A[X+8>>2]=he+x(x(x(H*be)+x(q*me))+x(Y*ve)),X=c[252+j>>2],c[252+j>>2]=Z=X+1|0,H=A[K+80>>2],V=c[n+12>>2],q=A[K+84>>2],Y=A[K+88>>2],Q=x(x(x(x(H*A[V>>2])+x(q*A[V+4>>2]))+x(Y*A[V+8>>2]))+A[V+48>>2]),ee=x(x(x(x(H*A[V+32>>2])+x(q*A[V+36>>2]))+x(Y*A[V+40>>2]))+A[V+56>>2]),H=x(x(x(x(H*A[V+16>>2])+x(q*A[V+20>>2]))+x(Y*A[V+24>>2]))+A[V+52>>2]),(0|Z)==(0|(V=c[256+j>>2]))&&!((0|(W=(V=Z)?V<<1:1))<=(0|V))){if(te=0,W&&(c[5498]=c[5498]+1,(V=M(19+(W<<4)|0))&&(c[(te=V+19&-16)-4>>2]=V)),0<=(0|X))for(V=X+1|0,X=0;Z=c[260+j>>2]+X|0,ce=c[Z+4>>2],c[(J=X+te|0)>>2]=c[Z>>2],c[J+4>>2]=ce,se=c[4+(Z=Z+8|0)>>2],c[(J=J+8|0)>>2]=c[Z>>2],c[J+4>>2]=se,X=X+16|0,V=V-1|0;);(V=c[260+j>>2])&&p[264+j|0]&&(c[5499]=c[5499]+1,z(c[V-4>>2])),c[260+j>>2]=te,a[264+j|0]=1,c[256+j>>2]=W,Z=c[252+j>>2],V=W}if(J=c[260+j>>2],c[12+(X=J+(Z<<4)|0)>>2]=0,A[X+8>>2]=ee,A[X+4>>2]=H,A[X>>2]=Q,c[252+j>>2]=Z=Z+1|0,H=A[K+96>>2],n=c[n+12>>2],q=A[K+100>>2],Y=A[K+104>>2],Q=x(x(x(x(H*A[n>>2])+x(q*A[n+4>>2]))+x(Y*A[n+8>>2]))+A[n+48>>2]),ee=x(x(x(x(H*A[n+32>>2])+x(q*A[n+36>>2]))+x(Y*A[n+40>>2]))+A[n+56>>2]),H=x(x(x(x(H*A[n+16>>2])+x(q*A[n+20>>2]))+x(Y*A[n+24>>2]))+A[n+52>>2]),(0|V)==(0|Z))if((0|(n=V?V<<1:1))<=(0|V))Z=V;else{if(J=0,n&&(c[5498]=c[5498]+1,(X=M(19+(n<<4)|0))&&(c[(J=X+19&-16)-4>>2]=X)),1<=(0|V))for(X=0;Z=c[260+j>>2]+X|0,se=c[Z+4>>2],c[(W=X+J|0)>>2]=c[Z>>2],c[W+4>>2]=se,te=c[4+(Z=Z+8|0)>>2],c[(W=W+8|0)>>2]=c[Z>>2],c[W+4>>2]=te,X=X+16|0,V=V-1|0;);(V=c[260+j>>2])&&p[264+j|0]&&(c[5499]=c[5499]+1,z(c[V-4>>2])),c[260+j>>2]=J,a[264+j|0]=1,c[256+j>>2]=n,Z=c[252+j>>2]}if(c[12+(n=(Z<<4)+J|0)>>2]=0,A[n+8>>2]=ee,A[n+4>>2]=H,A[n>>2]=Q,c[252+j>>2]=c[252+j>>2]+1,H=A[c[e+56>>2]+848>>2],Gt(320+j|0,760+j|0,312+j|0,c[i+20>>2],0),q=A[324+j>>2],Y=A[328+j>>2],Q=A[332+j>>2],(ee=x(x(x(q*q)+x(Y*Y))+x(Q*Q)))>x(1.1920928955078125e-7)){if(c[956+j>>2]=0,ie=Q,Q=x(x(1)/ee),A[952+j>>2]=ie*Q,A[948+j>>2]=Y*Q,A[944+j>>2]=q*Q,q=x(x(A[376+j>>2]-x(pi[c[c[re>>2]+48>>2]](re)))-x(pi[c[c[K>>2]+48>>2]](K))),(0|(X=c[e+36>>2]))<=-1)for(c[e+40>>2]<=-1&&((n=c[e+44>>2])&&p[e+48|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+40>>2]=0,c[e+44>>2]=0,a[e+48|0]=1),W=X<<4;V=c[932+j>>2],n=c[e+44>>2]+W|0,c[n>>2]=c[928+j>>2],c[n+4>>2]=V,V=c[4+(i=936+j|0)>>2],c[(n=n+8|0)>>2]=c[i>>2],c[n+4>>2]=V,W=W+16|0,(n=X)>>>0<=(X=X+1|0)>>>0;);Vt(944+j|(c[e+36>>2]=0),c[re+60>>2],c[t+12>>2],248+j|0,e+32|0,x(q-H),H,o)}if(p[e+52|0]&&(e=c[o+4>>2],c[e+844>>2]&&((0|(t=c[e+836>>2]))==(0|(n=c[c[o+8>>2]+8>>2]))?Bt(e,t+4|0,c[c[o+12>>2]+8>>2]+4|0):Bt(e,c[c[o+12>>2]+8>>2]+4|0,n+4|0))),!(e=c[260+j>>2]))break e;if(!p[264+j|0])break e;c[5499]=c[5499]+1,z(c[e-4>>2]);break e}}if(Gt(320+j|0,760+j|0,o,c[i+20>>2],0),c[e+64>>2]&&!(c[c[o+4>>2]+844>>2]>=c[e+68>>2])&&(H=A[324+j>>2],q=A[328+j>>2],Y=A[332+j>>2],(Q=x(x(x(H*H)+x(q*q))+x(Y*Y)))>x(1.1920928955078125e-7)&&(ie=q,q=x(x(1)/Q),ie=x(ie*q),ge=x(H*q),ae=x(Y*q),x(y(ae))>x(.7071067690849304)?(q=x(x(1)/x(T(x(x(ae*ae)+x(ie*ie))))),H=x(ie*q),q=x(q*x(-ae)),Y=x(0)):(H=x(x(1)/x(T(x(x(ge*ge)+x(ie*ie))))),q=x(ge*H),Y=x(H*x(-ie)),H=x(0)),Ie=824+j|0,ce=808+j|0,le=792+j|0,Ee=776+j|0,s=272+j|0,V=(h=(Q=x(pi[c[c[re>>2]+16>>2]](re)))<(ee=x(pi[c[c[K>>2]+16>>2]](K))))?(Z=c[4+(X=768+j|0)>>2],c[(V=256+j|0)>>2]=c[X>>2],c[V+4>>2]=Z,V=c[764+j>>2],c[248+j>>2]=c[760+j>>2],c[252+j>>2]=V,ee=x(S(x(x(.019999999552965164)/Q),x(.39269909262657166))),Z=248+j|0,W=le,X=Ee,ce):(Z=c[4+(X=Ie+8|0)>>2],c[(V=256+j|0)>>2]=c[X>>2],c[V+4>>2]=Z,V=c[Ie+4>>2],c[248+j>>2]=c[Ie>>2],c[252+j>>2]=V,ee=x(S(x(x(.019999999552965164)/ee),x(.39269909262657166))),Z=248+j|0,W=te,X=J,se),re=c[4+(K=X+8|0)>>2],c[s>>2]=c[K>>2],c[4+s>>2]=re,s=c[4+(re=W+8|0)>>2],c[(K=288+j|0)>>2]=c[re>>2],c[K+4>>2]=s,s=c[4+(re=V+8|0)>>2],c[(K=304+j|0)>>2]=c[re>>2],c[K+4>>2]=s,K=c[X+4>>2],c[264+j>>2]=c[X>>2],c[268+j>>2]=K,X=c[W+4>>2],c[280+j>>2]=c[W>>2],c[284+j>>2]=X,X=c[V+4>>2],c[296+j>>2]=c[V>>2],c[300+j>>2]=X,!((0|(W=c[e+64>>2]))<1))))for(K=296+j|0,re=280+j|0,s=264+j|0,he=H,Q=x(ee*x(.5)),Ge=x(x(x(Y*Y)+x(q*q))+x(H*H)),H=x(fe(Q)/x(T(Ge))),ee=x(he*H),he=x(q*H),me=x(Y*H),je=x(T(x(x(ae*ae)+x(x(ge*ge)+x(ie*ie))))),f=224+j|0,d=208+j|0,m=192+j|0,v=176+j|0,b=160+j|0,C=144+j|0,E=128+j|0,P=112+j|0,w=96+j|0,I=80+j|0,R=j+64|0,D=48+j|0,ve=pe(Q),X=0;Ge>x(1.1920928955078125e-7)&&(Q=x(x(x(x(6.2831854820251465)/x(0|W))*x(0|X))*x(.5)),Y=x(fe(Q)/je),H=x(ae*Y),q=x(ie*Y),Y=x(ge*Y),Q=pe(Q),h?(V=c[t+12>>2],_e=A[V>>2],be=A[V+4>>2],Se=A[V+8>>2],c[772+j>>2]=0,Ce=A[V+36>>2],Re=A[V+20>>2],De=A[V+40>>2],Ne=A[V+24>>2],Oe=A[V+32>>2],Me=A[V+16>>2],c[804+j>>2]=0,c[788+j>>2]=0,xe=x(x(ee*Y)+x(x(x(he*Q)-x(ve*q))-x(me*H))),ue=x(x(ee*H)+x(x(he*q)+x(x(ve*Q)+x(me*Y)))),ye=x(x(he*H)+x(x(x(me*Q)-x(ve*Y))-x(ee*q))),Ae=x(x(me*q)+x(x(x(ee*Q)-x(ve*H))-x(he*Y))),oe=x(x(x(H*xe)+x(x(Y*ue)+x(Q*ye)))-x(q*Ae)),ne=x(x(x(x(Q*ue)-x(Y*ye))-x(q*xe))-x(H*Ae)),Pe=x(x(x(q*ye)+x(x(H*ue)+x(Q*Ae)))-x(Y*xe)),H=x(x(x(Y*Ae)+x(x(Q*xe)+x(q*ue)))-x(H*ye)),q=x(x(2)/x(x(ne*ne)+x(x(Pe*Pe)+x(x(oe*oe)+x(H*H))))),Y=x(Pe*q),ue=x(oe*Y),Q=x(H*q),ye=x(ne*Q),xe=x(ue-ye),Ae=x(H*Y),Te=x(oe*q),ke=x(ne*Te),q=x(Ae+ke),Te=x(oe*Te),Ue=x(H*Q),H=x(x(1)-x(Te+Ue)),A[800+j>>2]=x(x(Se*xe)+x(Ne*q))+x(De*H),A[796+j>>2]=x(x(xe*be)+x(q*Re))+x(H*Ce),A[792+j>>2]=x(x(xe*_e)+x(q*Me))+x(H*Oe),Q=x(oe*Q),oe=x(ne*Y),H=x(Q+oe),ne=x(Pe*Y),q=x(x(1)-x(Te+ne)),Y=x(Ae-ke),A[784+j>>2]=x(x(Se*H)+x(Ne*q))+x(De*Y),A[780+j>>2]=x(x(H*be)+x(q*Re))+x(Y*Ce),A[776+j>>2]=x(x(H*_e)+x(q*Me))+x(Y*Oe),H=x(x(1)-x(Ue+ne)),q=x(Q-oe),Y=x(ue+ye),A[768+j>>2]=x(x(Se*H)+x(Ne*q))+x(De*Y),A[764+j>>2]=x(x(H*be)+x(q*Re))+x(Y*Ce),A[760+j>>2]=x(x(H*_e)+x(q*Me))+x(Y*Oe),V=c[n+12>>2],$=c[V+4>>2],c[Ie>>2]=c[V>>2],c[Ie+4>>2]=$,de=c[4+(W=V+8|0)>>2],c[($=Ie+8|0)>>2]=c[W>>2],c[$+4>>2]=de,de=c[4+($=V+24|0)>>2],c[(W=J+8|0)>>2]=c[$>>2],c[W+4>>2]=de,W=c[V+20>>2],c[J>>2]=c[V+16>>2],c[J+4>>2]=W,de=c[4+($=V+40|0)>>2],c[(W=te+8|0)>>2]=c[$>>2],c[W+4>>2]=de,W=c[V+36>>2],c[te>>2]=c[V+32>>2],c[te+4>>2]=W,de=c[4+($=V+56|0)>>2],c[(W=se+8|0)>>2]=c[$>>2],c[W+4>>2]=de,W=c[V+52>>2],c[se>>2]=c[V+48>>2],c[se+4>>2]=W):(V=c[t+12>>2],$=c[(W=V+8|0)>>2],W=c[W+4>>2],de=c[V>>2],L=c[V+4>>2],r=c[V+20>>2],c[Ee>>2]=c[V+16>>2],c[Ee+4>>2]=r,F=c[4+(O=V+24|0)>>2],c[(r=Ee+8|0)>>2]=c[O>>2],c[4+r>>2]=F,c[(r=768+j|0)>>2]=$,c[4+r>>2]=W,W=c[V+36>>2],c[le>>2]=c[V+32>>2],c[le+4>>2]=W,r=c[4+($=V+40|0)>>2],c[(W=le+8|0)>>2]=c[$>>2],c[W+4>>2]=r,r=c[4+($=V+56|0)>>2],c[(W=ce+8|0)>>2]=c[$>>2],c[W+4>>2]=r,W=c[V+52>>2],c[ce>>2]=c[V+48>>2],c[ce+4>>2]=W,c[760+j>>2]=de,c[764+j>>2]=L,V=c[n+12>>2],_e=A[V+36>>2],be=A[V+20>>2],Se=A[V+40>>2],Ce=A[V+24>>2],Re=A[V+32>>2],De=A[V>>2],Ne=A[V+16>>2],Oe=A[V+4>>2],Me=A[V+8>>2],c[868+j>>2]=0,c[852+j>>2]=0,c[836+j>>2]=0,xe=x(x(ee*Y)+x(x(x(he*Q)-x(ve*q))-x(me*H))),ue=x(x(ee*H)+x(x(he*q)+x(x(ve*Q)+x(me*Y)))),ye=x(x(he*H)+x(x(x(me*Q)-x(ve*Y))-x(ee*q))),Ae=x(x(me*q)+x(x(x(ee*Q)-x(ve*H))-x(he*Y))),oe=x(x(x(H*xe)+x(x(Y*ue)+x(Q*ye)))-x(q*Ae)),ne=x(x(x(x(Q*ue)-x(Y*ye))-x(q*xe))-x(H*Ae)),Pe=x(x(x(q*ye)+x(x(H*ue)+x(Q*Ae)))-x(Y*xe)),H=x(x(x(Y*Ae)+x(x(Q*xe)+x(q*ue)))-x(H*ye)),q=x(x(2)/x(x(ne*ne)+x(x(Pe*Pe)+x(x(oe*oe)+x(H*H))))),Y=x(Pe*q),ue=x(oe*Y),Q=x(H*q),ye=x(ne*Q),xe=x(ue-ye),Ae=x(H*Y),Te=x(oe*q),ke=x(ne*Te),q=x(Ae+ke),Te=x(oe*Te),Ue=x(H*Q),H=x(x(1)-x(Te+Ue)),A[864+j>>2]=x(x(Me*xe)+x(Ce*q))+x(Se*H),A[860+j>>2]=x(x(xe*Oe)+x(q*be))+x(H*_e),A[856+j>>2]=x(x(xe*De)+x(q*Ne))+x(H*Re),Q=x(oe*Q),oe=x(ne*Y),H=x(Q+oe),ne=x(Pe*Y),q=x(x(1)-x(Te+ne)),Y=x(Ae-ke),A[848+j>>2]=x(x(Me*H)+x(Ce*q))+x(Se*Y),A[844+j>>2]=x(x(H*Oe)+x(q*be))+x(Y*_e),A[840+j>>2]=x(x(H*De)+x(q*Ne))+x(Y*Re),H=x(x(1)-x(Ue+ne)),q=x(Q-oe),Y=x(ue+ye),A[832+j>>2]=x(x(Me*H)+x(Ce*q))+x(Se*Y),A[828+j>>2]=x(x(H*Oe)+x(q*be))+x(Y*_e),A[824+j>>2]=x(x(H*De)+x(q*Ne))+x(Y*Re)),V=c[764+j>>2],c[D>>2]=c[760+j>>2],c[4+D>>2]=V,V=c[Ee+4>>2],c[R>>2]=c[Ee>>2],c[4+R>>2]=V,V=c[le+4>>2],c[I>>2]=c[le>>2],c[4+I>>2]=V,V=c[ce+4>>2],c[w>>2]=c[ce>>2],c[4+w>>2]=V,$=c[4+(W=768+j|0)>>2],c[(V=8+D|0)>>2]=c[W>>2],c[V+4>>2]=$,$=c[4+(W=Ee+8|0)>>2],c[(V=8+R|0)>>2]=c[W>>2],c[V+4>>2]=$,$=c[4+(W=le+8|0)>>2],c[(V=8+I|0)>>2]=c[W>>2],c[V+4>>2]=$,$=c[4+(W=ce+8|0)>>2],c[(V=8+w|0)>>2]=c[W>>2],c[V+4>>2]=$,c[40+j>>2]=0,c[44+j>>2]=o,c[8+j>>2]=12764,V=c[i+20>>2],de=c[4+($=Ie+8|0)>>2],c[(W=8+P|0)>>2]=c[$>>2],c[W+4>>2]=de,W=c[Ie+4>>2],c[P>>2]=c[Ie>>2],c[4+P>>2]=W,de=c[4+($=J+8|0)>>2],c[(W=8+E|0)>>2]=c[$>>2],c[W+4>>2]=de,W=c[J+4>>2],c[E>>2]=c[J>>2],c[4+E>>2]=W,de=c[4+($=te+8|0)>>2],c[(W=8+C|0)>>2]=c[$>>2],c[W+4>>2]=de,W=c[te+4>>2],c[C>>2]=c[te>>2],c[4+C>>2]=W,de=c[4+($=se+8|0)>>2],c[(W=8+b|0)>>2]=c[$>>2],c[W+4>>2]=de,W=c[se+4>>2],c[b>>2]=c[se>>2],c[4+b>>2]=W,de=c[4+($=Z+8|0)>>2],c[(W=8+v|0)>>2]=c[$>>2],c[W+4>>2]=de,W=c[Z+4>>2],c[v>>2]=c[Z>>2],c[4+v>>2]=W,de=c[4+($=8+s|0)>>2],c[(W=8+m|0)>>2]=c[$>>2],c[W+4>>2]=de,W=c[4+s>>2],c[m>>2]=c[s>>2],c[4+m>>2]=W,de=c[4+($=re+8|0)>>2],c[(W=8+d|0)>>2]=c[$>>2],c[W+4>>2]=de,W=c[re+4>>2],c[d>>2]=c[re>>2],c[4+d>>2]=W,de=c[4+($=K+8|0)>>2],c[(W=8+f|0)>>2]=c[$>>2],c[W+4>>2]=de,W=c[K+4>>2],c[f>>2]=c[K>>2],c[4+f>>2]=W,c[244+j>>2]=V,a[240+j|0]=h,Gt(320+j|0,760+j|0,8+j|0,V,0),W=c[e+64>>2]),(0|(X=X+1|0))<(0|W););if(!p[e+52|0])break e;if(e=c[o+4>>2],!c[e+844>>2])break e;if((0|(t=c[e+836>>2]))!=(0|(n=c[c[o+8>>2]+8>>2]))){Bt(e,c[c[o+12>>2]+8>>2]+4|0,n+4|0);break e}Bt(e,t+4|0,c[c[o+12>>2]+8>>2]+4|0);break e}if(1<=(0|(i=c[le+28>>2])))for(te=28;;){if(V=c[le+36>>2]+te|0,Y=A[V>>2],ie=A[V-8>>2],ae=A[V-4>>2],c[908+j>>2]=0,H=x(x(x(ie*A[J+32>>2])+x(ae*A[J+36>>2]))+x(Y*A[J+40>>2])),A[904+j>>2]=H,q=x(x(x(ie*A[J+16>>2])+x(ae*A[J+20>>2]))+x(Y*A[J+24>>2])),A[900+j>>2]=q,Y=x(x(x(ie*A[J>>2])+x(ae*A[J+4>>2]))+x(Y*A[J+8>>2])),A[896+j>>2]=Y,x(x(x(Y*Be)+x(q*Fe))+x(H*Le))<x(0)&&(H=x(-H),A[904+j>>2]=H,q=x(-q),A[900+j>>2]=q,Y=x(-Y),A[896+j>>2]=Y),c[5607]=c[5607]+1,jt(W,J,Be,Fe,Le,Y,q,H,ce,le,ee)){if(se=0,c[5608]=c[5608]+1,ze(ce,W,896+j|0,972+j|0,968+j|0,248+j|0,944+j|0),ze(le,J,896+j|0,964+j|0,960+j|0,928+j|0,912+j|0),(ie=A[968+j>>2])<(ae=A[964+j>>2])||(oe=A[960+j>>2])<(ne=A[972+j>>2])||(se=1,Q=x(oe-ne),(ie=x(ie-ae))<Q&&(Q=ie)),!se)break t;Q<ee&&(he=H,me=q,ve=Y,ee=Q)}if(te=te+36|0,!(i=i-1|0))break}if((0|(te=c[ce+48>>2]))<1)Z=-1,Q=x(0),ie=x(0),oe=x(0),ne=x(0),_e=x(0),ae=x(0),V=-1;else for(se=c[le+48>>2],Z=V=-1,ae=x(X=0),_e=x(0),ne=x(0),oe=x(0),ie=x(0),Q=x(0);;){if(1<=(0|se)){for(i=c[ce+56>>2]+(X<<4)|0,H=A[i>>2],q=A[i+4>>2],Y=A[i+8>>2],be=x(x(x(H*A[W+32>>2])+x(q*A[W+36>>2]))+x(Y*A[W+40>>2])),Se=x(x(x(H*A[W+16>>2])+x(q*A[W+20>>2]))+x(Y*A[W+24>>2])),Ce=x(x(x(H*A[W>>2])+x(q*A[W+4>>2]))+x(Y*A[W+8>>2])),i=0,te=8;;){if(Ee=c[le+56>>2]+te|0,q=A[Ee>>2],Y=A[Ee-8>>2],Ae=A[Ee-4>>2],we=A[J+40>>2],l=A[J+32>>2],_=A[J+36>>2],H=A[J+24>>2],ue=A[J+16>>2],ye=A[J+20>>2],u=A[J+8>>2],B=A[J>>2],k=A[J+4>>2],c[908+j>>2]=0,ue=x(x(x(Y*ue)+x(Ae*ye))+x(q*H)),ye=x(x(x(Y*B)+x(Ae*k))+x(q*u)),H=x(x(Ce*ue)-x(Se*ye)),Ae=x(x(x(Y*l)+x(Ae*_))+x(q*we)),Y=x(x(be*ye)-x(Ce*Ae)),we=x(x(Se*Ae)-x(be*ue)),(1e-6<+x(y(we))||1e-6<+x(y(Y))||1e-6<+x(y(H)))&&(l=x(x(1)/x(T(x(x(H*H)+x(x(we*we)+x(Y*Y)))))),q=x(H*l),A[904+j>>2]=q,H=x(Y*l),A[900+j>>2]=H,Y=x(we*l),A[896+j>>2]=Y,x(x(x(Y*Be)+x(H*Fe))+x(Le*q))<x(0)&&(q=x(-q),A[904+j>>2]=q,H=x(-H),A[900+j>>2]=H,Y=x(-Y),A[896+j>>2]=Y),c[5607]=c[5607]+1,jt(W,J,Be,Fe,Le,Y,H,q,ce,le,ee))){if(se=0,c[5608]=c[5608]+1,ze(ce,W,896+j|0,972+j|0,968+j|0,248+j|0,944+j|0),ze(le,J,896+j|0,964+j|0,960+j|0,928+j|0,912+j|0),(we=A[968+j>>2])<(l=A[964+j>>2])||(_=A[960+j>>2])<(u=A[972+j>>2])||((ge=x(we-l))<(we=x(_-u))?(se=1,Pe=A[936+j>>2],Ge=A[932+j>>2],je=A[928+j>>2],Te=A[952+j>>2],ke=A[948+j>>2],Ue=A[944+j>>2]):(se=1,Pe=A[920+j>>2],Ge=A[916+j>>2],je=A[912+j>>2],Te=A[256+j>>2],ke=A[252+j>>2],Ue=A[248+j>>2],ge=we)),ge<ee&&se&&(he=q,me=H,ve=Y,Q=je,ie=Ge,oe=Pe,ne=Ue,_e=ke,ae=Te,Re=ye,De=ue,Ne=Ae,Oe=Ce,Me=Se,xe=be,Z=X,V=i,ee=ge),!se)break t;se=c[le+48>>2]}if(te=te+16|0,!((0|(i=i+1|0))<(0|se)))break}te=c[ce+48>>2]}if(!((0|(X=X+1|0))<(0|te)))break}(V|Z)<0||(ge=x(Q-ne),ne=x(ie-_e),ae=x(oe-ae),_e=x(x(x(ge*Re)+x(ne*De))+x(ae*Ne)),ee=x(x(x(ge*Oe)+x(ne*Me))+x(ae*xe)),H=x(0),Y=x(x(x(Re*Oe)+x(De*Me))+x(Ne*xe)),(q=x(x(1)-x(Y*Y)))!=x(0)&&(H=x(-1.0000000150474662e30),(q=x(x(ee-x(_e*Y))/q))<x(-1.0000000150474662e30)||(H=q)>x(1.0000000150474662e30)&&(H=x(1.0000000150474662e30))),(q=x(x(Y*H)-_e))<x(-1.0000000150474662e30)?(Y=x(ee+x(Y*x(-1.0000000150474662e30))))<x(-1.0000000150474662e30)?(q=x(-1.0000000150474662e30),H=x(-1.0000000150474662e30)):(H=x(1.0000000150474662e30),Y>x(1.0000000150474662e30)?q=x(-1.0000000150474662e30):(q=x(-1.0000000150474662e30),H=Y)):q>x(1.0000000150474662e30)&&(H=x(-1.0000000150474662e30),q=x(1.0000000150474662e30),(Y=x(ee+x(Y*x(1.0000000150474662e30))))<x(-1.0000000150474662e30)||(H=Y)>x(1.0000000150474662e30)&&(H=x(1.0000000150474662e30))),c[260+j>>2]=0,_e=x(Ne*q),Y=x(_e+x(ae-x(xe*H))),ae=x(Re*q),ee=x(ae+x(ge-x(Oe*H))),ge=x(De*q),H=x(ge+x(ne-x(Me*H))),(q=x(x(Y*Y)+x(x(ee*ee)+x(H*H))))>x(1.1920928955078125e-7)&&(ne=x(T(q)),q=x(x(1)/ne),Y=x(Y*q),A[256+j>>2]=Y,H=x(H*q),A[252+j>>2]=H,q=x(ee*q),A[248+j>>2]=q,x(x(x(q*Be)+x(H*Fe))+x(Y*Le))<x(0)&&(A[256+j>>2]=-Y,A[252+j>>2]=-H,A[248+j>>2]=-q),c[956+j>>2]=0,A[952+j>>2]=oe+_e,A[948+j>>2]=ie+ge,A[944+j>>2]=Q+ae,pi[c[c[o>>2]+16>>2]](o,248+j|0,944+j|0,x(-ne)))),H=x(0),q=x(-1.0000000150474662e30),x(x(x(Be*ve)+x(Fe*me))+x(Le*he))<x(0)&&(he=x(-he),me=x(-me),ve=x(-ve))}if((0|(X=c[e+16>>2]))<=(J=-1))for(c[e+20>>2]<=-1&&((i=c[e+24>>2])&&p[e+28|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+20>>2]=0,c[e+24>>2]=0,a[e+28|0]=1),V=X<<4;W=c[252+j>>2],i=c[e+24>>2]+V|0,c[(Z=i)>>2]=c[248+j>>2],c[Z+4>>2]=W,W=c[4+(Z=256+j|0)>>2],c[(i=i+8|0)>>2]=c[Z>>2],c[i+4>>2]=W,V=V+16|0,(i=X)>>>0<=(X=X+1|0)>>>0;);if(c[e+16>>2]=0,n=c[n+12>>2],se=c[t+12>>2],ce=c[re+60>>2],i=c[K+60>>2],A[260+j>>2]=H,H=x(x(1)/x(T(x(x(x(ve*ve)+x(me*me))+x(he*he))))),ie=x(he*H),A[256+j>>2]=ie,he=x(me*H),A[252+j>>2]=he,me=x(ve*H),A[248+j>>2]=me,1<=(0|(V=c[i+28>>2])))for(X=c[i+36>>2]+28|0,ve=A[n+40>>2],ge=A[n+36>>2],ae=A[n+24>>2],oe=A[n+20>>2],ne=A[n+32>>2],_e=A[n+16>>2],be=A[n+8>>2],Se=A[n+4>>2],Ce=A[n>>2],H=x(-34028234663852886e22),W=0;Y=A[X-8>>2],Q=A[X-4>>2],ee=A[X>>2],H=(t=H<(Y=x(x(x(me*x(x(x(Y*Ce)+x(Q*Se))+x(ee*be)))+x(he*x(x(x(Y*_e)+x(Q*oe))+x(ee*ae))))+x(ie*x(x(x(Y*ne)+x(Q*ge))+x(ee*ve))))))?Y:H,J=t?W:J,X=X+36|0,(0|V)!=(0|(W=W+1|0)););if(c[e+16>>2]=0,t=c[i+36>>2]+g(J,36)|0,1<=(0|(le=c[t+4>>2])))for(Ee=t+12|0,Z=W=0;;){if(t=c[i+16>>2]+(c[c[Ee>>2]+(Z<<2)>>2]<<4)|0,H=A[t>>2],Y=A[t+4>>2],Q=A[t+8>>2],ee=x(x(x(x(H*A[n+32>>2])+x(Y*A[n+36>>2]))+x(Q*A[n+40>>2]))+A[n+56>>2]),ie=x(x(x(x(H*A[n+16>>2])+x(Y*A[n+20>>2]))+x(Q*A[n+24>>2]))+A[n+52>>2]),H=x(x(x(x(H*A[n>>2])+x(Y*A[n+4>>2]))+x(Q*A[n+8>>2]))+A[n+48>>2]),c[e+20>>2]==(0|W)&&!((0|(V=W?W<<1:1))<=(0|W))){if(t=0,V&&(c[5498]=c[5498]+1,(X=M(19+(V<<4)|0))&&(c[(t=X+19&-16)-4>>2]=X)),1<=(0|W))for(X=0;te=c[e+24>>2]+X|0,Ie=c[te+4>>2],c[(K=t+X|0)>>2]=c[te>>2],c[K+4>>2]=Ie,re=c[4+(te=te+8|0)>>2],c[(K=K+8|0)>>2]=c[te>>2],c[K+4>>2]=re,X=X+16|0,W=W-1|0;);(X=c[e+24>>2])&&p[e+28|0]&&(c[5499]=c[5499]+1,z(c[X-4>>2])),c[e+24>>2]=t,a[e+28|0]=1,c[e+20>>2]=V,W=c[e+16>>2]}if(t=c[e+24>>2]+(W<<4)|0,c[t+12>>2]=0,A[t+8>>2]=ee,A[t+4>>2]=ie,A[t>>2]=H,W=c[e+16>>2]+1|0,c[e+16>>2]=W,(0|le)==(0|(Z=Z+1|0)))break}(0|J)<=-1||Vt(248+j|0,ce,se,e+12|0,e+32|0,x(q-Ve),Ve,o)}p[e+52|0]&&(e=c[o+4>>2],c[e+844>>2]&&((0|(t=c[e+836>>2]))==(0|(n=c[c[o+8>>2]+8>>2]))?Bt(e,t+4|0,c[c[o+12>>2]+8>>2]+4|0):Bt(e,c[c[o+12>>2]+8>>2]+4|0,n+4|0)))}N=976+j|0},function(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var r,s,l,_,u,h,f,p,d=x(0),m=x(0);return N=e=N-624|0,m=x(A[t+116>>2]-A[t+52>>2]),d=x(m*m),m=x(A[t+120>>2]-A[t+56>>2]),d=x(d+x(m*m)),m=x(A[t+124>>2]-A[t+60>>2]),d=x(d+x(m*m)),m=A[t+276>>2],d<x(m*m)&&(m=x(1),d=x(A[n+116>>2]-A[n+52>>2]),p=x(d*d),d=x(A[n+120>>2]-A[n+56>>2]),p=x(p+x(d*d)),d=x(A[n+124>>2]-A[n+60>>2]),p=x(p+x(d*d)),d=A[n+276>>2],p<x(d*d))||(r=c[t+192>>2],c[(i=o=e+592|0)>>2]=0,c[i+4>>2]=0,c[(l=e+588|0)>>2]=1065353216,c[(i=s=e+600|0)>>2]=0,c[i+4>>2]=0,c[(_=e+608|0)>>2]=0,c[e+572>>2]=0,c[e+576>>2]=0,c[e+580>>2]=1065353216,c[e+584>>2]=1065353216,c[e+564>>2]=8,c[e+568>>2]=0,c[e+560>>2]=11936,c[e+616>>2]=0,m=A[n+272>>2],A[e+596>>2]=m,A[e+612>>2]=m,c[e+556>>2]=0,c[e+548>>2]=1566444395,c[e+552>>2]=0,c[e+384>>2]=12640,a[0|(u=e+356|0)]=0,c[e+332>>2]=953267991,c[e+16>>2]=r,c[e+8>>2]=12396,c[e+20>>2]=e+560,c[e+12>>2]=e+24,h=t+4|0,f=t+68|0,p=n+4|0,r=n+68|0,m=x(1),Ht(e+8|0,h,f,p,r,e+384|0)&&((d=A[e+548>>2])<A[t+268>>2]&&(A[t+268>>2]=d),d<A[n+268>>2]&&(A[n+268>>2]=d),m=x(1),d<x(1)&&(m=d)),i=c[n+192>>2],c[o>>2]=0,c[o+4>>2]=0,c[l>>2]=1065353216,c[s>>2]=0,c[4+s>>2]=0,c[_>>2]=0,c[e+572>>2]=0,c[e+576>>2]=0,c[e+580>>2]=1065353216,c[e+584>>2]=1065353216,c[e+564>>2]=8,c[e+568>>2]=0,c[e+560>>2]=11936,c[e+616>>2]=0,d=A[t+272>>2],A[e+596>>2]=d,A[e+612>>2]=d,c[e+556>>2]=0,c[e+548>>2]=1566444395,c[e+552>>2]=0,c[e+384>>2]=12640,a[0|u]=0,c[e+332>>2]=953267991,c[e+20>>2]=i,c[e+8>>2]=12396,c[e+16>>2]=e+560,c[e+12>>2]=e+24,Ht(e+8|0,h,f,p,r,e+384|0)&&((d=A[e+548>>2])<A[t+268>>2]&&(A[t+268>>2]=d),d<A[n+268>>2]&&(A[n+268>>2]=d),d<m&&(m=d))),N=e+624|0,x(m)},function(e,t){t|=0;var n,i=0,o=0,r=0,s=0;if((r=c[56+(e|=0)>>2])&&p[e+52|0]){if((0|(o=c[t+4>>2]))==c[t+8>>2]&&!((0|(n=o?o<<1:1))<=(0|o))){if(n&&(c[5498]=c[5498]+1,(i=M(19+(n<<2)|0))&&(c[(s=i+19&-16)-4>>2]=i)),1<=(0|o))for(r=0,i=o;c[r+s>>2]=c[c[t+12>>2]+r>>2],r=r+4|0,i=i-1|0;);(i=c[t+12>>2])&&p[t+16|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2]),o=c[t+4>>2]),c[t+12>>2]=s,a[t+16|0]=1,c[t+8>>2]=n,r=c[e+56>>2]}c[t+4>>2]=o+1,c[c[t+12>>2]+(o<<2)>>2]=r}},ot,At,qe,Se,ve,ve,qe,qe,qt,ve,qe,qe,function(e,t,n,i){e|=0,t|=0,n|=0,i=x(i);var o,r,s,l,_,u,h;N=h=N-16|0,A[e+32>>2]=i,u=c[t+4>>2],c[e+8>>2]=c[t>>2],c[e+12>>2]=u,_=c[4+(u=t+8|0)>>2],c[(l=e+16|0)>>2]=c[u>>2],c[4+l>>2]=_,o=A[u>>2],r=A[n>>2],s=A[t>>2],l=A[n+4>>2],_=A[t+4>>2],u=A[n+8>>2],n=A[e+28>>2],i=x(x(n+A[e+24>>2])+i),A[e+32>>2]=i,c[12+h>>2]=0,A[8+h>>2]=u-x(n*o),A[4+h>>2]=l-x(n*_),A[h>>2]=r-x(s*n),i<x(0)&&(a[e+36|0]=1),e=c[e+4>>2],pi[c[c[e>>2]+16>>2]](e,t,h,i),N=16+h|0},ve,function(e,t,n,i){e|=0,t|=0,n|=0,i=x(i);var o,a,r,s,l,_,u,h,f,d,m,v,g=x(0),y=x(0),b=x(0),S=x(0),C=x(0),E=x(0),T=x(0),P=x(0),w=x(0),I=x(0),R=x(0),D=x(0),O=x(0),M=x(0),z=x(0),L=x(0),F=x(0),B=x(0),k=x(0);N=v=N-16|0,s=A[t+8>>2],R=A[n+8>>2],k=x(x(s*i)+R),l=A[t+4>>2],P=A[n+4>>2],_=x(x(l*i)+P),u=A[t>>2],g=x(u*i),i=A[n>>2],h=x(g+i),p[e+232|0]?(D=A[e+56>>2],C=x(-A[e+92>>2]),O=A[e+40>>2],S=A[e+88>>2],M=A[e+72>>2],E=A[e+96>>2],y=x(x(x(D*C)-x(O*S))-x(M*E)),z=A[e+60>>2],L=A[e+44>>2],F=A[e+76>>2],w=x(x(x(z*C)-x(L*S))-x(F*E)),B=A[e- -64>>2],g=x(B*C),C=A[e+48>>2],g=x(g-x(C*S)),S=A[e+80>>2],E=x(g-x(S*E)),g=A[e+168>>2],b=A[e+172>>2],T=A[e+176>>2],T=x(x(x(k*x(x(x(M*g)+x(F*b))+x(S*T)))+x(x(h*x(x(x(O*g)+x(L*b))+x(C*T)))+x(_*x(x(x(D*g)+x(z*b))+x(B*T)))))+x(x(x(x(g*y)+x(w*b))+x(E*T))+A[e+216>>2])),I=x(u*x(T-i)),i=A[e+184>>2],g=A[e+188>>2],b=A[e+192>>2],g=x(x(x(k*x(x(x(M*i)+x(F*g))+x(S*b)))+x(x(h*x(x(x(O*i)+x(L*g))+x(C*b)))+x(_*x(x(x(D*i)+x(z*g))+x(B*b)))))+x(x(x(x(y*i)+x(w*g))+x(E*b))+A[e+220>>2])),b=x(I+x(l*x(g-P))),i=A[e+200>>2],P=A[e+204>>2],w=x(x(y*i)+x(w*P)),y=A[e+208>>2],k=x(x(x(w+x(E*y))+A[e+224>>2])+x(x(k*x(x(x(M*i)+x(F*P))+x(S*y)))+x(x(h*x(x(x(O*i)+x(L*P))+x(C*y)))+x(_*x(x(x(D*i)+x(z*P))+x(B*y)))))),i=x(b+x(s*x(k-R))),A[4+v>>2]=g+x(l*i),A[v>>2]=T+x(u*i),R=x(k+x(s*i))):(d=A[e+224>>2],D=A[e+208>>2],O=A[e+200>>2],M=A[e+204>>2],m=A[e+216>>2],y=A[e+172>>2],z=A[e+176>>2],L=A[e+168>>2],F=A[e+120>>2],I=x(-A[e+156>>2]),w=A[e+104>>2],a=A[e+152>>2],B=A[e+136>>2],r=A[e+160>>2],C=x(x(x(F*I)-x(w*a))-x(B*r)),S=A[e+124>>2],E=A[e+108>>2],g=A[e+140>>2],b=x(x(x(S*I)-x(E*a))-x(g*r)),T=A[e+128>>2],o=x(T*I),I=A[e+112>>2],o=x(o-x(I*a)),a=A[e+144>>2],r=x(o-x(a*r)),o=A[e+184>>2],f=A[e+188>>2],n=A[e+192>>2],o=x(x(x(R*x(x(x(B*o)+x(g*f))+x(a*n)))+x(x(i*x(x(x(w*o)+x(E*f))+x(I*n)))+x(P*x(x(x(F*o)+x(S*f))+x(T*n)))))+x(x(x(x(C*o)+x(b*f))+x(r*n))+A[e+220>>2])),A[4+v>>2]=o,y=x(x(x(R*x(x(x(B*L)+x(g*y))+x(a*z)))+x(x(i*x(x(x(w*L)+x(E*y))+x(I*z)))+x(P*x(x(x(F*L)+x(S*y))+x(T*z)))))+x(m+x(x(x(L*C)+x(b*y))+x(r*z)))),A[v>>2]=y,R=x(x(d+x(x(x(C*O)+x(b*M))+x(r*D)))+x(x(R*x(x(x(B*O)+x(g*M))+x(a*D)))+x(x(i*x(x(x(w*O)+x(E*M))+x(I*D)))+x(P*x(x(x(F*O)+x(S*M))+x(T*D)))))),i=x(x(x(u*x(h-y))+x(l*x(_-o)))+x(s*x(k-R)))),c[12+v>>2]=0,A[8+v>>2]=R,e=c[e+36>>2],pi[c[c[e>>2]+16>>2]](e,t,v,i),N=16+v|0},ve,Yt,function(e){var t,n;return c[8+(e|=0)>>2]=13344,c[e>>2]=13316,n=c[(t=e+56|0)>>2],pi[c[c[n>>2]+20>>2]](n,c[(n=e+72|0)>>2]),t=c[t>>2],pi[c[c[t>>2]+16>>2]](t,c[n>>2]),0|e},function(e){var t,n;c[8+(e|=0)>>2]=13344,c[e>>2]=13316,n=c[(t=e+56|0)>>2],pi[c[c[n>>2]+20>>2]](n,c[(n=e+72|0)>>2]),t=c[t>>2],pi[c[c[t>>2]+16>>2]](t,c[n>>2]),c[5499]=c[5499]+1,z(c[e-4>>2])},function(e,t,n,i,o){t|=0,n|=0,i|=0,o|=0;var a,r,s,l,_,u,h,f,d,m,v,g,y,b,S,C,E,T,P,w,I,R,D,O,M,z,L,F,B=0;N=F=N+-64|0,r=p[76+(e|=0)|0],B=c[(g=r?t:n)+4>>2],8<c[B+4>>2]-21>>>0||19<c[c[(r=r?n:t)+4>>2]+4>>2]||(L=x(pi[c[c[B>>2]+48>>2]](B)),A[e- -64>>2]=L,c[e+60>>2]=i,c[e+48>>2]=g,c[e+44>>2]=r,c[e+52>>2]=o,c[o+4>>2]=c[(i=e+72|0)>>2],t=c[g+12>>2],s=A[t+52>>2],y=A[t+56>>2],n=c[r+12>>2],b=A[n+52>>2],S=A[n+56>>2],a=A[t+20>>2],l=A[t+36>>2],C=A[n+20>>2],E=A[n+36>>2],T=A[n+24>>2],_=A[t+24>>2],P=A[n+40>>2],u=A[t+40>>2],w=A[n+32>>2],h=A[t+32>>2],I=A[n>>2],f=A[t>>2],R=A[n+16>>2],d=A[t+16>>2],D=A[t+48>>2],O=A[n+48>>2],m=A[t+4>>2],M=A[n+4>>2],z=A[n+8>>2],v=A[t+8>>2],c[60+F>>2]=0,c[44+F>>2]=0,c[28+F>>2]=0,A[40+F>>2]=x(x(v*z)+x(_*T))+x(u*P),A[36+F>>2]=x(x(v*M)+x(_*C))+x(u*E),A[24+F>>2]=x(x(m*z)+x(a*T))+x(l*P),A[20+F>>2]=x(x(m*M)+x(a*C))+x(l*E),s=x(-s),A[56+F>>2]=x(x(x(_*s)-x(v*D))-x(u*y))+x(x(x(v*O)+x(_*b))+x(u*S)),A[52+F>>2]=x(x(x(a*s)-x(m*D))-x(l*y))+x(x(x(m*O)+x(a*b))+x(l*S)),c[12+F>>2]=0,A[F>>2]=x(x(f*I)+x(d*R))+x(h*w),A[32+F>>2]=x(x(v*I)+x(_*R))+x(u*w),A[16+F>>2]=x(x(m*I)+x(a*R))+x(l*w),A[8+F>>2]=x(x(f*z)+x(d*T))+x(h*P),A[4+F>>2]=x(x(f*M)+x(d*C))+x(h*E),A[48+F>>2]=x(x(x(d*s)-x(f*D))-x(h*y))+x(x(x(f*O)+x(d*b))+x(h*S)),S=c[r+4>>2],pi[c[c[S>>2]+8>>2]](S,F,t=e+12|0,n=e+28|0),a=x(L+A[o+32>>2]),A[n>>2]=a+A[n>>2],A[(S=e+32|0)>>2]=a+A[S>>2],A[(S=e+36|0)>>2]=a+A[S>>2],A[t>>2]=A[t>>2]-a,A[(S=e+16|0)>>2]=A[S>>2]-a,A[(S=e+20|0)>>2]=A[S>>2]-a,i=c[i>>2],c[i+840>>2]=c[g+8>>2],c[i+836>>2]=c[r+8>>2],pi[c[c[B>>2]+64>>2]](B,e+8|0,t,n),t=c[o+4>>2],c[t+844>>2]&&(i=c[t+836>>2],B=c[c[o+8>>2]+8>>2],S=t,t=c[c[o+12>>2]+8>>2],Bt(S,((n=(0|i)==(0|B))?i:t)+4|0,(n?t:B)+4|0)),c[e+44>>2]=0,c[e+48>>2]=0),N=F+64|0},function(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0,x(0);var a,r,s,l,_,u,h,f,d,m,v,g,y,b,S,C,E,T,P,w,I,R,D,O,M,z,L,F,B,k,U,G,j,V,H,W,q,Y,X=x(0);return N=i=N-240|0,X=x(1),o=p[e+76|0],a=x(A[(e=o?n:t)+116>>2]-A[e+52>>2]),r=x(a*a),a=x(A[e+120>>2]-A[e+56>>2]),r=x(r+x(a*a)),a=x(A[e+124>>2]-A[e+60>>2]),r=x(r+x(a*a)),a=A[e+276>>2],r<x(a*a)||(n=c[(t=o?t:n)+192>>2],8<c[n+4>>2]-21>>>0||(l=A[t+52>>2],X=A[t+12>>2],a=A[t+28>>2],r=A[t+56>>2],s=A[t+60>>2],_=A[t+44>>2],b=A[e+120>>2],S=A[e+116>>2],C=A[e+124>>2],u=A[t+8>>2],h=A[t+24>>2],f=A[t+40>>2],d=A[t+36>>2],m=A[t+20>>2],v=A[t+4>>2],E=A[e+56>>2],T=A[e+52>>2],P=A[e+60>>2],w=A[e+108>>2],I=A[e+92>>2],R=A[e+76>>2],D=A[e+104>>2],O=A[e+88>>2],M=A[e+72>>2],z=A[e+100>>2],L=A[e+84>>2],F=A[e+44>>2],B=A[e+28>>2],k=A[e+12>>2],U=A[e+40>>2],G=A[e+24>>2],j=A[e+8>>2],V=A[e+36>>2],H=A[e+20>>2],W=A[e+68>>2],q=A[e+4>>2],c[i+236>>2]=0,c[i+220>>2]=0,Y=x(-r),r=x(x(x(a*Y)-x(X*l))-x(_*s)),g=x(r+x(x(x(X*S)+x(a*b))+x(_*C))),y=x(r+x(x(x(X*T)+x(a*E))+x(_*P))),r=A[e+272>>2],A[i+232>>2]=(g<y?g:y)-r,o=x(x(x(h*Y)-x(u*l))-x(f*s)),t=x(o+x(x(x(u*S)+x(h*b))+x(f*C))),o=x(o+x(x(x(u*T)+x(h*E))+x(f*P))),A[i+228>>2]=(t<o?t:o)-r,s=x(x(x(m*Y)-x(v*l))-x(d*s)),l=x(s+x(x(x(v*S)+x(m*b))+x(d*C))),s=x(s+x(x(x(v*T)+x(m*E))+x(d*P))),A[i+224>>2]=(l<s?l:s)-r,A[i+216>>2]=r+(y<g?g:y),A[i+212>>2]=r+(o<t?t:o),A[i+208>>2]=r+(s<l?l:s),c[i+128>>2]=0,A[i+124>>2]=g,A[i+120>>2]=t,A[i+116>>2]=l,c[i+112>>2]=0,A[i+108>>2]=x(x(X*R)+x(a*I))+x(_*w),A[i+104>>2]=x(x(X*M)+x(a*O))+x(_*D),A[i+100>>2]=x(x(X*W)+x(a*L))+x(_*z),c[i+96>>2]=0,A[i+92>>2]=x(x(u*R)+x(h*I))+x(f*w),A[i+88>>2]=x(x(u*M)+x(h*O))+x(f*D),A[i+84>>2]=x(x(u*W)+x(h*L))+x(f*z),c[i+80>>2]=0,A[i+76>>2]=x(x(v*R)+x(m*I))+x(d*w),A[i+72>>2]=x(x(v*M)+x(m*O))+x(d*D),c[i- -64>>2]=0,A[i+60>>2]=y,A[i+56>>2]=o,A[i+52>>2]=s,c[i+48>>2]=0,A[i+44>>2]=x(x(X*k)+x(a*B))+x(_*F),A[i+40>>2]=x(x(X*j)+x(a*G))+x(_*U),A[i+36>>2]=x(x(X*q)+x(a*H))+x(_*V),c[i+32>>2]=0,A[i+28>>2]=x(x(u*k)+x(h*B))+x(f*F),A[i+24>>2]=x(x(u*j)+x(h*G))+x(f*U),A[i+20>>2]=x(x(u*q)+x(h*H))+x(f*V),c[i+16>>2]=0,A[i+12>>2]=x(x(v*k)+x(m*B))+x(d*F),A[i+8>>2]=x(x(v*j)+x(m*G))+x(d*U),A[i+68>>2]=x(x(v*W)+x(m*L))+x(d*z),A[i+4>>2]=x(x(v*q)+x(m*H))+x(d*V),c[i>>2]=13592,A[i+196>>2]=r,A[i+200>>2]=A[e+268>>2],pi[c[c[n>>2]+64>>2]](n,i,i+224|0,i+208|0),(X=A[i+200>>2])<A[e+268>>2]?A[e+268>>2]=X:X=x(1))),N=i+240|0,x(X)},function(e,t){t|=0;var n,i=0,o=0,r=0,s=0;if(r=c[72+(e|=0)>>2]){if((0|(o=c[t+4>>2]))==c[t+8>>2]&&!((0|(n=o?o<<1:1))<=(0|o))){if(n&&(c[5498]=c[5498]+1,(i=M(19+(n<<2)|0))&&(c[(s=i+19&-16)-4>>2]=i)),1<=(0|o))for(r=0,i=o;c[r+s>>2]=c[c[t+12>>2]+r>>2],r=r+4|0,i=i-1|0;);(i=c[t+12>>2])&&p[t+16|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2]),o=c[t+4>>2]),c[t+12>>2]=s,a[t+16|0]=1,c[t+8>>2]=n,r=c[e+72>>2]}c[t+4>>2]=o+1,c[c[t+12>>2]+(o<<2)>>2]=r}},function(e){var t;return c[(e|=0)>>2]=13344,t=c[e+48>>2],pi[c[c[t>>2]+20>>2]](t,c[e+64>>2]),t=c[e+48>>2],pi[c[c[t>>2]+16>>2]](t,c[e+64>>2]),0|e},function(e){var t;c[(e|=0)>>2]=13344,t=c[e+48>>2],pi[c[c[t>>2]+20>>2]](t,c[e+64>>2]),t=c[e+48>>2],pi[c[c[t>>2]+16>>2]](t,c[e+64>>2]),c[5499]=c[5499]+1,z(c[e-4>>2])},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,a=0,r=0,s=x(0),l=0,_=x(0),u=x(0),h=x(0);N=o=N-144|0,s=A[t>>2],_=A[t+16>>2],u=A[t+32>>2],A[e+20>>2]<((h=s<_?s:_)<u?h:u)||A[(u<A[t+(a=!(_<s)<<4)>>2]?a:32)+t>>2]<A[e+4>>2]||(s=A[t+8>>2],_=A[(a=t+24|0)>>2],u=A[(l=t+40|0)>>2],A[e+28>>2]<((h=s<_?s:_)<u?h:u)||A[(u<A[(a=_<s?t+8|0:a)>>2]?a:l)>>2]<A[e+12>>2]||(s=A[t+4>>2],_=A[(a=t+20|0)>>2],u=A[(l=t+36|0)>>2],A[e+24>>2]<((h=s<_?s:_)<u?h:u)||A[(u<A[(a=_<s?t+4|0:a)>>2]?a:l)>>2]<A[e+8>>2]||(a=c[e+36>>2],19<c[c[a+4>>2]+4>>2]||(l=c[e+48>>2],c[(r=60+o|0)>>2]=1065353216,c[r+4>>2]=0,u=c[t+20>>2],c[(r=112+o|0)>>2]=c[t+16>>2],c[r+4>>2]=u,u=c[t+36>>2],c[(r=128+o|0)>>2]=c[t+32>>2],c[r+4>>2]=u,_=c[4+(u=t+8|0)>>2],c[(r=104+o|0)>>2]=c[u>>2],c[r+4>>2]=_,_=c[4+(u=t+24|0)>>2],c[(r=120+o|0)>>2]=c[u>>2],c[r+4>>2]=_,_=c[4+(u=t+40|0)>>2],c[(r=136+o|0)>>2]=c[u>>2],c[r+4>>2]=_,c[92+o>>2]=0,c[52+o>>2]=1065353216,c[56+o>>2]=1065353216,c[44+o>>2]=0,c[48+o>>2]=0,c[36+o>>2]=1,c[40+o>>2]=0,c[32+o>>2]=13376,r=c[t+4>>2],c[96+o>>2]=c[t>>2],c[100+o>>2]=r,A[84+o>>2]=A[e+56>>2],c[28+o>>2]=i,c[24+o>>2]=n,t=c[e+40>>2],c[8+o>>2]=t,r=c[t+8>>2],c[20+o>>2]=c[t+12>>2],c[16+o>>2]=r,s=A[c[e+44>>2]+32>>2],c[12+o>>2]=32+o,t=s>x(0)?0|pi[c[c[l>>2]+8>>2]](l,a,8+o|0,0,2):0|pi[c[c[l>>2]+8>>2]](l,a,8+o|0,c[e+64>>2],1),a=c[e+44>>2],r=c[a+8>>2],c[r+8>>2]!=c[c[e+40>>2]+8>>2]?(r=c[a+12>>2],c[a+12>>2]=8+o,pi[c[c[a>>2]+12>>2]](a,n,i)):(c[a+8>>2]=8+o,pi[c[c[a>>2]+8>>2]](a,n,i)),pi[c[c[t>>2]+8>>2]](t,c[e+36>>2],8+o|0,c[e+52>>2],c[e+44>>2]),n=c[e+44>>2],c[(c[c[n+8>>2]+8>>2]==c[c[e+40>>2]+8>>2]?8:12)+n>>2]=r,pi[c[c[t>>2]>>2]](t),pi[c[c[l>>2]+60>>2]](l,t),c[32+o>>2]=7916,(e=c[92+o>>2])&&(pi[c[c[e>>2]>>2]](e),(e=c[92+o>>2])&&(c[5499]=c[5499]+1,z(c[e-4>>2]))))))),N=144+o|0},Je,Ve,rt,function(){return 13516},function(e,t,n){e|=0,t|=0,n|=0,x(0);var i=A[n>>2],o=A[n+4>>2],a=A[n+8>>2],r=x(x(x(i*A[t+80>>2])+x(o*A[t+84>>2]))+x(a*A[t+88>>2])),s=x(x(x(i*A[t+96>>2])+x(o*A[t+100>>2]))+x(a*A[t+104>>2]));i=x(x(x(i*A[t+64>>2])+x(o*A[t+68>>2]))+x(a*A[t+72>>2])),n=c[4+(t=(t- -64|0)+((i<r?r<s?2:1:(i<s)<<1)<<4)|0)>>2],c[e>>2]=c[t>>2],c[e+4>>2]=n,n=c[4+(t=t+8|0)>>2],c[(e=e+8|0)>>2]=c[t>>2],c[e+4>>2]=n},function(e,t,n,i){var o,a,r,s,l,_;if(e|=0,t|=0,n|=0,1<=(0|(i|=0)))for(l=e- -64|0;o=A[t>>2],a=A[t+4>>2],r=A[t+8>>2],s=x(x(x(o*A[e+80>>2])+x(a*A[e+84>>2]))+x(r*A[e+88>>2])),_=x(x(x(o*A[e+96>>2])+x(a*A[e+100>>2]))+x(r*A[e+104>>2])),o=x(x(x(o*A[e+64>>2])+x(a*A[e+68>>2]))+x(r*A[e+72>>2])),o=c[4+(s=((o<s?s<_?2:1:(o<_)<<1)<<4)+l|0)>>2],c[n>>2]=c[s>>2],c[n+4>>2]=o,_=c[4+(s=8+s|0)>>2],c[(o=n+8|0)>>2]=c[s>>2],c[4+o>>2]=_,t=t+16|0,n=n+16|0,i=i-1|0;);},Xt,function(e,t,n){e|=0,t|=0,n|=0,x(0);var i,o=A[e+96>>2],a=A[e+80>>2],r=A[e+84>>2],s=A[e+104>>2],l=A[e+72>>2],_=A[e+88>>2],u=A[e+100>>2],h=A[e+68>>2],f=A[e+64>>2];c[n+12>>2]=0,a=x(a-f),u=x(u-h),r=x(r-h),f=x(o-f),h=x(x(a*u)-x(r*f)),e=x((i=h)*h),h=x(s-l),o=x(_-l),l=x(x(r*h)-x(o*u)),h=x(x(o*f)-x(a*h)),f=x(x(1)/x(T(x(e+x(x(l*l)+x(h*h)))))),o=x(i*f),A[n+8>>2]=o,h=x(h*f),A[n+4>>2]=h,l=x(l*f),A[n>>2]=l,t&&(A[n+8>>2]=-o,A[n+4>>2]=-h,A[n>>2]=-l)},Qt,Qt,function(e,t,n,i){i|=0,pi[c[c[(e|=0)>>2]+108>>2]](e,t|=0,n|=0),pi[c[c[e>>2]+108>>2]](e,(t+1|0)%3|0,i)},function(e,t,n){var i,o=c[4+(t=72+(e=((t|=0)<<4)+(e|=0)|0)|0)>>2];c[(i=8+(n|=0)|0)>>2]=c[t>>2],c[4+i>>2]=o,t=c[4+(e=e- -64|0)>>2],c[n>>2]=c[e>>2],c[n+4>>2]=t},Zt,function(e,t,n,i){pi[c[c[(e|=0)>>2]+124>>2]](e,i|=0,t|=0,n|=0)},function(e,t,n){e|=0,t|=0,n=x(n),x(0);var i,o,a,r,s,l,_,u,h,f,p,d,m=0;return N=d=N-32|0,u=A[e+64>>2],s=x(A[e+80>>2]-u),i=A[e+68>>2],r=x(A[e+100>>2]-i),o=x(A[e+84>>2]-i),l=x(A[e+96>>2]-u),a=x(x(s*r)-x(o*l)),p=x((_=a)*a),f=o,o=A[e+72>>2],a=x(A[e+104>>2]-o),h=x(A[e+88>>2]-o),r=x(x(f*a)-x(h*r)),s=x(x(h*l)-x(s*a)),l=x(x(1)/x(T(x(p+x(x(r*r)+x(s*s)))))),a=x(_*l),r=x(r*l),s=x(s*l),i=x(x(x(A[t+8>>2]*a)+x(x(A[t>>2]*r)+x(A[t+4>>2]*s)))-x(x(o*a)+x(x(u*r)+x(i*s)))),(u=x(-n))<=i&&i<=n&&(pi[c[c[e>>2]+104>>2]](e,0,16+d|0,d),l=A[16+d>>2],i=x(A[d>>2]-l),h=A[20+d>>2],o=x(A[4+d>>2]-h),n=x(x(s*i)-x(r*o)),p=x((_=n)*n),n=x(a*o),f=A[24+d>>2],o=x(A[8+d>>2]-f),n=x(n-x(s*o)),i=x(x(r*o)-x(a*i)),o=x(x(1)/x(T(x(p+x(x(n*n)+x(i*i)))))),_=x(_*o),n=x(n*o),i=x(i*o),u>x(x(x(A[t+8>>2]*_)+x(x(A[t>>2]*n)+x(A[t+4>>2]*i)))-x(x(f*_)+x(x(l*n)+x(h*i))))||(pi[c[c[e>>2]+104>>2]](e,1,16+d|0,d),l=A[16+d>>2],i=x(A[d>>2]-l),h=A[20+d>>2],o=x(A[4+d>>2]-h),n=x(x(s*i)-x(r*o)),p=x((_=n)*n),n=x(a*o),f=A[24+d>>2],o=x(A[8+d>>2]-f),n=x(n-x(s*o)),i=x(x(r*o)-x(a*i)),o=x(x(1)/x(T(x(p+x(x(n*n)+x(i*i)))))),_=x(_*o),n=x(n*o),i=x(i*o),u>x(x(x(A[t+8>>2]*_)+x(x(A[t>>2]*n)+x(A[t+4>>2]*i)))-x(x(f*_)+x(x(l*n)+x(h*i))))||(pi[c[c[e>>2]+104>>2]](e,2,16+d|0,d),_=u,u=A[16+d>>2],i=x(A[d>>2]-u),o=A[20+d>>2],l=x(A[4+d>>2]-o),n=x(x(s*i)-x(r*l)),h=x((f=n)*n),p=x(a*l),n=s,s=A[24+d>>2],l=x(A[8+d>>2]-s),n=x(p-x(n*l)),a=x(x(r*l)-x(a*i)),r=x(x(1)/x(T(x(h+x(x(n*n)+x(a*a)))))),i=x(f*r),n=x(n*r),a=x(a*r),_>x(x(x(A[t+8>>2]*i)+x(x(A[t>>2]*n)+x(A[t+4>>2]*a)))-x(x(s*i)+x(x(u*n)+x(o*a))))||(m=1)))),N=32+d|0,0|m},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0,x(0);var o,a,r=A[e+96>>2],s=A[e+80>>2],l=A[e+84>>2],_=A[e+104>>2],u=A[(t=e+72|0)>>2],h=A[e+88>>2],f=A[e+100>>2],p=A[e+68>>2],d=A[e+64>>2];c[n+12>>2]=0,s=x(s-d),f=x(f-p),l=x(l-p),d=x(r-d),p=x(x(s*f)-x(l*d)),a=x((o=p)*p),p=x(_-u),r=x(h-u),u=x(x(l*p)-x(r*f)),p=x(x(r*d)-x(s*p)),d=x(x(1)/x(T(x(a+x(x(u*u)+x(p*p)))))),A[n+8>>2]=o*d,A[n+4>>2]=p*d,A[n>>2]=u*d,d=c[t+4>>2],c[(n=i+8|0)>>2]=c[t>>2],c[n+4>>2]=d,t=c[e+68>>2],c[i>>2]=c[e+64>>2],c[i+4>>2]=t},ve,function(e,t,n,i){var o,r,s;e|=0,t|=0,n|=0,i|=0,c[(i=748+(N=n=N-800|0)|0)>>2]=0,c[i+4>>2]=0,c[(i=n+760|0)>>2]=0,c[i+4>>2]=0,c[n+756>>2]=1065353216,c[(i=n+768|0)>>2]=0,c[i+4>>2]=0,c[(i=n+780|0)>>2]=0,c[i+4>>2]=0,c[n+776>>2]=1065353216,c[(i=n+788|0)>>2]=0,c[i+4>>2]=0,c[n+796>>2]=0,c[n+740>>2]=0,c[n+744>>2]=0,c[n+736>>2]=1065353216,c[n+728>>2]=0,c[n+732>>2]=0,c[n+560>>2]=12640,A[n+724>>2]=A[e+200>>2],c[(i=n+528|0)>>2]=0,c[i+4>>2]=0,c[n+524>>2]=1065353216,c[(i=n+536|0)>>2]=0,c[i+4>>2]=0,c[n+544>>2]=0,c[n+508>>2]=0,c[n+512>>2]=0,c[n+516>>2]=1065353216,c[n+520>>2]=1065353216,c[n+500>>2]=8,c[n+504>>2]=0,c[n+496>>2]=11936,c[n+552>>2]=0,r=A[e+196>>2],A[n+532>>2]=r,A[n+548>>2]=r,c[(i=n+412|0)>>2]=1065353216,c[i+4>>2]=0,s=c[4+(o=t+8|0)>>2],c[(i=n+456|0)>>2]=c[o>>2],c[i+4>>2]=s,o=c[t+20>>2],c[(i=n+464|0)>>2]=c[t+16>>2],c[i+4>>2]=o,s=c[4+(o=t+24|0)>>2],c[(i=n+472|0)>>2]=c[o>>2],c[i+4>>2]=s,o=c[t+36>>2],c[(i=n+480|0)>>2]=c[t+32>>2],c[i+4>>2]=o,s=c[4+(o=t+40|0)>>2],c[(i=n+488|0)>>2]=c[o>>2],c[i+4>>2]=s,c[n+444>>2]=0,c[n+436>>2]=1025758986,c[n+404>>2]=1065353216,c[n+408>>2]=1065353216,c[n+396>>2]=0,c[n+400>>2]=0,c[n+388>>2]=1,c[n+392>>2]=0,c[n+384>>2]=13376,i=c[t+4>>2],c[n+448>>2]=c[t>>2],c[n+452>>2]=i,a[n+356|0]=0,c[n+332>>2]=953267991,c[n+8>>2]=13256,c[n+20>>2]=n+384,c[n+16>>2]=n+496,c[n+12>>2]=n+24,Yt(n+8|0,e+4|0,e+68|0,n+736|0,n+736|0,n+560|0)&&(r=A[n+724>>2])<A[e+200>>2]&&(A[e+200>>2]=r),c[n+384>>2]=7916,(e=c[n+444>>2])&&(pi[c[c[e>>2]>>2]](e),(e=c[n+444>>2])&&(c[5499]=c[5499]+1,z(c[e-4>>2]))),N=n+800|0},Kt,function(e){V(Kt(e|=0))},$t,function(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var a,r,s,l,_,u,h,f,d,m,v,g,y,b,S,C,E,T,P,w,I,R,D,N,O,M,z,L,F,B,k=0,U=0,G=x(0),j=0;if((0|(U=c[e+52>>2]))<1)return x(x(1));for(O=(k=p[e+68|0])?t:n,M=A[(t=k?n:t)- -64>>2],R=A[t+60>>2],D=A[t+(k=56)>>2],N=A[t+52>>2],z=A[t+48>>2],r=A[t+44>>2],s=A[t+40>>2],l=A[t+36>>2],L=A[t+32>>2],_=A[t+28>>2],u=A[t+24>>2],h=A[t+20>>2],F=A[t+16>>2],f=A[t+12>>2],d=A[t+8>>2],n=c[t+304>>2],m=A[t+4>>2],B=c[t+192>>2],G=x(1);c[t+304>>2]=n+1,n=c[B+32>>2]+k|0,a=A[n>>2],v=A[n-8>>2],g=A[n-4>>2],y=A[n-24>>2],b=A[n-56>>2],S=A[n-40>>2],C=A[n-20>>2],E=A[n-52>>2],T=A[n-36>>2],P=A[n-16>>2],w=A[n-48>>2],I=A[n-32>>2],c[t+64>>2]=0,c[t+48>>2]=0,c[t+32>>2]=0,c[t+16>>2]=0,A[t+44>>2]=x(x(l*w)+x(s*I))+x(r*P),A[t+40>>2]=x(x(l*E)+x(s*T))+x(r*C),A[t+36>>2]=x(x(l*b)+x(s*S))+x(r*y),A[t+28>>2]=x(x(h*w)+x(u*I))+x(_*P),A[t+24>>2]=x(x(h*E)+x(u*T))+x(_*C),A[t+20>>2]=x(x(h*b)+x(u*S))+x(_*y),A[t+12>>2]=x(x(m*w)+x(d*I))+x(f*P),A[t+8>>2]=x(x(m*E)+x(d*T))+x(f*C),A[t+4>>2]=x(x(m*b)+x(d*S))+x(f*y),A[t+60>>2]=R+x(x(x(l*v)+x(s*g))+x(r*a)),A[t+56>>2]=D+x(x(x(h*v)+x(u*g))+x(_*a)),A[t+52>>2]=N+x(x(x(m*v)+x(d*g))+x(f*a)),n=c[c[e+60>>2]+j>>2],a=x(pi[c[c[n>>2]+12>>2]](n,t,O,i,o)),A[t+64>>2]=M,A[t+60>>2]=R,A[t+56>>2]=D,A[t+52>>2]=N,A[t+48>>2]=z,A[t+44>>2]=r,A[t+40>>2]=s,A[t+36>>2]=l,A[t+32>>2]=L,A[t+28>>2]=_,A[t+24>>2]=u,A[t+20>>2]=h,A[t+16>>2]=F,A[t+12>>2]=f,A[t+8>>2]=d,A[t+4>>2]=m,n=c[t+304>>2]+1|0,c[t+304>>2]=n,G=a<G?a:G,k=k+80|0,j=j+4|0,U=U-1|0;);return x(G)},function(e,t){t|=0;var n,i=0,o=0,a=0;if(1<=(0|(i=c[52+(e|=0)>>2])))for(;(n=c[c[e+60>>2]+o>>2])&&(pi[c[c[n>>2]+16>>2]](n,t),i=c[e+52>>2]),o=o+4|0,(0|(a=a+1|0))<(0|i););},Se,ve,qe,function(e,t){var n,i=(n=e|=0,c[c[c[e+4>>2]+4>>2]+32>>2]);e=c[36+(t|=0)>>2],en(n,c[64+(i+g(e,80)|0)>>2],e)},function(e,t){t|=0,pi[c[c[(e|=0)>>2]+12>>2]](e,t)},ft,ft,function(e){var t=0;return c[(e|=0)>>2]=13964,(t=c[e+56>>2])&&p[e+60|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+56>>2]=0,a[e+60|0]=1,c[(t=e+48|0)>>2]=0,c[t+4>>2]=0,(t=c[e+36>>2])&&p[e+40|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+36>>2]=0,a[e+40|0]=1,c[(t=e+28|0)>>2]=0,c[t+4>>2]=0,(t=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+16>>2]=0,a[e+20|0]=1,c[(t=e+8|0)>>2]=0,(c[t+4>>2]=0)|e},function(e){var t=0;c[(e|=0)>>2]=13964,(t=c[e+56>>2])&&p[e+60|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+56>>2]=0,a[e+60|0]=1,c[(t=e+48|0)>>2]=0,c[t+4>>2]=0,(t=c[e+36>>2])&&p[e+40|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+36>>2]=0,a[e+40|0]=1,c[(t=e+28|0)>>2]=0,c[t+4>>2]=0,(t=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),V(e)},function(e,t,n){e|=0,t|=0,n|=0;var i=0,o=0,a=0,r=0,s=0,l=0,_=0,u=0,h=0;c[5610]=c[5610]+1,s=c[e+36>>2],i=g((i=((i=n<<16|t)<<15^-1)+i|0)>>>10^i,9),a=s+((c[e+12>>2]-1&((i=((i^=i>>>6)<<11^-1)+i|0)>>>16^i))<<2)|0;e:if(-1!=(0|(i=c[a>>2]))){for(r=c[e+16>>2],o=i;l=r+g(o,12)|0,c[l+4>>2]!=(0|n)||c[l>>2]!=(0|t);)if(-1==(0|(o=c[c[e+56>>2]+(o<<2)>>2])))break e;u=c[8+(r+g(o,12)|0)>>2],n=c[e+56>>2];t:{if((0|i)!=(0|o)){for(;(0|o)!=(0|(i=c[(_=n+((t=i)<<2)|0)>>2])););if(-1!=(0|t)){c[_>>2]=c[n+(o<<2)>>2];break t}}c[a>>2]=c[n+(o<<2)>>2]}if((0|(a=c[e+8>>2]-1|0))==(0|o))return c[e+8>>2]=o,0|u;t:{if(r=r+g(a,12)|0,t=c[r+4>>2]<<16|c[r>>2],t=g((t=(t<<15^-1)+t|0)>>>10^t,9),_=c[e+12>>2]-1&((t=((t^=t>>>6)<<11^-1)+t|0)>>>16^t),(0|a)!=(0|(i=c[(s=s+(_<<2)|0)>>2]))){for(;(0|a)!=(0|(i=c[(h=n+((t=i)<<2)|0)>>2])););if(-1!=(0|t)){c[h>>2]=c[n+(a<<2)>>2];break t}}c[s>>2]=c[n+(a<<2)>>2]}t=c[r+4>>2],c[l>>2]=c[r>>2],c[l+4>>2]=t,c[l+8>>2]=c[r+8>>2],t=c[e+36>>2]+(_<<2)|0,c[c[e+56>>2]+(o<<2)>>2]=c[t>>2],c[t>>2]=o,c[e+8>>2]=c[e+8>>2]-1}return 0|u},function(e,t,n){e|=0,t|=0,n|=0;var i,o,r=0,s=0,l=0,_=0,u=0,h=0,f=0;c[5609]=c[5609]+1,r=g((r=((r=n<<16|t)<<15^-1)+r|0)>>>10^r,9),i=(r=((r^=r>>>6)<<11^-1)+r|0)>>>16^r,r=c[e+12>>2];e:{if(-1!=(0|(l=c[c[e+36>>2]+((u=i&r-1)<<2)>>2])))for(s=c[e+16>>2];;){if(_=s+g(l,12)|0,c[_+4>>2]==(0|n)&&c[_>>2]==(0|t))break e;if(-1==(0|(l=c[c[e+56>>2]+(l<<2)>>2])))break}t:{n:{if((0|(e=f=c[(s=e)+8>>2]))==(0|r)){if((0|r)<(0|(e=r?r<<1:1)))break n;e=r}c[s+8>>2]=e+1,h=c[s+16>>2];break t}if(e&&(c[5498]=c[5498]+1,(l=M(g(e,12)+19|0))&&(c[(h=l+19&-16)-4>>2]=l)),1<=(0|r))for(l=0;u=c[s+16>>2]+l|0,o=c[u+4>>2],c[(_=l+h|0)>>2]=c[u>>2],c[_+4>>2]=o,c[_+8>>2]=c[u+8>>2],l=l+12|0,r=r-1|0;);(r=c[s+16>>2])&&p[s+20|0]&&(c[5499]=c[5499]+1,z(c[r-4>>2])),c[s+16>>2]=h,c[s+12>>2]=e,a[s+20|0]=1,c[s+8>>2]=c[s+8>>2]+1,tn(s),u=c[s+12>>2]-1&i}_=g(f,12)+h|0,c[_+8>>2]=0,c[_+4>>2]=n,c[_>>2]=t,e=c[s+36>>2]+(u<<2)|0,c[c[s+56>>2]+(f<<2)>>2]=c[e>>2],c[e>>2]=f}return 0|_},nn,an,function(e){V(an(e|=0))},function(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var r,s,l,_,u,h,f,d,m,v,b=0,S=0,C=0,E=0,T=x(0),P=x(0),w=x(0),I=x(0),R=x(0),D=x(0),O=0,L=x(0),F=x(0),B=0,k=0,U=0,G=x(0),j=x(0),V=x(0),H=x(0),W=x(0),q=x(0),Y=x(0),X=x(0),Q=x(0),Z=x(0),J=x(0),K=x(0),$=x(0),ee=x(0),te=0,ne=0,ie=x(0),oe=x(0),ae=0,re=0,se=x(0),ce=0,le=N-3584|0;if(N=le,v=c[t+4>>2],(te=c[v+72>>2])&&(ae=c[n+4>>2],B=c[ae+72>>2])){if(c[ae+76>>2]!=c[e+112>>2]||c[v+76>>2]!=c[e+108>>2]){if(b=c[e+84>>2],1<=(0|(C=c[b+(S=8)>>2]))){for(;(O=c[c[b+16>>2]+S>>2])&&(pi[c[c[O>>2]>>2]](O),E=c[e+4>>2],pi[c[c[E>>2]+60>>2]](E,O)),S=S+12|0,C=C-1|0;);b=c[e+84>>2]}on(b),c[e+108>>2]=c[v+76>>2],c[e+112>>2]=c[ae+76>>2]}if(a[0|(S=88+le|0)]=1,c[84+le>>2]=0,c[76+le>>2]=0,c[80+le>>2]=0,c[(b=232+le|0)>>2]=0,c[b+4>>2]=0,c[(b=240+le|0)>>2]=0,c[b+4>>2]=0,c[(b=248+le|0)>>2]=0,c[b+4>>2]=0,c[(b=256+le|0)>>2]=0,c[b+4>>2]=0,c[(b=264+le|0)>>2]=0,c[b+4>>2]=0,c[(b=272+le|0)>>2]=0,c[b+4>>2]=0,c[280+le>>2]=0,c[(b=440+le|0)>>2]=0,c[b+4>>2]=0,c[(b=448+le|0)>>2]=0,c[b+4>>2]=0,c[(b=456+le|0)>>2]=0,c[b+4>>2]=0,c[(b=464+le|0)>>2]=0,c[b+4>>2]=0,c[(b=472+le|0)>>2]=0,c[b+4>>2]=0,c[(b=480+le|0)>>2]=0,c[b+4>>2]=0,c[488+le>>2]=0,c[(b=648+le|0)>>2]=0,c[b+4>>2]=0,c[(b=656+le|0)>>2]=0,c[b+4>>2]=0,c[(b=664+le|0)>>2]=0,c[b+4>>2]=0,c[(b=672+le|0)>>2]=0,c[b+4>>2]=0,c[(b=680+le|0)>>2]=0,c[b+4>>2]=0,c[(b=688+le|0)>>2]=0,c[b+4>>2]=0,c[696+le>>2]=0,c[112+le>>2]=1025,c[904+le>>2]=0,c[(b=896+le|0)>>2]=0,c[b+4>>2]=0,c[(b=888+le|0)>>2]=0,c[b+4>>2]=0,c[(b=880+le|0)>>2]=0,c[b+4>>2]=0,c[(b=872+le|0)>>2]=0,c[b+4>>2]=0,c[(b=864+le|0)>>2]=0,c[b+4>>2]=0,c[(b=856+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1100+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1108+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1116+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1124+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1132+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1140+le|0)>>2]=0,c[b+4>>2]=0,c[1148+le>>2]=0,c[(b=1308+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1316+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1324+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1332+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1340+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1348+le|0)>>2]=0,c[b+4>>2]=0,c[1356+le>>2]=0,c[956+le>>2]=0,c[948+le>>2]=0,c[952+le>>2]=0,c[976+le>>2]=0,c[980+le>>2]=1025,c[1564+le>>2]=0,c[(b=1556+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1548+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1540+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1532+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1524+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1516+le|0)>>2]=0,c[b+4>>2]=0,c[1772+le>>2]=0,c[(b=1764+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1756+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1748+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1740+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1732+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1724+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1844+le|0)>>2]=0,c[b+4>>2]=1025,c[(b=1816+le|0)>>2]=0,c[b+4>>2]=0,c[1824+le>>2]=0,c[(b=1968+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1976+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1984+le|0)>>2]=0,c[b+4>>2]=0,c[(b=1992+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2e3+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2008+le|0)>>2]=0,c[b+4>>2]=0,c[2016+le>>2]=0,c[2224+le>>2]=0,c[(b=2216+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2208+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2200+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2192+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2184+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2176+le|0)>>2]=0,c[b+4>>2]=0,c[2432+le>>2]=0,c[(b=2424+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2416+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2408+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2400+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2392+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2384+le|0)>>2]=0,c[b+4>>2]=0,c[2640+le>>2]=0,c[(b=2632+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2624+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2616+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2608+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2600+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2592+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2712+le|0)>>2]=0,c[b+4>>2]=1025,c[2692+le>>2]=0,c[(b=2684+le|0)>>2]=0,c[b+4>>2]=0,c[2884+le>>2]=0,c[(b=2876+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2868+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2860+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2852+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2844+le|0)>>2]=0,c[b+4>>2]=0,c[(b=2836+le|0)>>2]=0,c[b+4>>2]=0,c[3092+le>>2]=0,c[(b=3084+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3076+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3068+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3060+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3052+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3044+le|0)>>2]=0,c[b+4>>2]=0,c[3300+le>>2]=0,c[(b=3292+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3284+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3276+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3268+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3260+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3252+le|0)>>2]=0,c[b+4>>2]=0,c[3508+le>>2]=0,c[(b=3500+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3492+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3484+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3476+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3468+le|0)>>2]=0,c[b+4>>2]=0,c[(b=3460+le|0)>>2]=0,c[b+4>>2]=0,c[3580+le>>2]=0,c[3560+le>>2]=0,c[(b=3552+le|0)>>2]=0,c[b+4>>2]=0,O=c[e+84>>2],a[0|S]=0,c[84+le>>2]=112+le,c[76+le>>2]=0,c[80+le>>2]=4,!((0|(E=c[O+8>>2]))<=0)){for(C=0;;){if(S=c[8+(c[O+16>>2]+g(C,12)|0)>>2]){if(pi[c[c[S>>2]+16>>2]](S,72+le|0),1<=(0|(S=c[76+le>>2])))for(k=E=0;b=c[c[84+le>>2]+E>>2],c[b+844>>2]&&(c[o+4>>2]=b,U=c[b+836>>2],ne=c[c[o+8>>2]+8>>2],re=b,b=c[c[o+12>>2]+8>>2],Bt(re,((S=(0|U)==(0|ne))?U:b)+4|0,(S?b:ne)+4|0),c[o+4>>2]=0,S=c[76+le>>2]),E=E+4|0,(0|(k=k+1|0))<(0|S););if((0|S)<=-1)for(c[80+le>>2]<=-1&&((b=c[84+le>>2])&&p[88+le|0]&&(c[5499]=c[5499]+1,z(c[b-4>>2])),a[88+le|0]=1,c[80+le>>2]=0,c[84+le>>2]=0),E=S<<2;E=E+4|(c[c[84+le>>2]+E>>2]=0),(b=S)>>>0<=(S=b+1|0)>>>0;);c[76+le>>2]=0,E=c[O+8>>2]}if(!((0|(C=C+1|0))<(0|E)))break}(S=c[84+le>>2])&&p[88+le|0]&&(c[5499]=c[5499]+1,z(c[S-4>>2]))}if(c[92+le>>2]=i,c[76+le>>2]=0,c[72+le>>2]=14068,c[88+le>>2]=c[e+4>>2],c[104+le>>2]=c[e+72>>2],c[100+le>>2]=c[e+84>>2],c[84+le>>2]=n,i=c[n+12>>2],T=A[i+56>>2],c[80+le>>2]=t,S=c[t+12>>2],P=A[S+40>>2],Z=A[i+52>>2],w=A[S+24>>2],H=A[i+48>>2],L=A[S+8>>2],J=A[S+56>>2],ee=A[S+52>>2],W=A[S+48>>2],I=A[S+36>>2],R=A[S+20>>2],F=A[S+4>>2],q=A[i+40>>2],K=A[i+24>>2],Y=A[i+8>>2],$=A[i+36>>2],j=A[i+20>>2],X=A[i+4>>2],G=A[S>>2],V=A[S+16>>2],D=A[S+32>>2],Q=A[i+16>>2],ie=A[i>>2],oe=A[i+32>>2],c[96+le>>2]=o,(i=c[te>>2])&&(S=c[B>>2])){for(ee=x(-ee),se=x(x(x(x(w*ee)-x(L*W))-x(P*J))+x(x(x(L*H)+x(w*Z))+x(P*T))),u=x(x(x(x(R*ee)-x(F*W))-x(I*J))+x(x(x(F*H)+x(R*Z))+x(I*T))),Z=x(x(x(x(V*ee)-x(G*W))-x(D*J))+x(x(x(G*H)+x(V*Z))+x(D*T))),T=A[o+32>>2],c[116+le>>2]=S,c[112+le>>2]=i,H=x(x(x(L*Y)+x(w*K))+x(P*q)),J=x(y(H)),W=x(x(x(L*X)+x(w*j))+x(P*$)),ee=x(y(W)),r=x(x(x(L*ie)+x(w*Q))+x(P*oe)),h=x(y(r)),s=x(x(x(F*Y)+x(R*K))+x(I*q)),f=x(y(s)),l=x(x(x(F*X)+x(R*j))+x(I*$)),d=x(y(l)),_=x(x(x(F*ie)+x(R*Q))+x(I*oe)),m=x(y(_)),q=x(x(x(G*Y)+x(V*K))+x(D*q)),K=x(y(q)),Y=x(x(x(G*X)+x(V*j))+x(D*$)),$=x(y(Y)),G=x(x(x(G*ie)+x(V*Q))+x(D*oe)),V=x(y(G)),k=124,b=112+le|0,i=C=128,E=1;;){e:{t:{n:{if(U=c[(S=(ne=(te=E-1|0)<<3)+b|0)>>2],B=c[S+4>>2],I=A[B+16>>2],R=A[B>>2],P=x(x(x(I-R)*x(.5))+x(0)),F=A[B+20>>2],D=A[B+4>>2],w=x(x(x(F-D)*x(.5))+x(0)),j=A[B+24>>2],X=A[B+8>>2],L=x(x(x(j-X)*x(.5))+x(0)),Q=x(x(x(V*P)+x($*w))+x(K*L)),I=x(x(I+R)*x(.5)),R=x(x(F+D)*x(.5)),F=x(x(j+X)*x(.5)),D=x(Z+x(x(x(G*I)+x(Y*R))+x(q*F))),A[U>>2]<=x(T+x(Q+D))&&A[U+16>>2]>=x(x(D-Q)-T)&&(D=x(x(x(m*P)+x(d*w))+x(f*L)),j=x(u+x(x(x(_*I)+x(l*R))+x(s*F))),A[U+4>>2]<=x(T+x(D+j))&&A[U+20>>2]>=x(x(j-D)-T)&&(P=x(x(x(h*P)+x(ee*w))+x(J*L)),w=x(se+x(x(x(r*I)+x(W*R))+x(H*F))),A[U+8>>2]<=x(T+x(P+w))&&A[U+24>>2]>=x(x(w-P)-T)))){if((0|te)<=(0|k))O=C,S=b;else{if((0|(O=C<<1))<=(0|C))S=b;else if((0|O)<=(0|i))S=b;else{if(S=0,C&&(c[5498]=c[5498]+1,(i=M(19+(C<<4)|0))&&(c[(S=i+19&-16)-4>>2]=i),!((0|C)<1)))for(k=S,i=b;re=c[i+4>>2],c[k>>2]=c[i>>2],c[k+4>>2]=re,k=k+8|0,i=i+8|0,C=C-1|0;);ce&&(c[5499]=c[5499]+1,z(c[b-4>>2])),ce=1,i=O}k=O-4|0}if(b=c[B+40>>2],c[U+40>>2]){if(C=c[U+36>>2],b){c[4+(b=S+ne|0)>>2]=c[B+36>>2],c[b>>2]=C,C=c[U+40>>2],c[4+(b=(E<<3)+S|0)>>2]=c[B+36>>2],c[b>>2]=C,C=c[U+36>>2],c[b+12>>2]=c[B+40>>2],c[b+8>>2]=C,C=c[U+40>>2],c[b+20>>2]=c[B+40>>2],c[b+16>>2]=C,E=E+3|0;break t}c[4+(b=S+ne|0)>>2]=B,c[b>>2]=C,b=c[U+40>>2],c[4+(C=(E<<3)+S|0)>>2]=B,c[C>>2]=b;break n}if(b){c[4+(b=S+ne|0)>>2]=c[B+36>>2],c[b>>2]=U,c[4+(b=(E<<3)+S|0)>>2]=c[B+40>>2],c[b>>2]=U;break n}pi[c[c[72+le>>2]+8>>2]](72+le|0,U,B),C=O,b=S}E=te;break e}E=E+1|0}C=O,b=S}if(!E)break}b&&ce&&(c[5499]=c[5499]+1,z(c[b-4>>2]))}if(O=c[e+84>>2],1<=c[O+8>>2])for(b=0;;){if(i=(E=g(b,12))+c[O+16>>2]|0,(C=c[i+8>>2])&&(i=c[v+32>>2]+g(c[i>>2],80)|0,k=c[i+64>>2],S=c[t+12>>2],ie=A[S+52>>2],oe=A[S+56>>2],D=A[i+48>>2],Z=A[i+52>>2],H=A[i+56>>2],J=A[i+4>>2],W=A[i+20>>2],q=A[i+36>>2],K=A[i+8>>2],Y=A[i+24>>2],$=A[i+40>>2],T=A[S+20>>2],P=A[S+24>>2],j=A[i>>2],w=A[S+36>>2],X=A[i+16>>2],L=A[S+40>>2],Q=A[i+32>>2],ee=A[S+48>>2],I=A[S+8>>2],R=A[S>>2],F=A[S+4>>2],G=A[S+16>>2],V=A[S+32>>2],c[172+le>>2]=0,c[156+le>>2]=0,c[140+le>>2]=0,c[124+le>>2]=0,A[144+le>>2]=x(x(V*j)+x(w*X))+x(L*Q),A[128+le>>2]=x(x(G*j)+x(T*X))+x(P*Q),A[112+le>>2]=x(x(R*j)+x(F*X))+x(I*Q),A[152+le>>2]=x(x(V*K)+x(w*Y))+x(L*$),A[148+le>>2]=x(x(V*J)+x(w*W))+x(L*q),A[136+le>>2]=x(x(G*K)+x(T*Y))+x(P*$),A[132+le>>2]=x(x(G*J)+x(T*W))+x(P*q),A[120+le>>2]=x(x(R*K)+x(F*Y))+x(I*$),A[116+le>>2]=x(x(R*J)+x(F*W))+x(I*q),A[168+le>>2]=oe+x(x(x(V*D)+x(w*Z))+x(L*H)),A[164+le>>2]=ie+x(x(x(G*D)+x(T*Z))+x(P*H)),A[160+le>>2]=ee+x(x(x(R*D)+x(F*Z))+x(I*H)),pi[c[c[k>>2]+8>>2]](k,112+le|0,56+le|0,40+le|0),T=A[o+32>>2],A[56+le>>2]=A[56+le>>2]-T,A[60+le>>2]=A[60+le>>2]-T,A[64+le>>2]=A[64+le>>2]-T,A[40+le>>2]=T+A[40+le>>2],A[44+le>>2]=T+A[44+le>>2],A[48+le>>2]=T+A[48+le>>2],i=c[ae+32>>2]+g(c[4+(E+c[O+16>>2]|0)>>2],80)|0,k=c[i+64>>2],S=c[n+12>>2],oe=A[S+52>>2],ee=A[S+56>>2],Z=A[i+48>>2],H=A[i+52>>2],J=A[i+56>>2],W=A[i+4>>2],q=A[i+20>>2],K=A[i+36>>2],Y=A[i+8>>2],$=A[i+24>>2],j=A[i+40>>2],P=A[S+20>>2],w=A[S+24>>2],X=A[i>>2],L=A[S+36>>2],Q=A[i+16>>2],I=A[S+40>>2],ie=A[i+32>>2],se=A[S+48>>2],R=A[S+8>>2],F=A[S>>2],G=A[S+4>>2],V=A[S+16>>2],D=A[S+32>>2],c[172+le>>2]=0,c[156+le>>2]=0,c[140+le>>2]=0,c[124+le>>2]=0,A[144+le>>2]=x(x(D*X)+x(L*Q))+x(I*ie),A[128+le>>2]=x(x(V*X)+x(P*Q))+x(w*ie),A[112+le>>2]=x(x(F*X)+x(G*Q))+x(R*ie),A[152+le>>2]=x(x(D*Y)+x(L*$))+x(I*j),A[148+le>>2]=x(x(D*W)+x(L*q))+x(I*K),A[136+le>>2]=x(x(V*Y)+x(P*$))+x(w*j),A[132+le>>2]=x(x(V*W)+x(P*q))+x(w*K),A[120+le>>2]=x(x(F*Y)+x(G*$))+x(R*j),A[116+le>>2]=x(x(F*W)+x(G*q))+x(R*K),A[168+le>>2]=ee+x(x(x(D*Z)+x(L*H))+x(I*J)),A[164+le>>2]=oe+x(x(x(V*Z)+x(P*H))+x(w*J)),A[160+le>>2]=se+x(x(x(F*Z)+x(G*H))+x(R*J)),pi[c[c[k>>2]+8>>2]](k,112+le|0,24+le|0,8+le|0),P=x(A[24+le>>2]-T),A[24+le>>2]=P,w=x(A[28+le>>2]-T),A[28+le>>2]=w,L=x(A[32+le>>2]-T),A[32+le>>2]=L,I=x(T+A[8+le>>2]),A[8+le>>2]=I,R=x(T+A[16+le>>2]),A[16+le>>2]=R,T=x(T+A[12+le>>2]),(A[12+le>>2]=T)<A[60+le>>2]||w>A[44+le>>2]||I<A[56+le>>2]||P>A[40+le>>2]||R<A[64+le>>2]||L>A[48+le>>2])){if(pi[c[c[C>>2]>>2]](C),i=c[e+4>>2],pi[c[c[i>>2]+60>>2]](i,C),i=E+c[O+16>>2]|0,B=c[i+4>>2],U=c[i>>2],(0|(E=c[e+92>>2]))==c[e+96>>2]&&!((0|(i=E?E<<1:1))<=(0|E))){if(i?(C=0,c[5498]=c[5498]+1,(S=M(g(i,12)+19|0))&&(c[(C=S+19&-16)-4>>2]=S)):C=0,1<=(0|E))for(S=0;te=c[e+100>>2]+S|0,ne=c[te+4>>2],c[(k=S+C|0)>>2]=c[te>>2],c[k+4>>2]=ne,c[k+8>>2]=c[te+8>>2],S=S+12|0,E=E-1|0;);(S=c[e+100>>2])&&p[e+104|0]&&(c[5499]=c[5499]+1,z(c[S-4>>2])),c[e+100>>2]=C,a[e+104|0]=1,c[e+96>>2]=i,E=c[e+92>>2]}i=c[e+100>>2]+g(E,12)|0,c[i+8>>2]=0,c[i+4>>2]=B,c[i>>2]=U,c[e+92>>2]=c[e+92>>2]+1}if(!((0|(b=b+1|0))<c[O+8>>2]))break}if(1<=c[e+92>>2])for(E=0,S=4;t=c[e+84>>2],n=c[e+100>>2]+S|0,pi[c[c[t>>2]+8>>2]](t,c[n-4>>2],c[n>>2]),S=S+12|0,(0|(E=E+1|0))<c[e+92>>2];);(t=c[e+100>>2])&&p[e+104|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+100>>2]=0,c[e+92>>2]=0,c[e+96>>2]=0,a[e+104|0]=1}else $t(e,t,n,i,o);N=3584+le|0},function(){return x(x(0))},function(e,t){t|=0;var n,i=0,o=0,a=0;if(i=8,e=c[84+(e|=0)>>2],1<=(0|(o=c[e+8>>2])))for(;(n=c[c[e+16>>2]+i>>2])&&(pi[c[c[n>>2]+16>>2]](n,t),o=c[e+8>>2]),i=i+12|0,(0|(a=a+1|0))<(0|o););},ve,function(e,t,n){e|=0,t|=0,n|=0,x(0);var i,o,a,r,s,l,_,u,h,f,p,d,m,v,y,b,S,C,E,T,P,w,I,R,D,O,M,z=0,L=0,F=N-240|0;if(N=F,c[e+4>>2]=c[e+4>>2]+1,T=c[n+36>>2],D=g(T,80),w=c[e+12>>2],O=c[w+4>>2]+32|0,z=c[64+(D+c[O>>2]|0)>>2],n=c[e+8>>2],P=c[t+36>>2],t=c[c[n+4>>2]+32>>2]+g(P,80)|0,L=c[t+64>>2],n=c[n+12>>2],f=A[n+52>>2],u=A[n+56>>2],M=A[n+24>>2],r=A[n+20>>2],i=A[n+40>>2],o=A[n+36>>2],I=A[n+48>>2],s=A[n+8>>2],l=A[n>>2],_=A[n+4>>2],h=A[n+16>>2],a=A[n+32>>2],c[236+F>>2]=n=0,c[220+F>>2]=0,c[204+F>>2]=0,p=A[t+8>>2],d=A[t+24>>2],m=A[t+40>>2],A[216+F>>2]=x(x(a*p)+x(o*d))+x(i*m),v=A[t+4>>2],y=A[t+20>>2],b=A[t+36>>2],A[212+F>>2]=x(x(a*v)+x(o*y))+x(i*b),A[200+F>>2]=x(x(h*p)+x(r*d))+x(M*m),A[196+F>>2]=x(x(h*v)+x(r*y))+x(M*b),S=u,u=A[t+48>>2],C=A[t+52>>2],E=A[t+56>>2],A[232+F>>2]=S+x(x(x(a*u)+x(o*C))+x(i*E)),A[228+F>>2]=f+x(x(x(h*u)+x(r*C))+x(M*E)),c[188+F>>2]=0,S=a,a=A[t>>2],f=o,o=A[t+16>>2],R=i,i=A[t+32>>2],A[208+F>>2]=x(x(S*a)+x(f*o))+x(R*i),A[192+F>>2]=x(x(h*a)+x(r*o))+x(M*i),A[184+F>>2]=x(x(l*p)+x(_*d))+x(s*m),A[180+F>>2]=x(x(l*v)+x(_*y))+x(s*b),A[176+F>>2]=x(x(l*a)+x(_*o))+x(s*i),A[224+F>>2]=I+x(x(x(l*u)+x(_*C))+x(s*E)),t=c[w+12>>2],f=A[t+52>>2],u=A[t+56>>2],M=A[t+24>>2],r=A[t+20>>2],i=A[t+40>>2],o=A[t+36>>2],w=c[O>>2],I=A[t+48>>2],s=A[t+8>>2],l=A[t>>2],_=A[t+4>>2],h=A[t+16>>2],a=A[t+32>>2],c[172+F>>2]=0,c[156+F>>2]=0,c[140+F>>2]=0,p=A[8+(t=w+D|0)>>2],d=A[t+24>>2],m=A[t+40>>2],A[152+F>>2]=x(x(a*p)+x(o*d))+x(i*m),v=A[t+4>>2],y=A[t+20>>2],b=A[t+36>>2],A[148+F>>2]=x(x(a*v)+x(o*y))+x(i*b),A[136+F>>2]=x(x(h*p)+x(r*d))+x(M*m),A[132+F>>2]=x(x(h*v)+x(r*y))+x(M*b),S=u,u=A[t+48>>2],C=A[t+52>>2],E=A[t+56>>2],A[168+F>>2]=S+x(x(x(a*u)+x(o*C))+x(i*E)),A[164+F>>2]=f+x(x(x(h*u)+x(r*C))+x(M*E)),c[124+F>>2]=0,S=a,a=A[t>>2],f=o,o=A[t+16>>2],R=i,i=A[t+32>>2],A[144+F>>2]=x(x(S*a)+x(f*o))+x(R*i),A[128+F>>2]=x(x(h*a)+x(r*o))+x(M*i),A[120+F>>2]=x(x(l*p)+x(_*d))+x(s*m),A[116+F>>2]=x(x(l*v)+x(_*y))+x(s*b),A[112+F>>2]=x(x(l*a)+x(_*o))+x(s*i),A[160+F>>2]=I+x(x(x(l*u)+x(_*C))+x(s*E)),pi[c[c[L>>2]+8>>2]](L,176+F|0,96+F|0,80+F|0),pi[c[c[z>>2]+8>>2]](z,112+F|0,F+64|0,48+F|0),M=A[c[e+24>>2]+32>>2],r=x(A[100+F>>2]-M),A[100+F>>2]=r,i=x(A[104+F>>2]-M),A[104+F>>2]=i,o=x(M+A[80+F>>2]),A[80+F>>2]=o,s=x(M+A[84+F>>2]),A[84+F>>2]=s,l=x(M+A[88+F>>2]),A[88+F>>2]=l,_=x(A[96+F>>2]-M),t=0,(A[96+F>>2]=_)>A[48+F>>2]||(t=0,o<A[64+F>>2]||(t=1)),i>A[56+F>>2]||l<A[72+F>>2]||(n=t),!(r>A[52+F>>2]||1^n|s<A[68+F>>2])){c[40+F>>2]=-1,c[28+F>>2]=L,t=c[e+8>>2],c[24+F>>2]=t,c[32+F>>2]=c[t+8>>2],c[36+F>>2]=176+F,c[44+F>>2]=P,c[5611]=c[5611]+1,c[16+F>>2]=-1,c[4+F>>2]=z,t=c[e+12>>2],c[F>>2]=t,c[8+F>>2]=c[t+8>>2],c[20+F>>2]=T,z=c[e+28>>2],t=c[z+12>>2],n=c[z+28>>2],c[12+F>>2]=112+F,L=t-1|0,t=g((t=((t=T<<16|P)<<15^-1)+t|0)>>>10^t,9);e:{if(!((0|n)<=(0|(t=L&((t=((t^=t>>>6)<<11^-1)+t|0)>>>16^t))))&&-1!=(0|(t=c[c[z+36>>2]+(t<<2)>>2])))for(L=c[z+16>>2];;){if(n=L+g(t,12)|0,c[n+4>>2]==(0|T)&&c[n>>2]==(0|P))break e;if(-1==(0|(t=c[c[z+56>>2]+(t<<2)>>2])))break}n=0}M>x(0)?(t=c[e+16>>2],n=0|pi[c[c[t>>2]+8>>2]](t,24+F|0,F,0,2)):n?n=c[n+8>>2]:(t=c[e+16>>2],n=0|pi[c[c[t>>2]+8>>2]](t,24+F|0,F,c[e+32>>2],1),t=c[e+28>>2],M=0|pi[c[c[t>>2]+12>>2]](t,P,T),c[8+M>>2]=n),t=c[e+24>>2],z=c[t+12>>2],L=c[t+8>>2],c[t+12>>2]=F,c[t+8>>2]=24+F,pi[c[c[t>>2]+8>>2]](t,-1,P),t=c[e+24>>2],pi[c[c[t>>2]+12>>2]](t,-1,T),pi[c[c[n>>2]+8>>2]](n,24+F|0,F,c[e+20>>2],c[e+24>>2]),e=c[e+24>>2],c[e+8>>2]=L,c[e+12>>2]=z}N=240+F|0},At,Se,ve,function(){},rn,At,function(e){var t,n;return c[(e|=0)>>2]=14248,p[e+8|0]&&(t=c[e+12>>2])&&(n=c[e+4>>2],pi[c[c[n>>2]+16>>2]](n,t)),0|e},function(e){var t,n;c[(e|=0)>>2]=14248,p[e+8|0]&&(t=c[e+12>>2])&&(n=c[e+4>>2],pi[c[c[n>>2]+16>>2]](n,t)),V(e)},function(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var a,r,s,l,_=x(0),u=x(0),h=x(0);N=i=N-32|0,(e=c[e+12>>2])&&(c[o+4>>2]=e,c[e+844>>2]=0,e=c[t+4>>2],_=x(A[e+36>>2]*A[e+20>>2]),e=c[n+4>>2],a=x(A[e+36>>2]*A[e+20>>2]),r=x(_+a),e=c[t+12>>2],t=c[n+12>>2],l=A[t+48>>2],s=x(A[e+48>>2]-l),n=A[t+52>>2],u=x(A[e+52>>2]-n),t=A[t+56>>2],h=x(A[e+56>>2]-t),_=x(T(x(x(x(s*s)+x(u*u))+x(h*h)))),x(r+A[o+32>>2])<_||(c[i+24>>2]=0,c[i+28>>2]=0,c[i+16>>2]=1065353216,c[i+20>>2]=0,r=x(_-r),_>x(1.1920928955078125e-7)?(c[i+28>>2]=0,_=x(x(1)/_),h=x(h*_),A[i+24>>2]=h,u=x(u*_),A[i+20>>2]=u,_=x(s*_),A[i+16>>2]=_):(_=x(1),h=x(0),u=x(0)),c[i+12>>2]=0,A[i+8>>2]=x(a*h)+t,A[i+4>>2]=x(a*u)+n,A[i>>2]=x(a*_)+l,pi[c[c[o>>2]+16>>2]](o,i+16|0,i,r))),N=i+32|0},rn,sn,ve,cn,function(e){var t,n;return c[(e|=0)>>2]=14384,p[e+8|0]&&(t=c[e+12>>2])&&(n=c[e+4>>2],pi[c[c[n>>2]+16>>2]](n,t)),0|e},function(e){var t,n;c[(e|=0)>>2]=14384,p[e+8|0]&&(t=c[e+12>>2])&&(n=c[e+4>>2],pi[c[c[n>>2]+16>>2]](n,t)),V(e)},function(e,t,n,i,o){t|=0,n|=0,i|=0,o|=0;var a,r,s,l,_,u,h,f,d,m,v;N=v=N-160|0,(a=c[12+(e|=0)>>2])&&(c[o+4>>2]=a,f=p[e+16|0],s=c[(r=f?n:t)+4>>2],c[152+v>>2]=c[(n=f?t:n)+4>>2],c[148+v>>2]=s,c[144+v>>2]=14324,A[156+v>>2]=A[a+848>>2]+A[o+32>>2],c[136+v>>2]=1566444395,t=c[r+12>>2],s=c[4+(r=t+8|0)>>2],c[(a=16+v|0)>>2]=c[r>>2],c[4+a>>2]=s,a=c[t>>2],r=c[t+4>>2],l=c[4+(_=t+24|0)>>2],c[(s=32+v|0)>>2]=c[_>>2],c[4+s>>2]=l,s=c[t+16>>2],_=c[t+20>>2],h=c[4+(u=t+40|0)>>2],c[(l=48+v|0)>>2]=c[u>>2],c[4+l>>2]=h,l=c[t+32>>2],u=c[t+36>>2],m=c[4+(d=t+56|0)>>2],c[(h=v+64|0)>>2]=c[d>>2],c[4+h>>2]=m,c[8+v>>2]=a,c[12+v>>2]=r,c[24+v>>2]=s,c[28+v>>2]=_,c[40+v>>2]=l,c[44+v>>2]=u,a=c[t+52>>2],c[56+v>>2]=c[t+48>>2],c[60+v>>2]=a,t=c[n+12>>2],r=c[4+(n=t+8|0)>>2],c[(a=80+v|0)>>2]=c[n>>2],c[4+a>>2]=r,n=c[t+4>>2],c[72+v>>2]=c[t>>2],c[76+v>>2]=n,a=c[t+20>>2],c[(n=88+v|0)>>2]=c[t+16>>2],c[n+4>>2]=a,r=c[4+(a=t+24|0)>>2],c[(n=96+v|0)>>2]=c[a>>2],c[n+4>>2]=r,r=c[4+(a=t+40|0)>>2],c[(n=112+v|0)>>2]=c[a>>2],c[n+4>>2]=r,a=c[t+36>>2],c[(n=104+v|0)>>2]=c[t+32>>2],c[n+4>>2]=a,a=c[t+52>>2],c[(n=120+v|0)>>2]=c[t+48>>2],c[n+4>>2]=a,a=c[4+(t=t+56|0)>>2],c[(n=128+v|0)>>2]=c[t>>2],c[n+4>>2]=a,cn(144+v|0,8+v|0,o,c[i+20>>2],f),p[e+8|0]&&(e=c[o+4>>2],c[e+844>>2]&&((0|(t=c[e+836>>2]))==(0|(n=c[c[o+8>>2]+8>>2]))?Bt(e,t+4|0,c[c[o+12>>2]+8>>2]+4|0):Bt(e,c[c[o+12>>2]+8>>2]+4|0,n+4|0)))),N=160+v|0},rn,sn,ve,ln,function(e){var t,n;return c[(e|=0)>>2]=14516,p[e+8|0]&&(t=c[e+12>>2])&&(n=c[e+4>>2],pi[c[c[n>>2]+16>>2]](n,t)),0|e},function(e){var t,n;c[(e|=0)>>2]=14516,p[e+8|0]&&(t=c[e+12>>2])&&(n=c[e+4>>2],pi[c[c[n>>2]+16>>2]](n,t)),V(e)},function(e,t,n,i,o){t|=0,n|=0,i|=0,o|=0;var a,r,s,l,_,u;N=u=N-160|0,(l=c[12+(e|=0)>>2])&&(c[o+4>>2]=l,l=c[t+4>>2],_=c[n+4>>2],t=c[t+12>>2],s=c[4+(r=t+8|0)>>2],c[(a=32+u|0)>>2]=c[r>>2],c[4+a>>2]=s,s=c[4+(r=t+24|0)>>2],c[(a=48+u|0)>>2]=c[r>>2],c[4+a>>2]=s,s=c[4+(r=t+40|0)>>2],c[(a=u+64|0)>>2]=c[r>>2],c[4+a>>2]=s,s=c[4+(r=t+56|0)>>2],c[(a=80+u|0)>>2]=c[r>>2],c[4+a>>2]=s,c[152+u>>2]=1566444395,a=c[t+4>>2],c[24+u>>2]=c[t>>2],c[28+u>>2]=a,a=c[t+20>>2],c[40+u>>2]=c[t+16>>2],c[44+u>>2]=a,a=c[t+36>>2],c[56+u>>2]=c[t+32>>2],c[60+u>>2]=a,a=c[t+52>>2],c[72+u>>2]=c[t+48>>2],c[76+u>>2]=a,t=c[n+12>>2],r=c[4+(n=t+8|0)>>2],c[(a=96+u|0)>>2]=c[n>>2],c[4+a>>2]=r,a=c[t+20>>2],c[(n=104+u|0)>>2]=c[t+16>>2],c[n+4>>2]=a,r=c[4+(a=t+24|0)>>2],c[(n=112+u|0)>>2]=c[a>>2],c[n+4>>2]=r,a=c[t+36>>2],c[(n=120+u|0)>>2]=c[t+32>>2],c[n+4>>2]=a,r=c[4+(a=t+40|0)>>2],c[(n=128+u|0)>>2]=c[a>>2],c[n+4>>2]=r,a=c[t+52>>2],c[(n=136+u|0)>>2]=c[t+48>>2],c[n+4>>2]=a,r=c[4+(a=t+56|0)>>2],c[(n=144+u|0)>>2]=c[a>>2],c[n+4>>2]=r,n=c[t+4>>2],c[88+u>>2]=c[t>>2],c[92+u>>2]=n,c[16+u>>2]=_,c[12+u>>2]=l,c[8+u>>2]=14464,ln(8+u|0,24+u|0,o,c[i+20>>2],0),p[e+8|0]&&(e=c[o+4>>2],c[e+844>>2]&&((0|(t=c[e+836>>2]))==(0|(n=c[c[o+8>>2]+8>>2]))?Bt(e,t+4|0,c[c[o+12>>2]+8>>2]+4|0):Bt(e,c[c[o+12>>2]+8>>2]+4|0,n+4|0)))),N=160+u|0},rn,sn,function(e){var t,n;return c[(e|=0)>>2]=14588,p[e+8|0]&&(t=c[e+12>>2])&&(n=c[e+4>>2],pi[c[c[n>>2]+16>>2]](n,t)),0|e},function(e){var t,n;c[(e|=0)>>2]=14588,p[e+8|0]&&(t=c[e+12>>2])&&(n=c[e+4>>2],pi[c[c[n>>2]+16>>2]](n,t)),V(e)},function(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var a,r,s,l,_,u,h,f,d,m,v,g,b,C,E,P,w,I,R,D,O,M,z,L,F,B,k,U,G,j,V,H,W=x(0),q=x(0),Y=x(0),X=x(0),Q=x(0),Z=x(0),J=x(0),K=x(0),$=x(0),ee=x(0),te=0,ne=x(0),ie=0,oe=x(0),ae=x(0),re=x(0),se=0,ce=x(0),le=x(0),_e=x(0),ue=x(0),he=x(0),de=x(0);if(N=i=N+-64|0,c[e+12>>2]){if(_=p[e+16|0],a=c[(ie=_?t:n)+12>>2],s=A[a+56>>2],re=A[a+52>>2],I=A[a+48>>2],r=c[(_=_?n:t)+12>>2],R=A[r+56>>2],D=A[r+52>>2],O=A[r+48>>2],te=c[_+4>>2],W=A[r+32>>2],q=A[r>>2],X=A[r+16>>2],d=A[r+36>>2],m=A[r+20>>2],v=A[r+4>>2],Y=A[a+40>>2],Z=A[a+24>>2],Q=A[a+8>>2],J=A[a+36>>2],f=A[a+20>>2],g=A[a+4>>2],_=c[ie+4>>2],b=A[a+32>>2],ee=A[r+40>>2],C=A[a+16>>2],ne=A[r+24>>2],E=A[a>>2],K=A[r+8>>2],c[i+60>>2]=0,F=x(x(x(K*g)+x(ne*f))+x(ee*J)),oe=x(-A[(r=_+60|0)>>2]),B=x(x(x(K*E)+x(ne*C))+x(ee*b)),ae=A[_+56>>2],k=x(x(x(K*Q)+x(ne*Z))+x(ee*Y)),ee=A[(se=_- -64|0)>>2],A[i+56>>2]=x(x(F*oe)-x(B*ae))-x(k*ee),u=x(x(x(v*g)+x(m*f))+x(d*J)),l=x(x(x(v*E)+x(m*C))+x(d*b)),h=x(x(x(v*Q)+x(m*Z))+x(d*Y)),A[i+52>>2]=x(x(u*oe)-x(ae*l))-x(ee*h),P=x(x(x(q*g)+x(X*f))+x(W*J)),w=x(x(x(q*E)+x(X*C))+x(W*b)),M=x(x(x(q*Q)+x(X*Z))+x(W*Y)),A[i+48>>2]=x(x(P*oe)-x(ae*w))-x(ee*M),pi[c[c[te>>2]+64>>2]](i,te,i+48|0),a=c[ie+12>>2],ce=A[a+48>>2],ee=A[a+32>>2],ne=A[a+16>>2],K=A[a+8>>2],oe=A[a+4>>2],ae=A[a>>2],le=A[a+56>>2],_e=A[a+52>>2],ue=A[a+40>>2],he=A[a+36>>2],$=A[a+24>>2],de=A[a+20>>2],L=A[_+72>>2],W=A[se>>2],q=A[_+56>>2],X=A[r>>2],a=c[e+12>>2],U=A[a+848>>2],d=A[i+8>>2],m=A[i>>2],v=A[i+4>>2],c[o+4>>2]=a,j=x(x(x(O*Q)+x(D*Z))+x(R*Y)),z=Z,Z=x(-re),re=x(x(j+x(x(x(z*Z)-x(Q*I))-x(Y*s)))+x(x(x(M*m)+x(h*v))+x(k*d))),Q=x(x(x(x(x(O*E)+x(D*C))+x(R*b))+x(x(x(C*Z)-x(E*I))-x(b*s)))+x(x(x(w*m)+x(l*v))+x(B*d))),J=x(x(x(x(x(O*g)+x(D*f))+x(R*J))+x(x(x(f*Z)-x(g*I))-x(J*s)))+x(x(x(P*m)+x(u*v))+x(F*d))),(Y=x(x(x(W*re)+x(x(q*Q)+x(X*J)))-L))<U&&(c[i+60>>2]=0,A[i+56>>2]=x(x(q*ee)+x(X*he))+x(W*ue),A[i+52>>2]=x(x(q*ne)+x(X*de))+x(W*$),A[i+48>>2]=x(x(ae*q)+x(oe*X))+x(K*W),c[i+44>>2]=0,Z=x(Q-x(q*Y)),Q=x(J-x(X*Y)),J=x(re-x(W*Y)),A[i+40>>2]=x(x(x(Z*ee)+x(Q*he))+x(J*ue))+le,A[i+36>>2]=x(x(x(Z*ne)+x(Q*de))+x(J*$))+_e,A[i+32>>2]=x(x(K*J)+x(x(ae*Z)+x(oe*Q)))+ce,pi[c[c[o>>2]+16>>2]](o,i+48|0,i+32|0,Y)),!(6<c[te+4>>2]||c[c[o+4>>2]+844>>2]>=c[e+24>>2]||(Z=A[_+64>>2],Q=x(y(Z))>x(.7071067690849304)?(Y=A[_+60>>2],Q=x(x(1)/x(T(x(x(Z*Z)+x(Y*Y))))),Y=x(Y*Q),Z=x(Q*x(-Z)),x(0)):(Y=A[_+56>>2],Q=A[_+60>>2],J=x(x(1)/x(T(x(x(Y*Y)+x(Q*Q))))),Z=x(Y*J),Y=x(0),x(J*x(-Q))),f=fe(J=x(x(S(x(x(.019999999552965164)/x(pi[c[c[te>>2]+16>>2]](te))),x(.39269909262657166)))*x(.5))),ie=c[e+20>>2],oe=pe(J),(0|ie)<1)))for(z=Y,Y=x(f/x(T(x(x(x(Q*Q)+x(Z*Z))+x(Y*Y))))),ae=x(z*Y),ue=x(Z*Y),he=x(Q*Y),se=0;r=p[e+16|0],a=c[(H=r?t:n)+12>>2],de=A[a+56>>2],L=A[a+52>>2],re=A[a+48>>2],r=c[(te=r?n:t)+12>>2],F=A[r+56>>2],B=A[r+52>>2],k=A[r+48>>2],V=c[te+4>>2],Y=A[a+40>>2],Z=A[a+8>>2],Q=A[a+24>>2],J=A[a+36>>2],f=A[a+4>>2],g=A[a+20>>2],te=c[H+4>>2],b=A[a+32>>2],I=A[r+40>>2],R=A[r+32>>2],D=A[r+36>>2],C=A[a>>2],O=A[r+8>>2],d=A[r>>2],m=A[r+4>>2],E=A[a+16>>2],v=A[r+24>>2],ee=A[r+16>>2],ne=A[r+20>>2],W=A[_+64>>2],q=A[_+56>>2],s=A[_+60>>2],c[i+44>>2]=0,X=x(x(x(x(6.2831854820251465)/x(0|ie))*x(0|se))*x(.5)),K=x(fe(X)/x(T(x(x(x(q*q)+x(s*s))+x(W*W))))),W=x(W*K),q=x(q*K),X=pe(X),s=x(s*K),u=x(x(ae*q)+x(x(x(ue*X)-x(oe*s))-x(he*W))),l=x(x(ae*W)+x(x(ue*s)+x(x(oe*X)+x(he*q)))),h=x(x(ue*W)+x(x(x(he*X)-x(oe*q))-x(ae*s))),P=x(x(he*s)+x(x(x(ae*X)-x(oe*W))-x(ue*q))),K=x(x(x(W*u)+x(x(q*l)+x(X*h)))-x(s*P)),$=x(x(x(q*P)+x(x(X*u)+x(s*l)))-x(W*h)),w=x(x(x(s*h)+x(x(W*l)+x(X*P)))-x(q*u)),W=x(x(x(x(X*l)-x(q*h))-x(s*u))-x(W*P)),q=x(x(2)/x(x(x(x(K*K)+x($*$))+x(w*w))+x(W*W))),X=x(w*q),M=x(K*X),s=x($*q),ce=x(W*s),u=x(M+ce),le=x($*X),l=x(K*q),_e=x(W*l),q=x(le-_e),U=x(K*l),G=x($*s),$=x(x(1)-x(U+G)),l=x(x(x(R*u)+x(D*q))+x(I*$)),h=x(x(x(d*u)+x(m*q))+x(O*$)),q=x(x(x(ee*u)+x(ne*q))+x(v*$)),$=x(-A[(r=te+60|0)>>2]),u=A[te+56>>2],P=A[(ie=te- -64|0)>>2],A[i+40>>2]=x(x(x(x(J*l)+x(x(f*h)+x(g*q)))*$)-x(u*x(x(b*l)+x(x(C*h)+x(E*q)))))-x(P*x(x(Y*l)+x(x(Z*h)+x(Q*q)))),q=x(le+_e),l=x(K*s),h=x(W*X),W=x(l-h),w=x(w*X),X=x(x(1)-x(U+w)),s=x(x(I*q)+x(x(R*W)+x(D*X))),K=x(x(O*q)+x(x(d*W)+x(m*X))),W=x(x(v*q)+x(x(ee*W)+x(ne*X))),A[i+36>>2]=x(x(x(x(J*s)+x(x(f*K)+x(g*W)))*$)-x(u*x(x(b*s)+x(x(C*K)+x(E*W)))))-x(P*x(x(Y*s)+x(x(Z*K)+x(Q*W)))),W=x(M-ce),q=x(l+h),X=x(x(1)-x(G+w)),s=x(x(I*W)+x(x(D*q)+x(R*X))),K=x(x(O*W)+x(x(m*q)+x(d*X))),W=x(x(v*W)+x(x(ne*q)+x(ee*X))),A[i+32>>2]=x(x(x(x(J*s)+x(x(f*K)+x(g*W)))*$)-x(u*x(x(b*s)+x(x(C*K)+x(E*W)))))-x(P*x(x(Y*s)+x(x(Z*K)+x(Q*W)))),pi[c[c[V>>2]+64>>2]](i+48|0,V,i+32|0),a=c[H+12>>2],U=A[a+48>>2],u=A[a+32>>2],l=A[a+16>>2],h=A[a+8>>2],P=A[a+4>>2],w=A[a>>2],G=A[a+56>>2],V=A[a+52>>2],M=A[a+40>>2],ce=A[a+36>>2],le=A[a+24>>2],_e=A[a+20>>2],H=A[te+72>>2],W=A[ie>>2],q=A[te+56>>2],X=A[r>>2],a=c[e+12>>2],z=A[a+848>>2],s=A[i+56>>2],K=A[i+48>>2],$=A[i+52>>2],c[o+4>>2]=a,j=z,L=x(-L),z=x(x(x(x(x(k*Z)+x(B*Q))+x(F*Y))+x(x(x(Q*L)-x(Z*re))-x(Y*de)))+x(x(x(K*x(x(x(d*Z)+x(ee*Q))+x(R*Y)))+x($*x(x(x(m*Z)+x(ne*Q))+x(D*Y))))+x(s*x(x(x(O*Z)+x(v*Q))+x(I*Y))))),Z=x(x(x(x(x(k*C)+x(B*E))+x(F*b))+x(x(x(E*L)-x(C*re))-x(b*de)))+x(x(x(K*x(x(x(d*C)+x(ee*E))+x(R*b)))+x($*x(x(x(m*C)+x(ne*E))+x(D*b))))+x(s*x(x(x(O*C)+x(v*E))+x(I*b))))),Q=x(x(x(x(x(k*f)+x(B*g))+x(F*J))+x(x(x(g*L)-x(f*re))-x(J*de)))+x(x(x(K*x(x(x(d*f)+x(ee*g))+x(R*J)))+x($*x(x(x(m*f)+x(ne*g))+x(D*J))))+x(s*x(x(x(O*f)+x(v*g))+x(I*J))))),(Y=x(x(x(W*z)+x(x(q*Z)+x(X*Q)))-H))<j&&(c[i+44>>2]=0,A[i+40>>2]=x(x(q*u)+x(X*ce))+x(W*M),A[i+36>>2]=x(x(q*l)+x(X*_e))+x(W*le),A[i+32>>2]=x(x(w*q)+x(P*X))+x(h*W),c[i+28>>2]=0,Z=x(Z-x(q*Y)),Q=x(Q-x(X*Y)),J=x(z-x(W*Y)),A[i+24>>2]=x(x(x(Z*u)+x(Q*ce))+x(J*M))+G,A[i+20>>2]=x(x(x(Z*l)+x(Q*_e))+x(J*le))+V,A[i+16>>2]=x(x(h*J)+x(x(w*Z)+x(P*Q)))+U,pi[c[c[o>>2]+16>>2]](o,i+32|0,i+16|0,Y)),(0|(se=se+1|0))<(0|(ie=c[e+20>>2])););p[e+8|0]&&c[c[e+12>>2]+844>>2]&&(e=c[o+4>>2],c[e+844>>2]&&((0|(t=c[e+836>>2]))==(0|(n=c[c[o+8>>2]+8>>2]))?Bt(e,t+4|0,c[c[o+12>>2]+8>>2]+4|0):Bt(e,c[c[o+12>>2]+8>>2]+4|0,n+4|0)))}N=i- -64|0},rn,sn,Se,ve,function(e,t,n,i,o,r,s,l,_,u){e|=0,t|=0,n|=0,i|=0,o|=0,r|=0,s|=0,l|=0,_|=0,u|=0;var h,f,d,v,y,b=x(0),S=x(0),C=x(0),E=x(0),P=x(0),w=x(0),I=x(0),R=x(0),D=0,M=x(0),z=0,L=x(0),F=x(0),B=0,k=x(0),U=x(0),G=x(0),j=x(0),V=x(0),H=x(0),W=x(0),q=0,Y=x(0),X=x(0),Q=x(0),Z=0,J=0;c[12+(N=y=N-19056|0)>>2]=0,A[y>>2]=A[r+48>>2]-A[o+48>>2],A[8+y>>2]=A[(e=r+56|0)>>2]-A[(t=o+56|0)>>2],A[4+y>>2]=A[(u=r+52|0)>>2]-A[(D=o+52|0)>>2],c[18916+y>>2]=i,c[18912+y>>2]=n,S=A[r+20>>2],E=A[r+36>>2],P=A[(z=o+20|0)>>2],C=A[(B=o+36|0)>>2],I=A[(q=o+24|0)>>2],w=A[r+24>>2],b=A[o+40>>2],R=A[r+40>>2],M=A[r+32>>2],F=A[r>>2],G=A[r+16>>2],j=A[r+4>>2],k=A[o+32>>2],U=A[o>>2],V=A[o+16>>2],H=A[o+4>>2],W=A[o+8>>2],L=A[r+8>>2],c[18964+y>>2]=0,c[18948+y>>2]=0,c[18932+y>>2]=0,Y=x(x(x(W*L)+x(I*w))+x(b*R)),A[18960+y>>2]=Y,X=x(x(x(H*L)+x(P*w))+x(C*R)),A[18956+y>>2]=X,w=x(x(x(U*L)+x(V*w))+x(k*R)),A[18952+y>>2]=w,R=x(x(x(W*j)+x(I*S))+x(b*E)),A[18944+y>>2]=R,L=x(x(x(H*j)+x(P*S))+x(C*E)),A[18940+y>>2]=L,S=x(x(x(U*j)+x(V*S))+x(k*E)),A[18936+y>>2]=S,E=x(x(x(F*W)+x(G*I))+x(M*b)),A[18928+y>>2]=E,P=x(x(x(F*H)+x(G*P))+x(M*C)),A[18924+y>>2]=P,C=x(x(x(F*U)+x(G*V))+x(M*k)),A[18920+y>>2]=C,I=A[z>>2],M=A[B>>2],F=A[q>>2],G=A[u>>2],j=A[D>>2],k=A[e>>2],U=A[t>>2],V=A[o>>2],H=A[o+16>>2],W=A[o+32>>2],Q=A[o+4>>2],h=A[o+8>>2],f=A[r+48>>2],d=A[o+48>>2],c[19036+y>>2]=0,c[19028+y>>2]=0,c[19012+y>>2]=0,A[19008+y>>2]=Y,A[19004+y>>2]=R,A[19e3+y>>2]=E,c[18996+y>>2]=0,A[18992+y>>2]=X,A[18988+y>>2]=L,A[18984+y>>2]=P,c[18980+y>>2]=0,A[18976+y>>2]=w,A[18972+y>>2]=S,S=x(f-d),E=x(G-j),w=b,b=x(k-U),A[19024+y>>2]=x(x(h*S)+x(F*E))+x(w*b),A[19020+y>>2]=x(x(S*Q)+x(E*I))+x(b*M),A[19016+y>>2]=x(x(S*V)+x(E*H))+x(b*W),c[19032+y>>2]=24,A[18968+y>>2]=C,c[(e=18664+y|0)>>2]=0,c[e+4>>2]=0,c[18656+y>>2]=0,c[18660+y>>2]=0,c[18892+y>>2]=0,c[18896+y>>2]=0,c[18904+y>>2]=2,c[18672+y>>2]=0,c[28+y>>2]=0,b=A[8+y>>2],A[24+y>>2]=-b,P=A[4+y>>2],A[20+y>>2]=-P,C=A[y>>2],A[16+y>>2]=-C;e:{t:{n:{i:{o:{if(1==(0|_n(18528+y|0,18912+y|0,16+y|0))){for(c[(e=y+64|0)>>2]=0,c[e+4>>2]=0,c[72+y>>2]=0,c[18508+y>>2]=0,c[16+y>>2]=9,c[18512+y>>2]=0,c[18516+y>>2]=0,c[56+y>>2]=0,u=14336,t=e=c[60+y>>2]=0;c[4148+(D=(16+y|0)+u|0)>>2]=e,D=D+4100|(c[D+4144>>2]=0),e&&(c[e+44>>2]=D),e=18452+(g(0-t|0,56)+y|0)|0,c[18520+y>>2]=D,t=t+1|0,u=u-56|0;);if(c[18524+y>>2]=256,D=c[18900+y>>2],m[D+32>>2]<2)break o;if(!function e(t){var n=0,i=0,o=0,a=0,r=x(0),s=x(0),l=x(0),_=x(0),u=x(0),h=0,f=x(0),p=x(0),d=x(0),m=x(0);a:{r:{s:{c:{l:{_:switch(n=c[t+372>>2],c[n+32>>2]-1|0){case 3:break s;case 2:break c;case 1:break l;case 0:break _;default:break r}if(c[n+32>>2]=2,c[n+20>>2]=0,o=c[t+364>>2]-1|0,c[t+364>>2]=o,h=n,n=c[348+((o<<2)+t|0)>>2],c[h+4>>2]=n,un(t,x(1),x(0),x(0),n),o=1,e(t))break a;if(n=c[t+372>>2],o=c[n+32>>2]-1|0,i=c[(o<<2)+n>>2],c[348+((c[t+364>>2]<<2)+t|0)>>2]=i,c[n+32>>2]=o,n=c[t+372>>2],a=c[n+32>>2],c[n+32>>2]=a+(o=1),c[(n=n+(a<<2)|0)>>2]=i,c[n+16>>2]=0,un(t,x(-1),x(-0),x(-0),i),e(t))break a;if(n=c[t+372>>2],o=c[n+32>>2]-1|0,i=c[(o<<2)+n>>2],c[348+((c[t+364>>2]<<2)+t|0)>>2]=i,c[n+32>>2]=o,n=c[t+372>>2],a=c[n+32>>2],c[n+32>>2]=a+(o=1),c[(n=n+(a<<2)|0)>>2]=i,c[n+16>>2]=0,un(t,x(0),x(1),x(0),i),e(t))break a;if(n=c[t+372>>2],o=c[n+32>>2]-1|0,i=c[(o<<2)+n>>2],c[348+((c[t+364>>2]<<2)+t|0)>>2]=i,c[n+32>>2]=o,n=c[t+372>>2],a=c[n+32>>2],c[n+32>>2]=a+(o=1),c[(n=n+(a<<2)|0)>>2]=i,c[n+16>>2]=0,un(t,x(-0),x(-1),x(-0),i),e(t))break a;if(n=c[t+372>>2],o=c[n+32>>2]-1|0,i=c[(o<<2)+n>>2],c[348+((c[t+364>>2]<<2)+t|0)>>2]=i,c[n+32>>2]=o,n=c[t+372>>2],a=c[n+32>>2],c[n+32>>2]=a+(o=1),c[(n=n+(a<<2)|0)>>2]=i,c[n+16>>2]=0,un(t,x(0),x(0),x(1),i),e(t))break a;if(n=c[t+372>>2],o=c[n+32>>2]-1|0,i=c[(o<<2)+n>>2],c[348+((c[t+364>>2]<<2)+t|0)>>2]=i,c[n+32>>2]=o,n=c[t+372>>2],a=c[n+32>>2],c[n+32>>2]=a+(o=1),c[(n=n+(a<<2)|0)>>2]=i,c[n+16>>2]=0,un(t,x(-0),x(-0),x(-1),i),e(t))break a;i=c[t+364>>2],c[t+364>>2]=i+1,n=c[t+372>>2],o=c[n+32>>2]-1|0,c[n+32>>2]=o,c[348+((i<<2)+t|0)>>2]=c[n+(o<<2)>>2];break r}if(o=1,i=c[n+4>>2],a=c[n>>2],p=x(A[i+16>>2]-A[a+16>>2]),s=x(p*x(0)),d=x(A[i+20>>2]-A[a+20>>2]),r=x(s-d),l=x(d*x(0)),m=x(A[i+24>>2]-A[a+24>>2]),f=x(m*x(0)),_=x(l-f),u=x(m-s),x(x(r*r)+x(x(_*_)+x(u*u)))>x(0)){if(c[n+32>>2]=3,c[n+24>>2]=0,i=c[t+364>>2]-1|0,c[t+364>>2]=i,h=n,n=c[348+((i<<2)+t|0)>>2],un(t,_,u,r,c[h+8>>2]=n),e(t))break a;if(n=c[t+372>>2],o=c[n+32>>2]-1|0,i=c[(o<<2)+n>>2],c[348+((c[t+364>>2]<<2)+t|0)>>2]=i,c[n+32>>2]=o,n=c[t+372>>2],a=c[n+32>>2],c[n+32>>2]=a+(o=1),c[(n=n+(a<<2)|0)>>2]=i,c[n+16>>2]=0,un(t,x(-_),x(-u),x(-r),i),e(t))break a;i=c[t+364>>2],c[t+364>>2]=i+1,n=c[t+372>>2],o=c[n+32>>2]-1|0,c[n+32>>2]=o,c[348+((i<<2)+t|0)>>2]=c[n+(o<<2)>>2]}if(r=x(p-l),_=x(l-m),u=x(f-s),x(x(r*r)+x(x(_*_)+x(u*u)))>x(0)){if(a=c[t+364>>2]-1|0,c[t+364>>2]=a,n=c[t+372>>2],i=c[n+32>>2],c[n+32>>2]=i+(o=1),c[16+(n=n+(i<<2)|0)>>2]=0,h=n,n=c[348+((a<<2)+t|0)>>2],un(t,_,u,r,c[h>>2]=n),e(t))break a;if(n=c[t+372>>2],o=c[n+32>>2]-1|0,i=c[(o<<2)+n>>2],c[348+((c[t+364>>2]<<2)+t|0)>>2]=i,c[n+32>>2]=o,n=c[t+372>>2],a=c[n+32>>2],c[n+32>>2]=a+(o=1),c[(n=n+(a<<2)|0)>>2]=i,c[n+16>>2]=0,un(t,x(-_),x(-u),x(-r),i),e(t))break a;i=c[t+364>>2],c[t+364>>2]=i+1,n=c[t+372>>2],o=c[n+32>>2]-1|0,c[n+32>>2]=o,c[348+((i<<2)+t|0)>>2]=c[n+(o<<2)>>2]}if(o=1,s=x(s-l),r=x(d-f),l=x(f-p),!(x(x(s*s)+x(x(r*r)+x(l*l)))>x(0)))break r;if(a=c[t+364>>2]-1|0,c[t+364>>2]=a,n=c[t+372>>2],i=c[n+32>>2],c[n+32>>2]=i+1,c[16+(n=n+(i<<2)|0)>>2]=0,h=n,n=c[348+((a<<2)+t|0)>>2],un(t,r,l,s,c[h>>2]=n),e(t))break a;if(n=c[t+372>>2],o=c[n+32>>2]-1|0,i=c[(o<<2)+n>>2],c[348+((c[t+364>>2]<<2)+t|0)>>2]=i,c[n+32>>2]=o,n=c[t+372>>2],a=c[n+32>>2],c[n+32>>2]=a+(o=1),c[(n=n+(a<<2)|0)>>2]=i,c[n+16>>2]=0,un(t,x(-r),x(-l),x(-s),i),e(t))break a;i=c[t+364>>2],c[t+364>>2]=i+1,n=c[t+372>>2],o=c[n+32>>2]-1|0,c[n+32>>2]=o,c[348+((i<<2)+t|0)>>2]=c[n+(o<<2)>>2];break r}if(o=1,i=c[n+4>>2],a=c[n>>2],s=A[a+16>>2],l=x(A[i+16>>2]-s),h=c[n+8>>2],r=A[a+20>>2],f=x(A[h+20>>2]-r),r=x(A[i+20>>2]-r),_=x(A[h+16>>2]-s),s=x(x(l*f)-x(r*_)),d=r,r=A[a+24>>2],u=x(A[h+24>>2]-r),p=x(A[i+24>>2]-r),r=x(x(d*u)-x(p*f)),l=x(x(p*_)-x(l*u)),!(x(x(s*s)+x(x(r*r)+x(l*l)))>x(0)))break r;if(c[(i=n+28|0)>>2]=0,c[i+4>>2]=4,i=c[t+364>>2]-1|0,c[t+364>>2]=i,h=n,n=c[348+((i<<2)+t|0)>>2],un(t,r,l,s,c[h+12>>2]=n),e(t))break a;if(n=c[t+372>>2],o=c[n+32>>2]-1|0,i=c[(o<<2)+n>>2],c[348+((c[t+364>>2]<<2)+t|0)>>2]=i,c[n+32>>2]=o,n=c[t+372>>2],a=c[n+32>>2],c[n+32>>2]=a+(o=1),c[(n=n+(a<<2)|0)>>2]=i,c[n+16>>2]=0,un(t,x(-r),x(-l),x(-s),i),e(t))break a;i=c[t+364>>2],c[t+364>>2]=i+1,n=c[t+372>>2],o=c[n+32>>2]-1|0,c[n+32>>2]=o,c[348+((i<<2)+t|0)>>2]=c[n+(o<<2)>>2];break r}if(o=1,t=c[n>>2],i=c[n+12>>2],s=A[i+16>>2],f=x(A[t+16>>2]-s),a=c[n+4>>2],r=A[i+20>>2],_=x(A[a+20>>2]-r),n=c[n+8>>2],l=A[i+24>>2],u=x(A[n+24>>2]-l),p=x(A[t+20>>2]-r),d=x(A[a+24>>2]-l),m=x(A[n+16>>2]-s),l=x(A[t+24>>2]-l),s=x(A[a+16>>2]-s),r=x(A[n+20>>2]-r),(s=x(x(x(x(f*_)*u)+x(x(x(x(x(p*d)*m)+x(x(l*s)*r))-x(x(f*d)*r))-x(x(p*s)*u)))-x(x(l*_)*m)))>x(0)|s<x(0))break a}o=0}return o}(18528+y|0))break o;if(e=c[18512+y>>2]){for(u=c[18516+y>>2],t=c[18524+y>>2];(z=c[e+48>>2])&&(c[z+44>>2]=c[e+44>>2]),(z=c[e+44>>2])&&(c[z+48>>2]=c[e+48>>2]),c[18512+y>>2]==(0|e)&&(c[18512+y>>2]=c[e+48>>2]),c[e+44>>2]=0,c[e+48>>2]=c[18520+y>>2],(z=c[18520+y>>2])&&(c[z+44>>2]=e),u=u-1|0,c[18520+y>>2]=e,t=t+1|0,e=c[18512+y>>2];);c[18524+y>>2]=t,c[18516+y>>2]=u}if(c[18508+y>>2]=0,c[16+y>>2]=0,u=c[D>>2],t=c[D+12>>2],S=A[t+16>>2],w=x(A[u+16>>2]-S),e=c[D+4>>2],E=A[t+20>>2],R=x(A[e+20>>2]-E),z=c[D+8>>2],I=A[t+24>>2],M=x(A[z+24>>2]-I),F=x(A[u+20>>2]-E),G=x(A[e+24>>2]-I),j=x(A[z+16>>2]-S),I=x(A[u+24>>2]-I),S=x(A[e+16>>2]-S),E=x(A[z+20>>2]-E),x(x(x(x(w*R)*M)+x(x(x(x(x(F*G)*j)+x(x(I*S)*E))-x(x(w*G)*E))-x(x(F*S)*M)))-x(x(I*R)*j))<x(0)?(c[D+4>>2]=u,c[D>>2]=e,O=c[D+16>>2],c[D+16>>2]=c[D+20>>2],c[D+20>>2]=O,t=u):(t=e,e=u),t=fn(16+y|0,e,t,z,1),z=fn(16+y|0,c[D+4>>2],c[D>>2],c[D+12>>2],1),q=fn(16+y|0,c[D+8>>2],c[D+4>>2],c[D+12>>2],1),B=fn(16+y|0,c[D>>2],c[D+8>>2],c[D+12>>2],1),4!=c[18516+y>>2])break o;if(e=c[18512+y>>2],b=A[e+16>>2],u=c[e+48>>2]){for(b=x(b*b);S=A[u+16>>2],e=(D=(S=x(S*S))<b)?u:e,b=D?S:b,u=c[u+48>>2];);b=A[e+16>>2]}for(D=c[e+28>>2],Z=c[e+24>>2],J=c[e+20>>2],E=A[e+12>>2],P=A[e+8>>2],C=A[e+4>>2],S=A[e>>2],c[t+32>>2]=z,a[t+52|0]=0,c[z+32>>2]=t,a[z+52|0]=0,c[t+36>>2]=q,a[t+53|0]=0,c[q+32>>2]=t,a[q+52|0]=1,c[t+40>>2]=B,a[t+54|0]=0,c[B+32>>2]=t,a[B+52|0]=2,c[z+36>>2]=B,a[z+53|0]=2,c[B+40>>2]=z,a[B+54|0]=1,c[z+40>>2]=q,a[z+54|0]=1,c[q+36>>2]=z,a[0|(t=q+53|0)]=2,a[t+1|0]=1,c[q+40>>2]=B,c[B+36>>2]=q,a[B+53|0]=2,z=c[16+y>>2]=0;;){a:{r:{if(!((t=c[18508+y>>2])>>>0<=127)){c[16+y>>2]=6;break a}if(a[e+55|0]=z=z+1|0,c[19048+y>>2]=0,c[19040+y>>2]=0,c[19044+y>>2]=0,c[18508+y>>2]=t+1,un(18528+y|0,A[e>>2],A[(u=e+4|0)>>2],A[(B=e+8|0)>>2],q=60+(t=(16+y|0)+(t<<5)|0)|0),!(x(x(x(x(A[e>>2]*A[t+76>>2])+x(A[u>>2]*A[t+80>>2]))+x(A[B>>2]*A[t+84>>2]))-A[e+16>>2])>x(9999999747378752e-20))){c[16+y>>2]=7;break a}for(u=0,t=32;;){if(!(B=function e(t,n,i,o,r,s){var l,_,u=0;s:if(p[o+55|0]!=(0|n)){if(_=c[14656+(l=r<<2)>>2],x(x(x(x(A[o>>2]*A[i+16>>2])+x(A[o+4>>2]*A[i+20>>2]))+x(A[o+8>>2]*A[i+24>>2]))-A[o+16>>2])<x(-9999999747378752e-21)){if(!(t=fn(n=t,c[(t=o+20|0)+(_<<2)>>2],c[t+l>>2],i,0)))break s;return c[t+32>>2]=o,a[t+52|0]=r,a[52+(o+r|0)|0]=0,c[32+((r<<2)+o|0)>>2]=t,(n=c[s>>2])?(c[n+36>>2]=t,a[n+53|0]=2,c[t+40>>2]=n,a[t+54|0]=1):c[s+4>>2]=t,c[s>>2]=t,c[s+8>>2]=c[s+8>>2]+1,1}e(t,a[o+55|0]=n,i,c[32+((_<<2)+o|0)>>2],p[52+(o+_|0)|0],s)&&(r=n,n=c[14668+l>>2],e(t,r,i,c[32+((n<<2)+o|0)>>2],p[52+(n+o|0)|0],s)&&((n=c[o+48>>2])&&(c[n+44>>2]=c[o+44>>2]),(n=c[o+44>>2])&&(c[n+48>>2]=c[o+48>>2]),c[t+18496>>2]==(0|o)&&(c[t+18496>>2]=c[o+48>>2]),c[o+44>>2]=0,c[o+48>>2]=c[t+18504>>2],c[(n=t+18500|0)>>2]=c[n>>2]-1,(n=c[t+18504>>2])&&(c[n+44>>2]=o),c[t+18504>>2]=o,c[(t=t+18508|0)>>2]=c[t>>2]+(u=1)))}return u}(16+y|0,z,q,c[e+t>>2],p[52+(e+u|0)|0],19040+y|0)))break r;if(t=t+4|0,v=u>>>0<2,u=u+1|0,!v)break}}if(B&2<m[19048+y>>2]){if(t=c[19040+y>>2],a[t+53|0]=2,u=c[19044+y>>2],c[t+36>>2]=u,c[u+40>>2]=t,a[u+54|0]=1,(t=c[e+48>>2])&&(c[t+44>>2]=c[e+44>>2]),(t=c[e+44>>2])&&(c[t+48>>2]=c[e+48>>2]),c[18512+y>>2]==(0|e)&&(c[18512+y>>2]=c[e+48>>2]),c[e+44>>2]=0,c[e+48>>2]=c[18520+y>>2],c[18516+y>>2]=c[18516+y>>2]-1,(t=c[18520+y>>2])&&(c[t+44>>2]=e),c[18520+y>>2]=e,c[18524+y>>2]=c[18524+y>>2]+1,e=c[18512+y>>2],b=A[e+16>>2],u=c[e+48>>2]){for(b=x(b*b);S=A[u+16>>2],e=(t=(S=x(S*S))<b)?u:e,b=t?S:b,u=c[u+48>>2];);b=A[e+16>>2]}if(D=c[e+28>>2],Z=c[e+24>>2],J=c[e+20>>2],E=A[e+12>>2],P=A[e+8>>2],C=A[e+4>>2],S=A[e>>2],255!=(0|z))continue}else c[16+y>>2]=4}break}if(A[68+y>>2]=E,A[y+64>>2]=P,A[60+y>>2]=C,A[72+y>>2]=b,A[56+y>>2]=S,e=36+y|0,S=x(S*b),I=x(A[Z+16>>2]-S),t=D+20|0,E=x(C*b),C=x(A[t>>2]-E),w=x(A[(u=Z+20|0)>>2]-E),R=x(A[D+16>>2]-S),M=x(x(I*C)-x(w*R)),b=x(P*b),P=x(A[D+24>>2]-b),L=x(w*P),w=x(A[(z=Z+24|0)>>2]-b),C=x(L-x(w*C)),L=x(C*C),C=x(x(w*R)-x(I*P)),C=x(T(x(x(M*M)+x(L+x(C*C))))),A[e>>2]=C,c[20+y>>2]=J,B=40+y|0,I=x(A[D+16>>2]-S),w=x(A[(q=J+20|0)>>2]-E),R=x(A[t>>2]-E),M=x(A[J+16>>2]-S),F=x(x(I*w)-x(R*M)),L=R,R=x(A[(t=J+24|0)>>2]-b),w=x(x(L*R)-x(P*w)),P=x(x(P*M)-x(I*R)),P=x(T(x(x(F*F)+x(x(w*w)+x(P*P))))),A[B>>2]=P,c[52+y>>2]=3,c[28+y>>2]=D,c[24+y>>2]=Z,L=x((R=C)+P),C=x(A[J+16>>2]-S),I=x(A[u>>2]-E),E=x(A[q>>2]-E),S=x(A[Z+16>>2]-S),w=x(x(C*I)-x(E*S)),M=E,E=x(A[z>>2]-b),b=x(A[t>>2]-b),I=x(x(M*E)-x(b*I)),b=x(x(b*S)-x(C*E)),S=x(T(x(x(w*w)+x(x(I*I)+x(b*b))))),b=x(L+S),A[e>>2]=R/b,A[44+y>>2]=S/b,A[B>>2]=P/b,9!=c[16+y>>2]){if(c[52+y>>2])break i;S=x(0),C=x(0),P=x(0);break n}}if(c[18532+y>>2]=i,c[18528+y>>2]=n,F=A[r+32>>2],G=A[r>>2],j=A[r+16>>2],k=A[r+36>>2],U=A[r+4>>2],V=A[r+20>>2],b=A[o+32>>2],S=A[o>>2],E=A[o+16>>2],P=A[o+36>>2],C=A[o+4>>2],I=A[o+20>>2],w=A[o+40>>2],H=A[r+40>>2],R=A[o+8>>2],W=A[r+8>>2],M=A[o+24>>2],L=A[r+24>>2],c[18580+y>>2]=0,c[18564+y>>2]=0,c[18548+y>>2]=0,c[18652+y>>2]=0,c[18644+y>>2]=0,c[18628+y>>2]=0,c[18612+y>>2]=0,c[18596+y>>2]=0,Y=x(x(x(R*W)+x(M*L))+x(w*H)),A[18576+y>>2]=Y,X=x(x(x(C*W)+x(I*L))+x(P*H)),A[18572+y>>2]=X,H=x(x(x(S*W)+x(E*L))+x(b*H)),A[18568+y>>2]=H,W=x(x(x(R*U)+x(M*V))+x(w*k)),A[18560+y>>2]=W,L=x(x(x(C*U)+x(I*V))+x(P*k)),A[18556+y>>2]=L,k=x(x(x(S*U)+x(E*V))+x(b*k)),A[18552+y>>2]=k,U=x(x(x(G*R)+x(j*M))+x(F*w)),A[18544+y>>2]=U,V=x(x(x(G*C)+x(j*I))+x(F*P)),A[18540+y>>2]=V,A[18624+y>>2]=Y,A[18620+y>>2]=W,A[18616+y>>2]=U,A[18608+y>>2]=X,A[18604+y>>2]=L,A[18600+y>>2]=V,A[18592+y>>2]=H,A[18588+y>>2]=k,L=R,R=x(A[r+48>>2]-A[o+48>>2]),k=M,M=x(A[r+52>>2]-A[o+52>>2]),U=w,w=x(A[r+56>>2]-A[o+56>>2]),A[18640+y>>2]=x(x(L*R)+x(k*M))+x(U*w),A[18636+y>>2]=x(x(R*C)+x(M*I))+x(w*P),A[18632+y>>2]=x(x(R*S)+x(M*E))+x(w*b),c[18648+y>>2]=25,b=x(x(x(G*S)+x(j*E))+x(F*b)),A[18536+y>>2]=b,A[18584+y>>2]=b,c[(e=152+y|0)>>2]=0,c[e+4>>2]=0,c[144+y>>2]=0,c[148+y>>2]=0,c[380+y>>2]=0,c[384+y>>2]=0,c[392+y>>2]=2,!_n(16+y|(c[160+y>>2]=0),18528+y|0,y)){if(u=c[388+y>>2],c[u+32>>2])for(F=x(0),M=x(t=e=0),R=x(0),w=x(0),I=x(0),E=x(0);b=A[16+(i=e+u|0)>>2],n=c[18648+y>>2],r=c[18652+y>>2],u=c[18528+y>>2]+(r>>1)|0,pi[0|(1&r?c[n+c[u>>2]>>2]:n)](18912+y|0,u,c[i>>2]),n=c[c[388+y>>2]+e>>2],S=A[n+8>>2],P=A[n>>2],C=x(-A[n+4>>2]),n=c[18648+y>>2],i=c[18652+y>>2],r=c[18532+y>>2]+(i>>1)|0,n=1&i?c[n+c[r>>2]>>2]:n,F=x(F+x(b*A[18920+y>>2])),M=x(M+x(b*A[18916+y>>2])),R=x(R+x(b*A[18912+y>>2])),c[19052+y>>2]=0,A[19048+y>>2]=x(x(A[18572+y>>2]*C)-x(P*A[18568+y>>2]))-x(S*A[18576+y>>2]),A[19044+y>>2]=x(x(A[18556+y>>2]*C)-x(P*A[18552+y>>2]))-x(S*A[18560+y>>2]),A[19040+y>>2]=x(x(A[18540+y>>2]*C)-x(P*A[18536+y>>2]))-x(S*A[18544+y>>2]),pi[0|n](18912+y|0,r,19040+y|0),S=A[18912+y>>2],P=A[18916+y>>2],C=A[18920+y>>2],w=x(w+x(b*x(x(x(x(S*A[18616+y>>2])+x(P*A[18620+y>>2]))+x(C*A[18624+y>>2]))+A[18640+y>>2]))),I=x(I+x(b*x(x(x(x(S*A[18600+y>>2])+x(P*A[18604+y>>2]))+x(C*A[18608+y>>2]))+A[18636+y>>2]))),E=x(E+x(b*x(x(x(x(S*A[18584+y>>2])+x(P*A[18588+y>>2]))+x(C*A[18592+y>>2]))+A[18632+y>>2]))),e=e+4|0,u=c[388+y>>2],(t=t+1|0)>>>0<m[u+32>>2];);else E=x(0),I=x(0),w=x(0),R=x(0),M=x(0),F=x(0);P=x(R-E),C=x(M-I),S=x(F-w),b=(b=x(T(x(x(x(P*P)+x(C*C))+x(S*S)))))>x(9999999747378752e-20)?x(x(1)/b):x(1),S=x(S*b),G=x(C*b),C=x(P*b),k=A[o+32>>2],U=A[o+36>>2],V=A[o+40>>2],H=A[o+56>>2],P=x(x(x(x(E*k)+x(I*U))+x(w*V))+H),W=A[o+16>>2],L=A[o+20>>2],Y=A[o+24>>2],X=A[o+52>>2],j=x(x(x(x(E*W)+x(I*L))+x(w*Y))+X),Q=A[o>>2],h=A[o+4>>2],b=w,w=A[o+8>>2],f=A[o+48>>2],b=x(x(x(x(E*Q)+x(I*h))+x(b*w))+f),E=x(x(x(x(R*k)+x(M*U))+x(F*V))+H),I=x(x(x(x(R*W)+x(M*L))+x(F*Y))+X),w=x(x(x(x(R*Q)+x(M*h))+x(F*w))+f),e=0;break t}e=0;break e}c[16+y>>2]=8,S=x(0),E=x(1),I=x(0),(w=x(T(x(x(x(C*C)+x(P*P))+x(b*b)))))>x(0)&&(E=x(x(1)/w),I=x(E*b),S=x(E*P),E=x(E*C)),c[52+y>>2]=1,c[36+y>>2]=1065353216,c[68+y>>2]=0,c[72+y>>2]=0,A[64+y>>2]=I,A[60+y>>2]=S,A[56+y>>2]=E,c[20+y>>2]=c[D>>2]}for(e=36+y|0,P=x(0),C=x(t=0),S=x(0);n=c[19032+y>>2],i=c[19036+y>>2],r=c[18912+y>>2]+(i>>1)|0,pi[0|(1&i?c[n+c[r>>2]>>2]:n)](19040+y|0,r,c[e-16>>2]),b=A[e>>2],P=x(P+x(b*A[19048+y>>2])),C=x(C+x(b*A[19044+y>>2])),S=x(S+x(A[19040+y>>2]*b)),e=e+4|0,(t=t+1|0)>>>0<m[52+y>>2];);}R=A[o+32>>2],M=A[o+36>>2],F=A[o+40>>2],G=A[o+56>>2],E=x(x(x(x(S*R)+x(C*M))+x(P*F))+G),j=A[o+16>>2],k=A[o+20>>2],U=A[o+24>>2],V=A[o+52>>2],I=x(x(x(x(S*j)+x(C*k))+x(P*U))+V),H=A[o>>2],W=A[o+4>>2],L=A[o+8>>2],Y=A[o+48>>2],w=x(x(x(x(S*H)+x(C*W))+x(P*L))+Y),X=A[56+y>>2],b=A[72+y>>2],S=x(S-x(X*b)),Q=x(S*R),R=A[60+y>>2],C=x(C-x(b*R)),Q=x(Q+x(C*M)),M=A[y+64>>2],b=x(P-x(b*M)),P=x(x(Q+x(b*F))+G),j=x(x(x(x(S*j)+x(C*k))+x(b*U))+V),b=x(x(x(x(S*H)+x(C*W))+x(b*L))+Y),C=x(-X),S=x(-M),G=x(-R),e=1}c[l+12>>2]=0,A[l+8>>2]=E,A[l+4>>2]=I,A[l>>2]=w,c[_+12>>2]=0,A[_+8>>2]=P,A[_+4>>2]=j,A[_>>2]=b,c[s+12>>2]=0,A[s+8>>2]=S,A[s+4>>2]=G,A[s>>2]=C}return N=19056+y|0,0|e},ve,qe,qe,function(e,t,n,i){e|=0,t|=0,n|=0,i=x(i);var o,r=c[t+4>>2];c[e+4>>2]=c[t>>2],c[e+8>>2]=r,o=c[4+(t=t+8|0)>>2],c[(r=e+12|0)>>2]=c[t>>2],c[4+r>>2]=o,t=c[n+4>>2],c[e+20>>2]=c[n>>2],c[e+24>>2]=t,r=c[4+(n=n+8|0)>>2],c[(t=e+28|0)>>2]=c[n>>2],c[t+4>>2]=r,a[e+40|0]=1,A[e+36>>2]=i},ve,function(e,t,n,i,o,r,s,l,_,u){e|=0,t|=0,n|=0,i|=0,o|=0,r|=0,s|=0,l|=0,_|=0,u|=0;var h,f,d,m,v,g,y,b=0,S=x(0),C=0,E=x(0),T=x(0),P=0,w=x(0),I=x(0),R=x(0),D=0,O=x(0),M=x(0),z=x(0),L=x(0),F=x(0),B=0,k=x(0),U=0,G=0,j=0,V=0,H=x(0);for(N=e=N-4240|0,m=c[n+4>>2]-17>>>0<=1?c[i+4>>2]-17>>>0<2:0;dn(),c[12+(b=(e+1264|0)+C|0)>>2]=0,O=A[C+22452>>2],S=x(-O),I=A[C+22448>>2],R=A[C+22456>>2],A[b+8>>2]=x(x(A[o+24>>2]*S)-x(I*A[o+8>>2]))-x(R*A[o+40>>2]),A[b+4>>2]=x(x(A[o+20>>2]*S)-x(I*A[o+4>>2]))-x(R*A[o+36>>2]),A[b>>2]=x(x(A[o+16>>2]*S)-x(I*A[o>>2]))-x(R*A[o+32>>2]),k=A[r+32>>2],M=A[r>>2],z=A[r+16>>2],L=A[r+36>>2],F=A[r+4>>2],w=A[r+20>>2],E=A[r+40>>2],T=A[r+8>>2],S=A[r+24>>2],c[12+(b=(e+272|0)+C|0)>>2]=0,A[b+8>>2]=x(x(I*T)+x(O*S))+x(R*E),A[b+4>>2]=x(x(I*F)+x(O*w))+x(R*L),A[b>>2]=x(x(I*M)+x(O*z))+x(R*k),672!=(0|(C=C+16|0)););if(b=42,!((0|(U=0|pi[c[c[n>>2]+84>>2]](n)))<1)){for(D=e+3256|0,C=0;pi[c[c[n>>2]+88>>2]](n,B,e+3248|0),E=A[e+3248>>2],T=A[e+3252>>2],S=A[D>>2],A[D>>2]=x(x(E*A[o+32>>2])+x(T*A[o+36>>2]))+x(S*A[o+40>>2]),c[e+3260>>2]=0,A[e+3252>>2]=x(x(E*A[o+16>>2])+x(T*A[o+20>>2]))+x(S*A[o+24>>2]),A[e+3248>>2]=x(x(E*A[o>>2])+x(T*A[o+4>>2]))+x(S*A[o+8>>2]),dn(),b=c[D+4>>2],c[(P=C+23128|0)>>2]=c[D>>2],c[P+4>>2]=b,b=c[e+3252>>2],c[(P=C+23120|0)>>2]=c[e+3248>>2],c[P+4>>2]=b,c[684+(b=(e+1264|0)+C|0)>>2]=0,T=A[e+3252>>2],S=x(-T),w=A[e+3248>>2],E=A[D>>2],A[b+680>>2]=x(x(A[o+24>>2]*S)-x(w*A[o+8>>2]))-x(E*A[o+40>>2]),A[b+676>>2]=x(x(A[o+20>>2]*S)-x(w*A[o+4>>2]))-x(E*A[o+36>>2]),A[b+672>>2]=x(x(A[o+16>>2]*S)-x(w*A[o>>2]))-x(E*A[o+32>>2]),c[684+(b=(e+272|0)+C|0)>>2]=0,A[b+672>>2]=x(x(w*A[r>>2])+x(T*A[r+16>>2]))+x(E*A[r+32>>2]),A[b+676>>2]=x(x(w*A[r+4>>2])+x(T*A[r+20>>2]))+x(E*A[r+36>>2]),A[b+680>>2]=x(x(w*A[r+8>>2])+x(T*A[r+24>>2]))+x(E*A[r+40>>2]),C=C+16|0,(0|U)!=(0|(B=B+1|0)););b=B+42|0}if(v=n,g=e+1264|0,y=e+3248|0,1<=(0|(B=0|pi[c[c[i>>2]+84>>2]](i)))){for(f=b<<4,G=e+272|0,j=e+1264|0,V=22448,C=0;pi[c[c[i>>2]+88>>2]](i,C,e+3248|0),E=A[(h=e+3256|0)>>2],T=A[e+3248>>2],S=A[e+3252>>2],A[h>>2]=x(x(T*A[r+32>>2])+x(S*A[r+36>>2]))+x(E*A[r+40>>2]),c[e+3260>>2]=0,A[e+3252>>2]=x(x(T*A[r+16>>2])+x(S*A[r+20>>2]))+x(E*A[r+24>>2]),A[e+3248>>2]=x(x(T*A[r>>2])+x(S*A[r+4>>2]))+x(E*A[r+8>>2]),dn(),P=c[4+h>>2],c[(U=8+(D=f+V|0)|0)>>2]=c[h>>2],c[U+4>>2]=P,P=c[e+3252>>2],c[D>>2]=c[e+3248>>2],c[D+4>>2]=P,c[12+(P=f+j|0)>>2]=0,T=A[e+3252>>2],S=x(-T),w=A[e+3248>>2],E=A[h>>2],A[P+8>>2]=x(x(A[o+24>>2]*S)-x(w*A[o+8>>2]))-x(E*A[o+40>>2]),A[P+4>>2]=x(x(A[o+20>>2]*S)-x(w*A[o+4>>2]))-x(E*A[o+36>>2]),A[P>>2]=x(x(A[o+16>>2]*S)-x(w*A[o>>2]))-x(E*A[o+32>>2]),c[12+(P=f+G|0)>>2]=0,A[P>>2]=x(x(w*A[r>>2])+x(T*A[r+16>>2]))+x(E*A[r+32>>2]),A[P+4>>2]=x(x(w*A[r+4>>2])+x(T*A[r+20>>2]))+x(E*A[r+36>>2]),A[P+8>>2]=x(x(w*A[r+8>>2])+x(T*A[r+24>>2]))+x(E*A[r+40>>2]),V=V+16|0,j=j+16|0,G=G+16|0,(0|B)!=(0|(C=C+1|0)););b=C+b|0}if(pi[c[c[n>>2]+76>>2]](v,g,y,b),pi[c[c[i>>2]+76>>2]](i,e+272|0,e+2256|0,b),(0|b)<1)F=x(0xde0b6b000000000),M=x(0),z=x(0),L=x(0);else for(F=x(0xde0b6b000000000),L=x(C=0),z=x(0),M=x(0);dn(),w=A[C+22448>>2],E=A[C+22452>>2],T=m?x(0):A[C+22456>>2],.01<+x(x(x(w*w)+x(E*E))+x(T*T))&&(d=A[(P=(e+2256|0)+C|0)>>2],I=A[P+4>>2],R=A[P+8>>2],O=A[(P=(e+3248|0)+C|0)>>2],k=A[P+4>>2],S=A[P+8>>2],(S=x(x(x(w*x(x(x(x(x(d*A[r>>2])+x(I*A[r+4>>2]))+x(R*A[r+8>>2]))+A[r+48>>2])-x(x(x(x(O*A[o>>2])+x(k*A[o+4>>2]))+x(S*A[o+8>>2]))+A[o+48>>2])))+x(E*x(x(x(x(x(d*A[r+16>>2])+x(I*A[r+20>>2]))+x(R*A[r+24>>2]))+A[r+52>>2])-x(x(x(x(O*A[o+16>>2])+x(k*A[o+20>>2]))+x(S*A[o+24>>2]))+A[o+52>>2]))))+x(T*x(m?0:x(x(x(x(d*A[r+32>>2])+x(I*A[r+36>>2]))+x(R*A[r+40>>2]))+A[r+56>>2])-x(x(x(x(O*A[o+32>>2])+x(k*A[o+36>>2]))+x(S*A[o+40>>2]))+A[o+56>>2])))))<F&&(H=A[C+22460>>2],M=w,z=E,L=T,F=S)),C=C+16|0,b=b-1|0;);if(1<<(b=c[n+4>>2])&11571&&b>>>0<=13||x(pi[c[c[n>>2]+48>>2]](n)),1<<(b=c[i+4>>2])&11571&&b>>>0<=13||x(pi[c[c[i>>2]+48>>2]](i)),!(F<x(C=0))){e:{switch(c[n+4>>2]){case 8:S=x(A[n+36>>2]*A[n+20>>2]);break e;case 0:case 1:case 13:case 11:case 10:S=A[n+52>>2];break e;case 4:case 5:S=A[n+52>>2];break e}S=x(pi[c[c[n>>2]+48>>2]](n))}e:{t:{n:{i:{o:{a:{r:{s:{c:switch(0|(C=c[i+4>>2])){case 4:case 5:break n;case 10:break i;case 11:break o;case 13:break a;case 1:break r;case 0:break s;case 8:break c;default:break t}E=x(A[i+36>>2]*A[i+20>>2]),C=8;break e}E=A[i+52>>2],C=0;break e}E=A[i+52>>2],C=1;break e}E=A[i+52>>2],C=13;break e}E=A[i+52>>2],C=11;break e}E=A[i+52>>2],C=10;break e}E=A[i+52>>2];break e}E=x(pi[c[c[i>>2]+48>>2]](i)),C=c[i+4>>2]}c[(b=P=e+204|0)>>2]=0,c[b+4>>2]=0,c[e+224>>2]=i,c[e+220>>2]=n,c[e+216>>2]=t,c[e+212>>2]=0,c[e+196>>2]=0,c[e+200>>2]=1065353216,c[e+192>>2]=12272,c[e+232>>2]=C,c[e+228>>2]=c[n+4>>2],g=e,y=x(pi[c[c[n>>2]+48>>2]](n)),A[g+236>>2]=y,T=x(pi[c[c[i>>2]+48>>2]](i)),c[e+264>>2]=1,c[e+268>>2]=1,c[e+252>>2]=-1,a[e+244|0]=0,A[e+240>>2]=T,c[e+116>>2]=0,t=c[4+(n=o+8|0)>>2],c[(i=e- -64|0)>>2]=c[n>>2],c[i+4>>2]=t,t=c[4+(n=o+24|0)>>2],c[(i=e+80|0)>>2]=c[n>>2],c[i+4>>2]=t,t=c[4+(n=o+40|0)>>2],c[(i=e+96|0)>>2]=c[n>>2],c[i+4>>2]=t,T=x(F+x(x(S+E)+x(.5))),A[e+112>>2]=x(L*T)+A[o+56>>2],A[e+108>>2]=x(z*T)+A[o+52>>2],t=c[o+4>>2],c[e+56>>2]=c[o>>2],c[e+60>>2]=t,t=c[o+20>>2],c[e+72>>2]=c[o+16>>2],c[e+76>>2]=t,t=c[o+36>>2],c[e+88>>2]=c[o+32>>2],c[e+92>>2]=t,A[e+104>>2]=x(M*T)+A[o+48>>2],t=c[4+(n=r+8|0)>>2],c[(i=e+128|0)>>2]=c[n>>2],c[i+4>>2]=t,t=c[r+20>>2],c[(n=e+136|0)>>2]=c[r+16>>2],c[n+4>>2]=t,t=c[4+(n=r+24|0)>>2],c[(i=e+144|0)>>2]=c[n>>2],c[i+4>>2]=t,t=c[r+36>>2],c[(n=e+152|0)>>2]=c[r+32>>2],c[n+4>>2]=t,t=c[4+(n=r+40|0)>>2],c[(i=e+160|0)>>2]=c[n>>2],c[i+4>>2]=t,t=c[r+52>>2],c[(n=e+168|0)>>2]=c[r+48>>2],c[n+4>>2]=t,t=c[4+(n=r+56|0)>>2],c[(i=e+176|0)>>2]=c[n>>2],c[i+4>>2]=t,c[e+184>>2]=1566444395,t=c[r+4>>2],c[e+120>>2]=c[r>>2],c[e+124>>2]=t,A[e+200>>2]=-z,A[b>>2]=-L,c[e+208>>2]=0,A[e+196>>2]=-M,a[e+48|0]=0,c[e+8>>2]=14800,Gt(e+192|0,e+56|0,e+8|0,u,0),(i=p[e+48|0])&&(S=A[e+44>>2],c[l+12>>2]=0,S=x(T-S),A[l>>2]=A[e+28>>2]-x(M*S),A[l+8>>2]=A[(o=e+36|0)>>2]-x(L*S),A[l+4>>2]=A[e+32>>2]-x(z*S),t=c[e+32>>2],c[_>>2]=c[e+28>>2],c[_+4>>2]=t,t=c[o+4>>2],c[(n=_+8|0)>>2]=c[o>>2],c[n+4>>2]=t,A[s>>2]=M,A[s+4>>2]=z,A[s+8>>2]=L,A[s+12>>2]=H),C=0!=(0|i)}return N=e+4240|0,0|C},An,function(e){V(An(e|=0))},Mt,Ot,function(e,t,n){e|=0,n|=0;var i;if(!(i=8!=(0|(t|=0)))&&8==(0|n))return c[e+56>>2];if(!i&&1==(0|n))return c[e+72>>2];if(1==(0|t)&&8==(0|n))return c[e+76>>2];if(!(t|n))return c[e+68>>2];if(!(19<(0|t))&&28==(0|n))return c[e+84>>2];if(28==(0|t)&&!(19<(0|n)))return c[e+80>>2];e:{if((0|t)<=19){if((0|n)<=19)return c[e+28>>2];if(8<n-21>>>0)break e;return c[e+32>>2]}if(!(19<(0|n)||8<t-21>>>0))return c[e+36>>2];if(31==(0|t))return 31==(0|n)?c[e+44>>2]:c[e+40>>2]}return 31==(0|n)?c[e+48>>2]:c[e+52>>2]},function(e,t,n){e|=0,n|=0;var i;if(!(i=8!=(0|(t|=0)))&&8==(0|n))return c[e+56>>2];if(!i&&1==(0|n))return c[e+72>>2];if(1==(0|t)&&8==(0|n))return c[e+76>>2];if(!(19<(0|t))&&28==(0|n))return c[e+84>>2];if(28==(0|t)&&!(19<(0|n)))return c[e+80>>2];e:{if((0|t)<=19){if((0|n)<=19)return c[e+28>>2];if(8<n-21>>>0)break e;return c[e+32>>2]}if(!(19<(0|n)||8<t-21>>>0))return c[e+36>>2];if(31==(0|t))return 31==(0|n)?c[e+44>>2]:c[e+40>>2]}return 31==(0|n)?c[e+48>>2]:c[e+52>>2]},Se,ve,function(e,t,n,i){return e|=0,n|=0,i|=0,e=c[(t|=0)>>2],e=0|pi[c[c[e>>2]+56>>2]](e,80),c[e+8>>2]=13344,c[e>>2]=13316,c[e+60>>2]=0,c[e+48>>2]=i,c[e+44>>2]=n,t=c[t>>2],c[e+4>>2]=t,c[e+56>>2]=t,t=0|pi[c[c[t>>2]+12>>2]](t,c[n+8>>2],c[i+8>>2]),c[e+72>>2]=t,n=c[e+56>>2],pi[c[c[n>>2]+20>>2]](n,t),(a[e+76|0]=0)|e},ve,function(e,t,n,i){return e|=0,n|=0,i|=0,e=c[(t|=0)>>2],e=0|pi[c[c[e>>2]+56>>2]](e,80),c[e+8>>2]=13344,c[e>>2]=13316,c[e+60>>2]=0,c[e+48>>2]=n,c[e+44>>2]=i,t=c[t>>2],c[e+4>>2]=t,c[e+56>>2]=t,t=0|pi[c[c[t>>2]+12>>2]](t,c[i+8>>2],c[n+8>>2]),c[e+72>>2]=t,n=c[e+56>>2],pi[c[c[n>>2]+20>>2]](n,t),a[e+76|0]=1,0|e},ve,function(e,t,n,i){return e|=0,n|=0,i|=0,e=c[(t|=0)>>2],e=0|pi[c[c[e>>2]+56>>2]](e,84),c[e+52>>2]=0,c[e+56>>2]=0,a[e+24|0]=1,c[e>>2]=13820,c[e+20>>2]=0,a[e+44|0]=1,c[e+12>>2]=0,c[e+16>>2]=0,c[e+40>>2]=0,a[e+64|0]=1,c[e+32>>2]=0,c[e+36>>2]=0,c[e+60>>2]=0,a[e+68|0]=0,a[e+76|0]=0,c[e+4>>2]=c[t>>2],c[e+72>>2]=c[t+4>>2],c[e+80>>2]=c[c[n+4>>2]+76>>2],Jt(e,n,i),0|e},ve,function(e,t,n,i){e|=0,n|=0,i|=0;var o,r=0,s=0;return e=c[(t|=0)>>2],e=0|pi[c[c[e>>2]+56>>2]](e,116),c[e+52>>2]=0,c[e+56>>2]=0,a[e+24|0]=1,c[e>>2]=13820,c[e+20>>2]=0,a[e+44|0]=1,c[e+12>>2]=0,c[e+16>>2]=0,c[e+40>>2]=0,a[e+64|0]=1,c[e+32>>2]=0,c[e+36>>2]=0,c[e+60>>2]=0,a[e+68|0]=0,a[e+76|0]=0,c[e+4>>2]=c[t>>2],c[e+72>>2]=c[t+4>>2],c[e+80>>2]=c[c[n+4>>2]+76>>2],Jt(e,n,i),a[e+104|0]=1,c[e>>2]=14028,c[e+100>>2]=0,c[e+92>>2]=0,c[e+96>>2]=0,o=c[5498],t=0,(r=M(83))&&(c[(t=r+19&-16)-4>>2]=r),a[t+20|0]=1,c[t>>2]=13964,c[t+16>>2]=0,a[t+40|0]=1,c[t+8>>2]=0,c[t+12>>2]=0,c[t+36>>2]=0,a[t+60|0]=1,c[t+28>>2]=0,c[t+32>>2]=0,c[t+56>>2]=0,c[t+48>>2]=0,c[t+52>>2]=0,c[5498]=o+2,(r=M(43))&&(c[(s=r+19&-16)-4>>2]=r),(r=c[t+16>>2])&&(c[5499]=c[5499]+1,z(c[r-4>>2])),c[t+16>>2]=s,a[t+20|0]=1,c[t+12>>2]=2,tn(t),c[e+84>>2]=t,c[e+108>>2]=c[c[n+4>>2]+76>>2],c[e+112>>2]=c[c[i+4>>2]+76>>2],0|e},ve,function(e,t,n,i){return e|=0,n|=0,i|=0,e=c[(t|=0)>>2],e=0|pi[c[c[e>>2]+56>>2]](e,84),c[e+52>>2]=0,c[e+56>>2]=0,a[e+24|0]=1,c[e>>2]=13820,c[e+20>>2]=0,a[e+44|0]=1,c[e+12>>2]=0,c[e+16>>2]=0,c[e+40>>2]=0,a[e+64|0]=1,c[e+32>>2]=0,c[e+36>>2]=0,c[e+60>>2]=0,a[e+68|0]=1,a[e+76|0]=0,c[e+4>>2]=c[t>>2],c[e+72>>2]=c[t+4>>2],c[e+80>>2]=c[c[i+4>>2]+76>>2],Jt(e,n,i),0|e},ve,function(e,t){return e|=0,e=c[(t|=0)>>2],e=0|pi[c[c[e>>2]+56>>2]](e,8),c[e>>2]=14188,c[e+4>>2]=c[t>>2],0|e},ve,function(e,t,n,i){return e|=0,n|=0,i|=0,e=c[(t|=0)>>2],e=0|pi[c[c[e>>2]+56>>2]](e,16),c[e>>2]=14248,a[e+8|0]=0,t=c[t>>2],c[e+4>>2]=t,t=(c[e+12>>2]=0)|pi[c[c[t>>2]+12>>2]](t,c[n+8>>2],c[i+8>>2]),a[e+8|0]=1,c[e+12>>2]=t,0|e},ve,function(e,t,n,i){e|=0,n|=0,i|=0;var o,r=c[(t|=0)>>2];return r=0|pi[c[c[r>>2]+56>>2]](r,20),a[8+r|0]=0,c[r>>2]=14384,o=c[t>>2],c[4+r>>2]=o,a[16+r|0]=p[e+4|0],e=c[t+4>>2],(c[12+r>>2]=e)||(e=0|pi[c[c[o>>2]+12>>2]](o,c[n+8>>2],c[i+8>>2]),a[8+r|0]=1,c[12+r>>2]=e),0|r},ve,function(e,t,n,i){return e|=0,n|=0,i|=0,e=c[(t|=0)>>2],e=0|pi[c[c[e>>2]+56>>2]](e,16),c[e>>2]=14516,a[e+8|0]=0,t=c[t>>2],c[e+4>>2]=t,(c[e+12>>2]=0)|pi[c[c[t>>2]+24>>2]](t,c[n+8>>2],c[i+8>>2])&&(t=c[e+4>>2],t=0|pi[c[c[t>>2]+12>>2]](t,c[n+8>>2],c[i+8>>2]),a[e+8|0]=1,c[e+12>>2]=t),0|e},ve,function(e,t,n,i){e|=0,n|=0,i|=0;var o,r,s=c[(t|=0)>>2];return s=0|pi[c[c[s>>2]+56>>2]](s,28),o=c[e+12>>2],r=c[e+8>>2],c[s>>2]=14588,a[8+s|0]=0,c[20+s>>2]=r,c[24+s>>2]=o,o=p[e+4|0],a[16+s|0]=o,e=c[t>>2],c[12+s>>2]=0,c[4+s>>2]=e,0|pi[c[c[e>>2]+24>>2]](e,c[(t=o?i:n)+8>>2],c[(n=o?n:i)+8>>2])&&(e=c[4+s>>2],e=0|pi[c[c[e>>2]+12>>2]](e,c[t+8>>2],c[n+8>>2]),a[8+s|0]=1,c[12+s>>2]=e),0|s},function(e){var t=0;return c[(e|=0)>>2]=16084,(t=c[e+20>>2])&&p[e+24|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+20>>2]=0,a[e+24|0]=1,c[(t=e+12|0)>>2]=0,(c[t+4>>2]=0)|e},function(e){var t;c[(e|=0)>>2]=16084,(t=c[e+20>>2])&&p[e+24|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),V(e)},function(e,t,n,i,o){e|=0,t|=0,n|=0,o|=0;var a,r;return c[12+(N=r=N-16|0)>>2]=i|=0,c[8+r>>2]=e,i=c[c[n+4>>2]+4>>2],a=c[c[t+4>>2]+4>>2],e=1!=(0|o)?c[5260+((g(a,144)+e|0)+(i<<2)|0)>>2]:c[76+((g(a,144)+e|0)+(i<<2)|0)>>2],e=0|pi[c[c[e>>2]+8>>2]](e,8+r|0,t,n),N=16+r|0,0|e},function(e,t,n){e|=0,t|=0,n|=0;var i,o,r,s=0,l=0,_=x(0),u=x(0),h=0;N=r=N-16|0,c[5861]=c[5861]+1,s=2&c[e+4>>2]?(s=c[t+192>>2],_=x(pi[c[c[s>>2]+20>>2]](s,x(.019999999552965164))),A[12+r>>2]=_,s=c[n+192>>2],u=x(pi[c[c[s>>2]+20>>2]](s,x(.019999999552965164))),_<(A[8+r>>2]=u)?12+r|0:8+r|0):12260,o=A[s>>2],_=A[n+184>>2],u=A[t+184>>2],s=c[e+72>>2];e:{if(l=c[s+12>>2])c[s+12>>2]=c[l>>2],c[s+8>>2]=c[s+8>>2]-1;else{if(4&p[e+4|(l=0)])break e;c[5498]=c[5498]+1,(s=M(887))&&(c[(l=s+19&-16)-4>>2]=s)}if(c[l+120>>2]=0,c[l+124>>2]=0,c[l>>2]=1025,c[l+328>>2]=0,c[l+332>>2]=0,c[l+536>>2]=0,c[l+540>>2]=0,c[(s=l+128|0)>>2]=0,c[s+4>>2]=0,c[(s=l+136|0)>>2]=0,c[s+4>>2]=0,c[(s=l+144|0)>>2]=0,c[s+4>>2]=0,c[(s=l+152|0)>>2]=0,c[s+4>>2]=0,c[(s=l+160|0)>>2]=0,c[s+4>>2]=0,c[l+168>>2]=0,c[(s=l+336|0)>>2]=0,c[s+4>>2]=0,c[(s=l+344|0)>>2]=0,c[s+4>>2]=0,c[(s=l+352|0)>>2]=0,c[s+4>>2]=0,c[(s=l+360|0)>>2]=0,c[s+4>>2]=0,c[(s=l+368|0)>>2]=0,c[s+4>>2]=0,c[l+376>>2]=0,c[(s=l+544|0)>>2]=0,c[s+4>>2]=0,c[(s=l+552|0)>>2]=0,c[s+4>>2]=0,c[(s=l+560|0)>>2]=0,c[s+4>>2]=0,c[(s=l+568|0)>>2]=0,c[s+4>>2]=0,c[(s=l+576|0)>>2]=0,c[s+4>>2]=0,c[l+584>>2]=0,c[l+792>>2]=0,c[(s=l+784|0)>>2]=0,c[s+4>>2]=0,c[(s=l+776|0)>>2]=0,c[s+4>>2]=0,c[(s=l+768|0)>>2]=0,c[s+4>>2]=0,c[(s=l+760|0)>>2]=0,c[s+4>>2]=0,c[(s=l+752|0)>>2]=0,c[s+4>>2]=0,c[l+744>>2]=0,c[l+748>>2]=0,c[l+836>>2]=t,c[l+840>>2]=n,c[l+844>>2]=0,A[l+848>>2]=o,A[l+852>>2]=u<_?u:_,s=c[e+12>>2],c[l+864>>2]=s,c[e+16>>2]==(0|s)&&!((0|(i=s?s<<1:1))<=(0|s))){if(i&&(c[5498]=c[5498]+1,(t=M(19+(i<<2)|0))&&(c[(h=t+19&-16)-4>>2]=t)),1<=(0|s))for(t=0,n=s;c[t+h>>2]=c[c[e+20>>2]+t>>2],t=t+4|0,n=n-1|0;);(t=c[e+20>>2])&&p[e+24|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2]),s=c[e+12>>2]),c[e+20>>2]=h,c[e+16>>2]=i,a[e+24|0]=1}c[e+12>>2]=s+1,c[c[e+20>>2]+(s<<2)>>2]=l}return N=16+r|0,0|l},function(e,t){var n,i,o,a,r,s,l,_;if(e|=0,t|=0,c[5861]=c[5861]-1,pi[c[c[e>>2]+20>>2]](e,t),i=c[(n=e+20|0)>>2],a=c[t+864>>2],s=c[(o=i+(r=a<<2)|0)>>2],l=o,_=i,o=c[(i=e+12|0)>>2]-1|0,c[l>>2]=c[_+(_=o<<2)>>2],c[c[n>>2]+_>>2]=s,c[i>>2]=o,c[c[c[n>>2]+r>>2]+864>>2]=a,e=c[e+72>>2],!(t>>>0<(n=c[e+16>>2])>>>0||n+g(c[e>>2],c[e+4>>2])>>>0<=t>>>0))return c[t>>2]=c[e+12>>2],c[e+12>>2]=t,void(c[e+8>>2]=c[e+8>>2]+1);c[5499]=c[5499]+1,z(c[t-4>>2])},function(e,t){c[844+(t|=0)>>2]=0},function(e,t,n){e|=0,n|=0;e:{t:{n:switch(c[220+(t|=0)>>2]-2|0){case 0:case 3:break n;default:break t}switch(c[n+220>>2]-2|(e=0)){case 0:case 3:break e;default:break t}}if(!c[t+280>>2]||0|pi[c[c[t>>2]+12>>2]](t,n)){if(e=1,!c[n+280>>2])break e;if(0|pi[c[c[n>>2]+12>>2]](n,t))break e}e=0}return 0|e},function(e,t,n){if(e|=0,n|=0,!(4&(t=c[204+(t|=e=0)>>2])||4&(n=c[n+204>>2]))){if(!(3&t))return 1;e=!(3&n)}return 0|e},function(e,t,n,i){t|=0,n|=0,i|=0;var o;c[8+(N=o=N-16|0)>>2]=e|=0,c[4+o>>2]=n,c[o>>2]=16168,pi[c[c[t>>2]+48>>2]](t,o,i),N=16+o|0},function(e){return c[12+(e|=0)>>2]},function(e,t){return c[c[20+(e|=0)>>2]+((t|=0)<<2)>>2]},function(e){return c[12+(e|=0)>>2]?c[e+20>>2]:0},vn,vn,function(e,t){var n;return t|=0,e=c[68+(e|=0)>>2],(n=c[e+12>>2])?(c[e+12>>2]=c[n>>2],c[e+8>>2]=c[e+8>>2]-1,0|n):(e=0,c[5498]=c[5498]+1,(t=M(t+19|0))&&(c[(e=t+19&-16)-4>>2]=t),0|e)},function(e,t){var n;if(e|=0,t|=0){if(e=c[e+68>>2],!(t>>>0<(n=c[e+16>>2])>>>0||g(c[e>>2],c[e+4>>2])+n>>>0<=t>>>0))return c[t>>2]=c[e+12>>2],c[e+12>>2]=t,void(c[e+8>>2]=c[e+8>>2]+1);c[5499]=c[5499]+1,z(c[t-4>>2])}},Se,ve,function(e,t){var n;return n=t|=0,t=c[8+(e|=0)>>2],pi[c[t+64>>2]](n,t,c[e+4>>2]),0},function(e){var t=0;return c[(e|=0)>>2]=16280,(t=c[e+60>>2])&&p[e- -64|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+60>>2]=0,a[e- -64|0]=1,c[(t=e+52|0)>>2]=0,c[t+4>>2]=0,(t=c[e+40>>2])&&p[e+44|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+40>>2]=0,a[e+44|0]=1,c[(t=e+32|0)>>2]=0,c[t+4>>2]=0,(t=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+16>>2]=0,a[e+20|0]=1,c[(t=e+8|0)>>2]=0,(c[t+4>>2]=0)|e},function(e){var t=0;c[(e|=0)>>2]=16280,(t=c[e+60>>2])&&p[e- -64|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+60>>2]=0,a[e- -64|0]=1,c[(t=e+52|0)>>2]=0,c[t+4>>2]=0,(t=c[e+40>>2])&&p[e+44|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+40>>2]=0,a[e+44|0]=1,c[(t=e+32|0)>>2]=0,c[t+4>>2]=0,(t=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+16>>2]=0,a[e+20|0]=1,c[(t=e+8|0)>>2]=0,c[t+4>>2]=0,c[5499]=c[5499]+1,z(c[e-4>>2])},function(e,t,n){e|=0,t|=0,n|=0;var i,o,r,s,l,_,u,h=0,f=0,d=0,m=0,A=0,v=0;c[5865]=c[5865]+1;e:{t:{if(h=c[e+24>>2]){if(0|pi[c[c[h>>2]+8>>2]](h,t,n))break t;break e}if(!(c[n+8>>2]&c[t+4>>2]))break e;if(!(c[t+8>>2]&c[n+4>>2]))break e}if(h=c[t+12>>2]>c[n+12>>2],d=c[(i=h?t:n)+12>>2],m=c[(o=h?n:t)+12>>2],t=g((t=((t=d<<16|m)<<15^-1)+t|0)>>>10^t,9),h=c[e+12>>2],-1!=(0|(t=c[c[e+40>>2]+((v=(s=(t=((t^=t>>>6)<<11^-1)+t|0)>>>16^t)&h-1)<<2)>>2])))for(n=c[e+16>>2];;){if(f=(A=t<<4)+n|0,(0|d)==c[c[4+(n+A|0)>>2]+12>>2]&&(0|m)==c[c[f>>2]+12>>2])break e;if(-1==(0|(t=c[c[e+60>>2]+(t<<2)>>2])))break}if((0|(t=h))==(0|(n=m=c[e+8>>2]))&&(n=h,!((0|(d=t?t<<1:1))<=(0|t)))){if(n=0,d&&(c[5498]=c[5498]+1,(t=M(19+(d<<4)|0))&&(c[(n=t+19&-16)-4>>2]=t)),1<=(0|h))for(t=12,f=h;r=c[e+16>>2]+t|0,c[(A=t+n|0)-12>>2]=c[r-12>>2],u=c[4+(l=r-8|0)>>2],c[(_=A-8|0)>>2]=c[l>>2],c[4+_>>2]=u,c[A>>2]=c[r>>2],t=t+16|0,f=f-1|0;);(t=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+16>>2]=n,c[e+12>>2]=d,a[e+20|0]=1,n=c[e+8>>2],t=d}c[e+8>>2]=n+1,n=c[e+16>>2],(f=c[e+68>>2])&&(pi[c[c[f>>2]+8>>2]](f,o,i),t=c[e+12>>2]),f=n+(m<<4)|0,(0|h)<(0|t)&&(gn(e),v=c[e+12>>2]-1&s),h=c[i+12>>2],d=c[o+12>>2],c[8+(t=n+(m<<4)|0)>>2]=0,c[t+12>>2]=0,c[(n=t)+4>>2]=(t=(0|d)<(0|h))?i:o,c[f>>2]=t?o:i,t=c[e+60>>2]+(m<<2)|0,e=c[e+40>>2]+(v<<2)|0,c[t>>2]=c[e>>2],c[e>>2]=m}return 0|f},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o=0,a=0,r=0,s=0,l=0,_=0,u=0,h=0;c[5864]=c[5864]+1,o=c[t+12>>2]>c[n+12>>2],a=c[(l=o?t:n)+12>>2],r=c[(_=o?n:t)+12>>2],t=g((t=((t=a<<16|r)<<15^-1)+t|0)>>>10^t,9),s=c[e+12>>2]-1&((t=((t^=t>>>6)<<11^-1)+t|0)>>>16^t);e:if(-1!=(0|(t=c[c[e+40>>2]+(s<<2)>>2]))){for(o=c[e+16>>2];(0|a)!=c[c[4+(n=o+(t<<4)|0)>>2]+12>>2]||(0|r)!=c[c[n>>2]+12>>2];)if(-1==(0|(t=c[c[e+60>>2]+(t<<2)>>2])))break e;pi[c[c[e>>2]+32>>2]](e,n,i),u=c[12+(o+(t<<4)|0)>>2],a=c[e+60>>2];t:{if(r=c[e+40>>2]+(s<<2)|0,(0|(t=c[r>>2]))!=(0|(o=n-c[e+16>>2]>>4))){for(;(0|o)!=(0|(t=c[(s=a+((n=t)<<2)|0)>>2])););if(-1!=(0|n)){c[s>>2]=c[a+(o<<2)>>2];break t}}c[r>>2]=c[a+(o<<2)>>2]}if(a=c[e+8>>2]-1|0,(t=c[e+68>>2])&&pi[c[c[t>>2]+12>>2]](t,_,l,i),(0|o)==(0|a))return c[e+8>>2]=c[e+8>>2]-1,0|u;l=c[e+60>>2];t:{if(_=c[e+16>>2],t=c[c[4+(i=_+(a<<4)|0)>>2]+12>>2]<<16|c[c[i>>2]+12>>2],t=g((t=(t<<15^-1)+t|0)>>>10^t,9),r=c[e+12>>2]-1&((t=((t^=t>>>6)<<11^-1)+t|0)>>>16^t),s=c[e+40>>2]+(r<<2)|0,(0|a)!=(0|(t=c[s>>2]))){for(;(0|a)!=(0|(t=c[(h=l+((n=t)<<2)|0)>>2])););if(-1!=(0|n)){c[h>>2]=c[l+(a<<2)>>2];break t}}c[s>>2]=c[l+(a<<2)>>2]}n=c[i+4>>2],c[(t=_+(o<<4)|0)>>2]=c[i>>2],c[t+4>>2]=n,i=c[4+(n=i+8|0)>>2],c[(t=t+8|0)>>2]=c[n>>2],c[t+4>>2]=i,t=c[e+40>>2]+(r<<2)|0,c[c[e+60>>2]+(o<<2)>>2]=c[t>>2],c[t>>2]=o,c[e+8>>2]=c[e+8>>2]-1}return 0|u},function(e,t,n){e|=0,n|=0;var i;c[12+(N=i=N-16|0)>>2]=t|=0,c[8+i>>2]=16512,pi[c[c[e>>2]+48>>2]](e,8+i|0,n),N=16+i|0},nn,nn,Pe,function(e,t,n){e|=0,t|=0,(n|=0)&&(e=c[t+8>>2])&&(pi[c[c[e>>2]>>2]](e),pi[c[c[n>>2]+60>>2]](n,c[t+8>>2]),c[t+8>>2]=0)},function(e){return c[8+(e|=0)>>2]},function(e,t,n){e|=0,t|=0;var i;c[12+(N=i=N-16|0)>>2]=n|=0,c[8+i>>2]=e,c[4+i>>2]=t,c[i>>2]=16368,pi[c[c[e>>2]+48>>2]](e,i,n),N=16+i|0},function(e,t){c[24+(e|=0)>>2]=t|=0},function(e,t,n){t|=0,n|=0;var i,o=0;if(1<=c[8+(e|=0)>>2])for(;i=c[e+16>>2]+(o<<4)|0,0|pi[c[c[t>>2]+8>>2]](t,i)?(pi[c[c[e>>2]+12>>2]](e,c[i>>2],c[4+i>>2],n),c[5863]=c[5863]-1):o=o+1|0,c[e+8>>2]>(0|o););},function(e,t,n){e|=0,t|=0,n|=0;var i,o,a=0;c[5862]=c[5862]+1,a=c[t+12>>2]>c[n+12>>2],i=c[(a?t:n)+12>>2],o=c[(a?n:t)+12>>2],t=g((t=((t=o|i<<16)<<15^-1)+t|0)>>>10^t,9);e:{if(!((0|(t=c[e+12>>2]-1&((t=((t^=t>>>6)<<11^-1)+t|0)>>>16^t)))>=c[e+32>>2])&&-1!=(0|(t=c[c[e+40>>2]+(t<<2)>>2])))for(n=c[e+16>>2];;){if(c[c[4+(a=n+(t<<4)|0)>>2]+12>>2]==(0|i)&&c[c[a>>2]+12>>2]==(0|o))break e;if(-1==(0|(t=c[c[e+60>>2]+(t<<2)>>2])))break}a=0}return 0|a},We,function(e,t){c[68+(e|=0)>>2]=t|=0},function(e,t){e|=0,t|=0;var n,i,o,r,s=0,l=0,_=0,u=0,h=0,f=0,d=0,m=0;if(c[20+(N=r=N-32|0)>>2]=0,c[12+r>>2]=0,((c[16+r>>2]=0)|(l=c[e+8>>2]))<(a[24+r|0]=1))l=0;else{for(l=0;;){if(i=c[e+16>>2],(0|_)==(0|s))if((0|(d=s?s<<1:1))<=(0|s))_=s;else{if(h=0,d&&(c[5498]=c[5498]+1,(l=M(19+(d<<4)|0))&&(c[(h=l+19&-16)-4>>2]=l)),1<=(0|s))for(_=12;u=c[20+r>>2]+_|0,c[(l=_+h|0)-12>>2]=c[u-12>>2],o=c[4+(n=u-8|0)>>2],c[(f=l-8|0)>>2]=c[n>>2],c[f+4>>2]=o,c[l>>2]=c[u>>2],_=_+16|0,s=s-1|0;);(l=c[20+r>>2])&&p[24+r|0]&&(c[5499]=c[5499]+1,z(c[l-4>>2])),c[20+r>>2]=h,a[24+r|0]=1,c[16+r>>2]=d,_=c[12+r>>2],u=f=l=h}if(d=c[4+(s=(m<<4)+i|0)>>2],c[(_=(_<<4)+u|0)>>2]=c[s>>2],c[_+4>>2]=d,c[_+8>>2]=c[s+8>>2],c[_+12>>2]=c[s+12>>2],s=c[12+r>>2],c[12+r>>2]=_=s+1|0,!((0|(m=m+1|0))<c[e+8>>2]))break;s=c[16+r>>2]}if(!((0|s)<0))for(u=s+1|0;pi[c[c[e>>2]+12>>2]](e,c[f>>2],c[f+4>>2],t),f=f+16|0,u=u-1|0;);}if(1<=c[e+52>>2])for(u=c[e+60>>2],s=0;c[u>>2]=-1,u=u+4|0,(0|(s=s+1|0))<c[e+52>>2];);e:{if(2<=(0|_))xn(8+r|0,0,_-1|0);else if((0|_)<1)break e;for(;pi[c[c[e>>2]+8>>2]](e,c[l>>2],c[l+4>>2]),l=l+16|0,_=_-1|0;);}h&&(c[5499]=c[5499]+1,z(c[h-4>>2])),N=32+r|0},ve,function(e,t){var n=0;return(0|(n=c[4+(e|=0)>>2]))!=c[4+(t|=0)>>2]&&(0|n)!=c[t>>2]||(n=c[e+8>>2],pi[c[c[n>>2]+32>>2]](n,t,c[e+12>>2])),0},ve,function(e,t){return(0|(e=c[4+(e|=0)>>2]))==c[(t|=0)>>2]|(0|e)==c[t+4>>2]},yn,function(e){V(yn(e|=0))},function(e,t,n,i,o,a,r,s){e|=0,t|=0,n|=0,i|=0,o|=0,a|=0,r|=0,s|=0;var l,_=0;return N=s=N-48|0,i=0,l=c[5498],c[5498]=l+1,(_=M(83))&&(c[(i=_+19&-16)-4>>2]=_),c[i+8>>2]=r,c[i+4>>2]=a,c[i>>2]=o,o=c[t+4>>2],c[i+16>>2]=c[t>>2],c[i+20>>2]=o,_=c[4+(r=o=t+8|0)>>2],c[(a=i+24|0)>>2]=c[r>>2],c[a+4>>2]=_,a=c[n+4>>2],c[i+32>>2]=c[n>>2],c[i+36>>2]=a,_=c[4+(a=n+8|0)>>2],c[(r=i+40|0)>>2]=c[a>>2],c[r+4>>2]=_,c[i+52>>2]=0,c[i+56>>2]=0,_=c[o+4>>2],c[(r=s+24|0)>>2]=c[o>>2],c[r+4>>2]=_,r=c[a+4>>2],c[(o=s+40|0)>>2]=c[a>>2],c[o+4>>2]=r,o=c[t>>2],t=c[t+4>>2],a=c[n+4>>2],n=c[n>>2],c[i+60>>2]=c[e+104>>2],c[s+32>>2]=n,c[s+36>>2]=a,n=c[e+148>>2]+1|0,c[i+12>>2]=n,c[e+148>>2]=n,c[s+16>>2]=o,c[s+20>>2]=t,o=e+4|0,(t=c[e+8>>2])?c[e+8>>2]=0:(c[5498]=l+2,t=0,(n=M(63))&&(c[(t=n+19&-16)-4>>2]=n),c[t>>2]=0,c[t+4>>2]=0,c[t+40>>2]=0,c[(n=t+32|0)>>2]=0,c[n+4>>2]=0,c[(n=t+24|0)>>2]=0,c[n+4>>2]=0,c[(n=t+16|0)>>2]=0,c[n+4>>2]=0,c[(n=t+8|0)>>2]=0,c[n+4>>2]=0),c[t+36>>2]=i,n=c[s+20>>2],c[t>>2]=c[s+16>>2],c[t+4>>2]=n,c[t+40>>2]=0,r=c[4+(a=s+24|0)>>2],c[(n=t+8|0)>>2]=c[a>>2],c[n+4>>2]=r,r=c[4+(a=s+32|0)>>2],c[(n=t+16|0)>>2]=c[a>>2],c[n+4>>2]=r,r=c[4+(a=s+40|0)>>2],c[(n=t+24|0)>>2]=c[a>>2],c[n+4>>2]=r,c[t+32>>2]=0,ht(o,c[e+4>>2],t),c[i+52>>2]=0,c[i+48>>2]=t,t=84+((c[e+104>>2]<<2)+e|0)|0,c[i+56>>2]=c[t>>2],c[(n=e+16|0)>>2]=c[n>>2]+1,(n=c[t>>2])&&(c[n+52>>2]=i),c[t>>2]=i,p[e+153|0]||(c[s+8>>2]=i,c[s>>2]=16856,c[s+4>>2]=e,bn(c[e+4>>2],s+16|0,s),bn(c[e+44>>2],s+16|0,s)),N=s+48|0,0|i},function(e,t,n){e|=0,n|=0;var i,o=0,r=0;ut(o=2==c[60+(t|=0)>>2]?e+44|0:e+4|0,r=c[t+48>>2]),(i=c[o+4>>2])&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[o+4>>2]=r,c[o+12>>2]=c[o+12>>2]-1,(o=c[t+52>>2])?c[(r=o+56|0)>>2]=c[(o=t+56|0)>>2]:c[84+((c[t+60>>2]<<2)+e|0)>>2]=c[(o=t+56|0)>>2],(o=c[o>>2])&&(c[o+52>>2]=c[t+52>>2]),o=c[e+96>>2],pi[c[c[o>>2]+16>>2]](o,t,n),c[5499]=c[5499]+1,z(c[t-4>>2]),a[e+154|0]=1},function(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var r,s,l,_,u,h,f,d,m,v,g,y,b,S,C,E,T,P,w=0,I=0,R=x(0),D=0,O=x(0),L=x(0),F=0,B=x(0);if(N=P=N-48|0,B=A[n>>2],A[44+P>>2]=B,r=A[n+4>>2],A[40+P>>2]=r,s=A[n+8>>2],A[36+P>>2]=s,l=A[i>>2],A[32+P>>2]=l,_=A[i+4>>2],A[28+P>>2]=_,u=A[i+8>>2],A[24+P>>2]=u,h=A[i+12>>2],f=A[n+12>>2],2!=c[t+60>>2])if(c[e+128>>2]=c[e+128>>2]+1,I=c[t+48>>2],(m=A[I>>2])<=l&&B<=(v=A[I+16>>2])&&(g=A[I+4>>2])<=_&&r<=(y=A[I+20>>2])&&(O=A[I+8>>2])<=u&&s<=(L=A[I+24>>2])){if(b=A[t+16>>2],E=A[t+32>>2],d=A[e+100>>2],S=A[t+24>>2],T=A[t+40>>2],C=A[t+20>>2],R=A[t+36>>2],!(m<=B&&g<=r&&O<=s&&l<=v&&_<=y&&(w=0,u<=L))){O=x(_+x(.05000000074505806)),A[28+P>>2]=O,L=x(r+x(-.05000000074505806)),A[40+P>>2]=L,R=x(x(x(R-C)*x(.5))*d),o=(R=x(r-C)<x(0)?x(-R):R)>x(0),A[(o?28+P|0:40+P|0)>>2]=(o?O:L)+R,O=x(s+x(-.05000000074505806)),A[36+P>>2]=O,L=x(u+x(.05000000074505806)),A[24+P>>2]=L,R=x(d*x(x(T-S)*x(.5))),o=(R=x(s-S)<x(0)?x(-R):R)>x(0),A[(o?24+P|0:36+P|0)>>2]=(o?L:O)+R,O=x(l+x(.05000000074505806)),A[32+P>>2]=O,L=x(B+x(-.05000000074505806)),A[44+P>>2]=L,R=x(x(x(E-b)*x(.5))*d),o=(R=x(B-b)<x(0)?x(-R):R)>x(0),A[(o?32+P|0:44+P|0)>>2]=(o?O:L)+R;e:if(o=ut(D=e+4|0,I))if(0<=(0|(F=c[e+12>>2]))){if(F)for(;;){if(!(w=c[o+32>>2]))break e;if(o=w,!(F=F-1|0))break}}else o=c[D>>2];else o=0;A[I>>2]=A[44+P>>2],A[I+4>>2]=A[40+P>>2],A[I+12>>2]=f,A[I+8>>2]=A[36+P>>2],A[I+16>>2]=A[32+P>>2],A[I+20>>2]=A[28+P>>2],A[I+24>>2]=A[24+P>>2],A[I+28>>2]=h,ht(D,o,I),c[e+132>>2]=c[e+132>>2]+1,w=1}}else{e:if(o=ut(D=e+4|0,I))if(0<=(0|(F=c[e+12>>2]))){if(F)for(;;){if(!(w=c[o+32>>2]))break e;if(o=w,!(F=F-1|0))break}}else o=c[D>>2];else o=0;A[I+16>>2]=l,A[I+12>>2]=f,A[I+8>>2]=s,A[I+4>>2]=r,A[I>>2]=B,A[I+28>>2]=h,A[I+24>>2]=u,A[I+20>>2]=_,ht(D,o,I),c[e+132>>2]=c[e+132>>2]+1,w=1}else ut(e+44|0,w=c[t+48>>2]),(o=c[e+48>>2])&&(c[5499]=c[5499]+1,z(c[o-4>>2])),c[e+48>>2]=w,c[(o=e+56|0)>>2]=c[o>>2]-1,D=e+4|0,(o=c[e+8>>2])?c[e+8>>2]=0:(c[5498]=c[5498]+1,o=0,(w=M(63))&&(c[(o=w+19&-16)-4>>2]=w,B=A[44+P>>2]),c[o>>2]=0,c[o+4>>2]=0,c[o+40>>2]=0,c[(w=o+32|0)>>2]=0,c[w+4>>2]=0,c[(w=o+24|0)>>2]=0,c[w+4>>2]=0,c[(w=o+16|0)>>2]=0,c[w+4>>2]=0,c[(w=o+8|0)>>2]=0,c[w+4>>2]=0),A[o>>2]=B,c[o+36>>2]=t,A[o+12>>2]=f,c[o+40>>2]=0,A[o+28>>2]=h,A[o+4>>2]=A[40+P>>2],A[o+8>>2]=A[36+P>>2],A[o+16>>2]=A[32+P>>2],A[o+20>>2]=A[28+P>>2],A[o+24>>2]=A[24+P>>2],c[o+32>>2]=0,ht(D,c[e+4>>2],o),c[t+48>>2]=o,c[(o=e+16|0)>>2]=c[o>>2]+1,w=1;(o=c[t+52>>2])?c[(I=o+56|0)>>2]=c[(o=t+56|0)>>2]:c[84+((c[t+60>>2]<<2)+e|0)>>2]=c[(o=t+56|0)>>2],(o=c[o>>2])&&(c[o+52>>2]=c[t+52>>2]),o=c[n+4>>2],c[t+16>>2]=c[n>>2],c[t+20>>2]=o,n=c[4+(o=n+8|0)>>2],c[(D=t+24|0)>>2]=c[o>>2],c[D+4>>2]=n,n=c[4+(o=i+8|0)>>2],c[(D=t+40|0)>>2]=c[o>>2],c[D+4>>2]=n,n=c[i+4>>2],c[t+32>>2]=c[i>>2],c[t+36>>2]=n,c[t+52>>2]=0,n=c[e+104>>2],c[t+56>>2]=c[(i=84+((n<<2)+e|0)|0)>>2],c[t+60>>2]=n,(n=c[i>>2])&&(c[n+52>>2]=t),c[i>>2]=t,w&&(a[e+154|0]=1,p[e+153|0]||(c[8+P>>2]=16856,Sn(n=(c[12+P>>2]=e)+44|0,c[n>>2],c[t+48>>2],8+P|0),Sn(e+4|0,c[e+4>>2],c[t+48>>2],8+P|0))),N=48+P|0},function(e,t,n,i){var o;e|=0,i|=0,e=c[20+(t|=0)>>2],c[(n|=0)>>2]=c[t+16>>2],c[n+4>>2]=e,e=n+8|0,o=c[4+(n=t+24|0)>>2],c[e>>2]=c[n>>2],c[e+4>>2]=o,o=c[4+(n=t+40|0)>>2],c[(e=i+8|0)>>2]=c[n>>2],c[e+4>>2]=o,e=c[t+36>>2],c[i>>2]=c[t+32>>2],c[i+4>>2]=e},function(e,t,n,i,o,a){var r,s,l;e|=0,t|=0,n|=0,i|=0,o|=0,a|=0,c[8+(N=n=N-16|0)>>2]=17e3,c[n+12>>2]=i,l=c[e+168>>2],Cn(c[e+4>>2],t,r=i+4|0,s=i+20|0,A[i+32>>2],o,a,l,n+8|0),Cn(c[e+44>>2],t,r,s,A[i+32>>2],o,a,l,n+8|0),N=n+16|0},function(e,t,n,i){e|=0,t|=0,n|=0;var o,a,r;c[44+(N=r=N-48|0)>>2]=i|=0,c[40+r>>2]=16928,a=c[4+(o=t+8|0)>>2],c[(i=16+r|0)>>2]=c[o>>2],c[i+4>>2]=a,a=c[4+(o=n+8|0)>>2],c[(i=32+r|0)>>2]=c[o>>2],c[i+4>>2]=a,i=c[t+4>>2],c[8+r>>2]=c[t>>2],c[12+r>>2]=i,t=c[n+4>>2],c[24+r>>2]=c[n>>2],c[28+r>>2]=t,bn(c[e+4>>2],8+r|0,40+r|0),bn(c[e+44>>2],8+r|0,40+r|0),N=48+r|0},function(e,t){e|=0,t|=0;var n,i=0,o=0,r=0,s=0,l=0,_=0,u=0,h=0,f=0,d=0,m=x(0),v=0;if(N=n=N-32|0,_t(l=e+4|0,1+((0|g(c[e+112>>2],c[e+16>>2]))/100|0)|0),c[e+124>>2]&&(_t(e+44|0,i=1+((0|g(c[e+108>>2],c[e+56>>2]))/100|0)|0),i=c[e+124>>2]-i|0,c[e+124>>2]=0<(0|i)?i:0),i=(c[e+104>>2]+1|0)%2|0,c[e+104>>2]=i,i=c[84+((i<<2)+e|0)>>2]){for(h=e+44|0,_=16+n|0;u=c[i+56>>2],s=(o=c[i+52>>2])?o+56|0:84+((c[i+60>>2]<<2)+e|0)|0,c[s>>2]=u,(o=c[i+56>>2])&&(c[o+52>>2]=c[i+52>>2]),c[i+52>>2]=0,c[i+56>>2]=c[e+92>>2],(o=c[e+92>>2])&&(c[o+52>>2]=i),c[e+92>>2]=i,ut(l,o=c[i+48>>2]),(s=c[e+8>>2])&&(c[5499]=c[5499]+1,z(c[s-4>>2])),c[e+8>>2]=o,c[e+16>>2]=c[e+16>>2]-1,f=c[4+(r=i+24|0)>>2],c[(o=s=8+n|0)>>2]=c[r>>2],c[o+4>>2]=f,o=c[i+36>>2],c[_>>2]=c[i+32>>2],c[_+4>>2]=o,f=c[4+(r=i+40|0)>>2],c[(o=_+8|0)>>2]=c[r>>2],c[o+4>>2]=f,o=c[i+20>>2],c[n>>2]=c[i+16>>2],c[4+n>>2]=o,(o=c[e+48>>2])?c[e+48>>2]=0:(o=0,c[5498]=c[5498]+1,(r=M(63))&&(c[(o=r+19&-16)-4>>2]=r),c[o>>2]=0,c[o+4>>2]=0,c[o+40>>2]=0,c[(r=o+32|0)>>2]=0,c[r+4>>2]=0,c[(r=o+24|0)>>2]=0,c[r+4>>2]=0,c[(r=o+16|0)>>2]=0,c[r+4>>2]=0,c[(r=o+8|0)>>2]=0,c[r+4>>2]=0),c[o+36>>2]=i,r=c[4+n>>2],c[o>>2]=c[n>>2],c[o+4>>2]=r,c[o+40>>2]=0,f=c[s+4>>2],c[(r=o+8|0)>>2]=c[s>>2],c[r+4>>2]=f,r=c[_+4>>2],c[(s=o+16|0)>>2]=c[_>>2],c[s+4>>2]=r,f=c[4+(r=24+n|0)>>2],c[(s=o+24|0)>>2]=c[r>>2],c[s+4>>2]=f,c[o+32>>2]=0,ht(h,c[e+44>>2],o),c[i+60>>2]=2,c[i+48>>2]=o,o=c[e+56>>2]+1|0,c[e+56>>2]=o,i=u;);a[e+154|0]=1,c[e+124>>2]=o}c[n>>2]=16856,c[4+n>>2]=e,p[e+153|0]&&(Sn(l,c[e+4>>2],c[e+44>>2],n),p[e+153|0]&&Sn(l,i=c[l>>2],i,n));e:if(p[e+154|0]&&(i=c[e+96>>2],s=0|pi[c[c[i>>2]+28>>2]](i),!((0|(u=c[s+4>>2]))<1))){t:{if(i=c[e+120>>2],1<=(0|(o=(0|u)<(0|(i=(0|(o=(0|g(c[e+116>>2],u))/100|0))<(0|i)?i:o))?u:i))){for(i=0;l=c[s+12>>2]+((c[e+144>>2]+i|0)%(0|u)<<4)|0,r=c[l>>2],_=c[r+48>>2],h=c[l+4>>2],l=c[h+48>>2],A[_>>2]<=A[l+16>>2]&&A[_+16>>2]>=A[l>>2]&&A[_+4>>2]<=A[l+20>>2]&&A[_+20>>2]>=A[l+4>>2]&&A[_+8>>2]<=A[l+24>>2]&&A[_+24>>2]>=A[l+8>>2]||(u=c[e+96>>2],pi[c[c[u>>2]+12>>2]](u,r,h,t),i=i-1|0,o=o-1|0,u=c[s+4>>2]),(0|(i=i+1|0))<(0|o););if((0|u)<=0)break t}c[e+144>>2]=(c[e+144>>2]+o|0)%(0|u);break e}c[e+144>>2]=0}if(a[e+154|0]=0,c[e+120>>2]=1,c[e+140>>2]=c[e+140>>2]+1,i=c[e+132>>2],e=c[(s=e)+128>>2],m=x(0),e&&(m=x(x(i>>>0)/x(e>>>0))),A[s+136>>2]=m,c[s+132>>2]=i>>>1,c[s+128>>2]=e>>>1,e=c[s+96>>2],0|pi[c[c[e>>2]+56>>2]](e)){if(e=c[s+96>>2],r=0|pi[c[c[e>>2]+28>>2]](e),2<=(0|(e=c[r+4>>2]))&&(xn(r,0,e-1|0),e=c[r+4>>2]),1<=(0|e)){for(l=_=u=o=0;f=c[r+12>>2]+o|0,i=c[(d=f+4|0)>>2],h=_,_=c[f>>2],((0|i)!=(0|l)||(0|h)!=(0|_))&&(l=c[_+48>>2],h=c[i+48>>2],A[l>>2]<=A[h+16>>2]&&A[l+16>>2]>=A[h>>2]&&A[l+4>>2]<=A[h+20>>2]&&A[l+20>>2]>=A[h+4>>2]&&A[l+8>>2]<=A[h+24>>2]&&A[l+24>>2]>=A[h+8>>2])||(e=c[s+96>>2],pi[c[c[e>>2]+32>>2]](e,f,t),c[d>>2]=0,u=u+1|(c[f>>2]=0),e=c[r+4>>2]),o=o+16|0,l=i,(0|(v=v+1|0))<(0|e););if(2<=(0|e)&&(xn(r,0,e-1|0),e=c[r+4>>2]),_=e-u|0,(0|u)<=-1){if((0|_)>c[r+8>>2]){if(t=0,_&&(c[5498]=c[5498]+1,(i=M(19+(_<<4)|0))&&(c[(t=i+19&-16)-4>>2]=i)),1<=(0|e))for(i=12,o=e;s=c[r+12>>2]+i|0,c[(l=t+i|0)-12>>2]=c[s-12>>2],d=c[4+(f=s-8|0)>>2],c[(h=l-8|0)>>2]=c[f>>2],c[h+4>>2]=d,c[l>>2]=c[s>>2],i=i+16|0,o=o-1|0;);(i=c[r+12>>2])&&p[r+16|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[r+12>>2]=t,a[r+16|0]=1,c[r+8>>2]=_}for(i=e<<4;e=c[r+12>>2]+i|0,c[e>>2]=0,c[e+4>>2]=0,c[(e=e+8|0)>>2]=0,i=i+16|(c[e+4>>2]=0),(e=u)>>>0<=(u=e+1|0)>>>0;);}e=_}c[r+4>>2]=e}N=32+n|0},En,En,function(e,t,n){e|=0,t|=0,n|=0;var i=x(0),o=x(0),a=x(0),r=x(0),s=x(0),l=x(0),_=x(0),u=x(0),h=c[e+44>>2];(e=c[e+4>>2])?(_=A[e>>2],h?(i=A[e+24>>2],o=(o=A[h+24>>2])<i?i:o,i=A[e+20>>2],a=(a=A[h+20>>2])<i?i:a,r=(i=A[e+8>>2])<(r=A[h+8>>2])?i:r,s=(i=A[e+4>>2])<(s=A[h+4>>2])?i:s,i=A[e+16>>2],l=(l=A[h+16>>2])<i?i:l,_=_<(i=A[h>>2])?_:i):(u=A[e+28>>2],o=A[e+24>>2],a=A[e+20>>2],l=A[e+16>>2],i=A[e+12>>2],r=A[e+8>>2],s=A[e+4>>2])):h&&(u=A[h+28>>2],o=A[h+24>>2],a=A[h+20>>2],l=A[h+16>>2],i=A[h+12>>2],r=A[h+8>>2],s=A[h+4>>2],_=A[h>>2]),A[t+12>>2]=i,A[t+8>>2]=r,A[t+4>>2]=s,A[t>>2]=_,A[n+12>>2]=u,A[n+8>>2]=o,A[n+4>>2]=a,A[n>>2]=l},function(e,t){t|=0,c[16+(e|=0)>>2]==(0-c[e+56>>2]|0)&&(lt(e+4|0),lt(e+44|0),a[e+153|0]=0,a[e+154|0]=1,c[e+124>>2]=0,c[e+104>>2]=0,c[e+116>>2]=10,c[e+120>>2]=1,c[e+108>>2]=1,c[e+112>>2]=0,c[(t=e+84|0)>>2]=0,c[t+4>>2]=0,c[e+92>>2]=0,c[e+128>>2]=0,c[e+132>>2]=0,c[(t=e+136|0)>>2]=0,c[t+4>>2]=0,c[(e=e+144|0)>>2]=0,c[e+4>>2]=0)},Tn,ve,function(e,t,n){var i;e|=0,(0|(t|=0))!=(0|(n|=0))&&(i=c[c[e+4>>2]+96>>2],pi[c[c[i>>2]+8>>2]](i,c[t+36>>2],c[n+36>>2]),e=c[e+4>>2],c[e+120>>2]=c[e+120>>2]+1)},function(e,t){pi[c[c[(e|=0)>>2]+8>>2]](e,t|=0,c[c[e+8>>2]+48>>2])},ve,Pn,ve,Pn,function(e){var t=0;return c[(e|=0)>>2]=17124,(t=c[e+556>>2])&&p[e+560|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+556>>2]=0,c[e>>2]=7664,a[e+560|0]=1,c[(t=e+548|0)>>2]=0,c[t+4>>2]=0,(t=c[e+296>>2])&&p[e+300|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+296>>2]=0,a[e+300|0]=1,c[(t=e+288|0)>>2]=0,(c[t+4>>2]=0)|e},function(e){var t=0;c[(e|=0)>>2]=17124,(t=c[e+556>>2])&&p[e+560|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+556>>2]=0,c[e>>2]=7664,a[e+560|0]=1,c[(t=e+548|0)>>2]=0,c[t+4>>2]=0,(t=c[e+296>>2])&&p[e+300|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+296>>2]=0,a[e+300|0]=1,c[(t=e+288|0)>>2]=0,c[t+4>>2]=0,c[5499]=c[5499]+1,z(c[e-4>>2])},function(){return 496},function(e,t,n){return Ee(e|=0,t|=0,n|=0),A[t+264>>2]=A[e+324>>2],A[t+268>>2]=A[e+328>>2],A[t+272>>2]=A[e+332>>2],A[t+276>>2]=A[e+336>>2],A[t+280>>2]=A[e+340>>2],A[t+284>>2]=A[e+344>>2],A[t+288>>2]=A[e+348>>2],A[t+292>>2]=A[e+352>>2],A[t+296>>2]=A[e+356>>2],A[t+300>>2]=A[e+360>>2],A[t+304>>2]=A[e+364>>2],A[t+308>>2]=A[e+368>>2],A[t+312>>2]=A[e+372>>2],A[t+316>>2]=A[e+376>>2],A[t+320>>2]=A[e+380>>2],A[t+324>>2]=A[e+384>>2],A[t+328>>2]=A[e+388>>2],A[t+332>>2]=A[e+392>>2],A[t+336>>2]=A[e+396>>2],A[t+340>>2]=A[e+400>>2],A[t+456>>2]=A[e+404>>2],A[t+344>>2]=A[e+604>>2],A[t+348>>2]=A[e+608>>2],A[t+352>>2]=A[e+612>>2],A[t+356>>2]=A[e+616>>2],A[t+360>>2]=A[e+408>>2],A[t+364>>2]=A[e+412>>2],A[t+368>>2]=A[e+416>>2],A[t+372>>2]=A[e+420>>2],A[t+376>>2]=A[e+424>>2],A[t+380>>2]=A[e+428>>2],A[t+384>>2]=A[e+432>>2],A[t+388>>2]=A[e+436>>2],A[t+392>>2]=A[e+440>>2],A[t+396>>2]=A[e+444>>2],A[t+400>>2]=A[e+448>>2],A[t+404>>2]=A[e+452>>2],A[t+408>>2]=A[e+456>>2],A[t+412>>2]=A[e+460>>2],A[t+416>>2]=A[e+464>>2],A[t+420>>2]=A[e+468>>2],A[t+424>>2]=A[e+472>>2],A[t+428>>2]=A[e+476>>2],A[t+432>>2]=A[e+480>>2],A[t+436>>2]=A[e+484>>2],A[t+440>>2]=A[e+488>>2],A[t+444>>2]=A[e+492>>2],A[t+448>>2]=A[e+496>>2],A[t+452>>2]=A[e+500>>2],n=c[e+508>>2],c[t+460>>2]=c[e+504>>2],c[t+464>>2]=n,n=c[e+520>>2],c[t+468>>2]=c[e+516>>2],c[t+472>>2]=n,n=c[e+528>>2],c[t+476>>2]=c[e+524>>2],c[t+480>>2]=n,n=c[e+536>>2],c[t+484>>2]=c[e+532>>2],c[t+488>>2]=n,c[t+492>>2]=p[e+512|0],17164},function(e,t){var n=0,i=0,o=(i=t|=0,0|pi[c[c[(e|=0)>>2]+16>>2]](e)),a=c[c[t>>2]+16>>2];n=0|pi[a](0|i,0|o,1),i=0|pi[c[c[e>>2]+20>>2]](e,c[8+(o=n)>>2],n=t),a=c[c[t>>2]+20>>2],pi[a](0|n,0|o,0|i,1497645650,0|e)},Mn,function(e){e=Mn(e|=0),c[5499]=c[5499]+1,z(c[e-4>>2])},qe,function(e,t,n,i,o,a,r,s,l){return x(pi[c[c[(e|=0)>>2]+44>>2]](e,t|=0,n|=0,i|=0,o|=0,a|=0,r|=0,s|=0,l|=0)),x(pi[c[c[e>>2]+48>>2]](e,t,n,i,o,a,r,s,l)),x(pi[c[c[e>>2]+36>>2]](e,t,n,s)),x(x(0))},qe,function(e){c[232+(e|=0)>>2]=0},Zt,function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,r,s,l,_,u,h,f,d,m,v,b,S,E,P,w,I,R,D,O,L,F,B,U,G,j,V,H,W,q,Y,X,Q,Z,J,K,$,ee,te,ne,ie,oe,ae,re,se,ce,le,_e,ue,he,fe=x(0),pe=0,de=x(0),me=x(0),Ae=x(0),ve=x(0),ge=x(0),xe=0,ye=x(0),be=x(0),Se=0,Ce=x(0),Ee=x(0),Te=x(0),Pe=x(0),we=x(0),Ie=0,Re=x(0),De=x(0),Ne=x(0),Oe=0,Me=0,ze=x(0),Le=x(0),Fe=0,Be=x(0),ke=0,Ue=0,Ge=x(0),je=x(0),Ve=x(0),He=x(0),We=x(0),qe=x(0),Ye=x(0),Xe=0,Qe=0,Ze=x(0),Je=x(0),Ke=x(0),$e=x(0);if(N=he=N+-64|0,1<=(0|n))for(;;){if(w=c[(Qe<<2)+t>>2],o=c[w+840>>2],m=zn(e,r=c[w+836>>2],A[i+12>>2]),d=zn(e,o,A[i+12>>2]),D=g(m,244),Me=c[e+16>>2],fe=A[128+(Se=D+Me|0)>>2],me=x(fe*fe),fe=A[Se+132>>2],me=x(me+x(fe*fe)),fe=A[Se+136>>2],!(x(me+x(fe*fe))<x(14210854715202004e-30)&&(pe=Me+g(d,244)|0,fe=A[pe+128>>2],me=x(fe*fe),fe=A[pe+132>>2],me=x(me+x(fe*fe)),fe=A[pe+136>>2],x(me+x(fe*fe))<x(14210854715202004e-30))||(0|(xe=c[w+844>>2]))<1))for(U=232+(pe=Me+(O=g(d,244))|0)|0,G=pe+200|0,j=pe+228|0,V=pe+196|0,H=pe+224|0,W=pe+192|0,q=pe+216|0,Y=pe+184|0,X=pe+212|0,Q=pe+180|0,Z=pe+208|0,J=pe+176|0,K=pe+240|0,$=Se+232|0,ee=Se+200|0,te=Se+228|0,ne=Se+196|0,ie=Se+224|0,oe=Se+192|0,ae=Se+216|0,re=Se+184|0,se=Se+212|0,ce=Se+180|0,le=Se+208|0,_e=Se+176|0,ue=Se+240|0,Xe=0;;){if(s=g(Xe,208)+w|0,A[(I=84+s|0)>>2]<=A[w+852>>2]){if(P=4+s|0,(0|(xe=Me=c[e+28>>2]))==c[e+32>>2]&&!((0|(Fe=(xe=Me)?xe<<1:1))<=(0|xe))){if(Se=0,Fe&&(c[5498]=c[5498]+1,(pe=M(g(Fe,152)+19|0))&&(c[(Se=pe+19&-16)-4>>2]=pe)),1<=(0|Me))for(xe=0,pe=Me;k(xe+Se|0,c[e+36>>2]+xe|0,152),xe=xe+152|0,pe=pe-1|0;);(pe=c[e+36>>2])&&p[e+40|0]&&(c[5499]=c[5499]+1,z(c[pe-4>>2])),c[e+36>>2]=Se,a[e+40|0]=1,c[e+32>>2]=Fe,xe=c[e+28>>2]}c[e+28>>2]=xe+1,pe=c[e+36>>2]+g(Me,152)|0,c[pe+132>>2]=P,c[pe+148>>2]=d,c[pe+144>>2]=m,c[60+he>>2]=0,b=x(A[60+s>>2]-A[r+60>>2]),A[56+he>>2]=b,S=x(A[56+s>>2]-A[r+56>>2]),A[52+he>>2]=S,ye=x(A[52+s>>2]-A[r+52>>2]),A[48+he>>2]=ye,ve=A[36+s>>2],me=A[40+s>>2],Ae=A[44+s>>2],de=A[o+52>>2],Be=A[o+56>>2],fe=A[o+60>>2],c[44+he>>2]=0,ze=x(Ae-fe),A[40+he>>2]=ze,Pe=x(me-Be),A[36+he>>2]=Pe,Le=x(ve-de),A[32+he>>2]=Le,Je=x(0),Ke=x(0),$e=x(0),He=x(0),c[ue>>2]&&(de=x(A[oe>>2]+A[ie>>2]),Be=x(A[ne>>2]+A[te>>2]),He=x(x(A[re>>2]+A[ae>>2])+x(x(S*de)-x(ye*Be))),fe=x(A[ee>>2]+A[$>>2]),$e=x(x(A[ce>>2]+A[se>>2])+x(x(ye*fe)-x(b*de))),Ke=x(x(A[_e>>2]+A[le>>2])+x(x(b*Be)-x(S*fe)))),We=x(0),qe=x(0),c[K>>2]&&(de=x(A[W>>2]+A[H>>2]),Be=x(A[V>>2]+A[j>>2]),qe=x(x(A[Y>>2]+A[q>>2])+x(x(Pe*de)-x(Le*Be))),fe=x(A[G>>2]+A[U>>2]),We=x(x(A[Q>>2]+A[X>>2])+x(x(Le*fe)-x(ze*de))),Je=x(x(A[J>>2]+A[Z>>2])+x(x(ze*Be)-x(Pe*fe)))),L=A[(v=72+s|0)>>2],F=A[(f=68+s|0)>>2],B=A[(E=76+s|0)>>2],Ae=A[i+12>>2],xe=c[e+16>>2],u=c[240+(l=xe+O|0)>>2],h=c[240+(_=xe+D|0)>>2],Ze=A[i+36>>2],Ye=A[i+40>>2],Be=A[i+28>>2],6&(xe=c[(R=132+s|0)>>2])?(Ye=2&xe?A[156+s>>2]:Ye,4&xe&&(Ze=A[160+s>>2])):8&xe&&(fe=x(Ae*A[156+s>>2]),de=x(C(x(fe+A[160+s>>2]),x(1.1920928955078125e-7))),Ze=x(fe/de),Ye=x(x(1)/de)),we=x(x(L*ye)-x(S*F)),Ne=x(x(b*F)-x(B*ye)),Ee=x(x(S*B)-x(b*L)),be=x(0),Te=x(0),Ge=x(0),je=x(0),h&&(je=x(x(x(x(Ee*A[h+356>>2])+x(Ne*A[h+360>>2]))+x(we*A[h+364>>2]))*A[h+612>>2]),Ge=x(x(x(x(Ee*A[h+340>>2])+x(Ne*A[h+344>>2]))+x(we*A[h+348>>2]))*A[h+608>>2]),Te=x(x(x(x(Ee*A[h+324>>2])+x(Ne*A[h+328>>2]))+x(we*A[h+332>>2]))*A[h+604>>2])),A[pe+64>>2]=Te,c[pe+76>>2]=0,A[(Ie=pe+72|0)>>2]=je,A[(Oe=pe+68|0)>>2]=Ge,de=A[v>>2],fe=A[f>>2],Ce=x(x(de*Le)-x(Pe*fe)),me=x(ze*fe),fe=A[E>>2],me=x(me-x(fe*Le)),ve=x(x(Pe*fe)-x(ze*de)),Ve=x(0),ge=x(0),u&&(fe=x(-me),ge=x(x(x(x(A[u+360>>2]*fe)-x(ve*A[u+356>>2]))-x(Ce*A[u+364>>2]))*A[u+612>>2]),be=x(x(x(x(A[u+328>>2]*fe)-x(ve*A[u+324>>2]))-x(Ce*A[u+332>>2]))*A[u+604>>2]),Ve=x(x(x(x(A[u+344>>2]*fe)-x(ve*A[u+340>>2]))-x(Ce*A[u+348>>2]))*A[u+608>>2])),A[pe+80>>2]=be,c[pe+92>>2]=0,A[(ke=pe+88|0)>>2]=ge,A[(Ue=pe+84|0)>>2]=Ve,xe=pe,de=Be,De=x(x(1)/Ae),Ae=Re=x(De*Ye),fe=x(h?A[h+404>>2]+x(x(x(x(x(Ge*b)-x(je*S))*A[f>>2])+x(x(x(je*ye)-x(b*Te))*A[v>>2]))+x(x(x(S*Te)-x(Ge*ye))*A[E>>2])):0),ge=x(u?A[u+404>>2]+x(x(x(x(x(ge*Pe)-x(Ve*ze))*A[f>>2])+x(x(x(be*ze)-x(ge*Le))*A[v>>2]))+x(x(x(Ve*Le)-x(be*Pe))*A[E>>2])):0),A[xe+108>>2]=de/x(Ae+x(fe+ge)),h?(xe=c[4+f>>2],c[pe+16>>2]=c[f>>2],c[pe+20>>2]=xe,Fe=c[4+(xe=8+f|0)>>2],Se=c[xe>>2],A[pe>>2]=Ee,c[pe+12>>2]=0,A[pe+8>>2]=we,A[pe+4>>2]=Ne,c[(xe=pe+24|0)>>2]=Se,c[xe+4>>2]=Fe):(c[pe>>2]=0,c[pe+4>>2]=0,c[(xe=pe+24|0)>>2]=0,c[xe+4>>2]=0,c[(xe=pe+16|0)>>2]=0,c[xe+4>>2]=0,c[(xe=pe+8|0)>>2]=0,c[xe+4>>2]=0),u?(de=A[v>>2],fe=A[E>>2],A[pe+48>>2]=-A[f>>2],A[pe+32>>2]=-ve,c[pe+60>>2]=0,A[pe+56>>2]=-fe,A[pe+52>>2]=-de,c[pe+44>>2]=0,A[pe+40>>2]=-Ce,A[pe+36>>2]=-me):(c[pe+32>>2]=0,c[pe+36>>2]=0,c[(xe=pe+56|0)>>2]=0,c[xe+4>>2]=0,c[(xe=pe+48|0)>>2]=0,c[xe+4>>2]=0,c[(xe=pe+40|0)>>2]=0,c[xe+4>>2]=0),Ne=A[i+64>>2],Ee=A[I>>2],be=x(0),Ge=x(0),je=x(0),Ve=x(0),h&&(Ae=A[h+388>>2],de=A[h+392>>2],Ve=x(x(x(S*Ae)-x(de*ye))+A[h+380>>2]),fe=A[h+396>>2],je=x(x(x(fe*ye)-x(b*Ae))+A[h+376>>2]),Ge=x(x(x(de*b)-x(fe*S))+A[h+372>>2])),ge=x(0),ye=x(0),u&&(Ae=A[u+388>>2],de=A[u+392>>2],ye=x(x(x(Pe*Ae)-x(de*Le))+A[u+380>>2]),fe=A[u+396>>2],ge=x(x(x(fe*Le)-x(ze*Ae))+A[u+376>>2]),be=x(x(x(de*ze)-x(fe*Pe))+A[u+372>>2])),I=240+l|0,Fe=240+_|0,Ae=A[E>>2],de=A[f>>2],fe=A[v>>2],A[pe+104>>2]=A[88+s>>2],fe=x(x(x(de*x(Ge-be))+x(fe*x(je-ge)))+x(Ae*x(Ve-ye))),we=A[i+96>>2]>x(y(fe))?x(0):x(A[100+s>>2]*x(-fe)),4&(xe=c[i+72>>2])?(ve=x(A[136+s>>2]*A[i+68>>2]),A[pe+100>>2]=ve,h&&c[Fe>>2]&&(me=A[h+416>>2],Ae=A[pe+24>>2],de=A[h+412>>2],fe=A[pe+20>>2],A[64+_>>2]=x(A[112+_>>2]*x(ve*x(x(A[pe+16>>2]*A[128+_>>2])*A[h+408>>2])))+A[64+_>>2],A[(Se=68+_|0)>>2]=x(x(ve*x(de*x(fe*A[132+_>>2])))*A[116+_>>2])+A[Se>>2],A[(Se=72+_|0)>>2]=x(x(ve*x(me*x(Ae*A[136+_>>2])))*A[120+_>>2])+A[Se>>2],Ae=A[Ie>>2],de=A[Oe>>2],A[80+_>>2]=x(x(ve*A[96+_>>2])*A[pe- -64>>2])+A[80+_>>2],fe=A[104+_>>2],A[(Se=84+_|0)>>2]=x(de*x(ve*A[100+_>>2]))+A[Se>>2],A[(Se=88+_|0)>>2]=x(Ae*x(ve*fe))+A[Se>>2]),!u||c[I>>2]&&(Te=A[u+416>>2],Ce=A[pe+56>>2],ve=A[u+412>>2],me=A[pe+52>>2],Ae=A[ke>>2],de=A[Ue>>2],fe=A[pe+80>>2],ge=x(-A[pe+100>>2]),A[64+l>>2]=A[64+l>>2]-x(A[112+l>>2]*x(x(x(A[128+l>>2]*A[pe+48>>2])*A[u+408>>2])*ge)),A[(Se=68+l|0)>>2]=A[Se>>2]-x(x(x(ve*x(me*A[132+l>>2]))*ge)*A[116+l>>2]),A[(Se=72+l|0)>>2]=A[Se>>2]-x(x(x(Te*x(Ce*A[136+l>>2]))*ge)*A[120+l>>2]),A[80+l>>2]=A[80+l>>2]-x(fe*x(A[96+l>>2]*ge)),fe=A[104+l>>2],A[(Se=84+l|0)>>2]=A[Se>>2]-x(de*x(A[100+l>>2]*ge)),A[(Se=88+l|0)>>2]=A[Se>>2]-x(Ae*x(fe*ge)))):c[pe+100>>2]=0,c[pe+96>>2]=0,ze=x(0),Pe=x(0),be=x(0),Ge=x(0),je=x(0),ye=x(0),Ve=x(0),ge=x(0),Ye=x(0),me=x(0),Se=pe+108|0,Ae=we<=x(0)?x(0):we,fe=c[Fe>>2]?(je=A[224+_>>2],Ge=A[228+_>>2],ze=A[216+_>>2],Pe=A[212+_>>2],be=A[232+_>>2],A[208+_>>2]):x(0),Pe=x(x(x(x(x(fe+A[176+_>>2])*A[pe+16>>2])+x(x(Pe+A[180+_>>2])*A[pe+20>>2]))+x(x(ze+A[184+_>>2])*A[pe+24>>2]))+x(x(x(x(je+A[192+_>>2])*A[pe>>2])+x(x(Ge+A[196+_>>2])*A[pe+4>>2]))+x(x(be+A[200+_>>2])*A[pe+8>>2]))),fe=c[I>>2]?(me=A[224+l>>2],ge=A[232+l>>2],Ye=A[228+l>>2],Ve=A[216+l>>2],ye=A[212+l>>2],A[208+l>>2]):x(0),be=x(Ae-x(Pe+x(x(x(x(x(fe+A[176+l>>2])*A[pe+48>>2])+x(x(ye+A[180+l>>2])*A[pe+52>>2]))+x(x(Ve+A[184+l>>2])*A[pe+56>>2]))+x(x(x(x(me+A[192+l>>2])*A[pe+32>>2])+x(x(Ye+A[196+l>>2])*A[pe+36>>2]))+x(x(ge+A[200+l>>2])*A[pe+40>>2]))))),de=A[i+56>>2],c[pe+120>>2]=0,c[pe+124>>2]=1343554297,Ae=A[Se>>2],A[pe+116>>2]=Re*Ae,c[pe+140>>2]=c[e+68>>2],Ie=pe,fe=(me=x(Ee+Ne))>x(0)?(be=x(be-x(De*me)),x(0)):x(De*x(Ze*x(-me))),fe=x(fe*Ae),Se=!c[i+52>>2]|de<me,A[Ie+128>>2]=Se?x(0):fe,me=fe,fe=x(be*Ae),A[pe+112>>2]=Se?x(me+fe):fe,Se=pe+140|0,A[(Fe=92+s|0)>>2]>x(0)&&(Ln(e,f,m,d,Me,A[96+s>>2]),ve=A[E>>2],Pe=x(y(ve))>x(.7071067690849304)?(de=A[v>>2],fe=x(x(ve*ve)+x(de*de)),Ae=x(x(1)/x(T(fe))),Le=x(fe*Ae),fe=A[f>>2],ye=x(Ae*x(-ve)),ze=x(fe*ye),be=x(0),ge=x(de*Ae),x(ge*x(-fe))):(Ae=A[f>>2],de=A[v>>2],fe=x(x(Ae*Ae)+x(de*de)),me=x(x(1)/x(T(fe))),ze=x(fe*me),ye=x(Ae*me),Le=x(ye*x(-ve)),ge=x(0),be=x(me*x(-de)),x(ve*be)),fe=x(x(1)/x(T(x(x(x(be*be)+x(ye*ye))+x(ge*ge))))),ge=x(ge*fe),A[24+he>>2]=ge,ye=x(ye*fe),A[20+he>>2]=ye,be=x(be*fe),A[16+he>>2]=be,fe=x(x(1)/x(T(x(x(ze*ze)+x(x(Le*Le)+x(Pe*Pe)))))),ze=x(ze*fe),A[8+he>>2]=ze,Pe=x(Pe*fe),A[4+he>>2]=Pe,Le=x(Le*fe),A[he>>2]=Le,(xe=2&c[r+180>>2])&&(c[28+he>>2]=0,Ne=A[r+4>>2],Ee=A[r+20>>2],Te=A[r+36>>2],De=x(x(x(x(be*Ne)+x(ye*Ee))+x(ge*Te))*A[r+164>>2]),Ce=A[r+8>>2],ve=A[r+24>>2],me=A[r+40>>2],we=x(x(x(x(be*Ce)+x(ye*ve))+x(ge*me))*A[r+168>>2]),Ae=A[r+12>>2],de=A[r+28>>2],fe=A[r+44>>2],Re=x(x(x(x(be*Ae)+x(ye*de))+x(ge*fe))*A[r+172>>2]),ge=x(x(x(Te*De)+x(me*we))+x(fe*Re)),A[24+he>>2]=ge,ye=x(x(x(Ee*De)+x(ve*we))+x(de*Re)),A[20+he>>2]=ye,be=x(x(x(Ne*De)+x(Ce*we))+x(Ae*Re)),A[16+he>>2]=be),(pe=2&c[o+180>>2])&&(c[28+he>>2]=0,Ne=A[o+4>>2],Ee=A[o+20>>2],Te=A[o+36>>2],De=x(x(x(x(Ne*be)+x(Ee*ye))+x(Te*ge))*A[o+164>>2]),Ce=A[o+8>>2],ve=A[o+24>>2],me=A[o+40>>2],we=x(x(x(x(be*Ce)+x(ye*ve))+x(ge*me))*A[o+168>>2]),Ae=A[o+12>>2],de=A[o+28>>2],fe=A[o+44>>2],Re=x(x(x(x(be*Ae)+x(ye*de))+x(ge*fe))*A[o+172>>2]),ge=x(x(x(Te*De)+x(me*we))+x(fe*Re)),A[24+he>>2]=ge,ye=x(x(x(Ee*De)+x(ve*we))+x(de*Re)),A[20+he>>2]=ye,be=x(x(x(Ne*De)+x(Ce*we))+x(Ae*Re)),A[16+he>>2]=be),xe&&(c[12+he>>2]=0,Ne=A[r+4>>2],Ee=A[r+20>>2],Te=A[r+36>>2],De=x(x(x(x(Le*Ne)+x(Pe*Ee))+x(ze*Te))*A[r+164>>2]),Ce=A[r+8>>2],ve=A[r+24>>2],me=A[r+40>>2],we=x(x(x(x(Le*Ce)+x(Pe*ve))+x(ze*me))*A[r+168>>2]),Ae=A[r+12>>2],de=A[r+28>>2],fe=A[r+44>>2],Re=x(x(x(x(Le*Ae)+x(Pe*de))+x(ze*fe))*A[r+172>>2]),ze=x(x(x(Te*De)+x(me*we))+x(fe*Re)),A[8+he>>2]=ze,Pe=x(x(x(Ee*De)+x(ve*we))+x(de*Re)),A[4+he>>2]=Pe,Le=x(x(x(Ne*De)+x(Ce*we))+x(Ae*Re)),A[he>>2]=Le),pe&&(c[12+he>>2]=0,Ne=A[o+4>>2],Ee=A[o+20>>2],Te=A[o+36>>2],De=x(x(x(x(Ne*Le)+x(Ee*Pe))+x(Te*ze))*A[o+164>>2]),Ce=A[o+8>>2],ve=A[o+24>>2],me=A[o+40>>2],we=x(x(x(x(Le*Ce)+x(Pe*ve))+x(ze*me))*A[o+168>>2]),Ae=A[o+12>>2],de=A[o+28>>2],fe=A[o+44>>2],Re=x(x(x(x(Le*Ae)+x(Pe*de))+x(ze*fe))*A[o+172>>2]),ze=x(x(x(Te*De)+x(me*we))+x(fe*Re)),A[8+he>>2]=ze,Pe=x(x(x(Ee*De)+x(ve*we))+x(de*Re)),A[4+he>>2]=Pe,Le=x(x(x(Ne*De)+x(Ce*we))+x(Ae*Re)),A[he>>2]=Le),.001<+x(T(x(x(x(be*be)+x(ye*ye))+x(ge*ge))))&&Ln(e,16+he|0,m,d,Me,A[Fe>>2]),.001<+x(T(x(x(x(Le*Le)+x(Pe*Pe))+x(ze*ze))))&&Ln(e,he,m,d,Me,A[Fe>>2]),xe=c[i+72>>2]),1&a[0|R]&&32&xe?(Fn(e,172+s|0,m,d,Me,P,48+he|0,32+he|0,Be,i,A[148+s>>2],A[(pe=164+s|0)>>2]),16&p[i+72|0]&&Fn(e,188+s|0,m,d,Me,P,48+he|0,32+he|0,Be,i,A[152+s>>2],A[pe>>2])):(c[(pe=184+s|0)>>2]=0,Ae=x(Ke-Je),de=x($e-We),fe=x(He-qe),Ce=x(x(x(Ae*F)+x(de*L))+x(fe*B)),Oe=180+s|0,Ee=A[E>>2],ve=x(fe-x(Ce*Ee)),A[Oe>>2]=ve,ke=176+s|0,Te=A[v>>2],me=x(de-x(Ce*Te)),A[ke>>2]=me,Ie=172+s|0,fe=Ae,Ae=A[f>>2],de=x(fe-x(Ce*Ae)),A[Ie>>2]=de,64&p[i+72|0]||!((fe=x(x(x(de*de)+x(me*me))+x(ve*ve)))>x(1.1920928955078125e-7))?(Ue=188+s|0,Le=x(y(Ee))>x(.7071067690849304)?(c[Ie>>2]=0,fe=x(x(Te*Te)+x(Ee*Ee)),de=x(x(1)/x(T(fe))),ge=x(de*x(-Ee)),A[ke>>2]=ge,ye=x(Te*de),A[Oe>>2]=ye,ze=x(fe*de),Pe=x(Ae*ge),be=x(0),x(ye*x(-Ae))):(c[Oe>>2]=0,fe=x(x(Ae*Ae)+x(Te*Te)),de=x(x(1)/x(T(fe))),ge=x(Ae*de),A[ke>>2]=ge,be=x(de*x(-Te)),A[Ie>>2]=be,Pe=x(fe*de),ze=x(ge*x(-Ee)),ye=x(0),x(Ee*be)),A[Ue>>2]=ze,A[(Fe=196+s|0)>>2]=Pe,A[(xe=192+s|0)>>2]=Le,1&a[r+180|0]&&(Ae=A[r+172>>2],De=A[r+44>>2],we=A[r+12>>2],Re=A[r+28>>2],de=A[r+164>>2],Ne=A[r+36>>2],Ee=A[r+4>>2],me=A[r+20>>2],fe=A[r+168>>2],Te=A[r+40>>2],Ce=A[r+8>>2],ve=A[r+24>>2],c[pe>>2]=0,Pe=me,me=x(de*x(x(x(Ee*be)+x(me*ge))+x(Ne*ye))),de=x(fe*x(x(x(be*Ce)+x(ge*ve))+x(ye*Te))),fe=x(Ae*x(x(x(be*we)+x(ge*Re))+x(ye*De))),ge=x(x(x(Pe*me)+x(ve*de))+x(Re*fe)),A[ke>>2]=ge,be=x(x(x(Ee*me)+x(Ce*de))+x(we*fe)),A[Ie>>2]=be,ye=x(x(x(Ne*me)+x(Te*de))+x(De*fe)),A[Oe>>2]=ye),1&a[o+180|0]&&(Ae=A[o+172>>2],De=A[o+44>>2],we=A[o+12>>2],Re=A[o+28>>2],de=A[o+164>>2],Ne=A[o+36>>2],Ee=A[o+4>>2],me=A[o+20>>2],fe=A[o+168>>2],Te=A[o+40>>2],Ce=A[o+8>>2],ve=A[o+24>>2],c[pe>>2]=0,Pe=me,me=x(de*x(x(x(Ee*be)+x(me*ge))+x(Ne*ye))),de=x(fe*x(x(x(be*Ce)+x(ge*ve))+x(ye*Te))),fe=x(Ae*x(x(x(be*we)+x(ge*Re))+x(ye*De))),A[ke>>2]=x(x(Pe*me)+x(ve*de))+x(Re*fe),A[Ie>>2]=x(x(Ee*me)+x(Ce*de))+x(we*fe),A[Oe>>2]=x(x(Ne*me)+x(Te*de))+x(De*fe)),Fn(e,Ie,m,d,Me,P,48+he|0,32+he|0,Be,i,x(0),x(0)),16&(pe=c[i+72>>2])&&(1&a[r+180|0]&&(Ae=A[r+172>>2],He=A[r+44>>2],We=A[r+12>>2],qe=A[r+28>>2],de=A[r+164>>2],De=A[r+36>>2],me=A[r+4>>2],we=A[r+20>>2],fe=A[r+168>>2],Re=A[r+40>>2],Ne=A[r+8>>2],Ee=A[r+24>>2],c[200+s>>2]=0,Te=A[Ue>>2],Ce=A[xe>>2],ve=A[Fe>>2],me=x(de*x(x(x((Pe=me)*Te)+x(we*Ce))+x(De*ve))),de=x(fe*x(x(x(Te*Ne)+x(Ce*Ee))+x(ve*Re))),fe=x(Ae*x(x(x(Te*We)+x(Ce*qe))+x(ve*He))),A[Ue>>2]=x(x(Pe*me)+x(Ne*de))+x(We*fe),A[xe>>2]=x(x(we*me)+x(Ee*de))+x(qe*fe),A[Fe>>2]=x(x(De*me)+x(Re*de))+x(He*fe)),1&a[o+180|0]&&(Ae=A[o+172>>2],He=A[o+44>>2],We=A[o+12>>2],qe=A[o+28>>2],de=A[o+164>>2],De=A[o+36>>2],me=A[o+4>>2],we=A[o+20>>2],fe=A[o+168>>2],Re=A[o+40>>2],Ne=A[o+8>>2],Ee=A[o+24>>2],c[200+s>>2]=0,Te=A[Ue>>2],Ce=A[xe>>2],ve=A[Fe>>2],me=x(de*x(x(x((Pe=me)*Te)+x(we*Ce))+x(De*ve))),de=x(fe*x(x(x(Te*Ne)+x(Ce*Ee))+x(ve*Re))),fe=x(Ae*x(x(x(Te*We)+x(Ce*qe))+x(ve*He))),A[Ue>>2]=x(x(Pe*me)+x(Ne*de))+x(We*fe),A[xe>>2]=x(x(we*me)+x(Ee*de))+x(qe*fe),A[Fe>>2]=x(x(De*me)+x(Re*de))+x(He*fe)),Fn(e,Ue,m,d,Me,P,48+he|0,32+he|0,Be,i,x(0),x(0)),pe=c[i+72>>2]),80==(80&pe)&&(c[R>>2]=1|c[R>>2])):(fe=x(x(1)/x(T(fe))),be=x(me*fe),A[ke>>2]=be,ge=x(de*fe),A[Ie>>2]=ge,ye=x(ve*fe),A[Oe>>2]=ye,1&a[r+180|0]&&(Ae=A[r+172>>2],De=A[r+44>>2],we=A[r+12>>2],Re=A[r+28>>2],de=A[r+164>>2],Ne=A[r+36>>2],Ee=A[r+4>>2],me=A[r+20>>2],fe=A[r+168>>2],Te=A[r+40>>2],Ce=A[r+8>>2],ve=A[r+24>>2],c[pe>>2]=0,Pe=me,me=x(de*x(x(x(ge*Ee)+x(be*me))+x(ye*Ne))),de=x(fe*x(x(x(ge*Ce)+x(be*ve))+x(ye*Te))),fe=x(Ae*x(x(x(ge*we)+x(be*Re))+x(ye*De))),be=x(x(x(Pe*me)+x(ve*de))+x(Re*fe)),A[ke>>2]=be,ge=x(x(x(Ee*me)+x(Ce*de))+x(we*fe)),A[Ie>>2]=ge,ye=x(x(x(Ne*me)+x(Te*de))+x(De*fe)),A[Oe>>2]=ye),1&a[o+180|0]&&(Ae=A[o+172>>2],De=A[o+44>>2],we=A[o+12>>2],Re=A[o+28>>2],de=A[o+164>>2],Ne=A[o+36>>2],Ee=A[o+4>>2],me=A[o+20>>2],fe=A[o+168>>2],Te=A[o+40>>2],Ce=A[o+8>>2],ve=A[o+24>>2],c[pe>>2]=0,Pe=me,me=x(de*x(x(x(Ee*ge)+x(me*be))+x(Ne*ye))),de=x(fe*x(x(x(ge*Ce)+x(be*ve))+x(ye*Te))),fe=x(Ae*x(x(x(ge*we)+x(be*Re))+x(ye*De))),A[ke>>2]=x(x(Pe*me)+x(ve*de))+x(Re*fe),A[Ie>>2]=x(x(Ee*me)+x(Ce*de))+x(we*fe),A[Oe>>2]=x(x(Ne*me)+x(Te*de))+x(De*fe)),Fn(e,Ie,m,d,Me,P,48+he|0,32+he|0,Be,i,x(0),x(0)),16&p[i+72|0]&&(xe=196+s|(c[(Fe=200+s|0)>>2]=0),ve=A[v>>2],me=A[Ie>>2],fe=A[ke>>2],Ae=A[f>>2],Ce=x(x(ve*me)-x(fe*Ae)),de=A[E>>2],Re=x(fe*de),fe=A[Oe>>2],ve=x(Re-x(fe*ve)),de=x(x(fe*Ae)-x(de*me)),fe=x(x(1)/x(T(x(x(x(ve*ve)+x(de*de))+x(Ce*Ce))))),ge=x(Ce*fe),A[xe>>2]=ge,pe=192+s|0,ye=x(de*fe),A[pe>>2]=ye,Ue=188+s|0,be=x(ve*fe),A[Ue>>2]=be,1&a[r+180|0]&&(Ae=A[r+172>>2],De=A[r+44>>2],we=A[r+12>>2],Re=A[r+28>>2],de=A[r+164>>2],Ne=A[r+36>>2],Ee=A[r+4>>2],me=A[r+20>>2],fe=A[r+168>>2],Te=A[r+40>>2],Ce=A[r+8>>2],ve=A[r+24>>2],c[Fe>>2]=0,Pe=me,me=x(de*x(x(x(be*Ee)+x(ye*me))+x(ge*Ne))),de=x(fe*x(x(x(be*Ce)+x(ye*ve))+x(ge*Te))),fe=x(Ae*x(x(x(be*we)+x(ye*Re))+x(ge*De))),ye=x(x(x(Pe*me)+x(ve*de))+x(Re*fe)),A[pe>>2]=ye,be=x(x(x(Ee*me)+x(Ce*de))+x(we*fe)),A[Ue>>2]=be,ge=x(x(x(Ne*me)+x(Te*de))+x(De*fe)),A[xe>>2]=ge),1&a[o+180|0]&&(Ae=A[o+172>>2],De=A[o+44>>2],we=A[o+12>>2],Re=A[o+28>>2],de=A[o+164>>2],Ne=A[o+36>>2],Ee=A[o+4>>2],me=A[o+20>>2],fe=A[o+168>>2],Te=A[o+40>>2],Ce=A[o+8>>2],ve=A[o+24>>2],c[Fe>>2]=0,Pe=me,me=x(de*x(x(x(Ee*be)+x(me*ye))+x(Ne*ge))),de=x(fe*x(x(x(be*Ce)+x(ye*ve))+x(ge*Te))),fe=x(Ae*x(x(x(be*we)+x(ye*Re))+x(ge*De))),A[pe>>2]=x(x(Pe*me)+x(ve*de))+x(Re*fe),A[Ue>>2]=x(x(Ee*me)+x(Ce*de))+x(we*fe),A[xe>>2]=x(x(Ne*me)+x(Te*de))+x(De*fe)),Fn(e,Ue,m,d,Me,P,48+he|0,32+he|0,Be,i,x(0),x(0))))),Fe=c[e+76>>2],xe=c[Se>>2],4&(Me=c[i+72>>2])?(pe=c[e+16>>2],Ue=c[240+(Ie=pe+O|0)>>2],Se=c[240+(Oe=pe+D|0)>>2],ke=Fe+g(xe,152)|0,ve=x(A[140+s>>2]*A[i+68>>2]),A[ke+100>>2]=ve,Se&&(Ae=A[Se+416>>2],de=A[ke+24>>2],Be=A[Se+412>>2],fe=A[ke+20>>2],me=A[Se+404>>2],A[Oe+64>>2]=x(x(ve*x(x(me*A[ke+16>>2])*A[Se+408>>2]))*A[Oe+112>>2])+A[Oe+64>>2],A[(pe=Oe+68|0)>>2]=x(x(ve*x(Be*x(me*fe)))*A[Oe+116>>2])+A[pe>>2],A[(pe=Oe+72|0)>>2]=x(x(ve*x(Ae*x(me*de)))*A[Oe+120>>2])+A[pe>>2],de=A[ke+72>>2],Be=A[ke+68>>2],A[Oe+80>>2]=x(x(ve*A[Oe+96>>2])*A[ke+64>>2])+A[Oe+80>>2],fe=A[Oe+104>>2],A[(pe=Oe+84|0)>>2]=x(Be*x(ve*A[Oe+100>>2]))+A[pe>>2],A[(pe=Oe+88|0)>>2]=x(de*x(ve*fe))+A[pe>>2]),Ue&&(Ce=A[ke+88>>2],ve=A[ke+84>>2],me=A[ke+80>>2],Ae=A[Ue+416>>2],de=A[ke+56>>2],Be=A[Ue+412>>2],fe=A[ke+52>>2],Te=A[Ue+404>>2],Ee=A[ke+100>>2],A[Ie+64>>2]=A[Ie+64>>2]+x(x(x(x(Te*A[ke+48>>2])*A[Ue+408>>2])*Ee)*A[Ie+112>>2]),A[(pe=Ie+68|0)>>2]=A[pe>>2]+x(x(Ee*x(Be*x(Te*fe)))*A[Ie+116>>2]),A[(pe=Ie+72|0)>>2]=A[pe>>2]+x(x(Ee*x(Ae*x(Te*de)))*A[Ie+120>>2]),A[Ie+80>>2]=A[Ie+80>>2]+x(me*x(Ee*A[Ie+96>>2])),fe=A[Ie+104>>2],A[(pe=Ie+84|0)>>2]=A[pe>>2]+x(ve*x(Ee*A[Ie+100>>2])),A[(pe=Ie+88|0)>>2]=A[pe>>2]+x(Ce*x(fe*Ee))),16&Me&&(Me=Fe+g(xe+1|0,152)|0,Ae=x(A[144+s>>2]*A[i+68>>2]),A[Me+100>>2]=Ae,Se&&(Be=A[Me+24>>2],fe=A[Me+20>>2],de=A[Se+404>>2],A[Oe+64>>2]=x(x(Ae*x(de*A[Me+16>>2]))*A[Oe+112>>2])+A[Oe+64>>2],A[(pe=Oe+68|0)>>2]=x(x(Ae*x(de*fe))*A[Oe+116>>2])+A[pe>>2],A[(pe=Oe+72|0)>>2]=x(x(Ae*x(de*Be))*A[Oe+120>>2])+A[pe>>2],de=A[Me+72>>2],Be=A[Me+68>>2],A[Oe+80>>2]=x(x(Ae*A[Oe+96>>2])*A[Me+64>>2])+A[Oe+80>>2],fe=A[Oe+104>>2],A[(pe=Oe+84|0)>>2]=x(Be*x(Ae*A[Oe+100>>2]))+A[pe>>2],A[(pe=Oe+88|0)>>2]=x(de*x(Ae*fe))+A[pe>>2]),Ue&&(me=A[Me+88>>2],Ae=A[Me+84>>2],de=A[Me+56>>2],Be=A[Me+52>>2],fe=A[Me+48>>2],ve=A[Ue+404>>2],Ce=A[Me+100>>2],A[Ie+80>>2]=A[Ie+80>>2]+x(A[Me+80>>2]*x(A[Ie+96>>2]*Ce)),A[Ie+64>>2]=A[Ie+64>>2]+x(x(Ce*x(ve*fe))*A[Ie+112>>2]),A[(pe=Ie+68|0)>>2]=A[pe>>2]+x(x(Ce*x(ve*Be))*A[Ie+116>>2]),A[(pe=Ie+72|0)>>2]=A[pe>>2]+x(x(Ce*x(ve*de))*A[Ie+120>>2]),fe=A[Ie+104>>2],A[(pe=Ie+84|0)>>2]=A[pe>>2]+x(Ae*x(Ce*A[Ie+100>>2])),A[(pe=Ie+88|0)>>2]=A[pe>>2]+x(me*x(fe*Ce))))):(pe=Fe+g(xe,152)|0,c[pe+100>>2]=0,16&Me&&(c[pe+252>>2]=0)),xe=c[w+844>>2]}if(!((0|(Xe=Xe+1|0))<(0|xe)))break}if((0|(Qe=Qe+1|0))==(0|n))break}N=he+64|0},function(e,t,n,i,o,a,r,s){e|=0,t|=0,n|=0,i|=0,o|=0,a|=0,s|=0;var l,_=x(0);e:if(c[s+52>>2]&&!(c[s+20>>2]<1||(0|(t=c[e+28>>2]))<1))for(n=0;;){if(_=x(0),1<=(0|t))for(i=0;l=_,a=c[e+16>>2],o=c[e+36>>2]+g(c[c[e+116>>2]+i>>2],152)|0,_=x(pi[c[e+220>>2]](a+g(c[o+144>>2],244)|0,g(c[o+148>>2],244)+a|0,o)),_=x(l+x(_*_)),i=i+4|0,t=t-1|0;);if(A[s+92>>2]>=_)break e;if(((t=c[s+20>>2])-1|0)<=(0|n))break e;if((0|t)<=(0|(n=n+1|0)))break e;t=c[e+28>>2]}},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,r,s=0,l=0,_=0,u=x(0),h=x(0),f=0,d=x(0),m=x(0),v=x(0),b=x(0),S=0,C=0,E=0,T=N-80|0;if(N=T,4&(s=c[i+72>>2])&&!((0|(n=c[e+28>>2]))<1))if(l=c[e+76>>2],t=c[e+36>>2],16&s)for(t=t+140|0;s=c[t-8>>2],A[s+132>>2]=A[t-40>>2],_=l+g(c[t>>2],152)|0,A[s+136>>2]=A[_+100>>2],A[s+140>>2]=A[_+252>>2],t=t+152|0,n=n-1|0;);else for(t=t+140|0;s=c[t-8>>2],A[s+132>>2]=A[t-40>>2],A[s+136>>2]=A[100+(l+g(c[t>>2],152)|0)>>2],t=t+152|0,n=n-1|0;);if(1<=(0|(s=c[e+48>>2])))for(t=c[e+56>>2]+100|0;l=c[t+32>>2],(n=c[l+44>>2])&&(_=c[l+28>>2],d=A[_+416>>2],m=A[t-76>>2],v=A[_+412>>2],b=A[t-80>>2],u=A[t>>2],h=x(x(1)/A[i+12>>2]),A[n>>2]=A[n>>2]+x(x(x(A[t-84>>2]*u)*A[_+408>>2])*h),A[n+4>>2]=x(x(v*x(u*b))*h)+A[n+4>>2],A[n+8>>2]=x(x(d*x(u*m))*h)+A[n+8>>2],S=c[l+32>>2],d=A[S+416>>2],m=A[t-44>>2],v=A[S+412>>2],b=A[t-48>>2],u=A[t>>2],h=x(x(1)/A[i+12>>2]),A[n+32>>2]=A[n+32>>2]+x(x(x(A[t-52>>2]*u)*A[S+408>>2])*h),A[(C=n+36|0)>>2]=x(x(v*x(u*b))*h)+A[C>>2],A[(C=n+40|0)>>2]=x(x(d*x(u*m))*h)+A[C>>2],d=A[_+612>>2],m=A[t-92>>2],v=A[_+608>>2],b=A[t-96>>2],u=A[t>>2],h=x(x(1)/A[i+12>>2]),A[n+16>>2]=A[n+16>>2]+x(x(x(A[t-100>>2]*A[_+604>>2])*u)*h),A[(_=n+20|0)>>2]=x(x(u*x(b*v))*h)+A[_>>2],A[(_=n+24|0)>>2]=x(x(u*x(m*d))*h)+A[_>>2],d=A[S+612>>2],m=A[t-60>>2],v=A[S+608>>2],b=A[t+-64>>2],u=A[t>>2],h=x(x(1)/A[i+12>>2]),A[n+48>>2]=A[n+48>>2]+x(x(x(A[t-68>>2]*A[S+604>>2])*u)*h),A[(_=n+52|0)>>2]=x(x(u*x(b*v))*h)+A[_>>2],A[(n=n+56|0)>>2]=x(x(u*x(m*d))*h)+A[n>>2]),u=A[t>>2],A[l+36>>2]=u,A[l+16>>2]<=x(y(u))&&(a[l+20|0]=0),t=t+152|0,s=s-1|0;);if(1<=(0|(s=c[e+8>>2])))for(_=c[e+16>>2],S=T+64|0,C=48+T|0,o=32+T|0,n=144;(l=c[96+(t=n+_|0)>>2])&&(c[i+52>>2]?(u=A[i+60>>2],h=A[i+12>>2],A[(l=t+32|0)>>2]=A[t-80>>2]+A[l>>2],A[(l=t+36|0)>>2]=A[t-76>>2]+A[l>>2],A[(l=t+40|0)>>2]=A[t-72>>2]+A[l>>2],A[(l=t+48|0)>>2]=A[t+-64>>2]+A[l>>2],A[(l=t+52|0)>>2]=A[t-60>>2]+A[l>>2],A[(l=t+56|0)>>2]=A[t-56>>2]+A[l>>2],A[t>>2]==x(0)&&A[t+4>>2]==x(0)&&A[t+8>>2]==x(0)&&A[t+16>>2]==x(0)&&A[t+20>>2]==x(0)&&A[t+24>>2]==x(0)||(c[12+T>>2]=0,A[8+T>>2]=A[t+24>>2]*u,A[4+T>>2]=A[t+20>>2]*u,A[T>>2]=A[t+16>>2]*u,Bn(l=t-144|0,A[t>>2],A[t+4>>2],A[t+8>>2],T,h,16+T|0),f=c[4+(_=24+T|0)>>2],c[(s=l+8|0)>>2]=c[_>>2],c[s+4>>2]=f,s=c[20+T>>2],c[l>>2]=c[16+T>>2],c[l+4>>2]=s,f=c[4+(_=8+o|0)>>2],c[(s=8+(l=t-128|0)|0)>>2]=c[_>>2],c[s+4>>2]=f,s=c[4+o>>2],c[l>>2]=c[o>>2],c[l+4>>2]=s,f=c[4+(_=C+8|0)>>2],c[(s=8+(l=t-112|0)|0)>>2]=c[_>>2],c[s+4>>2]=f,s=c[C+4>>2],c[l>>2]=c[C>>2],c[l+4>>2]=s,_=c[4+(s=S+8|0)>>2],c[(l=8+(t=t-96|0)|0)>>2]=c[s>>2],c[l+4>>2]=_,l=c[S+4>>2],c[t>>2]=c[S>>2],c[t+4>>2]=l,_=c[e+16>>2]),u=A[40+(t=n+_|0)>>2],h=A[t+36>>2],d=A[t+32>>2],l=c[t+96>>2]):(d=x(A[t-80>>2]+A[(s=t+32|0)>>2]),A[s>>2]=d,h=x(A[t-76>>2]+A[(s=t+36|0)>>2]),A[s>>2]=h,u=x(A[t-72>>2]+A[(s=t+40|0)>>2]),A[s>>2]=u,A[(s=t+48|0)>>2]=A[t+-64>>2]+A[s>>2],A[(s=t+52|0)>>2]=A[t-60>>2]+A[s>>2],A[(s=t+56|0)>>2]=A[t-56>>2]+A[s>>2]),m=A[(t=n+_|0)- -64>>2],v=A[t+68>>2],b=A[t+72>>2],c[l+384>>2]=0,A[l+380>>2]=u+b,A[l+376>>2]=h+v,A[l+372>>2]=d+m,c[l+304>>2]=c[l+304>>2]+1,t=c[e+16>>2]+n|0,u=A[t+48>>2],h=A[t+80>>2],d=A[t+52>>2],m=A[t+84>>2],v=A[t+56>>2],b=A[t+88>>2],t=c[t+96>>2],c[t+400>>2]=0,A[t+396>>2]=v+b,A[t+392>>2]=d+m,A[t+388>>2]=u+h,c[t+304>>2]=c[t+304>>2]+1,c[i+52>>2]&&(l=c[e+16>>2]+n|0,t=c[l+96>>2],c[t+304>>2]=c[t+304>>2]+1,r=c[4+(f=8+(s=l-144|0)|0)>>2],c[(_=t+12|0)>>2]=c[f>>2],c[_+4>>2]=r,_=c[s+4>>2],c[t+4>>2]=c[s>>2],c[t+8>>2]=_,r=c[4+(f=8+(s=l-128|0)|0)>>2],c[(_=t+28|0)>>2]=c[f>>2],c[_+4>>2]=r,f=c[s+4>>2],c[(_=t+20|0)>>2]=c[s>>2],c[_+4>>2]=f,f=c[4+(s=l-112|0)>>2],c[(_=t+36|0)>>2]=c[s>>2],c[_+4>>2]=f,f=c[4+(s=s+8|0)>>2],c[(_=t+44|0)>>2]=c[s>>2],c[_+4>>2]=f,f=c[4+(_=8+(l=l-96|0)|0)>>2],c[(s=t+60|0)>>2]=c[_>>2],c[s+4>>2]=f,s=c[l+4>>2],c[(t=t+52|0)>>2]=c[l>>2],c[t+4>>2]=s),_=c[e+16>>2],c[c[96+(_+n|0)>>2]+212>>2]=-1,s=c[e+8>>2]),n=n+244|0,(0|(E=E+1|0))<(0|s););return-1<c[e+28>>2]||-1<c[e+32>>2]||((t=c[e+36>>2])&&p[e+40|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+32>>2]=0,c[e+36>>2]=0,a[e+40|0]=1),c[e+28>>2]=0,-1<c[e+48>>2]||-1<c[e+52>>2]||((t=c[e+56>>2])&&p[e+60|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+52>>2]=0,c[e+56>>2]=0,a[e+60|0]=1),c[e+48>>2]=0,-1<c[e+68>>2]||-1<c[e+72>>2]||((t=c[e+76>>2])&&p[e+80|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+72>>2]=0,c[e+76>>2]=0,a[e+80|0]=1),c[e+68>>2]=0,-1<c[e+88>>2]||-1<c[e+92>>2]||((t=c[e+96>>2])&&p[e+100|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+92>>2]=0,c[e+96>>2]=0,a[e+100|0]=1),c[e+88>>2]=0,-1<c[e+8>>2]||-1<c[e+12>>2]||((t=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+12>>2]=0,c[e+16>>2]=0,a[e+20|0]=1),c[e+8>>2]=0,N=80+T|0,x(x(0))},function(e,t,n,i,o,r,s,l,_,u){e|=0,t|=0,n|=0,i|=0,o|=0,r|=0,s|=0,l|=0,_|=0,u|=0;var h,f,d,m=x(0),v=x(0),y=0,b=0,S=x(0),C=0,E=0;if(1&a[_+72|0]){if(h=c[e+68>>2],f=c[e+28>>2],1<=(0|(b=c[e+48>>2]))){if(o=g(c[e+232>>2],1664525)+1013904223|0,1!=(0|b)&&(i=c[e+136>>2],n=c[i+4>>2],r=(o=g(o,1664525)+1013904223|0)^o>>>16,r^=r>>>8,r^=r>>>4,c[i+4>>2]=c[(r=i+((1&((r^=r>>>2)>>>1^r))<<2)|0)>>2],c[r>>2]=n,2!=(0|b)&&(n=c[i+8>>2],r=(o=g(o,1664525)+1013904223|0)^o>>>16,r^=r>>>8,c[i+8>>2]=c[(r=i+((((r^=r>>>4)>>>2^r)>>>0)%3<<2)|0)>>2],c[r>>2]=n,3!=(0|b)&&(n=c[i+12>>2],r=(o=g(o,1664525)+1013904223|0)^o>>>16,r^=r>>>8,c[i+12>>2]=c[(r=i+((3&((r^=r>>>4)>>>2^r))<<2)|0)>>2],c[r>>2]=n,4!=(0|b)))))for(u=i+16|0,n=4;n=(r=n)+1|0,C=c[u>>2],d=u,y=o=g(o,1664525)+1013904223|0,65535<r>>>0||(y=E=o>>>16^o,255<r>>>0||(y=E^=E>>>8,15<r>>>0||(y=E^E>>>4))),c[d>>2]=c[(r=((y>>>0)%(n>>>0)<<2)+i|0)>>2],c[r>>2]=C,u=u+4|0,(0|n)!=(0|b););c[e+232>>2]=o}if(!(c[_+20>>2]<=(0|t))){if(1<=(0|f)){if(o=g(c[e+232>>2],1664525)+1013904223|0,1!=(0|f)&&(i=c[e+116>>2],n=c[i+4>>2],r=(o=g(o,1664525)+1013904223|0)^o>>>16,r^=r>>>8,r^=r>>>4,c[i+4>>2]=c[(r=i+((1&((r^=r>>>2)>>>1^r))<<2)|0)>>2],c[r>>2]=n,2!=(0|f)&&(n=c[i+8>>2],r=(o=g(o,1664525)+1013904223|0)^o>>>16,r^=r>>>8,c[i+8>>2]=c[(r=i+((((r^=r>>>4)>>>2^r)>>>0)%3<<2)|0)>>2],c[r>>2]=n,3!=(0|f)&&(n=c[i+12>>2],r=(o=g(o,1664525)+1013904223|0)^o>>>16,r^=r>>>8,c[i+12>>2]=c[(r=i+((3&((r^=r>>>4)>>>2^r))<<2)|0)>>2],c[r>>2]=n,4!=(0|f)))))for(u=i+16|0,n=4;n=(r=n)+1|0,E=c[u>>2],b=u,y=o=g(o,1664525)+1013904223|0,65535<r>>>0||(y=C=o>>>16^o,255<r>>>0||(y=C^=C>>>8,15<r>>>0||(y=C^C>>>4))),c[b>>2]=c[(r=((y>>>0)%(n>>>0)<<2)+i|0)>>2],c[r>>2]=E,u=u+4|0,(0|n)!=(0|f););c[e+232>>2]=o}if(!((0|h)<1)){if(o=g(c[e+232>>2],1664525)+1013904223|0,1!=(0|h)&&(i=c[e+156>>2],n=c[i+4>>2],r=(o=g(o,1664525)+1013904223|0)^o>>>16,r^=r>>>8,r^=r>>>4,c[i+4>>2]=c[(r=i+((1&((r^=r>>>2)>>>1^r))<<2)|0)>>2],c[r>>2]=n,2!=(0|h)&&(n=c[i+8>>2],r=(o=g(o,1664525)+1013904223|0)^o>>>16,r^=r>>>8,c[i+8>>2]=c[(r=i+((((r^=r>>>4)>>>2^r)>>>0)%3<<2)|0)>>2],c[r>>2]=n,3!=(0|h)&&(n=c[i+12>>2],r=(o=g(o,1664525)+1013904223|0)^o>>>16,r^=r>>>8,c[i+12>>2]=c[(r=i+((3&((r^=r>>>4)>>>2^r))<<2)|0)>>2],c[r>>2]=n,4!=(0|h)))))for(u=i+16|0,n=4;n=(r=n)+1|0,C=c[u>>2],E=u,y=o=g(o,1664525)+1013904223|0,65535<r>>>0||(y=b=o>>>16^o,255<r>>>0||(y=b^=b>>>8,15<r>>>0||(y=b^b>>>4))),c[E>>2]=c[(r=((y>>>0)%(n>>>0)<<2)+i|0)>>2],c[r>>2]=C,u=u+4|0,(0|n)!=(0|h););c[e+232>>2]=o}}}if(1<=(0|(r=c[e+48>>2])))for(n=o=0;i=c[e+56>>2]+g(c[c[e+136>>2]+o>>2],152)|0,c[i+136>>2]>(0|t)&&(v=m,r=c[e+16>>2],m=x(pi[c[e+212>>2]](r+g(c[i+144>>2],244)|0,r+g(c[i+148>>2],244)|0,i)),m=x(v+x(m*m)),r=c[e+48>>2]),o=o+4|0,(0|(n=n+1|0))<(0|r););if(!(c[_+20>>2]<=(0|t))){if(1<=(0|l))for(;t=c[s>>2],p[t+20|0]&&(t=zn(e,c[t+28>>2],A[_+12>>2]),n=zn(e,c[c[s>>2]+32>>2],A[_+12>>2]),i=c[s>>2],o=g(t,244),t=c[e+16>>2],pi[c[c[i>>2]+24>>2]](i,o+t|0,t+g(n,244)|0,A[_+12>>2])),s=s+4|0,l=l-1|0;);if(o=c[e+28>>2],512&(t=c[_+72>>2])){if(!((0|o)<1))for(i=(16&t?2:1)<<2,s=0,n=4;v=m,r=c[e+16>>2],t=c[e+36>>2]+g(c[c[e+116>>2]+s>>2],152)|0,m=x(pi[c[e+216>>2]](r+g(c[t+144>>2],244)|0,r+g(c[t+148>>2],244)|0,t)),m=x(v+x(m*m)),(r=!((v=A[t+100>>2])>x(0)))||(t=c[e+76>>2]+g(c[(c[e+156>>2]+n|0)-4>>2],152)|0,S=A[t+104>>2],A[t+124>>2]=v*S,A[t+120>>2]=v*x(-S),S=m,l=c[e+16>>2],m=x(pi[c[e+212>>2]](l+g(c[t+144>>2],244)|0,l+g(c[t+148>>2],244)|0,t)),m=x(S+x(m*m))),16&p[_+72|0]&&(r||(t=c[e+76>>2]+g(c[c[e+156>>2]+n>>2],152)|0,S=A[t+104>>2],A[t+124>>2]=v*S,A[t+120>>2]=v*x(-S),v=m,r=c[e+16>>2],m=x(pi[c[e+212>>2]](r+g(c[t+144>>2],244)|0,r+g(c[t+148>>2],244)|0,t)),m=x(v+x(m*m)))),s=s+4|0,n=n+i|0,o=o-1|0;);}else{if(1<=(0|o))for(u=0;v=m,n=c[e+16>>2],t=c[e+36>>2]+g(c[c[e+116>>2]+u>>2],152)|0,m=x(pi[c[e+216>>2]](n+g(c[t+144>>2],244)|0,n+g(c[t+148>>2],244)|0,t)),m=x(v+x(m*m)),u=u+4|0,o=o-1|0;);if(!((0|(s=c[e+68>>2]))<1))for(u=0;t=c[e+76>>2]+g(c[c[e+156>>2]+u>>2],152)|0,(v=A[100+(c[e+36>>2]+g(c[t+140>>2],152)|0)>>2])>x(0)&&(S=A[t+104>>2],A[t+124>>2]=v*S,A[t+120>>2]=v*x(-S),v=m,n=c[e+16>>2],m=x(pi[c[e+212>>2]](n+g(c[t+144>>2],244)|0,n+g(c[t+148>>2],244)|0,t)),m=x(v+x(m*m))),u=u+4|0,s=s-1|0;);}if(!((0|(s=c[e+88>>2]))<1))for(u=148;t=c[e+96>>2]+u|0,(v=A[100+(c[e+36>>2]+g(c[t-8>>2],152)|0)>>2])>x(0)&&(S=v,v=A[t-44>>2],S=x(S*v),A[t-24>>2]=v=v<S?v:S,A[t-28>>2]=-v,v=m,n=c[e+16>>2],m=x(pi[c[e+212>>2]](n+g(c[t-4>>2],244)|0,n+g(c[t>>2],244)|0,t-148|0)),m=x(v+x(m*m))),u=u+152|0,s=s-1|0;);}return x(m)},function(e,t,n,i,o,r,s,l,_){e|=0,t|=0,n|=0,i|=0,o|=0,r|=0,s|=0,l|=0,_|=0;var u,h,f,d,m,v,b,S,C,E,P,w,I,R,D,O,L,F,U,G,j=0,V=x(0),H=0,W=x(0),q=x(0),Y=0,X=x(0),Q=x(0),Z=x(0),J=0,K=x(0),$=x(0),ee=x(0),te=x(0),ne=0,ie=0,oe=x(0),ae=x(0),re=x(0),se=x(0),ce=x(0),le=x(0),_e=x(0),ue=x(0),he=x(0),fe=x(0),pe=x(0),de=x(0),me=x(0),Ae=0,ve=x(0),ge=x(0),xe=x(0),ye=x(0),be=x(0),Se=x(0),Ce=x(0),Ee=x(0),Te=0,Pe=0,we=0;if(N=G=N-256|0,c[e+188>>2]=-1,(0|(_=c[l+72>>2]))!=c[e+224>>2]&&(c[e+224>>2]=_,c[e+220>>2]=26,c[e+216>>2]=27,c[e+212>>2]=28),1<=((c[e+184>>2]=0)|n))for(_=t,H=n;c[c[_>>2]+212>>2]=-1,_=_+4|0,H=H-1|0;);if((0|(_=c[e+12>>2]))<=(0|n)){if((_=n+1|0)&&(c[5498]=c[5498]+1,(H=M(g(_,244)+19|0))&&(c[(we=H+19&-16)-4>>2]=H)),1<=(0|(Y=c[e+8>>2])))for(ne=64;Te=c[e+16>>2]+ne|0,H=c[4+(ie=Te+-64|0)>>2],c[(j=(Ae=ne+we|0)-64|0)>>2]=c[ie>>2],c[j+4>>2]=H,H=c[4+(J=ie+8|0)>>2],c[(j=j+8|0)>>2]=c[J>>2],c[j+4>>2]=H,H=c[4+(J=8+(ie=Te-48|0)|0)>>2],c[(j=8+(Pe=Ae-48|0)|0)>>2]=c[J>>2],c[j+4>>2]=H,H=c[ie+4>>2],c[Pe>>2]=c[ie>>2],c[Pe+4>>2]=H,H=c[4+(J=8+(ie=Te-32|0)|0)>>2],c[(j=8+(Pe=Ae-32|0)|0)>>2]=c[J>>2],c[j+4>>2]=H,H=c[ie+4>>2],c[Pe>>2]=c[ie>>2],c[Pe+4>>2]=H,H=c[4+(ie=Te-16|0)>>2],c[(j=Ae-16|0)>>2]=c[ie>>2],c[j+4>>2]=H,H=c[4+(J=ie+8|0)>>2],c[(j=j+8|0)>>2]=c[J>>2],c[j+4>>2]=H,k(Ae,Te,180),ne=ne+244|0,Y=Y-1|0;);(H=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[H-4>>2])),c[e+16>>2]=we,c[e+12>>2]=_,a[e+20|0]=1}if(B(8+G|0,0,244),(0|(H=c[e+8>>2]))<=-1)for((0|_)<=-1&&((_=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[_-4>>2])),c[e+12>>2]=0,c[e+16>>2]=0,a[e+20|0]=1),ne=g(H,244),Pe=72+G|0,Te=56+G|0,J=40+G|0,Y=24+G|0;_=c[12+G>>2],Ae=c[e+16>>2]+ne|0,c[Ae>>2]=c[8+G>>2],c[Ae+4>>2]=_,_=c[4+(j=16+G|0)>>2],c[(ie=Ae+8|0)>>2]=c[j>>2],c[ie+4>>2]=_,_=c[Y+4>>2],c[(j=Ae+16|0)>>2]=c[Y>>2],c[j+4>>2]=_,_=c[4+(j=Y+8|0)>>2],c[(ie=Ae+24|0)>>2]=c[j>>2],c[ie+4>>2]=_,_=c[J+4>>2],c[(j=Ae+32|0)>>2]=c[J>>2],c[j+4>>2]=_,_=c[4+(j=J+8|0)>>2],c[(ie=Ae+40|0)>>2]=c[j>>2],c[ie+4>>2]=_,_=c[Te+4>>2],c[(j=Ae+48|0)>>2]=c[Te>>2],c[j+4>>2]=_,_=c[4+(j=Te+8|0)>>2],c[(ie=Ae+56|0)>>2]=c[j>>2],c[ie+4>>2]=_,k(Ae- -64|0,Pe,180),ne=ne+244|0,(_=H)>>>0<=(H=_+1|0)>>>0;);if(1<=((c[e+8>>2]=0)|n))for(;J=zn(e,c[t>>2],A[l+12>>2]),(j=c[t>>2])&&2&c[j+252>>2]&&A[j+404>>2]!=x(0)&&(Y=c[e+16>>2],2&(ne=c[j+564>>2])&&(ve=A[j+388>>2],be=A[j+4>>2],X=(V=A[j+456>>2])!=x(0)?x(x(1)/V):x(0),ge=A[j+20>>2],W=x(X*ge),Se=A[j+8>>2],Z=(V=A[j+460>>2])!=x(0)?x(x(1)/V):x(0),oe=A[j+24>>2],q=x(Z*oe),pe=A[j+12>>2],K=(V=A[j+464>>2])!=x(0)?x(x(1)/V):x(0),$=A[j+28>>2],V=x(K*$),le=A[j+392>>2],ue=A[j+36>>2],ee=A[j+40>>2],Q=A[j+44>>2],me=A[j+396>>2],ae=x(x(x(ve*x(x(x(be*W)+x(Se*q))+x(pe*V)))+x(x(x(x(ge*W)+x(oe*q))+x($*V))*le))+x(x(x(x(W*ue)+x(q*ee))+x(V*Q))*me)),W=x(X*be),q=x(Z*Se),V=x(K*pe),q=x(x(x(x(x(x(be*W)+x(Se*q))+x(pe*V))*ve)+x(le*x(x(x(W*ge)+x(q*oe))+x(V*$))))+x(x(x(x(W*ue)+x(q*ee))+x(V*Q))*me)),_e=x(x(ve*ae)-x(le*q)),X=x(X*ue),W=x(Z*ee),V=x(K*Q),V=x(x(me*x(x(x(ue*X)+x(ee*W))+x(Q*V)))+x(x(ve*x(x(x(be*X)+x(Se*W))+x(pe*V)))+x(le*x(x(x(ge*X)+x(oe*W))+x($*V))))),Q=x(x(le*V)-x(me*ae)),Z=x(x(me*q)-x(ve*V)),V=x(x(_e*_e)+x(x(Q*Q)+x(Z*Z))),te=A[l+84>>2],V>x(te*te)&&(V=x(x(x(1)/x(T(V)))*te),_e=x(_e*V),Q=x(Q*V),Z=x(Z*V)),ae=A[j+364>>2],te=A[j+332>>2],X=A[j+348>>2],W=A[j+360>>2],q=A[j+328>>2],V=A[j+344>>2],H=Y+g(J,244)|0,K=A[l+12>>2],A[H+224>>2]=A[H+224>>2]-x(x(x(x(Q*A[j+324>>2])+x(Z*A[j+340>>2]))+x(_e*A[j+356>>2]))*K),A[(_=H+228|0)>>2]=A[_>>2]-x(K*x(x(x(Q*q)+x(Z*V))+x(_e*W))),A[(_=H+232|0)>>2]=A[_>>2]-x(K*x(x(x(Q*te)+x(Z*X))+x(_e*ae))),ne=c[j+564>>2]),4&ne&&(Ce=A[j+36>>2],Z=(V=A[j+456>>2])!=x(0)?x(x(1)/V):x(0),W=x(Ce*Z),de=A[j+40>>2],K=(V=A[j+460>>2])!=x(0)?x(x(1)/V):x(0),q=x(de*K),_e=A[j+44>>2],Q=(V=A[j+464>>2])!=x(0)?x(x(1)/V):x(0),V=x(_e*Q),Ee=A[l+12>>2],ve=x(Ee*x(0)),re=A[j+396>>2],xe=x(x(x(Ce*W)+x(de*q))+x(_e*V)),se=A[j+388>>2],le=A[j+4>>2],oe=A[j+8>>2],pe=A[j+12>>2],me=x(x(x(le*W)+x(oe*q))+x(pe*V)),ae=x(se*me),ce=A[j+392>>2],$=A[j+20>>2],ue=A[j+24>>2],ee=A[j+28>>2],be=x(x(x($*W)+x(ue*q))+x(ee*V)),te=x(ce*be),he=x(x(re*xe)+x(ae+te)),W=x(Z*$),q=x(K*ue),V=x(Q*ee),ge=x(x(x(le*W)+x(oe*q))+x(pe*V)),X=x(se*ge),ye=x(x(x($*W)+x(ue*q))+x(ee*V)),Se=x(x(x(W*Ce)+x(q*de))+x(V*_e)),W=x(re*Se),fe=x(x(X+x(ce*ye))+W),Z=x(Z*le),K=x(K*oe),V=x(Q*pe),le=x(x(x(le*Z)+x(oe*K))+x(pe*V)),ee=x(x(x(Z*$)+x(K*ue))+x(V*ee)),q=x(ce*ee),Q=x(x(x(Z*Ce)+x(K*de))+x(V*_e)),V=x(re*Q),de=x(x(x(se*le)+q)+V),_e=x(x(he+x(x(x(se*fe)-x(ce*de))*Ee))-x(ve+he)),Z=x(me+x(x(fe+x(x(X-x(ce*le))+x(me*x(0))))*Ee)),oe=x(Se+x(x(de+x(x(V+x(Se*x(0)))-x(se*xe)))*Ee)),pe=x(ee+x(x(x(x(x(ee*x(0))-x(re*ye))+te)+he)*Ee)),$=x(ye+x(x(x(x(re*ee)+x(ye*x(0)))-x(se*be))*Ee)),ue=x(Q+x(x(x(x(x(Q*x(0))-W)+x(ce*xe))-fe)*Ee)),W=x(x(oe*pe)-x($*ue)),K=x(le+x(x(x(x(le*x(0))-x(re*ge))+x(ce*me))*Ee)),ee=x(xe+x(x(x(x(se*Se)-x(ce*Q))+x(xe*x(0)))*Ee)),Q=x(be+x(x(x(x(x(se*ye)-q)+x(be*x(0)))-de)*Ee)),q=x(x($*ee)-x(Q*oe)),te=x(ge+x(x(x(x(x(re*le)+x(ge*x(0)))-ae)-he)*Ee)),V=x(x(Q*ue)-x(ee*pe)),X=x(x(Z*W)+x(x(K*q)+x(te*V))),X=x(y(X))>x(1.1920928955078125e-7)?x(x(1)/X):X,H=Y+g(J,244)|0,ae=x(_e*W),W=x(x(de+x(x(x(ce*he)-x(re*fe))*Ee))-x(ve+de)),le=x(q*W),q=x(x(fe+x(x(x(re*de)-x(se*he))*Ee))-x(ve+fe)),A[H+224>>2]=x(x(se-x(x(ae+x(le+x(q*V)))*X))-se)+A[H+224>>2],A[(_=H+228|0)>>2]=x(x(ce-x(x(x(Z*x(x(oe*W)-x(ue*q)))+x(x(K*x(x(ee*q)-x(oe*_e)))+x(te*x(x(ue*_e)-x(ee*W)))))*X))-ce)+A[_>>2],A[(_=H+232|0)>>2]=x(x(re-x(x(x(Z*x(x(pe*q)-x($*W)))+x(x(K*x(x($*_e)-x(Q*q)))+x(te*x(x(Q*W)-x(pe*_e)))))*X))-re)+A[_>>2],ne=c[j+564>>2]),8&ne&&(ae=A[j+456>>2],te=A[j+464>>2],X=A[j+460>>2],de=A[j+396>>2],_e=A[j+392>>2],ve=A[j+388>>2],re=A[l+12>>2],Rn(j+4|0,8+G|0),se=A[16+G>>2],ce=A[20+G>>2],he=A[12+G>>2],Q=x(x(_e*se)+x(x(ve*ce)-x(de*he))),fe=A[8+G>>2],W=x(x(x(ve*fe)+x(_e*he))+x(de*se)),q=x(x(ve*he)+x(x(de*ce)-x(_e*fe))),V=x(x(de*fe)+x(x(_e*ce)-x(ve*se))),xe=x(x(x(he*Q)+x(x(se*W)+x(ce*q)))-x(fe*V)),Z=x(xe*x(0)),ye=x(x(x(se*V)+x(x(fe*W)+x(ce*Q)))-x(he*q)),K=x(ye*x(0)),me=X!=x(0)?x(x(1)/X):x(0),Ce=x(x(x(fe*q)+x(x(he*W)+x(ce*V)))-x(se*Q)),be=x(Z+x(K+x(me*Ce))),ge=ae!=x(0)?x(x(1)/ae):x(0),pe=x(x(re*x(x(x(K-x(ge*Ce))+x(0))+be))+x(0)),X=te!=x(0)?x(x(1)/te):x(0),V=x(Ce*x(0)),oe=x(x(xe*X)+x(K+V)),$=x(Z+x(x(ge*ye)+V)),le=x(re*x(x(xe*$)-x(ye*oe))),W=x(xe*x(-0)),ue=x(ge+x(re*x(V+x(x(ge*x(0))+W)))),q=x(Ce*x(-0)),Se=x(x(re*x(x(x(q+x(me*ye))+x(0))-$))+x(0)),ee=x(x(re*x(x(V+x(x(0)-x(me*xe)))+oe))+x(0)),Q=x(x(re*x(x(x(Z+x(0))-x(X*ye))+$))+x(0)),V=x(ye*x(-0)),ae=x(me+x(re*x(V+x(x(me*x(0))+Z)))),Z=x(x(re*x(x(x(X*Ce)+x(W+x(0)))-be))+x(0)),W=x(x(ee*Q)-x(ae*Z)),K=x(X+x(re*x(x(X*x(0))+x(q+K)))),q=x(x(ae*K)-x(Se*Q)),te=x(x(re*x(x(V+x(x(ge*xe)+x(0)))-oe))+x(0)),V=x(x(Se*Z)-x(K*ee)),X=x(x(pe*W)+x(x(ue*q)+x(te*V))),X=x(y(X))>x(1.1920928955078125e-7)?x(x(1)/X):X,H=Y+g(J,244)|0,oe=x(re*x(x(Ce*oe)-x(xe*be))),$=x(re*x(x(ye*be)-x(Ce*$))),ae=x(xe-x(x(x(pe*x(x(ee*le)-x(ae*oe)))+x(x(ue*x(x(ae*$)-x(Se*le)))+x(te*x(x(Se*oe)-x(ee*$)))))*X)),te=x(Ce-x(x(x(pe*x(x(Q*oe)-x(Z*le)))+x(x(ue*x(x(K*le)-x(Q*$)))+x(te*x(x(Z*$)-x(K*oe)))))*X)),V=x(ye-x(x(x($*W)+x(x(oe*q)+x(le*V)))*X)),X=x(x(x(ce*ae)+x(fe*te))-x(he*V)),W=x(x(x(ce*V)+x(he*ae))-x(se*te)),q=x(x(x(V*x(-fe))-x(he*te))-x(se*ae)),V=x(x(x(se*V)+x(ce*te))-x(fe*ae)),A[H+224>>2]=x(x(x(he*X)+x(x(x(ce*W)-x(fe*q))-x(se*V)))-ve)+A[H+224>>2],A[(_=H+228|0)>>2]=x(x(x(se*W)+x(x(x(ce*V)-x(he*q))-x(fe*X)))-_e)+A[_>>2],A[(_=H+232|0)>>2]=x(x(x(fe*V)+x(x(x(ce*X)-x(se*q))-x(he*W)))-de)+A[_>>2])),t=t+4|0,n=n-1|0;);if(1<=(0|s))for(_=r,H=s;t=c[_>>2],pi[c[c[t>>2]+8>>2]](t),_=_+4|(c[t+36>>2]=0),H=H-1|0;);if(!((0|s)<=(0|(t=c[e+168>>2]))||c[e+172>>2]>=(0|s))){if(H=0,s&&(c[5498]=c[5498]+1,(n=M(19+(s<<3)|0))&&(c[(H=n+19&-16)-4>>2]=n)),1<=(0|t))for(_=0;Y=c[e+176>>2]+_|0,n=c[Y+4>>2],c[(J=_+H|0)>>2]=c[Y>>2],c[J+4>>2]=n,_=_+8|0,t=t-1|0;);(t=c[e+176>>2])&&p[e+180|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+176>>2]=H,c[e+172>>2]=s,a[e+180|0]=1}if((0|(c[e+168>>2]=s))<1)ne=0;else for(H=r,Y=s,ne=n=0;_=c[e+176>>2],t=c[H>>2],(J=c[t+44>>2])&&(c[J>>2]=0,c[J+4>>2]=0,c[(t=J+56|0)>>2]=0,c[t+4>>2]=0,c[(t=J+48|0)>>2]=0,c[t+4>>2]=0,c[(t=J+40|0)>>2]=0,c[t+4>>2]=0,c[(t=J+32|0)>>2]=0,c[t+4>>2]=0,c[(t=J+24|0)>>2]=0,c[t+4>>2]=0,c[(t=J+16|0)>>2]=0,c[t+4>>2]=0,c[(t=J+8|0)>>2]=0,c[t+4>>2]=0,t=c[H>>2]),_=n+_|0,H=H+4|0,n=n+8|0,ne=(t=p[t+20|0]?(pi[c[c[t>>2]+16>>2]](t,_),c[_>>2]):(c[_>>2]=0,c[_+4>>2]=0))+ne|0,Y=Y-1|0;);if(!((0|ne)<=(0|(t=c[e+48>>2]))||c[e+52>>2]>=(0|ne))){if(H=0,ne&&(c[5498]=c[5498]+1,(n=M(g(ne,152)+19|0))&&(c[(H=n+19&-16)-4>>2]=n)),1<=(0|t))for(_=0;k(_+H|0,c[e+56>>2]+_|0,152),_=_+152|0,t=t-1|0;);(t=c[e+56>>2])&&p[e+60|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+56>>2]=H,c[e+52>>2]=ne,a[e+60|0]=1}if(c[e+48>>2]=ne,1<=(0|s))for(t=c[e+176>>2],H=we=0;;){if(R=H,c[(P=(I=we<<3)+t|0)>>2]){if(E=c[(w=(we<<2)+r|0)>>2],u=c[E+32>>2],n=c[e+56>>2],ne=zn(e,h=c[E+28>>2],A[l+12>>2]),J=zn(e,u,A[l+12>>2]),t=c[E+24>>2],_=c[l+20>>2],(0|(Y=0<(0|t)?t:_))>c[e+184>>2]&&(c[e+184>>2]=Y),j=n+g(H,152)|0,H=c[e+16>>2],1<=c[P>>2]){for(_=j+148|0,n=0;B(_-148|0,0,152),c[(t=_-28|0)>>2]=-8388609,c[t+4>>2]=2139095039,c[_>>2]=J,c[_-4>>2]=ne,c[(t=_-52|0)>>2]=0,c[t+4>>2]=0,c[_-12>>2]=Y,_=_+152|0,(0|(n=n+1|0))<c[P>>2];);_=c[l+20>>2]}if(f=H+g(ne,244)|0,c[(t=f)+144>>2]=0,c[t+148>>2]=0,c[(t=t+152|0)>>2]=0,c[t+4>>2]=0,c[(t=160+f|0)>>2]=0,c[t+4>>2]=0,c[(t=168+f|0)>>2]=0,c[t+4>>2]=0,c[64+f>>2]=0,c[68+f>>2]=0,c[(t=88+f|0)>>2]=0,c[t+4>>2]=0,c[(t=80+f|0)>>2]=0,c[t+4>>2]=0,c[(t=72+f|0)>>2]=0,c[t+4>>2]=0,n=H+g(J,244)|0,c[(t=n)+144>>2]=0,c[t+148>>2]=0,c[(t=t+152|0)>>2]=0,c[t+4>>2]=0,c[(t=n+160|0)>>2]=0,c[t+4>>2]=0,c[(t=n+168|0)>>2]=0,c[t+4>>2]=0,c[n+64>>2]=0,c[n+68>>2]=0,c[(t=n+72|0)>>2]=0,c[t+4>>2]=0,c[(t=n+80|0)>>2]=0,c[t+4>>2]=0,c[(t=n+88|0)>>2]=0,c[t+4>>2]=0,A[j+116>>2]=A[l+40>>2],c[36+G>>2]=j+112,c[32+G>>2]=38,c[28+G>>2]=j+32,c[52+G>>2]=_,c[48+G>>2]=j+124,c[44+G>>2]=j+120,c[40+G>>2]=j+116,A[56+G>>2]=A[l+4>>2],c[24+G>>2]=j+48,c[20+G>>2]=j,c[16+G>>2]=j+16,A[12+G>>2]=A[l+32>>2],A[8+G>>2]=x(1)/A[l+12>>2],t=c[w>>2],pi[c[c[t>>2]+20>>2]](t,8+G|0),1<=c[P>>2])for(_=j+68|0,D=n+232|0,O=n+228|0,L=n+224|0,F=n+216|0,U=n+212|0,Ae=n+208|0,Te=n+240|0,Pe=232+f|0,ie=228+f|0,j=224+f|0,ne=216+f|0,J=212+f|0,Y=208+f|0,H=240+f|0,n=0;(V=A[c[w>>2]+16>>2])<=A[(t=_+56|0)>>2]&&(A[t>>2]=V),(V=x(-V))>=A[(t=_+52|0)>>2]&&(A[t>>2]=V),c[_- -64>>2]=E,t=c[E+28>>2],$=A[t+328>>2],ue=A[t+332>>2],ee=A[t+608>>2],Q=A[t+348>>2],Z=A[t+340>>2],K=A[t+344>>2],ae=A[t+612>>2],te=A[t+364>>2],X=A[t+356>>2],W=A[t+360>>2],q=A[t+604>>2],V=A[t+324>>2],c[_+8>>2]=0,d=A[_-68>>2],m=A[_+-64>>2],v=A[_-60>>2],A[_+4>>2]=ae*x(x(x(X*d)+x(W*m))+x(te*v)),A[_>>2]=ee*x(x(x(d*Z)+x(m*K))+x(v*Q)),A[_-4>>2]=q*x(x(x(V*d)+x($*m))+x(ue*v)),t=c[E+32>>2],$=A[t+328>>2],ue=A[t+332>>2],ee=A[t+608>>2],Q=A[t+348>>2],Z=A[t+340>>2],K=A[t+344>>2],ae=A[t+612>>2],te=A[t+364>>2],X=A[t+356>>2],W=A[t+360>>2],q=A[t+604>>2],V=A[t+324>>2],c[_+24>>2]=0,b=A[_-36>>2],S=A[_-32>>2],C=A[_-28>>2],A[_+20>>2]=ae*x(x(x(X*b)+x(W*S))+x(te*C)),A[_+16>>2]=ee*x(x(x(b*Z)+x(S*K))+x(C*Q)),A[_+12>>2]=q*x(x(x(V*b)+x($*S))+x(ue*C)),Ee=x(0),re=A[_-52>>2],V=A[h+404>>2],se=A[_-48>>2],ce=A[_-44>>2],W=x(x(x(x(re*x(re*V))+x(se*x(V*se)))+x(ce*x(V*ce)))+x(x(x(d*x(x(x(d*A[h+324>>2])+x(m*A[h+328>>2]))+x(v*A[h+332>>2])))+x(m*x(x(x(d*A[h+340>>2])+x(m*A[h+344>>2]))+x(v*A[h+348>>2]))))+x(v*x(x(x(d*A[h+356>>2])+x(m*A[h+360>>2]))+x(v*A[h+364>>2]))))),he=A[_-20>>2],V=A[u+404>>2],fe=A[_-16>>2],xe=A[_-12>>2],V=x(x(W+x(x(x(he*x(he*V))+x(fe*x(V*fe)))+x(xe*x(V*xe))))+x(x(x(b*x(x(x(b*A[u+324>>2])+x(S*A[u+328>>2]))+x(C*A[u+332>>2])))+x(S*x(x(x(b*A[u+340>>2])+x(S*A[u+344>>2]))+x(C*A[u+348>>2]))))+x(C*x(x(x(b*A[u+356>>2])+x(S*A[u+360>>2]))+x(C*A[u+364>>2]))))),ye=x(y(V))>x(1.1920928955078125e-7)?x(x(1)/V):x(0),A[_+40>>2]=ye,Ce=x(0),de=x(0),_e=x(0),ve=x(0),le=x(0),me=x(0),c[H>>2]&&(le=A[ie>>2],ve=A[j>>2],de=A[J>>2],_e=A[Y>>2],Ce=A[ne>>2],me=A[Pe>>2]),be=x(0),ge=x(0),Se=x(0),oe=x(0),pe=x(0),c[Te>>2]&&(oe=A[O>>2],Se=A[L>>2],be=A[U>>2],ge=A[Ae>>2],Ee=A[F>>2],pe=A[D>>2]),$=A[h+380>>2],ue=A[h+372>>2],ee=A[h+376>>2],Q=A[h+396>>2],Z=A[h+388>>2],K=A[h+392>>2],ae=A[u+380>>2],te=A[u+372>>2],X=A[u+376>>2],W=A[u+396>>2],q=A[u+388>>2],V=A[u+392>>2],c[_+32>>2]=0,A[(t=_+44|0)>>2]=x(ye*A[t>>2])+x(ye*x(x(0)-x(A[56+G>>2]*x(x(x(x(x(re*x(_e+ue))+x(se*x(de+ee)))+x(ce*x(Ce+$)))+x(x(x(d*x(ve+Z))+x(m*x(le+K)))+x(v*x(me+Q))))+x(x(x(x(he*x(ge+te))+x(fe*x(be+X)))+x(xe*x(Ee+ae)))+x(x(x(b*x(Se+q))+x(S*x(oe+V)))+x(C*x(pe+W)))))))),_=_+152|0,(0|(n=n+1|0))<c[P>>2];);t=c[e+176>>2],n=c[I+t>>2]}else n=0;if(H=R+n|0,(0|(we=we+1|0))==(0|s))break}if(pi[c[c[e>>2]+28>>2]](e,i,o,l),s=c[e+68>>2],H=c[e+28>>2],Y=c[e+128>>2],!((0|(r=c[e+48>>2]))<=(0|Y)||(0|r)<=c[e+132>>2])){n=0,r&&(c[5498]=c[5498]+1,(t=M(19+(r<<2)|0))&&(c[(n=t+19&-16)-4>>2]=t)),i=c[e+136>>2];e:{if(1<=(0|Y))for(_=n,t=i;c[_>>2]=c[t>>2],_=_+4|0,t=t+4|0,Y=Y-1|0;);else if(!i)break e;p[e+140|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2]))}c[e+136>>2]=n,c[e+132>>2]=r,a[e+140|0]=1}if(c[e+128>>2]=r,16&p[l+72|0]){if(!((0|(o=H<<1))<=(0|(Y=c[e+108>>2]))||(0|o)<=c[e+112>>2])){n=0,H&&(c[5498]=c[5498]+1,(t=M(19+(H<<3)|0))&&(c[(n=t+19&-16)-4>>2]=t)),i=c[e+116>>2];e:{if(1<=(0|Y))for(_=n,t=i;c[_>>2]=c[t>>2],_=_+4|0,t=t+4|0,Y=Y-1|0;);else if(!i)break e;p[e+120|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2]))}c[e+116>>2]=n,c[e+112>>2]=o,a[e+120|0]=1}c[e+108>>2]=o}else{if(!((0|H)<=(0|(Y=c[e+108>>2]))||(0|H)<=c[e+112>>2])){n=0,H&&(c[5498]=c[5498]+1,(t=M(19+(H<<2)|0))&&(c[(n=t+19&-16)-4>>2]=t)),i=c[e+116>>2];e:{if(1<=(0|Y))for(_=n,t=i;c[_>>2]=c[t>>2],_=_+4|0,t=t+4|0,Y=Y-1|0;);else if(!i)break e;p[e+120|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2]))}c[e+116>>2]=n,c[e+112>>2]=H,a[e+120|0]=1}c[e+108>>2]=H}if(!((0|s)<=(0|(Y=c[e+148>>2]))||(0|s)<=c[e+152>>2])){n=0,s&&(c[5498]=c[5498]+1,(t=M(19+(s<<2)|0))&&(c[(n=t+19&-16)-4>>2]=t)),i=c[e+156>>2];e:{if(1<=(0|Y))for(_=n,t=i;c[_>>2]=c[t>>2],_=_+4|0,t=t+4|0,Y=Y-1|0;);else if(!i)break e;p[e+160|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2]))}c[e+156>>2]=n,c[e+152>>2]=s,a[e+160|0]=1}if(c[e+148>>2]=s,1<=(0|r))for(_=c[e+136>>2],t=0;c[_>>2]=t,_=_+4|0,(0|r)!=(0|(t=t+1|0)););if(1<=(0|H))for(_=c[e+116>>2],t=0;c[_>>2]=t,_=_+4|0,(0|H)!=(0|(t=t+1|0)););if(1<=(0|s))for(_=c[e+156>>2],t=0;c[_>>2]=t,_=_+4|0,(0|s)!=(0|(t=t+1|0)););return N=256+G|0,x(x(0))},function(e,t,n,i,o,a,r,s,l){t|=0,n|=0,i|=0,o|=0,a|=0,r|=0,s|=0,l|=0;var _,u,h,f=0,p=0;pi[c[c[(e|=0)>>2]+32>>2]](e,t,n,i,o,a,r,s,l),f=c[e+184>>2];e:if(!((0|(p=(0|(p=c[s+20>>2]))<(0|f)?f:p))<1))for(h=p-1|0,f=1;;){if(u=x(pi[c[c[e>>2]+40>>2]](e,_=f-1|0,t,n,i,o,a,r,s,l)),A[e+228>>2]=u,(0|h)<=(0|_))break e;if(A[s+92>>2]>=u)break e;if(_=(0|f)<(0|p),f=f+1|0,!_)break}return x(x(0))},ve,Un,Ae,function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,r,s,l,_,u;c[(l=604+(N=u=N-688|0)|0)>>2]=1065353216,c[4+l>>2]=0,s=c[t+20>>2],c[(l=656+u|0)>>2]=c[t+16>>2],c[4+l>>2]=s,s=c[t+36>>2],c[(l=672+u|0)>>2]=c[t+32>>2],c[4+l>>2]=s,o=c[4+(s=t+8|0)>>2],c[(l=648+u|0)>>2]=c[s>>2],c[4+l>>2]=o,o=c[4+(s=t+24|0)>>2],c[(l=664+u|0)>>2]=c[s>>2],c[4+l>>2]=o,o=c[4+(s=t+40|0)>>2],c[(l=680+u|0)>>2]=c[s>>2],c[4+l>>2]=o,c[636+u>>2]=0,c[596+u>>2]=1065353216,c[600+u>>2]=1065353216,c[588+u>>2]=0,c[592+u>>2]=0,c[580+u>>2]=1,c[584+u>>2]=0,c[576+u>>2]=13376,l=c[t+4>>2],c[640+u>>2]=c[t>>2],c[644+u>>2]=l,A[628+u>>2]=A[e+204>>2],a[548+u|0]=0,c[524+u>>2]=953267991,c[208+u>>2]=14688,c[204+u>>2]=0,c[184+u>>2]=17352,c[196+u>>2]=c[e+4>>2],c[200+u>>2]=576+u,c[192+u>>2]=208+u,c[188+u>>2]=216+u,c[8+u>>2]=12640,c[172+u>>2]=1065353216,c[176+u>>2]=0,A[180+u>>2]=A[e+208>>2],Un(184+u|0,e+8|0,e+72|0,t=e+136|0,t,8+u|0)&&(r=A[140+u>>2],s=A[144+u>>2],o=A[148+u>>2],(l=x(x(x(r*r)+x(s*s))+x(o*o)))>x(9999999747378752e-20)&&(_=A[172+u>>2])<A[e+200>>2]&&(t=o,o=x(x(1)/x(T(l))),A[148+u>>2]=t*o,A[144+u>>2]=s*o,A[140+u>>2]=r*o,x(pi[c[c[e>>2]+12>>2]](e,140+u|0,156+u|0,_,n,i)))),c[576+u>>2]=7916,(e=c[636+u>>2])&&(pi[c[c[e>>2]>>2]](e),(e=c[636+u>>2])&&(c[5499]=c[5499]+1,z(c[e-4>>2]))),N=688+u|0},jn,function(e){var t,n,i=0,o=0,a=0;if(c[(e|=0)>>2]=17524,1<=(0|(i=c[e+8>>2])))for(;n=c[c[e+16>>2]+o>>2],(t=c[n+188>>2])&&(i=c[e+68>>2],i=0|pi[c[c[i>>2]+36>>2]](i),pi[c[c[i>>2]+40>>2]](i,t,c[e+24>>2]),i=c[e+68>>2],pi[c[c[i>>2]+12>>2]](i,t,c[e+24>>2]),c[n+188>>2]=0,i=c[e+8>>2]),o=o+4|0,(0|(a=a+1|0))<(0|i););(i=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),V(e)},function(e){e|=0;var t,n=0,i=x(0),o=x(0),r=0,s=x(0),l=x(0),_=x(0),u=x(0),h=x(0),f=0,d=0;if(N=t=N+-64|0,1<=(0|(r=c[e+8>>2])))for(;;){n=c[c[e+16>>2]+f>>2];e:{t:if(!p[e+76|0])switch(c[n+220>>2]-2|0){case 0:case 3:break e;default:break t}r=c[n+192>>2],pi[c[c[r>>2]+8>>2]](r,n+4|0,48+t|0,32+t|0),o=x(A[48+t>>2]+x(-.019999999552965164)),A[48+t>>2]=o,s=x(A[52+t>>2]+x(-.019999999552965164)),A[52+t>>2]=s,l=x(A[56+t>>2]+x(-.019999999552965164)),A[56+t>>2]=l,i=x(A[32+t>>2]+x(.019999999552965164)),A[32+t>>2]=i,_=x(A[36+t>>2]+x(.019999999552965164)),A[36+t>>2]=_,u=x(A[40+t>>2]+x(.019999999552965164)),A[40+t>>2]=u,p[e+44|0]&&2==c[n+252>>2]&&(3&p[n+204|0]||(r=c[n+192>>2],pi[c[c[r>>2]+8>>2]](r,n+68|0,16+t|0,t),s=x(A[16+t>>2]+x(-.019999999552965164)),A[16+t>>2]=s,l=x(A[20+t>>2]+x(-.019999999552965164)),A[20+t>>2]=l,i=x(A[24+t>>2]+x(-.019999999552965164)),A[24+t>>2]=i,_=x(A[t>>2]+x(.019999999552965164)),A[t>>2]=_,u=x(A[4+t>>2]+x(.019999999552965164)),A[4+t>>2]=u,h=x(A[8+t>>2]+x(.019999999552965164)),A[8+t>>2]=h,s<(o=A[48+t>>2])&&(o=A[48+t>>2]=s),l<(s=A[52+t>>2])&&(s=A[52+t>>2]=l),i<(l=A[56+t>>2])&&(l=A[56+t>>2]=i),(i=A[28+t>>2])<A[60+t>>2]&&(A[60+t>>2]=i),(i=A[32+t>>2])<_&&(i=A[32+t>>2]=_),(_=A[36+t>>2])<u&&(_=A[36+t>>2]=u),(u=A[40+t>>2])<h&&(u=A[40+t>>2]=h),(h=A[12+t>>2])>A[44+t>>2]&&(A[44+t>>2]=h))),r=c[e+68>>2],1&a[n+204|0]||(o=x(i-o),i=x(o*o),o=x(_-s),i=x(i+x(o*o)),o=x(u-l),x(i+x(o*o))<x(999999995904))?pi[c[c[r>>2]+16>>2]](r,c[n+188>>2],48+t|0,32+t|0,c[e+24>>2]):(4!=(-2&c[n+220>>2])&&(c[n+220>>2]=5),p[23476]||(n=c[e+72>>2])&&(a[23476]=1,pi[c[c[n>>2]+44>>2]](n,18344),n=c[e+72>>2],pi[c[c[n>>2]+44>>2]](n,18393),n=c[e+72>>2],pi[c[c[n>>2]+44>>2]](n,18461),n=c[e+72>>2],pi[c[c[n>>2]+44>>2]](n,18526))),r=c[e+8>>2]}if(f=f+4|0,!((0|(d=d+1|0))<(0|r)))break}N=t+64|0},function(e){var t=c[68+(e|=0)>>2];pi[c[c[t>>2]+32>>2]](t,c[e+24>>2])},function(e,t){c[72+(e|=0)>>2]=t|=0},vn,Vn,function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,a,r,s,l,_=0,u=0,h=0,f=x(0),p=x(0),d=x(0),m=x(0),v=0,y=x(0),b=x(0),S=x(0),C=x(0),E=x(0),T=x(0),P=x(0),w=x(0),I=x(0),R=x(0),D=x(0),O=x(0),M=x(0),z=x(0),L=0,F=x(0),B=x(0),k=x(0),U=0,G=0,j=0,V=0;N=l=N-144|0,0|pi[c[c[e>>2]+20>>2]](e)&&(_=0|pi[c[c[e>>2]+20>>2]](e),32768&pi[c[c[_>>2]+56>>2]](_)&&(_=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[_>>2]+64>>2]](_,t,x(.10000000149011612))));e:{t:{n:{i:{o:{a:{r:{s:{c:{l:switch(0|(_=c[n+4>>2])){case 0:break c;case 31:break l;case 28:break n;case 13:break i;case 11:break o;case 10:break a;case 9:break r;case 8:break s;default:break t}if((0|(_=c[n+24>>2]))<1)break e;for(u=_+1|0,h=g(_,80)-80|0;_=c[n+32>>2]+h|0,v=c[_- -64>>2],f=A[_+56>>2],p=A[_+48>>2],d=A[_+52>>2],y=A[_+32>>2],C=A[_>>2],E=A[_+16>>2],T=A[_+36>>2],w=A[_+4>>2],R=A[_+20>>2],m=A[_+40>>2],b=A[_+8>>2],S=A[_+24>>2],c[60+l>>2]=0,c[44+l>>2]=0,c[28+l>>2]=0,c[12+l>>2]=0,D=A[t+32>>2],P=A[t+36>>2],I=A[t+40>>2],A[40+l>>2]=x(x(b*D)+x(S*P))+x(m*I),A[36+l>>2]=x(x(w*D)+x(R*P))+x(T*I),A[32+l>>2]=x(x(C*D)+x(E*P))+x(y*I),O=A[t+16>>2],M=A[t+20>>2],z=A[t+24>>2],A[24+l>>2]=x(x(b*O)+x(S*M))+x(m*z),A[20+l>>2]=x(x(w*O)+x(R*M))+x(T*z),A[16+l>>2]=x(x(C*O)+x(E*M))+x(y*z),F=b,b=A[t>>2],B=S,S=A[t+4>>2],k=m,m=A[t+8>>2],A[8+l>>2]=x(x(F*b)+x(B*S))+x(k*m),A[4+l>>2]=x(x(w*b)+x(R*S))+x(T*m),A[l>>2]=x(x(C*b)+x(E*S))+x(y*m),A[56+l>>2]=x(x(x(p*D)+x(d*P))+x(f*I))+A[t+56>>2],A[52+l>>2]=x(x(x(p*O)+x(d*M))+x(f*z))+A[t+52>>2],A[48+l>>2]=x(x(x(p*b)+x(d*S))+x(f*m))+A[t+48>>2],pi[c[c[e>>2]+28>>2]](e,l,v,i),h=h-80|0,1<(0|(u=u-1|0)););break e}v=c[4+(h=n+44|0)>>2],c[(_=u=8+l|0)>>2]=c[h>>2],c[_+4>>2]=v,h=c[4+(_=n+36|0)>>2],c[l>>2]=c[_>>2],c[4+l>>2]=h,f=x(pi[c[c[n>>2]+48>>2]](n)),p=x(pi[c[c[n>>2]+48>>2]](n)),d=x(x(pi[c[c[n>>2]+48>>2]](n))+A[u>>2]),A[u>>2]=d,f=x(f+A[l>>2]),A[l>>2]=f,p=x(p+A[4+l>>2]),A[4+l>>2]=p,e=0|pi[c[c[e>>2]+20>>2]](e),c[140+l>>2]=0,A[136+l>>2]=-d,A[132+l>>2]=-p,A[128+l>>2]=-f,pi[c[c[e>>2]+80>>2]](e,128+l|0,l,t,i);break e}f=x(pi[c[c[n>>2]+48>>2]](n)),e=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[e>>2]+24>>2]](e,f,t,i);break e}if((0|(_=c[n+100>>2]))<1)break e;for(L=_+1|0,u=(_<<4)-8|0,h=(_<<2)-4|0;_=c[n+108>>2]+u|0,f=A[_>>2],p=A[_-8>>2],d=A[_-4>>2],_=0|pi[c[c[e>>2]+20>>2]](e),D=A[c[n+128>>2]+h>>2],c[60+l>>2]=0,c[44+l>>2]=0,c[28+l>>2]=0,c[12+l>>2]=0,y=A[t+40>>2],C=A[t+32>>2],T=x(C*x(0)),E=A[t+36>>2],w=x(E*x(0)),A[40+l>>2]=y+x(T+w),m=x(T+E),T=x(y*x(0)),A[36+l>>2]=m+T,A[32+l>>2]=x(C+w)+T,T=A[t+24>>2],w=A[t+16>>2],m=x(w*x(0)),R=A[t+20>>2],b=x(R*x(0)),A[24+l>>2]=T+x(m+b),S=x(m+R),m=x(T*x(0)),A[20+l>>2]=S+m,A[16+l>>2]=x(w+b)+m,m=A[t+8>>2],b=A[t>>2],P=x(b*x(0)),S=A[t+4>>2],I=x(S*x(0)),A[8+l>>2]=m+x(P+I),F=x(P+S),P=x(m*x(0)),A[4+l>>2]=F+P,A[l>>2]=x(b+I)+P,A[56+l>>2]=x(x(x(p*C)+x(d*E))+x(f*y))+A[t+56>>2],A[52+l>>2]=x(x(x(p*w)+x(d*R))+x(f*T))+A[t+52>>2],A[48+l>>2]=x(x(x(p*b)+x(d*S))+x(f*m))+A[t+48>>2],pi[c[c[_>>2]+24>>2]](_,D,l,i),u=u-16|0,h=h-4|0,1<(0|(L=L-1|0)););break e}u=c[n+60>>2],f=A[(u<<2)+(n=n+36|0)>>2],p=A[n+((u+2|0)%3<<2)>>2],e=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[e>>2]+84>>2]](e,p,f,u,t,i);break e}u=c[n+76>>2],f=A[n+68>>2],p=A[n- -64>>2],e=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[e>>2]+92>>2]](e,p,f,u,t,i);break e}u=c[n+60>>2],f=x(pi[c[c[n>>2]+92>>2]](n)),L=c[4+(v=n+44|0)>>2],c[(_=8+l|0)>>2]=c[v>>2],c[_+4>>2]=L,v=c[4+(h=n+36|0)>>2],c[l>>2]=c[h>>2],c[4+l>>2]=v,p=x(pi[c[c[n>>2]+48>>2]](n)),d=x(pi[c[c[n>>2]+48>>2]](n)),r=_,s=x(x(pi[c[c[n>>2]+48>>2]](n))+A[_>>2]),A[r>>2]=s,A[l>>2]=p+A[l>>2],A[4+l>>2]=d+A[4+l>>2],p=A[(u<<2)+l>>2],e=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[e>>2]+88>>2]](e,f,p,u,t,i);break e}f=A[n+72>>2],e=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[e>>2]+96>>2]](e,n+56|0,f,t,i);break e}if(!(6<(0|_)))if(v=c[n+60>>2]){if(!(c[v+28>>2]<1))for(;;){d=x(0);t:if(u=(j=g(G,36))+c[v+36>>2]|0,U=c[u+4>>2]){if(f=x(0),p=x(0),!((0|U)<1))for(h=c[u+12>>2],u=c[(h+(U<<2)|0)-4>>2],L=1,V=0;;){if(h=(o=(_=c[h+V>>2])<<4)+c[v+16>>2]|0,T=A[h>>2],w=A[h+4>>2],R=A[h+8>>2],h=0|pi[c[c[e>>2]+20>>2]](e),c[12+l>>2]=0,a=c[v+16>>2],y=A[(u=a+(u<<4)|0)>>2],m=A[t+32>>2],C=A[u+4>>2],b=A[t+36>>2],E=A[u+8>>2],S=A[t+40>>2],D=A[t+56>>2],A[8+l>>2]=x(x(x(y*m)+x(C*b))+x(E*S))+D,P=A[t+16>>2],I=A[t+20>>2],O=A[t+24>>2],M=A[t+52>>2],A[4+l>>2]=x(x(x(y*P)+x(C*I))+x(E*O))+M,z=A[t>>2],F=A[t+4>>2],B=A[t+8>>2],k=A[t+48>>2],A[l>>2]=x(x(x(y*z)+x(C*F))+x(E*B))+k,c[140+l>>2]=0,y=A[(u=o+a|0)>>2],C=A[u+4>>2],E=A[u+8>>2],A[136+l>>2]=D+x(x(x(m*y)+x(b*C))+x(S*E)),A[132+l>>2]=M+x(x(x(P*y)+x(I*C))+x(O*E)),A[128+l>>2]=k+x(x(x(z*y)+x(F*C))+x(B*E)),pi[c[c[h>>2]+16>>2]](h,l,128+l|0,i),p=x(p+R),f=x(f+w),d=x(d+T),u=c[v+36>>2]+j|0,c[u+4>>2]<=(0|L))break t;V=V+4|0,L=L+1|0,h=c[u+12>>2],u=_}}else f=x(0),p=x(0);if(u=0|pi[c[c[e>>2]+20>>2]](e),16384&pi[c[c[u>>2]+56>>2]](u)&&(c[8+l>>2]=0,c[12+l>>2]=0,c[l>>2]=1065353216,c[4+l>>2]=1065353216,u=c[v+36>>2]+j|0,C=A[u+28>>2],E=A[u+20>>2],T=A[u+24>>2],u=0|pi[c[c[e>>2]+20>>2]](e),c[140+l>>2]=0,y=x(x(1)/x(0|U)),d=x(y*d),w=A[t+32>>2],f=x(y*f),R=A[t+36>>2],p=x(y*p),y=A[t+40>>2],m=A[t+56>>2],A[136+l>>2]=x(x(x(d*w)+x(f*R))+x(p*y))+m,b=A[t+16>>2],S=A[t+20>>2],D=A[t+24>>2],P=A[t+52>>2],A[132+l>>2]=x(x(x(d*b)+x(f*S))+x(p*D))+P,I=A[t>>2],O=A[t+4>>2],M=A[t+8>>2],z=A[t+48>>2],A[128+l>>2]=x(x(x(d*I)+x(f*O))+x(p*M))+z,c[124+l>>2]=0,d=x(d+E),f=x(f+T),p=x(p+C),A[120+l>>2]=m+x(x(x(w*d)+x(R*f))+x(y*p)),A[116+l>>2]=P+x(x(x(d*b)+x(f*S))+x(p*D)),A[112+l>>2]=z+x(x(x(d*I)+x(f*O))+x(p*M)),pi[c[c[u>>2]+16>>2]](u,128+l|0,112+l|0,l)),!((0|(G=G+1|0))<c[v+28>>2]))break}}else if(!((0|pi[c[c[n>>2]+100>>2]](n))<1))for(;pi[c[c[n>>2]+104>>2]](n,u,l,128+l|0),c[124+l>>2]=0,f=A[l>>2],y=A[t+32>>2],p=A[4+l>>2],C=A[t+36>>2],d=A[8+l>>2],E=A[t+40>>2],T=A[t+56>>2],A[120+l>>2]=x(x(x(f*y)+x(p*C))+x(d*E))+T,w=A[t+16>>2],R=A[t+20>>2],m=A[t+24>>2],b=A[t+52>>2],A[116+l>>2]=x(x(x(f*w)+x(p*R))+x(d*m))+b,S=A[t>>2],D=A[t+4>>2],P=A[t+8>>2],I=A[t+48>>2],A[112+l>>2]=x(x(x(f*S)+x(p*D))+x(d*P))+I,c[108+l>>2]=0,f=A[128+l>>2],p=A[132+l>>2],d=A[136+l>>2],A[104+l>>2]=T+x(x(x(y*f)+x(C*p))+x(E*d)),A[100+l>>2]=b+x(x(x(w*f)+x(R*p))+x(m*d)),A[96+l>>2]=I+x(x(x(S*f)+x(D*p))+x(P*d)),_=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[_>>2]+16>>2]](_,112+l|0,96+l|0,i),u=u+1|0,(0|pi[c[c[n>>2]+100>>2]](n))>(0|u););(u=c[n+4>>2])-21>>>0<=8&&(c[136+l>>2]=1566444395,c[140+l>>2]=0,c[128+l>>2]=1566444395,c[132+l>>2]=1566444395,c[120+l>>2]=-581039253,c[124+l>>2]=0,c[112+l>>2]=-581039253,c[116+l>>2]=-581039253,u=0|pi[c[c[e>>2]+20>>2]](e),v=c[4+(h=i+8|0)>>2],c[(_=20+l|0)>>2]=c[h>>2],c[_+4>>2]=v,v=c[4+(h=t+8|0)>>2],c[(_=36+l|0)>>2]=c[h>>2],c[_+4>>2]=v,h=c[t+20>>2],c[(_=44+l|0)>>2]=c[t+16>>2],c[_+4>>2]=h,v=c[4+(h=t+24|0)>>2],c[(_=52+l|0)>>2]=c[h>>2],c[_+4>>2]=v,h=c[t+36>>2],c[(_=60+l|0)>>2]=c[t+32>>2],c[_+4>>2]=h,v=c[4+(h=t+40|0)>>2],c[(_=68+l|0)>>2]=c[h>>2],c[_+4>>2]=v,c[8+l>>2]=u,c[4+l>>2]=18280,c[l>>2]=18256,u=c[i+4>>2],c[12+l>>2]=c[i>>2],c[16+l>>2]=u,u=c[t+4>>2],c[28+l>>2]=c[t>>2],c[32+l>>2]=u,h=c[4+(_=t+56|0)>>2],c[(u=84+l|0)>>2]=c[_>>2],c[u+4>>2]=h,_=c[t+52>>2],c[(u=76+l|0)>>2]=c[t+48>>2],c[u+4>>2]=_,pi[c[c[n>>2]+64>>2]](n,l,112+l|0,128+l|0),u=c[n+4>>2]),3==(0|u)&&(c[136+l>>2]=1566444395,c[140+l>>2]=0,c[128+l>>2]=1566444395,c[132+l>>2]=1566444395,c[120+l>>2]=-581039253,c[124+l>>2]=0,c[112+l>>2]=-581039253,c[116+l>>2]=-581039253,e=0|pi[c[c[e>>2]+20>>2]](e),h=c[4+(_=i+8|0)>>2],c[(u=20+l|0)>>2]=c[_>>2],c[u+4>>2]=h,h=c[4+(_=t+8|0)>>2],c[(u=36+l|0)>>2]=c[_>>2],c[u+4>>2]=h,_=c[t+20>>2],c[(u=44+l|0)>>2]=c[t+16>>2],c[u+4>>2]=_,h=c[4+(_=t+24|0)>>2],c[(u=52+l|0)>>2]=c[_>>2],c[u+4>>2]=h,_=c[t+36>>2],c[(u=60+l|0)>>2]=c[t+32>>2],c[u+4>>2]=_,h=c[4+(_=t+40|0)>>2],c[(u=68+l|0)>>2]=c[_>>2],c[u+4>>2]=h,c[8+l>>2]=e,c[4+l>>2]=18280,c[l>>2]=18256,e=c[i+4>>2],c[12+l>>2]=c[i>>2],c[16+l>>2]=e,e=c[t+4>>2],c[28+l>>2]=c[t>>2],c[32+l>>2]=e,u=c[4+(i=t+56|0)>>2],c[(e=84+l|0)>>2]=c[i>>2],c[e+4>>2]=u,i=c[t+52>>2],c[(e=76+l|0)>>2]=c[t+48>>2],c[e+4>>2]=i,e=c[n+100>>2],pi[c[c[e>>2]+8>>2]](e,4|l,112+l|0,128+l|0))}N=144+l|0},function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,a,r,s,l,_,u,h,f,p=x(0);c[(r=104+(N=f=N-256|0)|0)>>2]=0,c[4+r>>2]=0,c[(r=112+f|0)>>2]=0,c[4+r>>2]=0,c[(r=124+f|0)>>2]=0,c[4+r>>2]=0,c[120+f>>2]=1065353216,c[(r=132+f|0)>>2]=0,c[4+r>>2]=0,c[(r=140+f|0)>>2]=1065353216,c[4+r>>2]=0,s=c[4+(h=t+8|0)>>2],_=c[h>>2],c[(a=l=76+f|0)>>2]=_,c[4+a>>2]=s,a=c[4+(r=n+8|0)>>2],c[(o=92+f|0)>>2]=c[r>>2],c[4+o>>2]=a,c[32+f>>2]=17592,c[248+f>>2]=i,c[100+f>>2]=1065353216,u=c[t+4>>2],a=c[t>>2],c[68+f>>2]=a,c[72+f>>2]=u,i=c[n+4>>2],c[84+f>>2]=c[n>>2],c[88+f>>2]=i,c[244+f>>2]=e,c[(i=156+f|0)>>2]=_,c[i+4>>2]=s,c[(i=148+f|0)>>2]=a,c[i+4>>2]=u,c[(i=168+f|0)>>2]=0,c[i+4>>2]=0,c[(i=176+f|0)>>2]=0,c[i+4>>2]=0,c[184+f>>2]=1065353216,c[(i=188+f|0)>>2]=0,c[i+4>>2]=0,c[(i=196+f|0)>>2]=0,c[i+4>>2]=0,c[(i=204+f|0)>>2]=1065353216,c[i+4>>2]=0,i=c[n+4>>2],c[(a=212+f|0)>>2]=c[n>>2],c[4+a>>2]=i,i=c[4+r>>2],c[(a=220+f|0)>>2]=c[r>>2],c[4+a>>2]=i,c[164+f>>2]=1065353216,s=x(A[n>>2]-A[t>>2]),u=x(A[n+4>>2]-A[t+4>>2]),p=x(A[r>>2]-A[h>>2]),a=x(x(1)/x(T(x(x(x(s*s)+x(u*u))+x(p*p))))),h=(r=x(p*a))==x(0)?x(0xde0b6b000000000):x(x(1)/r),A[44+f>>2]=h,p=(u=x(u*a))==x(0)?x(0xde0b6b000000000):x(x(1)/u),A[40+f>>2]=p,c[60+f>>2]=h<x(0),c[56+f>>2]=p<x(0),p=x(s*a),A[64+f>>2]=x(x(p*x(A[84+f>>2]-A[68+f>>2]))+x(u*x(A[88+f>>2]-A[72+f>>2])))+x(r*x(A[o>>2]-A[l>>2])),p=p==x(0)?x(0xde0b6b000000000):x(x(1)/p),A[36+f>>2]=p,c[52+f>>2]=p<x(0),i=c[e+68>>2],c[(e=24+f|0)>>2]=0,c[e+4>>2]=0,c[16+f>>2]=0,c[20+f>>2]=0,c[(e=8+f|0)>>2]=0,c[e+4>>2]=0,c[f>>2]=0,c[4+f>>2]=0,pi[c[c[i>>2]+24>>2]](i,t,n,32+f|0,16+f|0,f),N=256+f|0},Hn,Wn,function(e){var t,n,i,o;pi[c[c[(e|=0)>>2]+8>>2]](e),pi[c[c[e>>2]+12>>2]](e),(t=c[e+24>>2])&&(o=c[e+68>>2],n=t,i=0|pi[c[c[o>>2]+36>>2]](o),o=c[e+24>>2],t=c[c[t>>2]+32>>2],pi[t](0|n,0|i,0|e+28,0|o))},function(e,t){e|=0,pi[c[c[(t|=0)>>2]+32>>2]](t),qn(e,t),pi[c[c[t>>2]+36>>2]](t)},Se,ve,function(e,t){t|=0;var n,i,o,a;return N=a=N-32|0,n=c[216+(e|=0)>>2],(i=A[n+4>>2])!=x(0)&&(t=c[t>>2],0|pi[c[c[n>>2]+8>>2]](n,c[t+188>>2])&&(n=c[e+216>>2],o=c[t+192>>2],c[24+a>>2]=-1,c[28+a>>2]=-1,c[20+a>>2]=t+4,c[16+a>>2]=t,c[12+a>>2]=o,Yn(e+68|(c[8+a>>2]=0),e+132|0,8+a|0,n))),N=32+a|0,i!=x(0)|0},ve,function(e,t,n,i){e|=0,t|=0,n|=0,i|=0,x(0);var o,a,r,s,l,_,u,h,f,p,d,m,v,g,y,b,S,C,E,P,w,I,R=0,D=x(0);N=I=N-32|0,l=A[t+20>>2],m=A[t+36>>2],v=A[t+24>>2],P=A[t+40>>2],_=A[t+4>>2],g=A[t+32>>2],h=A[t+8>>2],f=A[t>>2],y=A[t+16>>2],c[28+I>>2]=0,a=x(l-_),r=x(P-h),o=x(v-h),p=x(m-_),u=x(x(a*r)-x(o*p)),C=o,o=x(g-f),s=x(y-f),r=x(x(C*o)-x(s*r)),a=x(x(s*p)-x(a*o)),o=x(x(h*a)+x(x(f*u)+x(_*r))),d=A[e+4>>2],s=A[e+8>>2],b=A[e+12>>2],p=x(x(x(x(u*d)+x(r*s))+x(a*b))-o),E=A[e+20>>2],S=A[e+24>>2],w=A[e+28>>2],o=x(x(x(x(u*E)+x(r*S))+x(a*w))-o),x(p*o)>=x(0)||1&(t=c[e+36>>2])&&p<=x(0)||(o=x(p/x(p-o)))<A[e+40>>2]&&(C=s,s=x(x(1)-o),S=x(x(S*o)+x(C*s)),l=x(l-S),d=x(x(E*o)+x(d*s)),f=x(f-d),_=x(_-S),y=x(y-d),s=x(x(w*o)+x(b*s)),v=x(v-s),h=x(h-s),E=x(x(a*a)+x(x(u*u)+x(r*r))),b=x(E*x(-9999999747378752e-20)),x(x(a*x(x(l*f)-x(_*y)))+x(x(u*x(x(_*v)-x(h*l)))+x(r*x(x(h*y)-x(v*f)))))>=b&&(m=x(m-S),g=x(g-d),d=x(a*x(x(m*y)-x(l*g))),C=l,l=x(P-s),b<=x(d+x(x(u*x(x(C*l)-x(v*m)))+x(r*x(x(v*g)-x(l*y)))))&&b<=x(x(a*x(x(_*g)-x(m*f)))+x(x(u*x(x(m*h)-x(l*_)))+x(r*x(x(l*f)-x(h*g)))))&&(s=a,a=x(x(1)/x(T(E))),_=x(s*a),A[24+I>>2]=_,r=x(r*a),A[20+I>>2]=r,u=x(u*a),A[16+I>>2]=u,D=!(p<=x(0))||2&t?x(pi[c[c[(R=e)>>2]+12>>2]](e,16+I|0,o,n,i)):(c[12+I>>2]=0,A[8+I>>2]=-_,A[4+I>>2]=-r,A[I>>2]=-u,x(pi[c[c[(R=e)>>2]+12>>2]](e,I,o,n,i))),A[R+40>>2]=D))),N=32+I|0},function(e,t,n,i,o){e|=0,t|=0,n=x(n),i|=0,o|=0;var a,r,s,l,_,u,h,f,p,d;return c[36+(N=d=N-48|0)>>2]=o,c[32+d>>2]=i,c[40+d>>2]=c[e+52>>2],a=A[e- -64>>2],r=A[e+60>>2],s=A[e+80>>2],l=A[e+72>>2],_=A[e+76>>2],u=A[e+96>>2],h=A[e+88>>2],f=A[e+92>>2],p=A[e+56>>2],o=A[t+8>>2],i=A[t>>2],t=A[t+4>>2],c[20+d>>2]=0,A[16+d>>2]=x(x(i*h)+x(t*f))+x(o*u),A[12+d>>2]=x(x(i*l)+x(t*_))+x(o*s),A[8+d>>2]=x(x(p*i)+x(r*t))+x(a*o),A[24+d>>2]=n,c[d>>2]=c[e+48>>2],c[4+d>>2]=32+d,e=c[e+44>>2],n=x(pi[c[c[e>>2]+12>>2]](e,d,1)),N=48+d|0,x(n)},ve,function(e,t){e|=0;var n,i,o,a,r,s,l,_,u,h,f,p,d,m,v,y,b,S,C,E,T,P,w,I,R,D,O;N=O=N-128|0,h=c[36+(t|=0)>>2],t=c[c[e+8>>2]+32>>2]+g(h,80)|0,w=c[t+64>>2],f=A[t+32>>2],p=A[t>>2],d=A[t+16>>2],m=A[t+56>>2],v=A[t+52>>2],y=A[t+48>>2],b=A[t+36>>2],S=A[t+20>>2],C=A[t+4>>2],E=A[t+40>>2],T=A[t+24>>2],P=A[t+8>>2],t=c[e+12>>2],I=A[t+52>>2],R=A[t+56>>2],n=A[t+24>>2],i=A[t+20>>2],o=A[t+40>>2],a=A[t+36>>2],D=A[t+48>>2],r=A[t+8>>2],s=A[t>>2],l=A[t+4>>2],_=A[t+16>>2],u=A[t+32>>2],c[124+O>>2]=0,c[108+O>>2]=0,c[92+O>>2]=0,A[104+O>>2]=x(x(P*u)+x(T*a))+x(E*o),A[100+O>>2]=x(x(C*u)+x(S*a))+x(b*o),A[88+O>>2]=x(x(P*_)+x(T*i))+x(E*n),A[84+O>>2]=x(x(C*_)+x(S*i))+x(b*n),A[120+O>>2]=R+x(x(x(u*y)+x(a*v))+x(o*m)),A[116+O>>2]=I+x(x(x(_*y)+x(i*v))+x(n*m)),c[76+O>>2]=0,A[72+O>>2]=x(x(s*P)+x(l*T))+x(r*E),A[68+O>>2]=x(x(s*C)+x(l*S))+x(r*b),A[64+O>>2]=x(x(p*s)+x(d*l))+x(f*r),A[112+O>>2]=D+x(x(x(s*y)+x(l*v))+x(r*m)),A[96+O>>2]=x(x(p*u)+x(d*a))+x(f*o),A[80+O>>2]=x(x(p*_)+x(d*i))+x(f*n),c[60+O>>2]=h,c[56+O>>2]=-1,c[44+O>>2]=w,c[40+O>>2]=0,c[48+O>>2]=c[e+4>>2],c[52+O>>2]=O+64,c[12+O>>2]=1065353216,c[16+O>>2]=0,c[24+O>>2]=0,c[36+O>>2]=h,c[28+O>>2]=w,c[8+O>>2]=17684,t=c[e+24>>2],c[32+O>>2]=t,A[12+O>>2]=A[t+4>>2],c[24+O>>2]=c[t+16>>2],Yn(c[e+16>>2],c[e+20>>2],40+O|0,8+O|0),N=128+O|0},ve,function(e,t){return e=c[24+(e|=0)>>2],0|pi[c[c[e>>2]+8>>2]](e,t|=0)},function(e,t,n){t|=0,n|=0;var i,o,a=0;return N=o=N-16|0,a=c[28+(e|=0)>>2],c[4+o>>2]=a,c[o>>2]=a,(i=c[t+4>>2])?(c[i+4>>2]=a,c[i>>2]=a):c[t+4>>2]=o,a=c[e+24>>2],n=x(pi[c[c[a>>2]+12>>2]](a,t,n)),A[e+4>>2]=A[c[e+24>>2]+4>>2],N=16+o|0,x(n)},Se,ve,function(e,t,n,i){var o,a,r,s,l,_,u,h,f,p,d,m,v,g,y,b,S,C,E,P,w;e|=0,t|=0,n|=0,i|=0,c[92+(N=n=N-96|0)>>2]=0,o=A[t>>2],_=A[e+60>>2],r=A[t+4>>2],m=A[e- -64>>2],s=A[t+8>>2],v=A[e+68>>2],g=A[e+84>>2],f=x(x(x(x(o*_)+x(r*m))+x(s*v))+g),A[n+88>>2]=f,l=A[e+44>>2],y=A[e+48>>2],b=A[e+52>>2],S=A[e+80>>2],a=x(x(x(x(o*l)+x(r*y))+x(s*b))+S),A[n+84>>2]=a,u=o,o=A[e+28>>2],h=r,r=A[e+32>>2],C=s,s=A[e+36>>2],p=A[e+76>>2],w=x(x(x(x(u*o)+x(h*r))+x(C*s))+p),A[n+80>>2]=w,c[n+76>>2]=0,c[n+60>>2]=0,d=A[t+16>>2],u=A[t+20>>2],h=A[t+24>>2],E=x(p+x(x(x(o*d)+x(r*u))+x(s*h))),A[n+64>>2]=E,P=x(S+x(x(x(l*d)+x(y*u))+x(b*h))),A[n+68>>2]=P,d=x(g+x(x(x(_*d)+x(m*u))+x(v*h))),A[n+72>>2]=d,u=o,o=A[t+32>>2],h=r,r=A[t+36>>2],C=s,s=A[t+40>>2],p=x(p+x(x(x(u*o)+x(h*r))+x(C*s))),A[n+48>>2]=p,l=x(S+x(x(x(l*o)+x(y*r))+x(b*s))),A[n+52>>2]=l,o=x(g+x(x(x(_*o)+x(m*r))+x(v*s))),A[n+56>>2]=o,c[n+44>>2]=0,r=x(x(x(f+d)+o)*x(.3333333432674408)),A[n+40>>2]=r,m=x(x(x(a+P)+l)*x(.3333333432674408)),A[n+36>>2]=m,s=x(x(x(w+E)+p)*x(.3333333432674408)),A[n+32>>2]=s,t=c[e+8>>2],16384&pi[c[c[t>>2]+56>>2]](t)&&(_=A[n+80>>2],c[n+24>>2]=0,c[n+28>>2]=0,c[n+16>>2]=1065353216,c[n+20>>2]=1065353216,t=c[e+8>>2],c[n+12>>2]=0,v=x(E-_),g=x(l-a),l=x(P-a),_=x(p-_),a=x(x(v*g)-x(l*_)),h=x((u=a)*a),a=x(o-f),o=x(d-f),f=x(x(l*a)-x(o*g)),a=x(x(o*_)-x(v*a)),o=x(x(1)/x(T(x(h+x(x(f*f)+x(a*a)))))),A[n+8>>2]=x(u*o)+r,A[n+4>>2]=x(a*o)+m,A[n>>2]=s+x(f*o),pi[c[c[t>>2]+16>>2]](t,n+32|0,n,n+16|0)),i=c[e+8>>2],pi[c[c[i>>2]+16>>2]](i,n+80|0,n- -64|0,t=e+12|0),i=c[e+8>>2],pi[c[c[i>>2]+16>>2]](i,n- -64|0,n+48|0,t),e=c[e+8>>2],pi[c[c[e>>2]+16>>2]](e,n+48|0,n+80|0,t),N=n+96|0},zt,function(e){return(e|=0)-4|0},function(e){V((e|=0)-4|0)},function(e,t,n,i){pi[c[c[(e=(e|=0)-4|0)>>2]+8>>2]](e,t|=0,n|=0,i|=0)},ve,Qn,ve,Qn,ve,function(e,t){e|=0;var n,i,o,a,r,s,l,_,u,h,f,p,d,m,v,y,b,S,C,E,T,P,w,I;N=I=N-128|0,h=c[36+(t|=0)>>2],t=c[c[e+24>>2]+32>>2]+g(h,80)|0,E=c[t+64>>2],f=A[t+32>>2],p=A[t>>2],d=A[t+16>>2],m=A[t+56>>2],v=A[t+52>>2],y=A[t+48>>2],b=A[t+36>>2],S=A[t+20>>2],C=A[t+4>>2],n=A[t+40>>2],i=A[t+24>>2],o=A[t+8>>2],c[124+I>>2]=0,c[108+I>>2]=0,c[92+I>>2]=0,t=c[e+28>>2],a=A[t+32>>2],r=A[t+36>>2],s=A[t+40>>2],A[104+I>>2]=x(x(o*a)+x(i*r))+x(n*s),A[100+I>>2]=x(x(C*a)+x(S*r))+x(b*s),l=A[t+16>>2],_=A[t+20>>2],u=A[t+24>>2],A[88+I>>2]=x(x(o*l)+x(i*_))+x(n*u),A[84+I>>2]=x(x(C*l)+x(S*_))+x(b*u),A[120+I>>2]=x(x(x(y*a)+x(v*r))+x(m*s))+A[t+56>>2],A[116+I>>2]=x(x(x(y*l)+x(v*_))+x(m*u))+A[t+52>>2],c[76+I>>2]=0,T=o,o=A[t>>2],P=i,i=A[t+4>>2],w=n,n=A[t+8>>2],A[72+I>>2]=x(x(T*o)+x(P*i))+x(w*n),A[68+I>>2]=x(x(C*o)+x(S*i))+x(b*n),A[64+I>>2]=x(x(p*o)+x(d*i))+x(f*n),A[112+I>>2]=x(x(x(y*o)+x(v*i))+x(m*n))+A[t+48>>2],A[96+I>>2]=x(x(p*a)+x(d*r))+x(f*s),A[80+I>>2]=x(x(p*l)+x(d*_))+x(f*u),c[36+I>>2]=1065353216,c[40+I>>2]=1,c[44+I>>2]=-1,c[56+I>>2]=h,c[48+I>>2]=E,c[32+I>>2]=18648,t=c[e+32>>2],c[52+I>>2]=t,A[36+I>>2]=A[t+4>>2],c[28+I>>2]=h,c[24+I>>2]=-1,c[12+I>>2]=E,t=c[e+4>>2],c[8+I>>2]=t,c[16+I>>2]=c[t+8>>2],c[20+I>>2]=I+64,Xn(c[e+8>>2],c[e+12>>2],c[e+16>>2],8+I|0,32+I|0,A[e+20>>2]),N=128+I|0},Se,ve,function(e,t){return e=c[20+(e|=0)>>2],0|pi[c[c[e>>2]+8>>2]](e,t|=0)},function(e,t,n){e|=0,t|=0,n|=0;var i,o;return c[(N=o=N-16|0)>>2]=-1,c[4+o>>2]=c[e+24>>2],c[8+o>>2]=c[e+16>>2],c[t+4>>2]||(c[t+4>>2]=o),i=c[e+20>>2],n=x(pi[c[c[i>>2]+12>>2]](i,t,n)),A[e+4>>2]=A[c[e+20>>2]+4>>2],N=16+o|0,x(n)},ve,function(e,t){t|=0;var n,i,o,a,r,s;return N=s=N-32|0,n=c[184+(e|=0)>>2],(i=A[n+4>>2])!=x(0)&&(t=c[t>>2],0|pi[c[c[n>>2]+8>>2]](n,c[t+188>>2])&&(o=A[e+188>>2],n=c[e+184>>2],a=c[e+192>>2],r=c[t+192>>2],c[24+s>>2]=-1,c[28+s>>2]=-1,c[20+s>>2]=t+4,c[16+s>>2]=t,c[12+s>>2]=r,Xn(a,e+36|(c[8+s>>2]=0),e+100|0,8+s|0,n,o))),N=32+s|0,i!=x(0)|0},function(e){var t=0;return c[(e|=0)>>2]=19576,(t=c[e+56>>2])&&p[e+60|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+56>>2]=0,a[e+60|0]=1,c[(t=e+48|0)>>2]=0,c[t+4>>2]=0,(t=c[e+36>>2])&&p[e+40|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+36>>2]=0,a[e+40|0]=1,c[(t=e+28|0)>>2]=0,c[t+4>>2]=0,(t=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+16>>2]=0,a[e+20|0]=1,c[(t=e+8|0)>>2]=0,(c[t+4>>2]=0)|e},function(e){var t=0;c[(e|=0)>>2]=19576,(t=c[e+56>>2])&&p[e+60|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+56>>2]=0,a[e+60|0]=1,c[(t=e+48|0)>>2]=0,c[t+4>>2]=0,(t=c[e+36>>2])&&p[e+40|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+36>>2]=0,a[e+40|0]=1,c[(t=e+28|0)>>2]=0,c[t+4>>2]=0,(t=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),V(e)},function(e,t,n){e|=0,n|=0;var i=0,o=0,r=0,s=0,l=0,_=0,u=0;if(1<=(0|(s=c[8+(t|=0)>>2])))for(n=c[t+16>>2];i=c[n>>2],3&p[i+204|0]||(r=(c[i+208>>2]=r)+1|0),c[i+268>>2]=1065353216,c[i+212>>2]=-1,n=n+4|0,s=s-1|0;);if((0|(i=c[e+8>>2]))<(0|r)){if(c[e+12>>2]<(0|r)){if(s=0,r&&(c[5498]=c[5498]+1,(n=M(19+(r<<3)|0))&&(c[(s=n+19&-16)-4>>2]=n)),1<=(0|i))for(n=i;u=c[e+16>>2]+o|0,l=c[u+4>>2],c[(_=o+s|0)>>2]=c[u>>2],c[_+4>>2]=l,o=o+8|0,n=n-1|0;);(n=c[e+16>>2])&&p[e+20|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+16>>2]=s,c[e+12>>2]=r,a[e+20|0]=1}for(o=i<<3,n=r-i|0;i=c[e+16>>2]+o|0,c[i>>2]=0,o=o+8|(c[i+4>>2]=0),n=n-1|0;);}if(1<=(0|(c[e+8>>2]=r)))for(o=c[e+16>>2],n=0;c[o>>2]=n,c[o+4>>2]=1,o=o+8|0,(0|r)!=(0|(n=n+1|0)););if(t=c[t+68>>2],t=0|pi[c[c[t>>2]+36>>2]](t),(_=0|pi[c[c[t>>2]+36>>2]](t))&&(u=0|pi[c[c[t>>2]+20>>2]](t),!((0|_)<1)))for(n=0;;){if((t=c[c[(i=(n<<4)+u|0)>>2]>>2])&&(i=c[c[i+4>>2]>>2])&&!(7&c[t+204>>2]||7&p[i+204|0])){if(r=c[i+208>>2],i=c[e+16>>2],s=c[t+208>>2],(0|(t=c[(o=i+(s<<3)|0)>>2]))!=(0|s)&&(c[o>>2]=c[(t=i+(t<<3)|0)>>2],s=c[t>>2],(0|(o=c[(t=i+(s<<3)|0)>>2]))!=(0|s)))for(;c[(l=t)>>2]=c[(t=i+(o<<3)|0)>>2],s=c[t>>2],(0|(o=c[(t=i+(s<<3)|0)>>2]))!=(0|s););if((0|(o=c[(t=i+(r<<3)|0)>>2]))!=(0|r)&&(c[(l=t)>>2]=c[(t=i+(o<<3)|0)>>2],r=c[t>>2],(0|(o=c[(t=i+(r<<3)|0)>>2]))!=(0|r)))for(;c[(l=t)>>2]=c[(t=i+(o<<3)|0)>>2],r=c[t>>2],(0|(o=c[(t=i+(r<<3)|0)>>2]))!=(0|r););(0|r)!=(0|s)&&(c[(t=i+(s<<3)|0)>>2]=r,c[4+(i=i+(r<<3)|0)>>2]=c[i+4>>2]+c[t+4>>2])}if((0|_)==(0|(n=n+1|0)))break}},function(e,t){e|=0;var n,i,o,a,r,s=0,l=0,_=0,u=0;if(1<=(0|(r=c[8+(t|=0)>>2])))for(a=c[t+16>>2];;){if(n=c[(l<<2)+a>>2],3&p[n+204|0])c[n+208>>2]=-1,c[n+212>>2]=-2;else{if(i=c[e+16>>2],(0|(t=u))!=(0|(s=c[(o=i+(t<<3)|0)>>2]))&&(c[o>>2]=c[(t=(s<<3)+i|0)>>2],(0|(t=c[t>>2]))!=(0|(s=c[(_=(t<<3)+i|0)>>2]))))for(;c[_>>2]=c[(t=(s<<3)+i|0)>>2],(0|(t=c[t>>2]))!=(0|(s=c[(_=(t<<3)+i|0)>>2])););c[n+208>>2]=t,c[n+212>>2]=-1,c[4+o>>2]=l,u=u+1|0}if((0|r)==(0|(l=l+1|0)))break}},function(e){return c[(e|=0)>>2]=19636,0|e},Ae,Tn,function(){},qt,et,Jn,ei,function(e){e=ei(e|=0),c[5499]=c[5499]+1,z(c[e-4>>2])},function(e){var t,n,i,o,a=0,r=0;if(Vn(e|=0),0|pi[c[c[e>>2]+20>>2]](e)&&(a=0|pi[c[c[e>>2]+20>>2]](e),6144&pi[c[c[a>>2]+56>>2]](a)&&!((0|(a=0|pi[c[c[e>>2]+104>>2]](e)))<1)))for(a=a+1|0;o=0|pi[c[c[(i=e)>>2]+108>>2]](e,a-2|0),n=c[c[e>>2]+172>>2],pi[n](0|i,0|o),1<(0|(a=a-1|0)););if(0|pi[c[c[e>>2]+20>>2]](e)&&(a=0|pi[c[c[e>>2]+20>>2]](e),16387&pi[c[c[a>>2]+56>>2]](a)&&0|pi[c[c[e>>2]+20>>2]](e)&&(a=0|pi[c[c[e>>2]+20>>2]](e),0|pi[c[c[a>>2]+56>>2]](a)&&!(c[e+296>>2]<1))))for(a=0;t=c[c[e+304>>2]+a>>2],pi[c[c[t>>2]+12>>2]](t,c[e+72>>2]),a=a+4|0,(0|(r=r+1|0))<c[e+296>>2];);0|pi[c[c[e>>2]+20>>2]](e)&&(e=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[e>>2]+104>>2]](e))},function(e,t,n,i){Hn(e|=0,t|=0,n|=0,i|=0)},function(e,t){e|=0,(t|=0)&&2&c[t+252>>2]?pi[c[c[e>>2]+92>>2]](e,t):Wn(e,t)},function(e,t){e|=0;var n,i=0,o=0,a=0,r=0,s=0,l=0,_=0,u=0;if(pi[c[c[(t|=0)>>2]+32>>2]](t),a=0|pi[c[c[t>>2]+16>>2]](t,104,1),i=B(c[a+8>>2],0,104),A[i+88>>2]=A[e+264>>2],A[i+92>>2]=A[e+268>>2],A[i+96>>2]=A[e+272>>2],A[i+100>>2]=A[e+276>>2],n=c[4+(o=e+124|0)>>2],c[i+28>>2]=c[o>>2],c[i+32>>2]=n,n=c[4+(o=e+104|0)>>2],c[i+12>>2]=c[o>>2],c[i+16>>2]=n,n=c[4+(o=e+116|0)>>2],c[i+20>>2]=c[o>>2],c[i+24>>2]=n,n=c[4+(o=e+96|0)>>2],c[i+4>>2]=c[o>>2],c[i+8>>2]=n,A[i>>2]=A[e+92>>2],A[i+36>>2]=A[e+132>>2],A[i+40>>2]=A[e+148>>2],A[i+44>>2]=A[e+152>>2],A[i+48>>2]=A[e+156>>2],A[i+52>>2]=A[e+160>>2],A[i+56>>2]=A[e+176>>2],A[i+60>>2]=A[e+180>>2],c[i+64>>2]=c[e+112>>2],c[i+68>>2]=c[e+164>>2],c[i+72>>2]=c[e+168>>2],c[i+76>>2]=c[e+172>>2],o=c[e+144>>2],c[i+84>>2]=0,c[i+80>>2]=o,pi[c[c[t>>2]+20>>2]](t,a,20177,1145853764,i),qn(e,t),1<=(0|(i=c[e+8>>2])))for(o=0;a=c[c[e+16>>2]+r>>2],2&p[a+252|0]&&(l=t,_=0|pi[c[c[a>>2]+16>>2]](a),s=c[c[t>>2]+16>>2],i=0|pi[s](0|l,0|_,0|(u=1)),n=0|pi[c[c[a>>2]+20>>2]](a,c[i+8>>2],t),pi[c[c[t>>2]+20>>2]](t,i,n,1497645650,a),i=c[e+8>>2]),r=r+4|0,(0|(o=o+1|0))<(0|i););if(1<=c[e+228>>2])for(i=r=0;a=c[c[e+236>>2]+r>>2],u=t,_=0|pi[c[c[a>>2]+36>>2]](a),s=c[c[t>>2]+16>>2],o=0|pi[s](0|u,0|_,0|(l=1)),u=0|pi[c[c[a>>2]+40>>2]](a,c[(_=o)+8>>2],l=t),s=c[c[t>>2]+20>>2],pi[s](0|l,0|_,0|u,1397641027,0|a),r=r+4|0,(0|(i=i+1|0))<c[e+228>>2];);pi[c[c[t>>2]+36>>2]](t)},function(e,t,n,i){e|=0,t=x(t),n|=0,i=x(i);var o,r=0,s=0;if(n?(A[e+284>>2]=i,t=x(A[e+280>>2]+t),i<=(A[e+280>>2]=t)&&(s=e,t=x((o=t)/i),r=x(y(t))<x(2147483648)?~~t:-2147483648,A[s+280>>2]=o-x(x(0|r)*i))):(c[e+284>>2]=0,A[e+280>>2]=p[e+316|0]?x(0):t,n=r=!(x(y(i=t))<x(1.1920928955078125e-7))),0|pi[c[c[e>>2]+20>>2]](e)&&(s=0|pi[c[c[e>>2]+20>>2]](e),s=pi[c[c[s>>2]+56>>2]](s)>>>4&1,a[23468]=s),r){if(pi[c[c[e>>2]+168>>2]](e,x(i*x(0|(n=(0|n)<(0|r)?n:r)))),pi[c[c[e>>2]+176>>2]](e),!((0|n)<1))for(;pi[c[c[e>>2]+160>>2]](e,i),pi[c[c[e>>2]+80>>2]](e),n=n-1|0;);}else pi[c[c[e>>2]+80>>2]](e);return pi[c[c[e>>2]+120>>2]](e),0|r},function(e,t,n){t|=0,n|=0;var i,o=0,r=0,s=0,l=0;if((0|(r=c[228+(e|=0)>>2]))==c[e+232>>2]&&!((0|(i=r?r<<1:1))<=(0|r))){if(i&&(c[5498]=c[5498]+1,(o=M(19+(i<<2)|0))&&(c[(s=o+19&-16)-4>>2]=o)),1<=(0|r))for(o=r;c[l+s>>2]=c[c[e+236>>2]+l>>2],l=l+4|0,o=o-1|0;);(o=c[e+236>>2])&&p[e+240|0]&&(c[5499]=c[5499]+1,z(c[o-4>>2]),r=c[e+228>>2]),c[e+236>>2]=s,c[e+232>>2]=i,a[e+240|0]=1}c[e+228>>2]=r+1,c[c[e+236>>2]+(r<<2)>>2]=t,n&&(Nn(c[t+28>>2],t),Nn(c[t+32>>2],t))},function(e,t){t|=0;var n,i=0,o=0,a=0;e:if(!((0|(i=c[228+(e|=0)>>2]))<1)){for(o=n=c[e+236>>2];c[o>>2]!=(0|t);)if(o=o+4|0,(0|i)==(0|(a=a+1|0)))break e;(0|i)<=(0|a)||(c[(a=o)>>2]=c[(i=(o=i-1|0)<<2)+n>>2],c[e+228>>2]=o,c[i+c[e+236>>2]>>2]=t)}On(c[t+28>>2],t),On(c[t+32>>2],t)},function(e,t){t|=0;var n,i=0,o=0,r=0,s=0;if((0|(o=c[296+(e|=0)>>2]))==c[e+300>>2]&&!((0|(n=o?o<<1:1))<=(0|o))){if(n&&(c[5498]=c[5498]+1,(i=M(19+(n<<2)|0))&&(c[(r=i+19&-16)-4>>2]=i)),1<=(0|o))for(i=o;c[s+r>>2]=c[c[e+304>>2]+s>>2],s=s+4|0,i=i-1|0;);(i=c[e+304>>2])&&p[e+308|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2]),o=c[e+296>>2]),c[e+304>>2]=r,c[e+300>>2]=n,a[e+308|0]=1}c[e+296>>2]=o+1,c[c[e+304>>2]+(o<<2)>>2]=t},function(e,t){t|=0;var n,i=0,o=0,a=0;e:if(!((0|(i=c[296+(e|=0)>>2]))<1)){for(o=n=c[e+304>>2];c[o>>2]!=(0|t);)if(o=o+4|0,(0|i)==(0|(a=a+1|0)))break e;(0|i)<=(0|a)||(c[(a=o)>>2]=c[(i=(o=i-1|0)<<2)+n>>2],c[e+296>>2]=o,c[i+c[e+304>>2]>>2]=t)}},function(e,t){e|=0;var n,i,o,r,s,l,_=0,u=0,h=0,f=0;if(_=c[4+(t|=0)>>2],c[e+264>>2]=c[t>>2],c[e+268>>2]=_,o=c[4+(u=i=t+8|0)>>2],c[(_=e+272|0)>>2]=c[u>>2],c[_+4>>2]=o,1<=(0|(u=c[e+248>>2])))for(;;){e:{switch(_=c[c[e+256>>2]+h>>2],c[_+220>>2]-2|0){case 0:case 3:break e}1&a[_+564|0]||((n=A[_+404>>2])!=x(0)&&(r=A[t>>2],s=A[t+4>>2],l=A[t+8>>2],c[_+436>>2]=0,n=x(x(1)/n),A[_+432>>2]=l*n,A[_+428>>2]=n*s,A[_+424>>2]=n*r),u=c[t+4>>2],c[_+440>>2]=c[t>>2],c[_+444>>2]=u,u=c[4+i>>2],c[(_=_+448|0)>>2]=c[i>>2],c[_+4>>2]=u,u=c[e+248>>2])}if(h=h+4|0,!((0|(f=f+1|0))<(0|u)))break}},function(e,t){var n=c[268+(t|=0)>>2];c[(e|=0)>>2]=c[t+264>>2],c[e+4>>2]=n,n=c[4+(t=t+272|0)>>2],c[(e=e+8|0)>>2]=c[t>>2],c[e+4>>2]=n},function(e){e|=0;var t,n=0,i=0,o=x(0),a=0,r=0;if(N=t=N+-64|0,p[e+290|0]){if(!((0|(i=c[e+8>>2]))<1))for(;(n=c[c[e+16>>2]+a>>2])&&2&c[n+252>>2]&&c[n+540>>2]&&(3&p[n+204|0]||(Bn(i=n+68|0,A[n+132>>2],A[n+136>>2],A[n+140>>2],n+148|0,o=p[e+316|0]&&(o=A[e+284>>2])!=x(0)?x(A[e+280>>2]-o):x(A[e+280>>2]*A[n+268>>2]),t),n=c[n+540>>2],pi[c[c[n>>2]+12>>2]](n,t),i=c[e+8>>2])),a=a+4|0,(0|(r=r+1|0))<(0|i););}else if(!((0|(i=c[e+248>>2]))<1))for(;;){e:{switch(n=c[c[e+256>>2]+r>>2],c[n+220>>2]-2|0){case 0:case 3:break e}c[n+540>>2]&&(3&p[n+204|0]||(Bn(i=n+68|0,A[n+132>>2],A[n+136>>2],A[n+140>>2],n+148|0,o=p[e+316|0]&&(o=A[e+284>>2])!=x(0)?x(A[e+280>>2]-o):x(A[e+280>>2]*A[n+268>>2]),t),n=c[n+540>>2],pi[c[c[n>>2]+12>>2]](n,t),i=c[e+248>>2]))}if(r=r+4|0,!((0|(a=a+1|0))<(0|i)))break}N=t+64|0},function(e,t){e|=0;var n,i,o,r,s,l,_=0,u=0,h=0,f=0,d=0,m=0;if((f=3&(l=c[204+(t|=0)>>2]))||1&a[t+564|0]||((i=A[t+404>>2])!=x(0)&&(o=A[e+268>>2],r=A[e+272>>2],n=A[e+264>>2],c[t+436>>2]=0,s=n,n=x(x(1)/i),A[t+424>>2]=s*n,A[t+432>>2]=n*r,A[t+428>>2]=n*o),u=c[4+(_=e+264|0)>>2],c[t+440>>2]=c[_>>2],c[t+444>>2]=u,u=c[4+(_=_+8|0)>>2],c[(h=t+448|0)>>2]=c[_>>2],c[h+4>>2]=u),c[t+192>>2]){if(1&l)4!=(-2&c[t+220>>2])&&(c[t+220>>2]=2);else{if((0|(_=c[e+248>>2]))==c[e+252>>2]&&!((0|(h=_?_<<1:1))<=(0|_))){if(h&&(c[5498]=c[5498]+1,(u=M(19+(h<<2)|0))&&(c[(d=u+19&-16)-4>>2]=u)),1<=(0|_))for(u=_;c[m+d>>2]=c[c[e+256>>2]+m>>2],m=m+4|0,u=u-1|0;);(u=c[e+256>>2])&&p[e+260|0]&&(c[5499]=c[5499]+1,z(c[u-4>>2]),f=3&c[t+204>>2],_=c[e+248>>2]),c[e+256>>2]=d,c[e+252>>2]=h,a[e+260|0]=1}c[e+248>>2]=_+1,c[c[e+256>>2]+(_<<2)>>2]=t}pi[c[c[e>>2]+36>>2]](e,t,f?2:1,f?-3:-1)}},function(e,t,n,i){e|=0,n|=0,i|=0;var o,r,s,l,_,u,h=0,f=0,d=0,m=0,v=0;if(3&(u=c[204+(t|=0)>>2])||1&a[t+564|0]||((r=A[t+404>>2])!=x(0)&&(s=A[e+268>>2],l=A[e+272>>2],o=A[e+264>>2],c[t+436>>2]=0,_=o,o=x(x(1)/r),A[t+424>>2]=_*o,A[t+432>>2]=o*l,A[t+428>>2]=o*s),f=c[4+(h=e+264|0)>>2],c[t+440>>2]=c[h>>2],c[t+444>>2]=f,f=c[4+(h=h+8|0)>>2],c[(d=t+448|0)>>2]=c[h>>2],c[d+4>>2]=f),c[t+192>>2]){if(1&u)4!=(-2&c[t+220>>2])&&(c[t+220>>2]=2);else{if((0|(h=c[e+248>>2]))==c[e+252>>2]&&!((0|(d=h?h<<1:1))<=(0|h))){if(d&&(c[5498]=c[5498]+1,(f=M(19+(d<<2)|0))&&(c[(m=f+19&-16)-4>>2]=f)),1<=(0|h))for(f=h;c[v+m>>2]=c[c[e+256>>2]+v>>2],v=v+4|0,f=f-1|0;);(f=c[e+256>>2])&&p[e+260|0]&&(c[5499]=c[5499]+1,z(c[f-4>>2]),h=c[e+248>>2]),c[e+256>>2]=m,c[e+252>>2]=d,a[e+260|0]=1}c[e+248>>2]=h+1,c[c[e+256>>2]+(h<<2)>>2]=t}pi[c[c[e>>2]+36>>2]](e,t,n,i)}},function(e,t){t|=0;var n,i=0,o=0,a=0;e:if(!((0|(i=c[248+(e|=0)>>2]))<1)){for(o=n=c[e+256>>2];c[o>>2]!=(0|t);)if(o=o+4|0,(0|i)==(0|(a=a+1|0)))break e;(0|i)<=(0|a)||(c[(a=o)>>2]=c[(i=(o=i-1|0)<<2)+n>>2],c[e+248>>2]=o,c[i+c[e+256>>2]>>2]=t)}Wn(e,t)},function(e,t){var n;t|=0,p[289+(e|=0)|0]&&(n=c[e+216>>2])&&(c[5499]=c[5499]+1,z(c[n-4>>2])),c[e+216>>2]=t,a[e+289|0]=0,c[c[e+212>>2]+8>>2]=t},function(e){return c[216+(e|=0)>>2]},function(e){return c[228+(e|=0)>>2]},ti,ti,Xt,function(e){var t,n,i=0,o=0;if(1<=c[248+(e|=0)>>2])for(;n=c[c[e+256>>2]+i>>2],c[(t=n)+472>>2]=0,c[t+476>>2]=0,c[(t=t+496|0)>>2]=0,c[4+t>>2]=0,c[(t=n+488|0)>>2]=0,c[4+t>>2]=0,c[(n=n+480|0)>>2]=0,i=i+4|(c[4+n>>2]=0),(0|(o=o+1|0))<c[e+248>>2];);},Lt,ni,Lt,ni,function(e,t){e|=0,t=x(t);var n,i,o,a,r,s=x(0),l=x(0),_=x(0),u=x(0),h=0,f=x(0),d=x(0),m=x(0),v=x(0),g=0,y=0;if(1<=(0|(h=c[e+248>>2])))for(;n=c[c[e+256>>2]+g>>2],3&p[n+204|0]||(u=A[(h=n+372|0)>>2],v=A[n+504>>2],l=de(x(x(1)-v),t),f=x(u*l),A[h>>2]=f,u=x(l*A[(o=n+376|0)>>2]),A[o>>2]=u,l=x(l*A[(a=n+380|0)>>2]),A[a>>2]=l,s=A[n+388>>2],r=A[n+508>>2],_=de(x(x(1)-r),t),d=x(s*_),A[n+388>>2]=d,m=x(_*A[(i=n+392|0)>>2]),A[i>>2]=m,_=x(_*A[(i=n+396|0)>>2]),A[i>>2]=_,i=n+388|0,p[n+512|0]&&(A[n+524>>2]>x(x(x(d*d)+x(m*m))+x(_*_))&&A[n+520>>2]>x(x(x(f*f)+x(u*u))+x(l*l))&&(s=A[n+516>>2],_=x(_*s),A[n+396>>2]=_,m=x(m*s),A[n+392>>2]=m,d=x(d*s),A[n+388>>2]=d,l=x(l*s),A[a>>2]=l,u=x(u*s),A[o>>2]=u,f=x(f*s),A[n+372>>2]=f),(s=x(T(x(x(x(f*f)+x(u*u))+x(l*l)))))<v&&(s>x(.004999999888241291)?(s=x(x(1)/s),l=x(l-x(x(l*s)*x(.004999999888241291))),A[a>>2]=l,u=x(u-x(x(u*s)*x(.004999999888241291))),A[o>>2]=u,f=x(f-x(x(f*s)*x(.004999999888241291))),A[n+372>>2]=f):(c[h>>2]=0,c[h+4>>2]=0,c[(h=h+8|0)>>2]=0,c[h+4>>2]=0,l=x(0),u=x(0),f=x(0))),(s=x(T(x(x(x(d*d)+x(m*m))+x(_*_)))))<r&&(s>x(.004999999888241291)?(v=_,_=x(x(1)/s),A[n+396>>2]=v-x(x(v*_)*x(.004999999888241291)),A[n+392>>2]=m-x(x(m*_)*x(.004999999888241291)),A[n+388>>2]=d-x(x(d*_)*x(.004999999888241291))):(c[i>>2]=0,c[4+i>>2]=0,c[(h=8+i|0)>>2]=0,c[h+4>>2]=0))),Bn(n+4|0,f,u,l,i,t,n+68|0),h=c[e+248>>2]),g=g+4|0,(0|(y=y+1|0))<(0|h););},function(e,t){e|=0,t=x(t);var n,i,o,a,r,s,l,_,u,h,f,d,m=0,v=0,g=0,y=x(0),b=0,S=0,C=x(0),E=0,T=0,P=x(0);if(N=d=N-304|0,1<=(0|(E=c[e+248>>2])))for(g=c[e+256>>2],o=56+d|0,a=40+d|0,r=24+d|0,T=104+d|0,s=168+d|0,l=152+d|0,b=288+d|0;;){v=c[g>>2],c[v+268>>2]=1065353216;e:{switch(c[v+220>>2]-2|0){case 0:case 3:break e}3&p[v+204|0]||(Bn(S=v+4|0,A[v+372>>2],A[(u=v+376|0)>>2],A[(h=v+380|0)>>2],f=v+388|0,t,240+d|0),p[e+44|0]&&(y=A[v+276>>2],(y=x(y*y))!=x(0)&&(C=x(A[288+d>>2]-A[(m=v+52|0)>>2]),P=x(C*C),C=x(A[292+d>>2]-A[v+56>>2]),P=x(P+x(C*C)),C=x(A[296+d>>2]-A[v+60>>2]),y<x(P+x(C*C))&&!(19<c[c[v+192>>2]+4>>2])&&(c[6039]=c[6039]+1,n=c[e+68>>2],n=0|pi[c[c[n>>2]+36>>2]](n),i=c[m+4>>2],c[l>>2]=c[m>>2],c[4+l>>2]=i,_=c[4+(m=m+8|0)>>2],c[(i=8+l|0)>>2]=c[m>>2],c[4+i>>2]=_,m=c[b+4>>2],c[s>>2]=c[b>>2],c[4+s>>2]=m,_=c[4+(m=b+8|0)>>2],c[(i=8+s|0)>>2]=c[m>>2],c[4+i>>2]=_,c[140+d>>2]=1065353216,c[136+d>>2]=20112,c[216+d>>2]=0,c[232+d>>2]=c[e+24>>2],c[228+d>>2]=n,c[220+d>>2]=v,c[T>>2]=0,c[T+4>>2]=0,c[(n=T+8|0)>>2]=0,c[4+n>>2]=0,c[T+16>>2]=0,c[84+d>>2]=0,c[88+d>>2]=0,c[100+d>>2]=1065353216,c[92+d>>2]=1065353216,c[96+d>>2]=1065353216,c[76+d>>2]=8,c[80+d>>2]=0,c[72+d>>2]=11936,c[128+d>>2]=0,y=A[v+272>>2],A[108+d>>2]=y,A[124+d>>2]=y,A[224+d>>2]=A[e+56>>2],n=c[v+188>>2],c[144+d>>2]=c[n+4>>2],c[148+d>>2]=c[n+8>>2],i=c[m+4>>2],c[(n=8+o|0)>>2]=c[m>>2],c[4+n>>2]=i,m=c[b+4>>2],c[o>>2]=c[b>>2],c[4+o>>2]=m,i=c[4+(n=S+8|0)>>2],c[(m=16+d|0)>>2]=c[n>>2],c[m+4>>2]=i,n=c[4+(m=v+20|0)>>2],c[r>>2]=c[m>>2],c[4+r>>2]=n,i=c[4+(n=v+28|0)>>2],c[(m=8+r|0)>>2]=c[n>>2],c[m+4>>2]=i,n=c[4+(m=v+36|0)>>2],c[a>>2]=c[m>>2],c[4+a>>2]=n,i=c[4+(n=v+44|0)>>2],c[(m=8+a|0)>>2]=c[n>>2],c[m+4>>2]=i,m=c[S+4>>2],c[8+d>>2]=c[S>>2],c[12+d>>2]=m,Zn(e,72+d|0,S,8+d|0,136+d|0,x(0)),(y=A[140+d>>2])<x(1))))?(A[v+268>>2]=y,Bn(S,A[v+372>>2],A[u>>2],A[h>>2],f,x(y*t),240+d|0),Dn(v,240+d|(c[v+268>>2]=0))):Dn(v,240+d|0))}if(g=g+4|0,!(E=E-1|0))break}if(p[e+291|0]&&!((0|(g=c[e+324>>2]))<1))for(S=0;;){if(b=c[c[e+332>>2]+(S<<2)>>2],1<=(0|(E=c[b+844>>2]))){for(m=c[b+840>>2],m=c[m+252>>2]<<30>>31&m,v=c[b+836>>2],v=c[v+252>>2]<<30>>31&v,g=b+68|0,T=0;(t=x(A[v+232>>2]*A[m+232>>2]))>x(0)&&(y=A[g+68>>2])!=x(0)&&(c[148+d>>2]=0,C=x(t*x(y*x(-A[g>>2]))),A[136+d>>2]=C,P=x(t*x(y*x(-A[g+4>>2]))),A[140+d>>2]=P,t=x(t*x(y*x(-A[g+8>>2]))),A[144+d>>2]=t,c[252+d>>2]=0,A[248+d>>2]=A[g-8>>2]-A[v+60>>2],A[244+d>>2]=A[g-12>>2]-A[v+56>>2],A[240+d>>2]=A[g-16>>2]-A[v+52>>2],c[20+d>>2]=0,A[16+d>>2]=A[g-24>>2]-A[m+60>>2],A[12+d>>2]=A[g-28>>2]-A[m+56>>2],A[8+d>>2]=A[g-32>>2]-A[m+52>>2],ii(v,136+d|0,240+d|0),c[84+d>>2]=0,A[80+d>>2]=-t,A[76+d>>2]=-P,A[72+d>>2]=-C,ii(m,72+d|0,8+d|0),E=c[b+844>>2]),g=g+208|0,(0|(T=T+1|0))<(0|E););g=c[e+324>>2]}if(!((0|(S=S+1|0))<(0|g)))break}N=304+d|0},function(e){var t=0,n=0,i=0,o=0,a=0,r=0,s=0,l=0;if(t=c[220+(e|=0)>>2],pi[c[c[t>>2]+8>>2]](t,e,c[e+24>>2]),1<=(0|(s=c[e+324>>2])))for(l=c[e+332>>2];;){if(t=c[l+(r<<2)>>2],(n=c[t+836>>2])&&(t=c[t+840>>2])&&!(3&c[n+204>>2]||3&p[t+204|0])){if(t=c[t+208>>2],o=c[c[e+220>>2]+16>>2],a=c[n+208>>2],(0|(n=c[(i=o+(a<<3)|0)>>2]))!=(0|a)&&(c[i>>2]=c[(n=o+(n<<3)|0)>>2],a=c[n>>2],(0|(n=c[(i=o+(a<<3)|0)>>2]))!=(0|a)))for(;c[i>>2]=c[(n=o+(n<<3)|0)>>2],a=c[n>>2],(0|(n=c[(i=o+(a<<3)|0)>>2]))!=(0|a););if((0|(i=c[(n=o+(t<<3)|0)>>2]))!=(0|t)&&(c[n>>2]=c[(t=o+(i<<3)|0)>>2],t=c[t>>2],(0|(n=c[(i=o+(t<<3)|0)>>2]))!=(0|t)))for(;c[i>>2]=c[(t=o+(n<<3)|0)>>2],t=c[t>>2],(0|(n=c[(i=o+(t<<3)|0)>>2]))!=(0|t););(0|t)!=(0|a)&&(c[(n=o+(a<<3)|0)>>2]=t,c[4+(t=o+(t<<3)|0)>>2]=c[t+4>>2]+c[n+4>>2])}if((0|s)==(0|(r=r+1|0)))break}if(1<=(0|(s=c[e+228>>2])))for(l=c[e+236>>2],r=0;;){if(t=c[l+(r<<2)>>2],p[t+20|0]&&(n=c[t+28>>2],!(3&p[n+204|0]||(t=c[t+32>>2],3&p[t+204|0])))){if(t=c[t+208>>2],o=c[c[e+220>>2]+16>>2],a=c[n+208>>2],(0|(n=c[(i=o+(a<<3)|0)>>2]))!=(0|a)&&(c[i>>2]=c[(n=o+(n<<3)|0)>>2],a=c[n>>2],(0|(n=c[(i=o+(a<<3)|0)>>2]))!=(0|a)))for(;c[i>>2]=c[(n=o+(n<<3)|0)>>2],a=c[n>>2],(0|(n=c[(i=o+(a<<3)|0)>>2]))!=(0|a););if((0|(i=c[(n=o+(t<<3)|0)>>2]))!=(0|t)&&(c[n>>2]=c[(t=o+(i<<3)|0)>>2],t=c[t>>2],(0|(n=c[(i=o+(t<<3)|0)>>2]))!=(0|t)))for(;c[i>>2]=c[(t=o+(n<<3)|0)>>2],t=c[t>>2],(0|(n=c[(i=o+(t<<3)|0)>>2]))!=(0|t););(0|t)!=(0|a)&&(c[(n=o+(a<<3)|0)>>2]=t,c[4+(t=o+(t<<3)|0)>>2]=c[t+4>>2]+c[n+4>>2])}if((0|s)==(0|(r=r+1|0)))break}t=c[e+220>>2],pi[c[c[t>>2]+12>>2]](t,e)},function(e,t){t|=0;var n,i,o,r,s,l,_,u,h,f=0,d=0,m=0,A=0,v=0,g=0,x=0,y=0,b=0,S=0,C=0,E=0,T=0;if(N=h=N-16|0,(0|(m=c[196+(e|=0)>>2]))<(0|(v=c[e+228>>2]))){if((0|v)>c[e+200>>2]){if(v&&(c[5498]=c[5498]+1,(f=M(19+(v<<2)|0))&&(c[(A=f+19&-16)-4>>2]=f)),1<=(0|m))for(f=m;c[d+A>>2]=c[c[e+204>>2]+d>>2],d=d+4|0,f=f-1|0;);(f=c[e+204>>2])&&p[e+208|0]&&(c[5499]=c[5499]+1,z(c[f-4>>2])),c[e+204>>2]=A,c[e+200>>2]=v,a[e+208|0]=1}for(d=m<<2,f=v-m|0;d=d+4|(c[c[e+204>>2]+d>>2]=0),f=f-1|0;);}if(c[e+196>>2]=v,1<=(0|pi[c[c[e>>2]+104>>2]](e)))for(f=d=0;c[c[e+204>>2]+d>>2]=c[c[e+236>>2]+d>>2],d=d+4|0,f=f+1|0,(0|pi[c[c[e>>2]+104>>2]](e))>(0|f););if(2<=(0|(f=c[e+196>>2]))&&function e(t,n,i){for(var o=0,a=0,r=0,s=0,l=0,_=0,u=0,h=0,f=0,p=0;;){for(f=n,a=c[t+12>>2],h=c[a+((n+i|0)/2<<2)>>2],o=i;;){if(l=(0|(u=c[c[h+28>>2]+208>>2]))<0)for(r=n-1|0,s=((n<<2)+a|0)-4|0,p=c[c[h+32>>2]+208>>2];r=r+1|0,_=c[(s=s+4|0)>>2],(0|(n=(0|(n=c[c[_+28>>2]+208>>2]))<=-1?c[c[_+32>>2]+208>>2]:n))<(0|p););else for(r=n-1|0,s=((n<<2)+a|0)-4|0;r=r+1|0,_=c[(s=s+4|0)>>2],(0|(n=(0|(n=c[c[_+28>>2]+208>>2]))<=-1?c[c[_+32>>2]+208>>2]:n))<(0|u););for(l?(n=o+1|0,l=(o<<2)+a|0,u=c[c[h+32>>2]+208>>2]):(n=o+1|0,l=(o<<2)+a|0);a=c[l>>2],(0|(o=c[c[a+28>>2]+208>>2]))<=-1&&(o=c[c[a+32>>2]+208>>2]),l=l-4|0,n=n-1|0,(0|u)<(0|o););if(!((0|(n=(0|n)<(0|r)?(o=n,r):(c[s>>2]=a,c[c[t+12>>2]+(n<<2)>>2]=_,o=n-1|0,r+1|0)))<=(0|o)))break;a=c[t+12>>2]}if((0|f)<(0|o)&&e(t,f,o),!((0|n)<(0|i)))break}}(e+192|0,0,f-1|0),(f=0)|pi[c[c[e>>2]+104>>2]](e)&&(f=c[e+204>>2]),d=c[e+196>>2],s=m=c[e+212>>2],l=0|pi[c[c[e>>2]+20>>2]](e),c[s+20>>2]=l,c[m+16>>2]=d,c[m+12>>2]=f,c[m+4>>2]=t,(0|(f=c[m+32>>2]))<=-1)for(c[m+36>>2]<=-1&&((d=c[m+40>>2])&&p[m+44|0]&&(c[5499]=c[5499]+1,z(c[d-4>>2])),c[m+36>>2]=0,c[m+40>>2]=0,a[m+44|0]=1),A=f<<2;A=A+4|(c[c[m+40>>2]+A>>2]=0),(d=f)>>>0<=(f=f+1|0)>>>0;);if(((c[m+32>>2]=0)|(f=c[m+52>>2]))<=-1)for(c[m+56>>2]<=-1&&((d=c[m+60>>2])&&p[m- -64|0]&&(c[5499]=c[5499]+1,z(c[d-4>>2])),c[m+56>>2]=0,c[m+60>>2]=0,a[m- -64|0]=1),A=f<<2;A=A+4|(c[c[m+60>>2]+A>>2]=0),(d=f)>>>0<=(f=f+1|0)>>>0;);if(((c[m+52>>2]=0)|(f=c[m+72>>2]))<=-1)for(c[m+76>>2]<=-1&&((d=c[m+80>>2])&&p[m+84|0]&&(c[5499]=c[5499]+1,z(c[d-4>>2])),c[m+76>>2]=0,c[m+80>>2]=0,a[m+84|0]=1),A=f<<2;A=A+4|(c[c[m+80>>2]+A>>2]=0),(d=f)>>>0<=(f=f+1|0)>>>0;);if(c[m+72>>2]=0,f=c[e+216>>2],d=c[e+24>>2],l=f,_=c[e+8>>2],u=0|pi[c[c[d>>2]+36>>2]](d),s=c[c[f>>2]+8>>2],pi[s](0|l,0|_,0|u),o=c[e+212>>2],y=c[e+24>>2],n=c[e+220>>2],(0|(d=c[n+28>>2]))<=-1)for(c[n+32>>2]<=-1&&((f=c[n+36>>2])&&p[n+40|0]&&(c[5499]=c[5499]+1,z(c[f-4>>2])),c[n+32>>2]=0,c[n+36>>2]=0,a[n+40|0]=1),A=d<<2;A=A+4|(c[c[n+36>>2]+A>>2]=0),(f=d)>>>0<=(d=f+1|0)>>>0;);if(!(((c[n+28>>2]=0)|(x=c[n+8>>2]))<=0)){for(b=n+4|0,m=c[n+16>>2],v=0;;){if((0|(f=c[(A=m+((d=v)<<3)|0)>>2]))!=(0|d)&&(c[A>>2]=c[(f=m+(f<<3)|0)>>2],(0|(d=c[f>>2]))!=(0|(g=c[(f=m+(d<<3)|0)>>2]))))for(;c[(d=f)>>2]=c[(f=m+(g<<3)|0)>>2],(0|(d=c[f>>2]))!=(0|(g=c[(f=m+(d<<3)|0)>>2])););if(c[A>>2]=d,(0|x)==(0|(v=v+1|0)))break}if(2<=(0|x)&&(function e(t,n,i){for(var o,a,r,s=0,l=0,_=0,u=0,h=0,f=0,p=0;;){for(h=c[t+12>>2],a=c[h+((i+(o=n)|0)/2<<3)>>2],_=n,u=i;;){for(l=((_<<3)+h|0)-8|0;_=_+1|0,c[(l=l+8|0)>>2]<(0|a););for(n=_-1|0,s=8+(u<<3)|0;u=u-1|0,f=s+h|0,s=p=s-8|0,c[f-8>>2]>(0|a););if((0|n)<=(0|(s=u+1|0))&&(r=c[l>>2],f=c[l+4>>2],n=c[4+(s=h+p|0)>>2],c[l>>2]=c[s>>2],c[l+4>>2]=n,n=c[t+12>>2]+p|0,c[n>>2]=r,c[n+4>>2]=f,s=u,n=_),!((0|n)<=(0|s)))break;h=c[t+12>>2],_=n,u=s}if((0|o)<(0|s)&&e(t,o,s),!((0|n)<(0|i)))break}}(b,0,x-1|0),x=c[n+8>>2]),!((0|x)<1))for(T=(E=c[n+16>>2])+4|0,r=E+8|0,d=0;;){v=(A=(0|(f=(m=d)+1|0))<(0|x)?x:f)-1|0,f=(g=m<<3)+r|0,b=c[g+E>>2];e:{for(;;){if((0|d)==(0|v)){d=A;break e}if(d=d+1|0,S=c[f>>2],f=f+8|0,(0|b)!=(0|S))break}v=d-1|0}e:if(!((0|v)<(0|m))){for(S=m-1|0,A=c[e+16>>2],C=1,f=g=g+T|0;i=c[A+(c[f>>2]<<2)>>2],(0|b)==c[i+208>>2]&&(C&=4!=(0|(i=c[i+220>>2]))&1!=(0|i)),f=f+8|0,(0|(S=S+1|0))!=(0|v););if(!C)for(f=v-m|0;;){if(m=c[A+(c[g>>2]<<2)>>2],(0|b)==c[m+208>>2]&&2==c[m+220>>2]&&(c[m+220>>2]=3,c[m+224>>2]=0),!f)break e;g=g+8|0,f=f-1|0}for(f=v-m|0;;){if(m=c[A+(c[g>>2]<<2)>>2],(0|b)==c[m+208>>2]&&4!=(-2&c[m+220>>2])&&(c[m+220>>2]=2),!f)break e;g=g+8|0,f=f-1|0}}if(!((0|d)<(0|x)))break}}if(1<=(0|(g=0|pi[c[c[y>>2]+36>>2]](y))))for(A=0;;){b=0|pi[c[c[y>>2]+40>>2]](y,A),f=c[b+840>>2],d=c[b+836>>2];e:{if(2==c[d+220>>2]||!d){if(!f)break e;if(2==c[f+220>>2])break e}if(2&(m=c[d+204>>2])&&(4&m||2!=c[d+220>>2]&&(3&p[f+204|0]||(4!=(-2&c[f+220>>2])&&(c[f+220>>2]=1),c[f+224>>2]=0))),2&(v=c[f+204>>2])&&(4&v|3&m||2!=c[f+220>>2]&&(4!=(-2&c[d+220>>2])&&(c[d+220>>2]=1),c[d+224>>2]=0)),p[n+64|0]&&0|pi[c[c[y>>2]+28>>2]](y,d,f)){if((0|(m=c[n+28>>2]))==c[n+32>>2]&&!((0|(x=m?m<<1:1))<=(0|m))){if(v=0,x&&(c[5498]=c[5498]+1,(f=M(19+(x<<2)|0))&&(c[(v=f+19&-16)-4>>2]=f)),1<=(0|m))for(d=0,f=m;c[d+v>>2]=c[c[n+36>>2]+d>>2],d=d+4|0,f=f-1|0;);(f=c[n+36>>2])&&p[n+40|0]&&(c[5499]=c[5499]+1,z(c[f-4>>2]),m=c[n+28>>2]),c[n+36>>2]=v,a[n+40|0]=1,c[n+32>>2]=x}c[n+28>>2]=m+1,c[c[n+36>>2]+(m<<2)>>2]=b}}if((0|g)==(0|(A=A+1|0)))break}if(p[n+64|0]){if(b=c[n+8>>2],2<=(0|(C=c[n+28>>2]))&&function e(t,n,i){for(var o,a,r,s=0,l=0,_=0,u=0,h=0,f=0,p=0;;){for(l=c[t+12>>2],o=c[l+(((a=n)+i|0)/2<<2)>>2],s=i;;){if(h=(0|(p=c[c[o+836>>2]+208>>2]))<0)for(_=n-1|0,u=((n<<2)+l|0)-4|0,r=c[c[o+840>>2]+208>>2];_=_+1|0,f=c[(u=u+4|0)>>2],(0|(n=(0|(n=c[c[f+836>>2]+208>>2]))<=-1?c[c[f+840>>2]+208>>2]:n))<(0|r););else for(_=n-1|0,u=((n<<2)+l|0)-4|0;_=_+1|0,f=c[(u=u+4|0)>>2],(0|(n=(0|(n=c[c[f+836>>2]+208>>2]))<=-1?c[c[f+840>>2]+208>>2]:n))<(0|p););for(h?(n=s+1|0,h=(s<<2)+l|0,p=c[c[o+840>>2]+208>>2]):(n=s+1|0,h=(s<<2)+l|0);l=c[h>>2],h=h-4|0,n=n-1|0,(0|p)<(0|(s=(0|(s=c[c[l+836>>2]+208>>2]))<=-1?c[c[l+840>>2]+208>>2]:s)););if(!((0|(n=(0|n)<(0|_)?(s=n,_):(c[u>>2]=l,c[c[t+12>>2]+(n<<2)>>2]=f,s=n-1|0,_+1|0)))<=(0|s)))break;l=c[t+12>>2]}if((0|a)<(0|s)&&e(t,a,s),!((0|n)<(0|i)))break}}(n+24|0,0,C-1|0),!((0|b)<1))for(y=v=0,x=1;;){A=c[n+16>>2],E=c[A+(v<<3)>>2],T=1;e:if(!((0|b)<=(0|v)))for(f=c[n+52>>2],d=c[n+48>>2];;){if(S=c[c[e+16>>2]+(c[4+((v<<3)+A|0)>>2]<<2)>>2],(0|f)==(0|d))if((0|(m=f?f<<1:1))<=(0|f))m=f;else{if(g=0,m&&(c[5498]=c[5498]+1,(d=M(19+(m<<2)|0))&&(c[(g=d+19&-16)-4>>2]=d)),1<=(0|f))for(d=0,A=f;c[d+g>>2]=c[c[n+56>>2]+d>>2],d=d+4|0,A=A-1|0;);(d=c[n+56>>2])&&p[n+60|0]&&(c[5499]=c[5499]+1,z(c[d-4>>2]),f=c[n+48>>2]),c[n+56>>2]=g,a[n+60|0]=1,c[n+52>>2]=m}else m=f,f=d;if(c[n+48>>2]=d=f+1|0,c[c[n+56>>2]+(f<<2)>>2]=S,T&=2==(0|(f=c[S+220>>2]))|5==(0|f),(0|b)==(0|(v=v+1|0))){v=b;break e}if(f=m,A=c[n+16>>2],(0|E)!=c[A+(v<<3)>>2])break}if(!(((f=S=0)|C)<=(0|y))&&(A=c[n+36>>2],f=c[(m=A+(g=y<<2)|0)>>2],(0|(d=c[c[f+836>>2]+208>>2]))<=-1&&(d=c[c[f+840>>2]+208>>2]),((f=0)|d)==(0|E))){for(S=(f=(0|(f=y+1|0))<(0|C)?C:f)-1|0,d=4+(A+g|0)|0,x=y;;){if((0|x)!=(0|S)){if(g=c[d>>2],x=x+1|0,d=d+4|0,(0|(A=(0|(A=c[c[g+836>>2]+208>>2]))<=-1?c[c[g+840>>2]+208>>2]:A))==(0|E))continue}else x=f;break}S=x-y|0,f=m}if(T||pi[c[c[o>>2]+8>>2]](o,c[n+56>>2],c[n+48>>2],f,S,E),(0|(d=c[n+48>>2]))<=-1)for(c[n+52>>2]<=-1&&((f=c[n+56>>2])&&p[n+60|0]&&(c[5499]=c[5499]+1,z(c[f-4>>2])),a[n+60|0]=1,c[n+52>>2]=0,c[n+56>>2]=0),A=d<<2;A=A+4|(c[c[n+56>>2]+A>>2]=0),(f=d)>>>0<=(d=f+1|0)>>>0;);if(y=S?x:y,!(((c[n+48>>2]=0)|v)<(0|b)))break}}else f=0|pi[c[c[y>>2]+44>>2]](y),d=0|pi[c[c[y>>2]+36>>2]](y),pi[c[c[o>>2]+8>>2]](o,c[e+16>>2],c[e+8>>2],f,d,-1);$n(c[e+212>>2]),f=c[e+216>>2],pi[c[c[f>>2]+16>>2]](f,t,c[e+72>>2]),N=16+h|0},function(e,t){e|=0,t=x(t),x(0);var n,i,o,a,r,s=0,l=0,_=0,u=0;if(1<=(0|(l=c[e+248>>2])))for(r=p[23468];;){e:if(n=c[c[e+256>>2]+_>>2]){t:{n:{switch((s=c[n+220>>2])-2|0){case 0:case 2:break n}if(i=A[n+372>>2],o=x(i*i),i=A[n+376>>2],o=x(o+x(i*i)),i=A[n+380>>2],o=x(o+x(i*i)),i=A[n+532>>2],o<x(i*i)&&(i=A[n+388>>2],o=x(i*i),i=A[n+392>>2],o=x(o+x(i*i)),i=A[n+396>>2],o=x(o+x(i*i)),i=A[n+536>>2],o<x(i*i))){A[n+224>>2]=A[n+224>>2]+t;break t}if(c[n+224>>2]=0,4==(-2&s))break t;c[n+220>>2]=s=0;break t}if(4==(0|s))break e}a=-2&s;t:{n:if(!r){i:{if(2!=(0|a)){if(!(A[n+224>>2]>x(2)))break n;if(3&p[n+204|0]){if(4==(0|a))break e;break t}if(1!=(0|s))break i;c[n+220>>2]=3;break e}if(3&p[n+204|0])break t}if(2!=(0|s))break e;c[n+388>>2]=0,c[n+392>>2]=0,c[n+372>>2]=0,c[n+376>>2]=0,c[(s=n+396|0)>>2]=0,c[s+4>>2]=0,c[(s=n+380|0)>>2]=0,c[s+4>>2]=0,c[n+304>>2]=c[n+304>>2]+2,l=c[e+248>>2];break e}if(4==(0|a))break e;c[n+220>>2]=1;break e}c[n+220>>2]=2}if(_=_+4|0,!((0|(u=u+1|0))<(0|l)))break}},function(e,t){e|=0,t=x(t);var n,i,o,a=0,r=0;if((a=c[e+84>>2])&&pi[0|a](e,t),pi[c[c[e>>2]+140>>2]](e,t),c[e+32>>2]=a=0,A[e+28>>2]=t,i=e+48|0,o=0|pi[c[c[e>>2]+20>>2]](e),c[i>>2]=o,pi[c[c[e>>2]+164>>2]](e,t),pi[c[c[e>>2]+44>>2]](e),pi[c[c[e>>2]+148>>2]](e),A[e+104>>2]=t,pi[c[c[e>>2]+152>>2]](e,e+92|0),pi[c[c[e>>2]+144>>2]](e,t),1<=c[e+296>>2])for(;n=c[c[e+304>>2]+a>>2],pi[c[c[n>>2]+8>>2]](n,e,t),a=a+4|0,(0|(r=r+1|0))<c[e+296>>2];);pi[c[c[e>>2]+156>>2]](e,t),(a=c[e+80>>2])&&pi[0|a](e,t)},function(e,t){e|=0,t=x(t);var n,i,o,r,s,l,_,u,h,f,d,m,v,y,b,E,T,P,w,I,R,D,O,L,F,B,k,U,G,j,V,H,W,q,Y,X,Q=0,Z=0,J=0,K=0,$=0,ee=0,te=0;if(N=X=N-512|0,1<=c[e+324>>2])for(;$=c[e+24>>2],pi[c[c[$>>2]+16>>2]]($,c[c[e+332>>2]+ee>>2]),ee=ee+4|0,(0|(Z=Z+1|0))<c[e+324>>2];);if(($=c[e+332>>2])&&p[e+336|0]&&(c[5499]=c[5499]+1,z(c[$-4>>2])),c[e+332>>2]=0,c[e+324>>2]=0,c[e+328>>2]=0,(a[e+336|0]=1)<=(0|(O=c[e+248>>2])))for(Y=c[e+256>>2],_=124+X|0,v=92+X|0,y=72+X|0,$=392+X|0,b=264+X|0,E=248+X|0,T=232+X|0,f=312+X|0,P=376+X|0,w=360+X|0,h=496+X|0,ee=0;;){n=c[(ee<<2)+Y>>2],c[n+268>>2]=1065353216;e:{switch(c[n+220>>2]-2|0){case 0:case 3:break e}if(!(3&p[n+204|0])&&(Bn(r=n+4|0,A[n+372>>2],A[n+376>>2],A[n+380>>2],n+388|0,t,448+X|0),p[e+44|0]&&(i=A[n+276>>2],(s=x(i*i))!=x(0)&&(d=A[496+X>>2],i=x(d-A[(u=n+52|0)>>2]),o=x(i*i),m=A[500+X>>2],i=x(m-A[n+56>>2]),l=x(o+x(i*i)),o=A[504+X>>2],i=x(o-A[n+60>>2]),s<x(l+x(i*i))&&!(19<c[c[n+192>>2]+4>>2])&&(c[6039]=c[6039]+1,Q=c[e+68>>2],K=0|pi[c[c[Q>>2]+36>>2]](Q),Q=c[4+u>>2],c[w>>2]=c[u>>2],c[4+w>>2]=Q,Q=c[4+(Z=I=8+u|0)>>2],c[(J=8+w|0)>>2]=c[Z>>2],c[J+4>>2]=Q,Q=c[4+h>>2],c[P>>2]=c[h>>2],c[4+P>>2]=Q,Q=c[4+(J=8+h|0)>>2],c[(Z=8+P|0)>>2]=c[J>>2],c[Z+4>>2]=Q,c[348+X>>2]=1065353216,c[344+X>>2]=20112,c[424+X>>2]=0,c[440+X>>2]=c[e+24>>2],c[436+X>>2]=K,c[428+X>>2]=n,c[f>>2]=0,c[4+f>>2]=0,c[(Q=8+f|0)>>2]=0,c[Q+4>>2]=0,c[16+f>>2]=0,c[292+X>>2]=0,c[296+X>>2]=0,c[308+X>>2]=1065353216,c[300+X>>2]=1065353216,c[304+X>>2]=1065353216,c[284+X>>2]=8,c[288+X>>2]=0,c[280+X>>2]=11936,c[336+X>>2]=0,i=A[n+272>>2],A[316+X>>2]=i,A[332+X>>2]=i,A[432+X>>2]=A[e+56>>2],Q=c[n+188>>2],c[352+X>>2]=c[Q+4>>2],c[356+X>>2]=c[Q+8>>2],Q=c[J+4>>2],c[(Z=8+b|0)>>2]=c[J>>2],c[Z+4>>2]=Q,Q=c[4+h>>2],c[b>>2]=c[h>>2],c[4+b>>2]=Q,Q=c[4+(Z=8+r|0)>>2],c[(J=224+X|0)>>2]=c[Z>>2],c[J+4>>2]=Q,Q=c[4+(Z=n+20|0)>>2],c[T>>2]=c[Z>>2],c[4+T>>2]=Q,Q=c[4+(Z=n+28|0)>>2],c[(J=8+T|0)>>2]=c[Z>>2],c[J+4>>2]=Q,Q=c[4+(Z=n+36|0)>>2],c[E>>2]=c[Z>>2],c[4+E>>2]=Q,Q=c[4+(Z=n+44|0)>>2],c[(J=8+E|0)>>2]=c[Z>>2],c[J+4>>2]=Q,Q=c[4+r>>2],c[216+X>>2]=c[r>>2],c[220+X>>2]=Q,Zn(e,280+X|0,r,216+X|0,344+X|0,x(0)),(i=A[348+X>>2])<x(1)))))){if(L=x(i*x(m-A[n+56>>2])),l=x(i*x(d-A[n+52>>2])),F=x(i*x(o-A[n+60>>2])),s=x(x(x(L*x(-A[396+X>>2]))-x(l*A[392+X>>2]))-x(F*A[400+X>>2])),Q=c[e+24>>2],r=0|pi[c[c[Q>>2]+12>>2]](Q,n,c[424+X>>2]),(0|(Z=c[e+324>>2]))==c[e+328>>2]&&!((0|(K=Z?Z<<1:1))<=(0|Z))){if(J=0,K&&(c[5498]=c[5498]+1,(Q=M(19+(K<<2)|0))&&(c[(J=Q+19&-16)-4>>2]=Q)),1<=(0|Z))for(te=0,Q=Z;c[J+te>>2]=c[c[e+332>>2]+te>>2],te=te+4|0,Q=Q-1|0;);(Q=c[e+332>>2])&&p[e+336|0]&&(c[5499]=c[5499]+1,z(c[Q-4>>2]),Z=c[e+324>>2]),c[e+332>>2]=J,a[e+336|0]=1,c[e+328>>2]=K}c[c[e+332>>2]+(Z<<2)>>2]=r,c[e+324>>2]=Z+1,Q=c[424+X>>2],B=A[Q+20>>2],k=A[Q+36>>2],U=A[Q+40>>2],G=A[Q+8>>2],j=A[Q+24>>2],R=A[Q+60>>2],d=A[Q+56>>2],D=A[Q+52>>2],V=A[Q+44>>2],H=A[Q+12>>2],W=A[Q+28>>2],q=A[Q+4>>2],m=A[n+60>>2],o=A[n+52>>2],i=A[n+56>>2],c[(Q=16+X|0)>>2]=0,c[Q+4>>2]=0,c[v>>2]=0,c[4+v>>2]=0,c[(Q=8+v|0)>>2]=0,c[Q+4>>2]=0,c[_>>2]=0,c[4+_>>2]=0,c[(Q=8+_|0)>>2]=0,c[Q+4>>2]=0,c[(Q=16+_|0)>>2]=0,c[Q+4>>2]=0,c[(Q=24+_|0)>>2]=0,c[Q+4>>2]=0,c[(Q=32+_|0)>>2]=0,c[Q+4>>2]=0,c[(Q=40+_|0)>>2]=0,c[Q+4>>2]=0,c[48+_>>2]=0,Q=c[$+4>>2],c[y>>2]=c[$>>2],c[4+y>>2]=Q,Q=c[4+(Z=$+8|0)>>2],c[(J=8+y|0)>>2]=c[Z>>2],c[J+4>>2]=Q,c[8+X>>2]=0,c[12+X>>2]=0,c[36+X>>2]=0,A[88+X>>2]=s,l=x(l+o),s=x(L+i),o=x(F+m),i=x(-d),A[32+X>>2]=x(x(x(H*l)+x(W*s))+x(V*o))+x(x(x(W*i)-x(H*D))-x(V*R)),A[28+X>>2]=x(x(x(l*G)+x(s*j))+x(o*U))+x(x(x(j*i)-x(G*D))-x(U*R)),A[24+X>>2]=x(x(x(l*q)+x(s*B))+x(o*k))+x(x(x(B*i)-x(q*D))-x(k*R)),K=g(Ft(r,8+X|0),208)+r|0,c[K+100>>2]=0,A[K+88>>2]=S(x(C(x(A[n+228>>2]*A[c[424+X>>2]+228>>2]),x(-10))),x(10)),Q=c[4+I>>2],c[(Z=K+60|0)>>2]=c[I>>2],c[Z+4>>2]=Q,J=c[4+u>>2],Z=c[u>>2],c[K+48>>2]=0,A[K+44>>2]=o,A[K+40>>2]=s,c[(Q=K+52|0)>>2]=Z,c[Q+4>>2]=J,A[K+36>>2]=l}}if((0|O)==(0|(ee=ee+1|0)))break}N=512+X|0},function(e,t){e|=0,t=x(t);var n,i,o,a,r,s,l,_,u,h,f=0,d=0,m=0,v=0,g=0;if(N=h=N-32|0,1<=(0|(m=c[e+8>>2])))for(o=x(x(1)/t),d=m;(f=c[c[e+16>>2]+v>>2])&&2&c[f+252>>2]&&2!=c[f+220>>2]&&(d=(a=2&p[f+204|0])?m:d,a&&t!=x(0)&&((d=c[f+540>>2])&&pi[c[c[d>>2]+8>>2]](d,f+4|0),c[f+384>>2]=0,A[(d=f+380|0)>>2]=o*x(A[(m=f+60|0)>>2]-A[(a=f+124|0)>>2]),A[f+376>>2]=o*x(A[f+56>>2]-A[f+120>>2]),A[(n=f+372|0)>>2]=o*x(A[(r=f+52|0)>>2]-A[(s=f+116|0)>>2]),In(f+68|0,f+4|0,16+h|0,12+h|0),c[f+400>>2]=0,_=A[12+h>>2],A[(i=f+396|0)>>2]=o*x(_*A[24+h>>2]),A[f+392>>2]=o*x(_*A[20+h>>2]),A[(l=f+388|0)>>2]=o*x(_*A[16+h>>2]),u=c[d+4>>2],c[(_=f+140|0)>>2]=c[d>>2],c[4+_>>2]=u,d=c[4+n>>2],c[f+132>>2]=c[n>>2],c[f+136>>2]=d,d=c[4+l>>2],c[f+148>>2]=c[l>>2],c[f+152>>2]=d,n=c[4+i>>2],c[(d=f+156|0)>>2]=c[i>>2],c[d+4>>2]=n,d=c[f+8>>2],c[f+68>>2]=c[f+4>>2],c[f+72>>2]=d,i=c[4+(n=f+12|0)>>2],c[(d=f+76|0)>>2]=c[n>>2],c[d+4>>2]=i,i=c[4+(n=f+20|0)>>2],c[(d=f+84|0)>>2]=c[n>>2],c[d+4>>2]=i,i=c[4+(n=f+28|0)>>2],c[(d=f+92|0)>>2]=c[n>>2],c[d+4>>2]=i,i=c[4+(n=f+44|0)>>2],c[(d=f+108|0)>>2]=c[n>>2],c[d+4>>2]=i,d=f+100|0,n=c[4+(f=f+36|0)>>2],c[d>>2]=c[f>>2],c[d+4>>2]=n,d=c[m+4>>2],c[a>>2]=c[m>>2],c[4+a>>2]=d,d=c[4+r>>2],c[s>>2]=c[r>>2],c[4+s>>2]=d,d=m=c[e+8>>2])),v=v+4|0,(0|(g=g+1|0))<(0|d););N=32+h|0},function(e,t){e|=0,t|=0;var n,i,o=0,a=0,r=0,s=x(0),l=x(0),_=0,u=x(0),h=x(0),f=x(0),d=x(0),m=0,v=x(0),g=x(0),b=x(0),S=x(0),C=0,E=0,P=x(0),w=x(0),I=x(0),R=0,D=x(0),O=x(0),M=x(0),z=x(0),L=x(0),F=x(0),B=0,k=0,U=x(0),G=x(0),j=0,V=0,H=x(0),W=x(0),q=x(0),Y=0,X=x(0),Q=x(0),Z=x(0),J=x(0),K=0;N=i=N-176|0,o=0|pi[c[c[e>>2]+20>>2]](e),o=0|pi[c[c[o>>2]+56>>2]](o),r=0|pi[c[c[e>>2]+20>>2]](e),r=0|pi[c[c[r>>2]+56>>2]](r);e:if(!((n=A[t+40>>2])<=x(0))){a=2048&o,m=4096&r;t:switch(c[t+4>>2]-3|0){case 0:if(c[(r=172+i|0)>>2]=0,c[(o=_=164+i|0)>>2]=0,c[o+4>>2]=0,c[(o=156+i|0)>>2]=0,c[o+4>>2]=0,c[(o=124+i|0)>>2]=0,c[o+4>>2]=0,c[(o=136+i|0)>>2]=0,c[o+4>>2]=0,c[132+i>>2]=1065353216,c[(o=144+i|0)>>2]=0,c[o+4>>2]=0,c[152+i>>2]=1065353216,c[116+i>>2]=0,c[120+i>>2]=0,c[112+i>>2]=1065353216,o=c[t+28>>2],h=A[o+52>>2],f=A[o+8>>2],d=A[o+12>>2],v=A[o+56>>2],g=A[o+28>>2],b=A[o+20>>2],S=A[o+24>>2],s=A[o+60>>2],u=A[o+44>>2],l=A[o+36>>2],P=A[o+40>>2],w=A[o+4>>2],R=168+i|(c[r>>2]=0),X=s,s=A[t+300>>2],Q=x(l*s),l=A[t+304>>2],Z=u,u=A[t+308>>2],A[R>>2]=X+x(x(Q+x(P*l))+x(Z*u)),A[_>>2]=v+x(x(x(s*b)+x(l*S))+x(u*g)),A[160+i>>2]=h+x(x(x(s*w)+x(l*f))+x(u*d)),o=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[o>>2]+64>>2]](o,112+i|0,n),o=c[t+32>>2],h=A[o+52>>2],f=A[o+8>>2],d=A[o+12>>2],v=A[o+56>>2],g=A[o+28>>2],b=A[o+20>>2],S=A[o+24>>2],s=A[o+60>>2],u=A[o+44>>2],l=A[o+36>>2],P=A[o+40>>2],w=A[o+4>>2],c[r>>2]=0,X=s,s=A[t+316>>2],Q=x(l*s),l=A[t+320>>2],Z=u,u=A[t+324>>2],A[R>>2]=X+x(x(Q+x(P*l))+x(Z*u)),A[_>>2]=v+x(x(x(s*b)+x(l*S))+x(u*g)),A[160+i>>2]=h+x(x(x(s*w)+x(l*f))+x(u*d)),!a)break e;e=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[e>>2]+64>>2]](e,112+i|0,n);break e;case 1:if(o=c[t+28>>2],H=A[o+52>>2],s=A[o+8>>2],l=A[o+12>>2],S=A[t+584>>2],P=A[t+552>>2],w=A[t+568>>2],W=A[o+56>>2],q=A[o+60>>2],z=A[t+608>>2],L=A[t+600>>2],I=A[t+604>>2],u=A[o+28>>2],h=A[o+20>>2],f=A[o+24>>2],F=A[t+588>>2],U=A[t+556>>2],D=A[t+572>>2],O=A[t+592>>2],d=A[o+44>>2],M=A[t+560>>2],v=A[o+36>>2],G=A[t+576>>2],g=A[o+40>>2],b=A[o+4>>2],c[172+i>>2]=0,c[156+i>>2]=0,c[140+i>>2]=0,A[152+i>>2]=x(x(M*v)+x(G*g))+x(O*d),A[148+i>>2]=x(x(U*v)+x(D*g))+x(F*d),A[136+i>>2]=x(x(M*h)+x(G*f))+x(O*u),A[132+i>>2]=x(x(U*h)+x(D*f))+x(F*u),A[168+i>>2]=q+x(x(x(v*L)+x(g*I))+x(d*z)),A[164+i>>2]=W+x(x(x(h*L)+x(f*I))+x(u*z)),c[124+i>>2]=0,A[144+i>>2]=x(x(P*v)+x(w*g))+x(S*d),A[128+i>>2]=x(x(P*h)+x(w*f))+x(S*u),A[120+i>>2]=x(x(b*M)+x(s*G))+x(l*O),A[116+i>>2]=x(x(b*U)+x(s*D))+x(l*F),A[112+i>>2]=x(x(P*b)+x(w*s))+x(S*l),A[160+i>>2]=H+x(x(x(b*L)+x(s*I))+x(l*z)),a?(o=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[o>>2]+64>>2]](o,112+i|0,n),o=c[t+32>>2],H=A[o+52>>2],s=A[o+8>>2],l=A[o+12>>2],W=A[o+56>>2],q=A[o+60>>2],S=A[t+672>>2],P=A[t+664>>2],w=A[t+668>>2],u=A[o+28>>2],h=A[o+20>>2],f=A[o+24>>2],z=A[t+648>>2],L=A[t+616>>2],I=A[t+632>>2],F=A[t+652>>2],U=A[t+620>>2],D=A[t+636>>2],O=A[t+656>>2],d=A[o+44>>2],M=A[t+624>>2],v=A[o+36>>2],G=A[t+640>>2],g=A[o+40>>2],b=A[o+4>>2],c[172+i>>2]=0,c[156+i>>2]=0,c[140+i>>2]=0,A[152+i>>2]=x(x(M*v)+x(G*g))+x(O*d),A[148+i>>2]=x(x(U*v)+x(D*g))+x(F*d),A[144+i>>2]=x(x(L*v)+x(I*g))+x(z*d),A[136+i>>2]=x(x(M*h)+x(G*f))+x(O*u),A[132+i>>2]=x(x(U*h)+x(D*f))+x(F*u),A[168+i>>2]=q+x(x(x(v*P)+x(g*w))+x(d*S)),A[164+i>>2]=W+x(x(x(h*P)+x(f*w))+x(u*S)),A[160+i>>2]=H+x(x(x(b*P)+x(s*w))+x(l*S)),c[124+i>>2]=0,A[128+i>>2]=x(x(L*h)+x(I*f))+x(z*u),A[120+i>>2]=x(x(b*M)+x(s*G))+x(l*O),A[116+i>>2]=x(x(b*U)+x(s*D))+x(l*F),A[112+i>>2]=x(x(L*b)+x(I*s))+x(z*l),o=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[o>>2]+64>>2]](o,112+i|0,n)):(o=c[t+32>>2],H=A[o+52>>2],W=A[o+56>>2],q=A[o+60>>2],S=A[t+672>>2],P=A[t+664>>2],w=A[t+668>>2],s=A[o+8>>2],l=A[o+12>>2],u=A[o+28>>2],h=A[o+20>>2],f=A[o+24>>2],z=A[t+648>>2],L=A[t+616>>2],I=A[t+632>>2],F=A[t+652>>2],U=A[t+620>>2],D=A[t+636>>2],O=A[t+656>>2],d=A[o+44>>2],M=A[t+624>>2],v=A[o+36>>2],G=A[t+640>>2],g=A[o+40>>2],b=A[o+4>>2],c[172+i>>2]=0,c[156+i>>2]=0,c[140+i>>2]=0,c[124+i>>2]=0,A[152+i>>2]=x(x(M*v)+x(G*g))+x(O*d),A[148+i>>2]=x(x(U*v)+x(D*g))+x(F*d),A[144+i>>2]=x(x(L*v)+x(I*g))+x(z*d),A[136+i>>2]=x(x(M*h)+x(G*f))+x(O*u),A[132+i>>2]=x(x(U*h)+x(D*f))+x(F*u),A[128+i>>2]=x(x(L*h)+x(I*f))+x(z*u),A[120+i>>2]=x(x(b*M)+x(s*G))+x(l*O),A[116+i>>2]=x(x(b*U)+x(s*D))+x(l*F),A[112+i>>2]=x(x(L*b)+x(I*s))+x(z*l),A[168+i>>2]=q+x(x(x(v*P)+x(g*w))+x(d*S)),A[164+i>>2]=W+x(x(x(h*P)+x(f*w))+x(u*S)),A[160+i>>2]=H+x(x(x(b*P)+x(s*w))+x(l*S))),s=A[t+688>>2],u=A[t+692>>2],(l=me(x(s-u)))<x(-3.1415927410125732)?l=x(l+x(6.2831854820251465)):l>x(3.1415927410125732)&&(l=x(l+x(-6.2831854820251465))),(s=me(x(s+u)))<x(-3.1415927410125732)?s=x(s+x(6.2831854820251465)):s>x(3.1415927410125732)&&(s=x(s+x(-6.2831854820251465))),s==l)break e;if(!m)break e;A[96+i>>2]=A[120+i>>2],A[100+i>>2]=A[136+i>>2],c[108+i>>2]=0,A[104+i>>2]=A[152+i>>2],A[80+i>>2]=A[112+i>>2],A[84+i>>2]=A[128+i>>2],c[92+i>>2]=0,A[88+i>>2]=A[144+i>>2],e=0|pi[c[c[e>>2]+20>>2]](e),c[(t=72+i|0)>>2]=0,c[t+4>>2]=0,c[64+i>>2]=0,c[68+i>>2]=0,t=u>x(0),pi[c[c[e>>2]+68>>2]](e,160+i|0,96+i|0,80+i|0,n,n,t?l:x(0),t?s:x(6.2831854820251465),i+64|0,t,x(10));break e;case 2:if(o=c[t+28>>2],H=A[o+52>>2],s=A[o+8>>2],l=A[o+12>>2],S=A[t+332>>2],P=A[t+300>>2],w=A[t+316>>2],W=A[o+56>>2],q=A[o+60>>2],z=A[t+356>>2],L=A[t+348>>2],I=A[t+352>>2],u=A[o+28>>2],h=A[o+20>>2],f=A[o+24>>2],F=A[t+336>>2],U=A[t+304>>2],D=A[t+320>>2],O=A[t+340>>2],d=A[o+44>>2],M=A[t+308>>2],v=A[o+36>>2],G=A[t+324>>2],g=A[o+40>>2],b=A[o+4>>2],c[172+i>>2]=0,c[156+i>>2]=0,c[140+i>>2]=0,A[152+i>>2]=x(x(M*v)+x(G*g))+x(O*d),A[148+i>>2]=x(x(U*v)+x(D*g))+x(F*d),A[136+i>>2]=x(x(M*h)+x(G*f))+x(O*u),A[132+i>>2]=x(x(U*h)+x(D*f))+x(F*u),A[168+i>>2]=q+x(x(x(v*L)+x(g*I))+x(d*z)),A[164+i>>2]=W+x(x(x(h*L)+x(f*I))+x(u*z)),c[124+i>>2]=0,A[144+i>>2]=x(x(P*v)+x(w*g))+x(S*d),A[128+i>>2]=x(x(P*h)+x(w*f))+x(S*u),A[120+i>>2]=x(x(b*M)+x(s*G))+x(l*O),A[116+i>>2]=x(x(b*U)+x(s*D))+x(l*F),A[112+i>>2]=x(x(P*b)+x(w*s))+x(S*l),A[160+i>>2]=H+x(x(x(b*L)+x(s*I))+x(l*z)),a?(o=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[o>>2]+64>>2]](o,112+i|0,n),o=c[t+32>>2],H=A[o+52>>2],s=A[o+8>>2],l=A[o+12>>2],W=A[o+56>>2],q=A[o+60>>2],S=A[t+420>>2],P=A[t+412>>2],w=A[t+416>>2],u=A[o+28>>2],h=A[o+20>>2],f=A[o+24>>2],z=A[t+396>>2],L=A[t+364>>2],I=A[t+380>>2],F=A[t+400>>2],U=A[t+368>>2],D=A[t+384>>2],O=A[t+404>>2],d=A[o+44>>2],M=A[t+372>>2],v=A[o+36>>2],G=A[t+388>>2],g=A[o+40>>2],b=A[o+4>>2],c[172+i>>2]=0,c[156+i>>2]=0,c[140+i>>2]=0,A[152+i>>2]=x(x(M*v)+x(G*g))+x(O*d),A[148+i>>2]=x(x(U*v)+x(D*g))+x(F*d),A[144+i>>2]=x(x(L*v)+x(I*g))+x(z*d),A[136+i>>2]=x(x(M*h)+x(G*f))+x(O*u),A[132+i>>2]=x(x(U*h)+x(D*f))+x(F*u),A[168+i>>2]=q+x(x(x(v*P)+x(g*w))+x(d*S)),A[164+i>>2]=W+x(x(x(h*P)+x(f*w))+x(u*S)),A[160+i>>2]=H+x(x(x(b*P)+x(s*w))+x(l*S)),c[124+i>>2]=0,A[128+i>>2]=x(x(L*h)+x(I*f))+x(z*u),A[120+i>>2]=x(x(b*M)+x(s*G))+x(l*O),A[116+i>>2]=x(x(b*U)+x(s*D))+x(l*F),A[112+i>>2]=x(x(L*b)+x(I*s))+x(z*l),o=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[o>>2]+64>>2]](o,112+i|0,n)):(o=c[t+32>>2],H=A[o+52>>2],W=A[o+56>>2],q=A[o+60>>2],S=A[t+420>>2],P=A[t+412>>2],w=A[t+416>>2],s=A[o+8>>2],l=A[o+12>>2],u=A[o+28>>2],h=A[o+20>>2],f=A[o+24>>2],z=A[t+396>>2],L=A[t+364>>2],I=A[t+380>>2],F=A[t+400>>2],U=A[t+368>>2],D=A[t+384>>2],O=A[t+404>>2],d=A[o+44>>2],M=A[t+372>>2],v=A[o+36>>2],G=A[t+388>>2],g=A[o+40>>2],b=A[o+4>>2],c[172+i>>2]=0,c[156+i>>2]=0,c[140+i>>2]=0,c[124+i>>2]=0,A[152+i>>2]=x(x(M*v)+x(G*g))+x(O*d),A[148+i>>2]=x(x(U*v)+x(D*g))+x(F*d),A[144+i>>2]=x(x(L*v)+x(I*g))+x(z*d),A[136+i>>2]=x(x(M*h)+x(G*f))+x(O*u),A[132+i>>2]=x(x(U*h)+x(D*f))+x(F*u),A[128+i>>2]=x(x(L*h)+x(I*f))+x(z*u),A[120+i>>2]=x(x(b*M)+x(s*G))+x(l*O),A[116+i>>2]=x(x(b*U)+x(s*D))+x(l*F),A[112+i>>2]=x(x(L*b)+x(I*s))+x(z*l),A[168+i>>2]=q+x(x(x(v*P)+x(g*w))+x(d*S)),A[164+i>>2]=W+x(x(x(h*P)+x(f*w))+x(u*S)),A[160+i>>2]=H+x(x(x(b*P)+x(s*w))+x(l*S))),!m)break e;for(c[108+i>>2]=0,s=A[t+444>>2],g=x(x(.0395662896335125)/x(s*s)),s=A[t+448>>2],s=pe(l=x(x(T(x(x(1.0395662784576416)/x(g+x(x(1)/x(s*s))))))*x(.5))),h=x(fe(l)/x(.9999999403953552)),l=x(h*x(.9807851910591125)),g=x(s*x(0)),u=x(h*x(0)),b=x(u*x(0)),f=x(x(g+b)-x(l*n)),v=x(l*x(0)),h=x(h*x(.19509069621562958)),S=x(h*x(0)),d=x(x(x(s*n)+v)-S),v=x(x(x(n*x(-u))-v)-S),g=x(x(g+x(h*n))-b),b=x(x(l*f)+x(x(x(s*d)-x(u*v))-x(h*g))),S=x(x(h*d)+x(x(x(s*g)-x(l*v))-x(u*f))),s=x(x(u*g)+x(x(x(s*f)-x(h*v))-x(l*d))),A[104+i>>2]=x(x(x(b*A[144+i>>2])+x(S*A[148+i>>2]))+x(s*A[152+i>>2]))+A[168+i>>2],A[100+i>>2]=x(x(x(b*A[128+i>>2])+x(S*A[132+i>>2]))+x(s*A[136+i>>2]))+A[164+i>>2],A[96+i>>2]=x(x(x(b*A[112+i>>2])+x(S*A[116+i>>2]))+x(s*A[120+i>>2]))+A[160+i>>2],r=160+i|0,_=72+i|0,o=0;l=pe(u=x(x(x(0|o)*x(6.283185005187988))*x(.03125))),s=A[t+444>>2],f=fe(u),x(y(l))>x(1.1920928955078125e-7)?(u=x(f*f),h=x(l*l),d=x(u/h),g=x(d/x(s*s)),s=A[t+448>>2],s=x(T(x(x(d+x(1))/x(g+x(x(1)/x(s*s))))))):(u=x(f*f),h=x(l*l)),c[92+i>>2]=0,g=l,l=x(s*x(.5)),h=x(fe(l)/x(T(x(u+x(h+x(0)))))),s=x(g*h),l=pe(l),g=x(l*x(0)),u=x(h*x(0)),b=x(u*x(0)),d=x(x(g+b)-x(s*n)),v=x(s*x(0)),h=x(h*x(-f)),S=x(h*x(0)),f=x(x(x(l*n)+v)-S),v=x(x(x(n*x(-u))-v)-S),g=x(x(g+x(h*n))-b),b=x(x(s*d)+x(x(x(l*f)-x(u*v))-x(h*g))),S=x(x(h*f)+x(x(x(l*g)-x(s*v))-x(u*d))),s=x(x(u*g)+x(x(x(l*d)-x(h*v))-x(s*f))),A[88+i>>2]=x(x(x(b*A[144+i>>2])+x(S*A[148+i>>2]))+x(s*A[152+i>>2]))+A[168+i>>2],A[84+i>>2]=x(x(x(b*A[128+i>>2])+x(S*A[132+i>>2]))+x(s*A[136+i>>2]))+A[164+i>>2],A[80+i>>2]=x(x(x(b*A[112+i>>2])+x(S*A[116+i>>2]))+x(s*A[120+i>>2]))+A[160+i>>2],a=0|pi[c[c[e>>2]+20>>2]](e),c[_>>2]=0,c[_+4>>2]=0,c[64+i>>2]=0,c[68+i>>2]=0,pi[c[c[a>>2]+16>>2]](a,96+i|0,80+i|0,i+64|0),3&o||(a=0|pi[c[c[e>>2]+20>>2]](e),c[_>>2]=0,c[_+4>>2]=0,c[64+i>>2]=0,c[68+i>>2]=0,pi[c[c[a>>2]+16>>2]](a,r,80+i|0,i+64|0)),j=c[4+(R=88+i|0)>>2],c[(a=104+i|0)>>2]=c[R>>2],c[a+4>>2]=j,a=c[84+i>>2],c[96+i>>2]=c[80+i>>2],c[100+i>>2]=a,32!=(0|(o=o+1|0)););w=A[t+512>>2],z=A[t+452>>2],o=c[t+32>>2],X=A[o+404>>2]>x(0)?(s=A[o+36>>2],u=A[t+412>>2],l=A[o+40>>2],h=A[t+416>>2],L=x(x(s*u)+x(l*h)),f=A[o+20>>2],d=A[o+24>>2],v=A[o+28>>2],I=A[t+420>>2],F=x(x(x(f*u)+x(d*h))+x(v*I)),g=A[o+4>>2],b=A[o+8>>2],S=A[o+12>>2],U=x(x(x(g*u)+x(b*h))+x(S*I)),D=A[t+372>>2],O=A[t+388>>2],M=A[t+404>>2],P=A[o+44>>2],G=x(x(x(D*s)+x(O*l))+x(M*P)),H=A[t+368>>2],W=A[t+384>>2],q=A[t+400>>2],u=x(x(x(H*s)+x(W*l))+x(q*P)),J=A[t+364>>2],Q=A[t+380>>2],A[t+396>>2]):(o=c[t+28>>2],s=A[o+36>>2],u=A[t+348>>2],l=A[o+40>>2],h=A[t+352>>2],L=x(x(s*u)+x(l*h)),f=A[o+20>>2],d=A[o+24>>2],v=A[o+28>>2],I=A[t+356>>2],F=x(x(x(f*u)+x(d*h))+x(v*I)),g=A[o+4>>2],b=A[o+8>>2],S=A[o+12>>2],U=x(x(x(g*u)+x(b*h))+x(S*I)),D=A[t+308>>2],O=A[t+324>>2],M=A[t+340>>2],P=A[o+44>>2],G=x(x(x(D*s)+x(O*l))+x(M*P)),H=A[t+304>>2],W=A[t+320>>2],q=A[t+336>>2],u=x(x(x(H*s)+x(W*l))+x(q*P)),J=A[t+300>>2],Q=A[t+316>>2],A[t+332>>2]),s=x(x(x(J*s)+x(Q*l))+x(X*P)),Z=x(x(x(D*f)+x(O*d))+x(M*v)),h=x(x(x(H*f)+x(W*d))+x(q*v)),l=x(x(x(J*f)+x(Q*d))+x(X*v)),v=x(x(x(g*D)+x(b*O))+x(S*M)),f=x(x(x(g*H)+x(b*W))+x(S*q)),d=x(x(x(J*g)+x(Q*b))+x(X*S)),g=x(P*I),c[156+i>>2]=0,A[152+i>>2]=G,A[148+i>>2]=u,A[144+i>>2]=s,c[140+i>>2]=0,A[136+i>>2]=Z,A[132+i>>2]=h,A[128+i>>2]=l,c[124+i>>2]=0,A[120+i>>2]=v,A[116+i>>2]=f,A[112+i>>2]=d,v=A[o+52>>2],b=A[o+56>>2],S=A[o+60>>2],c[172+i>>2]=0,A[168+i>>2]=S+x(L+g),A[164+i>>2]=F+b,A[160+i>>2]=v+U,_=c[4+(o=r+8|0)>>2],c[(t=88+i|0)>>2]=c[o>>2],c[t+4>>2]=_,t=c[r+4>>2],c[80+i>>2]=c[r>>2],c[84+i>>2]=t,c[76+i>>2]=0,A[72+i>>2]=s,A[68+i>>2]=l,A[64+i>>2]=d,c[60+i>>2]=0,A[56+i>>2]=u,A[52+i>>2]=h,A[48+i>>2]=f,e=0|pi[c[c[e>>2]+20>>2]](e),c[(t=40+i|0)>>2]=0,c[t+4>>2]=0,c[32+i>>2]=0,c[36+i>>2]=0,pi[c[c[e>>2]+68>>2]](e,80+i|0,i+64|0,48+i|0,n,n,x(x(-w)-z),x(z-w),32+i|0,1,x(10));break e;case 3:case 6:if(_=c[4+(r=t+1072|0)>>2],c[(o=C=120+i|0)>>2]=c[r>>2],c[o+4>>2]=_,_=c[4+(r=t+1088|0)>>2],c[(o=136+i|0)>>2]=c[r>>2],c[o+4>>2]=_,_=c[4+(r=t+1104|0)>>2],c[(o=152+i|0)>>2]=c[r>>2],c[o+4>>2]=_,_=c[4+(r=t+1120|0)>>2],c[(o=168+i|0)>>2]=c[r>>2],c[o+4>>2]=_,r=c[4+(o=R=t+1064|0)>>2],c[112+i>>2]=c[o>>2],c[116+i>>2]=r,r=c[4+(o=j=t+1080|0)>>2],c[128+i>>2]=c[o>>2],c[132+i>>2]=r,r=c[4+(o=V=t+1096|0)>>2],c[144+i>>2]=c[o>>2],c[148+i>>2]=r,r=c[4+(o=Y=t+1112|0)>>2],c[160+i>>2]=c[o>>2],c[164+i>>2]=r,o=160+i|0,r=144+i|0,_=128+i|0,a&&(a=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[a>>2]+64>>2]](a,112+i|0,n),B=c[4+(E=t+1184|0)>>2],c[(a=o+8|0)>>2]=c[E>>2],c[a+4>>2]=B,E=c[4+(a=t+1176|0)>>2],c[o>>2]=c[a>>2],c[o+4>>2]=E,E=c[4+(a=t+1144|0)>>2],c[_>>2]=c[a>>2],c[_+4>>2]=E,B=c[4+(E=t+1152|0)>>2],c[(a=_+8|0)>>2]=c[E>>2],c[a+4>>2]=B,E=c[4+(a=t+1160|0)>>2],c[r>>2]=c[a>>2],c[r+4>>2]=E,B=c[4+(E=t+1168|0)>>2],c[(a=r+8|0)>>2]=c[E>>2],c[a+4>>2]=B,E=c[4+(a=t+1136|0)>>2],c[C>>2]=c[a>>2],c[C+4>>2]=E,C=c[4+(a=t+1128|0)>>2],c[112+i>>2]=c[a>>2],c[116+i>>2]=C,a=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[a>>2]+64>>2]](a,112+i|0,n)),!m)break e;a=c[j+4>>2],c[_>>2]=c[j>>2],c[_+4>>2]=a,a=c[V+4>>2],c[r>>2]=c[V>>2],c[r+4>>2]=a,a=c[Y+4>>2],c[o>>2]=c[Y>>2],c[o+4>>2]=a,E=c[4+(C=R+8|0)>>2],c[(a=m=120+i|0)>>2]=c[C>>2],c[a+4>>2]=E,B=c[4+(E=j+8|0)>>2],c[(a=C=_+8|0)>>2]=c[E>>2],c[a+4>>2]=B,k=c[4+(B=V+8|0)>>2],c[(a=E=r+8|0)>>2]=c[B>>2],c[a+4>>2]=k,K=c[4+(k=Y+8|0)>>2],c[(a=B=o+8|0)>>2]=c[k>>2],c[a+4>>2]=K,a=c[R+4>>2],c[112+i>>2]=c[R>>2],c[116+i>>2]=a,A[96+i>>2]=A[m>>2],A[100+i>>2]=A[136+i>>2],c[108+i>>2]=0,A[104+i>>2]=A[152+i>>2],A[80+i>>2]=A[112+i>>2],A[84+i>>2]=A[128+i>>2],c[92+i>>2]=0,A[88+i>>2]=A[144+i>>2],s=A[t+932>>2],l=A[t+936>>2],u=A[t+996>>2],h=A[t+1e3>>2],k=0|pi[c[c[e>>2]+20>>2]](e),c[(a=72+i|0)>>2]=0,c[a+4>>2]=0,c[64+i>>2]=0,c[68+i>>2]=0,pi[c[c[k>>2]+72>>2]](k,a=t+1176|0,96+i|0,80+i|0,x(n*x(.8999999761581421)),s,l,u,h,i+64|0,x(10),1),c[92+i>>2]=0,h=A[148+i>>2],A[88+i>>2]=h,s=A[132+i>>2],A[84+i>>2]=s,l=A[116+i>>2],A[80+i>>2]=l,f=A[t+1196>>2],d=A[t+1200>>2],K=c[4+(k=t+1136|0)>>2],c[m>>2]=c[k>>2],c[m+4>>2]=K,k=c[4+(m=t+1144|0)>>2],c[_>>2]=c[m>>2],c[_+4>>2]=k,k=c[4+(m=t+1152|0)>>2],c[C>>2]=c[m>>2],c[C+4>>2]=k,C=c[4+(m=t+1160|0)>>2],c[r>>2]=c[m>>2],c[r+4>>2]=C,C=c[4+(m=t+1168|0)>>2],c[E>>2]=c[m>>2],c[E+4>>2]=C,m=c[a+4>>2],c[o>>2]=c[a>>2],c[o+4>>2]=m,C=c[4+(m=t+1184|0)>>2],c[B>>2]=c[m>>2],c[B+4>>2]=C,C=c[4+(m=t+1128|0)>>2],c[112+i>>2]=c[m>>2],c[116+i>>2]=C,u=fe(d),d=pe(d),A[68+i>>2]=x(s*d)-x(u*l),v=fe(f),f=pe(f),A[72+i>>2]=x(x(l*x(d*v))+x(s*x(v*u)))+x(h*f),A[64+i>>2]=x(x(l*x(f*d))+x(s*x(f*u)))-x(v*h),c[60+i>>2]=0,A[56+i>>2]=-A[144+i>>2],A[52+i>>2]=-A[128+i>>2],A[48+i>>2]=-A[112+i>>2],s=A[t+868>>2],(l=A[t+872>>2])<s?(m=0|pi[c[c[e>>2]+20>>2]](e),c[(C=40+i|0)>>2]=0,c[C+4>>2]=0,c[32+i>>2]=0,c[36+i>>2]=0,pi[c[c[m>>2]+68>>2]](m,a,48+i|0,i+64|0,n,n,x(-3.1415927410125732),x(3.1415927410125732),32+i|0,0,x(10))):s<l&&(m=0|pi[c[c[e>>2]+20>>2]](e),c[(C=40+i|0)>>2]=0,c[C+4>>2]=0,c[32+i>>2]=0,c[36+i>>2]=0,pi[c[c[m>>2]+68>>2]](m,a,48+i|0,i+64|0,n,n,s,l,32+i|0,1,x(10))),a=c[j+4>>2],c[_>>2]=c[j>>2],c[_+4>>2]=a,a=c[V+4>>2],c[r>>2]=c[V>>2],c[r+4>>2]=a,a=c[Y+4>>2],c[o>>2]=c[Y>>2],c[o+4>>2]=a,C=c[4+(m=R+8|0)>>2],c[(a=120+i|0)>>2]=c[m>>2],c[a+4>>2]=C,j=c[4+(a=j+8|0)>>2],c[(_=_+8|0)>>2]=c[a>>2],c[_+4>>2]=j,a=c[4+(_=V+8|0)>>2],c[(r=r+8|0)>>2]=c[_>>2],c[r+4>>2]=a,_=c[4+(r=Y+8|0)>>2],c[(o=o+8|0)>>2]=c[r>>2],c[o+4>>2]=_,o=c[R+4>>2],c[112+i>>2]=c[R>>2],c[116+i>>2]=o,_=c[4+(r=t+688|0)>>2],c[(o=40+i|0)>>2]=c[r>>2],c[o+4>>2]=_,r=c[4+(o=t+680|0)>>2],c[32+i>>2]=c[o>>2],c[36+i>>2]=r,_=c[4+(r=t+704|0)>>2],c[(o=24+i|0)>>2]=c[r>>2],c[o+4>>2]=_,o=c[4+(t=t+696|0)>>2],c[16+i>>2]=c[t>>2],c[20+i>>2]=o,e=0|pi[c[c[e>>2]+20>>2]](e),c[(t=8+i|0)>>2]=0,c[t+4>>2]=0,c[i>>2]=0,c[4+i>>2]=0,pi[c[c[e>>2]+80>>2]](e,32+i|0,16+i|0,112+i|0,i);break e;case 9:if(_=c[4+(r=t+1244|0)>>2],c[(o=C=120+i|0)>>2]=c[r>>2],c[o+4>>2]=_,_=c[4+(r=t+1260|0)>>2],c[(o=136+i|0)>>2]=c[r>>2],c[o+4>>2]=_,_=c[4+(r=t+1276|0)>>2],c[(o=152+i|0)>>2]=c[r>>2],c[o+4>>2]=_,_=c[4+(r=t+1292|0)>>2],c[(o=168+i|0)>>2]=c[r>>2],c[o+4>>2]=_,r=c[4+(o=R=t+1236|0)>>2],c[112+i>>2]=c[o>>2],c[116+i>>2]=r,r=c[4+(o=j=t+1252|0)>>2],c[128+i>>2]=c[o>>2],c[132+i>>2]=r,r=c[4+(o=V=t+1268|0)>>2],c[144+i>>2]=c[o>>2],c[148+i>>2]=r,r=c[4+(o=Y=t+1284|0)>>2],c[160+i>>2]=c[o>>2],c[164+i>>2]=r,o=160+i|0,r=144+i|0,_=128+i|0,a&&(a=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[a>>2]+64>>2]](a,112+i|0,n),B=c[4+(E=t+1356|0)>>2],c[(a=o+8|0)>>2]=c[E>>2],c[a+4>>2]=B,E=c[4+(a=t+1348|0)>>2],c[o>>2]=c[a>>2],c[o+4>>2]=E,E=c[4+(a=t+1316|0)>>2],c[_>>2]=c[a>>2],c[_+4>>2]=E,B=c[4+(E=t+1324|0)>>2],c[(a=_+8|0)>>2]=c[E>>2],c[a+4>>2]=B,E=c[4+(a=t+1332|0)>>2],c[r>>2]=c[a>>2],c[r+4>>2]=E,B=c[4+(E=t+1340|0)>>2],c[(a=r+8|0)>>2]=c[E>>2],c[a+4>>2]=B,E=c[4+(a=t+1308|0)>>2],c[C>>2]=c[a>>2],c[C+4>>2]=E,C=c[4+(a=t+1300|0)>>2],c[112+i>>2]=c[a>>2],c[116+i>>2]=C,a=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[a>>2]+64>>2]](a,112+i|0,n)),!m)break e;a=c[j+4>>2],c[_>>2]=c[j>>2],c[_+4>>2]=a,a=c[V+4>>2],c[r>>2]=c[V>>2],c[r+4>>2]=a,a=c[Y+4>>2],c[o>>2]=c[Y>>2],c[o+4>>2]=a,E=c[4+(C=R+8|0)>>2],c[(a=m=120+i|0)>>2]=c[C>>2],c[a+4>>2]=E,B=c[4+(E=j+8|0)>>2],c[(a=C=_+8|0)>>2]=c[E>>2],c[a+4>>2]=B,k=c[4+(B=V+8|0)>>2],c[(a=E=r+8|0)>>2]=c[B>>2],c[a+4>>2]=k,K=c[4+(k=Y+8|0)>>2],c[(a=B=o+8|0)>>2]=c[k>>2],c[a+4>>2]=K,a=c[R+4>>2],c[112+i>>2]=c[R>>2],c[116+i>>2]=a,A[96+i>>2]=A[m>>2],A[100+i>>2]=A[136+i>>2],c[108+i>>2]=0,A[104+i>>2]=A[152+i>>2],A[80+i>>2]=A[112+i>>2],A[84+i>>2]=A[128+i>>2],c[92+i>>2]=0,A[88+i>>2]=A[144+i>>2],s=A[t+1060>>2],l=A[t+1144>>2],u=A[t+1148>>2],h=A[t+1056>>2],k=0|pi[c[c[e>>2]+20>>2]](e),c[(a=72+i|0)>>2]=0,c[a+4>>2]=0,c[64+i>>2]=0,c[68+i>>2]=0,pi[c[c[k>>2]+72>>2]](k,a=t+1348|0,96+i|0,80+i|0,x(n*x(.8999999761581421)),h,s,l,u,i+64|0,x(10),1),c[92+i>>2]=0,h=A[148+i>>2],A[88+i>>2]=h,s=A[132+i>>2],A[84+i>>2]=s,l=A[116+i>>2],A[80+i>>2]=l,f=A[t+1368>>2],d=A[t+1372>>2],K=c[4+(k=t+1308|0)>>2],c[m>>2]=c[k>>2],c[m+4>>2]=K,k=c[4+(m=t+1316|0)>>2],c[_>>2]=c[m>>2],c[_+4>>2]=k,k=c[4+(m=t+1324|0)>>2],c[C>>2]=c[m>>2],c[C+4>>2]=k,C=c[4+(m=t+1332|0)>>2],c[r>>2]=c[m>>2],c[r+4>>2]=C,C=c[4+(m=t+1340|0)>>2],c[E>>2]=c[m>>2],c[E+4>>2]=C,m=c[a+4>>2],c[o>>2]=c[a>>2],c[o+4>>2]=m,C=c[4+(m=t+1356|0)>>2],c[B>>2]=c[m>>2],c[B+4>>2]=C,C=c[4+(m=t+1300|0)>>2],c[112+i>>2]=c[m>>2],c[116+i>>2]=C,u=fe(d),d=pe(d),A[68+i>>2]=x(s*d)-x(l*u),v=fe(f),f=pe(f),A[72+i>>2]=x(x(l*x(d*v))+x(s*x(v*u)))+x(h*f),A[64+i>>2]=x(x(l*x(f*d))+x(s*x(f*u)))-x(v*h),c[60+i>>2]=0,A[56+i>>2]=-A[144+i>>2],A[52+i>>2]=-A[128+i>>2],A[48+i>>2]=-A[112+i>>2],s=A[t+968>>2],(l=A[t+972>>2])<s?(m=0|pi[c[c[e>>2]+20>>2]](e),c[(C=40+i|0)>>2]=0,c[C+4>>2]=0,c[32+i>>2]=0,c[36+i>>2]=0,pi[c[c[m>>2]+68>>2]](m,a,48+i|0,i+64|0,n,n,x(-3.1415927410125732),x(3.1415927410125732),32+i|0,0,x(10))):s<l&&(m=0|pi[c[c[e>>2]+20>>2]](e),c[(C=40+i|0)>>2]=0,c[C+4>>2]=0,c[32+i>>2]=0,c[36+i>>2]=0,pi[c[c[m>>2]+68>>2]](m,a,48+i|0,i+64|0,n,n,s,l,32+i|0,1,x(10))),a=c[j+4>>2],c[_>>2]=c[j>>2],c[_+4>>2]=a,a=c[V+4>>2],c[r>>2]=c[V>>2],c[r+4>>2]=a,a=c[Y+4>>2],c[o>>2]=c[Y>>2],c[o+4>>2]=a,C=c[4+(m=R+8|0)>>2],c[(a=120+i|0)>>2]=c[m>>2],c[a+4>>2]=C,j=c[4+(a=j+8|0)>>2],c[(_=_+8|0)>>2]=c[a>>2],c[_+4>>2]=j,a=c[4+(_=V+8|0)>>2],c[(r=r+8|0)>>2]=c[_>>2],c[r+4>>2]=a,_=c[4+(r=Y+8|0)>>2],c[(o=o+8|0)>>2]=c[r>>2],c[o+4>>2]=_,o=c[R+4>>2],c[112+i>>2]=c[R>>2],c[116+i>>2]=o,_=c[4+(r=t+688|0)>>2],c[(o=40+i|0)>>2]=c[r>>2],c[o+4>>2]=_,r=c[4+(o=t+680|0)>>2],c[32+i>>2]=c[o>>2],c[36+i>>2]=r,_=c[4+(r=t+704|0)>>2],c[(o=24+i|0)>>2]=c[r>>2],c[o+4>>2]=_,o=c[4+(t=t+696|0)>>2],c[16+i>>2]=c[t>>2],c[20+i>>2]=o,e=0|pi[c[c[e>>2]+20>>2]](e),c[(t=8+i|0)>>2]=0,c[t+4>>2]=0,c[i>>2]=0,c[4+i>>2]=0,pi[c[c[e>>2]+80>>2]](e,32+i|0,16+i|0,112+i|0,i);break e;case 4:break t;default:break e}_=c[4+(r=t+832|0)>>2],c[(o=R=120+i|0)>>2]=c[r>>2],c[o+4>>2]=_,_=c[4+(r=t+848|0)>>2],c[(o=136+i|0)>>2]=c[r>>2],c[o+4>>2]=_,_=c[4+(r=t+864|0)>>2],c[(o=152+i|0)>>2]=c[r>>2],c[o+4>>2]=_,_=c[4+(r=t+880|0)>>2],c[(o=168+i|0)>>2]=c[r>>2],c[o+4>>2]=_,r=c[4+(o=j=t+824|0)>>2],c[112+i>>2]=c[o>>2],c[116+i>>2]=r,r=c[4+(o=t+840|0)>>2],c[128+i>>2]=c[o>>2],c[132+i>>2]=r,r=c[4+(o=t+856|0)>>2],c[144+i>>2]=c[o>>2],c[148+i>>2]=r,r=c[4+(o=t+872|0)>>2],c[160+i>>2]=c[o>>2],c[164+i>>2]=r,o=160+i|0,r=144+i|0,_=128+i|0,a?(a=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[a>>2]+64>>2]](a,112+i|0,n),Y=c[4+(V=t+944|0)>>2],c[(a=o+8|0)>>2]=c[V>>2],c[a+4>>2]=Y,V=c[4+(a=t+936|0)>>2],c[o>>2]=c[a>>2],c[o+4>>2]=V,a=c[4+(o=t+904|0)>>2],c[_>>2]=c[o>>2],c[_+4>>2]=a,o=_+8|0,a=c[4+(_=t+912|0)>>2],c[o>>2]=c[_>>2],c[o+4>>2]=a,_=c[4+(o=t+920|0)>>2],c[r>>2]=c[o>>2],c[r+4>>2]=_,o=r+8|0,_=c[4+(r=t+928|0)>>2],c[o>>2]=c[r>>2],c[o+4>>2]=_,r=c[4+(o=t+896|0)>>2],c[R>>2]=c[o>>2],c[R+4>>2]=r,r=c[4+(o=t+888|0)>>2],c[112+i>>2]=c[o>>2],c[116+i>>2]=r,o=0|pi[c[c[e>>2]+20>>2]](e),pi[c[c[o>>2]+64>>2]](o,112+i|0,n)):(V=c[4+(a=t+896|0)>>2],c[R>>2]=c[a>>2],c[R+4>>2]=V,R=c[4+(a=t+904|0)>>2],c[_>>2]=c[a>>2],c[_+4>>2]=R,R=c[4+(a=t+912|0)>>2],c[(_=_+8|0)>>2]=c[a>>2],c[_+4>>2]=R,a=c[4+(_=t+920|0)>>2],c[r>>2]=c[_>>2],c[r+4>>2]=a,a=c[4+(_=t+928|0)>>2],c[(r=r+8|0)>>2]=c[_>>2],c[r+4>>2]=a,_=c[4+(r=t+936|0)>>2],c[o>>2]=c[r>>2],c[o+4>>2]=_,_=c[4+(r=t+944|0)>>2],c[(o=o+8|0)>>2]=c[r>>2],c[o+4>>2]=_,r=c[4+(o=t+888|0)>>2],c[112+i>>2]=c[o>>2],c[116+i>>2]=r),m&&(o=p[t+180|0]?j:t+888|0,h=A[o+48>>2],P=A[o+8>>2],s=A[o>>2],f=A[o+4>>2],d=A[o+52>>2],w=A[o+24>>2],l=A[o+16>>2],v=A[o+20>>2],g=A[o+56>>2],S=A[o+40>>2],u=A[o+32>>2],b=A[o+36>>2],c[108+i>>2]=0,z=x(S*x(0)),L=x(b*x(0)),S=A[t+184>>2],A[104+i>>2]=g+x(z+x(L+x(u*S))),w=x(w*x(0)),I=x(v*x(0)),A[100+i>>2]=d+x(w+x(I+x(l*S))),P=x(P*x(0)),F=x(f*x(0)),A[96+i>>2]=h+x(P+x(F+x(s*S))),c[92+i>>2]=0,Z=g,g=A[t+188>>2],A[88+i>>2]=Z+x(z+x(L+x(u*g))),A[84+i>>2]=d+x(w+x(I+x(l*g))),A[80+i>>2]=h+x(P+x(F+x(s*g))),o=0|pi[c[c[e>>2]+20>>2]](e),c[(r=72+i|0)>>2]=0,c[r+4>>2]=0,c[64+i>>2]=0,c[68+i>>2]=0,pi[c[c[o>>2]+16>>2]](o,96+i|0,80+i|0,i+64|0),c[76+i>>2]=0,A[72+i>>2]=u,A[68+i>>2]=l,A[64+i>>2]=s,c[60+i>>2]=0,A[56+i>>2]=b,A[52+i>>2]=v,A[48+i>>2]=f,s=A[t+196>>2],l=A[t+192>>2],e=0|pi[c[c[e>>2]+20>>2]](e),c[(o=40+i|0)>>2]=0,c[o+4>>2]=0,c[32+i>>2]=0,c[36+i>>2]=0,pi[c[c[e>>2]+68>>2]](e,t+936|0,i+64|0,48+i|0,n,n,l,s,32+i|0,1,x(10)))}N=176+i|0},function(e){var t,n,i=0,o=0;if(1<=(0|(n=c[248+(e|=0)>>2])))for(e=c[e+256>>2];;){e:{switch(i=c[e>>2],c[i+220>>2]-2|0){case 0:case 3:break e}3&p[i+204|0]||(A[i+472>>2]=x(A[i+424>>2]*A[i+408>>2])+A[i+472>>2],A[(t=i+476|0)>>2]=x(A[i+428>>2]*A[i+412>>2])+A[t>>2],A[(t=i+480|0)>>2]=x(A[i+432>>2]*A[i+416>>2])+A[t>>2])}if(e=e+4|0,!((0|(o=o+1|0))<(0|n)))break}},At,function(e,t){e|=0,t=x(t);var n,i=0,o=0;if(1<=c[e+296>>2])for(;n=c[c[e+304>>2]+i>>2],pi[c[c[n>>2]+8>>2]](n,e,t),i=i+4|0,(0|(o=o+1|0))<c[e+296>>2];);},function(e){var t=0;return c[(e|=0)>>2]=19980,(t=c[e+80>>2])&&p[e+84|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+80>>2]=0,a[e+84|0]=1,c[(t=e+72|0)>>2]=0,c[t+4>>2]=0,(t=c[e+60>>2])&&p[e- -64|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+60>>2]=0,a[e- -64|0]=1,c[(t=e+52|0)>>2]=0,c[t+4>>2]=0,(t=c[e+40>>2])&&p[e+44|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+40>>2]=0,a[e+44|0]=1,c[(t=e+32|0)>>2]=0,(c[t+4>>2]=0)|e},function(e){var t=0;c[(e|=0)>>2]=19980,(t=c[e+80>>2])&&p[e+84|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+80>>2]=0,a[e+84|0]=1,c[(t=e+72|0)>>2]=0,c[t+4>>2]=0,(t=c[e+60>>2])&&p[e- -64|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+60>>2]=0,a[e- -64|0]=1,c[(t=e+52|0)>>2]=0,c[t+4>>2]=0,(t=c[e+40>>2])&&p[e+44|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),V(e)},function(e,t,n,i,o,r){e|=0,t|=0,n|=0,i|=0,o|=0;var s,l=0,_=0,u=0,h=0,f=0,d=0,m=0;e:{t:{n:{if(0<=(0|(r|=0))){if(1<=(0|(l=c[e+16>>2])))break n;break t}return r=c[e+8>>2],void x(pi[c[c[r>>2]+12>>2]](r,t,n,i,o,c[e+12>>2],c[e+16>>2],c[e+4>>2],c[e+20>>2],c[e+24>>2]))}for(d=c[e+12>>2];;){if(h=c[d>>2],(0|r)==(0|(_=(0|(_=c[c[h+28>>2]+208>>2]))<=-1?c[c[h+32>>2]+208>>2]:_)))break t;if(d=d+4|0,(0|l)==(0|(u=u+1|0)))break}d=0;break e}if(!((0|l)<=(0|u)))for(_=l-u|0,l=c[e+12>>2]+(u<<2)|0;h=c[l>>2],l=l+4|0,m=((0|r)==(0|(u=(0|(u=c[c[h+28>>2]+208>>2]))<=-1?c[c[h+32>>2]+208>>2]:u)))+m|0,_=_-1|0;);}if(r=c[e+4>>2],2<=c[r+80>>2]){if(1<=(0|n))for(_=c[e+36>>2],u=c[e+32>>2];;){if(s=(f<<2)+t|0,(0|_)==(0|u))if((0|(h=_?_<<1:1))<=(0|_))l=_;else{if(r=0,h&&(c[5498]=c[5498]+1,(l=M(19+(h<<2)|0))&&(c[(r=l+19&-16)-4>>2]=l)),1<=(0|_))for(l=0,u=_;c[r+l>>2]=c[c[e+40>>2]+l>>2],l=l+4|0,u=u-1|0;);(l=c[e+40>>2])&&p[e+44|0]&&(c[5499]=c[5499]+1,z(c[l-4>>2]),_=c[e+32>>2]),l=_,c[e+40>>2]=r,a[e+44|0]=1,_=c[e+36>>2]=h}else l=u;if(c[e+32>>2]=u=l+1|0,c[c[e+40>>2]+(l<<2)>>2]=c[s>>2],(0|(f=f+1|0))==(0|n))break}if(1<=(0|o))for(_=c[e+56>>2],u=c[e+52>>2],f=0;;){if(h=(f<<2)+i|0,(0|_)==(0|u))if((0|(t=_?_<<1:1))<=(0|_))l=_;else{if(r=0,t&&(c[5498]=c[5498]+1,(n=M(19+(t<<2)|0))&&(c[(r=n+19&-16)-4>>2]=n)),1<=(0|_))for(l=0,u=_;c[r+l>>2]=c[c[e+60>>2]+l>>2],l=l+4|0,u=u-1|0;);(n=c[e+60>>2])&&p[e+64|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2]),_=c[e+52>>2]),l=_,c[e+60>>2]=r,a[e+64|0]=1,_=c[e+56>>2]=t}else l=u;if(c[e+52>>2]=u=l+1|0,c[c[e+60>>2]+(l<<2)>>2]=c[h>>2],(0|(f=f+1|0))==(0|o))break}if(m)for(_=c[e+76>>2],u=c[e+72>>2],f=0;;){if(i=(f<<2)+d|0,(0|_)==(0|u))if((0|(t=_?_<<1:1))<=(0|_))l=_;else{if(r=0,t&&(c[5498]=c[5498]+1,(n=M(19+(t<<2)|0))&&(c[(r=n+19&-16)-4>>2]=n)),1<=(0|_))for(l=0,u=_;c[r+l>>2]=c[c[e+80>>2]+l>>2],l=l+4|0,u=u-1|0;);(n=c[e+80>>2])&&p[e+84|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2]),_=c[e+72>>2]),l=_,c[e+80>>2]=r,a[e+84|0]=1,_=c[e+76>>2]=t}else l=u;if(c[e+72>>2]=u=l+1|0,c[c[e+80>>2]+(l<<2)>>2]=c[i>>2],(0|m)==(0|(f=f+1|0)))break}else u=c[e+72>>2];c[c[e+4>>2]+80>>2]<(c[e+52>>2]+u|0)&&$n(e)}else _=c[e+8>>2],x(pi[c[c[_>>2]+12>>2]](_,t,n,i,o,d,m,r,c[e+20>>2],c[e+24>>2]))},ve,function(e,t){var n,i,o=0;return(0|(n=c[(t|=0)>>2]))!=(0|(i=c[84+(e|=0)>>2]))&&c[e+12>>2]&c[t+4>>2]&&c[t+8>>2]&c[e+8>>2]&&(e=c[e+96>>2],o=0|pi[c[c[e>>2]+28>>2]](e,i,n)),0|o},function(e,t,n){e|=0,t|=0,n|=0;var i,o,a,r,s,l,_,u,h,f,d,m=0,v=x(0);return v=x(1),(0|(m=c[t>>2]))!=c[e+84>>2]&&(4&p[m+204|0]||x(-A[e+88>>2])<=x(x(x(x(A[e+32>>2]-A[e+16>>2])*A[t+8>>2])+x(x(A[e+36>>2]-A[e+20>>2])*A[t+12>>2]))+x(x(A[e+40>>2]-A[e+24>>2])*A[t+16>>2]))||(c[e+80>>2]=m,A[e+4>>2]=A[t+40>>2],n?(m=c[4+(n=t+8|0)>>2],c[e+48>>2]=c[n>>2],c[e+52>>2]=m,o=c[4+(n=n+8|0)>>2],c[(m=e+56|0)>>2]=c[n>>2],c[m+4>>2]=o):(a=A[m+12>>2],r=A[m+8>>2],s=A[m+28>>2],l=A[m+20>>2],_=A[m+24>>2],u=A[m+44>>2],h=A[m+36>>2],f=A[m+40>>2],d=A[m+4>>2],v=A[t+16>>2],i=A[t+8>>2],o=A[t+12>>2],c[e+60>>2]=0,A[e+56>>2]=x(x(i*h)+x(o*f))+x(v*u),A[e+52>>2]=x(x(i*l)+x(o*_))+x(v*s),A[e+48>>2]=x(x(d*i)+x(r*o))+x(a*v)),n=c[t+28>>2],c[e+64>>2]=c[t+24>>2],c[e+68>>2]=n,m=c[4+(n=t+32|0)>>2],c[(e=e+72|0)>>2]=c[n>>2],c[e+4>>2]=m,v=A[t+40>>2])),x(v)},function(e){return ei(e|=0),0|e},function(e){ei(e|=0),c[5499]=c[5499]+1,z(c[e-4>>2])},function(e,t){e|=0,t=x(t);var n,i,o,r,s,l,_,u,h,f,d,m,v,y,b,E,T,P,w,I,R,D,O,L,F,B,k,U,G,j,V,H,W,q,Y,X=0,Q=0,Z=0,J=0,K=0,$=0,ee=0;if(N=Y=N-496|0,1<=c[e+324>>2])for(;K=c[e+24>>2],pi[c[c[K>>2]+16>>2]](K,c[c[e+332>>2]+$>>2]),$=$+4|0,(0|(Q=Q+1|0))<c[e+324>>2];);if((K=c[e+332>>2])&&p[e+336|0]&&(c[5499]=c[5499]+1,z(c[K-4>>2])),c[e+332>>2]=0,c[e+324>>2]=0,c[e+328>>2]=0,(a[e+336|0]=1)<=(0|(O=c[e+248>>2])))for(l=116+Y|0,m=84+Y|0,v=Y+64|0,K=384+Y|0,y=256+Y|0,b=240+Y|0,E=224+Y|0,h=304+Y|0,T=368+Y|0,P=352+Y|0,u=480+Y|0,$=0;;){n=c[c[e+256>>2]+($<<2)>>2],c[n+268>>2]=1065353216;e:{switch(c[n+220>>2]-2|0){case 0:case 3:break e}if(!(3&p[n+204|0])&&(Bn(J=n+4|0,A[n+372>>2],A[n+376>>2],A[n+380>>2],n+388|0,t,432+Y|0),p[e+44|0]&&(i=A[n+276>>2],(r=x(i*i))!=x(0)&&(f=A[480+Y>>2],i=x(f-A[(_=n+52|0)>>2]),o=x(i*i),d=A[484+Y>>2],i=x(d-A[n+56>>2]),s=x(o+x(i*i)),o=A[488+Y>>2],i=x(o-A[n+60>>2]),r<x(s+x(i*i))&&!(19<c[c[n+192>>2]+4>>2])&&(X=c[4+_>>2],c[P>>2]=c[_>>2],c[4+P>>2]=X,X=c[4+u>>2],c[T>>2]=c[u>>2],c[4+T>>2]=X,X=c[4+(Q=w=8+_|0)>>2],c[(Z=8+P|0)>>2]=c[Q>>2],c[Z+4>>2]=X,X=c[4+(Z=8+u|0)>>2],c[(Q=8+T|0)>>2]=c[Z>>2],c[Q+4>>2]=X,c[340+Y>>2]=1065353216,c[336+Y>>2]=20576,c[416+Y>>2]=0,c[420+Y>>2]=0,c[428+Y>>2]=e,c[424+Y>>2]=n,c[h>>2]=0,c[4+h>>2]=0,c[(X=8+h|0)>>2]=0,c[X+4>>2]=0,c[16+h>>2]=0,c[284+Y>>2]=0,c[288+Y>>2]=0,c[300+Y>>2]=1065353216,c[292+Y>>2]=1065353216,c[296+Y>>2]=1065353216,c[276+Y>>2]=8,c[280+Y>>2]=0,c[272+Y>>2]=11936,c[328+Y>>2]=0,i=A[n+272>>2],A[308+Y>>2]=i,A[324+Y>>2]=i,X=c[n+188>>2],c[344+Y>>2]=c[X+4>>2],c[348+Y>>2]=c[X+8>>2],X=c[Z+4>>2],c[(Q=8+y|0)>>2]=c[Z>>2],c[Q+4>>2]=X,X=c[4+u>>2],c[y>>2]=c[u>>2],c[4+y>>2]=X,X=c[4+(Q=J+8|0)>>2],c[(Z=216+Y|0)>>2]=c[Q>>2],c[Z+4>>2]=X,X=c[4+(Q=n+20|0)>>2],c[E>>2]=c[Q>>2],c[4+E>>2]=X,X=c[4+(Q=n+28|0)>>2],c[(Z=8+E|0)>>2]=c[Q>>2],c[Z+4>>2]=X,X=c[4+(Q=n+36|0)>>2],c[b>>2]=c[Q>>2],c[4+b>>2]=X,X=c[4+(Q=n+44|0)>>2],c[(Z=8+b|0)>>2]=c[Q>>2],c[Z+4>>2]=X,X=c[J+4>>2],c[208+Y>>2]=c[J>>2],c[212+Y>>2]=X,Zn(e,272+Y|0,J,208+Y|0,336+Y|0,x(0)),(i=A[340+Y>>2])<x(1)))))){if(L=x(x(d-A[n+56>>2])*i),s=x(x(f-A[n+52>>2])*i),F=x(i*x(o-A[n+60>>2])),r=x(x(x(L*x(-A[388+Y>>2]))-x(A[384+Y>>2]*s))-x(F*A[392+Y>>2])),X=c[e+24>>2],I=0|pi[c[c[X>>2]+12>>2]](X,n,c[416+Y>>2]),(0|(Q=c[e+324>>2]))==c[e+328>>2]&&!((0|(J=Q?Q<<1:1))<=(0|Q))){if(Z=0,J&&(c[5498]=c[5498]+1,(X=M(19+(J<<2)|0))&&(c[(Z=X+19&-16)-4>>2]=X)),1<=(0|Q))for(ee=0,X=Q;c[Z+ee>>2]=c[c[e+332>>2]+ee>>2],ee=ee+4|0,X=X-1|0;);(X=c[e+332>>2])&&p[e+336|0]&&(c[5499]=c[5499]+1,z(c[X-4>>2]),Q=c[e+324>>2]),c[e+332>>2]=Z,a[e+336|0]=1,c[e+328>>2]=J}c[c[e+332>>2]+(Q<<2)>>2]=I,c[e+324>>2]=Q+1,X=c[416+Y>>2],B=A[X+20>>2],k=A[X+36>>2],U=A[X+40>>2],G=A[X+8>>2],j=A[X+24>>2],R=A[X+60>>2],f=A[X+56>>2],D=A[X+52>>2],V=A[X+44>>2],H=A[X+12>>2],W=A[X+28>>2],q=A[X+4>>2],d=A[n+60>>2],o=A[n+52>>2],i=A[n+56>>2],c[(X=8+Y|0)>>2]=0,c[X+4>>2]=0,c[m>>2]=0,c[4+m>>2]=0,c[(X=8+m|0)>>2]=0,c[X+4>>2]=0,c[l>>2]=0,c[4+l>>2]=0,c[(X=8+l|0)>>2]=0,c[X+4>>2]=0,c[(X=16+l|0)>>2]=0,c[X+4>>2]=0,c[(X=24+l|0)>>2]=0,c[X+4>>2]=0,c[(X=32+l|0)>>2]=0,c[X+4>>2]=0,c[(X=40+l|0)>>2]=0,c[X+4>>2]=0,c[48+l>>2]=0,X=c[K+4>>2],c[v>>2]=c[K>>2],c[4+v>>2]=X,X=c[4+(Q=K+8|0)>>2],c[(Z=8+v|0)>>2]=c[Q>>2],c[Z+4>>2]=X,c[Y>>2]=0,c[4+Y>>2]=0,c[28+Y>>2]=0,A[80+Y>>2]=r,s=x(s+o),r=x(L+i),o=x(F+d),i=x(-f),A[24+Y>>2]=x(x(x(H*s)+x(W*r))+x(V*o))+x(x(x(W*i)-x(H*D))-x(V*R)),A[20+Y>>2]=x(x(x(s*G)+x(r*j))+x(o*U))+x(x(x(j*i)-x(G*D))-x(U*R)),A[16+Y>>2]=x(x(x(s*q)+x(r*B))+x(o*k))+x(x(x(B*i)-x(q*D))-x(k*R)),c[200+Y>>2]=c[n+192>>2],c[204+Y>>2]=c[420+Y>>2],J=g(Ft(I,Y),208)+I|0,c[J+100>>2]=0,A[J+88>>2]=S(x(C(x(A[n+228>>2]*A[c[416+Y>>2]+228>>2]),x(-10))),x(10)),X=c[4+w>>2],c[(Q=J+60|0)>>2]=c[w>>2],c[Q+4>>2]=X,Z=c[4+_>>2],Q=c[_>>2],c[J+48>>2]=0,A[J+44>>2]=o,A[J+40>>2]=r,c[(X=J+52|0)>>2]=Q,c[X+4>>2]=Z,A[J+36>>2]=s}}if((0|O)==(0|($=$+1|0)))break}N=496+Y|0},function(e){var t=0,n=0,i=0,o=0;if(1<=c[248+(e|=0)>>2])for(;;){e:{switch(t=c[c[e+256>>2]+i>>2],c[t+220>>2]-2|0){case 0:case 3:break e}2&(n=c[t+204>>2])||(A[t+504>>2]!=x(1)?3&n||(A[t+472>>2]=x(A[t+424>>2]*A[t+408>>2])+A[t+472>>2],A[(n=t+476|0)>>2]=x(A[t+428>>2]*A[t+412>>2])+A[n>>2],A[(n=t+480|0)>>2]=x(A[t+432>>2]*A[t+416>>2])+A[n>>2]):(c[t+472>>2]=0,c[t+476>>2]=0,c[(n=t+480|0)>>2]=0,c[n+4>>2]=0),A[t+508>>2]==x(1)&&(c[t+488>>2]=0,c[t+492>>2]=0,c[(t=t+496|0)>>2]=0,c[t+4>>2]=0))}if(i=i+4|0,!((0|(o=o+1|0))<c[e+248>>2]))break}},Se,ve,function(e,t,n){return e|=0,c[8+(n|=e=0)>>2]&c[4+(t|=0)>>2]&&c[t+8>>2]&c[n+4>>2]&&(t=c[t>>2],n=c[n>>2],1&a[n+204|0]&&1&a[t+204|0]||2==c[n+220>>2]&&2==c[t+220>>2]||(e=1)),0|e},ve,function(e,t){var n,i,o=0;return(0|(n=c[(t|=0)>>2]))!=(0|(i=c[88+(e|=0)>>2]))&&c[e+12>>2]&c[t+4>>2]&&c[t+8>>2]&c[e+8>>2]&&(e=c[c[e+92>>2]+24>>2],o=0|pi[c[c[e>>2]+28>>2]](e,i,n)),0|o},function(e,t,n){t|=0,n|=0;var i,o,a,r,s,l,_,u,h,f,p,d,m=0;return A[4+(e|=0)>>2]=A[t+40>>2],m=c[t>>2],c[e+80>>2]=m,c[e+84>>2]=c[c[t+4>>2]+8>>2],n?(n=c[t+12>>2],c[e+48>>2]=c[t+8>>2],c[e+52>>2]=n,a=c[4+(m=t+16|0)>>2],c[(n=e+56|0)>>2]=c[m>>2],c[n+4>>2]=a):(r=A[m+8>>2],s=A[m+12>>2],l=A[m+20>>2],_=A[m+24>>2],u=A[m+28>>2],h=A[m+36>>2],f=A[m+40>>2],i=A[t+12>>2],p=A[m+44>>2],o=A[t+16>>2],d=A[m+4>>2],a=A[t+8>>2],c[e+60>>2]=0,A[e+56>>2]=x(x(a*h)+x(i*f))+x(o*p),A[e+52>>2]=x(x(a*l)+x(i*_))+x(o*u),A[e+48>>2]=x(x(d*a)+x(r*i))+x(s*o)),n=c[t+28>>2],c[e+64>>2]=c[t+24>>2],c[e+68>>2]=n,m=c[4+(n=t+32|0)>>2],c[(e=e+72|0)>>2]=c[n>>2],c[e+4>>2]=m,x(A[t+40>>2])},oi,function(e){e|=0;var t,n,i,o,r,s,l,_,u,h,f,d,m,v,g,b,S,C,E,P,w=0,I=x(0),R=x(0),D=x(0),O=x(0),M=0,z=x(0),L=0,F=x(0),B=x(0),k=0,U=x(0),G=x(0),j=x(0),V=x(0),H=x(0),W=x(0),q=x(0),Y=x(0),X=x(0),Q=x(0),Z=x(0),J=x(0),K=x(0),$=x(0),ee=x(0),te=x(0),ne=0,ie=0,oe=0,ae=0,re=0,se=0,ce=0,le=0,_e=0,ue=0,he=0,fe=0,pe=x(0);N=P=N-176|0,p[e+738|0]&&(c[e+744>>2]=0,c[e+36>>2]=0,p[e+736|0]||(D=A[e+664>>2],M=c[e+32>>2],X=A[M+4>>2],O=A[e+668>>2],j=A[M+8>>2],Q=A[e+672>>2],H=A[M+12>>2],$=x(x(x(x(D*X)+x(O*j))+x(Q*H))+A[M+52>>2]),G=A[e+600>>2],w=c[e+28>>2],R=A[e+604>>2],I=A[e+608>>2],te=x(x(x(x(G*A[w+4>>2])+x(R*A[w+8>>2]))+x(I*A[w+12>>2]))+A[w+52>>2]),V=x($-te),q=A[M+20>>2],Y=A[M+24>>2],F=A[M+28>>2],Z=x(x(x(x(D*q)+x(O*Y))+x(Q*F))+A[M+56>>2]),J=x(x(x(x(G*A[w+20>>2])+x(R*A[w+24>>2]))+x(I*A[w+28>>2]))+A[w+56>>2]),B=x(Z-J),ee=D,D=A[M+36>>2],pe=O,O=A[M+40>>2],K=x(x(x(x(ee*D)+x(pe*O))+x(Q*A[M+44>>2]))+A[M+60>>2]),Q=x(x(x(x(G*A[w+36>>2])+x(R*A[w+40>>2]))+x(I*A[w+44>>2]))+A[w+60>>2]),R=x(K-Q),I=(I=x(x(x(V*V)+x(B*B))+x(R*R)))>x(1.1920928955078125e-7)?(I=x(x(1)/x(T(I))),z=x(R*I),U=x(B*I),x(V*I)):x(1),c[140+P>>2]=0,A[132+P>>2]=U,A[128+P>>2]=I,A[136+P>>2]=z,fe=160+P|0,w=144+P|0,x(y(z))>x(.7071067690849304)?(R=x(x(z*z)+x(U*U)),G=x(x(1)/x(T(R))),V=x(R*G),B=x(G*x(-z)),R=x(I*B),z=x(U*G),U=x(z*x(-I))):(R=x(x(I*I)+x(U*U)),B=x(x(1)/x(T(R))),R=x(R*B),W=x(B*x(-U)),U=x(z*W),B=x(I*B),V=x(B*x(-z)),z=x(0)),A[168+P>>2]=R,A[164+P>>2]=U,A[152+P>>2]=z,A[148+P>>2]=B,A[160+P>>2]=V,A[144+P>>2]=W,c[(ne=108+P|0)>>2]=0,L=c[e+28>>2],A[(k=100+P|0)>>2]=A[L+24>>2],A[(ie=104+P|0)>>2]=A[L+40>>2],A[(oe=116+P|0)>>2]=A[L+28>>2],c[92+P>>2]=0,A[80+P>>2]=A[L+4>>2],A[84+P>>2]=A[L+20>>2],A[88+P>>2]=A[L+36>>2],A[96+P>>2]=A[L+8>>2],A[112+P>>2]=A[L+12>>2],c[(ae=124+P|0)>>2]=0,A[(re=120+P|0)>>2]=A[L+44>>2],A[(se=68+P|0)>>2]=F,c[(ce=60+P|0)>>2]=0,A[(le=56+P|0)>>2]=O,A[(_e=52+P|0)>>2]=Y,c[(ue=76+P|0)>>2]=0,A[(he=72+P|0)>>2]=A[M+44>>2],A[64+P>>2]=H,A[48+P>>2]=j,c[44+P>>2]=0,A[40+P>>2]=D,A[36+P>>2]=q,A[32+P>>2]=X,c[28+P>>2]=0,A[24+P>>2]=Q-A[L+60>>2],A[20+P>>2]=J-A[L+56>>2],A[16+P>>2]=te-A[L+52>>2],c[12+P>>2]=0,A[8+P>>2]=K-A[M+60>>2],A[4+P>>2]=Z-A[M+56>>2],A[P>>2]=$-A[M+52>>2],Kn(e+48|0,80+P|0,32+P|0,16+P|0,P,128+P|0,L+456|0,A[L+404>>2],M+456|0,A[M+404>>2]),c[ne>>2]=0,M=c[e+28>>2],A[k>>2]=A[M+24>>2],A[ie>>2]=A[M+40>>2],A[oe>>2]=A[M+28>>2],c[92+P>>2]=0,A[80+P>>2]=A[M+4>>2],A[84+P>>2]=A[M+20>>2],A[88+P>>2]=A[M+36>>2],A[96+P>>2]=A[M+8>>2],A[112+P>>2]=A[M+12>>2],c[ae>>2]=0,A[re>>2]=A[M+44>>2],c[ce>>2]=0,L=c[e+32>>2],A[_e>>2]=A[L+24>>2],A[le>>2]=A[L+40>>2],A[se>>2]=A[L+28>>2],c[44+P>>2]=0,A[32+P>>2]=A[L+4>>2],A[36+P>>2]=A[L+20>>2],A[40+P>>2]=A[L+36>>2],A[48+P>>2]=A[L+8>>2],A[64+P>>2]=A[L+12>>2],c[ue>>2]=0,A[he>>2]=A[L+44>>2],c[28+P>>2]=0,A[24+P>>2]=Q-A[M+60>>2],A[20+P>>2]=J-A[M+56>>2],A[16+P>>2]=te-A[M+52>>2],c[12+P>>2]=0,A[8+P>>2]=K-A[L+60>>2],A[4+P>>2]=Z-A[L+56>>2],A[P>>2]=$-A[L+52>>2],Kn(e+132|0,80+P|0,32+P|0,16+P|0,P,w,M+456|0,A[M+404>>2],L+456|0,A[L+404>>2]),c[ne>>2]=0,w=k,k=c[e+28>>2],A[w>>2]=A[k+24>>2],A[ie>>2]=A[k+40>>2],A[oe>>2]=A[k+28>>2],c[92+P>>2]=0,A[80+P>>2]=A[k+4>>2],A[84+P>>2]=A[k+20>>2],A[88+P>>2]=A[k+36>>2],A[96+P>>2]=A[k+8>>2],A[112+P>>2]=A[k+12>>2],c[ae>>2]=0,A[re>>2]=A[k+44>>2],c[ce>>2]=0,w=c[e+32>>2],A[_e>>2]=A[w+24>>2],A[le>>2]=A[w+40>>2],A[se>>2]=A[w+28>>2],c[44+P>>2]=0,A[32+P>>2]=A[w+4>>2],A[36+P>>2]=A[w+20>>2],A[40+P>>2]=A[w+36>>2],A[48+P>>2]=A[w+8>>2],A[64+P>>2]=A[w+12>>2],c[ue>>2]=0,A[he>>2]=A[w+44>>2],c[28+P>>2]=0,A[24+P>>2]=Q-A[k+60>>2],A[20+P>>2]=J-A[k+56>>2],A[16+P>>2]=te-A[k+52>>2],c[12+P>>2]=0,A[8+P>>2]=K-A[w+60>>2],A[4+P>>2]=Z-A[w+56>>2],A[P>>2]=$-A[w+52>>2],Kn(e+216|0,80+P|0,32+P|0,16+P|0,P,fe,k+456|0,A[k+404>>2],w+456|0,A[w+404>>2])),o=A[e+576>>2],s=A[e+560>>2],r=A[e+592>>2],I=x(y(r))>x(.7071067690849304)?(I=x(x(o*o)+x(r*r)),R=x(x(1)/x(T(I))),z=x(I*R),G=x(R*x(-r)),U=x(s*G),W=x(0),V=x(o*R),x(V*x(-s))):(I=x(x(s*s)+x(o*o)),R=x(x(1)/x(T(I))),U=x(I*R),G=x(s*R),z=x(G*x(-r)),V=x(0),W=x(R*x(-o)),x(r*W)),t=c[e+32>>2],X=A[(g=t+36|0)>>2],j=A[(b=t+20|0)>>2],H=A[(S=t+40|0)>>2],q=A[(C=t+24|0)>>2],Y=A[(E=t+8|0)>>2],F=A[(M=t+44|0)>>2],D=A[(L=t+28|0)>>2],O=A[(ne=t+12|0)>>2],n=c[e+28>>2],l=A[(k=n+44|0)>>2],_=A[(ie=n+36|0)>>2],u=A[(oe=n+40|0)>>2],h=A[(ae=n+12|0)>>2],f=A[(re=n+8|0)>>2],d=A[(se=n+28|0)>>2],m=A[(ce=n+20|0)>>2],v=A[(le=n+24|0)>>2],R=A[t+4>>2],i=A[n+4>>2],c[e+344>>2]=0,c[e+328>>2]=0,c[(w=e+308|0)>>2]=0,c[w+4>>2]=0,c[e+300>>2]=0,c[e+304>>2]=0,Z=x(x(x(W*i)+x(G*f))+x(V*h)),B=x(x(x(W*m)+x(G*v))+x(V*d)),J=x(x(x(W*_)+x(G*u))+x(V*l)),K=x(x(x(h*Z)+x(d*B))+x(l*J)),A[e+324>>2]=K,Q=x(x(x(f*Z)+x(v*B))+x(u*J)),A[e+320>>2]=Q,G=x(x(x(i*Z)+x(m*B))+x(_*J)),A[e+316>>2]=G,ee=D,D=x(-B),V=x(x(x(ee*D)-x(Z*O))-x(J*F)),A[e+340>>2]=V,B=x(x(x(q*D)-x(Z*Y))-x(J*H)),A[e+336>>2]=B,j=x(x(x(j*D)-x(Z*R))-x(J*X)),A[e+332>>2]=j,D=A[(_e=n+460|0)>>2],O=A[(ue=n+464|0)>>2],R=A[n+456>>2],c[e+360>>2]=0,H=x(K*O),A[e+356>>2]=H,q=x(Q*D),A[e+352>>2]=q,Y=x(G*R),A[e+348>>2]=Y,F=A[(he=t+460|0)>>2],O=A[(fe=t+464|0)>>2],R=A[t+456>>2],c[e+376>>2]=0,D=x(V*O),A[e+372>>2]=D,O=x(B*F),A[e+368>>2]=O,R=x(j*R),A[e+364>>2]=R,A[e+380>>2]=x(x(x(G*Y)+x(Q*q))+x(K*H))+x(x(x(j*R)+x(B*O))+x(V*D)),$=A[ie>>2],te=A[ce>>2],Z=A[oe>>2],J=A[re>>2],K=A[le>>2],Q=A[k>>2],G=A[ae>>2],V=A[se>>2],B=A[g>>2],X=A[b>>2],j=A[S>>2],H=A[C>>2],q=A[E>>2],Y=A[M>>2],F=A[L>>2],D=A[ne>>2],O=A[n+4>>2],R=A[t+4>>2],c[e+428>>2]=0,c[e+412>>2]=0,c[(w=e+392|0)>>2]=0,c[w+4>>2]=0,c[(w=e+384|0)>>2]=0,c[w+4>>2]=0,ee=F,W=x(x(x(z*m)+x(I*v))+x(U*d)),F=x(-W),pe=D,D=x(x(x(z*i)+x(I*f))+x(U*h)),I=x(x(x(z*_)+x(I*u))+x(U*l)),z=x(x(x(ee*F)-x(pe*D))-x(Y*I)),A[e+424>>2]=z,U=x(x(x(H*F)-x(D*q))-x(I*j)),A[e+420>>2]=U,B=x(x(x(X*F)-x(D*R))-x(I*B)),A[e+416>>2]=B,X=x(x(x(D*G)+x(W*V))+x(I*Q)),A[e+408>>2]=X,j=x(x(x(D*J)+x(W*K))+x(I*Z)),A[e+404>>2]=j,H=x(x(x(D*O)+x(W*te))+x(I*$)),A[e+400>>2]=H,O=A[_e>>2],R=A[ue>>2],I=A[n+456>>2],c[e+444>>2]=0,q=x(X*R),A[e+440>>2]=q,Y=x(j*O),A[e+436>>2]=Y,F=x(H*I),A[e+432>>2]=F,D=A[he>>2],R=A[fe>>2],I=A[t+456>>2],c[e+460>>2]=0,O=x(z*R),A[e+456>>2]=O,R=x(U*D),A[e+452>>2]=R,I=x(B*I),A[e+448>>2]=I,A[e+464>>2]=x(x(x(H*F)+x(j*Y))+x(X*q))+x(x(x(B*I)+x(U*R))+x(z*O)),te=A[ie>>2],Z=A[ce>>2],J=A[oe>>2],K=A[re>>2],Q=A[le>>2],G=A[k>>2],V=A[ae>>2],B=A[se>>2],X=A[g>>2],j=A[b>>2],H=A[S>>2],q=A[C>>2],Y=A[E>>2],F=A[M>>2],D=A[L>>2],O=A[ne>>2],R=A[n+4>>2],I=A[t+4>>2],c[e+512>>2]=0,c[e+496>>2]=0,c[(w=e+476|0)>>2]=0,c[w+4>>2]=0,c[(w=e+468|0)>>2]=0,c[w+4>>2]=0,ee=D,W=x(x(x(s*m)+x(o*v))+x(r*d)),D=x(-W),i=x(x(x(s*i)+x(o*f))+x(r*h)),ee=x(x(ee*D)-x(O*i)),O=x(x(x(s*_)+x(o*u))+x(r*l)),z=x(ee-x(F*O)),A[e+508>>2]=z,U=x(x(x(q*D)-x(i*Y))-x(O*H)),A[e+504>>2]=U,$=x(x(x(j*D)-x(i*I))-x(O*X)),A[e+500>>2]=$,X=x(x(x(i*V)+x(W*B))+x(O*G)),A[e+492>>2]=X,j=x(x(x(i*K)+x(W*Q))+x(O*J)),A[e+488>>2]=j,H=x(x(x(i*R)+x(W*Z))+x(O*te)),A[e+484>>2]=H,O=A[_e>>2],R=A[ue>>2],I=A[n+456>>2],c[e+528>>2]=0,q=x(X*R),A[e+524>>2]=q,Y=x(j*O),A[e+520>>2]=Y,F=x(H*I),A[e+516>>2]=F,D=A[he>>2],R=A[fe>>2],I=A[t+456>>2],c[e+724>>2]=0,c[e+544>>2]=0,O=x(z*R),A[e+540>>2]=O,R=x(U*D),A[e+536>>2]=R,I=x($*I),A[e+532>>2]=I,A[e+548>>2]=x(x(x(H*F)+x(j*Y))+x(X*q))+x(x(x($*I)+x(U*R))+x(z*O)),I=ai(e,n+4|0,t+4|0),c[(w=e+708|0)>>2]=0,c[w+4>>2]=0,A[e+728>>2]=I,a[e+716|0]=0,(R=A[e+692>>2])>=x(0)&&((z=me(x(I-A[e+688>>2])))<x(-3.1415927410125732)?z=x(z+x(6.2831854820251465)):z>x(3.1415927410125732)&&(z=x(z+x(-6.2831854820251465))),x(-R)>z?(c[e+712>>2]=1065353216,a[e+716|0]=1,A[e+708>>2]=-x(R+z)):R<z&&(c[e+712>>2]=-1082130432,a[e+716|0]=1,A[e+708>>2]=R-z)),O=A[(k=e)+560>>2],w=c[e+28>>2],R=A[e+576>>2],I=A[e+592>>2],F=x(x(x(O*A[w+4>>2])+x(R*A[w+8>>2]))+x(I*A[w+12>>2])),D=x(x(x(O*A[w+20>>2])+x(R*A[w+24>>2]))+x(I*A[w+28>>2])),I=x(x(x(O*A[w+36>>2])+x(R*A[w+40>>2]))+x(I*A[w+44>>2])),e=c[e+32>>2],A[k+720>>2]=x(1)/x(x(x(x(F*x(x(x(F*A[w+324>>2])+x(D*A[w+340>>2]))+x(I*A[w+356>>2])))+x(D*x(x(x(F*A[w+328>>2])+x(D*A[w+344>>2]))+x(I*A[w+360>>2]))))+x(I*x(x(x(F*A[w+332>>2])+x(D*A[w+348>>2]))+x(I*A[w+364>>2]))))+x(x(x(F*x(x(x(F*A[e+324>>2])+x(D*A[e+340>>2]))+x(I*A[e+356>>2])))+x(D*x(x(x(F*A[e+328>>2])+x(D*A[e+344>>2]))+x(I*A[e+360>>2]))))+x(I*x(x(x(F*A[e+332>>2])+x(D*A[e+348>>2]))+x(I*A[e+364>>2])))))),N=176+P|0},function(e,t){e|=0,t|=0;var n,i,o=x(0);if(p[e+738|0])return c[t>>2]=0,void(c[t+4>>2]=0);c[t>>2]=5,c[t+4>>2]=1,o=ai(e,c[e+28>>2]+4|0,c[e+32>>2]+4|0),c[(i=e+708|0)>>2]=0,c[4+i>>2]=0,A[e+728>>2]=o,a[e+716|0]=0;e:{t:{if((n=A[e+692>>2])>=x(0)){if((o=me(x(o-A[e+688>>2])))<x(-3.1415927410125732)?o=x(o+x(6.2831854820251465)):o>x(3.1415927410125732)&&(o=x(o+x(-6.2831854820251465))),x(-n)>o){c[e+712>>2]=1065353216,a[e+716|0]=1,A[e+708>>2]=-x(n+o);break t}if(n<o){c[e+712>>2]=-1082130432,a[e+716|0]=1,A[e+708>>2]=n-o;break t}}if(!p[e+737|0])break e}c[t>>2]=c[t>>2]+1,c[t+4>>2]=c[t+4>>2]-1}},function(e,t){e|=0,t|=0;var n,i=x(0),o=x(0),a=x(0),r=0,s=0,l=x(0),_=x(0),u=0,h=x(0),f=0,d=x(0),m=x(0),v=x(0),y=x(0),b=x(0),S=x(0),C=x(0),E=x(0),P=x(0),w=0,I=x(0),R=0,D=x(0),N=x(0),O=x(0),M=x(0),z=0,L=0,F=x(0),B=x(0),k=x(0),U=x(0),G=0,j=x(0),V=x(0),H=x(0),W=x(0),q=x(0),Y=x(0),X=x(0),Q=0,Z=x(0),J=x(0),K=x(0),$=x(0),ee=x(0),te=x(0),ne=x(0),ie=x(0),oe=x(0),ae=x(0),re=x(0),se=x(0),ce=x(0),le=(u=c[t+24>>2],c[e+32>>2]),_e=c[e+28>>2];e:{if(p[e+739|0]){if(a=A[c[e+32>>2]+404>>2],te=A[c[e+28>>2]+404>>2],i=(i=x(a+te))>x(0)?x(a/i):x(.5),o=x(x(1)-i),v=A[le+36>>2],h=A[e+664>>2],d=A[le+40>>2],P=A[e+668>>2],b=A[le+44>>2],l=A[e+672>>2],m=A[le+60>>2],ne=x(x(x(x(v*h)+x(d*P))+x(b*l))+m),V=D=x(ne-m),m=A[e+560>>2],E=A[_e+36>>2],C=A[e+576>>2],S=A[_e+40>>2],_=A[e+592>>2],O=A[_e+44>>2],Z=x(x(x(m*E)+x(C*S))+x(_*O)),y=A[e+624>>2],U=x(y*v),v=A[e+640>>2],U=x(U+x(v*d)),d=A[e+656>>2],J=x(U+x(d*b)),b=x(x(Z*i)+x(J*o)),j=x((U=b)*b),M=A[_e+4>>2],F=A[_e+8>>2],B=A[_e+12>>2],K=x(x(x(M*m)+x(F*C))+x(B*_)),I=A[le+4>>2],N=A[le+8>>2],H=A[le+12>>2],$=x(x(x(I*y)+x(N*v))+x(H*d)),b=x(x(K*i)+x($*o)),k=A[_e+20>>2],q=A[_e+24>>2],ee=A[_e+28>>2],Y=x(x(x(m*k)+x(C*q))+x(_*ee)),W=A[le+20>>2],_=v,v=A[le+24>>2],m=d,d=A[le+28>>2],X=x(x(x(y*W)+x(_*v))+x(m*d)),_=x(x(Y*i)+x(X*o)),y=x(x(1)/x(T(x(j+x(x(b*b)+x(_*_)))))),m=x(U*y),U=x(D*m),C=A[le+52>>2],H=x(C+x(x(x(I*h)+x(N*P))+x(H*l))),D=x(H-C),C=x(b*y),v=x(x(x(W*h)+x(v*P))+x(d*l)),h=A[le+56>>2],W=x(v+h),v=x(W-h),P=x(_*y),h=x(U+x(x(D*C)+x(v*P))),d=x(m*h),ie=x(V-d),l=A[e+600>>2],_=A[e+604>>2],y=A[e+608>>2],b=A[_e+60>>2],oe=x(x(x(x(E*l)+x(S*_))+x(O*y))+b),I=x(oe-b),b=A[_e+52>>2],ae=x(b+x(x(x(M*l)+x(F*_))+x(B*y))),N=x(ae-b),b=x(x(x(k*l)+x(q*_))+x(ee*y)),l=A[_e+56>>2],re=x(b+l),y=x(re-l),l=x(x(m*I)+x(x(N*C)+x(y*P))),j=x(m*l),d=x(j-d),_=x(ie-x(o*d)),b=v,v=x(P*h),se=x(b-v),ce=x(P*l),V=x(ce-v),v=x(se-x(o*V)),h=x(C*h),U=x(D-h),l=x(C*l),h=x(l-h),b=x(U-x(o*h)),j=x(I-j),D=x(j+x(i*d)),d=x(y-ce),I=x(d+x(i*V)),l=x(N-l),N=x(l+x(i*h)),s=te<x(1.1920928955078125e-7)|a<x(1.1920928955078125e-7),a=x(x(i*ie)+x(o*j)),y=x(x(i*U)+x(o*l)),h=x(x(i*se)+x(o*d)),(l=x(x(a*a)+x(x(y*y)+x(h*h))))>x(1.1920928955078125e-7)?(d=a,a=x(x(1)/x(T(l))),l=x(d*a),h=x(h*a),a=x(y*a)):(l=A[e+556>>2],y=A[e+572>>2],d=A[e+588>>2],a=x(x(x(M*l)+x(F*y))+x(B*d)),h=x(x(x(l*k)+x(y*q))+x(d*ee)),l=x(x(x(l*E)+x(y*S))+x(d*O))),r=c[t+12>>2],A[r+8>>2]=x(N*h)-x(I*a),A[r+4>>2]=x(D*a)-x(N*l),A[r>>2]=x(I*l)-x(D*h),r=c[t+20>>2],A[r+8>>2]=-x(x(b*h)-x(v*a)),A[r+4>>2]=-x(x(_*a)-x(b*l)),A[r>>2]=-x(x(v*l)-x(_*h)),S=x(x(m*a)-x(C*l)),O=x(x(P*l)-x(m*h)),d=x(x(b*S)-x(v*O)),y=x(x(C*h)-x(P*a)),E=x(x(_*O)-x(b*y)),F=x(x(v*y)-x(_*S)),B=x(x(N*S)-x(I*O)),k=x(x(D*O)-x(N*y)),M=x(x(I*y)-x(D*S)),s&&p[e+716|0]&&(B=x(i*B),k=x(i*k),M=x(i*M),d=x(o*d),E=x(o*E),F=x(o*F)),r=(f=u<<2)+c[t+12>>2]|0,A[r+8>>2]=B,A[r+4>>2]=k,A[r>>2]=M,r=c[t+20>>2],A[r+f>>2]=-F,A[r+((w=u+1|0)<<2)>>2]=-E,A[r+((R=u+2|0)<<2)>>2]=-d,d=x(x(b*P)-x(v*C)),b=x(x(_*C)-x(b*m)),v=x(x(v*m)-x(_*P)),E=x(x(N*P)-x(I*C)),_=x(x(D*C)-x(N*m)),D=x(x(I*m)-x(D*P)),s&&(E=x(i*E),D=x(i*D),d=x(o*d),b=x(o*b),v=x(o*v),_=x(i*_)),r=(f=(s=u<<1)<<2)+c[t+12>>2]|0,A[r+8>>2]=E,A[r+4>>2]=_,A[r>>2]=D,r=c[t+20>>2],A[f+r>>2]=-v,A[((z=1|s)<<2)+r>>2]=-b,A[((L=s+2|0)<<2)+r>>2]=-d,v=A[(8&p[e+748|0]?e+756|0:t+4|0)>>2],p[e+736|0]?(i=x(-y),o=x(-S),E=x(-O),b=x(-l),D=x(-h),_=x(-a),R=c[t+28>>2]):(d=A[t>>2],r=c[t+8>>2],A[r+8>>2]=l,A[r+4>>2]=h,A[r>>2]=a,f=(r=u<<2)+c[t+8>>2]|0,A[f+8>>2]=y,A[f+4>>2]=S,A[f>>2]=O,s=(f=s<<2)+c[t+8>>2]|0,A[s+8>>2]=m,A[s+4>>2]=P,A[s>>2]=C,s=c[t+16>>2],b=x(-l),A[s+8>>2]=b,D=x(-h),A[s+4>>2]=D,_=x(-a),A[s>>2]=_,E=x(-O),A[r+s>>2]=E,i=x(-y),A[s+(R<<2)>>2]=i,o=x(-S),A[s+(w<<2)>>2]=o,A[s+f>>2]=-C,A[s+(L<<2)>>2]=-m,A[s+(z<<2)>>2]=-P,R=c[t+28>>2],d=x(v*d),I=x(H-ae),N=x(W-re),M=x(ne-oe),A[R>>2]=d*x(x(x(I*a)+x(N*h))+x(M*l)),A[r+R>>2]=d*x(x(x(I*O)+x(N*S))+x(M*y)),A[f+R>>2]=d*x(x(x(I*C)+x(N*P))+x(M*m)),r=c[t+20>>2]),f=c[t+12>>2],s=g(u,12),A[f+s>>2]=a,A[(w=s+4|0)+f>>2]=h,A[(z=s+8|0)+f>>2]=l,A[(u<<=4)+f>>2]=O,A[(L=8|u)+f>>2]=y,A[(G=4|u)+f>>2]=S,A[r+s>>2]=_,A[r+z>>2]=b,A[r+w>>2]=D,A[r+u>>2]=E,A[r+L>>2]=i,A[r+G>>2]=o,i=x(v*A[t>>2]),o=x(x(Y*J)-x(Z*X)),d=x(o*a),a=x(x(Z*$)-x(K*J)),d=x(d+x(a*h)),h=x(x(K*X)-x(Y*$)),A[s+R>>2]=i*x(d+x(h*l)),A[u+R>>2]=i*x(x(x(o*O)+x(a*S))+x(h*y)),L=p[e+716|0])z=0!=p[e+737|0],s=(h=x(A[e+708>>2]*A[e+732>>2]))>x(0)?1:2;else{if(!p[e+737|0])break e;h=x(0),z=1,s=0}if(w=g(c[t+24>>2],5),A[(u=w<<2)+f>>2]=C,A[(G=u+4|0)+f>>2]=P,A[(Q=f)+(f=u+8|0)>>2]=m,A[r+u>>2]=-C,A[r+f>>2]=-m,A[r+G>>2]=-P,o=A[e+688>>2],a=A[e+692>>2],(i=me(x(o-a)))<x(-3.1415927410125732)?i=x(i+x(6.2831854820251465)):i>x(3.1415927410125732)&&(i=x(i+x(-6.2831854820251465))),(o=me(x(o+a)))<x(-3.1415927410125732)?o=x(o+x(6.2831854820251465)):o>x(3.1415927410125732)&&(o=x(o+x(-6.2831854820251465))),c[(u=(w<<2)+R|0)>>2]=0,v=2&(r=c[e+748>>2])?A[e+764>>2]:v,R=((f=i!=o)|!L)&z){4&r&&(A[c[t+32>>2]+(w<<2)>>2]=A[e+752>>2]),E=A[e+680>>2];t:if(o<=i)a=x(o<i?1:0);else{l=A[e+728>>2];n:{if((_=x(E/x(v*A[t>>2])))<x(0)){if(i<=l&&l<x(i-_)){a=x(x(i-l)/_);break t}if(a=x(0),!(l<i))break n;break t}if(a=x(0),!(_>x(0)))break t;if(l<=o&&l>x(o-_)){a=x(x(o-l)/_);break t}if(o<l)break t}a=x(1)}A[u>>2]=x(x(a*E)*A[e+732>>2])+A[u>>2],A[(R=w<<2)+c[t+36>>2]>>2]=-A[e+684>>2],A[R+c[t+40>>2]>>2]=A[e+684>>2]}if(!L)break e;return A[u>>2]=A[u>>2]+x(h*x(v*A[t>>2])),1&r&&(A[c[t+32>>2]+(w<<2)>>2]=A[e+760>>2]),i=f?(r=c[t+36>>2]+(w<<2)|0,1!=(0|s)?(c[r>>2]=-8388609,x(0)):(c[r>>2]=0,x(34028234663852886e22))):(c[c[t+36>>2]+(w<<2)>>2]=-8388609,x(34028234663852886e22)),A[c[t+40>>2]+(w<<2)>>2]=i,(o=A[e+704>>2])>x(0)&&(i=x(x(x(x(A[_e+388>>2]*C)+x(A[_e+392>>2]*P))+x(A[_e+396>>2]*m))-x(x(x(C*A[le+388>>2])+x(P*A[le+392>>2]))+x(m*A[le+396>>2]))),1!=(0|s)?i>x(0)&&(i=x(i*x(-o)))<A[u>>2]&&(A[u>>2]=i):i<x(0)&&(i=x(i*x(-o)))>A[u>>2]&&(A[u>>2]=i)),void(A[u>>2]=A[e+700>>2]*A[u>>2])}if(i=A[e+624>>2],I=A[le+36>>2],o=A[e+640>>2],N=A[le+40>>2],Z=x(x(i*I)+x(o*N)),a=A[e+656>>2],M=A[le+44>>2],J=x(a*M),F=A[le+20>>2],B=A[le+24>>2],K=x(x(i*F)+x(o*B)),k=A[le+28>>2],$=x(a*k),q=A[le+12>>2],ee=x(q*a),Y=A[le+4>>2],X=A[le+8>>2],te=x(x(Y*i)+x(X*o)),_=A[e+560>>2],i=A[_e+36>>2],S=A[e+576>>2],o=A[_e+40>>2],ne=x(x(_*i)+x(S*o)),l=A[e+592>>2],a=A[_e+44>>2],H=x(l*a),O=A[e+556>>2],y=A[e+572>>2],W=x(x(O*i)+x(y*o)),v=A[e+588>>2],ie=x(v*a),d=A[e+584>>2],oe=x(d*a),b=A[e+552>>2],D=A[e+568>>2],ae=x(x(b*i)+x(D*o)),h=A[_e+20>>2],m=A[_e+24>>2],re=x(x(_*h)+x(S*m)),C=A[_e+28>>2],j=x(l*C),P=A[_e+12>>2],se=x(P*l),l=A[_e+4>>2],E=A[_e+8>>2],ce=x(x(l*_)+x(E*S)),_=A[e+664>>2],S=A[e+668>>2],V=x(x(I*_)+x(N*S)),I=A[e+672>>2],N=x(x(V+x(M*I))+A[le+60>>2]),F=x(x(x(x(F*_)+x(B*S))+x(k*I))+A[le+56>>2]),S=x(A[le+52>>2]+x(x(x(Y*_)+x(X*S))+x(q*I))),I=A[e+600>>2],V=o,o=A[e+604>>2],U=a,a=A[e+608>>2],_=A[_e+60>>2],B=x(x(x(x(i*I)+x(V*o))+x(U*a))+_),i=A[_e+56>>2],k=x(x(x(x(h*I)+x(m*o))+x(C*a))+i),M=A[_e+52>>2],o=x(M+x(x(x(l*I)+x(E*o))+x(P*a))),f=u<<1,(z=p[e+736|0])||(s=c[t+8>>2],c[s>>2]=1065353216,c[(r=4+(u<<2)|0)+s>>2]=1065353216,c[(f=8+(u<<3)|0)+s>>2]=1065353216,s=c[t+16>>2],c[s>>2]=-1082130432,c[r+s>>2]=-1082130432,c[s+f>>2]=-1082130432,_=A[_e+60>>2],i=A[_e+56>>2],M=A[_e+52>>2],f=u<<1),r=c[t+12>>2],c[r+12>>2]=0,a=x(B-_),A[r+4>>2]=a,c[r>>2]=0,i=x(k-i),A[r+8>>2]=-i,A[(s=(w=u<<2)+r|0)>>2]=-a,a=x(o-M),A[s+8>>2]=a,c[s+12>>2]=0,c[s+4>>2]=0,A[(s=(R=f<<2)+r|0)>>2]=i,A[s+4>>2]=-a,c[s+8>>2]=0,c[s+12>>2]=0,i=A[le+52>>2],a=A[le+60>>2],_=A[le+56>>2],f=c[t+20>>2],c[f+12>>2]=0,c[f>>2]=0,_=x(F-_),A[f+8>>2]=_,a=x(N-a),A[f+4>>2]=-a,A[(s=f+w|0)>>2]=a,i=x(S-i),A[s+8>>2]=-i,c[s+12>>2]=0,c[s+4>>2]=0,A[(s=f+R|0)>>2]=-_,A[s+4>>2]=i,c[s+8>>2]=0,c[s+12>>2]=0,L=c[e+748>>2],_=A[(8&L?e+756|0:t+4|0)>>2],i=x(_*A[t>>2]),R=c[t+28>>2],z||(A[R>>2]=i*x(S-o),A[w+R>>2]=i*x(F-k),A[R+(u<<3)>>2]=i*x(N-B)),s=g(u,12),o=x(x(x(b*l)+x(D*E))+x(d*P)),A[s+r>>2]=o,z=s+4|0,a=x(x(x(b*h)+x(D*m))+x(d*C)),A[z+r>>2]=a,G=s+8|0,S=x(ae+oe),A[G+r>>2]=S,n=4|(w=u<<4),h=x(x(x(O*h)+x(y*m))+x(v*C)),A[n+r>>2]=h,m=x(x(x(l*O)+x(E*y))+x(P*v)),A[r+w>>2]=m,Q=8|w,E=x(W+ie),A[Q+r>>2]=E,A[f+z>>2]=-a,A[s+f>>2]=-o,A[f+G>>2]=-S,A[f+n>>2]=-h,A[f+w>>2]=-m,A[f+Q>>2]=-E,v=S,C=x(ce+se),S=x(K+$),P=x(re+j),O=x(te+ee),y=x(x(C*S)-x(P*O)),d=o,o=x(Z+J),l=x(ne+H),S=x(x(P*o)-x(l*S)),o=x(x(l*O)-x(C*o)),A[s+R>>2]=x(x(v*y)+x(x(d*S)+x(a*o)))*i,A[w+R>>2]=x(x(E*y)+x(x(m*S)+x(h*o)))*i,G=p[e+716|0])z=(h=x(A[e+708>>2]*A[e+732>>2]))>x(0)?1:2,s=0!=p[e+737|0];else{if(!p[e+737|0])break e;h=x(z=0),s=1}if(w=g(u,5),A[(u=w<<2)+r>>2]=C,A[(n=u+4|0)+r>>2]=P,A[(Q=r)+(r=u+8|0)>>2]=l,A[f+n>>2]=-P,A[u+f>>2]=-C,A[r+f>>2]=-l,o=A[e+688>>2],a=A[e+692>>2],(i=me(x(o-a)))<x(-3.1415927410125732)?i=x(i+x(6.2831854820251465)):i>x(3.1415927410125732)&&(i=x(i+x(-6.2831854820251465))),(o=me(x(o+a)))<x(-3.1415927410125732)?o=x(o+x(6.2831854820251465)):o>x(3.1415927410125732)&&(o=x(o+x(-6.2831854820251465))),c[(u=R+(w<<2)|0)>>2]=0,_=2&L?A[e+764>>2]:_,r=(f=s)&((s=i!=o)|!G)){4&L&&(A[c[t+32>>2]+(w<<2)>>2]=A[e+752>>2]),S=A[e+680>>2];t:if(o<=i)a=x(o<i?1:0);else{m=A[e+728>>2];n:{if((E=x(S/x(_*A[t>>2])))<x(0)){if(i<=m&&m<x(i-E)){a=x(x(i-m)/E);break t}if(a=x(0),!(m<i))break n;break t}if(a=x(0),!(E>x(0)))break t;if(m<=o&&m>x(o-E)){a=x(x(o-m)/E);break t}if(o<m)break t}a=x(1)}A[u>>2]=x(x(a*S)*A[e+732>>2])+A[u>>2],A[(r=w<<2)+c[t+36>>2]>>2]=-A[e+684>>2],A[r+c[t+40>>2]>>2]=A[e+684>>2]}G&&(A[u>>2]=A[u>>2]+x(h*x(_*A[t>>2])),1&L&&(A[c[t+32>>2]+(w<<2)>>2]=A[e+760>>2]),i=s?(s=c[t+36>>2]+(w<<2)|0,1!=(0|z)?(c[s>>2]=-8388609,x(0)):(c[s>>2]=0,x(34028234663852886e22))):(c[c[t+36>>2]+(w<<2)>>2]=-8388609,x(34028234663852886e22)),A[c[t+40>>2]+(w<<2)>>2]=i,(o=A[e+704>>2])>x(0)&&(i=x(x(x(x(C*A[_e+388>>2])+x(P*A[_e+392>>2]))+x(l*A[_e+396>>2]))-x(x(x(C*A[le+388>>2])+x(P*A[le+392>>2]))+x(l*A[le+396>>2]))),1!=(0|z)?i>x(0)&&(i=x(i*x(-o)))<A[u>>2]&&(A[u>>2]=i):i<x(0)&&(i=x(i*x(-o)))>A[u>>2]&&(A[u>>2]=i)),A[u>>2]=A[e+700>>2]*A[u>>2])}},function(e,t,n,i){e|=0,t|=0,n=x(n);e:{t:switch(1+(i|=0)|0){case 0:case 6:break t;default:break e}t:switch(t-1|0){case 1:return A[e+764>>2]=n,void(c[e+748>>2]=2|c[e+748>>2]);case 3:return A[e+760>>2]=n,void(c[e+748>>2]=1|c[e+748>>2]);case 2:return A[e+752>>2]=n,void(c[e+748>>2]=4|c[e+748>>2]);case 0:break t;default:break e}A[e+756>>2]=n,c[e+748>>2]=8|c[e+748>>2]}},function(e,t,n){e|=0,t|=0,n|=0;var i=x(0);e:{t:switch(n+1|0){case 0:case 6:break t;default:break e}t:switch(t-1|0){case 1:return x(A[e+764>>2]);case 3:return x(A[e+760>>2]);case 2:return x(A[e+752>>2]);case 0:break t;default:break e}i=A[e+756>>2]}return x(i)},function(){return 220},function(e,t,n){e|=0,t|=0,n|=0;var i,o,a=x(0);return Jn(e,t,n),A[t+52>>2]=A[e+552>>2],A[t+56>>2]=A[e+556>>2],A[t+60>>2]=A[e+560>>2],A[t+64>>2]=A[e+564>>2],A[t+68>>2]=A[e+568>>2],A[t+72>>2]=A[e+572>>2],A[t+76>>2]=A[e+576>>2],A[t+80>>2]=A[e+580>>2],A[t+84>>2]=A[e+584>>2],A[t+88>>2]=A[e+588>>2],A[t+92>>2]=A[e+592>>2],A[t+96>>2]=A[e+596>>2],A[t+100>>2]=A[e+600>>2],A[t+104>>2]=A[e+604>>2],A[t+108>>2]=A[e+608>>2],A[t+112>>2]=A[e+612>>2],A[t+116>>2]=A[e+616>>2],A[t+120>>2]=A[e+620>>2],A[t+124>>2]=A[e+624>>2],A[t+128>>2]=A[e+628>>2],A[t+132>>2]=A[e+632>>2],A[t+136>>2]=A[e+636>>2],A[t+140>>2]=A[e+640>>2],A[t+144>>2]=A[e+644>>2],A[t+148>>2]=A[e+648>>2],A[t+152>>2]=A[e+652>>2],A[t+156>>2]=A[e+656>>2],A[t+160>>2]=A[e+660>>2],A[t+164>>2]=A[e+664>>2],A[t+168>>2]=A[e+668>>2],A[t+172>>2]=A[e+672>>2],A[t+176>>2]=A[e+676>>2],c[t+184>>2]=p[e+736|0],n=c[e+684>>2],c[t+192>>2]=c[e+680>>2],c[t+196>>2]=n,c[t+188>>2]=p[e+737|0],c[t+180>>2]=p[e+740|0],i=A[e+688>>2],o=A[e+692>>2],(a=me(x(i-o)))<x(-3.1415927410125732)?a=x(a+x(6.2831854820251465)):a>x(3.1415927410125732)&&(a=x(a+x(-6.2831854820251465))),A[t+200>>2]=a,(a=me(x(i+o)))<x(-3.1415927410125732)?a=x(a+x(6.2831854820251465)):a>x(3.1415927410125732)&&(a=x(a+x(-6.2831854820251465))),A[t+204>>2]=a,A[t+208>>2]=A[e+696>>2],n=c[4+(e=e+700|0)>>2],c[t+212>>2]=c[e>>2],c[t+216>>2]=n,20812},function(e){return c[748+(e|=0)>>2]},oi,function(e){var t,n,i,o,a,r,s,l,_,u,h,f,p,d,m,v,g,y,b,S,C,E,T,P,w,I,R=0,D=0;for(N=I=N-144|0,c[36+(e|=0)>>2]=0,c[(t=136+I|0)>>2]=0,c[4+t>>2]=0,c[128+I>>2]=0,R=e+48|(c[132+I>>2]=0);c[(_=(128+I|0)+D|0)>>2]=1065353216,c[92+I>>2]=0,c[108+I>>2]=0,t=c[e+28>>2],r=A[t+4>>2],A[80+I>>2]=r,s=A[t+20>>2],A[84+I>>2]=s,n=A[t+36>>2],A[88+I>>2]=n,u=A[t+8>>2],A[96+I>>2]=u,h=A[t+24>>2],A[100+I>>2]=h,i=A[t+40>>2],A[104+I>>2]=i,f=A[t+12>>2],A[112+I>>2]=f,p=A[t+28>>2],A[116+I>>2]=p,c[124+I>>2]=0,a=A[t+44>>2],A[120+I>>2]=a,c[44+I>>2]=0,c[60+I>>2]=0,o=c[e+32>>2],d=A[o+4>>2],A[32+I>>2]=d,m=A[o+20>>2],A[36+I>>2]=m,v=A[o+36>>2],A[40+I>>2]=v,g=A[o+8>>2],A[48+I>>2]=g,y=A[o+24>>2],A[52+I>>2]=y,b=A[o+40>>2],A[56+I>>2]=b,S=A[o+12>>2],A[64+I>>2]=S,C=A[o+28>>2],A[68+I>>2]=C,c[76+I>>2]=0,E=A[o+44>>2],A[72+I>>2]=E,c[28+I>>2]=0,l=n,n=A[e+300>>2],P=i,i=A[e+304>>2],w=a,a=A[e+308>>2],T=A[t+60>>2],A[24+I>>2]=x(x(x(x(l*n)+x(P*i))+x(w*a))+T)-T,l=x(x(x(n*s)+x(i*h))+x(a*p)),s=A[t+56>>2],A[20+I>>2]=x(l+s)-s,i=x(x(x(n*r)+x(i*u))+x(a*f)),n=A[t+52>>2],A[16+I>>2]=x(i+n)-n,c[12+I>>2]=0,n=A[e+316>>2],i=A[e+320>>2],a=A[e+324>>2],r=A[o+60>>2],A[8+I>>2]=x(x(x(x(v*n)+x(b*i))+x(E*a))+r)-r,r=A[o+56>>2],A[4+I>>2]=x(x(x(x(n*m)+x(i*y))+x(a*C))+r)-r,i=x(x(x(n*d)+x(i*g))+x(a*S)),n=A[o+52>>2],A[I>>2]=x(i+n)-n,Kn(R,80+I|0,32+I|0,16+I|0,I,128+I|0,t+456|0,A[t+404>>2],o+456|0,A[o+404>>2]),R=R+84|(c[_>>2]=0),12!=(0|(D=D+4|0)););N=144+I|0},function(e,t){e=p[344+(e|=0)|0]?0:3,c[4+(t|=0)>>2]=e,c[t>>2]=e},function(e,t){e|=0,t|=0;var n,i,o,a,r,s,l,_,u,h,f,p,d,m,v,g,y,b,S=0,C=0,E=x(0),T=0;S=c[t+8>>2],c[S>>2]=1065353216,h=c[t+24>>2],c[(a=4+(T=h<<2)|0)+S>>2]=1065353216,c[S+(b=8+(f=h<<3)|0)>>2]=1065353216,C=c[e+28>>2],l=A[C+8>>2],r=A[C+12>>2],_=A[C+20>>2],s=A[C+24>>2],p=A[C+28>>2],u=A[C+36>>2],E=A[e+304>>2],d=A[C+40>>2],i=A[e+308>>2],m=A[C+44>>2],v=A[C+4>>2],o=A[e+300>>2],S=c[t+12>>2],c[S>>2]=0,c[S+12>>2]=0,u=x(x(x(o*u)+x(E*d))+x(i*m)),A[S+4>>2]=u,_=x(x(x(o*_)+x(E*s))+x(i*p)),A[S+8>>2]=-_,A[(n=S+T|0)>>2]=-u,l=x(x(x(v*o)+x(l*E))+x(r*i)),A[8+n>>2]=l,c[12+n>>2]=0,c[4+n>>2]=0,A[(n=S+f|0)>>2]=_,A[4+n>>2]=-l,S=c[e+32>>2],c[8+n>>2]=0,c[12+n>>2]=0,n=c[t+16>>2],c[n>>2]=-1082130432,c[n+a>>2]=-1082130432,c[n+b>>2]=-1082130432,p=A[S+8>>2],d=A[S+12>>2],s=A[S+36>>2],m=A[S+40>>2],v=A[S+44>>2],r=A[S+20>>2],E=A[e+320>>2],g=A[S+24>>2],i=A[e+324>>2],y=A[S+28>>2],b=A[S+4>>2],o=A[e+316>>2],n=c[t+20>>2],c[n>>2]=0,c[n+12>>2]=0,r=x(x(x(o*r)+x(E*g))+x(i*y)),A[n+8>>2]=r,s=x(x(x(o*s)+x(E*m))+x(i*v)),A[n+4>>2]=-s,A[(a=n+T|0)>>2]=s,E=x(x(x(b*o)+x(p*E))+x(d*i)),A[8+a>>2]=-E,c[12+a>>2]=0,c[4+a>>2]=0,A[4+(n=n+f|0)>>2]=E,A[n>>2]=-r,c[8+n>>2]=0,c[12+n>>2]=0,n=c[t+28>>2],a=c[e+332>>2],i=x(A[(1&a?e+336|0:t+4|0)>>2]*A[t>>2]),A[n>>2]=i*x(x(x(E+A[S+52>>2])-l)-A[C+52>>2]),A[n+T>>2]=i*x(x(x(r+A[S+56>>2])-_)-A[C+56>>2]),A[n+f>>2]=i*x(x(x(s+A[S+60>>2])-u)-A[C+60>>2]),S=h<<1,2&a&&(C=c[t+32>>2],A[C>>2]=A[e+340>>2],A[C+T>>2]=A[e+340>>2],A[C+(S<<2)>>2]=A[e+340>>2]),(i=A[e+356>>2])>x(0)&&(C=c[t+36>>2],o=x(-i),A[C>>2]=o,n=c[t+40>>2],A[n>>2]=i,(E=A[e+356>>2])>x(0)&&(A[(T=h<<2)+C>>2]=o,A[n+T>>2]=i,E=A[e+356>>2]),E>x(0)&&(A[(S<<=2)+C>>2]=o,A[S+n>>2]=i)),A[t+48>>2]=A[e+352>>2]},function(e,t,n,i){e|=0,t|=0,n=x(n);e:if(-1==(0|(i|=0))){t:switch(t-1|0){case 0:case 1:return A[e+336>>2]=n,void(c[e+332>>2]=1|c[e+332>>2]);case 2:case 3:break t;default:break e}A[e+340>>2]=n,c[e+332>>2]=2|c[e+332>>2]}},function(e,t,n){e|=0,t|=0,n|=0;var i=x(0);i=x(34028234663852886e22);e:if(-1==(0|n)){t:switch(t-1|0){case 0:case 1:return x(A[e+336>>2]);case 2:case 3:break t;default:break e}i=A[e+340>>2]}return x(i)},Pt,function(e,t,n){return Jn(e|=0,t|=0,n|=0),A[t+52>>2]=A[e+300>>2],A[t+56>>2]=A[e+304>>2],A[t+60>>2]=A[e+308>>2],A[t+64>>2]=A[e+312>>2],A[t+68>>2]=A[e+316>>2],A[t+72>>2]=A[e+320>>2],A[t+76>>2]=A[e+324>>2],A[t+80>>2]=A[e+328>>2],20928},function(e){return c[332+(e|=0)>>2]},Se,ve,function(e,t){var n,i,o=c[12+(e|=0)>>2];c[(t|=0)>>2]=c[e+8>>2],c[t+4>>2]=o,i=c[4+(n=e+16|0)>>2],c[(o=t+8|0)>>2]=c[n>>2],c[4+o>>2]=i,i=c[4+(n=e+32|0)>>2],c[(o=t+24|0)>>2]=c[n>>2],c[4+o>>2]=i,n=c[4+(o=e+24|0)>>2],c[t+16>>2]=c[o>>2],c[t+20>>2]=n,n=c[4+(o=e+40|0)>>2],c[t+32>>2]=c[o>>2],c[t+36>>2]=n,i=c[4+(n=e+48|0)>>2],c[(o=t+40|0)>>2]=c[n>>2],c[4+o>>2]=i,i=c[4+(n=e- -64|0)>>2],c[(o=t+56|0)>>2]=c[n>>2],c[4+o>>2]=i,o=c[4+(e=e+56|0)>>2],c[t+48>>2]=c[e>>2],c[t+52>>2]=o},function(e,t){var n,i,o=c[4+(t|=0)>>2];c[8+(e|=0)>>2]=c[t>>2],c[e+12>>2]=o,i=c[4+(n=t+8|0)>>2],c[(o=e+16|0)>>2]=c[n>>2],c[4+o>>2]=i,i=c[4+(n=t+24|0)>>2],c[(o=e+32|0)>>2]=c[n>>2],c[4+o>>2]=i,n=c[t+20>>2],c[(o=e+24|0)>>2]=c[t+16>>2],c[4+o>>2]=n,n=c[t+36>>2],c[(o=e+40|0)>>2]=c[t+32>>2],c[4+o>>2]=n,i=c[4+(n=t+40|0)>>2],c[(o=e+48|0)>>2]=c[n>>2],c[4+o>>2]=i,i=c[4+(n=t+56|0)>>2],c[(o=e- -64|0)>>2]=c[n>>2],c[4+o>>2]=i,n=c[t+52>>2],c[(o=e+56|0)>>2]=c[t+48>>2],c[4+o>>2]=n,w(c[e+4>>2])}];function di(){return i.byteLength/65536|0}function mi(e){var o=0|di();return o<(e=o+(e|=0)|0)&&e<65536&&(e=new ArrayBuffer(g(e,65536)),new Int8Array(e).set(a),a=new Int8Array(e),s=new Int16Array(e),c=new Int32Array(e),p=new Uint8Array(e),d=new Uint16Array(e),m=new Uint32Array(e),A=new Float32Array(e),v=new Float64Array(e),i=e,n.buffer=i,t=p),o}return{RayCallback_hasHit:function(e){return 0!=c[8+(e|=0)>>2]|0},ccClosestRayCallback_static:function(){return p[22e3]||(c[5502]=1065353216,c[5503]=0,a[22092]=1,c[5501]=7304,c[5504]=-1,c[5505]=0,c[5522]=0,F(22),a[22e3]=1),22004},ccClosestRayCallback_reset:function(e,t,n,i,o){n|=0,i|=0,o|=0;var r,s=c[4+(t|=0)>>2];c[20+(e|=0)>>2]=c[t>>2],c[e+24>>2]=s,r=c[4+(t=t+8|0)>>2],c[(s=e+28|0)>>2]=c[t>>2],c[4+s>>2]=r,t=c[n+4>>2],c[e+36>>2]=c[n>>2],c[e+40>>2]=t,s=c[4+(n=n+8|0)>>2],c[(t=e+44|0)>>2]=c[n>>2],c[t+4>>2]=s,a[e+88|0]=o,c[e+12>>2]=i,c[e+4>>2]=1065353216,c[e+8>>2]=0},ccClosestRayCallback_getHitNormalWorld:function(e){return 52+(e|=0)|0},ccClosestRayCallback_getHitPointWorld:function(e){return 68+(e|=0)|0},ccClosestRayCallback_getCollisionShapePtr:function(e){return c[84+(e|=0)>>2]},ccAllRayCallback_static:function(){return p[22096]||(a[22136]=1,c[5526]=1065353216,c[5527]=0,a[22188]=1,c[5531]=0,c[5532]=0,a[22208]=1,c[5544]=0,c[5545]=0,a[22228]=1,c[5549]=0,c[5550]=0,c[5554]=0,c[5555]=0,a[22248]=1,c[5525]=7508,c[5529]=0,c[5533]=0,c[5546]=0,c[5551]=0,c[5556]=0,c[5561]=0,a[22252]=1,c[5559]=0,c[5560]=0,c[5528]=-1,F(23),a[22096]=1),22100},ccAllRayCallback_reset:function(e,t,n,i,o){n|=0,i|=0,o|=0;var r,s,l=0;if(N=s=N-16|0,l=c[4+(t|=0)>>2],c[40+(e|=0)>>2]=c[t>>2],c[e+44>>2]=l,r=c[4+(t=t+8|0)>>2],c[(l=e+48|0)>>2]=c[t>>2],c[l+4>>2]=r,t=c[n+4>>2],c[e+56>>2]=c[n>>2],c[e+60>>2]=t,l=c[4+(n=n+8|0)>>2],c[(t=e- -64|0)>>2]=c[n>>2],c[t+4>>2]=l,a[e+152|0]=o,c[e+12>>2]=i,c[e+4>>2]=1065353216,((c[e+8>>2]=0)|(n=c[e+136>>2]))<=-1&&(t=c[e+144>>2],c[e+140>>2]<=-1&&(t&&p[e+148|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),a[e+148|0]=1,c[e+140>>2]=0,t=c[e+144>>2]=0),B((i=t)+(t=n<<2)|0,0,0-t|0)),((c[e+136>>2]=0)|(n=c[e+116>>2]))<=-1&&(t=c[e+124>>2],c[e+120>>2]<=-1&&(t&&p[e+128|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),a[e+128|0]=1,c[e+120>>2]=0,t=c[e+124>>2]=0),B((i=t)+(t=n<<2)|0,0,0-t|0)),((c[e+116>>2]=0)|(n=c[e+24>>2]))<=-1)for(c[e+28>>2]<=-1&&((t=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+28>>2]=0,c[e+32>>2]=0,a[e+36|0]=1),t=n<<2;t=t+4|(c[c[e+32>>2]+t>>2]=0),(i=n)>>>0<=(n=n+1|0)>>>0;);if(((c[e+24>>2]=0)|(n=c[e+96>>2]))<=-1)for(c[e+100>>2]<=-1&&((t=c[e+104>>2])&&p[e+108|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+100>>2]=0,c[e+104>>2]=0,a[e+108|0]=1),t=n<<4;l=c[4+s>>2],i=c[e+104>>2]+t|0,c[i>>2]=c[s>>2],c[i+4>>2]=l,l=c[4+(o=8+s|0)>>2],c[(i=i+8|0)>>2]=c[o>>2],c[i+4>>2]=l,t=t+16|0,(i=n)>>>0<=(n=n+1|0)>>>0;);if(((c[e+96>>2]=0)|(n=c[e+76>>2]))<=-1)for(c[e+80>>2]<=-1&&((t=c[e+84>>2])&&p[e+88|0]&&(c[5499]=c[5499]+1,z(c[t-4>>2])),c[e+80>>2]=0,c[e+84>>2]=0,a[e+88|0]=1),t=n<<4;l=c[4+s>>2],i=c[e+84>>2]+t|0,c[i>>2]=c[s>>2],c[i+4>>2]=l,l=c[4+(o=8+s|0)>>2],c[(i=i+8|0)>>2]=c[o>>2],c[i+4>>2]=l,t=t+16|0,(i=n)>>>0<=(n=n+1|0)>>>0;);c[e+76>>2]=0,N=16+s|0},ccAllRayCallback_getHitPointWorld:ye,ccAllRayCallback_getHitNormalWorld:function(e){return 72+(e|=0)|0},ccAllRayCallback_getCollisionShapePtrs:function(e){return 132+(e|=0)|0},ManifoldPoint_get_m_positionWorldOnA:be,ManifoldPoint_get_m_positionWorldOnB:function(e){return 32+(e|=0)|0},ManifoldPoint_get_m_normalWorldOnB:function(e){return(e|=0)- -64|0},ManifoldPoint_get_m_localPointA:Se,ManifoldPoint_get_m_localPointB:function(e){return 16+(e|=0)|0},ManifoldPoint_getDistance:function(e){return e|=0,x(0),e=A[e+80>>2],x(y(e))<x(2147483648)?0|~~e:-2147483648},ManifoldPoint_getShape0:function(e){return c[200+(e|=0)>>2]},ManifoldPoint_getShape1:Ce,ManifoldPoint_get_m_index0:function(e){return c[108+(e|=0)>>2]},ManifoldPoint_get_m_index1:function(e){return c[112+(e|=0)>>2]},PersistentManifold_getBody0:function(e){return c[836+(e|=0)>>2]},PersistentManifold_getBody1:function(e){return c[840+(e|=0)>>2]},PersistentManifold_getNumContacts:function(e){return c[844+(e|=0)>>2]},PersistentManifold_getContactPoint:function(e,t){return e|=0,4+(g(t|=0,208)+e|0)|0},CollisionObject_new:function(){var e=0,t=0;return c[5498]=c[5498]+1,(t=M(343))&&(c[(e=t+19&-16)-4>>2]=t),c[e+132>>2]=0,c[e+136>>2]=0,c[e>>2]=7664,c[e+188>>2]=0,c[e+192>>2]=0,c[e+180>>2]=0,c[e+184>>2]=1566444395,c[e+172>>2]=1065353216,c[e+176>>2]=0,c[e+164>>2]=1065353216,c[e+168>>2]=1065353216,a[e+300|0]=1,c[e+276>>2]=0,c[e+280>>2]=0,c[e+268>>2]=1065353216,c[e+272>>2]=0,c[e+260>>2]=-1,c[e+264>>2]=-1,c[e+252>>2]=1,c[e+256>>2]=0,c[e+244>>2]=1036831949,c[e+248>>2]=1176256512,c[e+236>>2]=0,c[e+240>>2]=0,c[e+228>>2]=1056964608,c[e+232>>2]=0,c[e+220>>2]=1,c[e+224>>2]=0,c[e+212>>2]=-1,c[e+216>>2]=-1,c[e+204>>2]=1,c[e+208>>2]=-1,c[(t=e+140|0)>>2]=0,c[t+4>>2]=0,c[(t=e+148|0)>>2]=0,c[t+4>>2]=0,c[(t=e+156|0)>>2]=0,c[t+4>>2]=0,c[(t=e+196|0)>>2]=0,c[t+4>>2]=0,c[e+304>>2]=0,c[e+296>>2]=0,c[e+288>>2]=0,c[e+292>>2]=0,c[e+4>>2]=1065353216,c[e+8>>2]=0,c[e+12>>2]=0,c[(t=e+16|0)>>2]=0,c[t+4>>2]=0,c[e+24>>2]=1065353216,c[e+28>>2]=0,c[e+32>>2]=0,c[(t=e+36|0)>>2]=0,c[t+4>>2]=0,c[e+44>>2]=1065353216,c[e+48>>2]=0,c[e+52>>2]=0,c[(t=e+56|0)>>2]=0,c[t+4>>2]=0,c[(t=e- -64|0)>>2]=0,c[t+4>>2]=1065353216,c[e+72>>2]=0,c[e+76>>2]=0,c[(t=e+80|0)>>2]=0,c[t+4>>2]=0,c[e+88>>2]=1065353216,c[e+92>>2]=0,c[e+96>>2]=0,c[(t=e+100|0)>>2]=0,c[t+4>>2]=0,c[e+112>>2]=0,c[e+116>>2]=0,c[e+108>>2]=1065353216,c[(t=e+120|0)>>2]=0,c[t+4>>2]=0,(c[e+128>>2]=0)|e},CollisionObject_del:Te,CollisionObject_isStaticObject:function(e){return 1&c[204+(e|=0)>>2]},CollisionObject_isKinematicObject:function(e){return(2&p[204+(e|=0)|0])>>>1|0},CollisionObject_isStaticOrKinematicObject:function(e){return 0!=(3&p[204+(e|=0)|0])|0},CollisionObject_forceActivationState:function(e,t){c[220+(e|=0)>>2]=t|=0},CollisionObject_activate:function(e,t){t|=0,3&p[204+(e|=0)|0]&&!t||(4!=(-2&c[e+220>>2])&&(c[e+220>>2]=1),c[e+224>>2]=0)},CollisionObject_isActive:function(e){return 2!=(0|(e=c[220+(e|=0)>>2]))&5!=(0|e)},CollisionObject_setMaterial:function(e,t,n,i,o){e|=0,t=x(t),n=x(n),i=x(i),o=x(o),A[e+232>>2]=t,A[e+236>>2]=i,A[e+228>>2]=n,A[e+240>>2]=o,c[e+304>>2]=c[e+304>>2]+4},CollisionObject_getCollisionFlags:Ce,CollisionObject_setCollisionFlags:function(e,t){c[204+(e|=0)>>2]=t|=0},CollisionObject_getWorldTransform:Pe,CollisionObject_setCollisionShape:we,CollisionObject_getCollisionShape:function(e){return c[192+(e|=0)>>2]},CollisionObject_getCcdMotionThreshold:function(e){return x(A[276+(e|=0)>>2])},CollisionObject_setCcdMotionThreshold:function(e,t){e|=0,t=x(t),A[e+276>>2]=t},CollisionObject_getCcdSweptSphereRadius:function(e){return x(A[272+(e|=0)>>2])},CollisionObject_setCcdSweptSphereRadius:function(e,t){e|=0,t=x(t),A[e+272>>2]=t},CollisionObject_getUserIndex:function(e){return c[264+(e|=0)>>2]},CollisionObject_setUserIndex:function(e,t){c[264+(e|=0)>>2]=t|=0},CollisionObject_getActivationState:function(e){return c[220+(e|=0)>>2]},CollisionObject_setIgnoreCollisionCheck:function(e,t,n){t|=0;var i=0,o=0,r=0,s=0;i=c[288+(e|=0)>>2];e:if(n|=0){if(c[e+292>>2]==(0|i)&&!((0|(r=i?i<<1:1))<=(0|i))){if(r&&(c[5498]=c[5498]+1,(n=M(19+(r<<2)|0))&&(c[(s=n+19&-16)-4>>2]=n)),1<=(0|i))for(n=0,o=i;c[n+s>>2]=c[c[e+296>>2]+n>>2],n=n+4|0,o=o-1|0;);(n=c[e+296>>2])&&p[e+300|0]&&(c[5499]=c[5499]+1,z(c[n-4>>2]),i=c[e+288>>2]),c[e+296>>2]=s,c[e+292>>2]=r,a[e+300|0]=1}c[e+288>>2]=o=i+1|0,c[c[e+296>>2]+(i<<2)>>2]=t}else if((0|i)<1)o=i;else{n=s=c[e+296>>2];t:{for(;;){if(c[n>>2]==(0|t))break t;if(n=n+4|0,(0|(o=o+1|0))==(0|i))break}o=i;break e}(0|i)<=(0|o)?o=i:(c[(r=n)>>2]=c[(n=(o=i-1|0)<<2)+s>>2],c[e+288>>2]=o,c[n+c[e+296>>2]>>2]=t)}c[e+280>>2]=0<(0|o)},CollisionShape_del:Te,CollisionShape_setMaterial:function(e,t){c[16+(e|=0)>>2]=t|=0},CollisionShape_getMaterial:Ot,CollisionShape_setUserPointer:function(e,t){c[8+(e|=0)>>2]=t|=0},CollisionShape_getUserPointer:Mt,CollisionShape_getLocalScaling:function(e){return 0|pi[c[c[(e|=0)>>2]+28>>2]](e)},CollisionShape_setLocalScaling:function(e,t){pi[c[c[(e|=0)>>2]+24>>2]](e,t|=0)},CollisionShape_calculateLocalInertia:function(e,t,n){e|=0,t=x(t),pi[c[c[e>>2]+32>>2]](e,t,n|=0)},CollisionShape_isCompound:function(e){return 31==c[4+(e|=0)>>2]|0},CollisionShape_getAabb:zt,CollisionShape_getLocalBoundingSphere:function(e){e|=0;var t,n;return c[(t=44+(N=n=N-96|0)|0)>>2]=0,c[4+t>>2]=0,c[(t=56+n|0)>>2]=0,c[4+t>>2]=0,c[52+n>>2]=1065353216,c[(t=n+64|0)>>2]=0,c[4+t>>2]=0,c[(t=76+n|0)>>2]=0,c[4+t>>2]=0,c[72+n>>2]=1065353216,c[(t=84+n|0)>>2]=0,c[4+t>>2]=0,c[92+n>>2]=0,c[36+n>>2]=0,c[40+n>>2]=0,c[32+n>>2]=1065353216,pi[c[c[e>>2]+8>>2]](e,32+n|0,16+n|0,n),N=96+n|0,t=x(A[n>>2]-A[16+n>>2]),e=x(t*t),t=x(A[4+n>>2]-A[20+n>>2]),e=x(e+x(t*t)),t=x(A[8+n>>2]-A[24+n>>2]),x(x(x(T(x(e+x(t*t))))*x(.5)))},CollisionShape_setMargin:function(e,t){e|=0,t=x(t),pi[c[c[e>>2]+44>>2]](e,t)},BoxShape_new:function(e){e|=0;var t,n,i,o=0,a=x(0),r=x(0),s=0;return c[5498]=c[5498]+1,(s=M(83))&&(c[(o=s+19&-16)-4>>2]=s),c[o+52>>2]=1025758986,c[o+28>>2]=1065353216,c[o+32>>2]=0,c[o+20>>2]=1065353216,c[o+24>>2]=1065353216,c[o+12>>2]=0,c[o+16>>2]=0,c[o+4>>2]=0,c[o+8>>2]=0,r=A[e+8>>2],a=A[e+4>>2],t=A[e>>2],c[o+48>>2]=0,t=x(t+x(-.03999999910593033)),A[o+36>>2]=t,n=x(a+x(-.03999999910593033)),A[o+40>>2]=n,i=x(r+x(-.03999999910593033)),A[o+44>>2]=i,c[o+60>>2]=0,c[o>>2]=8140,r=A[e>>2],a=A[e+4>>2],(a=x(A[((A[e+8>>2]>((s=r<a)?r:a)?!s:2)<<2)+e>>2]*x(.10000000149011612)))<x(.03999999910593033)&&(r=A[o+52>>2],A[o+52>>2]=a,a=A[o+52>>2],c[o+48>>2]=0,A[o+44>>2]=x(r+i)-a,A[o+40>>2]=x(r+n)-a,A[o+36>>2]=x(r+t)-a),0|o},BoxShape_setUnscaledHalfExtents:function(e,t){e|=0,t|=0;var n=x(0),i=(n=x(pi[c[c[e>>2]+48>>2]](e)),x(pi[c[c[e>>2]+48>>2]](e))),o=x(pi[c[c[e>>2]+48>>2]](e)),a=A[t>>2],r=A[t+4>>2],s=A[t+8>>2];c[e+48>>2]=0,A[e+44>>2]=x(s*A[e+28>>2])-o,A[e+40>>2]=x(r*A[e+24>>2])-i,A[e+36>>2]=x(a*A[e+20>>2])-n,n=A[t>>2],i=A[t+4>>2],n=x(A[((A[t+8>>2]>((a=n<i)?n:i)?!a:2)<<2)+t>>2]*x(.10000000149011612)),x(pi[c[c[e>>2]+48>>2]](e))>n&&pi[c[c[e>>2]+44>>2]](e,n)},SphereShape_new:function(e){e=x(e);var t=0,n=0;return c[5498]=c[5498]+1,(n=M(79))&&(c[(t=n+19&-16)-4>>2]=n),c[t+32>>2]=0,c[t+36>>2]=0,c[t+12>>2]=0,c[t+16>>2]=0,c[t+4>>2]=8,c[t+8>>2]=0,c[t+28>>2]=1065353216,c[t+20>>2]=1065353216,c[t+24>>2]=1065353216,c[t>>2]=11936,c[t+56>>2]=0,A[t+52>>2]=e,A[t+36>>2]=e,c[(n=t+40|0)>>2]=0,c[n+4>>2]=0,(c[t+48>>2]=0)|t},SphereShape_setUnscaledRadius:function(e,t){e|=0,t=x(t),A[e+52>>2]=t,A[e+36>>2]=t},CapsuleShape_new:function(e,t){e=x(e),t=x(t);var n,i=0;return c[5498]=c[5498]+1,(n=M(83))&&(c[(i=n+19&-16)-4>>2]=n),c[i+28>>2]=1065353216,c[i+32>>2]=0,c[i+20>>2]=1065353216,c[i+24>>2]=1065353216,c[i+12>>2]=0,c[i+16>>2]=0,c[i+4>>2]=10,c[i+8>>2]=0,A[i+52>>2]=e,c[i>>2]=8500,c[i+60>>2]=1,c[i+48>>2]=0,A[i+44>>2]=e,A[i+36>>2]=e,A[i+40>>2]=t*x(.5),0|i},CapsuleShape_updateProp:function(e,t,n,i){e|=0,t=x(t),n=x(n),i|=0;var o,a=x(0),r=x(0);c[e+20>>2]=1065353216,c[e+24>>2]=1065353216,c[e+60>>2]=i,c[(o=e+28|0)>>2]=1065353216,r=t,a=n;e:{switch((c[4+o>>2]=0)|i){case 0:r=n,a=t;break e;case 1:break e}a=t,t=n}A[e+36>>2]=r,c[e+48>>2]=0,A[e+44>>2]=t,A[e+40>>2]=a,A[e+52>>2]=A[(e+36|0)+((i+2|0)%3<<2)>>2]},ConvexInternalShape_getImplicitShapeDimensions:function(e){return 36+(e|=0)|0},CylinderShape_new:function(e){e|=0;var t,n,i,o=0,a=x(0),r=x(0),s=0;return c[5498]=c[5498]+1,(s=M(83))&&(c[(o=s+19&-16)-4>>2]=s),c[o+52>>2]=1025758986,c[o+28>>2]=1065353216,c[o+32>>2]=0,c[o+20>>2]=1065353216,c[o+24>>2]=1065353216,c[o+12>>2]=0,c[o+16>>2]=0,c[o+4>>2]=35,c[o+8>>2]=0,r=A[e+8>>2],a=A[e+4>>2],t=A[e>>2],c[o+48>>2]=0,t=x(t+x(-.03999999910593033)),A[o+36>>2]=t,n=x(a+x(-.03999999910593033)),A[o+40>>2]=n,i=x(r+x(-.03999999910593033)),A[o+44>>2]=i,c[o+60>>2]=1,c[o>>2]=8664,r=A[e>>2],a=A[e+4>>2],(a=x(A[((A[e+8>>2]>((s=r<a)?r:a)?!s:2)<<2)+e>>2]*x(.10000000149011612)))<x(.03999999910593033)&&(r=A[o+52>>2],A[o+52>>2]=a,a=A[o+52>>2],c[o+48>>2]=0,A[o+44>>2]=x(r+i)-a,A[o+40>>2]=x(r+n)-a,A[o+36>>2]=x(r+t)-a),c[o+4>>2]=13,0|o},CylinderShape_updateProp:function(e,t,n,i){e|=0,t=x(t),n=x(n),i|=0;var o,a=x(0),r=x(0);c[e+20>>2]=1065353216,c[e+24>>2]=1065353216,c[e+60>>2]=i,c[(o=e+28|0)>>2]=1065353216,r=t,a=n;e:{switch((c[4+o>>2]=0)|i){case 0:r=n,a=t;break e;case 1:break e}a=t,t=n}A[e+36>>2]=r,c[e+48>>2]=0,A[(i=e+44|0)>>2]=t,A[(o=e+40|0)>>2]=a,t=x(pi[c[c[e>>2]+48>>2]](e)),n=x(pi[c[c[e>>2]+48>>2]](e)),a=x(pi[c[c[e>>2]+48>>2]](e)),A[e+36>>2]=A[e+36>>2]-t,A[o>>2]=A[o>>2]-n,A[i>>2]=A[i>>2]-a},ConeShape_new:function(e,t){e=x(e),t=x(t);var n,i=0;return c[5498]=c[5498]+1,(n=M(103))&&(c[(i=n+19&-16)-4>>2]=n),c[i+52>>2]=1025758986,c[i+28>>2]=1065353216,c[i+32>>2]=0,c[i+20>>2]=1065353216,c[i+24>>2]=1065353216,c[i+12>>2]=0,c[i+16>>2]=0,c[i+4>>2]=11,c[i+8>>2]=0,A[i+68>>2]=t,A[i+64>>2]=e,c[i>>2]=8828,c[i+80>>2]=2,c[i+72>>2]=0,c[i+76>>2]=1,A[i+44>>2]=e,A[i+40>>2]=t,A[i+36>>2]=e,A[i+60>>2]=e/x(T(x(x(e*e)+x(t*t)))),0|i},ConeShape_setRadius:function(e,t){e|=0,t=x(t),A[e+64>>2]=t},ConeShape_setHeight:function(e,t){e|=0,t=x(t),A[e+68>>2]=t},ConeShape_setConeUpIndex:function(e,t){e|=0;var n,i=0,o=0;e:{switch(0|(t|=0)){default:i=c[e+76>>2],o=c[e+72>>2],t=c[e+80>>2];break e;case 0:c[e+72>>2]=1,c[e+76>>2]=0,o=1,t=c[e+80>>2]=2;break e;case 1:c[e+72>>2]=0,i=c[e+76>>2]=1,t=c[e+80>>2]=2;break e;case 2:}c[e+72>>2]=0,i=c[e+76>>2]=2,t=c[e+80>>2]=1}A[(n=e+36|0)+(o<<2)>>2]=A[e+64>>2],A[(i<<2)+n>>2]=A[e+68>>2],A[(t<<2)+n>>2]=A[e+64>>2]},StaticPlaneShape_new:function(e,t){e|=0,t=x(t);var n,i,o,a=0;return c[5498]=c[5498]+1,(o=M(111))&&(c[(a=o+19&-16)-4>>2]=o),c[a+20>>2]=0,c[a+12>>2]=0,c[a+16>>2]=0,c[a+4>>2]=35,c[a+8>>2]=0,c[a>>2]=9008,n=A[e+8>>2],i=A[e>>2],o=A[e+4>>2],e=A[e+12>>2],c[a+84>>2]=1065353216,c[a+88>>2]=0,c[a+76>>2]=1065353216,c[a+80>>2]=1065353216,A[a+72>>2]=t,A[a+68>>2]=e,c[a+4>>2]=28,t=x(x(1)/x(T(x(x(x(i*i)+x(o*o))+x(n*n))))),A[a+64>>2]=n*t,A[a+60>>2]=o*t,A[a+56>>2]=i*t,0|a},StaticPlaneShape_setPlaneConstant:function(e,t){e|=0,t=x(t),A[e+72>>2]=t},StaticPlaneShape_getPlaneNormal:function(e){return 56+(e|=0)|0},ccCompoundShape_new:function(){var e,t=0,n=0,i=0,o=c[5498];return(n=M(119))&&(c[(t=n+19&-16)-4>>2]=n),c[(n=t+32|0)>>2]=0,c[n+4>>2]=0,c[t+8>>2]=0,c[t+12>>2]=0,c[t>>2]=9180,c[t+96>>2]=0,c[t+88>>2]=1065353216,c[t+92>>2]=1065353216,c[t+80>>2]=0,c[t+84>>2]=1065353216,c[t+72>>2]=0,c[t+76>>2]=1,c[t+64>>2]=-581039253,c[t+68>>2]=0,c[t+56>>2]=-581039253,c[t+60>>2]=-581039253,c[t+48>>2]=1566444395,c[t+52>>2]=0,c[t+40>>2]=1566444395,c[t+44>>2]=1566444395,c[t+24>>2]=0,c[t+28>>2]=0,c[t+4>>2]=31,c[(e=t+16|0)>>2]=0,c[4+e>>2]=0,c[5498]=o+2,a[t+36|0]=1,c[n>>2]=0,(n=M(59))&&(c[(i=n+19&-16)-4>>2]=n),c[i+32>>2]=0,a[i+36|0]=1,c[i+24>>2]=0,c[i+28>>2]=0,c[i+16>>2]=0,c[i+8>>2]=-1,c[i+12>>2]=0,c[i>>2]=0,c[i+4>>2]=0,c[t+72>>2]=i,c[t>>2]=12064,0|t},CompoundShape_getNumChildShapes:gt,CompoundShape_addChildShape:function(e,t,n){e|=0,t|=0,n|=0;var i,o,r,s,l,_,u,h,f,d,m,v=0,y=0,b=0,S=x(0),C=0,E=0,T=N-128|0;if(N=T,c[e+76>>2]=c[e+76>>2]+1,v=c[(y=t+24|0)>>2],y=c[y+4>>2],C=c[(b=t+8|0)>>2],b=c[b+4>>2],h=c[(l=t+40|0)>>2],l=c[4+l>>2],f=c[t+16>>2],u=c[t+20>>2],i=c[t>>2],o=c[t+4>>2],d=c[t+32>>2],r=c[t+36>>2],m=c[4+(_=t+56|0)>>2],c[(s=120+T|0)>>2]=c[_>>2],c[4+s>>2]=m,c[(s=104+T|0)>>2]=h,c[4+s>>2]=l,c[(l=72+T|0)>>2]=C,c[4+l>>2]=b,c[(b=88+T|0)>>2]=v,c[b+4>>2]=y,y=c[t+52>>2],c[112+T>>2]=c[t+48>>2],c[116+T>>2]=y,c[96+T>>2]=d,c[100+T>>2]=r,c[64+T>>2]=i,c[68+T>>2]=o,c[80+T>>2]=f,c[84+T>>2]=u,d=c[n+4>>2],m=x(pi[c[c[n>>2]+48>>2]](n)),pi[c[c[n>>2]+8>>2]](n,t,48+T|0,32+T|0),(S=A[48+T>>2])<A[e+40>>2]&&(A[e+40>>2]=S),(S=A[32+T>>2])>A[e+56>>2]&&(A[e+56>>2]=S),(S=A[52+T>>2])<A[e+44>>2]&&(A[e+44>>2]=S),(S=A[36+T>>2])>A[e+60>>2]&&(A[e+60>>2]=S),(S=A[56+T>>2])<A[e+48>>2]&&(A[e+48>>2]=S),(S=A[40+T>>2])>A[e- -64>>2]&&(A[e+64>>2]=S),(y=c[e+72>>2])?(b=c[4+(v=40+T|0)>>2],c[(t=24+T|0)>>2]=c[v>>2],c[t+4>>2]=b,b=c[4+(v=56+T|0)>>2],c[(t=8+T|0)>>2]=c[v>>2],c[t+4>>2]=b,t=c[52+T>>2],c[T>>2]=c[48+T>>2],c[4+T>>2]=t,t=c[36+T>>2],c[16+T>>2]=c[32+T>>2],c[20+T>>2]=t,b=c[e+24>>2],(t=c[y+4>>2])?c[y+4>>2]=0:(c[5498]=c[5498]+1,t=0,(v=M(63))&&(c[(t=v+19&-16)-4>>2]=v),c[t>>2]=0,c[t+4>>2]=0,c[t+40>>2]=0,c[(v=t+32|0)>>2]=0,c[v+4>>2]=0,c[(v=t+24|0)>>2]=0,c[v+4>>2]=0,c[(v=t+16|0)>>2]=0,c[v+4>>2]=0,c[(v=t+8|0)>>2]=0,c[v+4>>2]=0),c[t+36>>2]=b,v=c[4+T>>2],c[t>>2]=c[T>>2],c[t+4>>2]=v,c[t+40>>2]=0,C=c[4+(b=8+T|0)>>2],c[(v=t+8|0)>>2]=c[b>>2],c[v+4>>2]=C,C=c[4+(b=16+T|0)>>2],c[(v=t+16|0)>>2]=c[b>>2],c[v+4>>2]=C,C=c[4+(b=24+T|0)>>2],c[(v=t+24|0)>>2]=c[b>>2],c[v+4>>2]=C,c[t+32>>2]=0,ht(y,c[y>>2],t),c[y+12>>2]=c[y+12>>2]+1):t=0,l=112+T|0,h=96+T|0,f=80+T|0,(0|(y=c[e+24>>2]))==c[e+28>>2]&&!((0|(u=y?y<<1:1))<=(0|y))){if(u&&(c[5498]=c[5498]+1,(v=M(g(u,80)+19|0))&&(c[(E=v+19&-16)-4>>2]=v)),1<=(0|y))for(C=64;b=c[e+32>>2]+C|0,s=c[4+(i=b+-64|0)>>2],c[(o=(v=C+E|0)-64|0)>>2]=c[i>>2],c[4+o>>2]=s,r=c[4+(i=8+i|0)>>2],c[(o=8+o|0)>>2]=c[i>>2],c[4+o>>2]=r,_=c[4+(s=8+(o=b-48|0)|0)>>2],c[(r=8+(i=v-48|0)|0)>>2]=c[s>>2],c[4+r>>2]=_,r=c[4+o>>2],c[i>>2]=c[o>>2],c[4+i>>2]=r,_=c[4+(s=8+(o=b-32|0)|0)>>2],c[(r=8+(i=v-32|0)|0)>>2]=c[s>>2],c[4+r>>2]=_,r=c[4+o>>2],c[i>>2]=c[o>>2],c[4+i>>2]=r,_=c[4+(s=8+(o=b-16|0)|0)>>2],c[(r=8+(i=v-16|0)|0)>>2]=c[s>>2],c[4+r>>2]=_,r=c[4+o>>2],c[i>>2]=c[o>>2],c[4+i>>2]=r,i=c[b+4>>2],c[v>>2]=c[b>>2],c[v+4>>2]=i,i=c[4+(b=b+8|0)>>2],c[(v=v+8|0)>>2]=c[b>>2],c[v+4>>2]=i,C=C+80|0,y=y-1|0;);(y=c[e+32>>2])&&p[e+36|0]&&(c[5499]=c[5499]+1,z(c[y-4>>2])),c[e+32>>2]=E,c[e+28>>2]=u,a[e+36|0]=1,y=c[e+24>>2]}b=c[4+f>>2],y=c[e+32>>2]+g(y,80)|0,c[(v=y)+16>>2]=c[f>>2],c[v+20>>2]=b,v=c[68+T>>2],c[y>>2]=c[64+T>>2],c[y+4>>2]=v,v=c[4+h>>2],c[y+32>>2]=c[h>>2],c[y+36>>2]=v,v=c[4+l>>2],c[y+48>>2]=c[l>>2],c[y+52>>2]=v,c[y+64>>2]=n,b=c[4+(v=72+T|0)>>2],c[(n=y+8|0)>>2]=c[v>>2],c[n+4>>2]=b,b=c[4+(v=8+f|0)>>2],c[(n=y+24|0)>>2]=c[v>>2],c[n+4>>2]=b,b=c[4+(v=8+h|0)>>2],c[(n=y+40|0)>>2]=c[v>>2],c[n+4>>2]=b,b=c[4+(v=8+l|0)>>2],c[(n=y+56|0)>>2]=c[v>>2],c[n+4>>2]=b,c[y+76>>2]=t,A[y+72>>2]=m,c[y+68>>2]=d,c[e+24>>2]=c[e+24>>2]+1,N=128+T|0},CompoundShape_removeChildShape:Lt,CompoundShape_removeChildShapeByIndex:function(e,t){dt(e|=0,t|=0)},CompoundShape_getChildShape:function(e,t){return c[64+(c[32+(e|=0)>>2]+g(t|=0,80)|0)>>2]},CompoundShape_updateChildTransform:function(e,t,n,i){t|=0,n|=0,i|=0;var o,a=0,r=0,s=0,l=0,_=0;N=o=N+-64|0,a=(r=c[24+(e|=0)>>2])+1|0,r=g(r,80)+76|0;e:{for(;;){if((0|(a=a-1|0))<1)break e;if(_=(s=c[e+32>>2])+r|0,r=l=r-80|0,c[_-92>>2]==(0|t))break}if(t=s+l|0,s=c[n+4>>2],c[(a=r=t-76|0)>>2]=c[n>>2],c[a+4>>2]=s,s=c[4+(a=n+8|0)>>2],c[(r=r+8|0)>>2]=c[a>>2],c[r+4>>2]=s,_=c[4+(s=n+24|0)>>2],c[(a=8+(r=t-60|0)|0)>>2]=c[s>>2],c[a+4>>2]=_,a=c[n+20>>2],c[r>>2]=c[n+16>>2],c[r+4>>2]=a,_=c[4+(s=n+40|0)>>2],c[(a=8+(r=t-44|0)|0)>>2]=c[s>>2],c[a+4>>2]=_,a=c[n+36>>2],c[r>>2]=c[n+32>>2],c[r+4>>2]=a,s=c[4+(a=n+56|0)>>2],c[(r=8+(t=t-28|0)|0)>>2]=c[a>>2],c[r+4>>2]=s,r=c[n+52>>2],c[t>>2]=c[n+48>>2],c[t+4>>2]=r,c[e+72>>2]){t=c[(c[e+32>>2]+l|0)-12>>2],pi[c[c[t>>2]+8>>2]](t,n,48+o|0,32+o|0),r=c[4+(n=56+o|0)>>2],c[(t=8+o|0)>>2]=c[n>>2],c[t+4>>2]=r,r=c[4+(n=40+o|0)>>2],c[(t=24+o|0)>>2]=c[n>>2],c[t+4>>2]=r,t=c[52+o>>2],c[o>>2]=c[48+o>>2],c[4+o>>2]=t,t=c[36+o>>2],c[16+o>>2]=c[32+o>>2],c[20+o>>2]=t;t:if(r=ut(s=c[e+72>>2],n=c[c[e+32>>2]+l>>2]))if(0<=(0|(a=c[s+8>>2]))){if(a)for(;;){if(!(t=c[r+32>>2]))break t;if(r=t,!(a=a-1|0))break}}else r=c[s>>2];else r=0;t=c[4+o>>2],c[n>>2]=c[o>>2],c[n+4>>2]=t,l=c[4+(a=24+o|0)>>2],c[(t=n+24|0)>>2]=c[a>>2],c[t+4>>2]=l,l=c[4+(a=16+o|0)>>2],c[(t=n+16|0)>>2]=c[a>>2],c[t+4>>2]=l,l=c[4+(a=8+o|0)>>2],c[(t=n+8|0)>>2]=c[a>>2],c[t+4>>2]=l,ht(s,r,n)}i&&pi[c[c[e>>2]+68>>2]](e)}N=o+64|0},StridingMeshInterface_del:Te,TriangleMesh_new:function(){var e,t=0,n=0,i=0,o=0;return o=c[5498],(n=M(191))&&(c[(t=n+19&-16)-4>>2]=n),a[t+36|0]=1,c[t+12>>2]=1065353216,c[t+16>>2]=0,c[t+4>>2]=1065353216,c[t+8>>2]=1065353216,c[t+32>>2]=0,c[t+48>>2]=0,c[t+24>>2]=0,c[t+28>>2]=0,a[t+100|0]=1,c[t>>2]=9704,c[t+96>>2]=0,a[t+120|0]=1,c[t+88>>2]=0,c[t+92>>2]=0,c[t+116>>2]=0,a[t+140|0]=1,c[t+108>>2]=0,c[t+112>>2]=0,c[t+136>>2]=0,a[t+160|0]=1,c[t+128>>2]=0,c[t+132>>2]=0,c[t+168>>2]=0,c[t+156>>2]=0,c[t+148>>2]=0,c[t+152>>2]=0,s[t+164>>1]=257,c[5498]=o+2,(n=M(51))&&(c[(i=n+19&-16)-4>>2]=n),n=0,(o=c[t+32>>2])&&(c[5499]=c[5499]+1,z(c[o-4>>2]),n=c[t+24>>2]),c[t+32>>2]=i,a[t+36|0]=1,c[t+28>>2]=1,c[24+(n=(n<<5)+i|0)>>2]=2,c[n+28>>2]=0,c[n+16>>2]=0,c[n+20>>2]=16,c[n+8>>2]=12,c[n+12>>2]=0,c[n>>2]=0,c[n+4>>2]=0,c[t+24>>2]=c[t+24>>2]+1,n=c[t+32>>2],c[n+4>>2]=0,i=p[t+164|0],c[n+24>>2]=i?2:3,e=c[(i?128:148)+t>>2],o=12,c[n+8>>2]=i?12:6,c[n>>2]=(0|e)/3,i=p[t+165|0]?(o=16,c[t+88>>2]):c[t+108>>2]/3|0,c[n+20>>2]=o,c[n+16>>2]=0,c[n+12>>2]=i,0|t},TriangleMesh_del:Te,TriangleMesh_addTriangle:function(e,t,n,i,o){t|=0,n|=0,i|=0,o|=0;var a=c[32+(e|=0)>>2];c[a>>2]=c[a>>2]+1,xt(e,yt(e,t,o)),xt(e,yt(e,n,o)),xt(e,yt(e,i,o))},BvhTriangleMeshShape_new:function(e,t,n){e|=0,t|=0,n|=0;var i,o,r,s=0,l=0;return N=r=N-48|0,c[5498]=c[5498]+1,(l=M(103))&&(c[(s=l+19&-16)-4>>2]=l),c[s+12>>2]=0,c[s+16>>2]=0,c[s+4>>2]=21,c[s+8>>2]=0,c[s>>2]=9804,c[s+56>>2]=e,(c[s+20>>2]=0)|pi[c[c[e>>2]+40>>2]](e)?pi[c[c[e>>2]+48>>2]](e,s+24|0,s+40|0):(c[44+r>>2]=0,c[36+r>>2]=0,c[40+r>>2]=0,c[32+r>>2]=1065353216,pi[c[c[s>>2]+68>>2]](16+r|0,s,32+r|0),A[s+40>>2]=A[16+r>>2]+A[s+20>>2],c[32+r>>2]=-1082130432,pi[c[c[s>>2]+68>>2]](r,s,32+r|0),o=c[4+(l=8+r|0)>>2],c[(e=24+r|0)>>2]=c[l>>2],c[e+4>>2]=o,i=c[4+r>>2],c[16+r>>2]=c[r>>2],c[20+r>>2]=i,A[s+24>>2]=A[16+r>>2]-A[s+20>>2],c[(i=40+r|0)>>2]=0,c[4+i>>2]=0,c[32+r>>2]=0,c[36+r>>2]=0,c[36+r>>2]=1065353216,pi[c[c[s>>2]+68>>2]](16+r|0,s,32+r|0),A[s+44>>2]=A[20+r>>2]+A[s+20>>2],c[36+r>>2]=-1082130432,pi[c[c[s>>2]+68>>2]](r,s,32+r|0),o=c[l+4>>2],c[e>>2]=c[l>>2],c[e+4>>2]=o,o=c[4+r>>2],c[16+r>>2]=c[r>>2],c[20+r>>2]=o,A[s+28>>2]=A[20+r>>2]-A[s+20>>2],c[i>>2]=0,c[4+i>>2]=0,c[i>>2]=1065353216,c[32+r>>2]=0,c[36+r>>2]=0,pi[c[c[s>>2]+68>>2]](16+r|0,s,32+r|0),c[i>>2]=-1082130432,A[s+48>>2]=A[e>>2]+A[s+20>>2],pi[c[c[s>>2]+68>>2]](r,s,32+r|0),i=c[l+4>>2],c[e>>2]=c[l>>2],c[e+4>>2]=i,l=c[4+r>>2],c[16+r>>2]=c[r>>2],c[20+r>>2]=l,A[s+32>>2]=A[e>>2]-A[s+20>>2]),a[s+69|(e=0)]=0,a[s+68|0]=t,c[s+60>>2]=0,c[s+64>>2]=0,c[s>>2]=10608,c[s+4>>2]=21,n&&(c[5498]=c[5498]+1,(n=M(191))&&(c[(e=n+19&-16)-4>>2]=n),a[e+80|0]=1,a[e+60|0]=0,c[e+52>>2]=287,c[e+76>>2]=0,a[e+100|0]=1,c[e+68>>2]=0,c[e+72>>2]=0,c[e+96>>2]=0,a[e+120|0]=1,c[e+88>>2]=0,c[e+92>>2]=0,c[e+116>>2]=0,a[e+140|0]=1,c[e+108>>2]=0,c[e+112>>2]=0,c[e+136>>2]=0,a[e+164|0]=1,c[e+144>>2]=0,c[e+128>>2]=0,c[e+132>>2]=0,c[e+160>>2]=0,c[e+152>>2]=0,c[e+156>>2]=0,c[e+168>>2]=0,c[e+28>>2]=2139095039,c[e+32>>2]=0,c[e+20>>2]=2139095039,c[e+24>>2]=2139095039,c[e+12>>2]=-8388609,c[e+16>>2]=0,c[e+4>>2]=-8388609,c[e+8>>2]=-8388609,c[e>>2]=10280,wt(c[s+60>>2]=e,c[s+56>>2],t,s+24|0,s+40|0),a[s+69|0]=1),N=48+r|0,0|s},ConvexTriangleMeshShape_new:function(e){e|=0;var t,n=0,i=0;return N=i=N-96|0,c[5498]=c[5498]+1,(t=M(123))&&(c[(n=t+19&-16)-4>>2]=t),c[n+88>>2]=-1082130432,c[n+92>>2]=0,c[n+80>>2]=-1082130432,c[n+84>>2]=-1082130432,c[n+72>>2]=1065353216,c[n+76>>2]=0,c[n+64>>2]=1065353216,c[n+68>>2]=1065353216,c[n+60>>2]=0,c[n+52>>2]=1025758986,c[n+28>>2]=1065353216,c[n+32>>2]=0,c[n+20>>2]=1065353216,c[n+24>>2]=1065353216,c[n+12>>2]=0,c[n+16>>2]=0,c[n+4>>2]=3,c[n+8>>2]=0,c[n+100>>2]=e,c[n>>2]=11240,a[n+96|0]=1,p[22256]||(c[5569]=0,c[5570]=0,c[5568]=1065353216,c[5571]=0,c[5572]=0,c[5574]=0,c[5575]=0,c[5573]=1065353216,c[5576]=0,c[5577]=0,c[5581]=0,c[5582]=0,c[5580]=-1082130432,c[5578]=1065353216,c[5579]=0,c[5583]=0,c[5584]=0,c[5586]=0,c[5587]=0,c[5585]=-1082130432,c[5588]=0,c[5589]=0,c[5590]=-1082130432,c[5591]=0,a[22256]=1),e=B(i,0,96),pi[c[c[n>>2]+76>>2]](n,22272,e,6),i=A[n+52>>2],A[n+64>>2]=A[e+48>>2]-i,A[n+80>>2]=i+A[e>>2],A[n+84>>2]=i+A[e+20>>2],A[n+88>>2]=i+A[e+40>>2],A[n+68>>2]=A[e+68>>2]-i,A[n+72>>2]=A[e+88>>2]-i,N=e+96|0,0|n},EmptyShape_static:function(){return p[22372]||(c[5597]=0,c[5598]=0,c[5595]=27,c[5596]=0,c[5594]=11488,a[22372]=1,c[5599]=0),22376},SimplexShape_new:function(e){var t;return e|=0,c[5498]=c[5498]+1,e=0,(t=M(187))&&(c[(e=t+19&-16)-4>>2]=t),a[e+96|0]=0,c[e+92>>2]=0,c[e+84>>2]=-1082130432,c[e+88>>2]=-1082130432,c[e+76>>2]=0,c[e+80>>2]=-1082130432,c[e+68>>2]=1065353216,c[e+72>>2]=1065353216,c[e+60>>2]=0,c[e+64>>2]=1065353216,c[e+52>>2]=1025758986,c[e+32>>2]=0,c[e+24>>2]=1065353216,c[e+28>>2]=1065353216,c[e+16>>2]=0,c[e+20>>2]=1065353216,c[e+8>>2]=0,c[e+12>>2]=0,c[e+100>>2]=0,c[e>>2]=11600,c[e+4>>2]=2,0|e},SimplexShape_addVertex:function(e,t){e|=0,t|=0,x(0);var n,i,o,r=0;N=r=N-96|0,n=c[e+100>>2],c[e+100>>2]=n+1,o=c[t+4>>2],c[(i=104+(n=(n<<4)+e|0)|0)>>2]=c[t>>2],c[4+i>>2]=o,i=c[4+(t=t+8|0)>>2],c[(n=112+n|0)>>2]=c[t>>2],c[4+n>>2]=i,a[e+96|0]=1,p[22256]||(c[5569]=0,c[5570]=0,c[5568]=1065353216,c[5571]=0,c[5572]=0,c[5574]=0,c[5575]=0,c[5573]=1065353216,c[5576]=0,c[5577]=0,c[5581]=0,c[5582]=0,c[5580]=-1082130432,c[5578]=1065353216,c[5579]=0,c[5583]=0,c[5584]=0,c[5586]=0,c[5587]=0,c[5585]=-1082130432,c[5588]=0,c[5589]=0,c[5590]=-1082130432,c[5591]=0,a[22256]=1),t=B(r,0,96),pi[c[c[e>>2]+76>>2]](e,22272,t,6),r=A[e+52>>2],A[e+64>>2]=A[t+48>>2]-r,A[e+80>>2]=r+A[t>>2],A[e+84>>2]=r+A[t+20>>2],A[e+88>>2]=r+A[t+40>>2],A[e+68>>2]=A[t+68>>2]-r,A[e+72>>2]=A[t+88>>2]-r,N=t+96|0},TerrainShape_new:function(e,t,n,i,o,r){e|=0,t|=0,n|=0,i=x(i),o=x(o),r=x(r);var s,l=0;return c[5498]=c[5498]+1,(s=M(151))&&(c[(l=s+19&-16)-4>>2]=s),c[l+20>>2]=0,c[l+12>>2]=0,c[l+16>>2]=0,c[l+4>>2]=24,c[l+8>>2]=0,c[l+104>>2]=0,c[l+100>>2]=n,A[l+96>>2]=i,A[l+84>>2]=r,A[l+80>>2]=o,c[l+76>>2]=t,c[l+72>>2]=e,c[l>>2]=11796,c[l+124>>2]=1065353216,c[l+128>>2]=0,c[l+116>>2]=1065353216,c[l+120>>2]=1065353216,c[l+112>>2]=1,a[0|(n=l+107|0)]=0,a[n+1|0]=0,a[n+2|0]=0,a[n+3|0]=0,i=x(t-1|0),A[l+92>>2]=i,e=x(e-1|0),A[l+88>>2]=e,c[l+68>>2]=0,A[l+64>>2]=i*x(.5),A[l+60>>2]=x(o+r)*x(.5),A[l+56>>2]=e*x(.5),c[l+52>>2]=0,A[l+48>>2]=i,A[l+44>>2]=r,A[l+40>>2]=e,c[l+32>>2]=0,c[l+36>>2]=0,A[l+28>>2]=o,(c[l+24>>2]=0)|l},DefaultCollisionConfiguration_static:function(){var e;return N=e=N-32|0,p[24160]||(c[24+e>>2]=0,c[28+e>>2]=1,c[16+e>>2]=4096,c[20+e>>2]=4096,c[8+e>>2]=0,mn(8+e|(c[12+e>>2]=0)),F(29),a[24160]=1),N=32+e|0,24164},Dispatcher_getNumManifolds:function(e){return 0|pi[c[c[(e|=0)>>2]+36>>2]](e)},Dispatcher_getManifoldByIndexInternal:function(e,t){return 0|pi[c[c[(e|=0)>>2]+40>>2]](e,t|=0)},CollisionDispatcher_new:function(){var e,t,n,i,o,r=0,s=0,l=0,_=0;for(N=o=N-32|0,e=j(10448),p[24160]||(c[24+o>>2]=0,c[28+o>>2]=1,c[16+o>>2]=4096,c[20+o>>2]=4096,c[8+o>>2]=0,mn(8+o|(c[12+o>>2]=0)),F(29),a[24160]=1),a[e+24|0]=1,c[e+4>>2]=2,c[e>>2]=16084,c[e+20>>2]=0,c[e+10444>>2]=24164,c[e+60>>2]=0,c[e+28>>2]=12508,c[e+12>>2]=0,c[e+16>>2]=0,c[e+64>>2]=30,n=e,i=0|pi[c[c[6041]+12>>2]](24164),c[n+68>>2]=i,n=e,i=0|pi[c[c[6041]+8>>2]](24164),c[n+72>>2]=i,_=e+5260|0;;){for(r=0,s=_;t=c[e+10444>>2],n=s-5184|0,i=0|pi[c[c[t>>2]+16>>2]](t,l,r),c[n>>2]=i,t=c[e+10444>>2],n=s,i=0|pi[c[c[t>>2]+20>>2]](t,l,r),c[n>>2]=i,s=s+4|0,36!=(0|(r=r+1|0)););if(_=_+144|0,36==(0|(l=l+1|0)))break}return N=32+o|0,0|e},CollisionDispatcher_del:Te,DbvtBroadphase_new:function(){var e,t,n,i=0,o=0,r=0,s=0,l=0,_=0,u=0;N=n=N-32|0,e=j(176),a[e+40|0]=1,c[e>>2]=16780,c[e+36>>2]=0,c[e+28>>2]=0,c[e+32>>2]=0,a[e+80|0]=1,c[e+20>>2]=0,c[e+12>>2]=-1,c[e+16>>2]=0,c[e+4>>2]=0,c[e+8>>2]=0,c[e+76>>2]=0,c[e+68>>2]=0,c[e+72>>2]=0,a[e+172|0]=1,c[e+60>>2]=0,c[e+52>>2]=-1,c[e+56>>2]=0,c[e+44>>2]=0,c[e+48>>2]=0,c[e+168>>2]=0,c[e+160>>2]=0,c[e+164>>2]=0,a[e+153|0]=0,a[e+154|0]=1,a[e+152|0]=1,c[e+124>>2]=0,c[e+100>>2]=0,c[e+104>>2]=0,c[e+136>>2]=0,c[e+128>>2]=0,c[e+132>>2]=0,c[e+116>>2]=10,c[e+120>>2]=1,c[e+108>>2]=1,c[e+112>>2]=0,s=c[5498],(i=M(91))&&(c[(o=i+19&-16)-4>>2]=i),a[o+20|0]=1,c[o>>2]=16280,c[o+16>>2]=0,a[o+44|0]=1,c[o+24>>2]=0,c[o+8>>2]=0,c[o+12>>2]=0,c[o+40>>2]=0,a[o+64|0]=1,c[o+32>>2]=0,c[o+36>>2]=0,c[o+60>>2]=0,c[o+68>>2]=0,c[o+52>>2]=0,c[o+56>>2]=0,c[5498]=s+2,(i=M(51))&&(c[(r=i+19&-16)-4>>2]=i),(i=c[o+16>>2])&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[o+16>>2]=r,a[o+20|0]=1,c[o+12>>2]=2,gn(o),c[e+148>>2]=0,c[e+96>>2]=o,c[e+140>>2]=0,c[e+144>>2]=0,c[(r=e+84|0)>>2]=0,c[r+4>>2]=0,c[e+92>>2]=0,r=c[e+160>>2],c[20+n>>2]=0,a[24+n|0]=1,c[12+n>>2]=0;e:{if(2<=((c[16+n>>2]=0)|r))for(o=r-1|0,r=36;i=c[e+168>>2]+r|0,(l=c[(s=i-4|0)>>2])&&p[0|i]&&(c[5499]=c[5499]+1,z(c[l-4>>2])),c[s>>2]=0,a[0|i]=1,c[(i=i-12|0)>>2]=0,r=r+20|(c[i+4>>2]=0),o=o-1|0;);else if(1!=(0|r)){for(c[e+164>>2]<=(o=0)&&(c[5498]=c[5498]+1,(i=M(39))&&(c[(o=i+19&-16)-4>>2]=i),(i=c[e+168>>2])&&p[e+172|0]&&(c[5499]=c[5499]+1,z(c[i-4>>2])),c[e+168>>2]=o,a[e+172|0]=1,c[e+164>>2]=1),o=g(r,20),r=r-1|0;;){if(i=c[e+168>>2]+o|(l=0),c[i+4>>2]=0,c[i+8>>2]=0,c[i+12>>2]=0,a[i+16|0]=1,(0|(s=c[4+(t=8+n|0)>>2]))<=0)c[i+4>>2]=s;else{if(c[5498]=c[5498]+1,(_=M(19+(s<<2)|0))&&(c[(l=_+19&-16)-4>>2]=_),(_=c[i+12>>2])&&(c[5499]=c[5499]+1,z(c[_-4>>2])),c[i+12>>2]=l,a[i+16|0]=1,c[i+8>>2]=s,1!=((c[l>>2]=_=0)|s))for(u=s-1|0,l=4;l=l+4|(c[c[i+12>>2]+l>>2]=0),u=u-1|0;);for(c[i+4>>2]=s,i=c[i+12>>2];c[i+_>>2]=c[c[12+t>>2]+_>>2],_=_+4|0,s=s-1|0;);}if(o=o+20|0,!((i=r)>>>0<=(r=i+1|0)>>>0))break}if(c[e+160>>2]=1,!(r=c[20+n>>2]))break e;if(!p[24+n|0])break e;c[5499]=c[5499]+1,z(c[r-4>>2]);break e}c[e+160>>2]=1}return N=32+n|0,0|e},DbvtBroadphase_del:Te,SequentialImpulseConstraintSolver_new:function(){var e,t=0;return c[5498]=c[5498]+1,(e=M(255))&&(c[(t=e+19&-16)-4>>2]=e),a[t+20|0]=1,c[t>>2]=17208,c[t+16>>2]=0,a[t+40|0]=1,c[t+8>>2]=0,c[t+12>>2]=0,c[t+36>>2]=0,a[t+60|0]=1,c[t+28>>2]=0,c[t+32>>2]=0,c[t+56>>2]=0,a[t+80|0]=1,c[t+48>>2]=0,c[t+52>>2]=0,c[t+76>>2]=0,a[t+100|0]=1,c[t+68>>2]=0,c[t+72>>2]=0,c[t+96>>2]=0,a[t+120|0]=1,c[t+88>>2]=0,c[t+92>>2]=0,c[t+116>>2]=0,a[t+140|0]=1,c[t+108>>2]=0,c[t+112>>2]=0,c[t+136>>2]=0,c[t+128>>2]=0,c[t+132>>2]=0,a[t+160|0]=1,c[t+156>>2]=0,c[t+148>>2]=0,c[t+152>>2]=0,a[t+180|0]=1,c[t+176>>2]=0,c[t+168>>2]=0,c[t+172>>2]=0,a[t+208|0]=1,c[t+232>>2]=0,c[t+204>>2]=0,c[t+196>>2]=0,c[t+200>>2]=0,c[t+224>>2]=0,c[t+212>>2]=28,c[t+216>>2]=27,c[t+220>>2]=26,0|t},SequentialImpulseConstraintSolver_del:Te,CollisionWorld_get_m_useContinuous:function(e){return p[16+(e|=0)|0]},CollisionWorld_set_m_useContinuous:function(e,t){a[16+(e|=0)|0]=t|=0},CollisionWorld_del:Te,CollisionWorld_rayTest:function(e,t,n,i){pi[c[c[(e|=0)>>2]+32>>2]](e,t|=0,n|=0,i|=0)},CollisionWorld_getDispatchInfo:function(e){return 28+(e|=0)|0},CollisionWorld_addCollisionObject:function(e,t,n,i){pi[c[c[(e|=0)>>2]+36>>2]](e,t|=0,n|=0,i|=0)},CollisionWorld_removeCollisionObject:function(e,t){pi[c[c[(e|=0)>>2]+40>>2]](e,t|=0)},CollisionWorld_convexSweepTest:function(e,t,n,i,o,a){Zn(e|=0,t|=0,n|=0,i|=0,o|=0,a=x(a))},DynamicsWorld_addAction:Lt,DynamicsWorld_removeAction:ni,DynamicsWorld_getSolverInfo:ye,ccDiscreteDynamicsWorld_new:function(e,t,n){e|=0,t|=0,n|=0;var i,o=0,r=0,l=0;return N=i=N-32|0,c[5498]=c[5498]+1,(o=M(367))&&(c[(r=o+19&-16)-4>>2]=o),p[24160]||(c[24+i>>2]=0,c[28+i>>2]=1,c[16+i>>2]=4096,c[20+i>>2]=4096,c[8+i>>2]=0,mn(8+i|(c[12+i>>2]=0)),F(29),a[24160]=1),c[r+16>>2]=0,a[r+20|0]=1,c[r+116>>2]=1101004800,c[r+108>>2]=0,c[(o=r)+100>>2]=1050253722,c[o+104>>2]=1015580809,c[o+92>>2]=1058642330,c[o+96>>2]=1065353216,c[o+88>>2]=0,c[o+80>>2]=0,c[o+84>>2]=0,a[o+76|0]=1,c[o+72>>2]=0,c[o+68>>2]=t,c[o+64>>2]=0,a[o+60|0]=0,c[o+56>>2]=1025758986,a[o+54|0]=1,s[o+52>>1]=256,c[o+48>>2]=0,a[o+44|0]=1,c[o+36>>2]=1,c[o+40>>2]=1065353216,c[o+28>>2]=0,c[o+32>>2]=0,c[o+24>>2]=e,c[o+8>>2]=0,c[o+12>>2]=0,c[o+132>>2]=0,c[o+136>>2]=1045220557,c[o+124>>2]=1045220557,c[o+128>>2]=1045220557,c[o+112>>2]=10,c[o+140>>2]=0,c[o+144>>2]=1,c[o+172>>2]=128,c[o+148>>2]=-1121724662,c[o+152>>2]=1036831949,c[o+156>>2]=0,c[o+160>>2]=1062836634,c[o+176>>2]=1120403456,c[o+180>>2]=1900671690,c[o+184>>2]=0,c[o+188>>2]=1045220557,c[o+164>>2]=260,c[o+168>>2]=2,c[o+120>>2]=1065353216,c[o>>2]=19784,a[o+208|0]=1,c[o+212>>2]=0,c[o+204>>2]=0,c[o+216>>2]=n,c[o+196>>2]=0,c[o+200>>2]=0,a[o+240|0]=1,a[o+260|0]=1,c[o+236>>2]=0,c[o+228>>2]=0,c[o+232>>2]=0,c[o+256>>2]=0,c[o+248>>2]=0,c[o+252>>2]=0,c[o+264>>2]=0,c[o+268>>2]=-1054867456,s[o+290>>1]=0,c[(t=o+280|0)>>2]=0,c[t+4>>2]=0,c[o+272>>2]=0,c[o+276>>2]=0,a[o+308|0]=1,a[o+336|0]=1,c[o+304>>2]=0,a[o+316|0]=1,c[o+296>>2]=0,c[o+300>>2]=0,c[o+312>>2]=0,c[o+332>>2]=0,c[o+340>>2]=0,c[o+324>>2]=0,c[o+328>>2]=0,t=n?0:(c[5498]=c[5498]+1,n=0,(t=M(255))&&(c[(n=t+19&-16)-4>>2]=t),a[n+20|0]=1,c[n>>2]=17208,c[n+16>>2]=0,a[n+40|0]=1,c[n+8>>2]=0,c[n+12>>2]=0,c[n+36>>2]=0,a[n+60|0]=1,c[n+28>>2]=0,c[n+32>>2]=0,c[n+56>>2]=0,a[n+80|0]=1,c[n+48>>2]=0,c[n+52>>2]=0,c[n+76>>2]=0,a[n+100|0]=1,c[n+68>>2]=0,c[n+72>>2]=0,c[n+96>>2]=0,a[n+120|0]=1,c[n+88>>2]=0,c[n+92>>2]=0,c[n+116>>2]=0,c[n+168>>2]=0,c[n+172>>2]=0,c[n+148>>2]=0,c[n+152>>2]=0,c[n+128>>2]=0,c[n+132>>2]=0,c[n+108>>2]=0,c[n+112>>2]=0,c[n+196>>2]=0,c[n+200>>2]=0,a[n+140|0]=1,c[n+136>>2]=0,a[n+160|0]=1,c[n+156>>2]=0,a[n+180|0]=1,c[n+176>>2]=0,a[n+208|0]=1,c[n+232>>2]=0,c[n+204>>2]=0,c[n+224>>2]=0,c[n+212>>2]=28,c[n+216>>2]=27,c[n+220>>2]=26,c[r+216>>2]=n,1),a[o+289|0]=t,t=c[5498],(n=M(87))&&(c[(l=n+19&-16)-4>>2]=n),a[l+20|0]=1,c[l>>2]=19576,c[l+16>>2]=0,a[l+40|0]=1,c[l+8>>2]=0,c[l+12>>2]=0,c[l+36>>2]=0,a[l+60|0]=1,c[l+28>>2]=0,c[l+32>>2]=0,c[l+56>>2]=0,a[l+64|0]=1,c[l+48>>2]=0,c[l+52>>2]=0,a[r+288|0]=1,c[r+220>>2]=l,c[5498]=t+2,n=0,(t=M(107))&&(c[(n=t+19&-16)-4>>2]=t),c[n>>2]=19980,c[n+52>>2]=0,c[n+56>>2]=0,c[n+72>>2]=0,c[n+76>>2]=0,c[n+12>>2]=0,c[n+16>>2]=0,c[n+32>>2]=0,c[n+36>>2]=0,a[n+44|0]=1,c[n+24>>2]=e,c[n+20>>2]=0,c[n+4>>2]=0,c[n+40>>2]=0,a[n+64|0]=1,c[n+60>>2]=0,a[n+84|0]=1,c[n+80>>2]=0,c[r+344>>2]=20464,c[r>>2]=20268,c[n+8>>2]=c[r+216>>2],c[r+212>>2]=n,c[r+56>>2]=1008981770,e=c[r+68>>2],e=0|pi[c[c[e>>2]+36>>2]](e),pi[c[c[e>>2]+44>>2]](e,r+344|0),N=32+i|0,0|r},DynamicsWorld_setGravity:function(e,t){pi[c[c[(e|=0)>>2]+72>>2]](e,t|=0)},DynamicsWorld_addRigidBody:function(e,t,n,i){pi[c[c[(e|=0)>>2]+88>>2]](e,t|=0,n|=0,i|=0)},DynamicsWorld_removeRigidBody:function(e,t){pi[c[c[(e|=0)>>2]+92>>2]](e,t|=0)},DynamicsWorld_addConstraint:function(e,t,n){pi[c[c[(e|=0)>>2]+56>>2]](e,t|=0,n|=0)},DynamicsWorld_removeConstraint:function(e,t){pi[c[c[(e|=0)>>2]+60>>2]](e,t|=0)},DynamicsWorld_stepSimulation:function(e,t,n,i){e|=0,t=x(t),n|=0,i=x(i),pi[c[c[e>>2]+52>>2]](e,t,n,i)},ccDiscreteDynamicsWorld_setAllowSleep:function(e,t){a[23468]=1^(t|=0)},TypedConstraint_del:Te,TypedConstraint_getFixedBody:function(){var e,t;return N=t=N-144|0,p[23477]||(c[5909]=0,c[5910]=0,c[5907]=0,c[5908]=0,c[5905]=0,c[5906]=0,c[5903]=0,c[5904]=0,c[5917]=0,c[5918]=0,c[5915]=0,c[5916]=1566444395,c[5913]=1065353216,c[5914]=0,c[5911]=1065353216,c[5912]=1065353216,c[5919]=0,c[5920]=0,a[23780]=1,c[5939]=0,c[5940]=0,c[5937]=1065353216,c[5938]=0,c[5935]=-1,c[5936]=-1,c[5933]=1,c[5934]=0,c[5931]=1036831949,c[5932]=1176256512,c[5929]=0,c[5930]=0,c[5927]=1056964608,c[5928]=0,c[5925]=1,c[5926]=0,c[5923]=-1,c[5924]=-1,c[5921]=1,c[5922]=-1,c[5942]=0,c[5943]=0,c[5871]=1065353216,c[5872]=0,c[5873]=0,c[5874]=0,c[5875]=0,c[5876]=1065353216,c[5877]=0,c[5878]=0,c[5879]=0,c[5880]=0,c[5881]=1065353216,c[5882]=0,c[5883]=0,c[5884]=0,c[5885]=0,c[5886]=0,c[5887]=1065353216,c[5888]=0,c[5889]=0,c[5890]=0,c[5891]=0,c[5892]=1065353216,c[5893]=0,c[5894]=0,c[5895]=0,c[5896]=0,c[5946]=0,c[5944]=0,c[5898]=0,c[5899]=0,c[5897]=1065353216,c[5900]=0,c[5901]=0,a[24040]=1,c[5870]=17124,c[6007]=0,c[6008]=0,c[5902]=0,c[6009]=0,c[(e=80+t|0)>>2]=0,c[4+e>>2]=0,c[(e=88+t|0)>>2]=0,c[4+e>>2]=0,c[96+t>>2]=0,c[(e=12+t|0)>>2]=0,c[4+e>>2]=0,c[(e=20+t|0)>>2]=0,c[4+e>>2]=0,c[28+t>>2]=1065353216,c[(e=32+t|0)>>2]=0,c[4+e>>2]=0,c[(e=40+t|0)>>2]=0,c[4+e>>2]=0,c[48+t>>2]=1065353216,c[72+t>>2]=0,c[76+t>>2]=0,c[t>>2]=0,c[4+t>>2]=0,c[136+t>>2]=1008981770,c[140+t>>2]=1008981770,c[128+t>>2]=1000593162,c[132+t>>2]=1008981770,a[124+t|0]=0,c[116+t>>2]=1061997773,c[120+t>>2]=1065353216,c[108+t>>2]=0,c[112+t>>2]=0,c[100+t>>2]=1056964608,c[104+t>>2]=0,c[8+t>>2]=1065353216,c[68+t>>2]=0,c[(e=60+t|0)>>2]=0,c[4+e>>2]=0,c[(e=52+t|0)>>2]=0,c[4+e>>2]=0,wn(23480,t),F(31),a[23477]=1),c[5984]=0,c[5985]=0,c[5986]=0,c[5987]=0,c[5921]=1|c[5921],A[5978]=A[5982]*x(0),A[5977]=A[5981]*x(0),A[5976]=A[5980]*x(0),A[6027]=A[5974]*x(0),A[6026]=A[5973]*x(0),A[6025]=A[5972]*x(0),c[5971]=0,c[5979]=0,c[6028]=0,N=144+t|0,23480},HingeConstraint_new:function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o=0,r=0;return c[5498]=c[5498]+1,(r=M(787))&&(c[(o=r+19&-16)-4>>2]=r),c[o+44>>2]=0,c[o+36>>2]=0,c[o+40>>2]=1028443341,c[o+32>>2]=t,c[o+28>>2]=e,c[o+24>>2]=-1,s[o+20>>1]=1,c[o+12>>2]=-1,c[o+16>>2]=2139095039,c[o+4>>2]=4,c[o+8>>2]=-1,c[o>>2]=20752,r=c[4+(t=n+8|0)>>2],c[(e=o+560|0)>>2]=c[t>>2],c[e+4>>2]=r,e=c[n+4>>2],c[o+552>>2]=c[n>>2],c[o+556>>2]=e,r=c[4+(t=n+24|0)>>2],c[(e=o+576|0)>>2]=c[t>>2],c[e+4>>2]=r,e=c[n+20>>2],c[o+568>>2]=c[n+16>>2],c[o+572>>2]=e,r=c[4+(t=n+40|0)>>2],c[(e=o+592|0)>>2]=c[t>>2],c[e+4>>2]=r,e=c[n+36>>2],c[o+584>>2]=c[n+32>>2],c[o+588>>2]=e,r=c[4+(t=n+56|0)>>2],c[(e=o+608|0)>>2]=c[t>>2],c[e+4>>2]=r,e=c[n+52>>2],c[o+600>>2]=c[n+48>>2],c[o+604>>2]=e,n=c[4+(t=i+8|0)>>2],c[(e=o+624|0)>>2]=c[t>>2],c[e+4>>2]=n,e=c[i+4>>2],c[o+616>>2]=c[i>>2],c[o+620>>2]=e,n=c[4+(t=i+24|0)>>2],c[(e=o+640|0)>>2]=c[t>>2],c[e+4>>2]=n,e=c[i+20>>2],c[o+632>>2]=c[i+16>>2],c[o+636>>2]=e,n=c[4+(t=i+40|0)>>2],c[(e=o+656|0)>>2]=c[t>>2],c[e+4>>2]=n,e=c[i+36>>2],c[o+648>>2]=c[i+32>>2],c[o+652>>2]=e,n=c[4+(t=i+56|0)>>2],c[(e=o+672|0)>>2]=c[t>>2],c[e+4>>2]=n,e=c[i+52>>2],c[o+664>>2]=c[i+48>>2],c[o+668>>2]=e,c[o+704>>2]=1065353216,c[o+696>>2]=1063675494,c[o+700>>2]=1050253722,c[o+688>>2]=0,c[o+692>>2]=-1082130432,a[o+716|0]=0,c[o+708>>2]=0,c[o+712>>2]=0,a[o+740|0]=0,c[o+736>>2]=16777216,c[o+764>>2]=0,c[(e=o+756|0)>>2]=0,c[e+4>>2]=0,c[o+748>>2]=0,c[o+752>>2]=0,c[o+732>>2]=1065353216,0|o},HingeConstraint_setFrames:function(e,t,n){n|=0;var i,o,a=c[4+(t|=0)>>2];c[552+(e|=0)>>2]=c[t>>2],c[e+556>>2]=a,o=c[4+(i=t+8|0)>>2],c[(a=e+560|0)>>2]=c[i>>2],c[4+a>>2]=o,o=c[4+(i=t+24|0)>>2],c[(a=e+576|0)>>2]=c[i>>2],c[4+a>>2]=o,i=c[t+20>>2],c[(a=e+568|0)>>2]=c[t+16>>2],c[4+a>>2]=i,o=c[4+(i=t+40|0)>>2],c[(a=e+592|0)>>2]=c[i>>2],c[4+a>>2]=o,i=c[t+36>>2],c[(a=e+584|0)>>2]=c[t+32>>2],c[4+a>>2]=i,o=c[4+(i=t+56|0)>>2],c[(a=e+608|0)>>2]=c[i>>2],c[4+a>>2]=o,i=c[t+52>>2],c[(a=e+600|0)>>2]=c[t+48>>2],c[4+a>>2]=i,i=c[4+(a=n+8|0)>>2],c[(t=e+624|0)>>2]=c[a>>2],c[t+4>>2]=i,t=c[n+4>>2],c[e+616>>2]=c[n>>2],c[e+620>>2]=t,a=c[n+20>>2],c[(t=e+632|0)>>2]=c[n+16>>2],c[t+4>>2]=a,i=c[4+(a=n+24|0)>>2],c[(t=e+640|0)>>2]=c[a>>2],c[t+4>>2]=i,a=c[n+36>>2],c[(t=e+648|0)>>2]=c[n+32>>2],c[t+4>>2]=a,i=c[4+(a=n+40|0)>>2],c[(t=e+656|0)>>2]=c[a>>2],c[t+4>>2]=i,i=c[4+(a=n+56|0)>>2],c[(t=e+672|0)>>2]=c[a>>2],c[t+4>>2]=i,a=c[n+52>>2],c[(t=e+664|0)>>2]=c[n+48>>2],c[t+4>>2]=a,pi[c[c[e>>2]+8>>2]](e)},P2PConstraint_new:function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o,r=0;return c[5498]=c[5498]+1,(o=M(379))&&(c[(r=o+19&-16)-4>>2]=o),c[r+44>>2]=0,c[r+36>>2]=0,c[r+40>>2]=1028443341,c[r+32>>2]=t,c[r+28>>2]=e,c[r+24>>2]=-1,s[r+20>>1]=1,c[r+12>>2]=-1,c[r+16>>2]=2139095039,c[r+4>>2]=3,c[r+8>>2]=-1,c[r>>2]=20868,e=c[n+4>>2],c[r+300>>2]=c[n>>2],c[r+304>>2]=e,n=c[4+(t=n+8|0)>>2],c[(e=r+308|0)>>2]=c[t>>2],c[e+4>>2]=n,e=c[i+4>>2],c[r+316>>2]=c[i>>2],c[r+320>>2]=e,n=c[4+(t=i+8|0)>>2],c[(e=r+324|0)>>2]=c[t>>2],c[e+4>>2]=n,c[r+332>>2]=0,a[r+344|0]=0,c[r+348>>2]=1050253722,c[r+352>>2]=1065353216,(c[r+356>>2]=0)|r},P2PConstraint_setPivotA:function(e,t){var n=c[4+(t|=0)>>2];c[300+(e|=0)>>2]=c[t>>2],c[e+304>>2]=n,n=c[4+(t=t+8|0)>>2],c[(e=e+308|0)>>2]=c[t>>2],c[e+4>>2]=n},P2PConstraint_setPivotB:function(e,t){var n=c[4+(t|=0)>>2];c[316+(e|=0)>>2]=c[t>>2],c[e+320>>2]=n,n=c[4+(t=t+8|0)>>2],c[(e=e+324|0)>>2]=c[t>>2],c[e+4>>2]=n},_malloc:function(e){return 0|M(e|=0)},_free:function(e){z(e|=0)},_read_f32:ri,_write_f32:function(e,t){e|=0,t=x(t),A[e>>2]=t},Vec3_new:function(e,t,n){e=x(e),t=x(t),n=x(n);var i,o=0;return c[5498]=c[5498]+1,(i=M(35))&&(c[(o=i+19&-16)-4>>2]=i),c[o+12>>2]=0,A[o+8>>2]=n,A[o+4>>2]=t,A[o>>2]=e,0|o},Vec3_del:si,Vec3_set:function(e,t,n,i){e|=0,t=x(t),n=x(n),i=x(i),c[e+12>>2]=0,A[e+8>>2]=i,A[e+4>>2]=n,A[e>>2]=t},Vec3_x:ri,Vec3_y:ci,Vec3_z:li,Quat_new:function(e,t,n,i){e=x(e),t=x(t),n=x(n),i=x(i);var o=j(16);return A[o+12>>2]=i,A[o+8>>2]=n,A[o+4>>2]=t,A[o>>2]=e,0|o},Quat_del:si,Quat_set:_i,Quat_x:ri,Quat_y:ci,Quat_z:li,Quat_w:function(e){return x(A[12+(e|=0)>>2])},Transform_new:function(){var e=0,t=j(64);return c[(e=t)+4>>2]=0,c[e+8>>2]=0,c[e>>2]=1065353216,c[e+24>>2]=0,c[e+28>>2]=0,c[e+20>>2]=1065353216,c[e+44>>2]=0,c[e+48>>2]=0,c[e+40>>2]=1065353216,c[(e=e+12|0)>>2]=0,c[4+e>>2]=0,c[(e=t+32|0)>>2]=0,c[4+e>>2]=0,c[(e=t+52|0)>>2]=0,c[4+e>>2]=0,(c[t+60>>2]=0)|t},Transform_del:function(e){(e|=0)&&V(e)},Transform_setIdentity:function(e){var t;c[4+(e|=0)>>2]=0,c[e+8>>2]=0,c[e>>2]=1065353216,c[(t=e+12|0)>>2]=0,c[4+t>>2]=0,c[(t=e+24|0)>>2]=0,c[4+t>>2]=0,c[e+20>>2]=1065353216,c[(t=e+32|0)>>2]=0,c[4+t>>2]=0,c[(t=e+44|0)>>2]=0,c[4+t>>2]=0,c[e+40>>2]=1065353216,c[(t=e+52|0)>>2]=0,c[4+t>>2]=0,c[e+60>>2]=0},Transform_setOrigin:function(e,t){var n=c[4+(t|=0)>>2];c[48+(e|=0)>>2]=c[t>>2],c[e+52>>2]=n,n=c[4+(t=t+8|0)>>2],c[(e=e+56|0)>>2]=c[t>>2],c[e+4>>2]=n},Transform_setRotation:function(e,t){e|=0,t|=0,x(0);var n,i,o,a,r,s,l=A[t+12>>2],_=A[t+8>>2],u=A[t>>2],h=A[t+4>>2];c[e+44>>2]=0,c[e+28>>2]=0,c[e+12>>2]=0,n=x(x(2)/x(x(x(x(u*u)+x(h*h))+x(_*_))+x(l*l))),o=x(_*n),i=x(h*o),a=x(u*n),r=x(l*a),A[e+36>>2]=i+r,s=x(u*o),n=x(h*n),t=x(l*n),A[e+32>>2]=s-t,A[e+24>>2]=i-r,i=x(u*n),l=x(l*o),A[e+16>>2]=i+l,A[e+8>>2]=s+t,A[e+4>>2]=i-l,u=x(u*a),l=x(h*n),A[e+40>>2]=x(1)-x(u+l),t=u,u=x(_*o),A[e+20>>2]=x(1)-x(t+u),A[e>>2]=x(1)-x(l+u)},Transform_getOrigin:be,Transform_getRotation:function(e,t){return Rn(e|=0,t|=0),0|t},Vec3_array_at:function(e,t){return c[12+(e|=0)>>2]+((t|=0)<<4)|0},int_array_size:function(e){return c[4+(e|=0)>>2]},int_array_at:function(e,t){return c[c[12+(e|=0)>>2]+((t|=0)<<2)>>2]},ccMaterial_new:function(){var e=j(16);return c[e+8>>2]=1036831949,c[e+12>>2]=1036831949,c[e>>2]=1036831949,c[e+4>>2]=1058642330,0|e},ccMaterial_set:_i,MotionState_del:Te,MotionState_getWorldTransform:we,MotionState_setWorldTransform:function(e,t){pi[c[c[(e|=0)>>2]+12>>2]](e,t|=0)},ccMotionState_new:function(e,t){e|=0,t|=0;var n,i,o=j(72);return c[o+4>>2]=e,c[o>>2]=20996,i=c[4+(n=t+8|0)>>2],c[(e=o+16|0)>>2]=c[n>>2],c[e+4>>2]=i,e=c[t+4>>2],c[o+8>>2]=c[t>>2],c[o+12>>2]=e,i=c[4+(n=t+24|0)>>2],c[(e=o+32|0)>>2]=c[n>>2],c[e+4>>2]=i,e=c[t+20>>2],c[o+24>>2]=c[t+16>>2],c[o+28>>2]=e,e=c[t+36>>2],c[o+40>>2]=c[t+32>>2],c[o+44>>2]=e,i=c[4+(n=t+40|0)>>2],c[(e=o+48|0)>>2]=c[n>>2],c[e+4>>2]=i,e=c[t+52>>2],c[o+56>>2]=c[t+48>>2],c[o+60>>2]=e,n=c[4+(t=t+56|0)>>2],c[(e=o- -64|0)>>2]=c[t>>2],c[e+4>>2]=n,0|o},RigidBody_new:function(e,t){e=x(e),t|=0;var n,i,o,r=0;return N=o=N-144|0,p[22372]||(c[5597]=0,c[5598]=0,c[5595]=27,c[5596]=0,c[5594]=11488,a[22372]=1,c[5599]=0),c[(n=88+o|0)>>2]=0,c[4+n>>2]=0,i=e==x(0)?x(0):x(1.6666666269302368),A[84+o>>2]=i,A[80+o>>2]=i,c[(n=12+o|0)>>2]=0,c[4+n>>2]=0,c[(n=20+o|0)>>2]=0,c[4+n>>2]=0,c[136+o>>2]=1008981770,c[140+o>>2]=1008981770,c[128+o>>2]=1000593162,c[132+o>>2]=1008981770,a[124+o|0]=0,c[120+o>>2]=1065353216,c[112+o>>2]=0,c[116+o>>2]=1061997773,c[104+o>>2]=0,c[108+o>>2]=0,c[96+o>>2]=0,c[100+o>>2]=1056964608,A[76+o>>2]=i,c[72+o>>2]=22376,c[4+o>>2]=t,A[o>>2]=e,c[8+o>>2]=1065353216,c[(t=32+o|0)>>2]=0,c[t+4>>2]=0,c[28+o>>2]=1065353216,c[(t=40+o|0)>>2]=0,c[t+4>>2]=0,c[48+o>>2]=1065353216,c[(t=52+o|0)>>2]=0,c[t+4>>2]=0,c[(t=60+o|0)>>2]=0,c[t+4>>2]=0,c[68+o>>2]=0,c[5498]=c[5498]+1,(t=M(695))&&(c[(r=t+19&-16)-4>>2]=t),c[r+132>>2]=0,c[r+136>>2]=0,c[r+188>>2]=0,c[r+192>>2]=0,c[r+180>>2]=0,c[r+184>>2]=1566444395,c[r+172>>2]=1065353216,c[r+176>>2]=0,c[r+164>>2]=1065353216,c[r+168>>2]=1065353216,a[r+300|0]=1,c[r+276>>2]=0,c[r+280>>2]=0,c[r+268>>2]=1065353216,c[r+272>>2]=0,c[r+260>>2]=-1,c[r+264>>2]=-1,c[r+252>>2]=1,c[r+256>>2]=0,c[r+244>>2]=1036831949,c[r+248>>2]=1176256512,c[r+236>>2]=0,c[r+240>>2]=0,c[r+228>>2]=1056964608,c[r+232>>2]=0,c[r+220>>2]=1,c[r+224>>2]=0,c[r+212>>2]=-1,c[r+216>>2]=-1,c[r+204>>2]=1,c[r+208>>2]=-1,c[(t=r+156|0)>>2]=0,c[t+4>>2]=0,c[(t=r+148|0)>>2]=0,c[t+4>>2]=0,c[(t=r+140|0)>>2]=0,c[t+4>>2]=0,c[(t=r+196|0)>>2]=0,c[t+4>>2]=0,c[r+304>>2]=0,c[r+296>>2]=0,c[r+288>>2]=0,c[r+292>>2]=0,c[r+4>>2]=1065353216,c[r+8>>2]=0,c[r+12>>2]=0,c[(t=r+16|0)>>2]=0,c[t+4>>2]=0,c[r+24>>2]=1065353216,c[r+28>>2]=0,c[r+32>>2]=0,c[(t=r+36|0)>>2]=0,c[t+4>>2]=0,c[r+44>>2]=1065353216,c[r+48>>2]=0,c[r+52>>2]=0,c[(t=r+56|0)>>2]=0,c[t+4>>2]=0,c[(t=r- -64|0)>>2]=0,c[t+4>>2]=1065353216,c[r+72>>2]=0,c[r+76>>2]=0,c[(t=r+80|0)>>2]=0,c[t+4>>2]=0,c[r+88>>2]=1065353216,c[r+92>>2]=0,c[r+96>>2]=0,c[(t=r+100|0)>>2]=0,c[t+4>>2]=0,c[r+112>>2]=0,c[r+116>>2]=0,c[r+108>>2]=1065353216,c[(t=r+120|0)>>2]=0,c[t+4>>2]=0,c[r+128>>2]=0,a[r+560|0]=1,c[r>>2]=17124,c[r+556>>2]=0,c[r+548>>2]=0,c[r+552>>2]=0,wn(r,o),N=144+o|0,0|r},RigidBody_setCenterOfMassTransform:function(e,t){Dn(e|=0,t|=0)},RigidBody_setSleepingThresholds:function(e,t,n){e|=0,t=x(t),n=x(n),A[e+536>>2]=n,A[e+532>>2]=t},RigidBody_getLinearSleepingThreshold:function(e){return x(A[532+(e|=0)>>2])},RigidBody_getAngularSleepingThreshold:function(e){return x(A[536+(e|=0)>>2])},RigidBody_setDamping:function(e,t,n){e|=0,t=x(t),n=x(n);var i;A[8+(i=N-16|0)>>2]=n,A[12+i>>2]=t,c[4+i>>2]=0,c[i>>2]=1065353216,A[e+504>>2]=A[(t<x(0)?4+i|0:t>x(1)?i:12+i|0)>>2],c[4+i>>2]=0,c[i>>2]=1065353216,A[e+508>>2]=A[(n<x(0)?4+i|0:n>x(1)?i:8+i|0)>>2]},RigidBody_setMass:function(e,t){e|=0,t=x(t);var n,i=x(0),o=0,a=x(0);c[8+(N=n=N-16|0)>>2]=1070945621,c[12+n>>2]=0,c[n>>2]=1070945621,c[4+n>>2]=1070945621,o=c[e+192>>2],31==c[o+4>>2]&&c[o+24>>2]<1||pi[c[c[o>>2]+32>>2]](o,t,n),o=c[e+204>>2],t!=x(0)?(c[e+204>>2]=-2&o,a=x(x(1)/t)):c[e+204>>2]=1|o,A[e+404>>2]=a,c[e+436>>2]=0,c[e+468>>2]=0,A[e+424>>2]=A[e+440>>2]*t,i=A[8+n>>2],A[e+464>>2]=i!=x(0)?x(x(1)/i):x(0),i=A[4+n>>2],A[e+460>>2]=i!=x(0)?x(x(1)/i):x(0),i=A[n>>2],A[e+456>>2]=i!=x(0)?x(x(1)/i):x(0),A[e+432>>2]=A[e+448>>2]*t,A[e+428>>2]=A[e+444>>2]*t,t=A[e+412>>2],i=A[e+416>>2],o=A[e+408>>2],c[e+632>>2]=0,A[e+628>>2]=a*i,A[e+624>>2]=a*t,A[e+620>>2]=o*a,N=16+n|0},RigidBody_setMassProps:function(e,t,n){e|=0,t=x(t),n|=0;var i=x(0),o=c[e+204>>2];t!=x(0)?(c[e+204>>2]=-2&o,i=x(x(1)/t)):c[e+204>>2]=1|o,A[e+404>>2]=i,c[e+436>>2]=0,A[e+424>>2]=A[e+440>>2]*t,A[e+432>>2]=A[e+448>>2]*t,A[e+428>>2]=A[e+444>>2]*t,t=A[n+8>>2],o=A[n+4>>2],n=A[n>>2],A[e+620>>2]=A[e+408>>2]*i,A[e+624>>2]=i*A[e+412>>2],A[e+628>>2]=i*A[e+416>>2],c[e+632>>2]=0,c[e+468>>2]=0,A[e+456>>2]=n!=x(0)?x(x(1)/n):x(0),A[e+460>>2]=o!=x(0)?x(x(1)/o):x(0),A[e+464>>2]=t!=x(0)?x(x(1)/t):x(0)},RigidBody_setLinearFactor:function(e,t){e|=0,t|=0,x(0);var n,i=c[t+4>>2];c[e+408>>2]=c[t>>2],c[e+412>>2]=i,n=c[4+(t=t+8|0)>>2],c[(i=e+416|0)>>2]=c[t>>2],c[4+i>>2]=n,c[e+632>>2]=0,n=A[e+404>>2],A[e+624>>2]=n*A[e+412>>2],A[e+620>>2]=n*A[e+408>>2],A[e+628>>2]=n*A[i>>2]},RigidBody_setAngularFactor:function(e,t){var n;t|=0,c[304+(e|=0)>>2]=c[e+304>>2]+1,n=c[t+4>>2],c[e+604>>2]=c[t>>2],c[e+608>>2]=n,n=c[4+(t=t+8|0)>>2],c[(e=e+612|0)>>2]=c[t>>2],c[e+4>>2]=n},RigidBody_getLinearVelocity:function(e){return 372+(e|=0)|0},RigidBody_getAngularVelocity:function(e){return 388+(e|=0)|0},RigidBody_setLinearVelocity:function(e,t){var n;t|=0,c[304+(e|=0)>>2]=c[e+304>>2]+1,n=c[t+4>>2],c[e+372>>2]=c[t>>2],c[e+376>>2]=n,n=c[4+(t=t+8|0)>>2],c[(e=e+380|0)>>2]=c[t>>2],c[e+4>>2]=n},RigidBody_setAngularVelocity:function(e,t){var n;t|=0,c[304+(e|=0)>>2]=c[e+304>>2]+1,n=c[t+4>>2],c[e+388>>2]=c[t>>2],c[e+392>>2]=n,n=c[4+(t=t+8|0)>>2],c[(e=e+396|0)>>2]=c[t>>2],c[e+4>>2]=n},RigidBody_getGravity:function(e){return 440+(e|=0)|0},RigidBody_setGravity:function(e,t){e|=0,t|=0;var n,i,o,a=x(0);(a=A[e+404>>2])!=x(0)&&(n=A[t>>2],i=A[t+4>>2],o=A[t+8>>2],c[e+436>>2]=0,a=x(x(1)/a),A[e+432>>2]=o*a,A[e+428>>2]=a*i,A[e+424>>2]=a*n),n=c[t+4>>2],c[e+440>>2]=c[t>>2],c[e+444>>2]=n,n=c[4+(t=t+8|0)>>2],c[(e=e+448|0)>>2]=c[t>>2],c[e+4>>2]=n},RigidBody_applyTorque:function(e,t){e|=0,t|=0,x(0);var n=A[t+8>>2],i=A[t+4>>2];A[e+488>>2]=x(A[t>>2]*A[e+604>>2])+A[e+488>>2],A[(t=e+492|0)>>2]=x(i*A[e+608>>2])+A[t>>2],A[(t=e+496|0)>>2]=x(n*A[e+612>>2])+A[t>>2]},RigidBody_applyForce:function(e,t,n){e|=0,t|=0,n|=0,x(0);var i,o,a,r,s=A[t+8>>2],c=A[t+4>>2],l=A[e+408>>2];A[e+472>>2]=x(A[t>>2]*l)+A[e+472>>2],o=c,c=A[e+412>>2],A[(a=e+476|0)>>2]=x(o*c)+A[a>>2],i=A[e+416>>2],A[(a=e+480|0)>>2]=x(s*i)+A[a>>2],r=A[t>>2],s=A[n>>2],a=A[n+4>>2],i=x(i*A[t+8>>2]),c=x(c*A[t+4>>2]),n=A[n+8>>2],A[e+488>>2]=x(x(x(a*i)-x(c*n))*A[e+604>>2])+A[e+488>>2],o=A[e+612>>2],t=e+492|0,l=x(l*r),A[t>>2]=x(x(x(n*l)-x(i*s))*A[e+608>>2])+A[t>>2],A[(e=e+496|0)>>2]=x(o*x(x(c*s)-x(l*a)))+A[e>>2]},RigidBody_applyCentralForce:function(e,t){e|=0,t|=0,x(0);var n=A[t+8>>2],i=A[t+4>>2];A[e+472>>2]=x(A[t>>2]*A[e+408>>2])+A[e+472>>2],A[(t=e+476|0)>>2]=x(i*A[e+412>>2])+A[t>>2],A[(t=e+480|0)>>2]=x(n*A[e+416>>2])+A[t>>2]},RigidBody_applyTorqueImpulse:function(e,t){e|=0,t|=0,x(0);var n=A[t>>2],i=A[t+4>>2],o=A[t+8>>2];A[e+388>>2]=x(x(x(x(A[e+324>>2]*n)+x(A[e+328>>2]*i))+x(A[e+332>>2]*o))*A[e+604>>2])+A[e+388>>2],A[(t=e+392|0)>>2]=x(x(x(x(n*A[e+340>>2])+x(i*A[e+344>>2]))+x(o*A[e+348>>2]))*A[e+608>>2])+A[t>>2],A[(t=e+396|0)>>2]=x(x(x(x(n*A[e+356>>2])+x(i*A[e+360>>2]))+x(o*A[e+364>>2]))*A[e+612>>2])+A[t>>2]},RigidBody_applyImpulse:function(e,t,n){ii(e|=0,t|=0,n|=0)},RigidBody_applyCentralImpulse:function(e,t){e|=0,t|=0,x(0);var n=A[t+8>>2],i=A[t+4>>2],o=A[e+404>>2];A[e+372>>2]=x(x(A[t>>2]*A[e+408>>2])*o)+A[e+372>>2],A[(t=e+376|0)>>2]=x(o*x(i*A[e+412>>2]))+A[t>>2],A[(t=e+380|0)>>2]=x(o*x(n*A[e+416>>2]))+A[t>>2]},RigidBody_updateInertiaTensor:function(e){var t,n,i,o,a,r,s,l,_,u,h,f,p,d,m;c[368+(e|=0)>>2]=0,c[e+352>>2]=0,c[e+336>>2]=0,n=A[e+36>>2],l=A[e+456>>2],i=x(n*l),o=A[e+40>>2],_=A[e+460>>2],a=x(o*_),r=A[e+44>>2],d=A[e+464>>2],t=x(r*d),A[e+364>>2]=x(x(n*i)+x(o*a))+x(r*t),u=A[e+20>>2],h=A[e+24>>2],f=A[e+28>>2],A[e+360>>2]=x(x(u*i)+x(h*a))+x(f*t),p=A[e+4>>2],s=x(p*i),i=A[e+8>>2],s=x(s+x(i*a)),a=A[e+12>>2],A[e+356>>2]=s+x(a*t),t=x(l*u),s=x(_*h),m=x(d*f),A[e+348>>2]=x(x(n*t)+x(o*s))+x(r*m),A[e+344>>2]=x(x(u*t)+x(h*s))+x(f*m),A[e+340>>2]=x(x(p*t)+x(i*s))+x(a*m),t=n,n=x(p*l),l=o,o=x(i*_),_=r,r=x(a*d),A[e+332>>2]=x(x(t*n)+x(l*o))+x(_*r),A[e+328>>2]=x(x(n*u)+x(o*h))+x(r*f),A[e+324>>2]=x(x(p*n)+x(i*o))+x(a*r)},RigidBody_getTotalForce:function(e){return 472+(e|=0)|0},RigidBody_getTotalTorque:function(e){return 488+(e|=0)|0},RigidBody_getFlags:function(e){return c[564+(e|=0)>>2]},RigidBody_setFlags:function(e,t){c[564+(e|=0)>>2]=t|=0},RigidBody_clearForces:function(e){var t;c[472+(e|=0)>>2]=0,c[e+476>>2]=0,c[(t=e+496|0)>>2]=0,c[4+t>>2]=0,c[(t=e+488|0)>>2]=0,c[4+t>>2]=0,c[(e=e+480|0)>>2]=0,c[e+4>>2]=0},RigidBody_wantsSleeping:function(e){var t,n=0;return 4!=(0|(t=c[220+(e|=0)>>2]))&&(p[23468]||(n=1,2!=(-2&t)&&(A[e+224>>2]>x(2)||(n=0)))),0|n},RigidBody_clearState:function(e){var t;c[372+(e|=0)>>2]=0,c[e+376>>2]=0,c[e+472>>2]=0,c[e+476>>2]=0,c[(t=e+396|0)>>2]=0,c[4+t>>2]=0,c[(t=e+388|0)>>2]=0,c[4+t>>2]=0,c[(t=e+380|0)>>2]=0,c[4+t>>2]=0,c[(t=e+480|0)>>2]=0,c[4+t>>2]=0,c[(t=e+488|0)>>2]=0,c[4+t>>2]=0,c[(e=e+496|0)>>2]=0,c[e+4>>2]=0},RigidBody_getMotionState:function(e){return c[540+(e|=0)>>2]}}}(e)};e.default=t}(t)})));let VU=e("gU",Uc("cc.PhysicsMaterial")((GU=UU=class e extends __{get friction(){return this._friction}set friction(t){kn(this._friction,t)||(this._friction=t,this.emit(e.EVENT_UPDATE))}get rollingFriction(){return this._rollingFriction}set rollingFriction(t){kn(this._rollingFriction,t)||(this._rollingFriction=t,this.emit(e.EVENT_UPDATE))}get spinningFriction(){return this._spinningFriction}set spinningFriction(t){kn(this._spinningFriction,t)||(this._spinningFriction=t,this.emit(e.EVENT_UPDATE))}get restitution(){return this._restitution}set restitution(t){kn(this._restitution,t)||(this._restitution=t,this.emit(e.EVENT_UPDATE))}constructor(){super(),this.id=void 0,Tc(this,"_friction",LU,this),Tc(this,"_rollingFriction",FU,this),Tc(this,"_spinningFriction",BU,this),Tc(this,"_restitution",kU,this),e.allMaterials.push(this),this.id=e._idCounter++,this._uuid||(this._uuid=`pm_${this.id}`)}clone(){const t=new e;return t._friction=this._friction,t._restitution=this._restitution,t._rollingFriction=this._rollingFriction,t._spinningFriction=this._spinningFriction,t}destroy(){if(super.destroy()){const t=e.allMaterials.indexOf(this);return t>=0&&e.allMaterials.splice(t,1),!0}return!1}setValues(t,n,i,o){const a=this._friction!==t||this._rollingFriction!==n||this._spinningFriction!==i||this._restitution!==o;this._friction=t,this._rollingFriction=n,this._spinningFriction=i,this._restitution=o,a&&this.emit(e.EVENT_UPDATE)}},UU.allMaterials=[],UU.EVENT_UPDATE="event_update",UU._idCounter=0,Pc((zU=GU).prototype,"friction",[il],Object.getOwnPropertyDescriptor(zU.prototype,"friction"),zU.prototype),Pc(zU.prototype,"rollingFriction",[il],Object.getOwnPropertyDescriptor(zU.prototype,"rollingFriction"),zU.prototype),Pc(zU.prototype,"spinningFriction",[il],Object.getOwnPropertyDescriptor(zU.prototype,"spinningFriction"),zU.prototype),Pc(zU.prototype,"restitution",[il],Object.getOwnPropertyDescriptor(zU.prototype,"restitution"),zU.prototype),LU=Pc(zU.prototype,"_friction",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.6}}),FU=Pc(zU.prototype,"_rollingFriction",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),BU=Pc(zU.prototype,"_spinningFriction",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kU=Pc(zU.prototype,"_restitution",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),MU=zU))||MU);class HU{constructor(){this._hitPoint=new _i,this._hitNormal=new _i,this._distance=0,this._collider=null}get hitPoint(){return this._hitPoint}get distance(){return this._distance}get collider(){return this._collider}get hitNormal(){return this._hitNormal}_assign(e,t,n,i){_i.copy(this._hitPoint,e),_i.copy(this._hitNormal,i),this._distance=t,this._collider=n}clone(){const e=new HU;return _i.copy(e._hitPoint,this._hitPoint),_i.copy(e._hitNormal,this._hitNormal),e._distance=this._distance,e._collider=this._collider,e}}e("gV",HU);class WU{constructor(e){if(1===e){const e=this;for(let t=0;t<32;t++){const n="_"+(1<<t);e[n]=0,e.updateArray=[],Object.defineProperty(e,1<<t,{get(){return this[n]},set(e){this[n]!==e&&(this[n]=e,this.updateArray.indexOf(t)<0&&this.updateArray.push(t))}})}this._1=AU.DEFAULT}else{for(let e=0;e<32;e++)this[""+(1<<e)]=0;this[1]=AU.DEFAULT}}}e("et",WU),c.internal.PhysicsGroup=AU;class qU extends Rw{static get PHYSICS_NONE(){return!yU.id}static get PHYSICS_BUILTIN(){return"builtin"===yU.id}static get PHYSICS_CANNON(){return"cannon.js"===yU.id}static get PHYSICS_BULLET(){return"bullet"===yU.id}static get PHYSICS_PHYSX(){return"physx"===yU.id}static get PhysicsGroup(){return AU}static get instance(){return qU._instance}get enable(){return this._enable}set enable(e){this._enable=e}get allowSleep(){return this._allowSleep}set allowSleep(e){this._allowSleep=e,this.physicsWorld&&this.physicsWorld.setAllowSleep(e)}get maxSubSteps(){return this._maxSubSteps}set maxSubSteps(e){this._maxSubSteps=e}get fixedTimeStep(){return this._fixedTimeStep}set fixedTimeStep(e){this._fixedTimeStep=e}get gravity(){return this._gravity}set gravity(e){this._gravity.set(e),this.physicsWorld&&this.physicsWorld.setGravity(e)}get sleepThreshold(){return this._sleepThreshold}set sleepThreshold(e){this._sleepThreshold=e}get autoSimulation(){return this._autoSimulation}set autoSimulation(e){this._autoSimulation=e}get defaultMaterial(){return this._material}get physicsWorld(){return yU.physicsWorld}constructor(){super(),this.raycastClosestResult=new HU,this.raycastResults=[],this.collisionMatrix=new WU(1),this.minVolumeSize=1e-5,this.useNodeChains=!1,this._enable=!0,this._allowSleep=!0,this._maxSubSteps=1,this._subStepCount=0,this._fixedTimeStep=1/60,this._autoSimulation=!0,this._accumulator=0,this._sleepThreshold=.1,this._gravity=new _i(0,-10,0),this._material=new VU,this.raycastOptions={group:-1,mask:-1,queryTrigger:!0,maxDistance:1e7},this.raycastResultPool=new Le((()=>new HU),1),this._material.on(VU.EVENT_UPDATE,this._updateMaterial,this)}postUpdate(e){if(this.physicsWorld)if(this._enable){if(this._autoSimulation){for(this._subStepCount=0,this._accumulator+=e,Vw.emit(jw.EVENT_BEFORE_PHYSICS);this._subStepCount<this._maxSubSteps;){if(!(this._accumulator>=this._fixedTimeStep)){this.physicsWorld.syncSceneToPhysics();break}this.physicsWorld.syncSceneToPhysics(),this.physicsWorld.step(this._fixedTimeStep),this.physicsWorld.emitEvents(),this.physicsWorld.syncAfterEvents(),this._accumulator-=this._fixedTimeStep,this._subStepCount++}Vw.emit(jw.EVENT_AFTER_PHYSICS)}}else this.physicsWorld.syncSceneToPhysics()}resetConfiguration(e){const t=e||(Gw.config?Gw.config.physics:null);if(t){if("boolean"==typeof t.allowSleep&&(this._allowSleep=t.allowSleep),"number"==typeof t.fixedTimeStep&&(this._fixedTimeStep=t.fixedTimeStep),"number"==typeof t.maxSubSteps&&(this._maxSubSteps=t.maxSubSteps),"number"==typeof t.sleepThreshold&&(this._sleepThreshold=t.sleepThreshold),"boolean"==typeof t.autoSimulation&&(this.autoSimulation=t.autoSimulation),t.gravity&&_i.copy(this._gravity,t.gravity),t.defaultMaterial&&this._material.setValues(t.defaultMaterial.friction,t.defaultMaterial.rollingFriction,t.defaultMaterial.spinningFriction,t.defaultMaterial.restitution),t.collisionMatrix)for(const e in t.collisionMatrix)this.collisionMatrix[""+(1<<parseInt(e))]=t.collisionMatrix[e];if(t.collisionGroups){const e=t.collisionGroups;e instanceof Array&&(e.forEach((e=>{AU[e.name]=1<<e.index})),ke.update(AU))}}this.physicsWorld&&(this.physicsWorld.setGravity(this._gravity),this.physicsWorld.setAllowSleep(this._allowSleep),this.physicsWorld.setDefaultMaterial(this._material))}resetAccumulator(e=0){this._accumulator=e}step(e,t,n){this.physicsWorld&&this.physicsWorld.step(e,t,n)}syncSceneToPhysics(){this.physicsWorld&&this.physicsWorld.syncSceneToPhysics()}emitEvents(){this.physicsWorld&&this.physicsWorld.emitEvents()}raycast(e,t=4294967295,n=1e7,i=!0){return!!this.physicsWorld&&(this.raycastResultPool.reset(),this.raycastResults.length=0,this.raycastOptions.mask=t>>>0,this.raycastOptions.maxDistance=n,this.raycastOptions.queryTrigger=i,this.physicsWorld.raycast(e,this.raycastOptions,this.raycastResultPool,this.raycastResults))}raycastClosest(e,t=4294967295,n=1e7,i=!0){return!!this.physicsWorld&&(this.raycastOptions.mask=t>>>0,this.raycastOptions.maxDistance=n,this.raycastOptions.queryTrigger=i,this.physicsWorld.raycastClosest(e,this.raycastOptions,this.raycastClosestResult))}_updateMaterial(){this.physicsWorld&&this.physicsWorld.setDefaultMaterial(this._material)}static constructAndRegister(){if(!qU._instance){const e=new qU;e.resetConfiguration(),function(e){if(vU||(vU=e),yU.runInEditor&&!yU.physicsWorld){console.info(`[PHYSICS]: using ${yU.id}.`);const e=yU.physicsWorld=TU();e.setGravity(vU.gravity),e.setAllowSleep(vU.allowSleep),e.setDefaultMaterial(vU.defaultMaterial)}}(e),qU._instance=e,Vw.registerSystem(qU.ID,e,e.priority)}}}var YU,XU,QU,ZU,JU,KU,$U,eG,tG,nG,iG,oG,aG,rG,sG,cG,lG,_G,uG,hG,fG,pG,dG,mG,AG,vG,gG,xG,yG,bG,SG,CG,EG,TG,PG,wG,IG,RG,DG,NG,OG,MG,zG,LG;e("ed",qU),qU.ID="PHYSICS",qU._instance=null,Vw.once(jw.EVENT_INIT,(()=>{qU.constructAndRegister()}));let FG=e("gS",(YU=Uc("cc.RigidBody"),XU=nl(),QU=Kc(),ZU=jc(-1),JU=vl(qU.PhysicsGroup),KU=hl(),$U=sl(),eG=vl(hU),tG=hl(),nG=sl(),iG=ol(),oG=hl(),aG=sl(),rG=ol(),sG=hl(),cG=sl(),lG=ol(),_G=hl(),uG=sl(),hG=ol(),fG=hl(),pG=sl(),dG=ol(),mG=hl(),AG=sl(),vG=ol(),gG=hl(),xG=sl(),yG=ol(),bG=hl(),SG=sl(),YU(CG=XU(CG=QU(CG=Jc(CG=Vc(CG=ZU((LG=zG=class extends R_{constructor(...e){super(...e),this._body=null,Tc(this,"_group",TG,this),Tc(this,"_type",PG,this),Tc(this,"_mass",wG,this),Tc(this,"_allowSleep",IG,this),Tc(this,"_linearDamping",RG,this),Tc(this,"_angularDamping",DG,this),Tc(this,"_useGravity",NG,this),Tc(this,"_linearFactor",OG,this),Tc(this,"_angularFactor",MG,this)}get group(){return this._group}set group(e){this._group=e,this._body&&this._body.getGroup()!==e&&this._body.setGroup(e)}get type(){return this._type}set type(e){this._type!==e&&(this._type=e,this._body&&this._body.setType(e))}get mass(){return this._mass}set mass(e){this._mass!==e&&(e=e<=0?1e-4:e,this._mass=e,this._body&&this._body.setMass(e))}get allowSleep(){return this._allowSleep}set allowSleep(e){this._allowSleep=e,this._body&&this._body.setAllowSleep(e)}get linearDamping(){return this._linearDamping}set linearDamping(e){this._linearDamping=e,this._body&&this._body.setLinearDamping(e)}get angularDamping(){return this._angularDamping}set angularDamping(e){this._angularDamping=e,this._body&&this._body.setAngularDamping(e)}get useGravity(){return this._useGravity}set useGravity(e){this._useGravity=e,this._body&&this._body.useGravity(e)}get linearFactor(){return this._linearFactor}set linearFactor(e){_i.copy(this._linearFactor,e),this._body&&this._body.setLinearFactor(this._linearFactor)}get angularFactor(){return this._angularFactor}set angularFactor(e){_i.copy(this._angularFactor,e),this._body&&this._body.setAngularFactor(this._angularFactor)}get sleepThreshold(){return this._isInitialized?this._body.getSleepThreshold():.1}set sleepThreshold(e){this._isInitialized&&this._body.setSleepThreshold(e)}get useCCD(){return!!this._isInitialized&&this._body.isUsingCCD()}set useCCD(e){this._isInitialized&&this._body.useCCD(e)}get isAwake(){return!!this._isInitialized&&this._body.isAwake}get isSleepy(){return!!this._isInitialized&&this._body.isSleepy}get isSleeping(){return!!this._isInitialized&&this._body.isSleeping}get isStatic(){return this._type===hU.STATIC}set isStatic(e){e&&this.isStatic||!e&&!this.isStatic||(this.type=e?hU.STATIC:hU.DYNAMIC)}get isDynamic(){return this._type===hU.DYNAMIC}set isDynamic(e){e&&this.isDynamic||!e&&!this.isDynamic||(this.type=e?hU.DYNAMIC:hU.KINEMATIC)}get isKinematic(){return this._type===hU.KINEMATIC}set isKinematic(e){e&&this.isKinematic||!e&&!this.isKinematic||(this.type=e?hU.KINEMATIC:hU.DYNAMIC)}get body(){return this._body}get _isInitialized(){const e=null===this._body;return e&&g("[Physics]: This component has not been call onLoad yet, please make sure the node has been added to the scene."),!e}onLoad(){yU.runInEditor&&(this._body=EU(yU.wrapper.RigidBody,CU.RigidBody)?PU:new yU.wrapper.RigidBody,this._body.initialize(this))}onEnable(){this._body&&this._body.onEnable()}onDisable(){this._body&&this._body.onDisable()}onDestroy(){this._body&&this._body.onDestroy()}applyForce(e,t){this._isInitialized&&this._body.applyForce(e,t)}applyLocalForce(e,t){this._isInitialized&&this._body.applyLocalForce(e,t)}applyImpulse(e,t){this._isInitialized&&this._body.applyImpulse(e,t)}applyLocalImpulse(e,t){this._isInitialized&&this._body.applyLocalImpulse(e,t)}applyTorque(e){this._isInitialized&&this._body.applyTorque(e)}applyLocalTorque(e){this._isInitialized&&this._body.applyLocalTorque(e)}wakeUp(){this._isInitialized&&this._body.wakeUp()}sleep(){this._isInitialized&&this._body.sleep()}clearState(){this._isInitialized&&this._body.clearState()}clearForces(){this._isInitialized&&this._body.clearForces()}clearVelocity(){this._isInitialized&&this._body.clearVelocity()}getLinearVelocity(e){this._isInitialized&&this._body.getLinearVelocity(e)}setLinearVelocity(e){this._isInitialized&&this._body.setLinearVelocity(e)}getAngularVelocity(e){this._isInitialized&&this._body.getAngularVelocity(e)}setAngularVelocity(e){this._isInitialized&&this._body.setAngularVelocity(e)}getGroup(){return this._isInitialized?this._body.getGroup():0}setGroup(e){this._isInitialized&&this._body.setGroup(e)}addGroup(e){this._isInitialized&&this._body.addGroup(e)}removeGroup(e){this._isInitialized&&this._body.removeGroup(e)}getMask(){return this._isInitialized?this._body.getMask():0}setMask(e){this._isInitialized&&this._body.setMask(e)}addMask(e){this._isInitialized&&this._body.addMask(e)}removeMask(e){this._isInitialized&&this._body.removeMask(e)}},zG.Type=hU,Pc((EG=LG).prototype,"group",[JU,KU,$U],Object.getOwnPropertyDescriptor(EG.prototype,"group"),EG.prototype),Pc(EG.prototype,"type",[eG,tG,nG],Object.getOwnPropertyDescriptor(EG.prototype,"type"),EG.prototype),Pc(EG.prototype,"mass",[iG,oG,aG],Object.getOwnPropertyDescriptor(EG.prototype,"mass"),EG.prototype),Pc(EG.prototype,"allowSleep",[rG,sG,cG],Object.getOwnPropertyDescriptor(EG.prototype,"allowSleep"),EG.prototype),Pc(EG.prototype,"linearDamping",[lG,_G,uG],Object.getOwnPropertyDescriptor(EG.prototype,"linearDamping"),EG.prototype),Pc(EG.prototype,"angularDamping",[hG,fG,pG],Object.getOwnPropertyDescriptor(EG.prototype,"angularDamping"),EG.prototype),Pc(EG.prototype,"useGravity",[dG,mG,AG],Object.getOwnPropertyDescriptor(EG.prototype,"useGravity"),EG.prototype),Pc(EG.prototype,"linearFactor",[vG,gG,xG],Object.getOwnPropertyDescriptor(EG.prototype,"linearFactor"),EG.prototype),Pc(EG.prototype,"angularFactor",[yG,bG,SG],Object.getOwnPropertyDescriptor(EG.prototype,"angularFactor"),EG.prototype),TG=Pc(EG.prototype,"_group",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qU.PhysicsGroup.DEFAULT}}),PG=Pc(EG.prototype,"_type",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hU.DYNAMIC}}),wG=Pc(EG.prototype,"_mass",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),IG=Pc(EG.prototype,"_allowSleep",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),RG=Pc(EG.prototype,"_linearDamping",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),DG=Pc(EG.prototype,"_angularDamping",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),NG=Pc(EG.prototype,"_useGravity",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),OG=Pc(EG.prototype,"_linearFactor",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(1,1,1)}}),MG=Pc(EG.prototype,"_angularFactor",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(1,1,1)}}),CG=EG))||CG)||CG)||CG)||CG)||CG)||CG));var BG,kG,UG,GG,jG,VG,HG,WG,qG,YG,XG,QG,ZG,JG,KG,$G,ej,tj,nj,ij,oj,aj;FG||(FG=e("gS",{}));let rj=e("gW",(BG=Uc("cc.Collider"),kG=vl(FG),UG=rl(),GG=hl(),jG=sl(),VG=vl(VU),HG=rl(),WG=hl(),qG=sl(),YG=hl(),XG=sl(),QG=vl(_i),ZG=hl(),JG=sl(),KG=vl(VU),BG((aj=oj=class extends(qt(R_)){get attachedRigidBody(){return function(e){const t=e.getComponent(FG);return t&&t.isValid?t:null}(this.node)}get sharedMaterial(){return this._material}set sharedMaterial(e){this.material=e}get material(){return this._isSharedMaterial&&this._material&&(this._material.off(VU.EVENT_UPDATE,this._updateMaterial,this),this._material=this._material.clone(),this._material.on(VU.EVENT_UPDATE,this._updateMaterial,this),this._isSharedMaterial=!1),this._material}set material(e){this._shape?(e&&this._material?this._material.id!==e.id&&(this._material.off(VU.EVENT_UPDATE,this._updateMaterial,this),e.on(VU.EVENT_UPDATE,this._updateMaterial,this),this._isSharedMaterial=!1,this._material=e):e&&!this._material?(e.on(VU.EVENT_UPDATE,this._updateMaterial,this),this._material=e):!e&&this._material&&(this._material.off(VU.EVENT_UPDATE,this._updateMaterial,this),this._material=e),this._updateMaterial()):this._material=e}get isTrigger(){return this._isTrigger}set isTrigger(e){this._isTrigger=e,this._shape&&this._shape.setAsTrigger(this._isTrigger)}get center(){return this._center}set center(e){_i.copy(this._center,e),this._shape&&this._shape.setCenter(this._center)}get shape(){return this._shape}get worldBounds(){return null==this._aabb&&(this._aabb=new dc),this._shape&&this._shape.getAABB(this._aabb),this._aabb}get boundingSphere(){return null==this._boundingSphere&&(this._boundingSphere=new Oo),this._shape&&this._shape.getBoundingSphere(this._boundingSphere),this._boundingSphere}get needTriggerEvent(){return this._needTriggerEvent}get needCollisionEvent(){return this._needCollisionEvent}get _isInitialized(){const e=null===this._shape;return e&&g("[Physics]: This component has not been call onLoad yet, please make sure the node has been added to the scene."),!e}constructor(e){super(),this.type=void 0,this._shape=null,this._aabb=null,this._boundingSphere=null,this._isSharedMaterial=!0,this._needTriggerEvent=!1,this._needCollisionEvent=!1,Tc(this,"_material",tj,this),Tc(this,"_isTrigger",nj,this),Tc(this,"_center",ij,this),this.type=e}on(e,t,n,i){const o=super.on(e,t,n,i);return this._updateNeedEvent(e),o}off(e,t,n){super.off(e,t,n),this._updateNeedEvent()}once(e,t,n){const i=super.once(e,t,n);return this._updateNeedEvent(e),i}removeAll(e){super.removeAll(e),this._updateNeedEvent()}getGroup(){return this._isInitialized?this._shape.getGroup():0}setGroup(e){this._isInitialized&&this._shape.setGroup(e)}addGroup(e){this._isInitialized&&this._shape.addGroup(e)}removeGroup(e){this._isInitialized&&this._shape.removeGroup(e)}getMask(){return this._isInitialized?this._shape.getMask():0}setMask(e){this._isInitialized&&this._shape.setMask(e)}addMask(e){this._isInitialized&&this._shape.addMask(e)}removeMask(e){this._isInitialized&&this._shape.removeMask(e)}onLoad(){yU.runInEditor&&(this.sharedMaterial=null==this._material?qU.instance.defaultMaterial:this._material,this._shape=function(e){return wU.INITED||(wU.INITED=!0,wU[dU.BOX]=function(){return EU(yU.wrapper.BoxShape,CU.BoxCollider)?IU:new yU.wrapper.BoxShape},wU[dU.SPHERE]=function(){return EU(yU.wrapper.SphereShape,CU.SphereCollider)?IU:new yU.wrapper.SphereShape},wU[dU.CAPSULE]=function(){return EU(yU.wrapper.CapsuleShape,CU.CapsuleCollider)?IU:new yU.wrapper.CapsuleShape},wU[dU.CYLINDER]=function(){return EU(yU.wrapper.CylinderShape,CU.CylinderCollider)?IU:new yU.wrapper.CylinderShape},wU[dU.CONE]=function(){return EU(yU.wrapper.ConeShape,CU.ConeCollider)?IU:new yU.wrapper.ConeShape},wU[dU.MESH]=function(){return EU(yU.wrapper.TrimeshShape,CU.MeshCollider)?IU:new yU.wrapper.TrimeshShape},wU[dU.TERRAIN]=function(){return EU(yU.wrapper.TerrainShape,CU.TerrainCollider)?IU:new yU.wrapper.TerrainShape},wU[dU.SIMPLEX]=function(){return EU(yU.wrapper.SimplexShape,CU.SimplexCollider)?IU:new yU.wrapper.SimplexShape},wU[dU.PLANE]=function(){return EU(yU.wrapper.PlaneShape,CU.PlaneCollider)?IU:new yU.wrapper.PlaneShape}),wU[e]()}(this.type),this._shape.initialize(this),this._shape.onLoad())}onEnable(){this._shape&&this._shape.onEnable()}onDisable(){this._shape&&this._shape.onDisable()}onDestroy(){this._shape&&(this._needTriggerEvent=!1,this._needCollisionEvent=!1,this._shape.updateEventListener(),this._material&&this._material.off(VU.EVENT_UPDATE,this._updateMaterial,this),this._shape.onDestroy()),this._boundingSphere&&this._boundingSphere.destroy()}_updateMaterial(){this._shape&&this._shape.setMaterial(this._material)}_updateNeedEvent(e){this.isValid&&(void 0!==e?("onCollisionEnter"!==e&&"onCollisionStay"!==e&&"onCollisionExit"!==e||(this._needCollisionEvent=!0),"onTriggerEnter"!==e&&"onTriggerStay"!==e&&"onTriggerExit"!==e||(this._needTriggerEvent=!0)):(this.hasEventListener("onTriggerEnter")||this.hasEventListener("onTriggerStay")||this.hasEventListener("onTriggerExit")||(this._needTriggerEvent=!1),this.hasEventListener("onCollisionEnter")||this.hasEventListener("onCollisionStay")||this.hasEventListener("onCollisionExit")||(this._needCollisionEvent=!1)),this._shape&&this._shape.updateEventListener())}},oj.Type=dU,oj.Axis=fU,Pc((ej=aj).prototype,"attachedRigidBody",[kG,al,UG,GG,jG],Object.getOwnPropertyDescriptor(ej.prototype,"attachedRigidBody"),ej.prototype),Pc(ej.prototype,"sharedMaterial",[VG,HG,WG,qG],Object.getOwnPropertyDescriptor(ej.prototype,"sharedMaterial"),ej.prototype),Pc(ej.prototype,"isTrigger",[YG,XG],Object.getOwnPropertyDescriptor(ej.prototype,"isTrigger"),ej.prototype),Pc(ej.prototype,"center",[QG,ZG,JG],Object.getOwnPropertyDescriptor(ej.prototype,"center"),ej.prototype),tj=Pc(ej.prototype,"_material",[KG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nj=Pc(ej.prototype,"_isTrigger",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ij=Pc(ej.prototype,"_center",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),$G=ej))||$G));function sj(e){return void 0===(e=e||{}).includeNormal&&(e.includeNormal=!0),void 0===e.includeUV&&(e.includeUV=!0),e}rj||(rj=e("gW",{}));const cj=new _i,lj=new _i,_j=new _i,uj=new _i,hj=new _i,fj=new _i,pj=new _i,dj=new _i,mj=new _i,Aj=new _i,vj=new _i,gj=new _i,xj=new _i(0,0,0),yj=new _i(0,0,0);function bj(e=.5,t=.5,n=2,i={}){const o=.5*n,a=i.radialSegments||32,r=i.heightSegments||1,s=void 0===i.capped||i.capped,c=i.arc||2*Math.PI;let l=0;s||(e>0&&l++,t>0&&l++);let _=(a+1)*(r+1);s&&(_+=(a+1)*l+a*l);let u=a*r*6;s&&(u+=a*l*3);const h=new Array(u),f=new Array(3*_),p=new Array(3*_),d=new Array(2*_),m=Math.max(e,t),A=new _i(-m,-o,-m),v=new _i(m,o,m),g=Math.sqrt(m*m+o*o);let x=0,y=0;return function(){const i=[],s=e-t,l=s*s/n*Math.sign(s);for(let e=0;e<=r;e++){const _=[],u=e/r,h=u*s+t;for(let e=0;e<=a;++e){const t=e/a,i=t*c,r=Math.sin(i),s=Math.cos(i);f[3*x]=h*r,f[3*x+1]=u*n-o,f[3*x+2]=h*s,_i.normalize(xj,_i.set(yj,r,-l,s)),p[3*x]=xj.x,p[3*x+1]=xj.y,p[3*x+2]=xj.z,d[2*x]=2*(1-t)%1,d[2*x+1]=u,_.push(x),++x}i.push(_)}for(let e=0;e<r;++e)for(let t=0;t<a;++t){const n=i[e][t],o=i[e+1][t],a=i[e+1][t+1],r=i[e][t+1];h[y]=n,++y,h[y]=r,++y,h[y]=o,++y,h[y]=r,++y,h[y]=a,++y,h[y]=o,++y}}(),s&&(t>0&&b(!1),e>0&&b(!0)),{positions:f,normals:p,uvs:d,indices:h,minPos:A,maxPos:v,boundingRadius:g};function b(n){const i=n?e:t,r=n?1:-1,s=x;for(let e=1;e<=a;++e)f[3*x]=0,f[3*x+1]=o*r,f[3*x+2]=0,p[3*x]=0,p[3*x+1]=r,p[3*x+2]=0,d[2*x]=.5,d[2*x+1]=.5,++x;const l=x;for(let e=0;e<=a;++e){const t=e/a*c,n=Math.cos(t),s=Math.sin(t);f[3*x]=i*s,f[3*x+1]=o*r,f[3*x+2]=i*n,p[3*x]=0,p[3*x+1]=r,p[3*x+2]=0,d[2*x]=.5-.5*s*r,d[2*x+1]=.5+.5*n,++x}for(let e=0;e<a;++e){const t=s+e,i=l+e;n?(h[y]=i+1,++y,h[y]=t,++y,h[y]=i,++y):(h[y]=t,++y,h[y]=i+1,++y,h[y]=i,++y)}}}const Sj=new _i(0,0,0),Cj=new _i(0,0,0),Ej=new _i(0,0,0),Tj=new _i(0,0,0),Pj=new _i(0,0,0),wj=new _i(0,0,0),Ij=new _i(0,0,0),Rj=new _i(0,0,0),Dj=new _i(0,0,0),Nj=e("ei",new _i);function Oj(e){return e.x=Math.abs(e.x),e.y=Math.abs(e.y),e.z=Math.abs(e.z),e}var Mj,zj,Lj,Fj,Bj,kj,Uj,Gj,jj=Object.freeze({__proto__:null,setWrap:function(e,t){e.__cc_wrapper__=t},getWrap:function(e){return e.__cc_wrapper__},maxComponent:function(e){return Math.max(e.x,Math.max(e.y,e.z))},VEC3_0:Nj,TriggerEventObject:{type:"onTriggerEnter",selfCollider:null,otherCollider:null,impl:null},CollisionEventObject:{type:"onCollisionEnter",selfCollider:null,otherCollider:null,contacts:[],impl:null},shrinkPositions:function(e){const t=[];if(e.length>=3){t[0]=e[0],t[1]=e[1],t[2]=e[2];const n=e.length;for(let i=3;i<n;i+=3){const n=e[i],o=e[i+1],a=e[i+2],r=t.length;let s=!0;for(let e=0;e<r;e+=3)if(kn(n,t[e])&&kn(o,t[e+1])&&kn(a,t[e+2])){s=!1;break}s&&(t.push(n),t.push(o),t.push(a))}}return t},absolute:Oj,cylinder:bj});let Vj=e("gX",(Mj=Uc("cc.BoxCollider"),zj=nl(),Lj=Kc(),Fj=vl(_i),Bj=sl(),Mj(kj=zj(kj=Lj(kj=Jc((Pc((Uj=class extends rj{get size(){return this._size}set size(e){_i.strictEquals(this._size,e)||(_i.copy(this._size,e),Oj(this._size),this._shape&&this.shape.updateSize())}get shape(){return this._shape}constructor(){super(dU.BOX),Tc(this,"_size",Gj,this)}}).prototype,"size",[Fj,Bj],Object.getOwnPropertyDescriptor(Uj.prototype,"size"),Uj.prototype),Gj=Pc(Uj.prototype,"_size",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(1,1,1)}}),kj=Uj))||kj)||kj)||kj)||kj));var Hj,Wj,qj,Yj,Xj,Qj,Zj;let Jj=e("gY",(Hj=Uc("cc.SphereCollider"),Wj=nl(),qj=Kc(),Yj=sl(),Hj(Xj=Wj(Xj=qj(Xj=Jc((Pc((Qj=class extends rj{get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=Math.abs(e),this._shape&&this.shape.updateRadius())}get shape(){return this._shape}constructor(){super(dU.SPHERE),Tc(this,"_radius",Zj,this)}}).prototype,"radius",[Yj],Object.getOwnPropertyDescriptor(Qj.prototype,"radius"),Qj.prototype),Zj=Pc(Qj.prototype,"_radius",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Xj=Qj))||Xj)||Xj)||Xj)||Xj));var Kj,$j,eV,tV,nV,iV,oV,aV,rV,sV,cV,lV;let _V=e("gZ",(Kj=Uc("cc.CapsuleCollider"),$j=nl(),eV=Kc(),tV=sl(),nV=sl(),iV=vl(fU),oV=sl(),Kj(aV=$j(aV=eV(aV=Jc((Pc((rV=class extends rj{get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=Math.abs(e),this._shape&&this.shape.setRadius(e))}get cylinderHeight(){return this._cylinderHeight}set cylinderHeight(e){this._cylinderHeight!==e&&(this._cylinderHeight=Math.abs(e),this._shape&&this.shape.setCylinderHeight(e))}get direction(){return this._direction}set direction(e){(e=Math.floor(e))<fU.X_AXIS||e>fU.Z_AXIS||this._direction!==e&&(this._direction=e,this._shape&&this.shape.setDirection(e))}get height(){return 2*this._radius+this._cylinderHeight}set height(e){let t=e-2*this._radius;t<0&&(t=0),this.cylinderHeight=t}get worldHeight(){return 2*this._radius*this._getRadiusScale()+this._cylinderHeight*this._getHeightScale()}get shape(){return this._shape}constructor(){super(dU.CAPSULE),Tc(this,"_radius",sV,this),Tc(this,"_cylinderHeight",cV,this),Tc(this,"_direction",lV,this)}_getRadiusScale(){if(null==this.node)return 1;const e=this.node.worldScale;return this._direction===fU.Y_AXIS?Math.abs(ii(e.x,e.z)):this._direction===fU.X_AXIS?Math.abs(ii(e.y,e.z)):Math.abs(ii(e.x,e.y))}_getHeightScale(){if(null==this.node)return 1;const e=this.node.worldScale;return this._direction===fU.Y_AXIS?Math.abs(e.y):this._direction===fU.X_AXIS?Math.abs(e.x):Math.abs(e.z)}}).prototype,"radius",[tV],Object.getOwnPropertyDescriptor(rV.prototype,"radius"),rV.prototype),Pc(rV.prototype,"cylinderHeight",[nV],Object.getOwnPropertyDescriptor(rV.prototype,"cylinderHeight"),rV.prototype),Pc(rV.prototype,"direction",[iV,oV],Object.getOwnPropertyDescriptor(rV.prototype,"direction"),rV.prototype),sV=Pc(rV.prototype,"_radius",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),cV=Pc(rV.prototype,"_cylinderHeight",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),lV=Pc(rV.prototype,"_direction",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fU.Y_AXIS}}),aV=rV))||aV)||aV)||aV)||aV));var uV,hV,fV,pV,dV,mV,AV,vV,gV,xV,yV,bV;let SV=e("g$",(uV=Uc("cc.CylinderCollider"),hV=nl(),fV=Kc(),pV=sl(),dV=sl(),mV=vl(fU),AV=sl(),uV(vV=hV(vV=fV(vV=Jc((Pc((gV=class extends rj{get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=Math.abs(e),this._shape&&this.shape.setRadius(e))}get height(){return this._height}set height(e){this._height!==e&&(this._height=Math.abs(e),this._shape&&this.shape.setHeight(e))}get direction(){return this._direction}set direction(e){this._direction!==e&&(e<fU.X_AXIS||e>fU.Z_AXIS||(this._direction=e,this._shape&&this.shape.setDirection(e)))}get shape(){return this._shape}constructor(){super(dU.CYLINDER),Tc(this,"_radius",xV,this),Tc(this,"_height",yV,this),Tc(this,"_direction",bV,this)}}).prototype,"radius",[pV],Object.getOwnPropertyDescriptor(gV.prototype,"radius"),gV.prototype),Pc(gV.prototype,"height",[dV],Object.getOwnPropertyDescriptor(gV.prototype,"height"),gV.prototype),Pc(gV.prototype,"direction",[mV,AV],Object.getOwnPropertyDescriptor(gV.prototype,"direction"),gV.prototype),xV=Pc(gV.prototype,"_radius",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),yV=Pc(gV.prototype,"_height",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),bV=Pc(gV.prototype,"_direction",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fU.Y_AXIS}}),vV=gV))||vV)||vV)||vV)||vV));var CV,EV,TV,PV,wV,IV,RV,DV,NV,OV,MV,zV;let LV=e("h0",(CV=Uc("cc.ConeCollider"),EV=nl(),TV=Kc(),PV=sl(),wV=sl(),IV=vl(fU),RV=sl(),CV(DV=EV(DV=TV(DV=Jc((Pc((NV=class extends rj{get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=Math.abs(e),this._shape&&this.shape.setRadius(e))}get height(){return this._height}set height(e){this._height!==e&&(e<0&&(e=0),this._height=e,this._shape&&this.shape.setHeight(e))}get direction(){return this._direction}set direction(e){this._direction!==e&&(e<fU.X_AXIS||e>fU.Z_AXIS||(this._direction=e,this._shape&&this.shape.setDirection(e)))}get shape(){return this._shape}constructor(){super(dU.CONE),Tc(this,"_radius",OV,this),Tc(this,"_height",MV,this),Tc(this,"_direction",zV,this)}}).prototype,"radius",[PV],Object.getOwnPropertyDescriptor(NV.prototype,"radius"),NV.prototype),Pc(NV.prototype,"height",[wV],Object.getOwnPropertyDescriptor(NV.prototype,"height"),NV.prototype),Pc(NV.prototype,"direction",[IV,RV],Object.getOwnPropertyDescriptor(NV.prototype,"direction"),NV.prototype),OV=Pc(NV.prototype,"_radius",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),MV=Pc(NV.prototype,"_height",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),zV=Pc(NV.prototype,"_direction",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fU.Y_AXIS}}),DV=NV))||DV)||DV)||DV)||DV));var FV,BV,kV,UV,GV,jV,VV,HV,WV,qV;let YV=e("g_",(FV=Uc("cc.MeshCollider"),BV=nl(),kV=Kc(),UV=vl(Kk),GV=sl(),jV=sl(),FV(VV=BV(VV=kV(VV=Jc((Pc((HV=class extends rj{get mesh(){return this._mesh}set mesh(e){this._mesh!==e&&(this._mesh=e,this._shape&&this.shape.setMesh(this._mesh))}get convex(){return this._convex}set convex(e){this._convex!==e&&(this._convex=e)}get shape(){return this._shape}constructor(){super(dU.MESH),Tc(this,"_mesh",WV,this),Tc(this,"_convex",qV,this)}}).prototype,"mesh",[UV,GV],Object.getOwnPropertyDescriptor(HV.prototype,"mesh"),HV.prototype),Pc(HV.prototype,"convex",[il,jV],Object.getOwnPropertyDescriptor(HV.prototype,"convex"),HV.prototype),WV=Pc(HV.prototype,"_mesh",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qV=Pc(HV.prototype,"_convex",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),VV=HV))||VV)||VV)||VV)||VV));var XV,QV,ZV,JV,KV,$V,eH,tH,nH,iH,oH,aH,rH,sH,cH,lH,_H,uH;let hH=e("gT",(XV=Uc("cc.ConstantForce"),QV=nl(),ZV=Gc(FG),JV=Kc(),KV=hl(),$V=sl(),eH=hl(),tH=sl(),nH=hl(),iH=sl(),oH=hl(),aH=sl(),XV(rH=QV(rH=ZV(rH=JV(rH=Vc(rH=Jc((cH=Pc((sH=class extends R_{constructor(...e){super(...e),this._rigidBody=null,Tc(this,"_force",cH,this),Tc(this,"_localForce",lH,this),Tc(this,"_torque",_H,this),Tc(this,"_localTorque",uH,this),this._mask=0}get force(){return this._force}set force(e){_i.copy(this._force,e),this._maskUpdate(this._force,1)}get localForce(){return this._localForce}set localForce(e){_i.copy(this._localForce,e),this._maskUpdate(this.localForce,2)}get torque(){return this._torque}set torque(e){_i.copy(this._torque,e),this._maskUpdate(this._torque,4)}get localTorque(){return this._localTorque}set localTorque(e){_i.copy(this._localTorque,e),this._maskUpdate(this._localTorque,8)}onLoad(){this._rigidBody=this.node.getComponent(FG),this._maskUpdate(this._force,1),this._maskUpdate(this._localForce,2),this._maskUpdate(this._torque,4),this._maskUpdate(this._localTorque,8)}lateUpdate(e){null!=this._rigidBody&&0!==this._mask&&(1&this._mask&&this._rigidBody.applyForce(this._force),2&this._mask&&this._rigidBody.applyLocalForce(this.localForce),4&this._mask&&this._rigidBody.applyTorque(this._torque),8&this._mask&&this._rigidBody.applyLocalTorque(this._localTorque))}_maskUpdate(e,t){e.strictEquals(_i.ZERO)?this._mask&=~t:this._mask|=t}}).prototype,"_force",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),lH=Pc(sH.prototype,"_localForce",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),_H=Pc(sH.prototype,"_torque",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),uH=Pc(sH.prototype,"_localTorque",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),Pc(sH.prototype,"force",[KV,$V],Object.getOwnPropertyDescriptor(sH.prototype,"force"),sH.prototype),Pc(sH.prototype,"localForce",[eH,tH],Object.getOwnPropertyDescriptor(sH.prototype,"localForce"),sH.prototype),Pc(sH.prototype,"torque",[nH,iH],Object.getOwnPropertyDescriptor(sH.prototype,"torque"),sH.prototype),Pc(sH.prototype,"localTorque",[oH,aH],Object.getOwnPropertyDescriptor(sH.prototype,"localTorque"),sH.prototype),rH=sH))||rH)||rH)||rH)||rH)||rH)||rH));var fH,pH,dH,mH,AH,vH,gH,xH,yH,bH,SH,CH;e("h8",4),e("eX",4),e("eP",256);const EH=e("eK",32),TH=(e("eJ",33),e("eI",8),e("eV",32768)),PH=e("eW",1/512),wH=(e("eU",-TH*PH),e("eT",(65535-TH)*PH),e("h9",0),e("ha",1),e("hb",2),e("hc",3),e("hd",16842753)),IH=e("he",16842754),RH=e("hf",16842755),DH=e("hg",16842756),NH=e("eY",16842757),OH=e("hh",16843025);class MH{constructor(){this.length=0,this.buffer=new Uint8Array(2048),this._buffView=new DataView(this.buffer.buffer),this._seekPos=0}reserve(e){if(this.buffer.byteLength>e)return;let t=this.buffer.byteLength;for(;t<e;)t+=t;const n=new Uint8Array(t);for(let e=0;e<this.length;++e)n[e]=this.buffer[e];this.buffer=n,this._buffView=new DataView(this.buffer.buffer)}assign(e){this.buffer=e,this.length=e.length,this._seekPos=e.byteOffset,this._buffView=new DataView(e.buffer)}writeInt8(e){this.reserve(this.length+1),this._buffView.setInt8(this.length,e),this.length+=1}writeInt16(e){this.reserve(this.length+2),this._buffView.setInt16(this.length,e,!0),this.length+=2}writeInt32(e){this.reserve(this.length+4),this._buffView.setInt32(this.length,e,!0),this.length+=4}writeIntArray(e){this.reserve(this.length+4*e.length);for(let t=0;t<e.length;++t)this._buffView.setInt32(this.length+4*t,e[t],!0);this.length+=4*e.length}writeFloat(e){this.reserve(this.length+4),this._buffView.setFloat32(this.length,e,!0),this.length+=4}writeFloatArray(e){this.reserve(this.length+4*e.length);for(let t=0;t<e.length;++t)this._buffView.setFloat32(this.length+4*t,e[t],!0);this.length+=4*e.length}writeString(e){this.reserve(this.length+e.length+4),this._buffView.setInt32(this.length,e.length,!0);for(let t=0;t<e.length;++t)this._buffView.setInt8(this.length+4+t,e.charCodeAt(t));this.length+=e.length+4}readInt8(){const e=this._buffView.getInt8(this._seekPos);return this._seekPos+=1,e}readInt16(){const e=this._buffView.getInt16(this._seekPos,!0);return this._seekPos+=2,e}readInt(){const e=this._buffView.getInt32(this._seekPos,!0);return this._seekPos+=4,e}readIntArray(e){for(let t=0;t<e.length;++t)e[t]=this._buffView.getInt32(this._seekPos+4*t,!0);return this._seekPos+=4*e.length,e}readFloat(){const e=this._buffView.getFloat32(this._seekPos,!0);return this._seekPos+=4,e}readFloatArray(e){for(let t=0;t<e.length;++t)e[t]=this._buffView.getFloat32(this._seekPos+4*t,!0);return this._seekPos+=4*e.length,e}readString(){const e=this.readInt();let t="";for(let n=0;n<e;++n)t+=String.fromCharCode(this.readInt8());return t}}e("eR",Uc("cc.TerrainLayerInfo")((dH=Pc((pH=class{constructor(){Tc(this,"slot",dH,this),Tc(this,"tileSize",mH,this),Tc(this,"detailMap",AH,this),Tc(this,"normalMap",vH,this),Tc(this,"roughness",gH,this),Tc(this,"metallic",xH,this)}}).prototype,"slot",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mH=Pc(pH.prototype,"tileSize",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),AH=Pc(pH.prototype,"detailMap",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vH=Pc(pH.prototype,"normalMap",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gH=Pc(pH.prototype,"roughness",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),xH=Pc(pH.prototype,"metallic",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fH=pH))||fH);let zH=e("hi",Uc("cc.TerrainLayerBinaryInfo")(yH=class{constructor(){this.slot=0,this.tileSize=1,this.roughness=1,this.metallic=0,this.detailMapId="",this.normalMapId=""}})||yH),LH=e("eL",Uc("cc.TerrainAsset")((CH=Pc((SH=class extends __{constructor(){super(),this._version=0,this._data=null,this._tileSize=1,this._blockCount=[1,1],this._weightMapSize=128,this._lightMapSize=128,this._heights=new Uint16Array,this._weights=new Uint8Array,this._layerBuffer=[-1,-1,-1,-1],this._layerBinaryInfos=[],Tc(this,"_layerInfos",CH,this)}get _nativeAsset(){return this._data.buffer}set _nativeAsset(e){this._data&&this._data.byteLength===e.byteLength?this._data.set(new Uint8Array(e)):this._data=new Uint8Array(e),this._loadNativeData(this._data)}get version(){return this._version}set tileSize(e){this._tileSize=e}get tileSize(){return this._tileSize}set blockCount(e){this._blockCount=e}get blockCount(){return this._blockCount}set lightMapSize(e){this._lightMapSize=e}get lightMapSize(){return this._lightMapSize}set weightMapSize(e){this._weightMapSize=e}get weightMapSize(){return this._weightMapSize}set heights(e){this._heights=e}get heights(){return this._heights}set weights(e){this._weights=e}get weights(){return this._weights}set layerBuffer(e){this._layerBuffer=e}get layerBuffer(){return this._layerBuffer}set layerInfos(e){this._layerInfos=e}get layerInfos(){return this._layerInfos}get layerBinaryInfos(){return this._layerBinaryInfos}getLayer(e,t,n){const i=4*(t*this.blockCount[0]+e)+n;return e<this.blockCount[0]&&t<this.blockCount[1]&&i<this._layerBuffer.length?this._layerBuffer[i]:-1}getHeight(e,t){const n=this._blockCount[0]*EH+1;return(this._heights[t*n+e]-TH)*PH}getVertexCountI(){return this._blockCount.length<1?0:this._blockCount[0]*EH+1}getVertexCountJ(){return this._blockCount.length<2?0:this._blockCount[1]*EH+1}_setNativeData(e){this._data=e}_loadNativeData(e){if(!e||0===e.length)return!1;const t=new MH;if(t.assign(e),this._version=t.readInt(),this._version===OH)return!0;if(this._version!==wH&&this._version!==IH&&this._version!==RH&&this._version!==DH&&this._version!==NH)return!1;this.tileSize=t.readFloat(),t.readIntArray(this._blockCount),this.weightMapSize=t.readInt16(),this.lightMapSize=t.readInt16();const n=t.readInt();this.heights=new Uint16Array(n);for(let e=0;e<this.heights.length;++e)this.heights[e]=t.readInt16();const i=t.readInt();this.weights=new Uint8Array(i);for(let e=0;e<this.weights.length;++e)this.weights[e]=t.readInt8();if(this._version>=IH){const e=t.readInt();this.layerBuffer=new Array(e);for(let e=0;e<this.layerBuffer.length;++e)this.layerBuffer[e]=t.readInt16()}if(this._version>=RH){const e=t.readInt();this._layerBinaryInfos=new Array(e);for(let e=0;e<this._layerBinaryInfos.length;++e)this._layerBinaryInfos[e]=new zH,this._layerBinaryInfos[e].slot=t.readInt(),this._layerBinaryInfos[e].tileSize=t.readFloat(),this._layerBinaryInfos[e].detailMapId=t.readString(),this._version>=DH&&(this._layerBinaryInfos[e].normalMapId=t.readString(),this._layerBinaryInfos[e].roughness=t.readFloat(),this._layerBinaryInfos[e].metallic=t.readFloat())}return!0}_exportNativeData(){const e=new MH;e.writeInt32(NH),e.writeFloat(this.tileSize),e.writeIntArray(this._blockCount),e.writeInt16(this.weightMapSize),e.writeInt16(this.lightMapSize),e.writeInt32(this.heights.length);for(let t=0;t<this.heights.length;++t)e.writeInt16(this.heights[t]);e.writeInt32(this.weights.length);for(let t=0;t<this.weights.length;++t)e.writeInt8(this.weights[t]);e.writeInt32(this.layerBuffer.length);for(let t=0;t<this.layerBuffer.length;++t)e.writeInt16(this.layerBuffer[t]);const t=[];t.length=this.layerInfos.length;for(let e=0;e<t.length;++e){const n=this.layerInfos[e],i=new zH;i.slot=e,i.tileSize=n.tileSize,i.detailMapId=n.detailMap?n.detailMap._uuid:"",i.normalMapId=n.normalMap?n.normalMap._uuid:"",i.metallic=n.metallic,i.roughness=n.roughness,t[e]=i}e.writeInt32(t.length);for(let n=0;n<t.length;++n)e.writeInt32(t[n].slot),e.writeFloat(t[n].tileSize),e.writeString(t[n].detailMapId),e.writeString(t[n].normalMapId),e.writeFloat(t[n].roughness),e.writeFloat(t[n].metallic);return e.buffer}_exportDefaultNativeData(){const e=new MH;return e.writeInt32(OH),e.buffer}}).prototype,"_layerInfos",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bH=SH))||bH);var FH,BH,kH,UH,GH,jH,VH,HH;let WH=e("h1",(FH=Uc("cc.TerrainCollider"),BH=nl(),kH=Kc(),UH=vl(LH),GH=sl(),FH(jH=BH(jH=kH(jH=Jc((Pc((VH=class extends rj{get terrain(){return this._terrain}set terrain(e){this._terrain=e,this._shape&&this.shape.setTerrain(this._terrain)}get shape(){return this._shape}constructor(){super(dU.TERRAIN),Tc(this,"_terrain",HH,this)}}).prototype,"terrain",[UH,GH],Object.getOwnPropertyDescriptor(VH.prototype,"terrain"),VH.prototype),HH=Pc(VH.prototype,"_terrain",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jH=VH))||jH)||jH)||jH)||jH));var qH,YH,XH,QH,ZH,JH,KH,$H,eW,tW,nW,iW,oW,aW,rW,sW,cW,lW;let _W=e("h2",(qH=Uc("cc.SimplexCollider"),YH=nl(),XH=Kc(),QH=vl(pU),ZH=sl(),JH=sl(),KH=ol(),$H=sl(),eW=ol(),tW=sl(),nW=ol(),iW=sl(),qH(oW=YH(oW=XH(oW=Jc((lW=cW=class extends rj{get shapeType(){return this._shapeType}set shapeType(e){this._shapeType=e,this._shape&&this.shape.setShapeType(e)}get vertex0(){return this._vertices[0]}set vertex0(e){_i.copy(this._vertices[0],e),this.updateVertices()}get vertex1(){return this._vertices[1]}set vertex1(e){_i.copy(this._vertices[1],e),this.updateVertices()}get vertex2(){return this._vertices[2]}set vertex2(e){_i.copy(this._vertices[2],e),this.updateVertices()}get vertex3(){return this._vertices[3]}set vertex3(e){_i.copy(this._vertices[3],e),this.updateVertices()}get shape(){return this._shape}get vertices(){return this._vertices}constructor(){super(dU.SIMPLEX),Tc(this,"_shapeType",rW,this),Tc(this,"_vertices",sW,this)}updateVertices(){this._shape&&this.shape.setVertices(this._vertices)}},cW.ESimplexType=pU,Pc((aW=lW).prototype,"shapeType",[QH,ZH],Object.getOwnPropertyDescriptor(aW.prototype,"shapeType"),aW.prototype),Pc(aW.prototype,"vertex0",[il,JH],Object.getOwnPropertyDescriptor(aW.prototype,"vertex0"),aW.prototype),Pc(aW.prototype,"vertex1",[KH,$H],Object.getOwnPropertyDescriptor(aW.prototype,"vertex1"),aW.prototype),Pc(aW.prototype,"vertex2",[eW,tW],Object.getOwnPropertyDescriptor(aW.prototype,"vertex2"),aW.prototype),Pc(aW.prototype,"vertex3",[nW,iW],Object.getOwnPropertyDescriptor(aW.prototype,"vertex3"),aW.prototype),rW=Pc(aW.prototype,"_shapeType",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pU.TETRAHEDRON}}),sW=Pc(aW.prototype,"_vertices",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[new _i(0,0,0),new _i(0,0,1),new _i(1,0,0),new _i(0,1,0)]}}),oW=aW))||oW)||oW)||oW)||oW));var uW,hW,fW,pW,dW,mW,AW,vW,gW,xW;_W||(_W=e("h2",{}));let yW=e("h3",(uW=Uc("cc.PlaneCollider"),hW=nl(),fW=Kc(),pW=vl(_i),dW=sl(),mW=sl(),uW(AW=hW(AW=fW(AW=Jc((Pc((vW=class extends rj{get normal(){return this._normal}set normal(e){_i.strictEquals(this._normal,e)||(_i.copy(this._normal,e),this._shape&&this.shape.setNormal(this._normal))}get constant(){return this._constant}set constant(e){this._constant!==e&&(this._constant=e,this._shape&&this.shape.setConstant(this._constant))}get shape(){return this._shape}constructor(){super(dU.PLANE),Tc(this,"_normal",gW,this),Tc(this,"_constant",xW,this)}}).prototype,"normal",[pW,dW],Object.getOwnPropertyDescriptor(vW.prototype,"normal"),vW.prototype),Pc(vW.prototype,"constant",[il,mW],Object.getOwnPropertyDescriptor(vW.prototype,"constant"),vW.prototype),gW=Pc(vW.prototype,"_normal",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(0,1,0)}}),xW=Pc(vW.prototype,"_constant",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),AW=vW))||AW)||AW)||AW)||AW));var bW,SW,CW,EW,TW,PW,wW,IW,RW,DW,NW,OW,MW,zW;let LW=e("h4",(bW=Uc("cc.Constraint"),SW=Gc(FG),CW=vl(FG),EW=hl(),TW=vl(FG),PW=hl(),wW=hl(),IW=vl(FG),bW(RW=SW((zW=MW=class extends(qt(R_)){get attachedBody(){return this.getComponent(FG)}get connectedBody(){return this._connectedBody}set connectedBody(e){this._connectedBody=e,this._constraint&&this._constraint.setConnectedBody(e)}get enableCollision(){return this._enableCollision}set enableCollision(e){this._enableCollision=e,this._constraint&&this._constraint.setEnableCollision(e)}constructor(e){super(),this.TYPE=void 0,Tc(this,"_enableCollision",NW,this),Tc(this,"_connectedBody",OW,this),this._constraint=null,this.TYPE=e}onLoad(){yU.runInEditor&&(this._constraint=function(e){return RU.INITED||(RU.INITED=!0,RU[mU.POINT_TO_POINT]=function(){return EU(yU.wrapper.PointToPointConstraint,CU.PointToPointConstraint)?DU:new yU.wrapper.PointToPointConstraint},RU[mU.HINGE]=function(){return EU(yU.wrapper.HingeConstraint,CU.HingeConstraint)?DU:new yU.wrapper.HingeConstraint},RU[mU.CONE_TWIST]=function(){return EU(yU.wrapper.ConeTwistConstraint,CU.ConeTwistConstraint)?DU:new yU.wrapper.ConeTwistConstraint}),RU[e]()}(this.TYPE),this._constraint.initialize(this))}onEnable(){this._constraint&&this._constraint.onEnable()}onDisable(){this._constraint&&this._constraint.onDisable()}onDestroy(){this._constraint&&this._constraint.onDestroy()}},MW.Type=mU,Pc((DW=zW).prototype,"attachedBody",[CW,al,EW],Object.getOwnPropertyDescriptor(DW.prototype,"attachedBody"),DW.prototype),Pc(DW.prototype,"connectedBody",[TW,PW],Object.getOwnPropertyDescriptor(DW.prototype,"connectedBody"),DW.prototype),Pc(DW.prototype,"enableCollision",[wW],Object.getOwnPropertyDescriptor(DW.prototype,"enableCollision"),DW.prototype),NW=Pc(DW.prototype,"_enableCollision",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),OW=Pc(DW.prototype,"_connectedBody",[IW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RW=DW))||RW)||RW));var FW,BW,kW,UW,GW,jW,VW,HW,WW,qW,YW,XW,QW,ZW;LW||(LW=e("h4",{}));let JW=e("h5",(FW=Uc("cc.HingeConstraint"),BW=nl(),kW=Kc(),UW=vl(_i),GW=vl(_i),jW=vl(_i),VW=Yc("axisA"),HW=Yc("pivotA"),WW=Yc("pivotB"),FW(qW=BW(qW=kW((Pc((YW=class extends LW{get pivotA(){return this._pivotA}set pivotA(e){_i.copy(this._pivotA,e),this.constraint.setPivotA(this._pivotA)}get pivotB(){return this._pivotB}set pivotB(e){_i.copy(this._pivotB,e),this.constraint.setPivotB(this._pivotB)}get axis(){return this._axis}set axis(e){_i.copy(this._axis,e),this.constraint.setAxis(this._axis)}get constraint(){return this._constraint}constructor(){super(mU.HINGE),Tc(this,"_axis",XW,this),Tc(this,"_pivotA",QW,this),Tc(this,"_pivotB",ZW,this)}}).prototype,"pivotA",[UW],Object.getOwnPropertyDescriptor(YW.prototype,"pivotA"),YW.prototype),Pc(YW.prototype,"pivotB",[GW],Object.getOwnPropertyDescriptor(YW.prototype,"pivotB"),YW.prototype),Pc(YW.prototype,"axis",[jW],Object.getOwnPropertyDescriptor(YW.prototype,"axis"),YW.prototype),XW=Pc(YW.prototype,"_axis",[qc,VW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),QW=Pc(YW.prototype,"_pivotA",[qc,HW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),ZW=Pc(YW.prototype,"_pivotB",[qc,WW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),qW=YW))||qW)||qW)||qW));var KW,$W,eq,tq,nq,iq,oq,aq,rq;let sq=e("h6",(KW=Uc("cc.PointToPointConstraint"),$W=nl(),eq=Kc(),tq=vl(_i),nq=vl(_i),KW(iq=$W(iq=eq((Pc((oq=class extends LW{get pivotA(){return this._pivotA}set pivotA(e){_i.copy(this._pivotA,e),this.constraint.setPivotA(this._pivotA)}get pivotB(){return this._pivotB}set pivotB(e){_i.copy(this._pivotB,e),this.constraint.setPivotB(this._pivotB)}get constraint(){return this._constraint}constructor(){super(mU.POINT_TO_POINT),Tc(this,"_pivotA",aq,this),Tc(this,"_pivotB",rq,this)}}).prototype,"pivotA",[tq],Object.getOwnPropertyDescriptor(oq.prototype,"pivotA"),oq.prototype),Pc(oq.prototype,"pivotB",[nq],Object.getOwnPropertyDescriptor(oq.prototype,"pivotB"),oq.prototype),aq=Pc(oq.prototype,"_pivotA",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),rq=Pc(oq.prototype,"_pivotB",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),iq=oq))||iq)||iq)||iq));c.PhysicsSystem=qU,c.PhysicsMaterial=VU,c.PhysicsRayResult=HU,c.ConstantForce=hH;var cq=Object.freeze({__proto__:null,PhysicsSystem:qU,PhysicsRayResult:HU,get Collider(){return rj},BoxCollider:Vj,SphereCollider:Jj,CapsuleCollider:_V,MeshCollider:YV,CylinderCollider:SV,ConeCollider:LV,TerrainCollider:WH,get SimplexCollider(){return _W},PlaneCollider:yW,get Constraint(){return LW},HingeConstraint:JW,PointToPointConstraint:sq,get RigidBody(){return FG},PhysicsMaterial:VU,ConstantForce:hH,selector:yU,utils:jj,get ERigidBodyType(){return hU},get EAxisDirection(){return fU},get ESimplexType(){return pU},get EColliderType(){return dU},get EConstraintType(){return mU},get PhysicsGroup(){return AU}});e("gR",cq),Pn(qU,"PhysicsSystem",[{name:"ins",newName:"instance"},{name:"PHYSICS_AMMO",newName:"PHYSICS_BULLET"}]),Pn(qU.prototype,"PhysicsSystem.prototype",[{name:"deltaTime",newName:"fixedTimeStep"},{name:"maxSubStep",newName:"maxSubSteps"}]),wn(qU.prototype,"PhysicsSystem.prototype",[{name:"useFixedTime"},{name:"useCollisionMatrix"},{name:"updateCollisionMatrix"},{name:"resetCollisionMatrix"},{name:"isCollisionGroup"},{name:"setCollisionGroup"}]),Pn(rj.prototype,"Collider.prototype",[{name:"attachedRigidbody",newName:"attachedRigidBody"},{name:"TYPE",newName:"type"}]),Pn(rj,"Collider",[{name:"EColliderType",newName:"Type"},{name:"EAxisDirection",newName:"Axis"}]),Pn(LW,"Constraint",[{name:"EConstraintType",newName:"Type"}]),Pn(Vj.prototype,"BoxCollider.prototype",[{name:"boxShape",newName:"shape"}]),Pn(Jj.prototype,"SphereCollider.prototype",[{name:"sphereShape",newName:"shape"}]),Pn(_V.prototype,"CapsuleCollider.prototype",[{name:"capsuleShape",newName:"shape"}]),Pn(FG.prototype,"RigidBody.prototype",[{name:"rigidBody",newName:"body"}]),Pn(FG,"RigidBody",[{name:"ERigidBodyType",newName:"Type"}]),wn(FG.prototype,"RigidBody.prototype",[{name:"fixedRotation"}]),c.RigidBodyComponent=FG,Ne.setClassAlias(FG,"cc.RigidBodyComponent"),c.ColliderComponent=rj,Ne.setClassAlias(rj,"cc.ColliderComponent"),c.BoxColliderComponent=Vj,Ne.setClassAlias(Vj,"cc.BoxColliderComponent"),c.SphereColliderComponent=Jj,Ne.setClassAlias(Jj,"cc.SphereColliderComponent"),Ne.setClassAlias(_V,"cc.CapsuleColliderComponent"),Ne.setClassAlias(YV,"cc.MeshColliderComponent"),Ne.setClassAlias(SV,"cc.CylinderColliderComponent"),c.PhysicMaterial=VU,Ne.setClassAlias(VU,"cc.PhysicMaterial"),c.physics=cq;const lq={syncPhysicsToGraphics(e){const t=globalThis.Bullet;t.CACHE.getWrapper(e,t.BODY_CACHE_NAME).syncPhysicsToGraphics()}};let _q=jU;globalThis.BULLET&&(console.log("[Physics][Bullet]: Using the external Bullet libs."),_q=globalThis.BULLET),yU.runInEditor||(_q=()=>({}));const uq=e("ec",{});globalThis.Bullet=uq,uq.BODY_CACHE_NAME="body"}}}));
